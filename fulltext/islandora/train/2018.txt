fc,i wu.t >«3

A NOVEL CONTROL THEORETIC MODEL FOR RESILIENT PACKET RING (RPR) FAIRNESS

A Thesis Submitted To The Graduate School Of Ryerson University In Partial Fulfillment of the Requirements for the Degree Of Master Of Applied Science

By: Hossein Ghandehari-Alavijeh BSc. in Electrical and Computer Engineering, lUST, Iran, 1992

Department of Electrical and Computer Engineering University of Ryerson, Toronto, Canada January 2004

© Copyright by Hossein Ghndehari-Alavijeh, 2004

PROPERTY OF RYERSON UNIVERSITY UBRARY

UMI Number: EC53463

INFORMATION TO USERS

The quality of this reproduction is dependent upon the quality of the copy submitted. Broken or indistinct print, colored or poor quality illustrations and photographs, print bleed-through, substandard margins, and improper alignment can adversely affect reproduction. In the unlikely event that the author did not send a complete manuscript and there are missing pages, these will be noted. Also, if unauthorized copyright material had to be removed, a note will indicate the deletion.

UMI^
UMI Microform EC53463 Copyright2009 by ProQuest LLO All rights reserved. This microform edition is protected against unauthorized copying under Title 17, United States Code.

ProQuest LLC 789 East Eisenhower Parkway P.O. Box 1346 Ann Arbor, Ml 48106-1346

Author's Declaration
I hereby declare that I am the sole author of this thesis. I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research. Signature: ..

I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research. Signature: ...

1 1

Abstract
A Novel Control Theoretic Model for Resilient Packet Ring (RPR) Fairness, Hossein Ghandehari-Alavijeh, Ryerson University, MSc. in Electrical and Computer Engineering, 2004. Resilient Packet Ring (RPR) is a new Data Link Layer ring protocol. In RPR, the ring is a shared medium for multiple nodes compete to get a portion of shared bandwidth. Fairness algorithm is responsible for allocating fair bandwidth among competing nodes. In our research, we address the stability problems of the current RPR Fairness and introduce a new solution. The present work is the first control theoretic approach to RPR Fairness and Congestion Control that rigorously models the dynamics of RPR Fairness algorithm by using control theory. The key idea is to involve the active nodes in the Fairness and Queue Congestion Control process which means developing a decentralized control system. In RPR, when the number of nodes or the distance between the RPR nodes is high, the delay plays an important role in the behavior of the fairness which may lead to oscillation, instability and packet loss. We propose the implementation of Smith predictor as a valuable technique to overcome the effects of this delay and achieve higher throughput. Our new theoretical insights allow us to design fairness and congestion control algorithms that achieve fair bandwidth allocation and high throughput with small buffer requirement even in presence of large delay and large number of active nodes in the ring.

Ill

Acknowledgements
First of all I would like to thank my thesis supervisor,`Professor Kaamran Raahemifar for his invaluable direction and support. He played a fundamental role in shaping this research. He is a man of dream, insight and charm. Working with him is always rewarding. Also, I would like to thank Professor N. W. Ma, my co-supervisor. His knowledge, intelligence, dedication and experience have been truly the driving force of RPR research. Also, I am grateful to Professor Stalin Doctor, the Dean of the Electrical and Computer Engineering, for his unconditional support of the RPR Project. I would like to thank Professor M. Jaseemuddin, Professor G. N. Khan and Professor S. Krishnan who have contributed tremendously to my learning throughout my graduate education and served on my graduate committee. This research is made possible by the generous grant of Cisco Systems Inc. Cisco Systems, as the major supporter of development and standardization of RPR, has donated the RPR Lab to Ryerson University High Speed Networking research group.

IV

Contents
Abstract Acknowledgements iü iv

Chapter 1
Introdnction 1.1 Importance of Fairness and Congestion Control................................................... 1.3 Applications........................................................................................................ 1.4 Challenges........................................................................................................... 1.5 Research Contributions......................................................................................... 1.6 Overview.............................................................................................................. 1 2 3 3 3 4

1.2 Problem Identification........................................................................................... 2

Chapter 2
RPR Overview 2.1 Emerging RPR..................................................................................................... 2.2 Industry Motivations........................................................... 2.3 RPR Market Overview......................................................................................... 2.4 RPR Characteristics............................................................................................. 2.5 RPR Fairness....................................................................................................... 7 8 9 5 5

7

Chapter 3
Literature review 3.1 Academic Research on RPR................................................................................ 3.2 Academic Research on Congestion Control using Control theoiy....................... 10 10 11

Chapter 4
Definitions and Assumptions 4.1 Definitions and Assumptions.............................................................................. 4.1.1 Fluid Flow Model.................................................................................... 4.1.2 Max-Min Fairness................................................................................... 4.1.3 Delay...................................................................................................... 4.1.3.1 Delay Sources........................................................................... 4.1.4 Congestion Domain.................................... 14 14 16 16 17 17 19

4.1.3.2 Forward, Feedback and RTT Delays......................................... 18

Chapter 5
Control Theoretic Approach to Fairness 5.2 Mapping RPR Fairness to a Classic Control System.......................................... 5.4 Control Model for an active node....................................................................... 22 25 29 5.1 Introduction to RPR Fairness.............................................................................. 22 5.3 Control Model for the congested node................................................................. 28

Chapter 6
The proposed Fairness and Congestion Control Model 6.1 Fairness Control Model..................................................................................... 6.1.1 Analysis of the existing RPR Fairness...................................................... 6.1.2 Stability Analysis................................................................................... 6.1.2.1 Bode Plot Analysis................................................................... 30 32 32 36 36

6.1.3 Fairness Control Model using Smith predictor.......................................... 39 6.2 Fairness and Congestion Control Model............................................................. 42 6.2.1 Stability Analysis of the system with Proportional Controller................... 44 6.1.1.1 Nyquist Analysis....................................................................... 45 6.2.2 Steady State Analysis............................................................................... 48

Chapter 7
Simulations 7.1 Existing RPR Fairness linear model.................................................................... 7.1.1 Scenario 1.1.......................................................................................... 50 51 51

VI

7.2 Fairness Control Model using Smith predictor........................................................ 53 7.2.1 Scenario 2.1............................................................................................... 53 7.3 Fairness and Congestion Control Model................................................................. 55 7.3.1 Scenario 3.1............................................................................................. 55 7.3.2 Scenario 3.2............................................................................................. 59 7.3.3 Scenario 3.3............................................................................................. 61 7.3.4 Scenario 3.4.............................................................................................. 63 7.3.5 Scenario 3.5.............................................................................................. 65 7.3.6 Scenario 3.6............................................................................................. 66 7.3.7 Scenario 3.7............................................................................................. 68 7.3.8 Scenario 3.8............................................................................................. 70 7.3.9 Scenario 3.9............................................................................................. 72 7.4 OPNET and MATLAB Simulation: Comparison..................................................... 74

Chapter 8
Implementation Considerations 80

8.1 Congested Node...................................................................................................... 80 8.2 Fairness Packet........................................................................................................ 81 8.3 Fairness Traffic Adaptation...................................................................................... 81 8.3.1 Smith Predictor....................................................................................... 82 8.4 Queue congestion control.......................................................................................... 82

Chapter 9
Conclusions Future Works Appendix A 83 84 85

A.l Classic Controllers.............................................................................................. 85 A.2 Smith Predictor.................................................................................................... 87 Appendix B Bibliography 90 92 Scenarios................................................................................................................... 90

Vll

List of Figures
Figure 2.1: Primary and Secondary Transit Queues in RPR nodes.................................... 9 Figure 4.1: RPR Ring with and active nodes that contribute and their traffic need to be adapted........... 19

to the traffic of the congested node

Figure 4.2: S 2 starts sending traffic and becomes a member of the Congestion domain............................................................................................ 20 Figure 4.3: Fairness Control Model of the congestion domain of Figure 4 .2 .................. 20 Figure 4.4: When several congestion domain are overlapped the domain of the congested node with lower fair rate is dominant.......................................... 21 Figure 5.1: On-Off Congestion Detection........................................................................ 23 Figure 5.2: STQ Queue Congestion Detection................................................................. 24 Figure 5.3: Existing RPR Fairness................................................................................... 24 Figure 5.4: Simple RPR Queue Model..............................................................................26 Figure 5.5: A Classic Control Model................................................................................26 Figure 5.6: Control Model for the congested node........................................................... 28 Figure 5.7: Control Model for an active node................................................................. 29 Figure 6.1: Existing RPR Fairness linear model fi*om one of the active nodes view......... 32 Figure 6.2: Existing RPR Fairness linear model equivalent in Laplace Transform 35 Figure 6.3: Bode-Plot G {joe )H {j(o) .............................................................................36 Figure 6.4: Phase Margin can be interpreted as the uncertainty in the R T T ...................... 37 Figure 6.5: Gain Margin can be interpreted as uncertainty in the load level, which is caused by RTT and ..................................................................... 38

Figure 6.6: Fairness Control Model with Smith Predictor................................................ 39 Figure 6.7: Equivalent Model with a Smith Predictor in Laplace domain.........................40

Vlll

k Figure 6.8: When a> « -- the gain is unity and the phase is zero....................................41 Yi Figure 6.9: Fairness and Congestion Control model with Smith Predictor........................42 Figure 6.10: Equivalent of Fairness Control Model with Smith Predictor along with Queue Congestion Control...................................................43 Figure 6.11: Queue Model from one of the actives nodes view......................................... 43 Figure 6.12: Nyquist Plot of ^ when k^RTT = 1 ....................................................... 45

Figure 6.13: Nyquist Plot encircles the critical point -1, when k^RTT =

46

Figure 7.1: Fairness Control Model viewed by each active node.................................... 51 Figure 7.2: and Queue level for Fairness Control Model in case

of large number of active nodes and long delay become unstable........................ 52 Figure 7.3: Fairness Control Model with Smith Predictor............................................... 53 Figure 7.4: x, (t) is adjusted to the fair rate but Queue level is not controlled in the system with just Fairness Control with Smith Predictor............................ 54 Figure 7.5: Queue Congestion Control and Fairness Control model with Smith Predictor................................................................................................... 55 Figure 7.6: The Combined Fairness and Congestion Control with smith predictor can achieve fairness and queue control even with large delay................................................................................................. Figure 7.7: The reference rate for Fairness Control system is adjusted by Queue Congestion Control............................................................................. 57 Figure 7.8: Effect of different k^ on the Queue level when RTT and k^ are constant.... 58 Figure 7.9: 16 active nodes with no delay....................................................................... 59 Figure 7.10: A simple node model with Fairness Control mechanism............................ 59 Figure 7.11: Traffic ratex, (/) of an active node, Overall traffic (Sigma %(Q ) and Queue dynamic of the congested node in a system with long delay shows that fairness cannot successfully be achieved................................. Figure 7.12:16 active nodes with a fix delay between them.......................................... Figure 7.14: Fairness in a system with short delay can successfully be achieved but queue level increases rapidly....................................................
IX

56

60 61

Figure 7.13: A simple node model with Fairness Control mechanism............................ 61 62

Figure 7.15: Fairness in a system with relatively longer delay is achieved but with some throughput oscillations and queue level increases rapidly.............................. 63

Figure 7.16: Effect of RTT^ on the STQ Queue level................................................... 64 Figure 7.17: Fairness in a system with long delay cannot successfully be achieved......................................................................................................... 65 Figure 7.18: A simple node with Fairness control model and Smith Predictor Figure 7.19: Traffic rate JC j {t) of an active node, Overall traffic (Sigma %(f) and Queue dynamic of the congested node when Fairness control with Smith Predictor are implemented............................................................... Figure 7.20: A simple node model with Fairness Control and Smith Predictor and adjusted parameter........................................................................ 68 Figure 7.21: Traffic rate x, (/) of an active node. Overall traffic (Sigma A:(Q ) and Queue dynamic of the congested node when the controller parameter is adjusted......................................................................................... Figure 7.22: A simple node model with Fairness and Congestion Control with Smith Predictor.............................................................................. 70 Figure 7.23: Traffic rate if) of an active node. Overall traffic (Sigma x(t) ) 69 67 ....... 66

and Queue dynamic of the congested node, show how Fairness and Queue level control are achieved when controller parameters are adjusted Figure 7.24: The system response when 0.4 = ......... RTT 71 71

Figure 7.25: The closest node to the congested node with queue Congestion and Fairness Control with Smith Predictor.......................................................... 72 Figure 7.26: The furthest node to the congested node with queue Congestion and Fairness Control with Smith Predictor with RTT^^= 3 2 T ........................ Figure 7.27: discrete time domain simulation shows that Fairness and Queue level control are achieved....................................................................... Figure 7.28: SRP OPNET result of 15 active nodes with 7ms delay between every two nodes Throughput oscillates in RPR Conservative (SRP), when delay is high............................................................. ............................... 74 Figure 7.29: RPR Conservative (SRP) Ring in a WAN................................................. 75 Figure 7.30: OPNET Simulation shows the throughput in Conservative 73 72

(Gandolf) versus Aggressive when RTT delay is zero....................................... 75 Figure 7.31: OPNET simulation shows that the throughput Oscillates in RPR Conservative (Gandolf) too, when delay is high......................................... 76 Figure 7.32: Throughput oscillates in RPR Conservative when delay is increased.............77 Figure 7.33: Queue level is increased and become unstable in RPR Conservative when delay is increased. (MATLAB Simulation).............................................. Figure 7.34: Simulation shows that RPR with Queue Congestion and Fairness Control makes the system stable so that Throughput won't oscillate even when delay is high. (MATLAB Simulation)............................................... 78 Figure 7.35: Queue level becomes stable when Queue Congestion Control is implemented. (MATLAB Simulation)............................................................. 78 Figure 7.36: Queue level rises slowly and is controlled to a predetermined level (MATLAB Simulation)............................................................................. 79 Figure A.1: Delay compensation by Smith Predictor..................................................... 87 Figure A.2: Smith Predictor.......................................................................................... 88 Figure A 3: The simplified model.................................................................................. 89 Figure A.4: Equivalent model with Smith Predictor in Laplace space............................ 89 Figure B.l: SRP implementation of Fairness is fast with some transient oscillation Figure B.2: Gandolf implementation of Fairness is much more conservative, stable but slow................................................................................................... 91 90 77

XI

Chapter 1 Introduction
One of the major challenges in a ring protocol like RPR is to allocate fair bandwidth for the nodes. As nodes need to use the ring to send their traffic, at some pint, they have to compete for the limited available link bandwidth. So there must be a mechanism on the nodes to adapt their traffic rate to a fair rate. In RPR all nodes are the same and no master node is selected, so RPR nodes need to communicate by a special control packet called fairness packet in case of congestion. This packet is used to send fairness information to the active nodes. Active nodes are the nodes that contribute traffic to the congested node and their traffic rate is adapted to the fair rate. At any given time the active nodes form a distributed system. A distributed system in here is the programs running on a number of nodes connected via the network, that work together to accomplish a common goal which is fairness. As the number of active nodes varies dynamically, the system could be considered as a dynamic distributed system. Fairness packets a^re sent to upstream active nodes by the congested node as soon as it detects the congestion. This packet is used by active nodes to adjust their traffic rate to a fair rate. RPR traffic adaptation in fairness mode can be modeled as an adaptive closed loop feedback system. Some researchers have conducted research during the last decade to analyze the closed loop dynamics and stability properties of congestion control algorithms by utilizing a control theoretical approach [23,24,25].

1.1 Importance of Fairness and Congestion Control
Since RPR is proposed as a MAN and WAN Protocol, it needs to overcome the problems of Wide Area Networks such as Fairness and Congestion control while the system has high link delay and large number of nodes. Fairness is one of the major parts of RPR protocol. It is responsible for allocating fair bandwidth among the active nodes. A Fairness algorithm guarantees fair rate allocation among competing active nodes as fast as possible. Congestion needs to be prevented so the smooth monitoring and control of the average queue level of the congested node can ensure that the system reacts rapidly to the unpredicted traffic'change. When average queue level is too high any bursty traffic may cause queue overflow and packet loss.

1.2 Problem Identification
The goal of this thesis is to utilize control theory to investigate the behavior of the existing Fairness algorithm and introduce a new model that has more controllable behavior. The problems with the existing Fairness algorithm are as follows. 1. There is no control over the congested queue level. Queue level is just monitored and when it exceeds a low threshold, fairness is then turned on. However simulation shows that when the number of active nodes is large, fairness control cannot guarantee any bound on the queue level, which may lead to packet loss. When queue level exceeds high threshold the active node shuts down its own traffic to avoid packet loss. This behavior may lead to undesired oscillation [2]. 2. The only node that takes action when congestion happens is the congested node. It tries to avoid packet loss by decreasing its own traffic. At the same time it calculates and sends the fair bandwidth to the active nodes to throttle their rate. The controlling algorithm is not efficient enough and it causes the congested node to suffer. 3. Aggressive mode in the existing Fairness algorithm is fast but leads to oscillation in throughput, especially in the case of large number of active nodes and long delays, while Conservative mode is too slow to react to bursty traffic.

4. When the ring spreads in a wider area the propagation delay of the fiber links affects the behavior of RPR fairness and causes throughput oscillation. This is because, it takes time for the fairness packets to get to the active nodes and adapt their traffic rate. This delay is called Fairness Feedback Round Trip Time and needs to be compensated by a mechanism.

1.3 Applications
The current proposal for RPR protocol incorporates an algorithm called Fairness which is responsible for allocating fair bandwidth among the competing nodes. Any implementation of RPR in a wide area network needs to compensate the effects of the link delay on the stability of the system. Our Proposed solution called "Fairness and Congestion Control Model" can be implemented in the RPR Fairness algorithm so that the system achieves Fairness in traffic rate while has a robust control over congested queue level even in Wide Area Networks and when there is a large number of active nodes.

1.4 Challenges
The major challenges in controlling Congestion and Fairness in a WAN is to overcome the link delay effects on the stability of the Fairness algorithm. This is done in our proposed solution by implementing Smith Predictor which shows a robust response. The next challenge is to analyze and overcome the nonlinearity of the system. Our queue level control can decrease the nonlinearity but it doesn't overcome this effect. The implementation is another challenge because a more complicated Fairness algorithm needs more resources such as processor time and memory.

1.5 Research Contributions
The first contribution of this thesis is introducing a feedback control model for RPR Fairness. It responds rapidly to the congestion and avoids packet loss, while fully utilizes the bandwidth. Another contribution in this thesis is the queue congestion control which keeps the queue level close to a desired reference level. By choosing the reference level sufficiently larger than zero and sufficiently smaller than the buffer size, nonlinear effects may also be avoided. Also the outgoing

flow rate may be kept close to the full capacity of the link. Our contributions can be itemized as follows. 1. In our proposed solution when the average queue level is high, Fairness algorithm decreases the bandwidth utilization to bring down the queue level. Fairness increases the bandwidth utilization when queue level is low. 2. In our proposed solution all the active nodes are involved in achieving fair rate and congested queue control so the nearby active nodes help the congested node in avoiding the congestion, which prevents the congested node from shutting down its own traffic. This avoids throughput oscillation. 3. Our proposed Fairness algorithm is as fast as Aggressive mode in achieving the fair traffic rate and stable like Conservative mode. By adjusting the controllable parameters dynamically the Fairness algorithm is guaranteed to be stable. 4. Our proposed Fairness algorithm utilizes a classic controller along with a Smith Predictor to compensate the effects of long delay.

1.6 Overview
This Thesis is organized as follows. In Chapter 2, an overview of RPR is given. In Chapter 3, the literature is reviewed. In Chapter 4, some important definitions and assumptions are introduced. In Chapter 5, our Control theoretic approach to Fairness Control Model is introduced and in Chapter 6, our Fairness and Congestion Control model is introduced and its stability is analyzed. In Chapter 7, several simulations are shown and the results are analyzed also a comparison is performed. In Chapter 8, Implementation considerations are discussed and in Chapter 9, a conclusion is given and the future works are discussed.

Chapter 2 RPR Overview
2.1. Emerging RPR
One of the major challenges in today's data communication technology is the migration of packet-based technologies from Local Area Networks to Metropolitan Area Networks [1]. Rapid increase of bandwidth usage in emerging applications challenges the existing data infrastructure capacities. These infrastructures are based on SONET/SDH technology which is a circuit-oriented technology designed and optimized for voice systems. Carrying high volume of data traffic over these systems make it difficult to provision new services and increases the cost of adding capacity. One of the solutions is utilizing Ethernet in Metropolitan networks. Ethernet is a packet based technology that is designed and optimized for data traffic. Ethernet has evolved from 10Mbps to 100Mbps to IGbps and now to lOGbps. Gigabit Ethernet is capable of supporting fiber spans of more than 80 Km. Although it is suitable for point-to-point and mesh networks, it is difficult to deploy it in ring networks as a shared medium. On the other hand most of the existing metro area networks are ring based, because SONET is typically deployed over fiber rings. SONET in ring topologies implements a rapid protection mechanism that can restore connectivity in case of fiber or equipment failure. Ethernet lacks such a protection mechanism. An ideal technology could be the one that can exploit fiber rings (ring resiliency) completely and support all the advantages of data-based transport system like Ethernet. Resilient Packet Ring (RPR) protocol promises to be the one [2].

SONET suffers from some limitations. It was designed originally for point to point, circuit switched applications like voice traffic. This fact brings some disadvantages of using it for data traffic in metropolitan rings: 1. Fixed Circuit: Each circuit allocates a fixed bandwidth that may be wasted if not used. This disadvantage is significant for data traffic which is bursty in nature. 2. Bandwidth waste in Mesh topology: Creating a logical mesh circuit in a ring topology wastes bandwidth. ^ 3. Multicast traffic limitation: Each source needs to allocate a separate circuit for each destination. Also a new copy of the packet should be sent to each destination which consumes the bandwidth. 4. Wasted protection bandwidth: Half of the ring bandwidth is reserved in SONET for protection and is not used in the normal situation. Ethernet if considered as another option for the Metro Rings has its limitations too. Although Ethernet is efficient for data traffic, implementing it in ring topology is complex. It is optimized for point-to-point or meshed topologies, not for ring. Ethernet uses spanning tree on the bridges to avoid loops but it is slow to converge in case of fiber cut in the ring. The slow convergence is because of the fact that the information needs to be propagated to each upstream nodes. The lack of resiliency can be compensated to some level by link aggregation, but it is still too slow. Ethernet also doesn't provide fairness. Different companies have developed their own solutions for ring metros and Cisco SRP/DPT is one of the successful solutions. In August 2000 Cisco documented its SRP MAC layer protocol in IETF as RFC 2892 [3]. Nortel Network's OPTera Packet Edge System (OPES) was introduced as a solution for ring networks [4]. It is an interface card that inter-works with OPTera Metro 3000 Multi-service Platform series. It introduced an efficient transmission solution of packet and TDM traffic on the same physical SONET infirastructure. In December, 2000, IEEE 802.17 working group was formed to standardize Resilient Packet Ring (RPR) protocol [2].

2.2. Industry Motivations
optical networking has changed the network infrastructure by offering cost effective high bandwidth technologies. The current trends in the networks as follows. 1. The backbone is becoming an optical mesh with a clear focus on the maximum utilization of the installed base. 2. The Metro core is transferring from a SONET/SDH ring-based network to a pure lowcost WDM network with the main purpose of aggregating different traffic types and customers on wavelengths. Network intelligence is pushed from the metro core into the metro access. 3. The metro access is being made optical. RPR will dominant metro access and its network intelligence will be distributed among the nodes and will support functionality, enabling immediate and customer-managed provisioning of service and applications. 4. The customer drop will generally be Ethernet, allowing for up to 100Mbps and in some cases gigabit Ethernet speed will be applicable. RPR would be the main solution for Metropolitan Area network (MAN) access networks [1].

2.3. RPR Market Overview
Market analysts believe that the network costs for service providers are rising more rapidly than their revenues. This forces Carriers to focus almost exclusively on cost of any solution. They are in need of a new way to gain revenue from differentiated data services while supporting their legacy circuit-based voice systems. Ethernet is efficient in LAN and Point-to-Point implementation. It provides low-cost solutions for LAN and Point-to-Point. However, the majority of networks in the MAN are ring-based with rigorous Fault, Configuration, Accounting, Performance, and Security Management (FCAPS)compliant requirements on network availability. Therefore, there is an immediate need for new technology standards that provide a low-cost solution for building highly scalable resilient ring networks, which are optimized for packet transport and able to provide deterministic traffic performance.

By implementing RPR, existing equipment can be used by merely upgrading the interface cards, so RPR Implementation offers cost saving for the service providers [5]

2.4. RPR Characteristics
The characteristics of the RPR [1,2] could be summarized as follows: 1. Resiliency: RPR offers high metro access network reliability, by fiber protection and restoration capabilities (less than 50 msec) and also automatic topology discovery for ease of configuration. 2. Fairness: RPR offers fairness management. 3. Scalability: RPR is capable of scaling with the number of users and applications. 4. Predicted performance: High priority packets are delivered with minimal jitter and latency. 5. Optimizedfor the Ring topology 6. Supports the legacy voice services: RPR is compatible with SONET. 7. Efficient Bandwidth utilization: By offering Spatial Reuse and utilizing both rings RPR offers very efficient bandwidth utilization. Also Multicasting is very efficient because one RPR multicast packet can be transmitted around the ring and can be received by multiple nodes. 8. Operation, Administration and Maintenance (OAM) capability 9. Support for various physical layers: (Gigabit Ethernet, 10 GigE, SONET/SDH, and WDM) 10. Interoperability: The devices from different vendors can be configured on the same ring. 11. Compatibility: It is compatible with relevant portions of other Ethernet standards (e.g., 802.Id, 802.Iq).

2.5. RPR Fairness
Fairness is a mechanism for calculating and reporting fair rates of a ring access for fairness eligible traffic [3]. The use of fair rates prevents one station from occupying a disproportionate share of available ringlet capacity with respect to other stations on the ringlet. Fairness eligible traffic passes through Secondary Transit Queue (STQ).

High Priority Traffic

PTQ STQ
Low Priority Traffic

Figure 2.1: Primary and Secondary Transit Queues in RPR nodes High Priority traffic passes through Primary Transit Queue (PTQ) and is not affected by fairness control. Fairness algorithm on the congested node computes a fair rate value. This rate provides the basis for the computation of other rates that are communicated to active nodes on the ring. Fairness information is carried by fairness frames. A fairness fiame is carried on the ring, opposing that of the data flow sent. A fairness frame allows a station to advertise a fair rate value to its upstream neighbors. A node is not permitted to use more than its fair rate of available capacity for the insertion of fairness eligible traffic when congestion has been detected on a ring. This restriction prevents a node from utilizing a disproportionate share of available capacity by virtue of its relative position on the ring. There are two modes of Fairness, Aggressive and Conservative. Conservative fairness is slow in convergence but more stable while Aggressive is fast in convergence but less stable.

Chapter 3 Literature review
3.1. Academic Research on RPR
Standardization of RPR by IEEE 802.17 has put this protocol under attention by Industry and Academic world. It is extremely attractive for industry because of its market potential and for Universities because of the challenges it faces in its promises. individuals. Vienna University of Technology (Austria) was one of the first universities that worked closely with IEEE 802.17 in developing the new RPR technology [6]. Their contribution into the group in understanding the nature of this emerging ring technology was significant especially fi-om theoretical point of view. They proposed a new solution for RPR. Researchers in Simula Research Laboratory in University of Oslo (Norway) introduced a fairness algorithm for RPR [7]. They also developed a Java simulator to simulate RPR network. Their approach is to modify the RPR fairness to fit in short distance LANs to gain a better performance because the RPR fairness generally is optimized for long distance MANs. Their approach is to implement triggers instead of times to meet the tighter latency requirements of high-speed networks. In Munich University of Technology (Germany), a research is done on Single Failure situations in RPR rings [8]. Protection mechanism is analyzed and new approaches are introduced. Some Universities have established their own RPR research groups and in some cases the researches are done by

10

Rice University (US) RPR group has published their work recently [9] and introduced their bandwidth allocation algorithm, called Distributed Virtual-time scheduling in Rings (DVSR) and fairness algorithm RIAS to achieve less Oscillation while obtaining a complete spatial reuse. The key idea is for nodes to complete a simple lower bound of temporally and spatially aggregated virtual time using per-ingress counters of packet arrivals. Carlton University (Canada) optical Network Laboratory research group joint with Nortel Networks conducted some researches in performance analysis of RPR [10]. They showed that the single buffer technology which is the Nortel implementation of RPR called OPTera can achieve as high as 95% utilization with very low ring access delay and is an excellent candidate for 802.17. The major advantage of this model is that, it is extremely simple to implement. The IEEE 802.17, standard RPR will support both single and double transit buffer. Ryerson University (Canada) RPR research group has conducted several researches in RPR and developed an OPNET Model based on the RPR proposal Draft. This group also developed a novel Fairness and Congestion Control model for RPR by using Control Theory. The closed-loop nature of Fairness causes throughput instability when the ring delay and the number of nodes involved are significant. This thesis is the first attempt to approach RPR Fairness using Control Theory. This approach gives this group the chance to use powerful control theories to develop a new Fairness algorithm and analyze its behavior.

3.2. Academic Research on Congestion Control using Control Theory
Many researches have been done in the recent years to develop theoretical control models for computer networking and internet protocols. One of the most important problems in internet protocols is the congestion control. Un-controlled congestion may cause packet loss. When congestion happens there should be some mechanisms to acknowledge the sources to decrease their rate or change their other controllable parameters. The closed loop nature of these protocols can lead to oscillation or instability. By modeling these systems to classic control systems we can utilize control theory to stabilize the protocol responses, hi case of Congestion, Fairness will be an important issue. Fairness is a mechanism to allocate a limited shared resource fairly among the competent sources to overcome congestion.

11

This thesis is the first of its kind that approaches RPR Fairness using Control Theory, but there have been some other attempts to model other congestion and fairness mechanisms using control theory that we refer to them here, as a starting point. The first mechanisms relate to internet protocols like TCP congestion control. In [11] a new model for TCP's window control mechanism is developed. In [12] a dynamic TCP model is developed to analyze and design an Active Queue Management (AQM) control systems, using RED. The bottlenecked queue level is selected as the observation parameter. The queue level is controlled by changing the window size. In [12] the stability of an intemet-like congestion communication network is analyzed by modeling the TCP congestion control as a control system. The network consists of sources and links with heterogonous propagation delays. Each link sets a price per unit flow, based on the aggregate flow through that link. The sources set their transmission rates based on the aggregated price they see. In the absence of delays this scheme is globally stable but when delay is significant the system goes to instability. Then the stability conditions are discussed. Many works in the area of ATM are done to theoretically model and analyze the congestion control in ATM switches. In [13] a new feedback control algorithm is introduced for Available Bit Rate (ABR) service in ATM. It is mentioned that the difficulties in providing ABR service is because of the burstiness nature of data traffic, the dynamic nature of the available bandwidth, as well as the feedback delay. Then a Control theoretical methodology is proposed for ABR congestion control algorithms by separating the problem to Rate Reference Control (RRC) and Queue Reference Control (QRC). This way the output rate of the congested switch and queue level would be controlled at the same time. [14] introduces a dynamic Max Min Fairness for Storage Area Networks in Ring networks with spatial reuse and [15] discusses the allocation of the resources in a shared environment. In [16] a decentralized control law is developed at the end systems and routers in the internet, to provide high utilization, low queuing delay and dynamic stability and fairness. Then this control law is extended at TCP sources, provided that a bound on round trip time is known. Early Congestion Notification (ECN) marking is used to carry congestion information between Links and sources. In [17] the focus is on global stability of this controlled system in case of multiple sources and a

12

single link network. In [18] a classic control theory model is introduced to achieve QOS and fairness among several competent applications. The analysis is done in discrete time domain but delay is not put into consideration. A PID controller is implemented and its stability criteria are introduced. In [19] a TCP-like protocol called XCP is developed using control theory. In [20] analysis of the stability of a TCP-like congestion control is presented. In [21] TCP inefficiency and instability is addressed in case of higher delay. As a solution an internet congestion control is introduced that outperforms TCP and remains efficient, fair, scalable and stable as the bandwidthdelay product increases. This new eXplicit Control Protocol, XCP, generalizes the Explicit Congestion Notification (ECN). In addition XCP introduces the new concept of decoupling utilization control fi' om fairness control. In [22] a rate based ABR control is introduced in ATM networks. In [23] the focus is on delayed networks. Delayed networks are fundamentally more complicated and difficult to control. In [24] and [25] high speed ATM networks have been approached using control theory and Smith Predictor [26] is proposed to avoid oscillatory behavior. In [25] the effect of the delay on the queue level is compensated using Smith predictor. Each source has limited information about the network and needs to depend on its own assumptions. In our approach each node creates a view of the network as if all other nodes see the same delay, have the same parameters and behave the same way it does. Based on this assumption it compensates the effect of the delay and adapts its traffic rate to achieve queue congestion control and fairness. Because all the nodes remove the delay fi"om their Fairness Control feedback loop using Smith Predictor and adjust their controller parameters dynamically the overall adaptation is smooth and with minimum transient time. Our model can achieve Queue Congestion Control and Fairness while utilizes the maximum bandwidth and guarantees minimum packet loss.

13

Chapter 4 Definitions and Assumptions
Fairness algorithm is responsible for allocating fair bandwidth among the competing nodes over the shared bandwidth. To analyze the behavior of Fairness we define some terms in section 4.1.

4.1. Definitions and Assumptions
1) It is assumed that the control theoretic model of the Fairness Algorithm can be approximated by linear equations. 2) The constant time interval [ +1 ] is the sampling time.

3) Node6"*is the upstream of nodeiS,.when h < i . Traffic flow is fi-om upstream to downstream. 4) c is the total traffic rate that congested node sends out. This traffic is the actual transmit rate or service rate of the congested link. 5) is the maximum shared bandwidth.

6) Congested node is a node that detects the congestion and goes to fairness mode. In this work just single chock congestion is discussed. 7) Active node is a node in a congestion domain that contributes traffic into the congested node Sj and its traffic is adapted to the fair rate. All active nodes would be considered to be part of Sj congestion domain. 8) / is the number of active nodes. It is assumed to be fixed during the adaptation. 9) Xi is the traffic rate that active node iS, sends to the ring. 10) X- (Jc) is active node's traffic at sampling interval k in discrete time domain.

14

11

) x(t) in our formulas is the average traffic rate of all the active nodes at the time of adaptation.

1 2

) u.is the compensation value that will adjust the queue level and jc,..

13) Semi-Active node is a node in a congestion domain that contributes traffic into the congested node S j and its traffic is less than fair rate. 14) M is the total number of Active and Semi-Active nodes, fixed during the adaptation. 15) M - / is the number of Semi-Active nodes which their traffic (/)) is less than the fair rate. 16) r. is the traffic rate of a Semi-Active. 17) R is the traffic of all the Semi-Active nodes received by the congested node, R = ^ f ' j .

18) Traffic received by the congested node is ^ X j + R , which in steady state is equal to c . 19) Fairness eligible traffic is the low priority traffic that is affected by fairness algorithm. The high priority traffic are not affected by fairness. 20) STQ or Secondary Transit Queue is a queue that fairness eligible traffic is buffered. 21) is the controllable parameter of the Fairness Control. It shows how fast the adaptation of traffic rate is. The bigger the value of , the faster the fairness adaptation.

22) kg is the controllable parameter of the Queue Congestion Control. It shows how fast the adaptation of Queue level is. 23) Fairness Feedback Round Trip Tiros R T T , is assumed to be fixed during the adaptation period. 24) Each node has a static weight to,.. This weight represents the proportion of the Bandwidth it must utilize. As number of active nodes varies we need to calculate the dynamic weight for nodes as C Û ; M =1
/

where y,is the dynamic weight of the node iS " , and
1=1

=1 .

15

In case of same static weight 6 ), = fOj = -- = û>,-, the dynamic weight would be
(O,
let),

1
I

4.1.1. Fluid Flow Model
As in many other works in the literature, the analysis in this thesis is based on a fluid approximation of the traffic flow.

Definition: Fluid flow model is a model in which the packets are assumed to be infinitely small in size so that the traffic flow sent by a node can be seen as a fluid flow. Different traffic sent to different nodes may be considered as sub-flows. This assumption is more accurate when the packet size is fairly small.

4.1.2. Max-Min Fairness
In a dynamic scenario each node exchanges data with several other nodes at the same time. We call each of them a flow. Let let denote the rate of flow f . Let be the capacity of link L and

be the set of all the flows using linkZ., and also c denotes the sum of rates of all the flows

using linkZ.

Definition: An allocation is said to be feasible if it is /y >=0 for any flow f and c < linkZ,.

for any

Definition (Max-Min Fairness): An allocation of a rate Xj- for flow f is Max-Min fair if it is feasible and for each flow f , Xy cannot be increased (while maintaining feasibility) without decreasing Xy,, for some flow / ' for which Xy. < Xy [27].

16

Definition (Dynamic Max-Min Fairness): An allocation of a rate Xj- for flow f is Max-Min fair if it is feasible and for each flow f , Xj- cannot be increased (while maintaining feasibility) without decreasing Xy,, for some flow / ' for w h i c h < -- [14]. rr Yf In the discussions in this thesis it is assumed that RPR Fairness is a Dynamic Max-Min Fairness.

4.1.3. Delay
4.1.3.1 Delay Sources
The total delay of sending and receiving packets between two nodes on a link can be represented by the formula T d= T ap+ T j,+ T^,

where

is the total delay. 7^ is the propagation delay which equals to the link distance divided

by speed of the light in fiber (0.66cor 198000 k m is). Each kilometer of fiber has 5 //sec Propagation delay. is the transmission delay which is equal to the number of bits in each

packet {M TUfor the worst case) divided by the link bandwidth. Tj^is the queuing and processing delay which equals to the number of nodes multiplied by the processing delay plus sum of the queuing delays. Assuming that the links inside a congestion domain are not congested and that processing delay is in the order of 10"* seconds we can say that is negligible. This assumption is based on a

single chock congestion where there is just one congested node. Therefore the links inside its congestion domain are not congested. When number of bits transmitted on a link in one second is much higher than M TU (in bits), transmission delay (T^, ), also becomes negligible. This means that for an RPR ring, it is the propagation delay (7 ^ ) of the physical link that determines the delay of the link. In our analysis whenever we refer to delay between two nodes (7 ^ or Tp ), we mean the total delay T j . A 100km distance between two nodes creates 0.5 m sec delay.

17

4.1.3.1 Delay Types
The delay in the transmission of fairness packets from the congestion node to an active node is called feedback delay and is shown by 7 ^ . The traffic generated by the active node encounters with its forward delay T j^.

The forward delay differs based on the distance and the situation of the nodes between source and the congested node. The overall forward delay is 7 ^ . These delays contain a fixed component of propagation delay and packet processing, and a time varying component of queuing delay. The time that the fairness packet needs to get to the active node and change its rate (7 ^ ), plus the time that this change will need to get to the output queue of the congested node ( 7 ^ ), is called Fairness Feedback Round Trip Time, R TT (R T T = 7 ^ + 7 ^ ). Each active node estimates the Fairness Feedback RTT by sending a packet to the congested node and receiving the response and calculating the Round Trip Time. In our discussions Fairness Feedback Round Trip Time, R TT , is assumed to be fixed during the adaptation period.

18

4.1.4. Congestion Domain
RPR Fairness system consists of a single bottleneck node fed by multiple traffic sources in the ring [2]. In order to analyze the fairness behavior using control theory, a mapping needs to be done between RPR Fairness and the classic control system.

K

Congestion Domain

--> 1

80

S2

83

84

85

86

87

Figure 4.1: RPR Ring with

and

active nodes that contribute to the traffic of the

congested node and their traffic need to be adapted. At any given time a node that detects the congestion goes to Fairness mode and is called congested node. All the nodes that contribute to the traffic of the congested node and their traffic are eventually adapted to fair rate are considered as Active nodes. Congested node monitors the traffic that needs to be serviced (the received traffic and its own traffic) and if it is more than a low threshold, it sends a feedback to its active upstream nodes to inform them of its congestion.

Figure 4.1 shows a scenario that nodes 6 "^,

and 1S5 attempt to send a traffic to node iS"g,that is

more than the ring available bandwidth. In this situation node 6 "; detects the congestion first.

19

Congestion Domain

80

82

S3

85

8 6

87

Figure 4.2: S 2 starts sending traffic and becomes a member of the

congestion domain.

The congestion domain will vary based on the number of nodes that are active. In Figure 4.2 node
1 2

S starts sending traffic to nodciSg. At this time the congestion domain changes and node

S 2 becomes one of the active nodes to this new congestion domain.

Congestion Domain

S5

85 Fairness

Figure 4.3: Active nodes and congested node with its feedback messages in the congestion domain of Figure 4.2. The Fairness algorithm is dynamic, because at any given time each node may go to a different State. A node is considered as Congested when the traffic rate that it needs to service goes beyond a known low threshold. As soon as the node goes to congested state it recognizes all the upstream nodes that contribute to its traffic. All those nodes are known as Active or Semi-Active nodes for this congestion domain. Several congestion domains may overlap, and a node might be in several congested domain.

20

^ ^

SS Con^sihn Domain Congesûon Domain ^

S2

S4 Fainiess

S5 Fairness

Figure 4.4: When several congestion domain are overlapped, the domain of the congested node with lower fair rate is dominant. In Figure 4.4 each node attempts to send 250 Mbps at time t=0, so node 6 " ^and node iSj will be congested and the fair rate for
5 4

622 622 is -- ^ M b p s and for 6 "gis -- ^ M b p s , so Fair rate of

is

less than Fair rate of < $ '4 , and therefore, it becomes dominant congestion domain. In this thesis we attempt to map the congestion domain to a control system.

21

Chapter 5 Control Theoretic Approach to Fairness
RPR Fairness algorithm can be considered as a dynamic distributed system. It is a distributed system because Fairness algorithm on the congested node and the active nodes run as a distributed application to achieve the fair rate. They try to control their output. This eventually decreases the rate received by the congested node, decreases its queue level and prevents it from packet loss while guarantees a fair rate allocation for active nodes. The job of the fairness algorithm is to adjust the traffic of all those nodes to achieve a smooth output. The steady State rate for all those nodes is eventually the fair rate.

5.1. Introduction to RPR Fairness
Based on the RPR draft, Conservative mode can be mapped roughly as an On-Off control. RPR congestion detection consists of two methods, first overall traffic and second STQ queue. In both of them low threshold and high threshold are used for On-Off control.

22

RPR Conservative Fairness
'S' 0) M

High Threshold

I u
H

»

Low Threshold

k-1 Ramp Up No Change Ramp Down No Change

Time

Figure 5.1: On-Off Congestion Detection. In discrete domain and conservative mode if c{k), the output rate of the congested node, exceeds the low threshold the system recognizes transitioning into congestion. When the system is congested and its c{k) is higher than the high threshold it decreases its rate and throttles other active nodes to its pre-calculated fair rate. If c(Ar) is less than low threshold, then the node increases its rate. When c(Jc) is between low threshold and high threshold, the node does not change its rate.

I

X, (A : - 1) - 0,x, (k - 1 ) ( c ^ - X, (k - 1))

c{k) > High _ Threshold ( RampDown ) c(k) < Low_ Threshold ( Ramp Up )

X, (Â : - 1) +

X, {k - 1)

Low _ Threshold < c{k) < High _ Threshold ( NoChange )

From this equation it can be seen how Conservative model adapts its rate to achieve fairness. At the same time the fair rate is calculated based on the available bandwidth and number of active nodes and is sent to the active nodes to throttle their rate to this pre-calculated rate.

23

Too Congested

-»

Congestion Detected (Fairness On)

Un-congested

E l ^ Threshold Low Threshold Figure 5.2: STQ Queue Congestion Detection One of the weaknesses of the current RPR Fairness algorithm is the non-linearity, or its On-Off behavior when congestion happens. There is a parameter which works as a switch to let the node to add traffic or not at all. When congestion happens and the queue level is higher than high threshold, this parameter becomes off (False) which means the node is not allowed to add any traffic to the ring. The following figure shows how current fairness works.

Active Nodes

output

RPR MAC Congestion Detected

Figure 5.3: Existing RPR Fairness

0^^ (x) is a Saturation Function and is defined as

X

0 < X < X,

24

so
0

a:,(A: ) < 0 Xi{k)>y{k) (k)

{

y ik ) Xi (k) =

0<% . (k) < jK ,. (k)

Which means that the RPR node Sj which attempts to add its traffic to the ring by the rate Xj {k) , throttles its traffic to the lower rate, y (k ). The nodes with traffic less than throttled and can send their rate x. (k) which is equal to r, ( k ) . won't be

5.2. Mapping RPR Fairness to a Classic Control System
In the current RPR Proposal drafts, the congested node, first decreases its rate, to prevent packet loss, then calculates the fair rate based on the information it has and advertises this rate to throttles all active nodes to the fair rate. In this approach the delay is not considered, hence in case of high delay, by the time the active node receives the fairness packet it has already sent a high number of its packets. This causes a longer time to converge and in some cases oscillation in throughput, or packet loss. To solve this problem, in this thesis a new mechanism is proposed. In this mechanism each active node participates in the controlled loop and calculates its rate by considering its estimation of the Round Trip Time,RTT, of the fairness packet, hi this approach, the congested node monitors its received traffic rate and queue level and advertises them to its active nodes. Each active node then uses these information and its estimated R TT to adjust its rate. This approach dynamically controls the rates and guarantees no packet loss by controlling the congested queue level. It speeds up the convergence and also achieves higher bandwidth utilization. To simplify the model, each node is considered as a queue serviced as FIFO, in cascade with a traffic shaper.

25

Congestion Domain

S2

S5 Fairness

Figure 5.4: Simple RPR Queue Model The traffic shaper is in charge of deciding how much traffic needs to be serviced and sent out to the next node. It uses a token bucket which allows burstiness while bounds it. In Figure 4.8, it is assumed that node is congested. 1S5 Fairness algorithm turns on, as soon as the congestion is shaper will compensate

detected. As the active nodes are trying to send more than the fair rate,

the overload of the traffic of the other active nodes by decreasing its own traffic. It means always send less than the fair rate to make sure the overall traffic c is less than .

To map RPR Fairness to a control system, the similarities need to be identified. In a classic control system which is shown in Figure 5.5, there is a target system which needs to be controlled, a controller which monitors the state of the target system and compares it with the reference value.

26

Disturbance Reference Input Error Controller Plant Output

Feedback

Figure 5.5; A Classic Control Model In this thesis RPR Fairness algorithm is mapped to a classic closed loop control system, hi this mapping the monitoring system is the received traffic rate and the queue level of the congested node. All the traffic is destined to the congested queue and served in a FIFO service discipline. The target system is the active node that sends traffic to the congested node. After the congestion is detected the congested node starts sending fairness packets to the active nodes.

27

5,3. Control Model for the Congested Node
Congested node can be simplified as a Queue and a policer that services the incoming low priority fairness eligible traffic. The high priority traffic is not affected by fairness. 1- Congested Queue

Low Priority Traffic

2- Equivalent Model c(t)

2

-

1 -1

-7(f)

O J
3- Simplified Equivalent Model c(t)-R(t)

2
1=1

<7(0
O f

dt

Figure 5.6: Control Model for the congested node I The incoming traffic to the congested node is ^ X i(t--Tj^.) + R { t , which is the /=i aggregated traffic of all active nodes and semi-active nodes. Figure 5.6.1 shows the equivalent of the congested node. is the forward delay that takes for data traffic to get to the congested

node. q(t) is the queue level of the congested nodes transit queue. c(f) is the rate of serviced traffic by the congested node. It is very close to the link bandwidth. R(t -- ) is the traffic of

all the semi-active nodes when they are received by active node. Since it is constant during the adaptation of the active nodes, R (t-T j^^) = R(0^riA this can be considered as a delay independent parameter that is received by the congested node. Figure 5.6.2 can be simplified to Figure 5.6.3.

28

5.4. Control Model for an Active Node
As we mentioned before for conservative fairness convergence of the traffic can be mathematically shown by:

Xi ( k - l ) - 0^Xl {k - 1) X i(k)_ ^ X j(k~ l) + 0 ^ ( c ^ - X i ( k - l ) ) X; ( k --1)

c(k) > High _ Threshold ( RampDown ) c(k) < Low_Threshold (RampUp)

Low _ Threshold <c(Jc) < High _ Threshold ( No Change )

Xf{k) is active node's traffic at sampling interval k . A simple linear control equivalent of this formula is a proportional controller in cascade with an integrator. Xi (k) = X. (^ -1 ) + k^e(k) or X( (k) - X. (k -Y ) = k^e(k) or in continuous time domain dxiit) dt which is shown in Figure 5.7. = k^e{k) /

ei$)
K m

x ,(t )

Figure 5.7: Control Model for an active node Figure 5.7 shows the linear model for the fairness algorithm of an active node.

29

Chapter 6 The proposed Fairness and Congestion Control model
To guarantee that Fairness algorithm can perform a stable bandwidth allocation and no packet is lost, the received traffic rate and the queue level of the congested node need to be monitored and controlled. If the queue is empty most of the time, most likely the bandwidth is not highly utilized and if it is almost full the probability of packet loss is high. Keeping the queue level in a fixed level guarantees a high bandwidth allocation while minimizes the chance of packet loss. RPR Fairness relies on feedback messages sent using fairness packets. When the distance is significant, the delay will play an important role in the stability of the system. The Fairness algorithm can be viewed as a delayed feedback system, where the congested node informs the active nodes about its congestion status, so that they can adjust their rate to a fair rate. In this Chapter we will map RPR to a classical control system and then analyze the effect of the delay on congested queue level and overall fairness behavior. When Fairness is on, the simplest mechanism to control the flow of data from the active nodes to the congested node that is used in the existing RPR proposal drafts, is to command the active nodes to send data at a rate no greater than the fair rate or in other words to command them to throttle themselves to the fair rate. In steady state the output link of the congested node is highly utilized and there is no packet loss due to buffer overflow. However, when the fair rate is changed due to change of number of active nodes, the propagation delay in the link can prevent the active nodes from reacting correctly to the changes which may lead to oscillation. Even in steady state if

30

there is an error in calculating the fair rate, the queue will either be empty or grow until it overflows. One mechanism could be that the congested node computes a fair traffic rate. This calculated fair rate is then sent to the active nodes by fairness packet. However the link delay can prevent the active nodes fi"om reacting quickly which generally leads to packet loss or throughput inefficiency. Furthermore, if the number of active nodes is large, the system may become more sensitive or even unstable. It is assumed that the Fairness Feedback Round Trip Time, R T T , is constant for each active node while it adapts to the fair rate. This assumption is relatively accurate because in Wide and Metropolitan Area networks the round trip time is mostly determined by propagation delay and this delay is fixed. To take into account the jitter of round trip time due to queuing time, a model containing time varying delays could be considered. So in our analysis, during the rate adaptation time, the Fairness Round Trip Time is assumed to be constant.

31

6.1 Fairness Control Model
6.1.1 Analysis of the existing RPR Fairness
Fairness algorithm is responsible for monitoring and controlling its received traffic rate including its own traffic to keep it as close as its maximum service rate which is equal to the link bandwidth (c^^) . It needs to monitor the received traffic rate and send it to the active nodes. Each active node then decreases its traffic rate. This mechanism involves all the active nodes in the process of fairness.

Active Node

RPR Ring

I Congested Node
'

c(0 - i ?

( 0

< t ) _ _ _ _ _ _ u ,( t)

X ,( t )

Figure 6.1: Existing RPR Fairness linear model fi-om one of the active nodes view

Each active node has it's own view of the network based on its

, and active weight

( t) .

Major elements of this model are Congested and Active node which have been introduced in chapter 5 section 5.3 and 5.4. This model consists of the Active Node's fairness which shown simply as a proportional controller in cascade with an integrator. RPR Ring simply causes a forward delay in the path of data traffic and a feedback delay in the path of feedback information.

32

Congested node is considered as a queue that its overall traffic rate and its level will be monitored. A ^^is the controllable parameter of the Fairness Control. It shows how fast the adaptation of traffic rate is. The bigger the value of , the faster the fairness adaptation. Since

each active node has limited view of the rest of active nodes, it assumes that other active nodes behave the same way as it does. So the parameter ----- represents the rest of the network form Yiit) its view. When all nodes have the same static weights, then ----- = 1(f). So simply this nodes Yiit) multiply its own traffic to the number of active nodes which is constant during the adaptation to find out how much traffic needs to be sent to the congested node. The overall traffic should not be more than the available service rate of the congested node c(t) --R(f).

Proposition 1: The adaptation of the rate by each active node results in fair traffic rate when forward delay is negligible. Proof: If there are I active nodes the dynamic of the system would be

at
The congested node considers its own Transmit Rate or Add Rate as an input traffic too. It is assumed that the number of active nodes does not change during one fairness feedback round trip time so l ( t - T j f ) = l(t) and y f t - T j f ) = y f t ) = Yi and alsoi?(/ -7}^) = R(t ) . Replacing the aggregated traffic of active nodes by the average of active nodes traffic, times number of active nodes

1=1

we have

^
or

= H m - T ^ ) - lc(l) - R(l)]

33

· ^ dt but

=

Yiit)

- T ^ , ) - [c(<) - # ) ] .

So the dynamic of the queue can he shown as

dqit) dt

1

y,{t)

^i it~ '^ % )~ \pit) - ^ ( 0 ] ·

In the steady state, when the queue level is stable, then the overall traffic sent by the active nodes is equal to which can he the full available bandwidth or

7iit)

if

'fjw, )

^ if) ~

'

and the traffic sent by each node can be viewed as

X iit-Tj^^) = 7iit)[C r^-R it)].

As it is shown in this equation the traffic rate sent by each node is dependent on its own forward delay. When delay is negligible the fair traffic rate is achieved. Xiit) = ri[Crrf-Rit)] But when delay is long then the traffic rate for each active node depends on its own RTT. So the effects of RTT needs to be analyzed. The equivalent model in Laplace domain with x. (s) can be shown as follows.

34

e (s)

u .( s )

x .( s )

Figure 6.2: Existing RPR Fairness linear model equivalent in Laplace domain. The open loop transfer function of the system is

s or

ri(s)

-RTTs

Y ii.s)

s

As the active node can estimate its R T T , when RTT^ = R T T , the system can be simplified as

G{s)H{s) =

K{s)RTT,

e -RTTs RTT,s

By replacings = j a , k{s) =

, //(s ) = y. and RTTco = 6 then

KRTT G {jco)H ijco)^ --
Yi

X --------

JO

35

6.1.2 Stability Analysis
Using the open loop transfer function, the stability of the closed loop system can be discussed using Bode-Plot.

\G { jo ))H U G > )\ =

KRTT Yi

X

jO

ZG Ua))HUo}) = Z j0

6.1.2 .1 Bode-Plot Analysis:
The goal of control system is to have an acceptable margin of safety. These margins are called stability margins. A Bode-Plot is the frequency response of the open-loop system. This figure e"-"" e -je shows the bode plot diagram of -- ;-- which is the same for

Bode Ptal: Magnitude Response of Expf-joMo 20

â â

sa. -10
-20 Bocfe Plot: Ptiase Response ot Exp(-]m)/]m

& S

o-eoo
-800

Figure 6.3: Bode-Plot G{jû))H{jcù)

36

The phase margin can be interpreted as the uncertainty in the fairness feedback round trip time delay (i?7T), that the system can tolerate before the active nodes rate, Xj(t) , becomes unstable and start oscillating. The phase margin is at the point that the gain is unity or 0 d B .
Bods Plot: Magnitude Response of Exp(-jo)/io

& &
-1 0

-20

Bode Plot: Phase Response of Exp(-jto)/j©
-147.2 C -147.25 & -147.3 &-147.35 -147.4 -147.45
10

!

!

............................

! ......

i1_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ L ,
10

1

_ _ _ _ _ _ 2_ _ __
10"

© (racyseo)

Figure 6.4: Phase Margin can be interpreted as the uncertainty in the R T T . As it is shown in Figure 5.4 the Phase Margin is 180-147.31= 32.69 degrees. To maintain stability for any delay, it is necessary to make sure that the phase margin is independent of delay and always remains positive. The gain margin can be viewed mostly as the uncertainty in the load level that the system can tolerate. This is represented by RTT and y. (t) . The gain margin of the system is at the point that the phase response is -180°. It is defined as the change in open loop gain, required to make the closed loop system unstable.

37

Bode Plot: Magnitude Response of ExpC-joyi©
-3.916

-3.924
.0.1959 10 .0.1959 10 .0.196 10 .0.1961 10 .0.1962 10

Bode Plot: Phase Response of Exp(-jo)/j©
-178

C-179 £
1 -1 8 0
8

\l

0-181

-182
10"
10

""~

10

© (radfeeo)

Figure 6.5: Gain Margin can be interpreted as uncertainty in the load level, which is caused by RTT a n d /i(t). Remarks 1: As this Figure shows the Gain Margin is -3.92 dB. For the closed loop system to be unstable, the gain margin should be unity (0 dB)
2 0 1

o g (^ Æ x £ ^ ) = Yi jO

0

and
2 0

ZZ: + 2 0 1 o g ^ = 0 , log M
Yi jO

but the gain margin o f

je

is20log =-- 3.92 so ^ j9
2 0 1

o g ^ ^ ^ ^ = +3.92
Yi

and M Z I ,, o^ = , . 5 7 ,
Yi

then the stability criteria is k^RTT
Yi

<1.57.

38

As the only controllable parameter is )t , so

<1.57x Yi RTT

For large R T T and large number of active nodes, the stable status, but very small

needs to be very small to keep the system in

means very slow response to Fairness message and rate change

which is not desirable, so we need to provide a solution that compensates the effect of large R T T .

6.1.3 Fairness Control Model using Smith predictor
The Smith Predictor attempts to remove the effect of the Fairness Feedback iîTT delay from the closed loop system, so that the controller can be designed as if there was no time delay present. The delay-free model is used to generate the output which existed if the RTT delay were absent. This signal is used in the feedback loop instead of the output. Smith predictor uses the estimated R TT to compensate the real round trip time delay. Each node estimates itsi?7T by estimating the time difference between sending a packet and receiving the response.

e

Figure 6 .6 : Fairness Control Model with Smith Predictor The instability of the control system based on the effective output rate includes all the packets passing through the congested node, as well as the packets that are traveling from the active node

39

- PROPERTY OF R Y E R S# m vrnsilYLIBRAny

to the congested node. This traffic is called "in flight" traffic. By our proposed approach, instead of stabilizing the actual output rate, the controller can stabilize the effective output rate at a reference level. Proposition 2: Smith Predictor compensates the effect of round trip time delay from Fairness Control Model feedback loop. Proof: The transfer function of the Smith Predictor controller is Xj{s) ^ _________________ s e(s) j /i

and after some calculation [Appendix A.2], the closed loop transfer function yields as

1+

XiS Figure 6.7 shows how Smith Predictor compensates the delay effect. e(s)

Figure 6.7: Equivalent Model with Smith Predictor in Laplace space This model consists of a first order lag k{s) and a pure delay. This completes the proof.

Remarks 2: The frequency response of the first order lag of Fairness Control equivalent model, k(Jû)) can be shown as

1 Tm +1'

40

where

is the time constant of the Queue Congestion Control and

y'

. The bode plot of

Iç k(ja>) shows that when T co « 1 or co « -- the gain is unity and the phase is zero, X/ selected large enough for fast response to the rate change.

can be

Bocte Plot: Magnitucb Response of 1/QTco+l)
0

1 ! !!!!!!!

! ! i 'T 'T '[
--!---r-r

-10 :::::! : : ,-20
--- - - -!-- --

-r-r-r I ! !

---- ---------------------------------50

· ··III

"hf-üif
10°

· I I · II

I

I

# #######
I I I I II

...... I 1 1 I

· ·

.....

I I I I

_

.Li-LiUii
IQ''

10 ' 0 -20

10'
n r r m ------ r - r r 111 I · · I I I

Bode Plot: Phase Response of 1/QT©+1)
" 7 - ;"7-ît t ;i---------;
iiiiiii I · · II

11

I I

I I #I « I IIIIIII

-I-- r-!-T 11T T --60 -80
-100
10

- - - - - î - - - r - T - r n n ^ * J i - - - - - r - - r -T-

!--!-- r" rH "îÎT"*
! ! ! ! !!!!!
10'

rt I I I I lilt
! ! ! ! ! ÜÜ
10°

-1 -I-1" î-î-î-t--* ·.' ·* * ·`  ·1*11 ·I'M r*
! ! ! ! ÜÜI____I__! !

io'

10°

To (radfeeo)

Figure 6 .8 : When ü) « -- the gain is unity and the phase is zero.
Yi

Remarks 3: Another variable factor in the equivalent model is

· To make sure the response is or x y., this

the same for any number of nodes, A^^can be adjusted as a function of way the closed loop pole would be constant s = -- = k^^
Yi

41

6.2 Fairness and Congestion Control Model
To create the model the focus needs to be on the Secondary Transit Queue (STQ) and a closed loop control based on the occupancy level of the output queue of the congested nodeiî,. STQ is used to buffer the fairness eligible traffic in an RPR node. When congestion is detected and the fairness turns on, the Fairness algorithm tries to control the level of the queue for the congested node Sjto a set point Qr^hy decreasing the traffic sent by the active nodes. Queue Congestion Control can be combined with Fairness Control in the Fairness algorithm.

Active Node

RPR Ring

Congested Node c(t)-R (t)

OÜ
L - RTT,

Figure 6.9: Fairness and Congestion Control model with Smith Predictor

As can be seen from the figure, to control the queue level to a reference point calculated in the active node, then it is multiplied by reference rate to make

,the error is

(t) and added to the fairness control

This means that when the queue level is low the system

increases the fairness reference rate to increase the queue level while achieving a higher bandwidth utilization and when the queue level is too high, the bandwidth utilization would be decreased to get the queue level back to the reference level. This mechanism guarantees queue

42

congestion control and the highest bandwidth utilization possible. This model with Smith predictor shows the best stability even with large number of active nodes and long delay.

Active Node

EPR Ring

Congested Node

^ (0

Figure 6.10: Equivalent of Fairness Control Model with Smith Predictor along with Queue Congestion Control The model for each node in the Laplace domain would be simplified as follows. Aetive Node RPR Ring Congested Node

OH
Figure 6.11: Queue Model from one of the active nodes view

43

& y* where k(s) = ---s +--
Yi

6.2.1 Stability Analysis o f the system with Proportional Controller
The open loop transfer function for the simplified system for Proportional controller kA s) = kA gs ^-RTTs G{s)H{s) = k { s ) x k ^ ^ "9 "

It is desirable that Fairness Control doesn't interfere with Queue Congestion Control.

Proposition 3: There are values of controllable parameters k^ and k ^ , that Fairness Control Model has minimum impact on Queue Congestion Control. Proof: As it is mentioned in section 5.1.2, k^ can be selected large enough so that in normal k situation d) « -- and the gain is unity and the phase is zero or k{j(o) = 1^° . For the Queue
Yi

Congestion Control model a>= -- = k^, where So the criteria would be

is Queue Congestion Control time constant.

k « -^ .
Yi

hi practice a ratio of about j is good enough so

Then the simplified transfer function when active node estimate its round trip time, would be

44

-RTTs

By replacing g = jc o , RTT^ = RTT and RTTco = 0 the open loop would be G(Ja>)H(Jû}) = k^R T Tx e-J 0 jô Using the open loop transfer function, the stability of the closed loop system can be discussed using Bode-Plot or Nyquist. \GU g>)HU co)\ =
,-JO

A G {joe )H U (o) = ^ -- - . J&

6.2.1.1 Nyquist Analysis;
The simplified equation makes all the plots for different RTT s fall on one single curve. Note that Q-JO the curve o f Q-jto is the same a s -----jO ja>
Nyquist Plot of Exp(-jo)/jo
0.8 0.6

0.4
0.2

-

0.2

-0.4
-

0.6

·

0.8

-0.5 Real

0.5

Figure 6.12: Nyquist Plot oî --^'w h ea k^R T T = 1

45

Proposition 4: To guarantee the stability of Queue Congestion Control Model it is necessaiy that
k

7 K ^-- X1 « 2 RTT

.

Proof: In Figure 5.12 the curve crosses the real axis a t

2

n

when k RTT = 1, which is on the

right side of the critical point, -- 1. So the closed loop system is stable for all RTT s that meet the following stability criteria k ,, R T T < -. ® 2
Nyquist Plot of Exp(-jm)/io
0.8
0.6

0.4
0.2

·

0.2

-0.4
-

0.6
0.8

-

-0.5 Real

0.5

Figure 6.13: Nyquist Plot encircles the critical point - 1 , when k^RTT = --

n

To keep the system in the stable area the active node needs to follow the stability criteria, j < --X ^ 1 k,, ' 2 RTT'

Remarks 4: For large R T T , k^ needs to be very small. Small k^ means that the system reaction to the queue is not too fast, which is desirable. So a relatively big k^ and a small can guarantee

a stable system although too big k^ makes the system too sensitive and too small k^ makes the system too slow in controlling the queue level.

46

So the estimated i?7T can be used to adapt

for each active node. About one third is a good .

estimate, while it is at least five time smaller than

, 1 ;r 1 0.4 1 k k,, = --X--X « while k,, < --x -- , ' 4 2 RTT RTT " 5 or

which means k must be less or equal to the smaller one.

47

6.2.2 Steady State Analysis
Proposition 5: Fairness and Congestion Control algorithm guarantees the redistribution of the unutilized bandwidth. Proof: In steady state, when /(/), M {f) and R{f) are stable and stay at constant f respectively then the queue level ^ (0 would he equal values then . If and

and x^are the steady state

and for c =

where in ideal situation the steady state of

is zero. If all the nodes involved in congestion,

needed to be adapted, the steady state traffic rate sent from each node would be c

but because some of the involved nodes have less traffic to send and only/^ nodes are adapted, - f nodes allocate less than the fair share. The difference traffic needs to be distributed to the adapted active nodes. _ _
= ·

c -R , /. M,

(Ms
Is

K

and

M, Also it is known that

I

48

then

(^i)s - y ih

M.

L

{M - I )c This equation shows that the unutilized bandwidth ----------

iî^isdistributedamongthe

active nodes that are adapted. Each node takes its share based on its dynamic weight.

Remarks 5: When all the involved nodes are active nodes, then

and

= 0 so

( 4 )j =X,c, which is what we expect. This equation shows that the traffic added by each active node would be adapted to a fair rate, which is proportional to its dynamic weight. In case of equal static weights.

49

Chapter 7 Simulations
The simulator of MATLAB, Simulink [30] is used to simulate the RPR Fairness and Congestion Control model. As in this thesis the emphasis is on the control theoretic approach to RPR, Simulink is a valuable tool to show the behavior of the system just by simulating the system with standard control theory components. As it is mentioned in delay definition, the propagation delay is the major source of delay in Metropolitan and Wide Area Networks. As the speed of data transfer in fiber optics media is 0.66c or almost2 0 0 0 0 0 Â 7 M/.S, every kilometer of fiber represents 5 //sec forward delay and 10//sec round trip time delay. Also the links are assumed to be OC --12 ( 622Mbps) and the queue size is assumed to be SOOkbyte (2AM bit).

hr the simulations in this chapter, it is assumed that the system is a linear system so the rates are not cut off at the maximum rate of the link. This may not be the same as other simulations methods but it is close enough. The nonlinearity is left as future work.

50

7.1 Existing RPR Fairness linear model
In this section, the focus is on the effect of the link delay and number of active nodes on the fairness. It is assumed that full bandwidth, i2AM bit). 7.1.1 Scenario 1.1 In this scenario it is assumed that at time zero there are two active nodes involved in the congestion that try to send a full traffic through the congested node. Each one millisecond the number of active nodes doubles. Also it is assumed that the distance between the active node and the congested node is 4 At/is o 7^, = 7 ^ , = 2 0 //sec (7(77] =40//sec). As it is mentioned, each node creates a view of the network based on its own traffic and dynamic weight. This way each node can adjust its own traffic. is a step function starting at f = 0. Also c{t) is veiy close to the

= 622Mbpsior example 99%. The queue size is assumed to be SOOkbyte


x1(t)

0.1
1e-4 cref1 kc(t)

--  T fw l Integrator 1/gama(t)

:+
Queue


qft)


Tibi

Figure 7.1: Fairness Control Model viewed by each active node

51

x10

î =2 e

I
i
0 0.01
0.02

0.03

0.04

0.05

0.06

Time (sec)
xlO Queue level q(t)

1.5

0.5
0.01 0,02

0.03

0.04

0.05

0.06

Time (sec) Figure 7.2: (t) and Queue level for Fairness Control Model in case of large number of active nodes and long delay become unstable.

Figure 7.2 shows the simulation result when number of active nodes doubles every 10 ms. For small number of active nodes the system is stable, but when number of active nodes increases the system becomes unstable. In this scenario for / = 32 active nodes, the throughput starts oscillating and there is no packet loss but when number of active nodes increases to / = 64 then the queue overflows and leads to packet loss. When delay is higher, the system becomes unstable with less active nodes. The overall throughput and fairness will suffer by throughput instability. One way to bring the node to stable status is to decrease but small means slow response.

Smith Predictor will compensate the affect of bigiîTT andy^.

52

7.2 Fairness Control model using Smith predictor
7.2.1 Scenario 2.1 In this scenario it is assumed that the distance between the active node and the congested node is 400km so -T p x = 2 msec (i?7T, = 4msec).

X I (t)

c(t)-R(t]

0.1
1e-4 crefi k1(t) Integrator

lUtl

Queue

q(t)

1/gama(t)2 x1(t)3

Tibi

Figure 7.3: Fairness Control Model with Smith Predictor Smith Predictor, predicts the output rate as if there was no delay. Based on this prediction each node adapts its rate.

53

x10

xlW

(j 0)
3

I

I
0
6

o

0.01

0.02

0.03

0.04

0.05

0.06

0.07

0.08

0.09

0.1

Time (sec)
X10 Q ueue level q(t)

I

'
1

"g 1.5

JÎ g

&

0

,=
0

IT
0.01

f
0.02 0.03 0.04 0.05 0.06 0.07 0.08 0.09 0.1

Time (sec) Figure 7.4: x, (f) is adjusted to the fair rate but Queue level is not controlled in the system with just Fairness Control with Smith Predictor. As it is shown in Figure 7.4, even with 100 times more delay comparing to Scenario 2.1, the system is totally stable. With Smith Predictor the system will behave as if there was no delay in the loop. The only delay that is seen is 7 ^ which is out of the feedback loop. This delay can be seen in the queue level figure. It is a pure delay and doesn't affect the stability of the system. Although the fairness is achieved, the queue level is not under control. Any rapid change in the throughput may cause some increase in the queue level.

54

7.3 Fairness and Congestion Control Model
73.1 Scenario 3.1 M this scenario it is assumed that the distance between the active node and the congested node is
2 0 0 0

^7» so 7^, = 7 ^ 1 = 107»sec (727T, =20771 sec). This delay causes the system without

Smith predictor to be totally unstable but with Smith predictor the system is stable. It is assumed that the reference queue length are k = 1 0 0 0 and k = 9 i?7T
=

is one sixth of the queue size. The controllable parameters

20.

Q ref


Integrator 1/gama(t) q(t)

%
RTT1 1/gama(t)1

%
Tfbll

Figure 7.5: Queue Congestion Control and Fairness Control model with Smith Predictor Figure 6.5 shows the model for this scenario. This scenario shows how queue level is controlled by adjusting c^^fbr the Fairness Control. This means that if the queue level is too high the system decreases the overall throughput to control the queue level.

55

o

5 4

x10

5

I
o

3
2
1 0 0

:

0.02

0.04

0.06

0.08

0.1

0.12

0.14

0.16

0.18

0.2

Time (sec)
xlO Queue level q(l)

1.5

0.02

0.04

0.06

0.08

0.12

0.14

0.16

0.18

0.2

Time (sec) Figure 7.6: The Combined Fairness and Congestion Control with smith predictor can achieve fairness and queue control even with large delay. As it is shown in Figure 7.6, this system can achieve a fast fairness while keeping the queue level at one sixth of the queue size. When the queue is more than the reference level, each node sends less traffic so that the overall traffic decreases and queue level goes to the desired level. Each node adapt its controllable parameters dynamically.

56

XlO

cref

3
2

1
0

_____I _____I _____ 1____ 1_____ I _____I _____ I ____ I I
0.02
xIO

0.04

0.06

0.08

0.1
Sigma x(l)

0.12

0.14

0.16

0.18

0.2

7
6

5 4 3
2

1
0 0

0.02

0.04

0.06

0.08

0.1

0.12

0.14

0.16

0.18

0.2

Figure 7.7; The reference rate for Fairness Control system is adjusted by Queue Congestion Control. As it is shown in Figure 7.7, the reference rate for Fairness Control system is adjusted by Queue Congestion Control mechanism. Sigma x{t) is the aggregate traffic sent by all the active nodes to the congested nodes queue. This rate is controlled by the Fairness Control system to the reference rate. If the queue is too high and the packet loss is imminent, the Queue Congestion Control mechanism decreases the reference rate of the Fairness Control.

57

xIO

Queue level qft)

.?
s
g 1.5
1

100

Ji §

O ' 0.5

0.02

0.04

0.06

0.08

0.12

0.14

0.16

0.18

0.2

Time (sec) Figure 7.8: Effect of different on the Queue level when RTT and are constant

In Figure 7.8, the effect of changes in Queue Congestion Control parameter,

on the queue

level is shown. When k^^ is increased the system becomes more unstable. To keep the system in the stability area, k^ must meet the stability criteria. kg which in this case. kg < 2 0 . As it is shown in this figure for kg =100, the queue level becomes unstable and oscillates. For k =10 the system is stable but too slow. The optimum queue control happens when k =20. ' 0.4 K

1

58

7.3.2 Scenario 3.2

In this scenario there are 16 nodes with no delay7^, = 7^, =0/Msec (7(77] =0m sec) between the nodes. The fair rate for each of the 16 nodes would be 38 TlTZyf. =1000.

0(t)1

c(t)

Q u eu es 4Nodeçmilh5 4Nodesmilh1

q(t)

Figure 7.9: 16 active nodes with no delay Each block in this figure consists of four nodes.

OE> Ini

>o

0.1 iniegrator

Outi

OE > In2

OE>

X 3D
Oui3

Figure 7.10: A simple node model with Fairness Control mechanism

The model shown in Figure 7.10, is very similar to the existing RPR Fairness. A smaller k^rmy represent Conservative mode and very high k^ may represent Aggressive mode.

59

XlO

%10

am
xlG

1.5

as

Figure 7.11: Traffic rate x, (t) of an active node, Overall traffic (Sigma ) and Queue dynamic of the congested node in a system with no delay shows that fairness can be achieved. Figure 7.11 shows when there is no delay fairness is achieved while queue is empty. This is an ideal situation.

60

7.3.3 Scenario 3.3

In this scenario there are 16 nodes and the distance between the nodes is 0,2 km so for the closest node to the congested node = 1//sec {RTT^-2 //sec) between each node. In this

scenario the delay for the farthest node isRTT^^ = 16x iîTTj =16x2=32//sec. The fair rate for each of the 16 nodes would be 38 M bps . The controllable parameter is =1000.

cttp

cttp

Ctl)1

C(l)

Figure 7.12:16 active nodes with a fix delay between them Each block in Figure 7.12 consists of four nodes with the same delay between them.

OE > Ini
cref

0.1 Integrator

> Out1 03

o>

X33 Oui3

Figure 7.13: A simple node model with Fairness Control mechanism This model shown in Figure 7.13 is very similar to RPR Conservative mode.

61

x10

xIO

1.5

Figure 7.14: Fairness in a system with short delay can successfully be achieved but queue level increases rapidly. Figure 7.14 shows traffic rate, x^{t) of an active node, Overall traffic (Sigmax(/)) and Queue dynamic of the congested node is shown. Short delay doesn't affect the throughput much but the queue level increases rapidly.

62

7.3.4 Scenario 3.4 In this scenario there are 16 nodes and the distance between the nodes is 1.5 km so for the closest node to the congested node 7^, = 7^, =7.5//sec {RTT^ =15//sec) . The delay for the farthest node isi?7T,g = \6xRTT^ =16x 15=240//sec. The fair rate for each of the 16 nodes would be 38 M bps . The controllable parameter is = 1000.

sigma x(l)

%10

0

0.01

a02
T"

0.03

0.04

a05

0.06

a07

0.08

0.09

0.1

0

0.01

0.02

0.03

a04

0.05

0.06

0.07

0.08

0.09

0.1

X lO ®
2
1.5

T-

q(0

1
0.5

0

0.01

ao2

ao3

ao4

0.05

0.06

0.07

aoo

0.09

0.1

Figure 7.15: Fairness in a system with relatively longer delay is achieved but with some throughput oscillations and queue level increases rapidly. As it is shown in Figure 7.15, longer delay causes the throughput to oscillate but fairness still converges the throughput to the fair rate. The queue level increases rapidly.

63

x1 0
^
2

qW
RTF,

Ji s

>

1.5

! - /

' =2/js
0.5 0.01

&

^iSTTj = 0/Js
0.02 0.03 0.04 0.05 0.06 0.07 0.08 0.09 0.1

Time (sec) Figure 7.16: Effect of RTT^ on the STQ Queue level

As it is shown in Figure 7.16, when delay increases the queue level is increased with no control over it. When delay is zero, the queue level is zero and the system gives service to the received packages promptly. When delay increases the queue level increases for RTT^=2 jusec, the queue level increases to almost 600Kbit and for RTT^ =15 jusec, the queue level is almost 1.3 Mbit. For a high delay this system becomes unstable and packet may be lost. Next scenario shows such a situation.

64

7.3.5 Scenario 3.5 In this scenario there are 16 nodes and the distance between the nodes is 20 km so
7 ^ 1

= 7^, = 100//sec (7(77] =200//sec) between each node. In this scenario the delay for the

farthest node is7?7T,g = 16 x 7(77] =16x 200=3200//sec. The fair rate for each of the 16 nodes would be 3SM bps. The controllable parameter is = 1000.

xIO

a g m a x M

xIO

x ft)
: ! ;

-n

I
0 0.01 0.02 0.03 a04 Q05 0.06 0.07 0.08 0.09 0.1 0 0.01 0.02

j
a03

j
0.04

j
0.05 0.06 a07 0.08

;
a09 0.1

xIO
2
1.5

q(0

1
015

0 , 0

0.01

002

003

004

005

i

006

il

I

007

i

008

003

01

Figure 7.17: Fairness in a system with long delay cannot successfully be achieved. As it is shown in Figure 7.17, long delay causes the throughput sent by each node to oscillate. Because of the nonlinearity of the system it is shown as periods of sending full traffic and periods of shutting down. The queue level is oscillating and packets are lost.

65

7.3.6 Scenario 3.6 In this scenario, it is assumed that there are 16 nodes with smith predictor and the distance between the nodes is 2 0 km so for the closest node to the congested node 7^, = 7^, = 1 0 0 //sec {RTT^ =200//sec) between the nodes. The controllable parameter is = 1000.

oIni >
cref Integrator

>GD Otiti

RTT1

CE> In2

XZO
Out2

Q > In3

->OD Out3

Figure 7.18: A simple node with Fairness control model and Smith Predictor

66

xIO

xIO

xIO

am

Figure 7.19: Traffic rate a:, (0 of an active node. Overall traffic (Sigma ) and Queue dynamic of the congested node when Fairness Control with Smith Predictor is implemented. Figure 7.19 is the result of the simulation. In each node Fairness Control with Smith Predictor is implemented. The delay is large but with smith predictor, the system is stable. Although this system is stable but for faster and smoother transient behavior the Fairness Controller param eterneeds to be adjusted by making it proportional to y.to prevent fi"om the oscillation seen in this figure.

67

7.3.7 Scenario 3.7 In this scenario it is assumed that there are 16 nodes that have Fairness Control with smith predictor and the distance between the nodes is 2Qkm so for the closest node to congested node
^ 1 - ^ 1

=100//sec
X Yi

(i?7T,=200//sec).

The

controllable

parameter

is

k. = c T

= ---- = 62.5 which T is sampling interval y, = -- . \6 16

OE> Ini
cref 0.1/18 1e-4 Integrator kc=kccXgama

Out1

RTT1

1/gama

CO
In2

X IO
Out2

co ins

-OD
Oul3

Figure 7.20: A simple node model with Fairness Control and Smith Predictor and adjusted parameter

68

% 10
T

sigma x(0 1 ----------1 --------- 1 --------- 1 --------- 1 --------- 1 --------- 1 --------- r-

xio

x W

0

am

ao 2

ara

ao4

ao5
q(0

Q06
"I

ao7

ao8

ao9

qi

am

ao2

aoa

ao4

aos

aos

ao7

aoo

aoe

ai

«10®T ----- 1 ------1 ------1 -2
1.5 1

1 --------- 1 --------- r-

as

0 .

am

ao2

ao3

ao4

aos

aoe

ao7

aoe

aos

ai

Figure 7.21: traffic rate Xj (t) of an active node, Overall traffic (Sigma x(^) ) and Queue dynamic of the congested node when the controller parameter is adjusted Figure 7.21 shows the result of Fairness Control model. In each node Fairness Control with Smith Predictor is implemented. Also in this scenario the Fairness Controller parameter by making it proportional to is adjusted

. This is done to compensate the effect of the number of active

nodes on the Fairness Control. This shows a very smooth transient behavior.

69

7.3.8 Scenario 3.8 In this scenario, 16 nodes are shown with Smith Predictor and Queue Congestion Control. The distance between the nodes is 20 km =Tjbi =100 JU sec C so for the closest node to congested node The controllable parameters are

(i?7T,=200//sec).

J, X-- jg = 62.5and k,, , =

which is adapted by each node.

d>

K 3D
Outi cref 0.1/16 1e-4 kc(t) Integrator

I n lr -

RTT1

1/gama

OE>
In2 0.4 Qref kq(t)1

  C O
Oul2

*<3D
In3
O uts

Figure 7.22: A simple node model with Fairness and Congestion Control with Smith Predictor

70

7 G 5 4 3

xIO

xIO

2 1 0 0
xIO 0.01 0.02 0.03 a04 0.05 0.06 Q07 0.00 QOS 01

q B )

2
1.5

1
0.5 0, 0.01 0.02 0.03 0.04 0.05 0.06 0.07 ttOO 0.09 0.1

Figure 7.23: traffic vatex^ (t) of an active node, Overall traffic (Sigma ) and Queue dynamic of the congested node, show how Fairness and Queue level control are achieved when controller parameters are adjusted. Figure 7.23 and Figure 6.24 show the result of both Fairness and Queue congestion control. In each node Fairness Control with Smith Predictor is implemented. The Controller parameter is

a proportional to y. to compensate the affect of the number of active nodes. Also for the Queue Congestion Control an adapted proportional controller is implemented and the controller parameter but
xIO

is reversely proportional to R T T , to meet the stability criteria. The delay is large smith predictor the system achieves
xIO

with

fairness

and

queue

control.

xIO

1.5

a5
am

Figure 7.24: The system response when k =

0.4 RTT

71

7.3.9 Scenario 3.9 This scenario is the same as Scenario 2.7 but it is simulated in the discrete time domain. In this scenario, 16 nodes are shown with Smith Predictor and Queue Congestion Control. The sampling time is T = 100//sec and the distance between the nodes is 20 km so for the closest node to congested node has a delay equal to unit delay 7^, = 7^, = T = The controllable parameters are k. = c = 7, x -- 16 = 62.5 and k,, 9 node. OE>
0.1/10 1*^ T zy1

1 0 0

// sec ( RTT^ = 2 0 0 // sec). which is adapted by each

kcfz)

Di*cnim-Tim# hltgmlor

Q>
1W >$* T OE> m 3
0.1

-#<2 D

r t

-K 3 D

Out3

Figure 7.25: The closest node to the congested node with Fairness and Congestion Control with Smith Predictor 0mi3
L .kctz)

MO uti 3
k c b ) D i* c m m .T im e
mtagraior

CM syl SCMey14 CM«y133ttlayXM9y1 tM aylC M ayO DciayGMayTDclayO [ M a y S M ^ 0 « l^ 3 M a y 2 M t ^ l Delay

ly M A am > 2

z

z rn 1 1 1 1 1 1 1 1 1 1 2 2 4444- 4- 4 4- 44- 44z Z Z z z * * *

4-

4-

4-

4-

4-

4-

z

4-

4-

z

4-

1

4-

4-

4-

n

-KOutZ 2 D
-K 3 D

<s>

Out3

Figure 7.26: The furthest node to the congested node with Fairness and Congestion Control with Smith Predictor with RTT^^ = 32T

72

«10

«10

«10

1.5

as

Figure 7.27: Discrete time domain simulation shows that Fairness and Queue level control are achieved. In each node Fairness Control with Smith Predictor is implemented. The Controller parameter is a proportional to to compensate the affect of the number of active nodes. Also for the

Queue Congestion Control an adapted proportional controller is implemented and the controller k parameter k for the closest 8 nodes is---- and for the rest is reversely proportional XoRTT, to % meet the stability criteria. The delay is large but with smith predictor the system achieves the fairness and queue control.

73

7.4 OPNET and MATLAB Simulation: Comparison
In this work a theoretical control model is developed for RPR fairness. MATLAB is used to simulate the existing and the controlled model. The model is compared with the RPR OPNET models such as Gandolf and SRP. Although OPNET models are nonlinear and more complicated while MATLAB models are linear and simple but they both show the trend of how delay and number of active nodes affect the throughput and performance. The main problem that will be addressed here is the delay. When delay is increased the throughput becomes unstable especially when the number of active nodes is large.

600,000.000 0) 500,000,000 400,000,000 300,000,000 200,000,000 100,000,000
node 1

1
©
J5

1 h
H

O s

I

0.2s

I

0.4s

0.6s

I

0.8s

1.0s

Time (sec)

Figure 7.28: SRP OPNET result of 15 active nodes with 7ms delay between every two nodes. Throughput oscillates in RPR Conservative (SRP), when delay is high. Figure 7.28 shows the simulation result of a scenario, in which 15 SRP nodes send traffic to node 16. As it is shown in the above figure, in SRP the overall throughput is less than the available bandwidth because the fairness algorithm is not effective enough. Also even with a conservative type of fairness, throughput oscillates for high number of nodes and long delay.

74

M t

flû
node 4

\
) 3Ï)
---- -- "T

j

ig g g W Y 1 Ne I

KS

m x fc V

1.15 i \--

k_12

iK x te JS

! TX

Figure 7.29: RPR Conservative (SRP) Ring in a WAN Figure 7.29 shows that the ring spans in a WAN. In this scenario 16 SRP nodes are spread over a large ring with about 700km distance between any node pair. This is a sample scenario of an RPR ring as a Wide Area Network (WAN). Here, the throughput comparison of RPR Conservative (Gandolf) and Aggressive is performed in the same scenario.

x(l)
80,000,000 70,000,000

Aggressive

I
s
0

>

50.000Æ00 40,000,000

I
u H

20,000,000

Conservative
Time (sec)

Figure 7.30: OPNET simulation shows the throughput in Conservative (Gandolf) versus Aggressive when RTT delay is zero.

75

Figure 7.30 shows how throughput in Aggressive mode oscillates around the fair rate even in short delay. In case of high delay the oscillation is even more. In Conservative mode throughput performance is relatively good when delay is short. When delay is increased, the throughput for conservative becomes more unstable too. In high delay scenario the throughput in both Aggressive and Conservative will oscillate.

x(t)
100.000.000
90.000.000 80.000.000 70.000.000 80.000.000 50.000.000 40.000.000 30.000.000
2 0 0 0 0 .0 0 0

RTT=7 ms
llfl /

I
I H

I

.

10,000,000
0

RTT=0 ms

Time (sec)

Figure 7.31: OPNET simulation shows that the throughput Oscillates in RPR Conservative (Gandolf) too, when delay is high. Figure 7.31 shows how RPR Conservative mode becomes oscillatory when delay is increased. In this scenario the delay between any two nodes is almost 7 ms for the distance of 700km . The Throughput oscillation for RPR Aggressive mode is more than Conservative, when delay is high.

76

The equivalent MATLAB simulation result is as follows.

20

xIO

15

I o

10

:ec

I

5
0

0

0.002 0.004 0.006 0.008

0.01

0.012 0.014 0.016 0.018

0.02

Time (sec) Figure 7.32; Throughput oscillates in RPR Conservative when delay is increased.(MATLAB Simulation) Figure 7.32 shows three different situations. The RTT between each two nodes are zero, 15 //sec and 60 //sec. When delay increases from zero to 15//sec, the throughput starts to oscillate but it is temporary and the steady state is the fair rate. For a delay of 60//sec , throughput becomes unstable and it oscillates.
6

ia T i= e a m 'e c ''

J5//sec : yJ?77i=0/isec
0 0.002 0.004 0.006 0.008 0.01 0.012 0.014 0.016 0.018 0.02

Time (sec) Figure 7.33: Queue level is increased and become unstable in RPR Conservative when delay is increased. (MATLAB Simulation) As it is shown in Figure 7.33, increase of the RTT delay causes increase in queue level also oscillation in throughput for RTT delay of 60//sec leads to instability and overflowing of the congested queue which causes packet loss.

77

o O ) M

20

xlO

I
e

15
10

I
o

i

5
0

0

0.002 0.004 0.006 0.008

0.01

0.012 0.014 0.018 0.018

0.02

Time (sec) Figure 7.34: Simulation shows that RPR with Queue Congestion and Fairness Control makes the system stable so that Throughput won't oscillate even when delay is high. (MATLAB Simulation) As it is shown in Figure 7.34 the system with RPR Queue Congestion and Fairness control becomes stable even with long delays. This effect improves the overall throughput performance by removing oscillation, when number of active nodes is large. As this system compensates the effect of the delay it is almost independent of the delay when this delay is estimated correctly.

xIO

qW
1

?2 s 1.5 i 1 0.5 &

-

--

V

L ' \

'

' ·

\.

1

! ..

0

0.002 0.004 0.006 0.008

_ i

;

L ---------- ------ 1----- -1

r

J j i. . . . h . . . . i. . . . . . / ; i _
..................... : ................. .................. 1 1

..

..

0.01

0.012 0.014 0.016 0.018

0.02

Time (sec) Figure 7.35: Queue level becomes stable when Queue Congestion Control is implemented. (MATLAB Simulation) Figure 7.35 shows the queue level. The queue level can be stabilized on any predetermined level. The queue control parameter needs to be assigned properly to optimize the queue control

speed. To show the steady state queue level this figure needs to be shown with a new scale.

78

xlO

q(0

jlP V V I; 1 /V V î 9 î 5 î S î 7 ? 'i ! ^ 'l 'I l (r` V IJ f V V \i V V 11; / V u V V ''I ï V ï 'J V il 11*^V il 't 9 il V ï 'i ' 'J V V l l f

s
>
1

2

'iR7?^=dOiiùsêc

« 1.5

O ) :

1

0

0.01

0.02

0.03

0.04

0.05

0.06

0.07

0.08

0.09

0.1

Time (sec)
F igure 7.36: Queue level rises slowly and is controlled to a predetermined level (MATLAB Simulation) Figure 7.36 is the same as the previous one with another scale. As it is shown the level o f the queue is controlled on the predetermined level. This level is set based on the needs on the network. In RPR an acceptable STQ level is between one eight to one fourth o f the STQ size. In this scenario it is assigned as one sixth o f the STQ size. By selecting an STQ size o f 300KB this size is 50KB or OAMbit.

79

Chapter 8 Implementation
The scope of this thesis is mainly analysis the behavior of the current RPR fairness by fluid flow and linear approximations in continuous time domain and introducing our own proposed Fairness and Congestion control model but for Implementation some considerations need to be addressed. Fluid flow, continuous time and linear approximations have their own implementation limitations so in this chapter we go over some considerations need to be done to implement such a model in the real world which is packet based, discrete and nonlinear. When congestion is detected and the fairness turns on, two major adaptation needs to be done. First all active nodes need to adapt their traffic to a fair rate. At the same time if the level of the congested queue is too high it needs to be controlled and set to a set point traffic sent by the active nodes. by decreasing the

8.1 Congested Node
To implement the model the focus needs to be on the traffic rate received by the congested node and the Secondary Transit Queue (STQ) of the congested node. STQ is used to buffer the fairness eligible traffic in an RPR node. When congested node goes to fairness mode, the congested node sends the feedback information to the active nodes by sending fairness feedback message. Congested node is an active node itself so it starts adapting its own rate to the fair rate too. The feedback information consists of the received traffic rate, the occupancy level of its queue, the sum of the weights of the active nodes 80

and number of active nodes. Each active node then, calculates its own target rate based on the received information.

8.2 Fairness Packet
Fairness packet contains:
/
1

) Traffic rate received by the congested node, ^ J C ,. (t) + R(t) (including its own traffic)
1=1

2) Occupancy level of the congested queue , g ( t ) 3) Number of active nodes,/(/) 4) Overall weight of all the active nodes, .

5) The fair rate calculated by the congested node. These information then are used by the active nodes for their adaptation. When an active node receives a fairness packet it reads the information and corrects its own rate based on these information.

8.3 Fairness Traffic Adaptation
/

The value of
1=1

(0 + R(t) is sent to active nodes by the Congested node. This value, then, is by active nodes to find the error e(f). Then it is multiplied to (/) = .

compared with

k^ is the controllable parameter of the Fairness Control. It shows how fast the adaptation of traffic rate is. A smaller k^ may represent more Conservative mode and very high k^ may represent less Conservative behavior.

The result is «,(/) which is used to correct XfQ) . In steady state, error and «,(/) become zero and traffic rate becomes stable. In the discrete time domain the integrator can be shown as follows.
X i{k) = x , { k - \ ) + u .{k ),

81

or
X i(k)

= X j (^ - 1 )+k^e(k).

In every sampling interval the traffic rate is corrected and in the steady state it stays in the fair rate, along with /(/), is used by each active node to calculate its own dynamic weight

o, ------. This dynamic weight is used for traffic rate adaptation. /i = -- M = I

8.3.1 Smith Predictor
Smith Predictor attempts to compensate the effect of the Fairness Feedback/Î7T delay from the closed loop system. Smith predictor uses the estimated RTT to compensate the real round trip time delay. Each node estimates its Fairness Feedback RTT by estimating the time difference between sending a packet and receiving the response. The active node has a table that keeps the information about how much traffic it has sent in the past. After estimation of R TT, this table is used to find the traffic sent during the last R T T .

8.4 Queue Congestion Control
The average level of the congested Queue level needs to be controlled. If the average level is too high then it must be decreased. When congestion is detected and the fairness turns on, the Fairness algorithm tries to control the level of the queue for the congested node Sj to a set point by decreasing the traffic sent by the active nodes. This is done by decreasing the Fairness Control. This means that traffic rate of all the active nodes are be decreased. The average queue level needs to adapt to a predetermined level. This level is set based on the needs on the network. In RPR draft an acceptable STQ level is between one eight to one fourth of the STQ size. A practical reference level could be one sixth of the STQ size. In practice STQ size in many implementation is 300KB so the queue reference level would be 50KB . for

82

Chapter 9 Conclusions
Link delay and number of active nodes have a great impact on the stability of the RPR Fairness algorithm. The queue level occupancy may show oscillation and instability when Link delay and number of active nodes are significant but there is not enough theoretical analysis to discuss this behavior. The present work is the first theoretical analysis of the RPR Fairness algorithm using control theory. Our contribution to RPR is developing a new dynamic model for RPR Fairness and Congestion Control algorithm based on the control theory. Simulation, theoretical analysis, and comparison are employed to explore the effects of different controllers on the closed loop system behavior. In this thesis RPR Fairness algorithm is described in the congestion domain as a distributed system which its characteristics varies from time to time because of the number of active nodes. Then it is mapped to a classic control system. A Congestion and Fairness Control Model is proposed and analyzed. Time delay analysis was used to describe how the system behaves when the delay is significant. Smith Predictor is proposed to compensate the round trip time delay. Our model is a dynamic model which shows excellent stability even with large number of active nodes and long delays. Each active node estimates its round trip time and compensates the ring delay so that the ring delay won't affect the nodes rate. Also the active nodes will tune the controller parameters dynamically based on their received information from the congested node. By tuning these configurable parameters, the model can make the system independent to RPR internal parameters and in case of any unpredicted disturbance, the system always stays in the stable state.

83

Future Works
In this thesis we focused on single-chocked fairness. The next challenge would be working on the Multi-chock point problem and making its control theoretical model. Also we assumed that the system is working in the linear area. We will need to analyze the nonlinearity of the system. The model needs to be extended to the discrete time domain and implementation challenges need to be addressed. Implementing this model in OPNET simulator is another future work that would give the opportunity to compare the behavior of this model with the existing RPR models simulated with OPNET.

84

Appendix A
A.I. Classic Controllers
As in the real implementation, RPR Fairness algorithm works in a discrete time domain here it is shown how to convert continues classic controller to discrete form. This is the equation of a Proportional, Integrated and Derivative (PID) controller:

u{t) = K The equivalent in Laplace domain is: /

Laplace transfer function is

î"+-î+- ` T, T J, e{s)

Using the system backward difference approximation for integration and differentiation, the transfer function of a discrete PID controller can be written as: K ( z) = ! ^ = K ,, ^ L _ + I k ( £ z i ) e(z) t; ( 2 - i ) tz

85

r
2

r
T

^ Z/ / z (z -l)
-Z

iT A

r.

K {z)^ K

PID controller
Continues PID transfer function is

s Discrete PID transfer function is K{z) = + ^ 2 ^ + -^3 z (z -l)

Converting it into difference equation

u{k) = u(k - 1 ) + Aie(k) + A 2 e(k - 1 ) + Aje(k - 2 ).

PI controller
Continues PI transfer can be obtained from the PID transfer function, when a, = 0. k(s) = a^s + « 3

In case of a Discrete PI controller, we have Tj =0 so Aj =0 and the transfer function would be K (z) = A^Z^+A2Z z (z -l) ^,Z + ^2 z-1

PI controller can be simulated as follows. The difference equation is

86

u{k) = u{k - 1 ) +

+ A 2 e{k - 1 ).

P controller
Proportional controller is the simplest form of controller and it is used in our paper. In continues

--C I2 --K . In Discrete case K (z) = The difference equation is u(k) = u(k - 1 ) + , AjZ z(z - 1 ) z-1

A.2. Smith Predictor
Smith Predictor compensates the Round Trip Time delay by estimating it. Active Node ! RPR j Ring Congested Node

e(s) k(s)

u(s)

G(s)

Figure A.1: Delay compensation by Smith Predictor To compensate the delay, the active node can subtract the feedback by its estimated value. So

87

d{s) = u{s)e~^'^G{s)e'^^ -u{s)G {s)e-''^`^ +u{s)G{s), d{s) = u{s)G{s)e~^'^^^^^^` -u{s)G {s)e-`'^ `^ +u{s)G{,s), and d{s) = u{s)G{s)e~''^^ - u{s)G{s)e-'^^'^ + u{s)G{s). When the estimated Round Trip Time, RTT^ is equal to the real R T T , then

d{s) = u{s)G{s){e~^^^ so d{s) = u(s)G (s).

+ u{s)G{s),

This way the active node removes the delay from the loop as if there were no delay. This is another view of Smith predictor: Active Node RPR Ring Congested Node

e(s)

u(s)

G (s)

Figure A.2: Smith Predictor The transfer function of the Smith Predictor controller is:

«W e(s) And

W ______ l + A (s)G(s)(l-e-'^^`^)

g(-y) = G(s)e~''^ u(s)

88

So the open loop transfer function will be:

G'(5) =

- * Q --' (j{s)

H \s)

Figure A3: The simplified model And
H \s) =

When the estimated Round Trip Time, RTT^ is very close to the real RTT for the node, the closed loop function is: G 'W ^ k{s)G{s) \ + G \s ) H \s ) l + ^(j)G W

This transfer function is equivalent to the transfer function of the following diagram:

u(s)

q(s)

G(s)

Figure A.4: Equivalent model with Smith Predictor in Laplace space As we see the delay system is equal to a pure closed loop system, in cascade with a pure delay. This means that change in delay won't affect the stability of the system.

89

Appendix B Scenarios
Here the OPNET Simulation of two major implementations of the conservative Fairness, SRP and Gandolf are compared. SRP This is a 4 node scenario that Node l, 2,3 and 4 send 622 Mbps ClassC traffic to node Oat 0.0, 0.1, 0.2 and 0.3 Sec. Packet size is 1200 with Dual Queue implementation. The traffic is sent to the Outer Ring and node l is the congested node
SKP.Ddtd îidllic Souiceü Ibits/secl

Figure B.l; SRP implementation of Fairness is fast with some transient oscillation.

90

SRP implementation of fairness is fast but but with some transient oscillation. Gandolf As we see Gandolf is more conservative than SRP, therefore, more stable with no oscillation.
^RPFIM A C - Tiaffic.Dâla Ttaflic Souiceii (b ils/se c |

Figure B.2: Gandolf implementation of Fairness is much more conservative, stable but slow. The conservative mode is shown in the Gandolf model which the congested node decreases its rate to a level less than the fair rate to compensate the slow response of the fairness mode. When the fairness is too slow, the active nodes cannot response to the congestion fast enough so the congested node has to decrease its rate somehow that the extra traffic is compensated. This will cause a non fair rate because the congested node will suffer. If the system is too conservative and the extra traffic is more than the congested node then, congested node will decrease to zero which is not desirable at all. Gandolf model is stable but the bandwidth utilization is poor. In cases of too many nodes the congested node may suffer.

91

Bibliography
[1] An Introduction to Resilient Packet Ring Technology, RPR Alliance, www.rpralliance.org [2] IEEE Draft 802.17/D2.2., www.grouper.ieee.org/groups/802/17/. IEEE802.17 official web site, April 9,2003. [3] D. Tesiang. ''The Cisco SRP MAC layer Protocol' http://www.apps.ietf.org/rfc/rfc2892.html. [4] OpTera Packet Edge System/RPR Technology, www.nortelnetworks.com [5] F. Hanell, "Global Optical Communications- Market Overview", VP Marketing, Dynarc AB [6 ] H. R. Van As, Vienna University of Technology, "Cyclic Demand Advertisement boosts, RPR MAC Performance", IEEE802.17 web site, www.grouper.ieee.org/groups/802/17/, 2002. [7] S. Gjessing, Simula Research Laboratory, University of Oslo, Norway, " A fairness Algorithm for High-speed Networks based on a Resilient Packet Ring Architecture", in Proc. to Workshop on Communication Architecture for Clusters-CAC'02, IEEE802.7 web site. [8 ] D.A. Schupke, Munich University of Technology "A Throughput Study o f RPR Networks Subject Single Failures", Citeseer.nj.nec.com/359755.html, 2002. [9] V. Gambiroza, Y. Liu, P. Yuan, and E. Knightly, Rice University, USA., "High performance Fair Bandwidth Allocation for Resilient Packet Rings", In Proc. of the 15* TTC Specialist Seminar on Internet Traffic Engineering and Traffic Management, Wurzburg, Germany, 2002. [10] Fenjie Yuan. Carlton University, "Performance Analysis for Resilience Packet Ring With single transit buffer", IEEE802.17 web site, www.grouper.ieee.org/groups/802/17/. [11] S. Mascolo, " Congestion control in high-speed communication networks", Automatica, Vol 35, PP. 1921-31, March 1999. [12] C.V. Hollot, V Misra, University of Massachusettes, Amherst, " A Control Theoretical Analysis of RED", Pages 1510-1519, INFOCOMM, 2001. [13] P. Narvaez, K. Y. Siu,, d'Arbeloff Laboratories for Information Systems & Technology, MIT, "Design of Feedback Control AlgorithmsforABR Service in ATM", Tech. Report 11/96.

92

[14] G. Anastasil, L. Lenzini, M. La Porta, Y. Ofek, University of Pisa, Dept, of Information Engineering, "Dynamic Max-Min Fairness in Ring Networks", Cluster Computing Vol. 3, pp. 215-230,2000. [15] D. Rosu, K. Schwan, S. Yalamanchili, and R. Jha. "On Adaptive Resource Allocation for Complex Real-Time Applications". 18th IEEE Real-Time System Symposium, pp 320-329, 1997. [16] F. Paganini, Z. Wang, J. C. Doyle and S. H. Low, UCLA, "Congestion Control for high performance, Stability and Fairness in general networks". In Proc. to lEEE/ACM Transaction on Networking, 2004. [17] Z. Wang, F. Paganini, UCLA, "Global Stability with Time-Delay in Network Congestion ControF, IEEE Conf. on Decision and Control, Las Vegas, NV, 2002. [18] B. Li, K. Nahrtedt. University of Illinois, "A Control Theoretical Model for Quality of Service Adaptations", lEEE/IFIP International Workshop on Quality of Service (IWQoS), (Napa, CA, USA) May 1998. [19] I. Papadimitriou, G. Mavromatis, Stanford University, "Stability o f Congestion Control Algorithms using Control Theory with an application ofXCP", 384Y Project, June 5,2003 [20] G. Virmicombe, University of Cambridge, "On Stability of Networks Operating TCP-Like Congestion ControF, In 15'*' IFAC World Congress on Automatic Control, Barcelona, Spain,
2002.

[21] D. Katabi, M. Handley and C. Rohrs, MTT, "Internet Congestion Control for Future High Bandwidth-Delay Product Environments " , ACM SIGCOMM, 2002. [22] S. Chong, R. Nagarajan, Y. Wang, Sogang University, Seoul, South Korea. "Designing Stable ABR flow Control with rate feedback and open-loop control: first-order control case". Performance Evaluation 34: 189-206,1998. [23] B. Ataslar, P.-F Quet, A. Iftar, S. Kalyanaraman, Rensselaer Polytechnic Institute, Tory, USA, "Robust Rate-Based Flow Controllers for High-Speed Networks: The Case o f Uncertain Time-Varying Multiple Time-delays"An Proc. ACC, Pages 2804--2808, Chicago, IL, 2000. [24] D. Cavendish, S. Mascolo and M. Gerla, "SP-EPRCA: an ATM Rate Based Congestion Conrol Scheme based on a Smith Predictor". Technical report UCLA, 1997. [25] S. Mascolo, Plitecnico di Bari, Italy, "Smith' s Principle for Congestion Control in High Speed ATM Networks", In Proc. of 36* Conference on Decision and Control, pp. 4595--4600, Dec 1997. [26] O. Smith. " A Controller to Overcome the Dead Time", ISA Journal, Vol 6 , No 2, Feb 1959. [27] K. J. Astorm, "Computer Controlled Systems", Prantice Hall 1997. [28] G. Franklin and J. Powell. "Digital Control o f Dynamic systems". Addison-Welsely 1981.

93

[29] D. Bertsekas and R. Gallager, Data Networks, Prentice Hall, 1987. [30] Mathworks, Inc., MatLab, RI 1, http://www.mathworks.com/

94

