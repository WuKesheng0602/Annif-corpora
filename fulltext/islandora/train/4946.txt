MICROGRID SYSTEM INCLUDING PV GENERATION AND HYBRID BACKUP SYSTEM
BY

Hooman Samani, Bachelor of Electrical Engineering, Ryerson University, 2013

A thesis

presented to Ryerson University

in partial fulfillment of the

requirements for the degree of

Master of Applied Science

In the program of

Electrical and Computer Engineering

Toronto, Ontario, Canada, 2016 ©(Hooman Samani) 2016

AUTHOR'S DECLARATION

AUTHOR'S DECLARATION FOR ELECTRONIC SUBMISSION OF A THESIS

I hereby declare that I am the sole author of this thesis. This is a true copy of the thesis, including any required final revisions as accepted by my examiners. I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research. I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research. I understand that my thesis may be made electronically available to the public.

ii

MICROGRID SYSTEM INCLUDING PV GENERATION AND HYBRID BACKUP SYSTEM
Master of Applied Science, 2016 Hooman Samani Electrical and Computer Engineering Ryerson University

Abstract
This Master's thesis project introduces a micro-grid system that includes a hybrid power storage backup system and photovoltaic module power generation system, which is connected to the grid and supports the hybrid backup system. The first section presents a solution or algorithm to an existing problem in an energy flow management strategy for the hybrid energy storage system. In the second section, power is provided from the photovoltaic arrays by the convenience of the Maximum Power Point Tracking (MPPT) for each photovoltaic module. The generated power will charge the storage backup system. The micro-grid is capable of selling the surplus power to the utility grid. A master controller optimizes integration, dispatching and control over the whole micro-grid operation. There have been many different control strategies and topologies presented over the years to manage the energy flow for hybrid energy storage systems; however, there are some aspects that differentiate some from others, such as real-time prediction, cumbersome architecture, full spectrum control over recourses, and cost-effectiveness. The first section of this thesis proposes a control strategy on hybrid energy storage systems based on fundamental electrical principles. The low volume and simple algorithm make the controller easy to perform on the embedded systems and quickly responds within a tiny space. The control strategy is equipped with a load prediction method, which provides a fast response at the time of load current surge. The controller architect provides the full control over all the resources. The presented controller is cost-effective by increasing the battery life and by minimizing the power loss in the hybrid storage backup system. The simulation results in two different experiments validate the efficiency and performance of the offered control strategy for hybrid backup system.
iii

TABLE OF CONTENTS
Author's declaration .........................................................................ii Abstract ......................................................................................iii List of acronyms .............................................................................vi Chapter 1 Introduction ............................................................................................................1 A. Battery..............................................................................................................5 B. Supercapacitor...................................................................................................9 Chapter 2 2.1 2.2 Related Work and Objectives ...........................................................................18 Existing Energy Management Systems for Power Storage .................................18 Proposed Contribution Aspects on the State-of-Art ............................................32

Chapter 3 3.1 3.2

Theory of the Energy Flow Management Algorithm ......................................34 Notations and Assumptions..................................................................................34 Definition of the Problem One and Two ..............................................................35 A. Theory of Problem one (Prediction-Opt)........................................................35 B. Computation of the Reference Value .....................................................36

C. Theory of Problem Two (Smoothing-Opt).....................................................38 D. Optimization of Current Flow .......................................................................39 3.3 Solution of the Problem One ................................................................................41 A. Preparing the Main Objective Function ..........................................................41 B. Usage of the Lagrange Function to Solve the System of Nonlinear.................42

3.4

Further Improvement Based on Predicted data...................................................45

3.5

Future Load Profile ..............................................................................................48

3.6

Solution of the Problem Two (optimization) .......................................................54 A. Substitution and Generating the Main Objective Function ............................54 B. The Modified Optimization .............................................................................57
iv

Chapter 4 Theory of PV Modules Power Generation.........................................................60 4.1 4.2 4.3 4.4 4.5 4.6 4.7 4.8 Solar Photovoltaic System Modeling and Simulation ..........................................60 Boost (Step-up) DC/DC Convertor ......................................................................62 PV Modules (PV Array with DC/DC and MPPT Controller) .............................63 Cascading the PV Modules and Fixing the Voltage .............................................64 Connecting the PV Module Cascade's Package in Parallel ..................................64 The Grid.................................................................................................................65 PLL (Phase Lock Loop) ........................................................................................65 Active Filter ..........................................................................................................66

Chapter 5 5.1 5.2 5.3 5.4 5.5 5.6 5.7 5.8 5.9 5.10

Numerical Results and System Simulation......................................................68 Solar Photovoltaic Array Modeling and Simulation............................................68 Boost, (Step-Up) DC/DC Convertor Model.........................................................69 PV Modules Model..............................................................................................70 Cascading the PV Modules and Fixing the Voltage Model................................71 Connecting the PV Module Cascade's Package in Parallel Model.....................73 Modeling of the Grid...........................................................................................74 PLL (Phase Lock Loop) Model...........................................................................75 Active Filter Model..............................................................................................77 The Controller Model and Simulation.................................................................81 Microgrid (Smart-Home) Model and Simulation...............................................83

Chapter 6

A. Parameter Analyzes.........................................................................................88 B. Evaluation and Comparison of proposed method............................................90

Chapter 7

Conclusion.............................................................................................................92

Appendix A ...............................................................................................................................94 References ..............................................................................................................................117

v

List of Acronyms, Abbreviations, and Notations
Acronyms
NAC NMC LMO LEP LCO NMH DOD PV FC UC MPPT LPC HESS EFMS PVPGU SOC EMS DOH FCS SCS MCS EV FW DG ES ESE

Meaning
Lithium-Nickel-Cobalt-Aluminum Lithium-Nickel-Manganese-Cobalt Lithium-Manganese-Spinel Lithium-Iron-Phosphate Lithium-Cobalt-Oxide Nickel-Metal-Hybrid Depth of Discharge Photo-Voltaic Fuel Cell Ultracapacitor Maximum Power Point Tracking Linear Prediction Coefficient Hybrid Energy Storage System Energy Flow Management System Photovoltaic Power Generation State of Charge Energy Management System Degree of Hybridization Fuel Cell System Supercapacitor System Maximal Control Structure Electric Vehicle Fly Wheel Diesel Generator Energy Storage Energy Storage Element

Page
05 05 05 05 05 07 08 09 09 09 09 14 12 15 15 15 16 16 21 21 25 25 25 25 26 29

vi

Chapter 1

INTRODUCTION

T

HE

high cost of electricity being charged by the utility grid to consumers, in addition to the

energy crisis and dependence on imported fossil fuels, have forced a transition from fossil

fuel-based electricity to electricity from renewable and alternative sources. Around the world each year, power outages of the utility grid network have resulted in huge revenue losses. Gas price fluctuations are yet another current problem. The grid utility networks deliver their power across millions of miles resulting in huge losses and expenses on the shoulders of those who remain tied to the power lines. There are other problems with this system, such as power quality, efficiency and reliability. Researchers have focused on reducing electricity costs through innovating and upgrading the optimal micro-grid configuration. Micro-grids could become a portion of a power distribution network that is located at the downstream.

The aging of the power utility infrastructure and the rise in electricity demand is due to the rapid pace of population growth. At the same time, the industry's environmental footprint has become a serious concern for governments. The world has become increasingly dependent on imported fossil fuels and has resulted in poor reliability and correspondingly high electricity costs and pollution. However, there is a shift taking place within the power sector. Energy innovation and upgrades can alleviate the current challenges and create cost-effective alternatives to the distribution feeder. Smart, micro-grid technologies can enable conservation, increase operational efficiency, security, and result in higher quality and reliability of power delivery.

There are a number of value propositions available by engaging with these systems. Efficiency increases by reducing fuel consumption and minimizing distribution losses by supplying power close to the demand. Reliability improves by managing optimal on-site energy resources and power quality at the local level. In addition, these systems ensure energy security by utilizing

1

critical loads supplied on-site and the capability to be independent from the grid network. Sustainability is another outcome of these systems by reducing the carbon footprint of power generation due to the use of green or renewable resources. Effective energy management and onsite generation of these systems will result in economic savings. In addition, micro-grids offer more significant advantages such as the best supply-and-demand matching and optimized usage of green power sources. Prioritizing the power supply for crucial demands is yet another advantage for local micro-grid alternatives. For example, the micro-grid master control could prioritize supply to medical emergency demands instead of the vending machine on the site.

Today, the micro-grid consists of some major components like the master controller which optimizes integration, control, dispatching, and maintains reliability. Fault protection and realtime response. Predicting, forecasting analyzes, grid connection, and disconnection decision making. Monitor real-time network status. Demand response capability and electricity pricing, including distributed generation, and energy storage devices. Utility and energy market continuous communication.

2

Figure 1-1: An illustration of the evolution of the grid network from the past to the future. As shown, the energy shift will happen from the network grid to the microgrid (Neetika Sathe, Power Stream Inc, April 10 2014)

3

The power backup systems could become known as the renewable energy systems backbone. Today, many of the green power generating systems such as electric vehicles and photovoltaic systems are equipped with these backup storage systems as they act as an energy buffer to bridge the mismatch between required and available energy. Previously, the lead acid battery was widely used in the backup storages due to its availability and low cost. While batteries have high energy density and as recent efforts have improved battery performance to an acceptable rate, there are still some drawbacks. As it is known, batteries operate with high efficiency and have a long lifetime while they charge and discharge at a low, steady rate. On the other side, batteries with such high power density are expensive.

To meet the peak power demands of the system a number of batteries are needed, increasing the price, size and weight of the system. In applications like mobile systems (electrical cars) these factors are vital. The other main issue in working with batteries is the safety problem. The high rate of charging and discharging in high power-load conditions requires a thermal management system ­ for such conditions as low or high temperature, the battery needs to warm up or cool down in order to achieve the desired power. Another problem related to the batteries ' lifetime is battery cell balancing. In the case of not considering the cell balancing, over time each cell's voltage drifts apart and the whole battery system's capacity decreases and causes damage to it. Moreover, batteries cannot sustain instantaneous charging and discharging; if this happens, they will rapidly lose their lifespan or they will become severely damaged. Therefore in case of a current surge, an auxiliary storage device should be added to the backup system to protect the batteries and provide the instantaneous power demand of the load.

If the load demonstrates a high range of fluctuation, an energy buffer is required to cover up the mismatch between available and required energy. The hybrid storage backup system consists of battery and super-capacitor ­ a system that could utilize the high energy density of the battery with the high power density of the super-capacitors. The super-capacitor acts as a short-term energy storage device or an ideal battery for the fast response to the dynamic performances of the load. The battery is used as energy storage of the load for the steady consumption part of the load. This system extends the lifetime of the battery by decreasing the battery current fluctuation and decreasing its internal loss. Moreover, using the power in a more efficient way can result in
4

the decrease of the size for the whole backup system package and increase the system reliability. This system overcomes the limitations in power density of the batteries and offers the best degree of hybridization while solving the starvation and damage to the battery in fast dynamic loads. The flow management performs its function to keep the energy balance in the DC bus by regulating the voltage. The system ensures a good synchronization between the battery and super-capacitor.

A. Batteries
The lithium-ion battery is one of the battery chemistry families that use a variety of combinations of cathode and anode materials. Each combination has its own advantages and disadvantages based on the safety, performance, cost and other properties. Other available technologies are NCA, NMC, LMO, LTO, and LFP. However the most popular available technology is LCO, which has safety risk issues for applications like automotive.

To provide comparison measurements in this technology, six different dimensions can be taken into consideration: Safety, lifespan (lifetime charge and discharge cycle numbers), specific energy (the rate of energy storage per kg of weight), performance (may be based on the low temperature peak power or managing thermal conditions), specific power (the rate of power storage based on the kg of mass) and cost. Cost could be based on many aspects like component production, cell production, module production, pack assembly, vehicle installation including accessories, lifetime and recycling. At the moment, none of the available technologies perform well in all categories. Always, when they have high performance in a number of the items, there are drawbacks or compromises on the other measurements. For instance, the NCA is a highperformance technology in many aspects but the tests demonstrate safety issues for that combination. LEP is a safe technology but has lower specific power.

Safety is one of the most important measurement aspects that make the technology proper for the market or rejected from it. Normally, batteries can overheat because of the chemical reactions inside the cell, while overcharging or fast discharging could cause fire and so is not safe in different battery applications. There are a couple of remedies for those functions that reduce the

5

safety level of the technology, such as balancing the discharging level, a robust battery box, using cooling systems and monitoring the charge rate. In general, it could be claimed that the higher the energy and power, the more exposure a battery will have to safety issues.

The lifetime of the battery, or the lifespan, could be measured according to the maximum cycle numbers of charging and discharging and/or the number of years that are expected in which the battery remains functional. The performance of the battery is defined by its function in different environments and temperatures, like how well it works in the cold winters and hot summers. Specific energy is another measurement aspect that defines the batteries' capacity of storing energy. Today, the latest battery technology could extend the energy capacity to 170 watt-hours per kilogram. Specific power is the rate of the power the battery could apply per kg of mass. There are many methods to increase the capacity of a battery like increasing the electrode areas and keeping the electrode thickness constant or alternatively increasing the thickness and keeping the area constant. Charging time is another challenge facing today's technology. A 5 -KWh battery takes three and a half hours to charge completely when plugged into a 120V outlet. There are fast-charging methods but they will increase the cost of the systems. For instance, by increasing the power to a 240V outlet, the battery could charge in 42 minutes. Today the most popular batteries used in the hybrid cars are NiMH and the latest ones are Lithium-ion batteries. Different classes of the power system devices, such as telecommunication systems, portable electronic devices, spacecraft power systems and electric vehicles have the same load profile characteristic in common; their load profile requires a low average power but it has high power pulses in some instances. By knowing the nature and requirements of most of the loads and knowing the constraints of battery usage in the backup system, the researcher suggests some methods to solve this issue.

Due to the higher gravimetric energy constant, the nickel metal battery is a better selection in comparison with the lead acid battery (35-50 KW/Kg of the lead acid battery against 60-90 KW/Kg for the nickel metal). Moreover, a higher volumetric energy is achieved for nickel metal hybrid battery in comparison with a lithium ion battery (about 300 W h/L for a Lithium ion
6

battery and about 350 W h/L for nickel metal). In the case of hybrid systems, many batteries have been tested, like Ni-MH, Ni-Cd, or Pb-Acid. However practical experience shows that the Ni-MH is the best solution based on endurance and reliability in spite of its higher cost [45]. One of the factors that significantly degrade the batteries' discharging efficiency under high load currents is the effect of the rate capacity. Commonly, large fluctuations are shown in the electronic devices under load current and this will oppose the maximum discharging capacity of batteries. Eventually the battery's size will be determined according to the average power consumption expected at the electronic systems. However, in the case of a peak current surge, the discharging large pulse peak may easily exceed the value of the average current, which could significantly reduce the battery lifespan in the cycles of charge and discharge. Therefore, using some strategies and topologies in the power-electronics, the peak current and its variations on the battery should be drawn and reduced [9]. Today's technology dictates a new storage system technology, while the battery design should keep the balance between the life cycle span, specific power, and specific energy and still pay for the available trade-off. Achieving the highest values of these three factors together is not an easy task; therefore the researcher was led to utilize some new ideas for the energy storage system as hybridization of a power source and an energy source.

7

Battery Comparison Measurement's Dimensions Lifespan Due to the number of charge and discharge cycles and/or due to the lifetime that remains from its functionality up to 80% Overheating caused by the reactions, overcharging or fast discharging causes fire. The remedies for this issue could be the usage of robust battery box, cooling system and/or monitoring the charging and discharging rate. Rate of energy storage based on the Kg of the weight Rate of power storage based on the Kg of mass Based on managing thermal conditions. The ability to work during minimum temperatures in cold winters and maximum temperatures in hot summers. Component production, cell production, module production, packs assembly, installation including accessories, lifetime and recycling.

Safety

Specific Energy Specific Power Performance

Cost

Table 1-1: Battery comparison measurement's dimensions

Battery Disadvantages
 Safety issues due to overcharging and fast discharging  Needs charge monitoring to prevent over and under charge  Performance limits due to high and low temperature  Loss of power capacity and lifespan while inrush power demand due to the internal resistance  Low voltage level capacity per each battery cell that cause high size and volume in case of high power needs at load The major factor that limits the batteries' charging and discharging capability is their internal resistance. Of the batteries' drawbacks, it is possible to count their low power density, low cycle life, and long recharging time. One way to overcome these limitations is pairing the supercapacitor and battery as a hybrid unit to boost the life cycle, to recover more power through the efficiency of regenerative braking, and to provide high power for acceleration. This combination could be a fairly good buffering source used in the energy storage of electrical systems based on the two sources' properties.

8

B. Supercapacitor
The supercapacitors are rated in farad, which have thousands and millions times higher capacitance than electrolytic and electrostatic capacitors. As it is known, one farad stores one coulomb of electrical charge while applying one volt. The supercapacitors are ideal for energy storage, which undergo several charge cycles in short duration and at high current. Supercapacitors have voltage limits of up to 2.7. Higher voltage is possible by connecting the cells in a serial manner although this will reduce the capacitance. A series of three capacitor cells needs voltage balancing to protect the cells from over-voltage. Supercapacitors have a low specific energy of 30Wh/kg, which is one fifth that of a Li-ion battery. Their discharge curve decreases in the linear manner while the electrochemical batteries deliver a steady voltage in the usable power band. Properties like ultra-rapid charging and providing high current on the load demand time made them the best selection for the backup system.

Other properties of supercapacitors that are advantageous are they will not extend into overcharging and they do not need any full-charge detection because the current will stop flowing after the capacitor has charged. Unlike electrochemical batteries that have a limited lifespan of a number of charging and discharging times, supercapacitors have an almost unlimited lifetime. Just applying a voltage higher than rated could reduce their lifespan. The stored energy in the supercapacitor will be lost from 100% to 50% in 35 days in case of no usage; in the nickel-based battery the energy will be reduced from 100% to 85% in a month; and in the Li-ion the energy will discharge 5% monthly.  Supercapacitor Advantages - Unlimited cycle life - High specific power, low resistance - Charges in seconds ­ no need for charge monitoring - Draws what it needs, no over and under charge - Excellent low temperature performance

9

 Supercapacitor Limitations - Low specific energy - Self discharge is higher than most of the batteries - High cost per Watt

Electric double layer capacitors, which are known as supercapacitors, are mostly implemented to moderate the high rate of fluctuations on the load current for the batteries. Their extremely high cycle efficiency is defined as the output energy over input energy ratio achieving a hundred percent, which makes them a perfect candidate for a hybrid power storage system in cases where there are thousands of charge and discharge cycles involved. In a hybrid storage system consisting of the battery and supercapacitor, the super-capacitor will store the extra energy left over from the battery to be charged at the steady-state time interval and will provide the extra required current surge at the high dynamic load demand intervals [9].

A supercapacitor increases the power response characteristics of the main storage system to the variation of the load current to a very advanced level thanks to its superior properties. Supercapacitors play a significant role as an energy buffer or balancer during some essential load transition time intervals. By adding the supercapacitor to the energy storage system, the power quality and overall efficiency would improve significantly in the power system distribution. Excellent depth-of-discharge is another excellent property of super-capacitors. Superior properties like their accepting capability of the full recharge in an extremely short time and their high specific-power rate make supercapacitors one of the most beneficial sources in hybrid vehicles due to the increased energy economy and whole vehicle efficiency. In regenerative braking energy recovery, this economy will be extremely beneficial. The hybrid energy storage system provides this important ability to select the source of the regenerative braking energy recovery, somehow based on the degree of deceleration or deceleration rate. This means that if the rate is slow, the battery will be charged based on the steady and slow nature of the generated current; however in case of fast deceleration, the super-capacitor will receive the charge due to its higher power density, which increases the charging efficiency.

10

One way to solve the problem is the hybrid backup system, which adds supercapacitors and/or fuel cells to the power backup system. Super-capacitors or ultra-capacitors act like an ideal battery: They are electrochemical double layer capacitors. According to Lijuan [39], "Super-capacitor builds of double layer with a large surface area made of micro-porous material like activated carbon which stores the charge on itself. Its specific energy is in the range of 1 to 10 Wh/Kg and its high specific power is in the range of 1000 to 5000 W/Kg. It has a high rate of charge/discharge efficiency of 85% to 98%. The discharge is fast in the range of 0.3 to 30 s. To have a sense of comparison with the rechargeable Lithium-ion Battery it has a higher specific energy in the range of 50 to500 Wh/Kg and lower specific power of 10 to 500 W/Kg. Its charge/discharge efficiency is in range of 75% to 90%, and the rate of discharge is 0.3 to 3 h." The other advantage of the super-capacitor over the battery is that it does not need any charging/discharging monitoring circuit whereas for the battery a charge/discharge monitoring circuit is crucial. The battery, in the case of over-charging, is dangerous due to generated heat and gases and the possibility of explosion. In the case of under charge or starvation, it will lose its lifespan.

The hybrid power backup system proposes to combine the two energy storage device systems in a way that each covers the weak point of the other and the total system uses each one's advantage. The high energy density of the battery can be used for low dynamic and steady current demand of the load in the long term. The system can utilize the fast dynamic performance of the supercapacitor in the sudden surge of the current demand from the load.

Direct connection of the battery and ultra-capacitor in the hybrid energy storage system architecture limits its performance, however. There are some reasons behind this limitation, like floating of the battery terminal voltage with the supercapacitor and load voltage, which will prevent the full power discharge of the super-capacitor. In addition, this battery terminal voltage is the reason for the size limitation for the super-capacitor bank, since the super-capacitor maximum voltage value should be restricted. The other reason is that the two sources' (battery and super-capacitor) equivalent series resistance dominantly dictates in advance the shared current rate limit and the power improvement of the hybrid storage source. In addition, the
11

hybrid storage terminal voltage follows the battery's charge and discharge curves and is not controlled. Moreover, the large battery current ripple during one pulse could reach the maximum value at the pulse end; by disconnection of the battery protection system this could be last [39]. The super-capacitor's capability of accepting high currents from regenerative braking and its higher efficiency may result in the hybrid vehicle's higher total efficiency and increase its driving range a significant amount. In addition, replacing a number of batteries with the supercapacitors preserves the vehicle's functionality and reduces the main core of the vehicle's costs. Hence, usage of the super-capacitor in a hybrid power storage system with battery on a hybrid vehicle may have the following effects [12]: Improve vehicle acceleration; reduce life cycle costs by extending the battery life; improve overall drive efficiency thereby increasing the driving range; and reduce capital costs by direct replacement of some batteries [12].

There are some advantages to adding a dc-dc converter in between the supercapacitor and battery as follows: 1) The voltages between the battery and super-capacitor may be different, which allows the configuration of the battery bank and supercapacitor arrays to be more flexible; 2) Without increasing the design safety precautions for the battery current, the power capability could be improved to higher levels in comparison with a passive hybrid system; 3) Even in the case that the battery is adapted, the power source voltage is kept with low variation and close to constant; 4) In the equal load case, in comparison with the passive power source, the weight is smaller; 5) In the passive hybrid power source a separate battery charger is needed, however the available dc-dc converter could serve as a battery regulator and charger [39].

12

Function Charge Time Cycle Life Cell Voltage Specific Energy (Wh/Kg) Specific Power (W/Kg) Cost per Wh Service Life (in Vehicle) Charge Temperature Discharge temperature

Super-capacitor
1-10 sec 1 million, 30,000 h 2.3 ­ 2.75 5

Battery (Lithium-ion)
10-60 min 500 and higher 3.6 to 3.7 V 100 ­ 200

up to 10,000 $20 10 ­ 15 Years -40° to 65°C(-40° to 149°F) -40° to 65°C(-40° to 149°F)

1,000 to 3,000 $0.5 - $1.00 (Large System) 5 ­ 10 Years 0° to 45°C(32° to 113°F) -20° to 60°C(-4° to 140°F)

Table 1-2: The comparison table of battery and supercapacitor parameters

Figure 1 ­ 2: The location of the battery and supercapacitor in the energy density versus power density diagram

13

To perform the power backup system based on the characteristics mentioned above, Choi [1] presents a topology and formulates it in two stages. Stage one reveals a problem in calculating the supercapacitor voltage reference based on the real time in which a load's current is consumed, and stage two is the optimization and extraction of the battery and supercapacitor current based on the first part.
(a) (b)

Figure 1-3: The considered topology (a) and the DC-DC Converter-Chopper Circuit (b)

Based on our research and literature reviews of similar suggested microgrid systems, this Master's thesis presents mostly state-of-the-art components. However, there are still aspects of these systems that demand more research to increase the efficiency of the system and to decrease the cost. For instance, the life cycle of the backup system's battery is one of those cases. Batteries are one of the most expensive elements of the microgrid systems. The short lifespan and the high power loss of the battery are due to sudden current surge demands, which happen frequently in the load. By decreasing the variation on the demanded current from the battery, its life cycle will increase dramatically and this will minimize the total power loss.

In the first part of this Master thesis, an algorithm is presented for the energy management control on the HESS. The overall mass of the system is smaller at HESS over passive configurations of the same load, which is a significant advantage for this system. This energy management system uses the load current to predict the future load and based on these

14

predictions, it prepares the system for any upcoming variation. The load current prediction is then used to predict the required super-capacitor reference-voltage, which is used on the next section, the smoothing section. The smoothing section minimizes the battery 's current variation and draws the existing current's fluctuation from the super-capacitor, which is considered as an optimization on the provided current from the HESS. The presented algorithm can be implemented on the embedded systems in the master and slave fashion. By using the MultiConverter Topology configuration, the full control aspect becomes available. This system will be incorporated with the information technologies to receive and analyze data in a real-time manner and optimize the system's reliability, cost, and performance.

Figure 1-4: Illustrates the block diagram of the proposed HESS controlling system

The results were verified by two simulated experiments on Matlab® Symulink.

The

simulation results in two different experiments validate the efficiency and performance of the offered control strategy. In one experiment, the proposed control was simulated alone and in the second one it was placed in a whole smart-home model. The proposed control algorithm design could be scaled larger or smaller for different applications like hybrid electrical vehicles or smart-home systems with renewable energy sources. The second section deals with PV modules' power generation. In this section, power is provided from the PV arrays by the convenience of the MPPT for each PV module. This will
15

give the system a much better power-collecting rate during partially shaded conditions. To fix the voltage, every four PV modules were connected in series to make a package and connected to a buck converter with a voltage controller. Then each package was connected in parallel to the others to build the required power for the microgrid. A central inverter converts the generated DC to AC. Now the microgrid system was able to sell the power to the grid and to charge the backup storage batteries and supercapacitors. In order to sell power to the grid, its quality must be considered very carefully.

There are a couple of major requirements to be fulfilled in this range of generation. One is to synchronise the generated power with the grid power. In this project this is done with a PLL (Phase Lock Loop). This device will read the phase angle of the grid voltage as its reference and send the reference signal to the inverter. Then the reference signal will be the reference to generate the gating signals for the inverter. Therefore, the AC voltage output of the inverter will be generated with the same phase angle as the grid voltage. Other significant factors that must be considered for selling the power to the grid are the power factor correction and protection, and protecting the sinusoidal shape of the signal in all of the cases while either connection of the grid to linear or nonlinear loads. There are different methods to implement the power factor correction; however the main issue that needs to be considered in the selection method is the range of the device's power consumption.

16

There is an ideal method to perform the entire above-mentioned requirement in one device, which is the active filter. This active filter device, with a well designed controller, could push the power factor to approach the unity, force the generating voltage waveform's shape to sinusoidal shape and also rectify the AC to DC to help the charge of the battery and super-capacitor. This device will cause the generated current to comply based on the IEEE std 519-1992 (harmonic distortion limits). The PV generated power will charge the storage backup system (with a charge monitoring controller) and also sell power to the grid.

Figure 1-4: Illustrates the high electricity demand on today's modern cities

17

Chapter 2

Related Works and Objective
2.1 Existing Energy Management System for Power Storage
In this section, a comprehensive review of the state-of-the-art control strategies is presented. Camara [2] offers a Polynomial control strategy with two parallel super-capacitors and single inductor connected to a bidirectional DC-DC converter, which connects the battery to the DCbus. Zandi [3] presents a control system based on the flatness technique (FCT) and fuzzy logic technique (FLC). Thounthong [4] ­ [5] designed the architecture of the controller based on the differential flatness principle. The controller system utilizes the inner loop current and implements the sliding-mode current for each converter module. Martnez [6] ­ Li [7] present a dynamic strategy for managing energy flow in hybrid systems based on the fuzzy logic in hybrid vehicles.

Wang [8] introduces a power management architecture that is able to estimate the average demand power by measuring the maximum and minimum of the delivered power and, moreover, can estimate the Joule-loss approximation to compensate its error calculation. In addition, a phase-shifted, bidirectional, DC-DC converter is utilized which provides dynamic flexibility. Shin [9] presents a constant-current regulator that insulates the battery from the super-capacitor to improve the efficiency of the energy management system. Awerbuch [10] offers a load division control approach to manage the energy flow for the hybrid backup storage system. Camara [11] and Carter [12] present the Predictive Technique. Yoo [13] offers the frequency approach. Dixon [14], Gao [15], Amjadi [16], Yu [17], Thounthong [18] ­ [19], Paladini [20], Fernandez [21] all present different control strategies and topologies to manage the power flow for the hybrid backup storage systems. In addition, [77] [78] present optimal control, [79] introduces predictive techniques, [80] offers the frequency approach, and [81] proposes the online management control.

18

Bauman J. [76] compares three configurations for hybrid vehicles: FC-battery-UC, FC-battery and FC-UC. In the presented FC-UC and FC-battery hybrid systems, the battery is connected directly to the dc-bus, whereas in the FC-battery-UC case, the dc-bus is connected directly to the UC via a bidirectional converter to the battery. To optimize the total mass of the vehicle and the power train cost, the results show that the configuration with the FC-battery is the best choice. However, in respect to the battery lifetime based on the least battery stress, the FC-battery-UC could extend more [76]. In our thesis, the combination of battery and supercapacitor is used which extends the battery life and results in less stress on the battery based on this research.

If the converters are individually designed in a cascade configuration with different sources, the cross-talking phenomena could happen among the converters. This converter interaction leads the system toward instability. One of the measuring dimensions for the converter interaction in the cascade systems is the impedance criteria. However, this technique only models the behaviour of the system in terms of the asymptotic stability data and will not cover the disturbances with over sizes [29]. In our system, the converter controls are designed based on two solved problems related to each other, which the above-mentioned issue does not affect.

For the renewable power plant, Phatiphat et al. [29] present a nonlinear control strategy utilizing the differential flatness principles. The operating point is independent with the design controller parameters in this system. The controller accomplished the high dynamics in perturbation rejection and interaction between the converters. The controller parameters are adjusted independently of the operating point based on the flatness-control law. If the independent dynamic system is equivalent to a system with no dynamics (static system), it is differentially flat. In the output space there are no differential constraints for such system. Each trajectory in the output space is feasible, which is the advantage of a differential flat system; theoretically, this trajectory generation is simpler in respect of the flat outputs. This is the reason the interactions between the converters are considered by the flatness-control law and the perturbation elimination of the large dynamics is captured in the power electronics applications with the flatness estimation. The controller design is very complicated with heavy math; this Master's thesis presents an algorithm that is much simpler. In addition, the implementation of

19

such systems requires PC and is not possible on the embedded systems based on the calculation time and slow control response.

Zhihong et al. [41] provides the required demand of the variety of hybrid storage backup system loads. Increasing the battery lifetime and making the system cost-effective requires an active power-flow algorithm according to the optimal control theory and dynamic power distribution. This strategy uses the state of charge (SOC) on each source to allocate the optimal power flow, meaning that the system for the cost-equation optimizing utilizes the current SOC, average power flow, and cycle SOC parameters. Hence, the strategy architecture on a real-time basis renews the coefficients to control the SOC ups and downs in the power flow sequences. This method creates a couple of feedback and feed-forward closed loops in evaluating the updating process [41]. The problem of being dependant on only the state of charge and not having any predictions for the coming load power demand leads the system to energy starvation at some occasions, which damages the battery. This Master's thesis, by using the SOC, DC power level measurement and predictions for the coming load power demand, guarantees the system to not fall into the energy starvation trap.

Luis M. Fernandez et al. [45] presents an Energy Management System (EMS) to control a hybrid storage system for a tramway, which consists of a fuel cell as its prime mover, battery, and super-capacitor as its sources. In the hybrid vehicle, the reference signal for the electric motor drives comes from the EMS. In order to have an exact and accurate energy distribution between two sources, the DC-DC boost converter is used; additionally, the reference signals in the braking chopper during regenerative braking for energy dissipation also come from EMS. To define the degree of hybridization (DOH), it could be said that it is the ratio of the fuel cell power over the total power requirement. The role of the ESS identifies the DOH in this system, which covers the peak transient demands, acceleration rate and power gain while the regenerative energy recaptures cycles.

A simple method to achieve the least amount of the FC-required power is that the EMS equalizes the consumed energy while the driving cycle can be returned to battery via the FC. The optimization of the system energy generation and application of the braking resistor ordering
20

while required at regenerative braking, demanded power providing are done by the EMS. The EMS consists of two departments: the state machine strategy and the cascade control structure. The cascade control is composed of two control loops. There are eight states in the state machine control strategy that make the decision for the operating point on each one of the power conditioning system's components; t he power for dissipating in the braking resistor, and the battery and FC reference power is generated by this control strategy. Furthermore, this strategy opposes the constant variation in the FC reference power based on the slow dynamic response nature of the FC. However, the variation in the reference power happens when the resources reach their top and bottom boundaries [45].

The state machine control strategy switches states based on the load demand. The operating points, which were determined by the cascade control structure for the FC and battery, dictated with the state machine and the existing operating state. The two control loops that built the cascade control are the outer loop and inner loop. The outer loop controls the battery power and the inner loop controls the FC-generating current. An error is generated from the differences of the battery reference power and the actual power while a PI controller generates the FC reference current at the inner loop. Two independent and parallel control loops exist in the inner control loop; both consume the error between the actual current in the PI controller and the FC current reference. The topology of this power conditioning system consists of a unique power converter connected to the output of the FC, and the battery is connected to the dc-bus. Based on the author's claim, this design based on the control strategies, state and cascade structure provides a balanced performance for the power storage system [45]. The existence of two control strategies makes the system too complicated to design and cumbersome to be implemented into a group of embedded systems and connection to a personal computer is necessary for this energy flow management system, which makes the system expensive and its volumetric size is not suitable for a hybrid vehicle.

Chun-Yan Li et al. [7] introduce a power distribution strategy on hybrid vehicles according to fuzzy logic (based on the load power and battery SOC) to manage the energy flow in hybrid storage systems. The storage system includes the battery, supercapacitor and fuel cell. With regard to fuzzy logic, it could be said that the map on the controller inputs and outputs that are
21

regulated based on a set of logic rules is a fuzzy logic controller; the decision on the operating level for the converter also comes from fuzzy logic. The optimization determines the power distribution centers and widths of membership functions. The degree of hybridization is designed by the priori knowledge of driving schedule optimal method. The DC-DC converter power should increase to charge the battery quickly in case of the low battery SOC grade. In the inverse case, however, if the SOC level is high the DC-DC converter's power should remain at low level in respect to the demanded load power. The center average defuzzification method and triangular membership function were adopted. In this system, the DOH is the ratio of electric power at the ESS (battery and supercapacitor) to the total power that could be delivered by the whole storage system (including FC).

The optimal DOH is between 0 & 1 if the aim is optimization; in the case of lower DOH, the capacities of battery cells will be lower and the fuel cell numbers will increase. In this case, the FC has the higher voltage advantage, however the lower battery capacity causes the regenerative energy reduction based on the power limitation. The optimization specifies the membership functions of the inputs (power demand and battery SOC) and outputs (DC-DC converter power) with the fuzzy logic power split strategy. The optimization problem's main objective in the fuelcell hybrid vehicle is the maximization of the efficiency. This fuzzy logic controller utilizes some key parameters in design variables of the membership functions in the fuzzy controller to manage the power separation between the battery, fuel cell and supercapacitor resources. The optimal values of parameterized fuzzy controller and sizing of the related engine were extracted by applying the DIRECT algorithm in respect to different driving cycles [7]. In total, the presented system realizes that the power management strategy and engine sizing design techniques in this research works based on the priori knowledge of the driving cycle and is not suitable for the controllers in real time. In addition, the control algorithm is hard to understand and implement.

Donghwa Shin et al. [9] offer a battery and supercapacitor hybrid system that employs a constant current regulator. In this system, the end-to-end efficiency from battery to load improved by insolating the battery from the supercapacitor with the regulator. One of the regulator's jobs is to increase the deliverable energy density to its maximum while protecting the
22

battery capacity rate and efficiency of the regulator in balance. The proposed algorithm drives the magnitude of charging current and the capacitance of the supercapacitor. This algorithm's goal is the power converter efficiency, boosting the deliverable energy density for the given load. In this design, a low-pass filter is created by parallel connection of the supercapacitor, which filters out the fast voltage fluctuations. The hybrid combination of battery and supercapacitor is more suitable for the interrupted high load current by moderating the rate capacity. The supercapacitor effect is to provide the high and sudden current or power surges demand from the load, which consequently results in an increase of the energy flow efficiency on the hybrid storage unit.

In the filtering effect of parallel configuration of the supercapacitor, the capacitance is a main factor; a larger capacitance means better filtering. Eventually, the parallel configuration has a deficiency in design for the rate capacity effect on the battery coverage and the filtering effect in terms of capacitance on the supercapacitor. Moreover, due to the volumetric energy density and feasibility constraints, the supercapacitor capacitance is normally and preferably small. The target of this research was focused on the high variation in the pulse rate load application, which seriously hurt the battery life due to its internal resistance effect. The radio transceiver is one of those devices that have a typically strong variation of pulse rate due to receiving repetition, transmitting, and standby. Therefore the battery is asked for a high amount of current in a short period of transmission and receiving time. The presented hybrid architecture overcomes the deficiency of the conventional parallel connection by using the constant-current regulator. In this design, the constant-current regulator separates the battery and supercapacitor. The problem of the conventional parallel system is that the supercapacitor will reduce the voltage variation instead of the current variation [9].

The constant-current regulator architecture provides a constant rate of charging current that is not dependant on the SOC of the supercapacitor, whereas in the conventional parallel configuration the charging current is variable and dependant on the supercapacitor SOC. The supercapacitor current fills the mismatch between the load's demanded current and the battery's provided current. Eventually, the presented hybrid algorithm causes a more steady discharging current of the battery, even when using a small supercapacitor. One of the advantages of this
23

system is theinsulation of the battery and supercapacitor by the constant-current regulator, which causes the system to work based on the rate capacity effect of the battery with a smaller supercapacitor in comparison with that of the conventional parallel connection. This system provides a power balance between the load and the battery on the periodic pulse load due to the optimal steady condition that was extracted. The results of the experiment prove that the presented system increases the energy density by 7.7% from the parallel connection [9].

Lijun Gao et al. [39] describe a battery-supercapacitor hybrid, which includes a DC-DC converter between the two storage sources. During the active hybrid power storage system presentation, the following power improvement achievements have been investigated: energy loss on each pulse load profile; discharge life cycle; and specific power. In comparison, between active and passive hybrid systems, it is proved that the active hybrid yields a peak power 3.2 times that of a passive hybrid and 2.7 times in terms of specific power. Moreover, the ripple is much smaller at the active hybrid operation in comparison with the passive. Consequently, the battery temperature will be lower in the active hybrid operation, which guarantees a longer battery lifespan. The trade-off for a reduction on the discharge cycle at the active filter is the converter loss and increased ultracapacitor loss. Based on the application, to achieve an optimization between the discharge cycle time and power enhancement, a compromise should be considered. To enhance the power capability and the monitoring of power flow among sources like the supercapacitor, the battery and the load active converter is used with a controller [39].

This research shows that the power capability for a load current pulsing at a rate of 0.2 Hz and 10% duty ratio is three times more in the actively controlled hybrid in comparison to the passively controlled hybrid having the same source sizes. Additionally, the smaller size of the system, smaller batteries' current ripple, more accurate voltage regulation, and higher output voltage spectrum are the active hybrid control's other advantages. It could be claimed that if we increase the power capacity of any system this will cause energy loss. There is a trade-off between the discharge cycle time and the power capability based on the applications; in order to extract optimized results an appropriate decision should be made. In the active system, the internal loss for the battery reduces based on the current constantly drawn from it, however the total loss will increase. The ripple in the active system is much smaller in comparison with the
24

passive system [39]. The system presented in this Master's thesis is the kind of active system explained above.

Javier Salano Martinez et al. [6] introduce a dynamic strategy based on the fuzzy logic strategy to manage the energy flow in hybrid electric vehicles. In this system, the following items are to be considered: SOC of supercapacitor; vehicle speed; and slow dynamics of FCS by the fuzzy logic controller. In comparison with the classical control structures, the fuzzy logic strategy does not need any complex mathematics and is an artificially intelligent method. Linguistic labels are the fuzzy logic tools to define the control laws. There are two types of fuzzy logic based on the source of extraction, which is either from the data or from experience. Fuzzy logic consumes the data from the system and builds the membership function parameters by using optimization techniques similar to the genetic algorithm or dynamic programming. However the fuzzy logic design based on experience is by using the survey-based files, which is called the type-2 fuzzy logic system. This system power storage system consists of the FC, leadacid battery and the supercapacitor as its sources. The system monitors the dynamic reference of the supercapacitor and the slow dynamics of the FC. The main primary objective of this controller is the power that is delivered by the FC and SC. Their currents control the power delivered by the FC and SC. The third control goal is the FC voltage. The MCSs of the SC includes two parts ­ the accumulation and conversion parts ­ which are the equivalent to impedance and a DC-DC power converter [6].

Without any data from the future driving cycles, an energy flow management algorithm has the goal to predetermine the requirements in this research. In addition, the following goals are kept as the objective of the system: predefining the limits for current SOC ­ powers ­ SC voltage ­ DC bus voltage ­ vehicle speed, the SC state of charge protect the system from the load dynamics, only steady constant current will be drawn from the battery, the FC generate the power only at the steady state condition, and providing a constant balance in the power equation. The vehicle speed, dc-bus voltage, SC voltage, SC state of charge, battery state of charge, fuel cell power, and reference power are the EMS inputs. The FC output reference power and the reference power are the EMS outputs. The power reference is found by integration and denormalization of the FC rate of power change at the fuzzy logic output. In this research, the
25

fuzzy logic energy management system was implemented on a hybrid electric vehicle. The presented fuzzy logic is according to the type-2 supervisor and this method has many abilities over the type-1 ­ the most important of which is the modeling of uncertainty. The uncertainties in this system are the model simplification, sensor measurements and etc ... [6].

Jaafar A. et al. [80] introduce a power flow of the whole traction device including the diesel generator and energy storage compartments as a system approach for an efficient design. The system consists of the integration of a storage source, like a flywheel device, a reduced-power diesel generator and a hybrid storage system on a hybrid locomotive. The SC and FW are the sources that are supposed to provide the high frequency responses in the system. The DG works as often as required in the system and the remaining power requirement comes from the battery. The designed strategy has the capability to select the sources based on the required load frequency according to the properties and nature of the resources from which to draw the current. The first step in the design of the energy flow management system was to model the power-flow in the whole system. Then the energy management algorithm according to the frequency is presented. The first stage result is exploiting the flywheel but the next stage is the size optimization for the power storage system. The frequency approach principle is described in this research for the proposed energy management algorithm. The next section studies the integration of the batteries and diesel generator with the flywheel as a part of the energy storage system of the hybrid locomotive [80].

This study builds on two energy management strategies, both of which are based on the frequency approach. The ultracapacitor is the first strategy, which, like the flywheel, only provides the high-frequency harmonics. The result of this section is the exploitation of the flywheel without having any option to increase the number of battery cells. The second strategy goal proposed is for the sizing of the locomotive and optimizing the flywheel usage. In this strategy, the low-frequency part of the battery is injected to the flywheel while keeping the highfrequency part as the priority mission. The second strategy improves the lifespan of the battery while reducing the number of the battery cells and most importantly decreasing the cut-off frequency [80].

26

Carter R. et al. [12] designed a tuneable energy control strategy for a hybrid vehicle. In the presented system, two goals are supposed to be achieved. The first one is to add the supercapacitor to a test vehicle running with a lead-acid battery to improve the efficiency and driving range and to reduce the battery peak current with the aim of increasing the battery life cycle. Then, an analytical comparison is done to locate the advantages of doing this versus increasing the volume of the battery pack instead. The range extension is found to be limited; however, the peak current-reducing method is found to be efficient. The 50% battery life extension is a balance rate for the super-capacitor addition to the system to be feasible. A discussion in this paper looks at four hybridization choices on designing the tuneable control algorithm to meet a variety of goals.

For the sake of detailed study and investigation, the two possible outcomes of the battery and super-capacitor hybridization are selected: improving overall drive efficiency and the battery lifecycle extension. The configuration used in this system is the connection of the battery and super-capacitor with two half-bridge converters, which have been used several times in other hybrid vehicles. This study shows that the two key values that could lead to a variety of optimizations are the deliverable battery power, which recharges the super-capacitors, and the minimum battery power. During braking, the regenerative power will recharge the supercapacitor up to the point that it is full and its surplus will charge the batteries. In case of the batteries' full SOC, the extra power will not be saved anywhere and is assumed to dissipate as heat generated from friction during braking and deceleration of the vehicle. This method shows an effective way to reduce the peak current and guarantee the battery life cycle extension of 253% for lead-acid batteries [12].

Thounthong P. et al. [4] propose an energy flow control system for an energy storage system that has a super-capacitor and an FC designed for future hybrid electric vehicles. The system is designed based on the innovative principles of the flatness properties for control laws of the hybrid power source, which includes the FC and super-capacitor. To stabilize the problem, the flatness principle solution is offered on the energy management system. The role of the supercapacitor is to function as a high specific power source and provider of high dynamic demands from the dc-bus to regulate the energy. The FC, based on its slow dynamics energy source
27

property, acts as an energy supply or charge supplier to make sure the super-capacitor is in full charge most of the time. An interleaving switching technique on a parallel boost converter guarantees the energy-efficient operation of the FC part by minimizing its output ripple. In this research, the control algorithm is digitally implemented [4].

In most designs, a boost DC-DC converter smoothes the FC supply current and adapts the output voltage of the FC to the required level of the utility voltage. Conventionally, the inner loop is the current regulator for most FC and super-capacitor converters. However in this design, for each converter module, a sliding-mode current control is implemented. Moreover, the current regulation loop's dynamics are faster than those of the outer current loops. There are two reference signals supplied for these control loops: the FC current reference and the supercapacitor current reference ­ both generated by the energy management algorithm. The two variables, which in this system are going to be regulated, are the super-capacitor energy and the dc-bus energy. Therefore this hybrid energy management design rests on the fact of the supercapacitor as the fast energy supply to provide the dc-bus energy demands for the sake of regulation [4]. The FC's role in this system is the energy supply for the dc-bus's capacitor and the supercapacitor and provides charge to these two most of the time. Fliess was the first person to introduce the flatness theory that, according to him, will give us an alternative trajectory in planning representation that the non-linear controller design is clear-cut. Furthermore, without integrating by any other differential equation, the differential flatness approach has superiority in that the trajectories of the system are directly estimated by the flat output trajectories. This system focuses straightforwardly on the energetic characteristics of the storage sources, such as their specific power, specific energy, and the operating dynamics on the design of the energy flow management algorithm. Based on differential flatness, this system presented a controlled approach that has a suitable robustness, stability and efficiency as a hybrid storage system [4].

Camara M. B. [2] offers an energy management strategy for a super-capacitor and battery in a hybrid storage system. The presented algorithm works based on the polynomial capacitance simplified model of a super-capacitor's cell energy behaviour based on its charge and discharge.
28

It is claimed that the model is not working for the time before and after charging for the supercapacitor's behaviour. As it is known, batteries usually provide the steady state energy requirement of the system and the supercapacitor provides the peak-power requirement of the system. In this configuration, a bi-direction converter is located between the supercapacitor and the dc-bus. However, the battery is directly connected to the dc-bus. The first topology is presented to avoid the buck-boost saturation. The second topology simplifies the control strategy and causes the supercapacitor inductance capacity reduction for the current smoothing. This offered strategy estimates, based on the inductance, sampling period, and required bandwidth with the polynomial coefficient, via the polynomial controller synthesis [2].

The presented algorithm regulates the two converters for the battery and supercapacitor based on polynomial control strategy. The proposed strategy is possible to implement in embedded systems like DSP or microcontrollers. There are two aspects contributing to this presented strategy. The supercapacitor behavioural modeling is the first one that identifies the specifications for the experiment. The polynomial strategy and its usage in the embedded energy management is the second one. As the dc-bus voltage is fixed, based on the battery, the controller needs to be current type. Not exceeding from the reference, characteristic variation during operation due to the dynamics and pure delay are the process advantages that the presented polynomial controller adds to the algorithm [2].

There are two distinct states in the first control topology. The first state is the charge of the supercapacitor with the fixed current. One polynomial control applied for that. The discharge of the supercapacitor with the variable current is the second state. By using two polynomial controllers at this state, the current of the battery and supercapacitor is controlled. The polynomials are determined based on an imposed model at the closed loop in this strategy, which gives the guarantee for the regulation and system control. The order of the polynomial must be the same as the closed loop transfer function characteristic equation. There are two polynomial selection techniques: in the first one, the two different polynomials are selected, which has the simplest solution to determine the polynomial by letting the static gain equal to one (1); the second technique that includes selecting the polynomial somehow that it is identical for fewer

29

numbers of the parameters that will be identified. To protect the system's stability, the poles of the closed loop must be kept inside of the unit circle [2].

Wang L et al. [8] describe an energy flow management system that includes a power storage unit to recover braking energy and to improve the FC dynamic property. The offered system has the FC vehicle power train configuration that consists of a three-port isolated triple-half-bridge DC-DC converter that interfaces with a high-energy dense battery and a high-power dense supercapacitor. The battery unit and the super-capacitor unit size are extracted with providing a design routine to have the lightest mass at 95% efficiency. This control strategy is developed somehow to have the highest FC fuel economy. Moreover, the battery and super-capacitor's state of charge are controlled even though the condition is dynamic and kept regulated on each driving cycle. In this research, the proposed control strategy is implemented in two different trials. In the related configuration, the FC is directly connected to the inverter dc-bus. The three-port isolated triplehalf-bridge converter, which is connected to a multi-winding transformer, is available to supply the ultra-capacitor and battery with low voltage [8].

As the ultra-capacitor voltage source counterparts are not able to keep the soft switching based on the high voltage variation conditions at the ultra-capacitor, a current source, phase-shifted converter is selected to be interfaced with the ultra-capacitor. Furthermore, the decreasing rate of current ripples and the flexible current control are the other duties for the storage compartment. There are three significant objective goals in this research: high system efficiency for ESS; making the energy storage compartment as light as possible while extracting the highest fuel economy of FC; and meeting the load requirements. In this design, by controlling the battery, a moderate peak-power is provided most of the time. In order to have the average power, the FC is controlled, while the super-capacitor is controlled to provide the demanded surge of current and power absorption at the regenerative braking time [8].

There are four control sections available in this design: the THB DC-DC converter control; ultra-capacitor and battery SOC control; FC average power control; and the FC hydrogen-air supply control. While the load is transient, the ultra-capacitor's response is much faster than the battery, which causes the current control of the ultra-capacitor to be selected for the inner loop.
30

Then, to extract a high dynamic performance, the inner-loop is cascaded with the FC's current control loop. The results of the sizing design routine prove that at 95% efficiency, the combined arrangement of the battery and supercapacitor has the lightest possible mass in comparison with battery-alone or supercapacitor-alone arrangements of the ESS. Moreover, the offered control strategy affects the joule loss in the battery and supercapacitor, and also the FC ohmic polarization loss [8].

Among these different methods and hardware configurations, some perform a high rate of hybridization and efficiency; however there are some limits on their successes. There is a significant negative aspect to some of these cumbersome architectures, which is a timeconsuming and slow response when they are implemented as a control system. This slow response will add a PC to the embedded systems, which has its own problems and space requirement. On many of the presented configurations, the topology is designed so that not all of the sources come equipped with the converter for the full control, protection, and monitoring. The other problem in almost all of the presented ideas (except two, which have survey type of driving cycle patterns as their prediction tool) was the lack of real-time prediction on the load power demand. Prediction of the load power demand prepares the system for up-coming events. In some papers related to the hybrid vehicles [22] ­ [23], an estimation of the load consumption is extracted statistically from the driving cycle patterns (i.e. highway driving patterns and urban dynamometer patterns) which are not real-time predictions and considered as a control parameter like the vehicle speed profile and or regenerative breaking profile [24].

In two attempts, Moreno [72] and Wang [73] report the utilization of supercapacitors to extend the battery's life cycle. Moreno [72] proposes an optimization problem to minimize power loss using neural network classifiers trained with simulated data. Wang [73] derives an optimization problem, which minimizes both power loss and weight of the energy storage system to provide efficient fuel consumption in hybrid vehicles. Their reported results show significant achievement in power-fuel saving. The proposed solutions by Moreno [72] and Wang [73] are focused on vehicle power efficiency and are not as efficient in non-vehicular applications. In addition, their optimization problems did not consider fluctuation/variation minimization of the

31

battery current. A good review of the previous works in the HESS (hybrid energy storage system) applications is provided in [74].

A number of works have considered the minimization of the battery current variation to increase the battery life cycle. Choi [1], [75], presents an approach to formulate the control of HESS power based on convexified optimization problems to achieve two goals: minimizing the magnitude/fluctuation to current flowing in/out of battery; and minimizing the energy loss in HESS. This approach assumes that the future profile of the load consumption is given. Using simple circuit elements on the hybrid storage backup system and based on the fundamentals of electrical principles [1], the issue is formulated and presented with two non-linear problems. This thesis project proposes a high-performance and high-efficiency power-flow management architecture incorporating the contributions that are able to predict the load consumption in realtime and prepare the system for the future events. The algorithm can be implemented on the embedded systems in the master and slave fashion. Using the multi-converter topology configuration, the full control aspect becomes available.

2.2 Proposed Contribution Aspects to the State-of-the-Art
This Master's thesis presents a smart system for micro-grids used in residential/commercial buildings. The system consists of an energy flow management system (EFMS), a hybrid energy storage system (HESS), and photovoltaic power generation units (PVPGU).

The EFMS controls the energy flow between the grid, PVPGU and HESS to maximize the efficiency of the energy consumption and storage on the whole micro-grid system. This means that the EFMS adds a number of switches on the input lines of different components in the presented micro-grid system in addition to a smart controller to manage different status and energy flow paths for the micro-grid system based on the amount of generated power. The proposed PVPGU are designed to be cascaded based on the residential/commercial scale usage. Each PVPGU consists of PV modules (MPPT controller at each PV array), voltage regulator, phase lock loop, and active filter.

32

The proposed HESS controller is designed to increase the battery life (cost efficiency) and to minimize the power loss in the power storage backup system. The HESS consists of battery, super-capacitor, DC-DC converters, and the control system.

Figure 2-2-1: The presented micro grid block diagram

Despite this thesis including all the components of the total system, the focus of this Master's thesis is on designing an optimized HESS module to minimize power loss and current fluctuation/variation in the batteries. In this Master's thesis, two optimizations in a cyclical pattern is driven. The first one, prediction­opt, is defined to extrapolate the reference super-capacitor voltage of the next cycle, while the second optimization, smoothing-opt, is used to smooth the super-capacitor voltage of the current cycle based on new current/voltage measurement readings. This thesis introduces three contributions of the HESS module to the state-of-the-art (Choi [1]). We apply the LPC method to do the prediction, as well as incorporate a number of previous samples of the supercapacitor voltage of the current cycle to provide a continuous, smooth extrapolated remove the available discontinuity. In addition, we utilize norm-2 of increase the influence of to

in the smoothing-opt to

in the smoothing process. The advantage of the proposed HESS of

this thesis as compared to the state-of-the-art is a fluctuation rate reduction of the battery current and an increase of the battery life cycle.
33

Chapter 3
Theory of the Energy Flow Management Algorithm for Hybrid Energy Storage Backup System
In the considered Hybrid Energy Storage System, the energy storage device consisting of battery and supercapacitor is connected to a dc bus via DC-DC convertors as shown in fig.1-3(a). For efficient usage of the battery and supercapacitor the SoC (State of Charge) of the supercapacitor needs to be in the high rate for the calculation to works properly. In the case of not charge enough for the supercapacitor and a surge of current demand from the load the battery will be damaged. In order to enter the SoC factor of the supercapacitor in our calculations the which is an equivalent level for that is defined, and it is calculated or extracted in the problem one. In this project the future load current is predicted based on its previous trend or pattern of the rate.

3.1

Notations and Assumptions

The battery, the supercapacitor and the load are denoted as B, SC and L respectively. The battery current, SC current, battery voltage and SC voltage are denoted as

respectively. The

is the sampling period due to the discrete are

measuring manner of the voltage and current. It is assumed that

dynamically controlled by active DC-DC converters. The battery has a capacity in amp-hour units, a constant voltage and . The voltage and current are

assumed to be measured in a discrete manner with a small sampling period. It is assumed that the SC is characterized by the capacitance maximum capacitor voltage Energy Storage System is DC. , equivalent series resistance , and the

. We also assume that the current flowing in the Hybrid could be calculated by the following classic equation:
(3.1-1)

34

The load L is characterized by the required current denoted by the
[1].

(t). The reference voltage of SC is

3.2

DEFINITION OF PROBLEMS ONE AND TWO

A. Theory of Problem One (Prediction-Optimization)
For a supercapacitor, the relation between its current and voltage is defined as where is the derivative of the supercapacitor's voltage, ,

. Now, this relation is discretize to

obtain in discrete time domain as follows, (3.2-1) Where is the sampling period and is the sample number in discrete time domain.

Then, it was interested to derive an optimization problem, aiming to achieve two objective terms: (a) to minimize the power consumption of battery, (b) and to minimize fluctuation of the battery's current. To achieve the first objective term, the constraint were put on the power consumption of battery , and since the battery is assumed to have a constant voltage, the square current of battery was minimized as, . To achieve the second objective term, the square of battery's current .

difference in two consecutive samples was minimized as

The optimization problem Was derived to find a reference supercapacitor's voltage, where relate the and

,

is the number of samples to be solved in the optimization problem. To

to the battery's current, it was needed to use other equations. First, the

Kirchhoff's current law between the battery, supercapacitor, and load was considered in the DC bus as, . Second, the current-voltage relation of the supercapacitor, , was discretized and then the Instead of deriving was obtained.

from equation (3.2-1), this integral equation is used to consider all .

supercapacitor's current samples, resulting in a smoother solution for

35

B. Computation of the Problem 1

reference value

(3.2-2)

Subject to

(3.2-3) (3.2-4) (3.2-5) (3.2-6) (3.2-7) (3.2-8) (3.2-9)

(3.2-2)

The objective function is the minimization of the addition of the battery current (First Term) and the battery current fluctuation (Second Term). The quadratic nature of the objective function is based on the exponential damage on the battery due to the battery current magnitude/fluctuation values on the equation.

Constraints:
Subject to

(3.2-3)

The first constraint is based on the Kirchhoff's Current Law which explain the addition of the battery's and supercapacitor's current coming inside the DC bus is equal to the amount of the current which is leaving the DC bus.

36

(3.2-4)

The second constraint shows the relation between the voltage and the current in a SC. (3.2-5) To connect the supercapactior's voltage of the first sample and the last sample, the above relation is derived to maintain the connectivity of the supercapacitor voltage throughout the power control strategy problem.

(3.2-6) The fourth constraint declares the reference voltage of SC .

Inequalities and qualities:
Other inequalities show the boundary of SC voltage vsc(t), battery current in(t), SC current isc(t), respectively. (3.2-7) (3.2-8) (3.2-9) where are the maximum boundary of the battery/SC current and SC

voltage. T is the time period. ,  are the trade-off coefficients. These coefficients could be selected by using the following equations [1]:
(3.2-10)

and

is maximum boundary of the battery fluctuation.

37

Load Current Prediction

Fig 3-2-1. The block diagram of the algorithm for the energy management system

The outputs of the optimization problem II, (ie.

,

, and

) are entered a unit delay block, , , and

and are fed back into the optimization problem II, as previous samples (ie. ).

C. Theory of Problem two (Smoothing Optimization)
After calculating the reference supercapacitor's voltage, it is being used to control the supercapactior's voltage to achieve the objectives of the optimization problem I. However, as the new samples of current and voltage are measured, the reference voltage of the next samples could be defined to achieve less current fluctuation and power consumption of the battery. Thus, a new optimization problem is defined, and it is called as smoothing optimization problem. The smoothing optimization is only calculated for the next sample of supercapacitor's voltage. In addition to the battery current constraint, another constraint is inserted into the optimization
38

problem to force the optimization solution to follow the calculated reference supercapacitor's
voltage in optimization problem I. This is achieved by minimizing the difference of the supercapacitor's voltage, , from its reference value, , as . Since in this optimization problem, we only

consider one previous sample, the relation between the supercapacitor's voltage and current is obtained based on equation (3.2-1) as .

D. Optimization of current flow
In the first problem the extraction of the reference voltage was explained problem Smoothing optimization the battery/SC current values and . In the second are computed based

on the calculated reference voltage from the first problem in a real-time manner.

Problem 2
Minimize (3.2-11)

Subject to (3.2-12) (3.2-13) (3.2-14) (3.2-15) (3.2-16)

Smoothing- Optimization:
(3.2-11) The objective function is the sum of the battery current, its variation difference, and the difference between and .

(3.2-17)
39

Constraints:
Subject to

(3.2-12) The first constraint is based on the Kirchhoff's Current Law which explain the addition of the battery's and supercapacitor's current coming inside the DC bus is equal to the amount of the current which is leaving the DC bus. (3.2-13) The second constraint shows a relation between the voltage and current in the SC. The other inequalities mean the boundary of vsc,in, and isc, respectively.

Inequalities and qualities: (3.2-14) (3.2-15)

(3.2-16) , and are the previous values of the battery current, SC current, and SC

voltage, respectively. , , and  are trade-off coefficients. The trade-off coefficients  and  can be selected by (3.2-9) equations. The  coefficient could be selected by using the following equation: (3.2-17) . Decision variables are , , and .

40

3.3

SOLUTION OF THE PROBLEM I

As from the problem, it could be understood that it is a minimization nonlinear function that includes an objective, equality constraints and inequalities constraints.

A. Preparing the main objective function
To solve it, at first some variables were found in the constraints and substituted with their equivalents in the objective function. Then the function was managed so that a main objective function was built up from the and to be minimized:

(1) (2) From (1) & (2) => =>

(3.3-1)
(3.4-2)

(3.3-3)

We can rewrite it as:

Simplifying as:

(3.3-4)

This can be rewritten in the matrix form as:

41

(3.3-5)

B. Usage of the Lagrange function to solve the nonlinear system of equations
Using the Lagrange method, it could be written as:

= 0

(3.3-6)

= = 0

+

(3.4-7)

(3.4-8)

= = 0

+

(3.4-9)
.

We define a vector of load current as, equation is obtained,

By solving (3.4-9), the following

42

The two matrixes as follow are Toeplitz matrixes:
1 -+4  0 . .  --4 0 2+ 6 --4  . . 0  0 --4 2+6 --4 . . . 0 0  --4 2+6 . . . . . 0  --4 . . . . . . 0  . . . . . . . 0 . . . . . . . . . . . . . 0 . . . . . . 0  0 0 . . . .

0  0 . . . . .

0 -- 3  . . . . .

0 +3 --3 . . . . .

0 - +3 . . . . .

. 0 - . . . . .

. . 0 . . . . .

. . . . . . . .

. . . . . . . .

. . . . . . . .

. . . . . . . .

43

(3.3-10)

However, the

matrix does not have an inverse based on the MATLAB program found in

Appendix A (program1)

Therefore to solve the problem, an iterative solution is offered as following:
(3.3-11) (3.3-12) (3.3-13)

The above format could be solved by the following pseudocode: Initialization: , , Create: Calculate: matrixes ,

Repeat: If Break; The program was written in Matlab ® M.file found in Appendix A (program 2). To ensure the algorithm works properly, a Gaussian fluctuation was added to the current. This means that while there is no fluctuation on the load current the or the load remains at

zero level because at that time, the battery is supposed to provide the current for the load. However, as soon as the load current starts to fluctuate, the algorithm forces the supercapacitor voltage to raise to be able to provide current for the current surge demand which happened on the load side.

44

Figure 3.3-1: The

responds to the sudden change in the

3.4

Further Improvement Based on Predicted Data

The described solution of problem 1 suffers from discontinuity between consecutive cycles, resulting in spikes in the supercapacitor voltage and current. In order to provide a smooth reference voltage of the supercapacitor, we add samples from the previous cycle to the calculation of the reference samples of supercapacitor of the next cycle.

There were two different sizes of matrix in the received data for
But M=N+2

and predicted data
(3.4-1)

:

The size of matrixes:

NxM=

Mx1= K=N+2

NxK =

Kx1=

(3.4-2) (3.4-3) (3.4-4)

To convert the method was used:

matrix that in this condition was N x M to a square matrix, the following
) x => B (N x 2) + ) + ) x

(3.4-5) 45

2+6 --4  0 . .  --4

--4 2+ 6 --4  . . 0 

 --4 2+6 --4 . . . 0

0  --4 2+6 . . . .

. 0  --4 . . . .

. . 0  . . . .

. . . 0 . . . .

. . . . . . . 

. . . . . --4 2+6 --4

. . . . .  --3 +3

B=

and

are the two final samples of the previous periods

The following pseudocode for the new program based on the above mentioned improvements is shown: Initialization: Create: Calculate: a, b, lambda, iter_max, Csc, ,

Repeat:

for iter_max iterations

The program was written in Matlab ®. (main.m &Find VSC.m) found in Appendix A (Program 3).

46

t
Fig.3.4-1. DC part and the Fluctuation of signal divided between the supercapacitor current and the battery current

As can be seen from the fig. 3.3-2, the written algorithm was able to divide the sample

signal

into two portions between the supercapacitor current and the battery current. However, this happened in a way that the DC part was driven from the battery and the fluctuated part was driven from the supercapacitor current. Even in the condition of a sudden change in the total rate of the load current's ( ) profile, the battery current share was still very smooth and the main changes and fluctuated parts were handled by the supercapacitor current. This could be a test or checking that the written algorithm works well and the applied solution is correct.

47

3.5

Future Load Profile

The problem at this point was how the load profile could be predicted for at least two periods ahead of the real time period. After the load current ( ) was measured and identified in the discreet manner with a transducer or a sensor from the load side, the n-1 and n were available. However to predict the load current profile the n+1 and n+2 were needed as well. Therefore a mathematic prediction method was required to build the future load consumption curve. The is obtained by linear prediction of the

There were a couple of ways to do this important job, such as using ARMA (Auto Regressive Moving Average), a Kalman Filter constraint or using the LPC (Linear Prediction Coefficients) in the Matlab. The ARMA method predicts completely with the stochastic method. A Kalman Filter uses probability and mathematics. LPC uses the autocorrelation method of autoregressive (AR) modeling to find the filter coefficients. Based on the Matlab Help," The Autocorrelation LPC block determines the coefficients of an N-step forward linear predictor for the time-series in each length-M input channel, u, by minimizing the prediction error in the least squares sense. A linear predictor is an FIR filter that predicts the next value in a sequence from the present and past inputs. This technique has applications in filter design, speech coding, spectral analysis, and system identification. The generated filter might not model the process exactly even if the data sequence is truly an AR process of the correct order because the autocorrelation method implicitly windows the data, that is, it assumes that signal samples beyond the length of x are 0. LPC computes the least squares solution to:" [71] =b where

,

,

48

And m is the length of x. Solving the least squares problem via the normal equations

Leads to the Yule-Walker equations

r = [r(1) r(2) ... r(p+1)] is an autocorrelation estimate for x computed using xcorr. The Yule-Walker equations are solved in O(p2) flops by the Levinson-Durbin algorithm [71], [82], [83], [84], [85], [86]. A Current Load profile downloaded from the Internet was as follows.

Current (A)

Time (Sec)
Figure 3.5-1. Part of the daily residential current consumption

A Matlab program was written to use the LPC command and predict the first predicted point found in Appendix A (Program 4). The program generated the error based on the different order of the LPC algorithm, which could be seen in the following graph:

49

Generated Error (A)

Order Number

Figure 3.5-2: Illustrates the error amount of the predicted current point for the order number of the LPC algorithm

The LPC with order number 45 is a best choice and provides less error. Although this order number is based on each load profile, in order to have a better understanding of the error generated by usage of the LPC algorithm two programs were written to generate a random load profile on each time (programs available in Appendix A, Program 5 & 6). The first one compares the load and its prediction and plots them on same graph with the difference error on each time.

50

Load Profile Predicted Profile

Current (A)

Time (Sec)
Figure 3.5-3: Load profile (darker color) and the predicted profile (lighter color)

Load Profile

Predicted Profile

Error (A)

Figure 3.5-4: Load and predicted profile and their generated error

51

The next program generated the predicted profile with LPC and then compared the two profiles based on different orders. In the next step, the program calculated the error on each order and plotted the graph of the error via order number. After prediction of the points, the two profiles (one random-generated and one generated based on the LPC prediction) were plotted on top of each other for the sake of comparison and the error was calculated for a different order of the LPC and plotted. This process was repeated a number of times by changing the amplitude and frequency of the signal to find the best combination and to select the best order of the LPC.

Load Profile

Predicted Profile

Figure 3.5-5: Load profile (Darker color) and the predicted profile (Lighter color) on one of the trials

Error (A)

Figure 3.5-6: The LPC order number via the amount of error in one of the trials

52

Further improvements on the program by usage of the LPC prediction program and the best LPC order with the fewest generated errors produced the following (program is found in Appendix A ­ program 7):

Current (A)

Voltage (V)

Current (A)

Current (A)

Time (Sec)
Figure 3.5-7: Load Current ( ), Supercapacitor Voltage ( ), Supercapacitor Current ( ) and Battery Current

after usage of the LPC prediction

By observation of the plots, it was realized that the algorithm was working properly by using prediction. This means that the main fluctuated part of the load current was transferred to the supercapacitor (+10 A to -10 A) and the lower fluctuation or noise type of ripple, which has no harm for the battery lifespan, remained on the battery current (+3 A to -3A).

53

3.6 Solution of the Problem two (Optimization)
A. Substitution and generating the main objective function:
Minimize
(3.6-1)

Subject to
(3.6-2) (3.6-3) (3.6-4) (3.6-5) (3.6-6)
and,

(3.6-7) a. Using Lagrange Function: (3.6-8)

(3.6-9)
i. Assume

Then
ii. But if

(3.6-10)

Then

(3.6-11)

The

values could be calculated from constraint's relations as per following formulas:

Based on the above optimization relations, the program was written in the MATLAB®. (Program 8 found in Appendix A).
54

Current (A)

Voltage (V)

Current (A)

Current (A)

Time (Sec)
Figure 3.6-1: Load Current ( ), Supercapacitor Voltage ( ), Supercapacitor Current ( ) and Battery Current by

usage of the optimization method

55

Current (A)

Time (Sec)
Figure 3.6-2: The Load Current ( Darker color) and the battery current (lighter color) on top of each other by usage of the optimization method

As could be observed from the plot results (figs 3.6-1 & 3.6-2), the

has much more fluctuation

with a high amplitude rate, which would cause damage to the battery (about +6 A to -5 A). The standard deviation for the battery current signal is about 4.095.

56

B. The modified optimization (contribution on the supercapacitor voltage differences):
After investigation and detailed analysis of the offered optimization technique and main objective function, it was realized that the contribution of the supercapacitor voltage term (the term that minimized the difference of the supercapacitor actual voltage and the voltage reference which was generated in the first algorithm) was not on the level that could have any significant influence on the optimization calculations. It means that the other characters in the main objective formula for optimization were in the second degree and only the voltage part was in the first degree. Therefore the offered optimization by [1] was modified as the following, and this is an amendment to the introduced problem 2:
Minimize (3.6-12)

and,

(3.6-13)

(3.6-14)

(3.6-15)

Based on the above optimization relations, the program was written in the MATLAB®. (Program 9 in Appendix A).

57

Current (A)

Voltage (V)

Current (A)

Current (A)

Time (Sec)
Figure 3.6-3: Load Current ( ), Supercapacitor Voltage ( ), Supercapacitor Current ( ) and Battery Current by usage of the optimization method based on the modification made by the author

Figure 3.6-4: Load Current, Supercapacitor Current, and Battery Current

58

Load Current

Current (A)

Battery Current

Time (Sec)
Figure 3.6-5: Illustrates the Load Current ( Darker Current) and the Battery Current ( Lighter Current) on top of each other by usage of the modified optimization method

As observed, the correction on the main objective function works under the favour of the modified optimization method. The graphs demonstrate that the load current demand was distributed in an optimized way between the battery and supercapacitor such that the whole load current dynamic and huge fluctuation (20 A) are demanded from the supercapacitor; the much lower noise or ripple type of fluctuation (3 to 5 A) on top of a steady DC current remains for the battery to provide. The standard deviation of the dynamics on the expected battery current's signal was about 2.15, which was far from the point that was harmful for the battery's lifespan.

59

Chapter 4
Theory of PV Modules Power Generation
4.1 Solar Photovoltaic Array
There are two significant elements that crucially affect the PV mathematical model's parameter computation: solar irradiation and temperature. There are different modeling technique approaches used, however the following technique has the most accurate parameter results. As we know, the photovoltaic cell converts the solar irradiation into the electrical current. It could be considered as a nonlinear current source.

There are three main types of solar photovoltaic cells available on the market: Monocrystalline, Poly-crystalline and Thin-Film (Amorphous Silicon). Actually, the photovoltaic cells are semiconductors, which have weakly bound electrons at their valance band level of energy. The photons' energy from sunlight breaks the bond of the electron and pushes it to pass its band gap and move it to the conduction band, which is the next energy level. This level of energy makes it possible for the electrons to move and conduct the electricity to the next cell and so on. Today, Mono- and Poly-crystalline PV cells are used the most.

Based on the theoretical analysis for the physical process that occurs during the electrical energy generation from solar irradiation on the photovoltaic cells, and based on all the factors influencing this process, a mathematical model could describe the whole system's characteristics and behaviour. The single diode equivalent circuit model is the most common mathematical model available that could predict and formulate the cells' outcome based on the rate of irradiation and temperature.

Fig 4.1-1: PV model

60

[ ] (4-1-1) or
: Photocurrent, V: Output voltage, : Current of parallel diode, D: Parallel diode, : Shunt current, : Shunt resistance,

(4-1-2) I : Output current, : Series resistance,

K = 1.38065 e -23 J/K Stephan-Boltzmann constant, q = 1.602 e -19 C Electron charge, = Reverse saturation current, (4-1-3) (4-1-4) (4-1-5) (4-1-6) (4-1-7) The following parameters are extracted from study and research of the references and from 230W Photovoltaic module BP 3230T: Parameters q k A0 Eg Tref S0 Ct Rs Rsh Isc Is0 Ns Np Values 1.6e-19 1.3806505e-23 1.2 1.12 25+273.15 1000 0.01 0.001 1000 8.4 2.16e-8 60 1 Shunt resistance Short-circuit current Saturation current Number of cells in series Number of cells in parallel Meanings Electron charge Stefan-Boltzmann constant Ideality factor of each cell Band energy of each cell Reference temperature Standard solar irradiation

61

4.2 Boost (Step-Up) DC/DC Convertor
By doing research and after careful consideration of the following parameters, like low power, simplicity, current output ripple, low cost, and high efficiency, the boost (step-up) configuration was selected to connect the PV panel to the system and apply MPPT control. In addition, the necessarily small size of its components, like inductor and capacitor at low power applications make it a good candidate to mount behind the PV panel. The boost is one of the most common DC/DC convertor topologies that are used for power applications. The boost contains a MOSFET switch, a diode, an inductor, and a capacitor. The conversion ratio among input and output voltages for the ideal boost converter depends on the switch's duty c ycle based on following formula (D is the Duty Cycle): (4-2-1) As the boost or step­up always provides a higher voltage at the output in comparison with the input, this will give the suitable, higher voltage that is expected and required at the bus to the inverter. It means that the DC/DC converter (boost) will increase the PV output voltage and decrease the output current, which will decrease the cabling losses. A boost converter could operate in the CCM (Continuous Condition Mode) and DCM (Discontinuous Condition Mode). These two modes have their own advantages and disadvantages with a trade-off role when selecting either of them. To keep the mode in the CCM, the following formula will help to find the required inductor for the design. (4-2-2) To find the capacitor size for adjusting the required voltage ripple, the following formula is used: (4-2-3)

62

4.3

PV Modules (PV Array with DC/DC and MPPT Controller)

To extract the maximum power generated by the PV array during different outside situations, a MPPT (Maximum Power Point Tracking) controller has to be used. Different outside situations could happen by the maximum or minimum (partial shading) irradiation intensity or high or low temperature degrees. There are different MPPT algorithms available like the Perturb and Observe (Hill Climbing) method and/or the Incremental Conductance method. However, there are different measures for comparison in terms of their performance, accuracy, error, simplicity, and efficiency. One of the popular techniques for the MPPT controller that is used in this project is the Perturb and Observe (PO) method. Although it has some drawbacks, like the step progressive nature of the controller, which is slow, it is the most widely used method due to its simplicity. In the following the block diagram, the method is shown:
Measure V(K),I(K)

Calculate Power P(K) = V(K)I(K)

P No V V=V(K)>V(K-1)? No Yes No P(K)>P(K-1)? V V

P Yes V V=V(K)>V(K-1)? Yes

Vref(K+1) = Vref(K)+| V|

Vref(K+1) = Vref(K)-| V|

Vref(K+1) = Vref(K)-| V|

Vref(K+1) = Vref(K)+| V|

Return

Figure 4-3-1: Illustrates the Perturb and Observe scheme (Hill Climbing) block diagram

63

A program written in Matlab on the above-provided block diagram was applied to the Simulink mathematical model as the S-Function (available in Appendix A ­ program 10)

4.4

Cascading the PV Modules and Fixing the Voltage

There are several methods to fix the voltage and keep the power drop at its minimum rate. In this project to achieve the fixed voltage needed for the bus and to keep the power in an acceptable rate, the PV modules were cascaded or serried in a group of four and connected to a buck DC/DC converter (Step-Down Converter). A closed loop voltage controller was designed to fix the voltage at the needed rate. By cascading the PV modules, the voltage and the power were added and then the step-down converter (Buck) with the help of the PI controller dropped the voltage and fixed it to the required voltage. The following formula was used to design the buck converter and the PI parameters were tuned by trial and error (D is the Duty Cycle).

CCM Condition: Ripple:

4.5

Connecting the PV Module Cascade's Packages in Parallel

To achieve the microgrid's required power, the built PV module cascade's package will be connected in parallel with each other via a transmission bus. By this method, their power will be added and the fixed voltage will remain constant through the transmission bus. The related Simulink mathematical model is built. The model consists of ten cascaded PV module packages so that each one includes four PV module arrays inside. It means that forty PV module arrays are presented here with each one generating 206 W (the PV array itself generates 240 W and 30 W is the power loss of each based on the switching and other sources of loss) therefore in total, this system generates 8140 W at 110 V and 74 A, (current variation depends on the load).

64

4.6

The Grid

In this project there is a requirement to build a mathematical model for the grid to connect the project's generation system to this grid model for the sake of synchronization, power factor correction reference, and comparison. As the generated voltage has to be synchronized with the grid voltage, a PLL system will read the grid voltage phase in real time and send this phase reference data to the inverter, which will convert the generated DC voltage to AC voltage so that it complies with this phase reference. This will synchronize the generated AC voltage with the grid voltage. A random phase change system was designed on the grid model to demonstrate the actual situation of the grid voltage. On top of that, this would demonstrate the PLL performance on monitoring the changed phase amount and synchronization process. Plus, a uniform random source of noise (white noise) was added to the generated grid voltage, as it is available on the real grid. This could help to design the appropriate filter for the project system wherever a signal would want to be read from the grid.

4.7

PLL (Phase Lock Loop)

To synchronize the generated voltage waveform from the PV Modules with the grid's voltage waveform, a PLL (Phase Lock Loop) should be designed to measure the phase of the grid's voltage waveform in real time. The PLL measures the grid's voltage phase and extracts the value in a real-time fashion. That phase angle will then be used as a reference for generating gate signals for the inverter via a PWM module. This will synchronize the converted AC voltage to DC generated by PV modules at the inverter with the voltage waveform at the grid.

First, the waveform of the grid is required to be measured by a voltage sensor and converted to a digital signal by an A/D (analogue to digital) device. The sampler will then take samples from the digitized voltage waveform in real-time fashion via an identified rate. Then the digitized samples will be fed into the microprocessor (DSP). The microprocessor uses the FFT algorithm (fast Fourier transform) and computes the Fourier transform, which converts the digitized signal's samples to the frequency domain. This will provide a complex result that consists of
65

magnitude and angle (phase). Moreover, the angle data part of the complex result will be converted to the time domain by a D/A (digital to analogue) device. Furthermore, a modulated signal will be generated. The result will be the source for extracting the gating signals after merging with a carrier-repeating signal and generating PWM.

4.8 Active Filter

Power quality is one of the major factors that a power generating system must consider in its design. In the case of nonlinear loads, their consumed power will have distorted parameters such as non-unity power factors, non-sinusoidal current waveform shapes, and increases in voltage and current THD (Total Harmonics Distorted) percentages. From the other side, there are a number of standards that the generated power has to meet. Without applying the electrical standards like IEEE 519 and IEEE 1547, the power-generating unit will not receive the permission to be connected to the utility grid. IEEE 519 provides the basis for limiting voltage/current harmonics and the IEEE 1547 discusses the potential impact on operation of distributed generation systems both to and from grid-connected operation.

In this project, an active filter is used to protect and filter the power quality of the generated power based on the required standards. This is a mature and popular technology available in the industry for years. The active filter is a full bridge converter or VSC, which is used in rectify manner (inverse) and connected to the output node parallel to the grid and/or load. The active filter and its designed control unit act as a compensating load for the system. This means that the filter will draw current from the system so that its waveform's shape is the complement of the waveform's shape from the connected nonlinear load's current in proportion to the sinusoidal shape. This will force the generated current's waveform shape to be the exact sinusoidal shape.

The second function for the active filter is the elimination of the voltage/current harmonics produced by distorting loads. The design of the control is very important for the harmonic elimination. The third function of the active filter is the correction of the power factor and improving it to approach the unity. This function will eliminate the reactive power generation

66

and as a result, the system purely generates the active power. In other words, this will decrease the losses and increase the overall efficiency. In addition, the fourth function of the active filter is its production of DC voltage, which is used for the battery charger in this project. After the active filter, a voltage controller fixes the produced DC voltage and charges the battery bank. Furthermore, a voltage sensor measures the voltage in real time and sends the signal to the charger controller for monitoring the charging process.

Figures 4.5-1, 4.5-2, 4.5-3 show the built Simulink model for the active filter subsystem, which is connected in parallel to the circuit where it is connected between the PV system and the grid that is connected to a non-linear load. As is shown in figure 4.5-4, the active filter and the way in which its controller was designed and tuned consumed the current in such a manner that its waveform shape is the exact compliment, or reverse shape, of the nonlinear load's consumed current. This is the reason the filter forced the generated PV current's shap e to be at the sinusoidal form. Moreover, one of the sources for generating the gating signal for the active filter is the PV voltage. That is the main reason the consumed current will approach synchronization with the PV generation voltage, which will cause the power factor to approach unity. It means that the consumed current from the PV will approach the same phase angle with the generated voltage of the PV.

67

Chapter 5

Numerical Results and System Simulation
5.1 Solar Photovoltaic Array Modeling and Simulation

Based on the given equations on chapter section 4.1 and the 230W Photovoltaic module BP 3230T's parameters a Matlab® Simulink model was built and the following block diagram present that model.

Figure 5.1-1: PV model block diagram

Figure 5.1-2: The two graphs illustrate the Output Power Vs Voltage, and Current Vs voltage curves based on the mathematical extracted model at 1000W/ irradiation and 25°C temperature.

68

5.2

Boost, (Step-Up) DC/DC Convertor Model

The boost (step-up) configuration was selected to connect the PV panel to the system and apply MPPT control. In addition, the necessarily small size of its components, like inductor and capacitor at low power applications make it a good candidate to mount behind the PV panel. The boost is one of the most common DC/DC convertor topologies that are used for power applications. The boost contains a MOSFET switch, a diode, an inductor, and a capacitor. At the following, the built Matlab® Simulink model for the boost connected to the PV model is shown:

Figure 5.2-1: the PV and Boost DC/DC Converter

69

5.3

PV Modules (PV array with DC/DC and MPPT Controller) model

To extract the maximum power generated by the PV array during different outside situations, a MPPT (Maximum Power Point Tracking) controller has to be used. At the following the block diagram from the built Matlab® Simulink model is shown. Fig 5.3-2 illustrates the diagram curvature for the extracted power by the MPPT controller of the simulation result of the built model.

Figure 5.3-1: MPPT controller which is used for the PV array by usage of the closed loop on the DC/DC Boost Converter block diagram.

Power (W)

Time (SEC)
Figure 5.3-2: The Power vs. Time curve while the MPPT controller operation

70

5.4 Cascading the PV Modules and Fixing the Voltage model
In this project to achieve the fixed voltage needed for the bus and to keep the power in an acceptable rate, the PV modules were cascaded or serried in a group of four and connected to a buck DC/DC converter (Step-Down Converter). The following block diagram shows the built mathematical Simulink model for the PV cascade voltage regulating process.

Figure 5.4-1: Block diagram of the Group of four of PV modules which connected to the DC/DC converter with voltage controller

71

Voltage (V)

Time (SEC)
Figure 5.4-2: Voltage vs. Time curve while the controller fixed the voltage at 110V

72

5.5

Connecting the PV Module cascade's packages in Parallel model block diagram

To achieve the microgrid's required power, the built PV module cascade's packages will be connected in parallel with each other's via a transmission bus. By this method, their power will be added and the fixed voltage will remain constant through the transmission bus. The related Matlab® Simulink mathematical model is built and the block diagram is shown at the following:

Figure 5.5-1: built PV mathematical model cascade's packages which are parallel by each other's via the dc -bus block diagram

73

5.6

Modeling of the Grid

In this project there is a requirement to build a mathematical model for the grid to connect the project's generation system to this grid model for the sake of synchronization, power factor correction reference, and comparison. At the following the block diagram of the built Matlab® Simulink model and the generated voltage wave form is shown:

Figure 5.6 -1: the built Grid model (110 V, 60 Hz) which has the Random Phase Change System and has Uniform Random Source of Noise.

Voltage (V)

Phase Changed Phase Changed Time
Figure 5.6 -2: The generated Grid voltage waveform, from the grid mathematical model (110 V, 60 Hz) and the Phase changer pulses, the phase changed locations are Shown.

74

5.7

Phase Lock Loop (PLL) model

To synchronize the generated voltage waveform from the PV Modules with the grid's voltage waveform, a PLL (Phase Lock Loop) should be designed to measure the phase of the grid's voltage waveform in real time. At the following the built Matlab® Simulink PLL model's block diagram and the wave form result is illustrates:

Figure 5.7-1: The built Synchronizing section model block diagram including PLL subsystem and the Inverter which generate AC signal based on the grid phase change and from the PV-Modules

Figure 5.7-2: The PLL subsystem

75

Figure 5.7­3: The D/A subsystem

Grid Generated

Voltage (V)

Time (SEC)
Figure 5.7 ­4: The Grid and the Generated voltage waveforms, the effect of the PLL which cause the generated voltage to follow and catch the grid voltage phase in a short delay time is shown

76

5.8

Active Filter Model

Active filter is used to protect and filter the power quality of the generated power based on the required standards. This is a mature and popular technology available in the industry for years. The active filter is a full bridge converter or VSC, which is used in rectify manner (inverse) and connected to the output node parallel to the grid and/or load. The following block diagram shows the active filter and the way it is connected to the micrigrid system:

Figure 5.8 -1: the built model for Active filter subsystem which is connected in parallel on the point where the PV's AC generator connected to the Grid and to a nonlinear load

77

10

Filter consumed current-Brown Nonlinear Load Current-Orange

8

6

4

2

Current (A)

0

-2

-4

-6

PV Current, Forced to Sinusoidal -Blue

-8

-10

0.64

0.645

0.65

0.655

0.66

0.665

0.67

0.675

0.68

Time (SEC)
Figure 5.8 -2: The current waveforms from the PV after the filter was connected, the consumed load current, and the consumed filter current

Furthermore the active filter cause the generated current from the PV to have less than 5% of the THD (Figure 5.8 -4) which generated without the active filter (Figure 5.8 -3). This will allow the PV system's generated current harmonics to comply based on the IEEE standard 519 -1992 requirements (Table 5.8 -1).

78

Figure 4.8-3: The current's harmonics from the PV when the filt er was not connected, for a nonlinear load, THD = 30.99 %

Figure 4.8 -4: The current's harmonics from the PV when the filter was connected, for a nonlinear load, THD = 1.4 % which is 4.5% of the no active filter condition

79

Table 5.8 -1: IEEE Std 519-1992 Harmonics Current Limits

Grid Side

Figure 5.8 -5: The generation Simulink model at which the PV Module's Package equipped with the PLL and Active filter connected to the Grid, while a nonlinear load is connected to the Grid

80

5.9

The controller Model and Simulation

Conversion of the Matlab M. files to the S ­ Function files
In order to simulate the written mathematical algorithm and Matlab programs as a single control unit they should be converted to the S- Function. The S- Function could use the written Matlab M files in the Simulink. To do so the written Matlab files were converted to a close loop models of S-Function subsystem blocks based on their priority and functionalities. At first the prediction part was converted and the program was written which is available at Appendix A (program 11).

At the next step was to design a buffer to send the information data like an array one cell by one cell inside it to store and send them to the next step by correct rate for doing the process calculations (the program 12 available at Appendix A). Then the VSC was optimized in the next step and the program is at Appendix A (program 13). Then again a un buffer was used to separate the data and send it to the next step with a suitable rate (program 14 at Appendix A). At the last section the parameters were calculated like the battery current and the super-capacitor current. (program 15 at the Appendix A). At the following the whole control circuit is illustrated in the s-function format:

Figure 5-9-1: The s-function model of the algorithm controller

81

The result of the converted controller algorithm to the s-function is illustrated as following:

Voltage (V)

Voltage (V)

Current (A)

Current (A)

Current (A)

Current (A)

Time (Sec)
Fig5.9 -2: Illustrate the input and output signals to and from the controller

As it is shown from the above diagram the input

which is the load current is very close to the

predicted signal and almost all of its fluctuation or its AC part (dynamic section) was transferred to the super/capacitor and only the DC part (steady section) was provided by the battery (with very low noise or ripples) which is what it was expected from this algorithm and or controller.

82

5.10 Micro Grid (smart home) model and Simulation
To test and simulate the system a Matlab® Simulink model is built; and the converted sfunction closed loop controller subsystem is placed in the main Smart-Home grid tied system model. To do so each appliance is modeled based on its mechanism. For instance the washing machine, Dish washer are modeled with induction motors and their drives. The Vacuum and Refrigerator are modeled with DC motors and their corresponding electronic drives. The Range, Oven, TV, lamp, Light bulb and heater are modeled as a resistor. All of them are parallel to each others as per following:

Figure 5.10 -1: The Smart Home part model's block diagram of the micro-grid

83

Figure 5.10 -2: The presented Micro Grid system configuration block diagram in connection to the Home and the Grid network

84

60

50 40 30

Load Current

Current (A)

20

10

0 -10 -20 0.31 0.32 0.33 0.34 0.35 0.36 0.37 0.38 0.39 0.40

Time (Sec)
50

Time (Sec)
40

Battery Current

30

20

Current (A)
10 0

-10

-20 0.31 0.32 0.33 0.34 0.35 0.36 0.37 0.38 0.39 0.40

Time (Sec)
50 40

Super-cap Current

30

Current (A)

20

10

0

-10 0.31 0.32 0.33 0.34 0.35 0.36 0.37 0.38 0.39 0.40

Time (Sec)
Figure 5.10 -3: load consumed current which is about 55A AC ride on top of 20A DC, the energy flow management control managed to force the battery current to be 20A DC with 7A ripple and the super-capacitor current to be 55A AC with no DC

85

In further improvement of the microgrid model, the energy flow management system (EFMS) was added. This improvement means that a number of switches were added on the input lines of different components in the micro-system in addition to a smart controller to manage different statuses for the microgrid system and different paths for the energy flow. There are four statuses defined on the system that depend on the amount of generated power. At the first status, the system does not charge the batteries and give power to the home and grid. The second status charges the battery and gives power to the home. The third status discharges the battery and gives the power to home. The last status, or number four, uses the grid to feed the home and charge the batteries. The next improvement to the system, which will be considered shortly, is to connect this microgrid system to the Internet and use weather broadcasting in order to select the status of the system more efficiently. This efficiency means that on partially cloudy days the system will only charge the battery and use the grid to feed the home, and on sunny days the system will charge the battery, feed the home and sell power to the grid automatically.

Figure 5.10 -4: further improvement and master control presented for whole Micro Grid system, block diagram

86

Figure 5.10 -5: Master Controller hierarchy block diagram

87

Chapter 6
Parameter Analyze, Evaluation and Comparison
As it was explained the main concentrate of this master thesis is the HESS controller, therefore the following parameter analyses, evaluation, and comparison is concentrates on this part.

A. Parameter Analysis
We have developed three parameter analysis for parameters of linear predictor ( optimization stage (I) ( For analyzing ), and optimization stage (II) ( ). ),

, we have established an experimental setup in which the root-mean-square-

error (RMSE) of predicting 1000 samples of simulated load currents are calculated. For each {1, ..., 100}, we repeated the prediction of simulated signals for 30 times to reduce the noise effect. The parameter analysis of = 40. is in Fig. 2-2. Based on the analysis results, we set

Figure 6-1: Displaying analysis of linear prediction order

In the second part of parameter analysis, we establish an experiment to analysis effects of {0.1, 0.11, ..., 4}, and

,

and itr by calculating the standard deviation of battery current, aiming to minimize the deviation of battery current. In this experiment, for each set of {0.1, 0.11, ..., 4}, we repeat the process of 2000 samples for 30 times, and calculate the average standard deviation. The parameter analysis of results, we set and and is represented in Fig. 2-3. Based on the analysis

= 1.1. Also, itr has been analyzed (Fig. 2-4), and based on the

analysis, it is set to itr =21. We repeat the same experiment for the parameters of the
88

optimization problem II, = 2.4.

,

, and the result is shown in fig. 2-5. Thus, we set

= 1.5 and

(A)

(1/A)

(1/A)
and of optimization problem I.

Figure 6-3: Displaying parameter analysis of

9 8 7
B

i

6 5 4 3 0 21 50 100 150 iteration 200 250 300

(A)

Figure 6-4: Displaying parameter analysis of itr of optimization problem I.

89

(A)

(1/A)
(A)

(1/A)
Figure 2-5: Displaying parameter analysis of and of optimization problem II.
(A)

B. Evaluation and Comparison of the proposed method
We have compared the proposed method with Choi [1]. We define three metrics to compare the methods as,

Where

and N are the standard deviations of battery and load currents,

mean of battery and load currents and the number of experiments, of load and battery currents. The ideal case should have , and . We repeat the experiment for N = 30 to

make sure the methods are fairly compared. The evaluation results are shown in table 2-1. Accordingly, the proposed method provides more damping of the battery current fluctuations by , while preserving the mean load current by [1] method with and compared to Choi et al.

. In other words, the proposed hybrid power

energy management system manages to extract most of the load current's fluctuations from the

90

super-capacitor and a fairly steady current from the battery respectively. damped current fluctuations on the battery current, and (%) ratio of the standard deviation of the battery and load currents over the number of experiments 99.63

Shows the ratio of

reflects the similarity of the averages Standard deviation of the Battery over the number of experiments 3.8449

Method Proposed Method

(%) ratio of the mean of the battery and load currents over the number of experiments 61.91

Choi et al. Method

98.67

20.87

8.0284

Table 6-1: Comparing the proposed method with Choi et al. [1] As we can see from the table 2-1 of the results from the comparison experiment on the presented method and the Choi [1] method; our proposed method has a better performance on lower standard deviation of battery's current, higher ratio of damped fluctuations on battery's current, and higher similarity of the average of the load and battery current. These all shows that this master thesis's presented HESS controller could damp the Battery current fluctuation in an excellent way which guaranty a long battery life and cost effectiveness of the system.

Figure 6 -1: the comparison diagram of presented algorithm's battery current result and the competitor Choi[1] battery current result

91

Chapter 7
CONCLUSION
To wrap up, the starting problems one and two in the presented HESS controller, which were nonlinear systems of equations, were solved with the help of the Lagrange Function and then were converted to matrixes and computed iteratively by the Newton-Raphson method. In total, from the solved problems and presented contributions, we built an algorithm of a power flow management controller for the micro-grid's storage backup system. The HESS controller was evaluated by the parameter analyses and compared with the state-of-the-art. In the comparison it was shown that the presented controller has a higher ability to minimize the battery current's variation in comparison to the competitor's method. This will increase the battery life cycle and make the system more energy efficient and cost effective. In addition, the HESS controller was verified by the two simulation methods. The presented HESS could be used in different applications like hybrid electric vehicles, renewable energy systems and others.

The PV modules generation section used the MPPT controller convenience for solving the partial shading problem on each PV array. This will increase the power generation collection rate from the PV array groups on partially cloudy days. This section provides the generated power synchronization with the grid based on the standard requirements to sell the power to the grid. These functions are to be done using the PLL and active filter. The PLL applies the synchronization and the active filter provides the power factor correction, reshaping the generated voltage to sinusoidal, and reduces the current harmonics distortion at a significant rate. The last function of the active filter is rectifying and providing the DC voltage to help the charging of the battery and the supercapacitor. Moreover, the voltage rate is regulated with help of a controller. Figures 5.10-6 and 5.10-8 show the whole microgrid system configuration presented in this thesis project in connection with the home and grid network.

The located switches will be controlled with a logic, which gives the convenience of full remote control over different working arrangements of the system. It means that the microgrid
92

system automatically controls between different functions like PV-generation, charging the storage system, selling power to the grid, sending the power to the home, and/or directing power to the home from the grid. Moreover, the system figure 4.10-7 illustrates the load current, battery current, and the super-capacitor current. As could be observed, the presented energy management system manages to draw almost DC current from the battery and the AC part was provided by the super-capacitor, which was one of the main goals of this thesis project.

93

Appendix A
Program 1:
clc clear all close all N=10; syms a; syms b; Aux=[b,-a-4*b,2*a+6*b,-a-4*b,b]; for i=2:N ind=i-2:i+2; ind(find(ind<1))=ind(find(ind<1))+N; ind(find(ind>N))=ind(find(ind>N))-N; A(i,ind)=Aux; end A(1,1)=1; A(1,N)=-1; inv(A)

Program 2:
clc clear all close all % ========================================================================= % Initialization % ========================================================================= a=1; b=1; Delta=1/(180*60); N=fix((1/Delta)*(1/60)); %init im il=ones(N,1); il(fix(N/2))=10; il=imfilter(im,gausswin(fix(N/5)),'symmetric'); figure; subplot(2,1,1);plot(il); iter_max=100; lambda=1; Vsc=zeros(N,1); Vsc_last=Vsc; Aux=[b,-a-4*b,2*a+6*b,-a-4*b,b]; for i=2:N ind=i-2:i+2; ind(find(ind<1))=ind(find(ind<1))+N; ind(find(ind>N))=ind(find(ind>N))-N; Msc(i,ind)=Aux; end Msc(1,[1 N])=[1 -1];

94

Aux=[b,-a-3*b,a+3*b,-b]; for i=2:N ind=i-1:i+2; ind(find(ind<1))=ind(find(ind<1))+N; ind(find(ind>N))=ind(find(ind>N))-N; Mim(i,ind)=Aux; end % ========================================================================= % Calculate matrix A1 and A2 % ========================================================================= A1=(Msc+lambda*eye(N))^-1; A2=A1*Mil*il; % ========================================================================= % Iterative solution of the optimization problem % ========================================================================= for iter=1:iter_max iter Vsc=A1*(lambda*Vsc_last)+A2; dif=norm(Vsc-Vsc_last) Vsc_last=Vsc; if(dif<1) %break; end end subplot(2,1,2);plot(Vsc);

Program 3:
clc clear all close all % ========================================================================= % Simulate load current % ========================================================================= F=0.2; spc=100; % samples per cycle Fs=F*spc; T=1/(F*spc); Nc=1; % number of cycles Ns=Nc*spc; % number of samples idc=1; Ffl=5; % fluctuation frequency iL=[idc*ones(1,Ns/2),1.5*idc*ones(1,Ns/2)]+[0.2*sin(2*pi*(Ffl/Fs)*(1:Ns/2)),0 .4*sin(2*pi*(5/Fs)*(1:Ns/2))]; Vsc=zeros(1,Ns); isc=zeros(1,Ns); Csc=10; % Capacitor of Super-Capacitor Vsc_max=10; % ========================================================================= % Processing Pipeline % ========================================================================= vsc=zeros(2,1); for cno=1:Nc cno if(cno==1) if(Nc==1)

95

iLpnc=[0,iL((cno-1)*spc+1:(cno)*spc),0,0];% select predictive iL for the next cycle else iLpnc=[0,iL((cno-1)*spc+1:(cno)*spc+2)];% select predictive iL for the next cycle end else if(cno==Nc) iLpnc=[iL((cno-1)*spc:(cno)*spc),0,0];% select predictive iL for the next cycle else iLpnc=iL((cno-1)*spc:(cno)*spc+2);% select predictive iL for the next cycle end end Vsc((cno1)*spc+1:(cno)*spc)=Find_Vsc(iLpnc,vsc,T,spc,Csc,Vsc_max,0.5,0.5,1,20); vsc=Vsc((cno)*spc-1:(cno)*spc)'; end isc(2:end)=-Csc*(Vsc(2:end)-Vsc(1:end-1))/T; ib=iL-isc; % ========================================================================= % Displaying Results % ========================================================================= figure; padding_right=0; subplot(4,1,1);plot((1:Ns-padding_right)/Fs,iL(1:Ns-padding_right)); xlim([0 Ns/Fs]) title('iL'); subplot(4,1,2);plot((1:Ns-padding_right)/Fs,Vsc(1:Ns-padding_right)); xlim([0 Ns/Fs]) title('Vsc'); subplot(4,1,3);plot((1:Ns-padding_right)/Fs,isc(1:Ns-padding_right)); xlim([0 Ns/Fs]) title('isc'); subplot(4,1,4);plot((1:Ns-padding_right)/Fs,ib(1:Ns-padding_right)); xlim([0 Ns/Fs]) title('ib');

function Vsc=Find_Vsc(im,vsc,Delta,N,Csc,Vsc_max,a,b,lambda,iter_max) % ========================================================================= % % % ========================================================================= % Initialization % ========================================================================= if(nargin<6) a=1; else if(nargin<7) b=1;

96

else if(nargin<8) lambda=1; else if(nargin<9) iter_max=30; end end end end Aux=Csc*[b,-a-4*b,2*a+6*b,-a-4*b,b]; Msc_=zeros(N,N+4); for i=1:N ind=i:i+4; Msc_(i,ind)=Aux; end B=Msc_(:,1:2); Msc=Msc_(:,3:N+2); Msc(:,N)=Msc(:,N)+Msc_(:,N+3)+Msc_(:,N+4); Mim=zeros(N,N+3); Aux=[b,-a-3*b,a+3*b,-b]; for i=1:N ind=i:i+3; Mim(i,ind)=Aux; end Vsc=zeros(N,1); Vsc_last=Vsc; % ========================================================================= % Calculate matrix A1 and A2 % ========================================================================= A1=(Msc+lambda*eye(N))^-1; A2=Delta*A1*Mim*im'; % ========================================================================= % Iterative solution of the optimization problem % ========================================================================= for iter=1:iter_max Vsc=max(min(A1*(lambda*Vsc_last-B*vsc)+A2,Vsc_max),0); dif=norm(Vsc-Vsc_last); Vsc_last=Vsc; end

Program 4:
clc clear all close all % ========================================================================= % genrate simulated data % ========================================================================= Total_Sec=1*60; Sampling_Freq=100; n=1:Total_Sec*Sampling_Freq; F_low=0.01;

97

Amp=10*(rand(1,fix(Total_Sec/5))*0.5+0.5); Amp_high=interp1(1:Sampling_Freq*5:Sampling_Freq*Total_Sec,Amp,1:Total_Sec*Sa mpling_Freq,'cubic'); Freq=rand(1,fix(Total_Sec/10))*0.5+1; F_high=interp1(1:Sampling_Freq*10:Sampling_Freq*Total_Sec,Freq,1:Total_Sec*Sa mpling_Freq,'cubic'); phi=rand(1,1)*2*pi; x=20+10.*cos(phi+(2*pi*(F_low/Sampling_Freq)).*n)+Amp_high.*cos((2*pi.*(F_hig h/Sampling_Freq)).*n)+0.5*randn(1,Total_Sec*Sampling_Freq); figure; plot(n/Sampling_Freq,x) % ========================================================================= % Predict % ========================================================================= err=zeros(200,100); for P_lpc=1:100 P_lpc N_lpc=Sampling_Freq*40; est_x=x; for k=1:200 sub_x=x(k:N_lpc+k); a = lpc(sub_x,P_lpc); x_n=sum(-a(2:end).*sub_x(end:-1:end-P_lpc+1)); err(k,P_lpc)=(x(k+N_lpc+1)-x_n); end end %% figure;plot(mean(err.^2),'b');

Program 5:
clear all close all % ========================================================================= % genrate simulated data % ========================================================================= Total_Sec=1*60; Sampling_Freq=100; n=1:Total_Sec*Sampling_Freq; F_low=0.01; Amp=10*(rand(1,fix(Total_Sec/5))*0.5+0.5); Amp_high=interp1(1:Sampling_Freq*5:Sampling_Freq*Total_Sec,Amp,1:Total_Sec*Sa mpling_Freq,'cubic'); Freq=rand(1,fix(Total_Sec/10))*0.5+1; F_high=interp1(1:Sampling_Freq*10:Sampling_Freq*Total_Sec,Freq,1:Total_Sec*Sa mpling_Freq,'cubic'); phi=rand(1,1)*2*pi; x_input=20+10.*cos(phi+(2*pi*(F_low/Sampling_Freq)).*n)+Amp_high.*cos((2*pi.* (F_high/Sampling_Freq)).*n)+0.5*randn(1,Total_Sec*Sampling_Freq);

98

% ============================================================================= ================= % Filter Design % ============================================================================= ================= alpha=0.8; x(1)=0; for i=2:length(x_input) x(i)=alpha*x(i-1)+(1-alpha)*x_input(i); end figure; plot(n/Sampling_Freq,x_input) hold on; plot(n/Sampling_Freq,x,'r') % ========================================================================= % Predict % ========================================================================= % Select a good P_lpc % ========================================================================= % err=zeros(200,100); % for P_lpc=1:100 % P_lpc % N_lpc=Sampling_Freq*40; % est_x=x; % for k=1:200 % sub_x=x(k:N_lpc+k); % a = lpc(sub_x,P_lpc); % x_n=sum(-a(2:end).*sub_x(end:-1:end-P_lpc+1)); % err(k,P_lpc)=(x(k+N_lpc+1)-x_n); % end % end %figure;plot(mean(err.^2),'b'); %% for P_lpc=10:10:1000 P_lpc for i=1:20 x=20+10.*cos(phi+(2*pi*(F_low/Sampling_Freq)).*n)+Amp_high.*cos((2*pi.*(F_hig h/Sampling_Freq)).*n)+0.05*randn(1,Total_Sec*Sampling_Freq); err=zeros(100,1); %P_lpc=150; N_lpc=Sampling_Freq*40; sub_x=x(N_lpc:-1:1); x_est=zeros(100,1); x_org=zeros(100,1); a = lpc(sub_x,P_lpc); for k=1:100 x_n=sum(-a(2:end).*sub_x(1:P_lpc)); x_est(k)=x_n; x_org(k)=x(N_lpc+k); sub_x=[x_n,sub_x(1:end-1)]; error_=abs(x(N_lpc+k)-sub_x(1)); err(k)=error_; end error(P_lpc/10,i)=mean(err);

99

end end error_lpc=mean(error,2) figure; subplot(2,1,1);plot(x_org,'b');hold on;plot(x_est,'r'); axis tight; subplot(2,1,2);stem(err); axis tight;

Program 6:
clc clear all close all % ========================================================================= % genrate simulated data % ========================================================================= Total_Sec=1*60; Sampling_Freq=100; n=1:Total_Sec*Sampling_Freq; F_low=0.01; Amp=10*(rand(1,fix(Total_Sec/5))*0.5+0.5); Amp_high=interp1(1:Sampling_Freq*5:Sampling_Freq*Total_Sec,Amp,1:Total_Sec*Sa mpling_Freq,'cubic'); Freq=rand(1,fix(Total_Sec/10))*0.5+1; F_high=interp1(1:Sampling_Freq*10:Sampling_Freq*Total_Sec,Freq,1:Total_Sec*Sa mpling_Freq,'cubic'); phi=rand(1,1)*2*pi; x_input=20+10.*cos(phi+(2*pi*(F_low/Sampling_Freq)).*n)+Amp_high.*cos((2*pi.* (F_high/Sampling_Freq)).*n)+0.5*randn(1,Total_Sec*Sampling_Freq); % ============================================================================= ================= % Filter Design % ============================================================================= ================= alpha=0.8; x(1)=0; for i=2:length(x_input) x(i)=alpha*x(i-1)+(1-alpha)*x_input(i); end figure; plot(n/Sampling_Freq,x_input) hold on; plot(n/Sampling_Freq,x,'r') % ========================================================================= % Predict % ========================================================================= % Select a good P_lpc % ========================================================================= % err=zeros(200,100); % for P_lpc=1:100 % P_lpc

100

% N_lpc=Sampling_Freq*40; % est_x=x; % for k=1:200 % sub_x=x(k:N_lpc+k); % a = lpc(sub_x,P_lpc); % x_n=sum(-a(2:end).*sub_x(end:-1:end-P_lpc+1)); % err(k,P_lpc)=(x(k+N_lpc+1)-x_n); % end % end %figure;plot(mean(err.^2),'b'); %% for P_lpc=10:10:1000 P_lpc for i=1:600 Amp=10*(rand(1,fix(Total_Sec/5))*0.5+0.5);%change 10 from 1 to 20 dev:1 Amp_high=interp1(1:Sampling_Freq*5:Sampling_Freq*Total_Sec,Amp,1:Total_Sec*Sa mpling_Freq,'cubic'); Freq=rand(1,fix(Total_Sec/10))*0.5+1;% change 1 from 1 to 4 dev:0.5 F_high=interp1(1:Sampling_Freq*10:Sampling_Freq*Total_Sec,Freq,1:Total_Sec*Sa mpling_Freq,'cubic'); phi=rand(1,1)*2*pi; x=20+10.*cos(phi+(2*pi*(F_low/Sampling_Freq)).*n)+Amp_high.*cos((2*pi.*(F_hig h/Sampling_Freq)).*n)+0.05*randn(1,Total_Sec*Sampling_Freq); err=zeros(100,1); %P_lpc=150; N_lpc=Sampling_Freq*40; sub_x=x(N_lpc:-1:1); x_est=zeros(100,1); x_org=zeros(100,1); a = lpc(sub_x,P_lpc); for k=1:100 x_n=sum(-a(2:end).*sub_x(1:P_lpc)); x_est(k)=x_n; x_org(k)=x(N_lpc+k); sub_x=[x_n,sub_x(1:end-1)]; error_=abs(x(N_lpc+k)-sub_x(1)); err(k)=error_; end error(P_lpc/10,i)=mean(err); end end error_lpc=mean(error,2) figure; stem(10:10:1000,error_lpc) % figure; % subplot(2,1,1);plot(x_org,'b');hold on;plot(x_est,'r'); % axis tight; % subplot(2,1,2);stem(err); % axis tight;

101

Program 7:
clc clear all close all % ========================================================================= % Simulate load current % ========================================================================= F=0.2; spc=20; % samples per cycle Fs=F*spc; T=1/(F*spc); Nc=100; % number of cycles Ns=Nc*spc; % number of samples idc=1; Ffl=5; % fluctuation frequency % ========================================================================= % Generating Random iL % ========================================================================= F_low=0.1; Total_Sec=Ns/Fs; Sampling_Freq=Fs; n=1:Total_Sec*Sampling_Freq; Amp=10*(rand(1,fix(Total_Sec/5))*0.5+0.5); Amp_high=interp1(1:Sampling_Freq*5:Sampling_Freq*Total_Sec,Amp,1:Total_Sec*Sa mpling_Freq,'cubic'); Freq=rand(1,fix(Total_Sec/10))*0.1+0.2; F_high=interp1(1:Sampling_Freq*10:Sampling_Freq*Total_Sec,Freq,1:Total_Sec*Sa mpling_Freq,'cubic'); phi=rand(1,1)*2*pi; iL=20+10.*cos(phi+(2*pi*(F_low/Sampling_Freq)).*n)+0.4*Amp_high.*cos((2*pi.*( F_high/Sampling_Freq)).*n)+0.01*randn(1,Total_Sec*Sampling_Freq); %iL=[idc*ones(1,Ns/2),1.5*idc*ones(1,Ns/2)]+[0.1*sin(2*pi*(Ffl/Fs)*(1:Ns/2)), 0.1*sin(2*pi*(5/Fs)*(1:Ns/2))]; % ========================================================================= Vsc=zeros(1,Ns); isc=zeros(1,Ns); Csc=10; % Capacitor of Super-Capacitor Vsc_max=10; % ========================================================================= % Processing Pipeline % ========================================================================= vsc=zeros(2,1); P_lpc=60; N_lpc=1000; No_PredictedSamples=spc+3; N_previous=20; for cno=1:(Ns-N_lpc)/spc sample_start=1001+(cno-1)*spc; iLpnc(sample_start:sample_start+spc+2)=Prediction_NextSamples(iL(sample_start -N_lpc:sample_start-1),P_lpc,N_lpc,No_PredictedSamples); iL_=[iL(sample_startN_previous+1:sample_start),iLpnc(sample_start:sample_start+spc+1)];

102

Vsc(sample_start:sample_start+spc-1)=zeros(spc,1); Vsc_=Vsc(sample_start-N_previous:sample_start+spc-1); VV=Find_Vsc2(iL_,Vsc_,T,spc,Csc,Vsc_max,2,1,0.5,10); size(VV) Vsc(sample_start:sample_start+spc-1)=VV; end size(Vsc) isc(2:end)=Csc*(Vsc(2:end)-Vsc(1:end-1))/T; ib=iL-isc; % ========================================================================= % Displaying Results % ========================================================================= figure; padding_right=0; subplot(4,1,1);plot(iL(1001:end));hold on;plot(iLpnc(1001:end),'r');hold off; %xlim([0 Ns/Fs]) title('iL'); axis tight subplot(4,1,2);plot(Vsc(1001:end)); %xlim([0 Ns/Fs]) title('Vsc'); axis tight subplot(4,1,3);plot(isc(1001:end)); %xlim([0 Ns/Fs]) title('isc'); axis tight subplot(4,1,4);plot(ib(1001:end)); %xlim([0 Ns/Fs]) title('ib'); axis tight function Vsc_output=Find_Vsc2(im,Vsc_Init,Delta,N,Csc,Vsc_max,a,b,lambda,iter_max) % ========================================================================= % % % ========================================================================= % Initialization % ========================================================================= if(nargin<6) a=1; else if(nargin<7) b=1; else if(nargin<8) lambda=1; else if(nargin<9) iter_max=30; end end end end L=length(Vsc_Init'); N_=L-N;

103

Aux=Csc*[b,-a-4*b,2*a+6*b,-a-4*b,b]; Msc=zeros(L,L); for i=1:L ind=mod(i-1:i+3,L)+1; Msc(i,ind)=Aux; end Mim=zeros(L,L); Aux=[b,-a-3*b,a+3*b,-b]; for i=1:L ind=mod(i-1:i+2,L+2)+1; Mim(i,ind)=Aux; end Vsc=Vsc_Init'; Vsc_last=Vsc; Lambda=diag([10.*ones(1,N_),lambda.*ones(1,N)]); % ========================================================================= % Calculate matrix A1 and A2 % ========================================================================= A1=(Msc+Lambda)^-1; A2=-Delta*A1*Mim*im'; % ========================================================================= % Iterative solution of the optimization problem % ========================================================================= for iter=1:iter_max Vsc=max(min(A1*(Lambda*Vsc_last)+A2,Vsc_max),0); %dif=norm(Vsc-Vsc_last); Vsc_last=Vsc; end Vsc_output=Vsc(end-N+1:end); function X_est=Prediction_NextSamples(X_i,P_lpc,N_lpc,No_PredictedSamples) % ========================================================================= % % ========================================================================= if(nargin<4) No_PredictedSamples=20; end if(N_lpc<length(X_i)) disp('error'); return; end sub_x=X_i(end:-1:end-N_lpc+1); X_est=zeros(1,No_PredictedSamples); a = lpc(sub_x,P_lpc); for k=1:No_PredictedSamples x_n=sum(-a(2:end).*sub_x(1:P_lpc)); X_est(k)=x_n; sub_x=[x_n,sub_x(1:end-1)]; end

104

Program 8:
clc clear all close all % ========================================================================= % Simulate load current % ========================================================================= F=0.2; spc=20; % samples per cycle Fs=F*spc; T=1/(F*spc); Nc=100; % number of cycles Ns=Nc*spc; % number of samples idc=1; Ffl=5; % fluctuation frequency % ========================================================================= % Generating Random iL % ========================================================================= F_low=0.1; Total_Sec=Ns/Fs; Sampling_Freq=Fs; n=1:Total_Sec*Sampling_Freq; Amp=10*(rand(1,fix(Total_Sec/5))*0.5+0.5); Amp_high=interp1(1:Sampling_Freq*5:Sampling_Freq*Total_Sec,Amp,1:Total_Sec*Sa mpling_Freq,'cubic'); Freq=rand(1,fix(Total_Sec/10))*0.1+0.2; F_high=interp1(1:Sampling_Freq*10:Sampling_Freq*Total_Sec,Freq,1:Total_Sec*Sa mpling_Freq,'cubic'); phi=rand(1,1)*2*pi; iL=20+10.*cos(phi+(2*pi*(F_low/Sampling_Freq)).*n)+0.2*Amp_high.*cos((2*pi.*( F_high/Sampling_Freq)).*n)+0.01*randn(1,Total_Sec*Sampling_Freq); %iL=[idc*ones(1,Ns/2),1.5*idc*ones(1,Ns/2)]+[0.1*sin(2*pi*(Ffl/Fs)*(1:Ns/2)), 0.1*sin(2*pi*(5/Fs)*(1:Ns/2))]; % ========================================================================= Vsc=zeros(1,Ns); isc=zeros(1,Ns); ib=zeros(1,Ns); Csc=10; % Capacitor of Super-Capacitor Vsc_max=40; % ========================================================================= % Processing Pipeline % ========================================================================= vsc=zeros(2,1); P_lpc=60; N_lpc=1000; No_PredictedSamples=spc+3; N_previous=20; for cno=1:(Ns-N_lpc)/spc sample_start=1001+(cno-1)*spc; iLpnc(sample_start:sample_start+spc+2)=Prediction_NextSamples(iL(sample_start -N_lpc:sample_start-1),P_lpc,N_lpc,No_PredictedSamples);

105

iL_=[iL(sample_startN_previous+1:sample_start),iLpnc(sample_start:sample_start+spc+1)]; Vsc(sample_start:sample_start+spc-1)=zeros(spc,1); Vsc_=Vsc(sample_start-N_previous:sample_start+spc-1); VV=Find_Vsc2(iL_,Vsc_,T,spc,Csc,Vsc_max,2,1,0.5,25); for s=sample_start:sample_start+spc-1 Vsc_prev=Vsc(s-1); Vsc_ref=VV(s-sample_start+1); iL_predict=iLpnc(s); ib_prev=ib(s-1); [Vsc__,isc__]=Optimization_Problem2(ib_prev,Vsc_prev,Vsc_ref,iL_predict,0.1,1 0,3000,T,Csc,Vsc_max); %[Vsc__,isc__]=Optimization_Problem3(ib_prev,Vsc_prev,Vsc_ref,iL_predict,0.1, 1,8000,T,Csc,Vsc_max); Vsc(s)=Vsc__; isc(s)=isc__; ib(s)=iL(s)-isc(s); end %Vsc(sample_start:sample_start+spc-1)=VV; end size(Vsc) isc(2:end)=Csc*(Vsc(2:end)-Vsc(1:end-1))/T; ib=iL-isc; % ========================================================================= % Displaying Results % ========================================================================= figure; padding_right=0; subplot(4,1,1);plot(iL(1001:end));hold on;plot(iLpnc(1001:end),'r');hold off; %xlim([0 Ns/Fs]) title('iL'); ylim([0 40]) xlim([0 1000]) subplot(4,1,2);plot(Vsc(1001:end)); %xlim([0 Ns/Fs]) title('Vsc'); ylim([0 40]) xlim([0 1000]) subplot(4,1,3);plot(isc(1001:end)); %xlim([0 Ns/Fs]) title('isc'); ylim([-20 20]) xlim([0 1000]) subplot(4,1,4);plot(ib(1001:end)); %xlim([0 Ns/Fs]) title('ib'); ylim([0 40]) xlim([0 1000]) figure;

106

plot(iL(1001:end));hold on;plot(ib(1001:end),'r');hold off; ylim([0 40]) xlim([0 1000])

iL_mean=mean(iL(1001:end)) ib_mean=mean(ib(1001:end)) iL_std=std(iL(1001:end)) ib_std=std(ib(1001:end))

function [Vsc,isc]=Optimization_Problem2(ib_prev,Vsc_prev,Vsc_ref,iL,alpha,beta,gamma, delta,Csc,Vsc_max) Vsc=delta/((alpha+beta)*Csc)*(beta*ib_prev+beta*Csc/delta*Vsc_prev(alpha+beta)*iL-gamma*delta/(2*Csc)); if(Vsc<Vsc_ref) Vsc=delta/((alpha+beta)*Csc)*(beta*ib_prev+(alpha+beta)*Csc/delta*Vsc_prev(alpha+beta)*iL+gamma*delta/(2*Csc)); end Vsc=max(min(Vsc,Vsc_max),0); isc=(Vsc_prev-Vsc)/(delta/Csc); function Vsc_output=Find_Vsc2(im,Vsc_Init,Delta,N,Csc,Vsc_max,a,b,lambda,iter_max) % ========================================================================= % % % ========================================================================= % Initialization % ========================================================================= if(nargin<6) a=1; else if(nargin<7) b=1; else if(nargin<8) lambda=1; else if(nargin<9) iter_max=30; end end end end L=length(Vsc_Init'); N_=L-N; Aux=Csc*[b,-a-4*b,2*a+6*b,-a-4*b,b]; Msc=zeros(L,L); for i=1:L

107

ind=mod(i-1:i+3,L)+1; Msc(i,ind)=Aux; end Mim=zeros(L,L); Aux=[b,-a-3*b,a+3*b,-b]; for i=1:L ind=mod(i-1:i+2,L+2)+1; Mim(i,ind)=Aux; end Vsc=Vsc_Init'; Vsc_last=Vsc; Lambda=diag([10.*ones(1,N_),lambda.*ones(1,N)]); % ========================================================================= % Calculate matrix A1 and A2 % ========================================================================= A1=(Msc+Lambda)^-1; A2=-Delta*A1*Mim*im'; % ========================================================================= % Iterative solution of the optimization problem % ========================================================================= for iter=1:iter_max Vsc=max(min(A1*(Lambda*Vsc_last)+A2,Vsc_max),0); %dif=norm(Vsc-Vsc_last); Vsc_last=Vsc; end Vsc_output=Vsc(end-N+1:end);

Program 9:
clc clear all close all % ========================================================================= % Simulate load current % ========================================================================= F=0.2; spc=20; % samples per cycle Fs=F*spc; T=1/(F*spc); Nc=100; % number of cycles Ns=Nc*spc; % number of samples idc=1; Ffl=5; % fluctuation frequency % ========================================================================= % Generating Random iL % ========================================================================= F_low=0.1; Total_Sec=Ns/Fs; Sampling_Freq=Fs; n=1:Total_Sec*Sampling_Freq; Amp=10*(rand(1,fix(Total_Sec/5))*0.5+0.5);

108

Amp_high=interp1(1:Sampling_Freq*5:Sampling_Freq*Total_Sec,Amp,1:Total_Sec*Sa mpling_Freq,'cubic'); Freq=rand(1,fix(Total_Sec/10))*0.1+0.2; F_high=interp1(1:Sampling_Freq*10:Sampling_Freq*Total_Sec,Freq,1:Total_Sec*Sa mpling_Freq,'cubic'); phi=rand(1,1)*2*pi; iL=20+10.*cos(phi+(2*pi*(F_low/Sampling_Freq)).*n)+0.2*Amp_high.*cos((2*pi.*( F_high/Sampling_Freq)).*n)+0.01*randn(1,Total_Sec*Sampling_Freq); %iL=[idc*ones(1,Ns/2),1.5*idc*ones(1,Ns/2)]+[0.1*sin(2*pi*(Ffl/Fs)*(1:Ns/2)), 0.1*sin(2*pi*(5/Fs)*(1:Ns/2))]; % ========================================================================= Vsc=zeros(1,Ns); isc=zeros(1,Ns); ib=zeros(1,Ns); Csc=10; % Capacitor of Super-Capacitor Vsc_max=40; % ========================================================================= % Processing Pipeline % ========================================================================= vsc=zeros(2,1); P_lpc=60; N_lpc=1000; No_PredictedSamples=spc+3; N_previous=20; for cno=1:(Ns-N_lpc)/spc sample_start=1001+(cno-1)*spc; iLpnc(sample_start:sample_start+spc+2)=Prediction_NextSamples(iL(sample_start -N_lpc:sample_start-1),P_lpc,N_lpc,No_PredictedSamples); iL_=[iL(sample_startN_previous+1:sample_start),iLpnc(sample_start:sample_start+spc+1)]; Vsc(sample_start:sample_start+spc-1)=zeros(spc,1); Vsc_=Vsc(sample_start-N_previous:sample_start+spc-1); VV=Find_Vsc2(iL_,Vsc_,T,spc,Csc,Vsc_max,2,1,0.5,25); for s=sample_start:sample_start+spc-1 Vsc_prev=Vsc(s-1); Vsc_ref=VV(s-sample_start+1); iL_predict=iLpnc(s); ib_prev=ib(s-1); %[Vsc__,isc__]=Optimization_Problem2(ib_prev,Vsc_prev,Vsc_ref,iL_predict,0.1, 10,3000,T,Csc,Vsc_max); [Vsc__,isc__]=Optimization_Problem3(ib_prev,Vsc_prev,Vsc_ref,iL_predict,0.1,1 ,8000,T,Csc,Vsc_max); Vsc(s)=Vsc__; isc(s)=isc__; ib(s)=iL(s)-isc(s); end

109

%Vsc(sample_start:sample_start+spc-1)=VV; end size(Vsc) isc(2:end)=Csc*(Vsc(2:end)-Vsc(1:end-1))/T; ib=iL-isc; % ========================================================================= % Displaying Results % ========================================================================= figure; padding_right=0; subplot(4,1,1);plot(iL(1001:end));hold on;plot(iLpnc(1001:end),'r');hold off; %xlim([0 Ns/Fs]) title('iL'); ylim([0 40]) xlim([0 1000]) subplot(4,1,2);plot(Vsc(1001:end)); %xlim([0 Ns/Fs]) title('Vsc'); ylim([0 40]) xlim([0 1000]) subplot(4,1,3);plot(isc(1001:end)); %xlim([0 Ns/Fs]) title('isc'); ylim([-20 20]) xlim([0 1000]) subplot(4,1,4);plot(ib(1001:end)); %xlim([0 Ns/Fs]) title('ib'); ylim([0 40]) xlim([0 1000]) figure; plot(iL(1001:end));hold on;plot(ib(1001:end),'r');hold off; ylim([0 40]) xlim([0 1000])

iL_mean=mean(iL(1001:end)) ib_mean=mean(ib(1001:end)) iL_std=std(iL(1001:end)) ib_std=std(ib(1001:end))

function Vsc_output=Find_Vsc2(im,Vsc_Init,Delta,N,Csc,Vsc_max,a,b,lambda,iter_max) % ========================================================================= % % % ========================================================================= % Initialization % ========================================================================= if(nargin<6) a=1;

110

else if(nargin<7) b=1; else if(nargin<8) lambda=1; else if(nargin<9) iter_max=30; end end end end L=length(Vsc_Init'); N_=L-N; Aux=Csc*[b,-a-4*b,2*a+6*b,-a-4*b,b]; Msc=zeros(L,L); for i=1:L ind=mod(i-1:i+3,L)+1; Msc(i,ind)=Aux; end Mim=zeros(L,L); Aux=[b,-a-3*b,a+3*b,-b]; for i=1:L ind=mod(i-1:i+2,L+2)+1; Mim(i,ind)=Aux; end Vsc=Vsc_Init'; Vsc_last=Vsc; Lambda=diag([10.*ones(1,N_),lambda.*ones(1,N)]); % ========================================================================= % Calculate matrix A1 and A2 % ========================================================================= A1=(Msc+Lambda)^-1; A2=-Delta*A1*Mim*im'; % ========================================================================= % Iterative solution of the optimization problem % ========================================================================= for iter=1:iter_max Vsc=max(min(A1*(Lambda*Vsc_last)+A2,Vsc_max),0); %dif=norm(Vsc-Vsc_last); Vsc_last=Vsc; end Vsc_output=Vsc(end-N+1:end);

function [Vsc,isc]=Optimization_Problem3(ib_prev,Vsc_prev,Vsc_ref,iL,alpha,beta,gamma, delta,Csc,Vsc_max) Vsc=(1/(((alpha+beta)*Csc/delta)+(gamma*delta)/Csc))*(Vsc_prev*((alpha+beta)* Csc/delta)+gamma*delta/Csc*Vsc_ref+beta*ib_prev-(alpha+beta)*iL); Vsc=max(min(Vsc,Vsc_max),0); isc=(Vsc_prev-Vsc)/(delta/Csc);

111

Program 10:
function [sys,x0] = MPPT(t,x,u,flag) if flag == 0, sys = [0 8 1 3 0 0]; x0 = zeros(1,1); elseif abs(flag) == 2, sys(8)=x(8)+1; if(sys(8)>400000) sys(8)=0; sys(1)=u(1); sys(2)=u(2); sys(3)=x(3); sys(4)=x(1); sys(5)=x(2); else if(sys(8)==1) sys(3)=u(3); end end elseif abs(flag) == 3, if(x(8)==0) I_k=x(1); V_k=x(2); I_k_=x(4); V_k_=x(5); dV=x(3); P_k=I_k*V_k; P_k_minus=I_k_*V_k_; P_max=240; alpha=P_k/P_max; if(P_k>P_k_minus) if(dV>0) dv=steps; else dv=-steps; end else if(dV>0) dv=-steps; else dv=steps; end end dv sys(1)=dv; else sys(1)=0; end else sys = []; end

112

Program 11:
function [sys,x0] = LoadPrediction(t,x,u,flag) P_lpc=60; N_lpc=1000; spc=20; T=1/4; No_PredictedSamples=spc+3; if flag == 0, % 0 ==> return sizes sys = [0 1001 spc+3 2 0 0]; % 3 discrete states to hold the "old" values x0 = zeros(1001,1); elseif abs(flag) == 2, % 2 ==> return next discrete state sys = zeros(1001,1); % initialize sys for i=3:1001 sys(i) = x(i-1); % here we are setting the values for end sys(2) = u(2); % the NEXT integration step sys(1) = u(1); elseif abs(flag) == 3, % 3 ==> return outputs if(t>=T*1000-spc) if(x(1)==1) t_LoadPrediction_out=t a=Prediction_NextSamples(x(1001:1:2)',P_lpc,N_lpc,No_PredictedSamples); b=a(1:spc+3); sys=b; b end end else sys = []; end % all other flags return an empty

Program 12:
function [sys,x0] = UnBuffer_Fcn(t,x,u,flag)

spc=20; T=1/4; if flag == 0, % 0 ==> return sizes sys = [0 spc+2 1 spc+4 0 0]; % 3 discrete states to hold the "old" values x0 = zeros(spc+2,1); elseif abs(flag) == 2, % 2 ==> return next discrete state for i=2:spc+1 sys(i) = x(i+1); % the NEXT integration step end sys(spc+2)=0; if(u(1)==2) t_loadBuffer=t

113

sys(2:spc+2)=u(2:spc+2); end sys(1)=u(1); elseif abs(flag) == 3, % 3 ==> return outputs if(t>=T*1000) sys(1)=x(2); end else % all other flags return an empty sys = []; end

Program 13:
function [sys,x0] = OptimizeVsc(t,x,u,flag) spc=20; T=1/4; Csc=10; % Capacitor of Super-Capacitor Vsc_max=60; if flag == 0, % 0 ==> return sizes sys = [0 2*spc+8+spc spc spc+6 0 0]; % 3 discrete states to hold the "old" values x0 = zeros(2*spc+8+spc,1); elseif abs(flag) == 2, % 2 ==> return next discrete state if(u(1)==2) t_loadILPredict=t sys(spc+6:2*spc+8)=u(3:spc+5); else sys(spc+6:2*spc+8)=x(spc+6:2*spc+8); end for i=1:spc+1 sys(i+2) = x(i+1); % the NEXT integration step end for i=2*spc+9:2*spc+8+spc-1 sys(i+1) = x(i); % the NEXT integration step end sys(2) = u(2); % the NEXT integration step sys(1) = u(1); sys(49)= u(26); elseif abs(flag) == 3, % 3 ==> return outputs if(t>=T*1000) if(x(1)==2) t_OptimizeVsc=t %load('Vsc.mat');

Program 14:
function [sys,x0] = UnBuffer2_Fcn(t,x,u,flag) spc=20; T=1/4; if flag == 0,

% 0 ==> return sizes

114

sys = [0 spc+1 1 spc+1 0 0]; % 3 discrete states to hold the "old" values x0 = zeros(spc+1,1); elseif abs(flag) == 2, % 2 ==> return next discrete state for i=2:spc sys(i) = x(i+1); % the NEXT integration step end sys(spc+1)=0; if(u(1)==3) t_buff2=t sys(2:spc+1)=u(2:spc+1); end sys(1)=u(1); elseif abs(flag) == 3, % 3 ==> return outputs if(t>=T*1000) sys(1)=x(2); end else % all other flags return an empty sys = []; end

Program 15:
function [sys,x0] = CalculateVsc(t,x,u,flag) spc=20; T=1/4; Csc=10; % Capacitor of Super-Capacitor Vsc_max=60; if flag == 0, % 0 ==> return sizes sys = [0 5 2 5 0 0]; % 3 discrete states to hold the "old" x0 = zeros(5,1); elseif abs(flag) == 2, % 2 ==> return next discrete state for i=1:5 sys(i) = u(i); % the NEXT integration step end elseif abs(flag) == 3, % 3 ==> return outputs if(t>=T*1000) Vsc_prev=x(3); Vsc_ref=x(1); iL_predict=x(2); ib_prev=x(4); [Vsc__,isc__]=Optimization_Problem3(ib_prev,Vsc_prev,Vsc_ref,iL_predict,0.1,1 ,8000,T,Csc,Vsc_max); % Modified Optimization. %[Vsc__,isc__]=Optimization_Problem3(ib_prev,Vsc_prev,Vsc_ref,iL_predict,0.1, 0.1,2*10^6,T,Csc,Vsc_max); % Modified Optimization. sys(1)=Vsc__; sys(2)=isc__; %[Vsc_prev,Vsc_ref,iL_predict,ib_prev,Vsc__,isc__]; else

values

115

Vsc__=0; isc__=0; sys(1)=Vsc__; sys(2)=isc__; end else sys = []; end % all other flags return an empty

116

References
[1] Mid-Eum Choi and Seung-Woo Seo. "Robust energy management of a batterysupercapacitor hybrid energy storage system in an electric vehicle." In Electric Vehicle Conference (IEVC), 2012 IEEE International, pages 1- 5.IEEE, 2012. [2] Mamadou Balo Camara, Hamid Gualous, Frederic Gustin, Alain Berthon,and Brayima Dakyo. "Dc/dc converter design for supercapacitor and bat-tery power management in hybrid vehicle applications on polynomial control strategy." IEEE Transactions on Industrial Electronics, vol, 57, no 2, pp. 587-597, 2010. [3] Majid Zandi, Alireza Payman, J-P Martin, Serge Pierfederici, Bernard Davat, and Farid Meibody-Tabar. "Energy management of a fuel cell/supercapacitor/battery power source for electric vehicular applications.Vehicular Technology." IEEE Transactions on, vol 60, no, 2, pp. 433-443, 2011. [4] Phatiphat Thounthong, Serge Pierfederici, J-P Martin, Melika Hinaje, and Bernard Davat. "Modeling and control of fuel cell/supercapacitor hybrid source based on di_erential atness control." Vehicular Technology, IEEE Transactions on, vol, 59, no, 6, pp. 2700 -2710, 2010. [5] Phatiphat Thounthong, Viboon Chunkag, Panarit Sethakul, Suwat Sikkabut, Serge Pierfederici, and Bernard Davat. "Energy management of fuel cell/solar cell/supercapacitor hybrid power source." Journal of Power Sources, vol, 196, no, 1, pp. 313-324, 2011. [6] Javier Solano Martnez, Daniel Hissel, M-C Pera, and Michel Amiet. "Practical control structure and energy management of a testbed hybrid electric vehicle." Vehicular Technology, IEEE Transactions on, vol, 60, no, pp. 4139-4152. 2011. [7] Chun-Yan Li and Guo-Ping Liu. "Optimal fuzzy power control and management of fuel cell/battery hybrid vehicles." Journal of Power Sources, vol, 192, no, 2 pp. 525-533, 2009. [8] Lei Wang and Hui Li. "Maximum fuel economy-oriented power management design for a fuel cell vehicle using battery and ultracapacitor." Industry Applications, IEEE Transactions on, vol 46, no, 3, pp. 1011-1020, 2010. [9] Donghwa Shin, Younghyun Kim, YanzhiWang, Naehyuck Chang, and Massoud Pedram. "Constant-current regulator-based battery-supercapacitor hybrid architecture for high-rate pulsed load applications." Journal of Power Sources, vol, 20, no, 5, pp. 516-524, 2012. [10] Jonathan J. Awerbuch and Charles R. Sullivan. "Control of ultracapacitor battery hybrid power source for vehicular applications." In IEEE Energy 2030 Conference, 2008. ENERGY 2008., pages 1-7. IEEE, 2008.

117

[11] Mamadou Balo Camara, Hamid Gualous, Frederic Gustin, and Alain Berthon. "Design and new control of dc/dc converters to share energy Between supercapacitors and batteries in hybrid vehicles." Vehicular Technology, IEEE Transactions on, vol, 57, no, 5, pp. 2721 2735, 2008. [12] Rebecca Carter, Andrew Cruden, and Peter J. Hall. "Optimizing for efciency or battery life in a battery/supercapacitor electric vehicle." Vehicular Technology, IEEE Transactions on, vol, 61, no, 4, pp. 1526-1533, 2012. [13] Hyunjae Yoo, Seung-Ki Sul, Yongho Park, and Jongchan Jeong. "System integration and power-ow management for a series hybrid electric vehicle using supercapacitors and batteries." Industry Applications, IEEE Transactions on, vol, 44, no, 1, pp. 108 -114, 2008. [14] Juan Dixon, Ian Nakashima, Eduardo F. Arcos, and Micah Ortuzar. "Electric vehicle using a combination of ultracapac itors and zebra battery." Industrial Electronics, IEEE Transactions on, vol, 57, no, 3, pp. 943-949, 2010. [15] Lijun Gao, Roger A. Dougal, and Shengyi Liu. "Power enhancement of an actively controlled battery/ultracapacitor hybrid." IEEE Transactions on Power Electronics, vol, 20, no, 1, pp. 236-243, 2005. [16] Zahra Amjadi and Sheldon S. Williamson. "Power-electronics-based solutions for plug-in hybrid electric vehicle energy storage and management systems." Industrial Electronics, IEEE Transactions on, vol, 57, no, 2, pp. 608-616, 2010. [17] Zhihong Yu, Donald Zinger, and Anima Bose. "An innovative optimal power allocation strategy for fuel cell, battery and supercapacitor hybrid electric vehicle." Journal of Power Sources, vol 196, no, 4, pp. 2351-2359, 2011. [18] Phatiphat Thounthong, Stephane Rael, and Bernard Davat." Energy management of fuel cell/battery/supercapacitor hybrid power source for vehicle applications." Journal of Power Sources, vol 193, no, 1, pp, 376-385, 2009. [19] Phatiphat Thounthong, Stphane Ral, and Bernard Davat. "Control strategy of fuel cell/supercapacitors hybrid power sources for electric vehicle." Journal of Power Sources, vol 158, no, 1, pp. 806-814, 2006. [20] Vanessa Paladini, Teresa Donateo, Arturo De Risi, and Domenico Laforgia."Supercapacitors fuel-cell hybrid electric vehicle optimization and control strategy development." Energy Conversion and Management, vol 48, no, 11, pp. 3001-3008, 2007. [21] Luis M. Fernandez, Pablo Garcia, Carlos Andrs Garcia, and Francisco Jurado. Hybrid electric system based on fuel cell and battery and integrating a single dc/dc converter for a tramway. Energy Conversion and Management, vol 52, no, 5, pp. 2183-2192, 2011.
118

[22] S. Williamson, M. Lukic, and A. Emadi. Comprehensive drive train efficiency analysis of hybrid electric and fuel cell vehicles based on motor controller efficiency modeling. IEEE Transactions on Power Electronics, vol 21, no, 3, pp. 730-740, MAY 2006. [23] S. S. Williamson, A. Emadi, and K. Rajashekara. Comprehensive efficiency modeling of electric traction motor drives for hybrid electric vehicle propulsion applications. IEEE Transactions on Vehicular Technology, vol, 56, no, 4,1, pp. 1561-1572, JULY 2007. [24] Branislav Hredzak, Vassilios G. Agelidis, and Minsoo Jang. A model predictive control system for a hybrid battery-ultracapacitor power source. IEEE Transactions on Power Electronics, vol 29, no, 3, pp. 1469-1479, MARCH 2014. [25] Benjamin Friedlander and Boaz Porat. The modi_ed yule-walker method of arma spectral estimation. IEEE Transactions on Aerospace and Electronic Systems, AES- vol, 20, no, 2, pp. 158-173, 1984. [26] Mamadou Balo Camara, Hamid Gualous, Frederic Gustin, Alain Berthon, and Brayima Dakyo. Dc/dc converter design for supercapacitor and bat- tery power management in hybrid vehicle applications on polynomial control strategy. IEEE Transactions on Industrial Electronics, vol, 57, no, 2, pp. 587-597, 2010. [27] Majid Zandi, Alireza Payman, J-P Martin, Serge Pierfederici, Bernard Davat, and Farid Meibody-Tabar. Energy management of a fuel cell/supercapacitor/battery power source for electric vehicular applications. Vehicular Technology, IEEE Transactions on, vol, 60, no. 2, pp, 433-443, 2011. [28] Phatiphat Thounthong, Serge Pierfederici, J-P Martin, Melika Hinaje, and Bernard Davat. Modeling and control of fuel cell/supercapacitor hybrid source based on di_erential atness control. Vehicular Technology, IEEE Transactions on, vol, 59, no, 6, pp. 2700-2710, 2010 [29] Phatiphat Thounthong, Viboon Chunkag, Panarit Sethakul, Suwat Sikkabut, Serge Pierfederici, and Bernard Davat. Energy management of fuel cell/solar cell/supercapacitor hybrid power source. Journal of Power Sources, vol 196, no, 1, pp. 313-324, 2011. [30] Javier Solano Martnez, Daniel Hissel, M-C Pera, and Michel Amiet. Practical control structure and energy management of a testbed hybrid electric vehicle. Vehicular Technology, IEEE Transactions on, vol, 60, no, 9, pp. 4139- 4152, 2011. [31] Chun-Yan Li and Guo-Ping Liu. Optimal fuzzy power control and management of fuel cell/battery hybrid vehicles. Journal of Power Sources, vol, 192, no, 2, pp. 525- 533, 2009.

[32] Lei Wang and Hui Li. Maximum fuel economy-oriented power management design for a fuel cell vehicle using battery and ultracapacitor. Industry Applications, IEEE Transactions on, vol, 46, no, 3, pp. 1011- 1020, 2010.
119

[33] Donghwa Shin, Younghyun Kim, YanzhiWang, Naehyuck Chang, and Massoud Pedram. Constant-current regulator-based battery-supercapacitor hybrid architecture for high-rate pulsed load applications. Journal of Power Sources, vol. 20, no, 5, pp. 516-524, 2012. [34] Jonathan J. Awerbuch and Charles R. Sullivan. Control of ultracapacitor-battery hybrid power source for vehicular applications. In IEEE Energy 2030 Conference, 2008. ENERGY 2008., pages 1-7. IEEE, 2008. [35] Mamadou Balo Camara, Hamid Gualous, Frederic Gustin, and Alain Berthon. Design and new control of dc/dc converters to share energy between supercapacitors and batteries in hybrid vehicles. Vehicular Technology, IEEE Transactions on, vol, 57, no, 5, pp. 27212735, 2008. [36] Rebecca Carter, Andrew Cruden, and Peter J. Hall. Optimizing for efficiency or battery life in a battery/supercapacitor electric vehicle. Vehicular Technology, IEEE Transactions on, vol, 61, no, 4, pp. 1526- 1533, 2012 [37] Hyunjae Yoo, Seung-Ki Sul, Yongho Park, and Jongchan Jeong. System integration and power-ow management for a series hybrid electric vehicle using supercapacitors and batteries. Industry Applications, IEEE Transactions on, vol, 44, no, 1, pp. 108 - 114, 2008. [38] Juan Dixon, Ian Nakashima, Eduardo F. Arcos, and Micah Ortuzar. Electric vehicle using a combination of ultracapacitors and zebra battery. Industrial Electronics, IEEE Transactions on, vol, 57, no, 3, pp. 943-949, 2010. [39] Lijun Gao, Roger A. Dougal, and Shengyi Liu. Power enhancement of an actively controlled battery/ultracapacitor hybrid. IEEE Transactions on Power Electronics, vol 20, no, 1, pp. 236-243, 2005. [40] Zahra Amjadi and Sheldon S. Williamson. Power-electronics-based solutions for plug-in hybrid electric vehicle energy storage and management systems. Industrial Electronics, IEEE Transactions on, vol 57, no, 2, pp. 608-616, 2010. [41] Zhihong Yu, Donald Zinger, and Anima Bose. An innovative optimal power allocation strategy for fuel cell, battery and supercapacitor hybrid electric vehicle. Journal of Power Sources, vol 196, no, 4, pp. 2351-2359, 2011. [42] Phatiphat Thounthong, Stephane Rael, and Bernard Davat. Energy management of fuel cell/battery/supercapacitor hybrid power source for vehicle applications. Journal of Power Sources, vol, 193, no, 1, pp. 376-385, 2009. [43] Phatiphat Thounthong, Stphane Ral, and Bernard Davat. Control strategy of fuel cell/supercapacitors hybrid power sources for electric vehicle. Journal of Power Sources, vol, 158, no, 1, pp. 806-814, 2006.

120

[44] Vanessa Paladini, Teresa Donateo, Arturo De Risi, and Domenico Laforgia. Supercapacitors fuel-cell hybrid electric vehicle optimization and control strategy development. Energy Conversion and Management, vol, 48, no, 11, pp. 3001- 3008, 2007. [45] Luis M. Fernandez, Pablo Garcia, Carlos Andrs Garcia, and Francisco Jurado. Hybrid electric system based on fuel cell and battery and integrating19 a single dc/dc converter for a tramway. Energy Conversion and Management, vol, 52, no, 5, pp. 2183-2192, 2011. [46] S. Williamson, M. Lukic, and A. Emadi. Comprehensive drive train efficiency analysis of hybrid electric and fuel cell vehicles based on motorcontroller e_ciency modeling. IEEE Transactions on Power Electronics, vol, 21, no, 3, pp, 730-740, MAY 2006. [47] S. S. Williamson, A. Emadi, and K. Rajashekara. Comprehensive efficeincy modeling of electric traction motor drives for hybrid electric vehicle propulsion applications. IEEE Transactions on Vehicular Technology, vol, 56, no, 41, pp. 1561-1572, JULY 2007. [48] Branislav Hredzak, Vassilios G. Agelidis, and Minsoo Jang. A model predictive control system for a hybrid battery-ultracapacitor power source. IEEE Transactions on Power Electronics, vol, 29, no, 3, pp. 1469-1479, MARCH 2014. [49] Benjamin Friedlander and Boaz Porat. The modi_ed yule-walker method of arma spectral estimation. IEEE Transactions on Aerospace and Electronic Systems, AES- vol 20, no, 2, pp, 158-173, 1984. [50] Kun Ding, XinGao Bian, HaiHao Liu, Tao Peng, A Matlab-Simulink-based PV module Model and its application under conditions of nonuniform irradiance, IEEE Transaction on energy conversion, vol, 27, no, 4, pp, 864 - 871, 2012. [51] Loredana Cristaldi, Marco Faifer, Marco Rossi, Ferninanda Ponci, A simple photovoltaic Panel model: characterization procedure and evaluation of the role of environment measurements, IEEE Transactions on instrumentation and measurement, vol, 61, no 10, pp. 2632 - 2641, 2012. [52] Abir Chatterjee, Ali Keyhani, Dhruv Kapoor, Identification of photovoltaic source models, IEEE Transaction on energy conversion, vol, 26, no, 3, pp. 883 ­ 889, 2011. [53] Shen Weixiang, Choo Fook Hoong, Wang Peng, Loh Poh Chiang, Khoo Sui Yang, Development of mathematical model for solar module in photo voltaic systems, IEEE Conference on Industrial Electronics and Applications, 6th: page. 2056 ­ 2061, 2011. [54] Mario Pagliaro, Giovanni Palmisano, Rosaria ciriminna, Flexible Solar Cells, WILEYVCH,Verlog GmbH & Co. kGaA, ISBN: 978-3-527-32375-3, 2009. [55] Stephan J. Fonash, Solar Cell Device Physics, ELSEVIER, ISBN: 978-0-12- 374774-7, 2010.

121

[56] Tom Markvart, Luis Castaner, Solar Cells: Material, Manufacture and Operation, ELSEVIER, ISBN-13: 978-1-85617-457-1, 2006. [57] Eduardo Roman, Ricardo Alonso, Pedro Ibanez, Intelligent PV Module for Grid-Connected PV Systems, IEEE Transactions on Industrial Electronics, vol, 53, no, 4, pp. 1066 - 1073, 2006. [58] A. J. Mahdi, W. H. Tang and Q. H. Wu, Improvement of a MPPT Algorithm for PV Systems and Its Experimental Validation, International Conference on Renewable Energies and Power Quality, 2010. [59] Cheng-Wei Chen, Kun-Hung Chen, Yaow-Ming Chen, Modeling and Controller Design of an Autonomous PV Module for DMPPT PV Systems, IEEE Transactions on Power Electronics, vol, 29, no, 9, pp. 4723 - 4732, 2014. [60] Poorniama Mazumdar, Prasad N. Enjeti, Robert S. Balog, Analysis and Design of Smart PV Modules, IEEE Journal Of Emerging And Selected Topics In Power Electronics, vol, 2 no, 3, pp, 451 ­ 459, 2014. [61] Paolo Mattavelli, A Closed-Loop Selective Harmonic Compensation for Active Filters, IEEE Transactions on industry applications, vol, 37, no, 4, pp. 81 ­ 89, 2001. [62] Parag Kanjiya, Vinod Khadkikar, Optimal Control of Shunt Active Power Filter to Meet IEEE Std. 519 Current Harmonic Constraints under Non ideal Supply Condition, IEEE Transaction on industrial electronics, vol, 62, no, 2, pp. 724 ­ 734, 2015. [63] F.R. Islam, H. R. Pota, Virtual Active Filter for HVDC networks using V2G Technology, ELSEVIER, Electrical Power & Energy Systems, page, 399 ­ 407, 2013. [64] Hirofumi Akagi, Akira Nabae, Control Strategy of Active Power Filters using Multiple Voltage-Source PWM Converters, IEEE Transaction on industry applications, vol, 22, no 3, pp. 460 ­ 465, 1986. [65] Parag Kanjiya, Vinod Khadkikar, Hatem. H. Zeineldin, Optimal Control of Shunt Active Filter to Meet IEEE Std. 519 Current Harmonic Constraints under Non ideal Supply Condition, IEEE Transaction on industrial electronics, vol, 62, no, 2, pp. 724 ­ 734, 2015. [66] Behim Singh, Kamal Al-hadad, Ambrish Chandra, "A review of Active Filters for Power Quality Improvement," IEEE Transaction at the industrial electronics, vol 46, no, 5, pp. 960 ­ 971, 1999. [67] Hirofumi Akagi, "New Trends in Active Filters for Power conditioning," IEEE Transaction on industry application, vol 32, no, 6, pp. 1312 ­ 1322, 1996.

122

[68] Maurizio Cirrincione, Marcello Pucci, Gianpaolo Vitale, Abedollatif Miraoui, "Current Harmonics Compensation by a Single-Phase shunt Active Filter Controlled by Adaptive Neural Filtering," IEEE Transaction on industrial electronics, vol 56, no, 8, pp. 3128 ­ 3143, 2009. [69] Sreeraj. E. S, Prejith. E. k, Kishore Chatterjee, Santanu Bandyopadhyay, "An Active Harmonic Filter Based on One-Cycle control," IEEE Transaction on industrial Electronics, Vol, 61, no, 8, pp. 3799 ­ 3809, 2014. [70] German A. Ramos Fuentes, John A. Cortes-Romero, ZhiXiang Zou, Ramon CostaCastello, Keliang Zhou, "Power Active Filter Control based on a Resonant Distribution Observer," IET Power Electronics, vol, 8, no, 4, pp. 554 ­ 564, 2015. MATLAB help- LPC (Linear prediction filter coefficients) version a2012b. J. Moreno, M. E. Ortuzar, and J. W. Dixon, "Energy-management system for a hybrid Electric vehicle, using ultracapacitors and neural networks," IEEE Trans. Ind. Elec., vol. 53, no. 2, pp. 614-623, 2006. L. Wang, E. G. Collins Jr, and H. Li, "Optimal design and real-time control for energy Management in electric vehicles," IEEE Trans. Vehivular Tech, vol, 60. 4, pp. 1419 -1429, 2011. M.-E, Choi, J.-S Lee, and S.-W, Seo, "Real-time optimization for power management systems of a battery/supercapacitor hybrid energy storage system in electric vehicle, "IEEE Trans. Vehicular Tech, vol, 63, no. 8, pp. 3600-11, 2014. M.-E. Choi, S.-W. Kim, and S.-W. Seo, "Energy management optimization in a battery/supercapacitor hybrid energy storage system," IEEE Trans. Smart Grid, vol. 3, no, 1, pp. 463-472, 2012. Bauman J, Kazerani M. "A Comperative study of Fuel Cell-battery, Fuel Cell-Ultracapacitor, and fuel cell-battery-Ultracapacitor Vehicle, IEEE Trans Veh Technol, vol, 57, no, 2, pp 760-769, 2008. J. Bernard, S. Delpart, F. Buchi, and T. Guerra, "Fuel-cell hybrid power-train: Toward Minimization of hydrogen consumption," IEEE Trans. Veh. Technol,. Vol, 58, no, 7, pp. 3168-3176, Sep. 2009. O. Sundstrom, P. Soltic, and L. Guzzela, "A transmission-actuated energy-management strategy," IEEE Trans. Veh. Technol., vol. 59, no. 1, pp. 84-92, jan. 2010. D. Ambuhl and L. Guzzella, "Predictive reference signal generator for hybrid electric vehicles," IEEE Trans. Veh. Technol., vol. 58, no. 9, pp. 4730-4740, Nov. 2009.

[71] [72]

[73]

[74]

[75]

[76]

[77]

[78] [79]

123

[80]

A. Jaafar, C. Akli, B. Sareni, X. Roboam, and A. Jeunesse, "Sizing and energy management of a hybrid locomotive based on flywheel and accumulator," IEEE Trans. Veh. Technol., vol. 58, no. 8, pp. 3947-3958, Oct. 2009. J. Kessels, M. Koot, P. van den Bosch, and D. Kok, "Online energy management for hybrid electric vehicles," IEEE Trans. Veh. Technol., vol. 57,no. 6, pp. 3428 -3440,Nov. 2008. P. M. T. Broerson, "Finite Sample Bias Propagation in Autoregressive Estimation with the Yule-Walker Method," IEEE Trans. Instrumentation and Measurement, vol. 58, no. 5, pp. 1354-1360, May. 2009.

[81]

[82]

[83] P. M. T. Broerson, "The Quality of Lagged Products and Autoregressive Yule-Walker Models as Autocorrelation Estimates ," IEEE Trans. Instrumentation and Measurement, vol. 58, no. 11, pp. 3867-3873, Nov. 2009. [84] E. Wensink, W. J. Dijkhof. " On Finite Sample Statistics for Yule-Walker Estimates," IEEE Trans. Information Theory, vol. 49, no. 2, pp. 509-516, Feb. 2003. [85] J. Makhoul, "Linear Prediction: A Tutorial Review," IEEE. vol. 63, no. 4, pp. 561-580, April. 1975. [86] P. A. Swamy, P. A. Tinsley, "Linear Predictio n and Estimation Methods Regression Models with Stationary Stochastic Coefficient," Journal of Econometric, no. 12, pp. 103 142, 1980.

124

