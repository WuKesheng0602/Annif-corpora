PRICING AND RISK MANAGEMENT UNDER MULTIVARIATE SWITCHING MODELS by Atousa Assadihaghi
Doctorate of Philosophy, Electrical Engineering, University of Limoges, 2007 Master of Science,Electrical Engineering,Amirkabir University of Technology, 2000 Bachelor of Science,Electrical Engineering,Amirkabir University of Technology,1996

A thesis presented to Ryerson University in partial fulfilment of the requirements for the Degree of Master of Science in the program of Applied Mathematics Toronto, Ontario, Canada, 2016 c Atousa Assadihaghi 2016

AUTHOR'S DECLARATION FOR ELECTRONIC SUBMISSION OF A THESIS

I hereby declare that I am the sole author of this thesis. This is a true copy of the thesis, including any required final revisions, as accepted by my examiners.

I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research.

I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

I understand that my thesis may be made electronically available to the public

.

ii

PRICING AND RISK MANAGEMENT UNDER MULTIVARIATE SWITCHING MODELS Master of Science, 2016 Atousa Assadihaghi Applied Mathematics Ryerson University

The objective of this thesis is to provide a simulations-free approximation to the price of multivariate derivatives and for the calculation of risk measures like Value at Risk(VaR). The first chapters are dedicated to the pricing of multivariate derivatives. In particular we focus on multivariate derivatives under switching regime Markov models. We consider the cases of two and three states of the switching regime Markov model, and derive analytic expressions for the first and second order moments of the occupation times of the continuous-time Markov process. Then we use these expressions to provide approximations for the derivative prices based on Taylor expansions. We compare our closed form approximations with Monte Carlo simulations. In the last chapter we also provide a simulations-free approximation for the VaR under a switching regime model with two states. We compare these VaR estimations with those obtained using Monte Carlo.

iii

Acknowledgements

Foremost, I would like to express my sincere gratitude to my advisor Prof. Alexander Alvarez for the continuous support of my study and research, for his patience, motivation, enthusiasm, and immense knowledge. His guidance helped me in all the time of research and writing of this thesis. I could not have imagined having a better advisor and mentor for my study. Besides my advisor, I would like to thank the rest of my thesis committee: Prof. Sebastian Ferrando, Prof. Pablo Olivares, and Prof. Foivos Xanthos, for their encouragement, insightful comments, and hard questions. Last but not the least, I would like to thank my family for supporting me spiritually throughout my life.

iv

TABLE OF CONTENTS

Author's Declaration

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

ii

Abstract

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

iii

Acknowledgements

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

iv

List of Tables

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

ix

List of Figures . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

x

List of Appendices . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

xi

1

Introduction

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

1

2

Preliminaries on Stochastic Processes and Financial Modeling 2.1

. . . . . . . . . .

4 4 5 6 8 8 10 12 13

Stochastic Processes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2.1.1 2.1.2 Brownian Motion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Continuous time Markov Process . . . . . . . . . . . . . . . . . . . .

2.2

Univariate and multivariate models for the stock market . . . . . . . . . . . 2.2.1 2.2.2 Geometric Brownian motion . . . . . . . . . . . . . . . . . . . . . . . Multivariate Geometric Brownian motion . . . . . . . . . . . . . . .

2.3

Derivatives . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2.3.1 Classification of options . . . . . . . . . . . . . . . . . . . . . . . . .

v

2.3.2

Option pricing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

16

3

Pricing approximation under a switching regime model with two states 3.1 3.2 3.3 3.4 3.5

. . . . .

21 22 25 27 29 32

Multivariate switching regime model . . . . . . . . . . . . . . . . . . . . . . Derivative price under switching models . . . . . . . . . . . . . . . . . . . . Approximated closed form for derivative pricing . . . . . . . . . . . . . . . . Calculation of moments of occupation times . . . . . . . . . . . . . . . . . . Numerical case study . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

4

Pricing approximation under a switching regime with three states 4.1 4.2 4.3 4.4

. . . . . . . .

43 44 45 47 51

Regime switching model with three states . . . . . . . . . . . . . . . . . . . Approximated closed form under a switching regime model with three states Calculation of moments of occupation times . . . . . . . . . . . . . . . . . . Numerical case study . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

5

Computation of Value at Risk under switching regime models 5.1 5.2 5.3

. . . . . . . . . .

59 60 64 68

Closed-form VaR approximation for an asset under switching regime models Numerical case study . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Closed-form VaR approximation for a two-assets portfolio . . . . . . . . . .

6

Conclusion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

71

A System Solution . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

73

B Matlab codes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

79

vi

B.1 Spread option under switching regime with two states . . . . . . . . . . . . B.2 Spread option under switching regime with three states . . . . . . . . . . . B.3 Value at Risk regarding one single asset . . . . . . . . . . . . . . . . . . . . References . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

79 85 95 101

vii

LIST OF TABLES

3.1 3.2

Linear and quadratic prices p1 and p2 vs Monte Carlo for different values of  35 Linear and quadratic approximated prices for  = 5 and different parameters for the volatility of the second asset . . . . . . . . . . . . . . . . . . . . . . 38

3.3

Linear and quadratic approximated prices for  = 1 and different parameters for the volatility of the second asset . . . . . . . . . . . . . . . . . . . . . . 39

3.4

Linear and quadratic approximated prices for  = 1 and different maturity times . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 40

3.5

Linear and quadratic approximated prices for  = 1 and different parameters for strike price . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41

3.6

Linear and quadratic approximated prices for  = 1 and different Number of simulation in Monte Carlo . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42

4.1 4.2

Linear and quadratic approximated prices for two different  = 5 and  = 1 Monte-Carlo simulation v.s. Approximated for different volatility of second derivative for  = 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

54

57

4.3

Monte Carlo simulation, first and second order approximation for  = 1 for different number of Monte Carlo simulation . . . . . . . . . . . . . . . . . . 58

5.1

Linear and quadratic values for VaR for  = 10 and different parameters for  66

viii

5.2

Linear and quadratic values for VaR for  = 10 and different parameters for the volatility of the second asset . . . . . . . . . . . . . . . . . . . . . . . . 67

ix

LIST OF FIGURES

2.1 2.2

µ = 0 ,  = 0.1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . µ = 0.1 ,  = 0.3 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

6 10

3.1 3.2 3.3 3.4 3.5

 and its linear and quadratic approximation ( = 5) . . . . . . . . . . . . Histogram of TX,1 for  = 5 and 105 Monte-Carlo realizations . . . . . . . . Variance of TX,1 as a function of  . . . . . . . . . . . . . . . . . . . . . . .  and its linear and quadratic approximation ( = 1) . . . . . . . . . . . . Histogram of TX,1 for  = 1 and 105 Monte-Carlo realizations . . . . . . . . Error of linear approximated price R1 . . . . . . . . . . . . . . . . . . . . . Error of quadratic approximated price R2 . . . . . . . . . . . . . . . . . . . Scatter plot of generated values of pairs (TX,1 , TX,2 ), case  = 5 . . . . . . . Error of linear approximated price R1 for  = 1 . . . . . . . . . . . . . . . . Error of linear approximated price R1 for  = 1 . . . . . . . . . . . . . . . . Scatter plot of generated values of pairs (TX,1 , TX,2 ), case  = 1 . . . . . . . Histogram of ST and corresponding -VaR . . . . . . . . . . . . . . . . . . Error of linear approximation f1 (TX,1 , v ) - f (TX,1 , v ) . . . . . . . . . . . .

32 34 35 36 37

4.1 4.2 4.3 4.4 4.5 4.6

52 52 53 55 56 56

5.1 5.2 5.3 5.4

64 65 65 66

Error of quadratic approximation f2 (TX,1 , v ) - f (TX,1 , v ) . . . . . . . . . . . g (v ), g1 (v ), g2 (v ) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

x

LIST OF APPENDICES Appendix A: System solution . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 73 Appendix B:Matlab codes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79

xi

Chapter 1

INTRODUCTION

The focus of this thesis is the pricing of multivariate derivatives and the computation of risk management measures under switching regime models. There are a few reasons why we have selected switching regime models for the stock(s) dynamics in this thesis. Switching regime models are very flexible, and can describe many features that are present in the financial market (volatility clustering, for example). On the other hand, under mild assumptions on the switching mechanism (for example, a Markovtype assumption) the models still keep some analytical tractability, which we are going to strongly use in this work. Last but not least, switching regime models, and their parameters, can be interpreted very easily: the regimes represent different external (changing) economic circumstances. Switching regime models are very common in modern financial modelling, but they have been used mostly in a univariate setting. That is why we have considered multivariate switching regime models, which have been treated considerably less in the financial literature. The simplest regime switching model in continuous time that can be found in the financial literature is the Black and Scholes regime switching model, introduced by Kijima and Yoshida [20], it assumes m number of states or regimes and considers that within each

1

possible market regime, asset prices evolve according to a geometric Brownian motion with specific constant parameters. Opposed to the typical benchmark cases of constant parameters, when working with switching models the (joint) distribution at maturity time is not explicitly available. Therefore, some financial problems like derivative pricing, as well as the computation of risk measures like Value at Risk (VaR), become much more difficult, and most of the time, impossible to solve analytically, more so in the multivariate case. What this means is that, in the presence of a switching mechanism, there are not too many alternatives to compute derivative prices, beyond the ubiquitous Monte Carlo methods. Monte Carlo methods are reliable, and in general can be easily implemented, but they are not very efficient from a computational point of view. In this work we will provide efficient closed form approximations for the pricing of multivariate derivatives under switching regime models as an alternative to Monte Carlo Methods. In the univariate case, we will also provide a methodology to compute Value at Risk under a switching regime model. The main approximating tool that we will use is the classical Taylor expansion. This technique, in different variations, has been used to price derivatives in many papers, for example Hull and White(1987), and Alvarez, Escobar and Olivares (2010) [5], among others. However, as far as we know, there is nothing similar to the VaR approximation that we propose in this thesis in the available literature. The organization of this thesis is as follows:

2

In Chapter 1 we introduce some notations and basic concepts needed in this thesis. These are standard elements and the reader will be referred to other sources for more details. In this section first we introduce the notion of stochastic process, and specifically we cover the cases of Brownian Motion and continuous time Markov process. Then we give a short summary of some stochastic processes that are common in the financial literature, as well as a review of financial derivatives and option pricing methods. In Chapter 2 we introduce the multivariate switching regime models that will be the main ingredient in this thesis. Next we focus on the closed form approximation for derivative pricing considering a two states Markov regime. At the end of this chapter we discuss our simulation results, and compare them with Monte-Carlo prices. In Chapter 3 we consider a switching regime model with three states. The moments of the occupation times will be analytically calculated under this kind of Markov model. Similarly to Chapter 2 we present comparison with Monte-Carlo pricing method. In Chapter 4 we provide a closed form approximation for the Value at Risk (VaR) under a univariate switching Regime model, and we assess its accuracy by performing a comparison with Monte Carlo methods. Chapter 5 concludes.

3

Chapter 2

PRELIMINARIES ON STOCHASTIC PROCESSES AND FINANCIAL MODELING

In order to make this thesis as self-contained as possible, this chapter summarizes some basic notations, definitions and results that we need in the rest of thesis. In section 2.1 we start introducing stochastic processes in general, and we cover the specific cases of Brownian Motion and continuous time Markov process, which are the basic blocks for this project. In section 2.2 we focus on univariate and multivariate asset modelling. In section 2.3 we have a summary of derivatives and their pricing methods.

2.1

Stochastic Processes

Consider a probability space (, F , P). A stochastic process X on (, F , P) is a collection of random variables {Xt }t0 defined on (, F , P). The parameter t is usually interpreted as time. If    is fixed, Xt ( )  X (t,  ) : R+  R(Rn ) is called a sample path (or trajectory) of the process X. A stochastic process X is said to be continuous if almost surely, its trajectories X (·,  ) are continuous. A filtration {Ft }t0 is an increasing family of  -algebras included in F . The  -algebra Ft represents the information available up to time t. We say that a stochastic process X ,

4

is Ft -adapted if the random variable Xt is Ft measurable. If we have a stochastic process X , it is possible to generate a filtration by taking Ft =  (Xs , s  t). We call it the natural filtration of the process X . From now on, if a filtration is mentioned without specifying it, it will be assumed that it is the natural filtration of the stochastic process that is being considered. Definition 2.1.1. (Martingale) A {Ft }-adapted stochastic process {Xt , t  0}, is a martingale if for any t, E |Xt |<  and for any s > 0. E [Xt+s |Ft ] = Xt

a.s.

(2.1)

For a martingale, its expected future value conditional on its present value and past history is equal to its present value.

2.1.1

Brownian Motion

A Brownian motion (also called Wiener process)[11] is a continuous stochastic process W = {Wt , t  0} satisfying the following properties: · P (W (0) = 0) = 1. · (independent increments) If s < t, Wt - Ws is independent of Fs . · (stationary normal increments) If s < t, Wt - Ws  N (0,  2 (t - s)). · the paths are continuous,i.e., the function t  Wt is a continuous function of t, almost surely.

5

The standard Brownian motion has  2 = 1. It is clear from the definition that for any t > 0, we have EP (Wt ) = EP (W0 ) = 0. Moreover W is a martingale with respect to its natural filtration. Figure 2.1 shows several simulated trajectories of a Standard Brownian motion.

Figure 2.1: µ = 0 ,  = 0.1 2.1.2 Continuous time Markov Process

A continuous time Markov process X is a stochastic process taking values in some set S called the state space, that satisfies the following Markov property: P (X (t) = j |X (s) = i, X (tn-1 ) = in-1 , ..., X (t1 ) = i1 ) (2.2) = P (X (t) = j |X (s) = i) for any non decreasing sequence of n + 1 real times 0  t1  t2  ...  tn-1  s  t and any i1 , i2 , , ..., in-1 , i, j  S . The Markov property has the interpretation that conditionally on the present, the future 6

behaviour of X is independent of the past values of X . In the particular case that the state space S is finite(or countable), X can also be called a Markov chain. If S is finite there exists a square matrix Q of the same dimension of S , called the transition rate matrix that, together with the initial state X (0), completely defines the Markov process. For simplicity assume that S = {1, 2, ..., N }. The transition rate matrix

  q1,1 q1,2 q1,3    q  2,1 q2,2 q2,3 Q=    q3,1 q3,2 q3,3   ··· ··· ··· is such that

 ···    ···      ···    ···

(2.3)

P (X (t + h) = j |X (t) = i) = i,j + qi,j h + o(h) Where i,j is a unit matrix. Expression (2.4) implies that

(2.4)

· qi,j  0 for i = j · qi,i  0 for all i ·
j

qij = 0.

It can also be proved from (2.4) that once state i is reached (if it is reached), the Markov

7

process X will remain there for a random length of time that is exponentially distributed with parameter i = -qii . Then, it will jump to another state j (j = i) with probability

pij =

qi,j qi,j
j =i

=

qi,j i

(2.5)

For more details about Markov processes the reader may refer to [17], among others references.

2.2

Univariate and multivariate models for the stock market

In this section we will introduce different stochastic processes that have been used to model stock market dynamics, both in the univariate and multivariate case.

2.2.1

Geometric Brownian motion

A Brownian motion W cannot be used directly to describe stock prices, as a Brownian motion takes negative values with positive probability, which is unrealistic. The Bachelier model [9], which represents the first attempt to use the Brownian motion to model stock prices, also has the same drawback of assigning positive probability to negative prices. The geometric Brownian motion keeps most of the nice properties of the Bachelier's model, but at the same time it is guaranteed that price trajectories for the model remain positive. A Geometric Brownian motion S is a continuous time stochastic process satisfying 1 µ -  2 t + Wt 2

St = S0 exp

(2.6)

8

where W is a standard Brownian motion, and µ,  are real parameters with  > 0. This is also known as the Black-Scholes model [18], and for more than 40 years it has been a paradigm to describe stock prices movements. Expression (2.6) is equivalent to

1 log St = log S0 + µ -  2 t + Wt 2

(2.7)

The interpretation of the parameters in the Black-Scholes is as follows: µ represents a drift (or trend) parameter, and it is associated with long term behaviour. The parameter  is associated with variability, and is usually called the volatility parameter. Another way to introduce the Black-Scholes model is through the following stochastic differential equation: dSt = µSt dt + St dWt or equivalently, based on expression (2.7): d log St = 1 µ -  2 dt + dWt 2 (2.9) (2.8)

The connection between expressions (2.6) and (2.8) is given by Ito's formula. For more details about stochastic integration, Ito's formula, and stochastic differential equations, see [14],[12], among other classical references. Based on (2.7) we get that log St is a normally distributed random variable. Moreover, the log-increment log St - log S0 satisfies that:

log St - log S0  N 9

1 µ -  2 t,  2 t 2

(2.10)

The expected value and variance of St can be computed as:

E [St ] = S0 eµt (2.11) var [St ] =
2 2µt S0 e

e

2 t

-1

Figure 2.2 shows several simulated trajectories of a geometric Brownian motion.

Figure 2.2: µ = 0.1 ,  = 0.3 2.2.2 Multivariate Geometric Brownian motion

In this section we will define a multivariate extension of the Geometric Brownian motion in (2.9) Consider a vector µ  R and a symmetric positive definite matrix   Md (R) where Md (R) is the set of real square matrices of order d. Define also diag() as the d-dimensional vector whose elements correspond to the main diagonal of matrix .

10

Consider S (t) = (S1 (t), S2 (t), ..., Sd (t)), representing the prices for d different assets, and log S (t)  (logS1 (t)), logS2 (T ), ..., logSd (T )). Then, the multivariate geometric Brownian motion is given by the following stochastic differential equation: 1 µ - diag() dt + 1/2 dWt 2

d log S (t) =

(2.12)

Where W = W 1 , W 2 , ..., W d is a d-dimensional standard Brownian motion defined on the probability space (, F, P). This means that each component W i is a standard Brownian motion, and that the components W i are independent. Analogously to the univariate model, the element µi in vector µ represents the drift parameter of asset i. On the other hand, the matrix  can be written as  
2 1 12 1 2 . . . 1n 1 n        2 2 . . . 2n 2 n  21 1 2  = . . ..  . . . . .    2 n1 n 1 2n 2 n . . . n

          

(2.13)

The parameter i represents the volatility associated to the assets i, and the parameter i,j is a correlation parameter between assets i and j . Moreover, similar to expression (2.10) we have that log S (t) is (multivariate) normally distributed:

log S (t)  N

1 log S (0) + µt - diag(t), t 2

(2.14)

Clearly, each of the components Si of S is itself a univariate geometric Brownian motion. 11

2.3

Derivatives

A financial derivative is a financial contract that derives its value from an underlying asset. This underlying asset may be a stock, index, interest rate. History shows that the first financial derivatives were developed to secure the supply of commodities both in time and geographical distance as well as to protect against changes in prices and to mitigate risks. Derivatives fostered trade and contracts evolved over history primarily to meet the specific needs of traders. For example derivatives were an instrument for farmers to insure them against a corp failure, for merchants to finance their future commercial activities and for governments and churches to raise money ,(Steve Kummer and Christian Pauletto 2012) [8]. Derivatives may be traded on exchanges or over the counter(OTC). Exchanges traded derivatives are standardized contracts. Trading over the counter is generally only available to professional investors in wholesale markets. Derivatives can be classified in several groups such as: · future or forward is a contract enter into a transaction at a given price on a given date or dates in the future.Such contract called future when traded on an exchange or forward when traded OTC. · Swap contracts are agreement to exchange one asset for another. The asset is usually a future payment or stream of payments. · Options are financial contracts that give the buyer the right (but importantly) not

12

the obligation to enter into pre-arranged financial agreement at a pre-defined price on a future date or dates. The above examples are the most common forms of contracts on financial derivatives. There are many other types that could be made out of a combination of the above examples. When these forms are combined, the contract takes on new features or characteristics that are unique and different from the other forms.

2.3.1

Classification of options

An option is a contract that gives the buyer the right but not the obligation to buy or sell an underlying asset S at a specified price called strike price K on or before a certain date calls expiry time T . A cash flow when an option is exercised is referred to as payoff. An option where the holder has the right to buy the underlying at maturity called call option. Conversely, an option where the holder has the right to sell the underlying at maturity is known as a put option. A call option contract hedges upward movement of the price of underlying asset and buying a put option contract hedges downward movement of the price of underlying asset. Selling or writing a call or put option is just the opposite and is a short position because the investor owes the holder the right to buy the shares from or sell the shares to him at the holder's discretion. For a simple example, let's say we purchase a call option on shares of Intel (INTC) with strike price of $40 and expiration (maturity) date of Sep. 16th. This option will give you the right to purchase a share of Intel at a price of $40 on Sept 16th (the right to do this, of

13

course,will only be valuable if Intel is trading above $40 per share at that point of time).Let's imaging the price of trading is $45 per share. In this case the profit is $(45 - 40) = $5. If the price per share fall to $35 per share, we do not exercise and the profit will be zero. The payoff for European call/put option can be shown as following formula: H c (S, T ) = C call (S ) = (ST - K )+ (2.15) H (S, T ) = C
p put

(S ) = (K - ST )

+

Where the plus sign indicates the positive part of a real number.       x if x  0 + x =      0 if x < 0

(2.16)

In other words, the holder of a call option would thus earn ST - K if ST > K and zero if ST  K . The vast majority of options are either European or American options. These options where the payoff is calculated similarly are referred to as vanilla options. Vanilla options have a fixed strike price, expiration date and a single underlying asset. The payoff equals the difference between the value of the underlying asset and the strike price.The options where the payoff is calculated differently are categorized as exotic options. There are different type of exotic options as ,Barrier options,Asian options, Bermudan options, Binary options, Rainbow options, Look back options, Reload options.

2.3.1.1

European options vs. American option

European options can only be exercised at the expiration time T defined in the contract. The holder of European call/put option has the right to buy/sell an underlying for strike 14

price at expiration date. American options are very similar to European options but they have one additional feature. American options [4][15] can be exercised at any time on or before the expiration time T defined in the contract.

2.3.1.2

Path dependent options

Contrary to a European option, in which the payoff only depends on the underlying asset's value at maturity time T , a path dependent option's payoff is determined by the whole path of the underlying asset's price. Some common path dependent options are: · A basic American option as it can be exercised at any time prior to expiration. · An Asian option, also called an average option, because its payoff is based on the average price of the underlying asset during the contract term. One advantage of Asian options is that these reduce the risk of market manipulation at maturity. The payoff for an Asian option is usually given by 1 T
T +

H=

Sr dr - K
0

(2.17)

· A barrier option as its value changes to existence or extinguishes if the underlying asset reaches or surpasses a specified price. Barrier options are also cheaper than a similar option without barrier.The most common barrier options, namely up-andin(UI), up-and-out (UO), down-and-in(DI) and down-and-out(DO) call option. The

15

respective payoffs of UI and UO barrier call options are as below: HU I = (ST - K )+ 1[B,) (MS ) (2.18) HU O = (ST - K )+ 1(-,B ] (MS ) Where MS = sup {St ; 0  t  T } and 1I (x) is an indicator function equal to one if x belongs to interval I and zero otherwise.

2.3.2

Option pricing

Options like those covered in the previous section give their owner the possibility of receiving a positive payoff at a future time. One of the most important problems in financial mathematics is to determine the "fair" value of such contracts. This problem is known as option(or derivative) pricing. The problem of option pricing gained a lot of attention in the early 1970s, after the Chicago Board Options Exchange and other markets around the world started trading these derivatives contracts. In these circumstances, the now famous works of Black, Scholes and Merton gave a solid mathematical framework, and basic insights and principles related to the solution of the pricing problem. Since those early days, the theory of derivatives pricing has developed considerably. The level of mathematical sophistication that is needed to solve these problems is also very high. In this section we will review some of the basic elements of option pricing theory. One of the first insights in the mentioned works is the idea that the price of an option should be the necessary amount of capital needed at initial time in order to replicate the payoff at maturity time T . This idea, coupled with the notion that there should not exist 16

arbitrage opportunities in the market, was used to derive a partial differential equation (PDE) whose solution gives the option price. If the market is complete, meaning that we can perfectly replicate any future payoff, this replication methodology provides the answer to the pricing problem. However, this completeness condition is not always satisfied. On the other hand, other works in the late 1970s and early 1980s notably Harrison (1981)[6] established the relationship between the option pricing problem and the notion of martingale. The basic idea is as follows: if there exists a unique probability measure Q, equivalent to the actual probability measure P, such that the discounted underlying asset price process e-rt Xt is a martingale under Q, then the fair price for a derivative with payoff h(ST ) is the discounted expected value of the payoff under Q:

P = e-rT EQ h(ST )

(2.19)

Such a probability measure is called "martingale measure" or "risk neutral" measure. In the case of incomplete markets, when there exist more than one probability measure, the pricing problem is solved by selecting one of the available risk neutral measures Q, based on some criteria, and the expression (2.19 ) is still used to compute the derivative price. It is not always possible to find this expected value explicitly, but in some well know cases, notably within the Black-Scholes model, we do have explicit expressions for the option price.

17

2.3.2.1

Pricing under the Black-Scholes model

If the asset satisfies a Geometric Brownian motion as in expression (2.6) then it is possible to prove that there exists just one risk neutral measure Q for that model. Moreover, under Q the prices satisfy that: S (t) = S (0)exp 1 r -  2 t + Wt 2 (2.20)

The only difference between expressions (2.6) and 2.20 is that µ was replaced by the interest rate r. In general, the dynamics of the asset price process under the risk neutral measure Q is usually obtained by replacing the drift term by the riskless rate r. Under this model for the asset, and using (2.19) it can be found that at initial time t = 0, the price of the European call with exercise price K and time of maturity T is given by C = e-rT EQ (ST - K )+ which results in the following explicit expression: (2.21)

C (0, r, K, T, , S0 ) = S0 (d1 ) - exp(-rT )K (d2 )

(2.22)

Where (x) is the cumulative standard normal distribution function and, ln d1 = S0 K 1 + r + 2 T 2   T

(2.23)

 d2 = d1 -  T

18

2.3.2.2

Multivariate options pricing

In the case of derivatives that depend on several assets, the risk neutral valuation idea remains valid. If ST represents a vector of asset prices at maturity time T , and some derivative has a payoff h(ST ), then we can use the same pricing equation (2.19) as long as each (discounted) component in the multivariate price process S is a martingale under Q. As an example we can consider a bivariate process S = (S1 , S2 ). A spread option is a type of European derivative with payoff given by: P = (S1 (T ) - S2 (T ) - K )+ (2.24)

In the case that S is considered a multivariate geometric Brownian motion like in (2.12) we have that P = e-rT EQ (S1 (T ) - S2 (T ) - K )+ |S1 (0), S2 (0) (2.25)

For spread options, it is not possible to give an explicit expression for this expected value, but there are some closed form approximations that give very accurate results. Among them, we have the one proposed by Li, Deng and Zhou [3], which we will use in this thesis. In general, the pricing problem can not be solved exactly except for a handful of cases. This means that in practice we have to use approximated methods to find option prices. Some of these methods are either related to the solution of some PDE, or the use of Monte Carlo methods to evaluate expected values, after a risk neutral measure is chosen. In both cases, and depending on the complexity of the model for the assets, these methods may not be very efficient from a computational point of view. On the other hand, practitioners need efficient methods. That is the reason why in this thesis we study the problem of providing 19

closed-form approximations for derivative prices, as an alternative to the pricing methods mentioned above.

20

Chapter 3

PRICING APPROXIMATION UNDER A SWITCHING REGIME MODEL WITH TWO STATES

It is well-known that volatility of financial time series changes over time. Different models have been developed to capture this empirical phenomena. One of the first works in this direction is the discrete time GARCH model proposed by Bollerslev in 1987 [1]. The option pricing in GARCH models was investigated by Duran in 1995 [7]. Option pricing in a continuous time stochastic volatility was considered by Hull and White in 1987 and Markov switching model which modeled by Hamilton (1988) [2]. In 1989 Turner and Nelson[19] applied switching model for excess returns in which returns switch between low and high variance regime. In 1998 Lam and Li [10] generalized the model to Markov switching regime. Most of these works, and subsequent applications of Markov chains for financial modelling, focus on the univariate case. See Bollen (2000) [21], Campbell (2002)[16] In this chapter we will study the problem of pricing multivariate derivatives under switching regime models. In particular we will focus our attention to spread options and the case of a Markov process with two states. The case of three states is covered in Chapter 4. In Section 3.1 we introduce the multivariate switching regime model of interest in the general case, and in Section 3.2 we discuss the derivative pricing under this switching model

21

for the two-states case. Based on the results from 3.2, in Section 3.3 we propose a closed form approximated price for these derivatives under switching regime models. In section 3.4 we go over the technical details of finding the first two moments of the occupation time, which are needed in our closed-form approximation. In section 3.5 we compare the prices for the proposed linear and quadratic closed-form approximations with Monte-Carlo pricing methods.

3.1

Multivariate switching regime model

In this section we will introduce the notation for a general d-dimensional multivariate model for asset prices that switches between N different Markov model regimes. Suppose (, F, P) is a complete probability space, where P is a real world probability measure. Let  denote the time index set [0, T ] of the model. We assume that the states of the economy are modelled by a continuous time Markov process {Xt }t on (, F, P) with a finite state space  = (X1 , X2 , . . . , XN ). . Without loss of generality we can identify the state space  by a finite set of unit vectors {e1 , e2 , . . . , eN }, where ei = (0, . . . , 1 , . . . , 0)  RN . This notation (using canonic unitary
ith

vectors) is quite standard to model switching regime stochastic processes, see for example [13]. Consider symmetric positive definite matrices j  Md (R), each representing a volatility(covariance) matrix within state j . Now we can write the (stochastic) evolution of the instantaneous switching covariance matrix X,t that depends on the Markov process X as

22

follows
N

X,t =
j =1

Xt , ej j

(3.1)

where < ., . > denotes inner product in RN . Expression (3.1) means that at each time t, the instantaneous covariance matrix X,t will be completely determined by the current value of the switching process Xt . if Xt = ek , then all terms in the sum in (3.1) will cancel out except the k -th term, and X,t = k . In a similar way, if µj  Rd represents the drift parameter within state j , we can define the instantaneous drift parameter as
N

µX,t =
j =1

Xt , ej µj

(3.2)

Then define the following dynamics for the d-dimensional price process S :

d (logS (t)) =

1 µX,t - diag (X,t ) dt + (X,t )1/2 dWt 2

(3.3)

For pricing purposes, a risk neutral measure Q has to be considered. The model in (3.3) is incomplete, due to the uncertainty introduced by X , therefore the risk neutral measure is not unique. For the purposes of this work, let us consider the risk neutral measure Q under which the drift parameters become equal to the interest rate parameter r for all assets. In other words µj = r  (r, r, ..., r)  Rd for all j . Under this risk neutral measure, and conditionally on the path of switching process X , the vector log S (T ) has a multivariate normal distribution N (µG , G ) with

23

1 µG = logS0 + rT - 2
N T

N i=1 0

T

Xs , ei ds diag(i ) (3.4)

G =
i=1 0

Xs , ei ds i
T

Both expressions in (3.4) include terms of the form
0

Xs , ei ds. If we define

T

TX,i =
0

Xs , ei ds

(3.5)

then the random variables TX,i represent what is known in the general theory of Markov process as occupation time for each state: the time that the Markov process spends in state i (or ei in our case).
N

It is clear that
i=1

TX,i = T .

In the particular case of N = 2, meaning that there are only two states for the economy, we can get simplified expressions for the parameters. In particular we will have that TX,1 + TX,2 = T , therefore TX,2 = T - TX,1 . Then we get that the conditional distribution of log S (T ) under the mentioned risk neutral measure Q is a bivariate normal distribution N (µG , G ) with:

G = TX,1 1 + (T - TX,1 )2 µG = logS0 + rT - 1 (TX,1 diag(1 ) + (T - TX,1 )diag(2 )) 2 (3.6)

1 = logS0 + rT - diag (G ) 2 Let us now compare expressions (2.14) and (3.6). We can see that in the switching model given by (3.3), conditionally on TX,1 , the distribution of log S (T ) is the same as in 24

the constant parameters model (2.12) by taking T  = G , or equivalently we can write  as a function of TX,1 as follows:

=

G 1 = [TX,1 1 + (T - TX,1 )2 ] = (TX,1 ) T T

(3.7)

Next, we will focus on writing these equations in terms of the individual volatilities and correlations, like in expression (2.13), for the case of d = 2 assets, as it will be our main focus in the simulations carried in Section (3.5).    Let 1 =  
2 1 ,1s


2 1 ,2s



1s 1,1s 2,1s

1s 1,1s 2,1s  2s 1,2s 2,2s    and 2 =      2 2 2 2s 1,2s 2,2s 2 ,1 s ,2s

This notation means that i,js represents the volatility of asset i within state j , and js represents the correlation between the two assets within state j According to expression (3.7) we can write    = 
2 1

1 2

1 2   = 1 [TX,1 1 + (T - TX,1 )2 ]  T 2 2

Then we can get easily get:
2 i =

1 2 2 TX,1 i, 1s + (T - TX,1 )i,2s for i = 1, 2 T

and = 1 TX,1 1s 1,1s 2,1s + (T - TX,1 )2s 1,2s 2,2s T 1 2

3.2

Derivative price under switching models

Suppose that we have to price a European derivative with payoff h(S (T )) = h(S1 (T ) , S2 (T ), ..., Sd (T )) under the multivariate geometric Brownian motion with constant pa25

rameters in (2.12). The derivative price Pc can be found as the discounted expected value of the payoff at maturity time T under risk neutral measure Q: Pc = e-r(T -t) EQ h (S (T )) (3.8)

For simplicity let us consider t = 0, and assume that there exists a closed form expression for this price. That means that we can have Pc expressed as an explicit function of the different parameters of the model. For the purposes of this work, let us ignore some of these parameters (like the interest rate r, the maturity time T , among other parameters) and let us consider Pc only as a function of the covariance matrix . In other words, from now on we will consider Pc = Pc (), even if the other parameters (which are constant for the model) are also included in function Pc . On the other hand, consider the pricing of that same European derivative, with payoff h, but now under multivariate switching process in (3.3). Assume that the switching process X under consideration only has two states. We know from (3.7) that there exists a connection between the two models. Moreover, we have that

P = e-rT EQ h(ST ) = e-rT EQ [EQ (h (ST ) |TX,1 )] (3.9) = EQ e
-rT

EQ (h (ST ) |TX,1 ) = EQ [Pc ((TX,1 ))]

If we define the composite function  = Pc  . then we can rewrite the previous expression as:

P = EQ (TX,1 ) 26

(3.10)

This is an exact expression for the derivative price under the switching model, but evaluating it is not easy. While the function  is known, the expected value EQ (TX,1 ) cannot be found analytically in general. In the following section we propose a methodology to get a closed form approximation of P .

3.3

Approximated closed form for derivative pricing

Intuitively, if X is a random variable, and functions f and g are close in some domain D that contains "most" of the support of the random variable X , then we should expect that Ef (X ) is close to Eg (X ). Following that intuitive principle, we will approximate the price P by using a function  instead of  in expression (3.10). Then, if  is close to , we would expect that EQ (TX,1 ) is close to P . We will use functions  so that EQ (TX,1 ) can be found analytically. Our proposal below is to use Taylor approximations of the function  in order to get the desired approximations for P . These Taylor approximations will be centered around T  = EQ (TX,1 ). Consider first  the linear Taylor approximation of  around T  .
 

(TX,1 ) = (T  ) +  (T  ) (TX,1 - T  ) After taking expected values, the first order approximated price p1 can be obtained: p1 = EQ (TX,1 ) = (T  )


(3.11)

(3.12)

27

The second order Taylor approximation is:
- 1 (TX,1 ) = (T  ) +  (T  ) (TX,1 - T  ) +  (T  ) (TX,1 - T  )2 2

(3.13)

Taking expected values again we have the second order approximated price p2 :
- 1 p2 =EQ (TX,1 ) = (T  ) +  (T  )V arQ (TX,1 ) 2

(3.14)

At this moment, it is important to make some remarks: · Similarly to the way that we defined p1 and p2 , it is possible in theory to provide price approximations pn of arbitrary order n. · Given that the function  is known, we can find explicit expressions for the corresponding derivatives, or we can accurately estimate them using numerical methods. Then, the approximated prices pn can be computed analytically as long as the moments of TX,1 (up to order n) are available. In the next section, we will study the problem of finding the moments of the occupation time TX,1 . · It is known that, in general, Taylor polynomials provide a good approximation of function only locally. In principle, this may affect the overall price approximation, in cases for which the function  and its approximation are not close in some region S of the support of TX,1 in which the probability P (TX,1  S ) is not small. We will see that in many examples, the second order Taylor approximation will be accurate enough in a very large region of the support of TX,1 , so the proposed method will work very well. 28

3.4

Calculation of moments of occupation times

As mentioned in the previous section, we must find EQ (TX,1 ) and V arQ (TX,1 ) in order to compute the proposed price approximations p1 and p2 . We have the set {e1 , e2 } representing the two states of the Markov process X . Assume that this Markov Process has transition rate matrix:  

1   -1  Q=   2 -2 We will also assume that the initial state of the Markov Chain X0 is known. Define
t

Y (t) =
0

< Xs , e1 > ds (3.15)

mi (t) = EQ (Y (t)|X0 = ei ) Then, the conditional expectation of random variable TX,1 satisfies: (3.16)

EQ (TX,1 |X0 = ei ) = mi (T ) We have that:

for i = 1, 2

mi (t) = E (Y (h) + (Y (t) - Y (h)) |X0 = ei ) (3.17) = EQ (Y (h)|X0 = ei ) + EQ (Y (t) - Y (h)|X0 = ei )

29

Then, using the law of total probability and expression (2.4) we get:     (1 - 1 h)h + 1 h · h     i=1      + m2 (t - h) (1 h) + m1 (t - h) (1 - 1 h) + o(h)      mi (t) =         (1 - 2 h)0 + 2 h · h     i=2      + m1 (t - h) (2 h) + m2 (t - h) (1 - 2 h) + o(h)

(3.18)

After subtracting mi (t - h) from both sides, dividing by h and taking the limit as h approaches 0, we get:      1 + m2 (t)1 - m1 (t)1     0 + m1 (t)2 - m2 (t)2 for i = 1 (3.19) for i = 2

mi =

The solution to this system of first order linear differential equation with constant coefficients and initial conditions m1 (0) = m2 (0) = 0 is given by: 1 1 (1 - e-tc ) + tc2 c2 2 m2 (t) = 2 tc - 1 + e-tc c m1 (t) = where c = (2 + 1 ). Analogously, we can also find the variance of the random variable TX,1 as follows: (3.21)

(3.20)

V ar (TX,1 |X0 = ei ) = Mi (T ) - m2 i (T ) where Mi (t) = EQ Y 2 (t)|X0 = ei .

for i = 1, 2

30

We have that Mi (t) = EQ Y 2 (t)|X0 = ei = EQ (Y (h) + Y (t) - Y (h))2 |X0 = ei = EQ Y 2 (h) + (Y (t) - Y (h))2 + 2Y (h)(Y (t) - Y (h))|X0 = ei (3.22) = EQ Y (h) |X0 = ei + EQ (Y (t) - Y (h)) |X0 = ei + EQ (2Y (h)(Y (t) - Y (h))|X0 = ei ) Therefore, using (2.4) we get:       (h)2 + M2 (t - h)1 h + M1 (t - h)(1 - 1 h)           +2h (m2 (t - h)(1 h) + m1 (t - h)(1 - 1 h)) + o(h) i = 1      Mi (t) =         2   (h) + M1 (t - h)2 h + M2 (t - h)(1 - 2 h)         i=2 +0 (m1 (t - h)(2 h) + m2 (t - h)(1 - 2 h)) + o(h)
2 2

(3.23)

After subtracting Mi (t - h), dividing by h and taking limits as h approaches 0, we have:      M2 (t)1 - M1 (t)1 + 2m1 (t) i = 1 Mi = (3.24)     i=2 M1 (t)2 - M2 (t)2 The solution to this system of linear ordinary differential equations is given by: 1 2 2 2 -tc t 2 c + t(41 2 c - (2 - 1 )2e-tc 2 - 1) 1 ) + 21 (22 - 1 )(e c4 2 2 -tc M2 (t) = 4 t2 c2 2 + 2t(c1 2 - 2 - 1) 2 + 1 ) + (21 - 2 )(e c M1 (t) = Where c = (2 + 1 ) In principle, this same technique can be used to find higher order moments of the occupation time TX,1 . 31

(3.25)

3.5

Numerical case study

In this section we will implement the pricing methodology introduced in Section 3.3 for some parameter sets in the case of a switching regime model with two states. In order to asses the accuracy of these approximated prices p1 and p2 we will compare the results with those obtained using Monte Carlo methods. We consider a spread option as defined in (2.25). The price Pc = Pc () of the spread option, under the multivariate model with constant covariance matrix  in (2.12) can be found using the closed-form expression in [3]. This closed form expression is not exact, but it provides a very accurate approximation for spread option prices, so it serves for the purposes of this work. Consider the function  as in expression (3.10). Figure 3.1 shows  and its linear and quadratic approximations.

Figure 3.1:  and its linear and quadratic approximation ( = 5) The parameters used to generate this figure are as follows: 32

-The switching process is initialized in the first state e1 and  = 1 = 2 = 5. With these parameters we get T  = E (TX,1 ) = 0.0.5501. The Taylor polynomials are considered around this point. -Maturity time is T = 1, and the interest rate is r = 0.03. -The volatilities and correlations under each regime are given by: Regime 1: 1,1s = 0.2, 2,1s = 0.3, 1s = 0.4 Regime 2: 1,2s = 0.4, 2,2s = 0.6, 2s = 0.5 -The initial asset prices are S1 (0) = 100, S2 (0) = 110 and the strike price is K = 10. We can see that both the linear and the quadratic approximations are very close to  for values of TX,1 close to T  . On the other hand, for values of TX,1 near 0 or 1, the linear approximation is not very accurate. For this set of parameters, the quadratic approximations is very accurate even close to the interval endpoints. As explained at the beginning of Section 3.3, we would expect that if TX,1 takes these extreme values (close to 0 or 1) with small probability, the approximated prices p1 and p2 (especially p2 ) will be close to the actual price. Then let us take a closer look to the probability distribution of TX,1 .

33

Figure 3.2: Histogram of TX,1 for  = 5 and 105 Monte-Carlo realizations The histogram in Figure 3.2 shows the empirical distribution of TX,1 generated using 105 simulated trajectories of the switching process X , with the same parameters mentioned above. We can see that the values of TX,1 that are far away from T  = E (TX,1 ) = 0.5482 are a lot less likely than values close to T  . Under these circumstances we would expect that the proposed price approximations p1 and p2 work well. In Table 3.1 we compare the approximated closed-form prices p1 and p2 to prices obtained using Monte Carlo with 105 simulated trajectories. As expected, we can see that for the case of the parameters above ( = 5) both p1 and p2 fall within the confidence interval given by Monte Carlo. On the other hand, we see that p1 and p2 are very close to each other. This is because the extra term used to compute p2 is very small. This extra term is given by 1  (T  )V arQ (TX,1 ) 2

suggesting that if the variance V arQ (TX,1 ) is large, the difference between p1 and p2 would be more visible.

34

Price  MonteCarlo p1 p2

Running Time MonteCarlo Appr. closedform

5 1

17.9±0.21 15.54± 0.18

17.93 16.14

17.80 15.73

32.34 12.6

0.07 0.025

Table 3.1: Linear and quadratic prices p1 and p2 vs Monte Carlo for different values of 

Figure 3.3 shows the theoretical value of the variance of TX,1 as a function of the intensity  for maturity T = 1. We can see that there are values of  for which the variance of TX,1 is larger than for  = 5. Next we will choose  = 1 to check the accuracy of p1 and p2 in the case of larger variance of TX,1 .

Figure 3.3: Variance of TX,1 as a function of  Figure 3.4 shows  and its linear and quadratic approximation for  = 1. All the other 35

parameters remain identical to the previous example. In this case, the expansion occurs around T  = 0.7159. We can see that for values of TX,1 close to 0, the linear approximation performs poorly with respect to the second order approximation. If the values of TX,1 close to 0 are not very unlikely, this could imply that p1 and p2 may not be very close.

Figure 3.4:  and its linear and quadratic approximation ( = 1) Let us take a closer look to the probability distribution of TX,1 when  = 1.

36

Figure 3.5: Histogram of TX,1 for  = 1 and 105 Monte-Carlo realizations The histogram in Figure 3.5 shows the empirical distribution of TX,1 generated using 105 simulated trajectories of the switching process X , for  = 1. While the most frequent values of TX,1 are close to 1, values close to 0 are not very unlikely. In Table 3.1 we can see the expected effect: for  = 1 the difference between p1 and p2 is noticeable. Moreover, we can see that p2 gives a much better approximation for the price of the spread option than p1 . Table 3.2 compares the approximated prices p1 and p2 with Monte-Carlo prices for different values of the volatility regarding to asset two for  = 5. All other parameters are the same as in the previous example. Table 3.3 does the same but for  = 1. We can see in both Tables 3.2 and 3.3 that the second order approximation price p2 provides accurate pricing values for the spread option.

37

Price Volatility of second MonteCarlo Linear Appr. Quadratic appr.

Simulation Time MonteCarlo Appr. model

derivative 2,1s = 0.3, 2,2s = 0.6 2,1s = 0.1, 2,2s = 0.6 2,1s = 0.1, 2,2s = 0.8 20.34±0.27 21.07 20.62 34.10 0.025 16.03±0.18 16.39 16.11 33.60 0.03 17.9±0.21 17.93 17.80 32.34 0.07

Table 3.2: Linear and quadratic approximated prices for  = 5 and different parameters for the volatility of the second asset

38

Price Volatility of second MonteCarlo Linear Appr. Quadratic appr.

Simulation Time MonteCarlo Appr. model

derivative 2,1s = 0.3, 2,2s = 0.6 2,1s = 0.1, 2,2s = 0.6 2,1s = 0.1, 2,2s = 0.8 15.42±0.23 17.40 15.60 12.86 0.025 12.68±0.15 13.82 12.77 13.26 0.026 15.54± 0.18 16.14 15.73 12.6 0.025

Table 3.3: Linear and quadratic approximated prices for  = 1 and different parameters for the volatility of the second asset

39

In particular, in Table 3.3 for the case where  = 1 we can see that there could exist a large different between p1 and p2 for some sets of parameters. The improvement of p2 over p1 is substantial in many of these cases. Table 3.4 shows the results of pricing for different maturity times, all other parameters remaining identical as in the previous example. It is interesting to notice that the running time for the Monte Carlo method (with 105 simulated trajectories) increases as the maturity time increases, while the running time for the proposed approximated methods remains essentially constant. Price Maturity time T MonteCarlo 0.25 0.5 1 6.85±0.07 10.38±0.11 15.84±0.18 Linear appr. 6.97 10.57 16.14 Quadratic appr. 6.72 10.24 15.73 MonteCarlo 8.45 9.7 33.2 Appr. model 0.023 0.025 0.023 Running Time

Table 3.4: Linear and quadratic approximated prices for  = 1 and different maturity times

Table 3.5 shows the spread option prices and running time for different strike prices. Monte Carlo prices were obtained using 10^5 realizations. The results show that the spread options price decrease with increasing strike prices as expected. It also shows that the second order approximated prices are very accurate compared to the Monte Carlo prices. Finally, Table 3.6 shows the price results using different number of Monte Carlo samples. 40

Price Strike price MonteCarlo 5 10 20 17.98±0.19 15.76±0.19 12.02±0.17 Linear appr. 18.43 16.14 12.35 Quadratic appr. 18.04 15.73 11.89

Running Time MonteCarlo 12.47 12.59 12.35 Appr. model 0.022 0.024 0.025

Table 3.5: Linear and quadratic approximated prices for  = 1 and different parameters for strike price

The results show dramatic increase in simulation time when the number of the samples in Monte-Carlo simulation increases. It also shows that even 106 realizations we get similar accuracy as using the quadratic approximation p2 . For these parameters, using 103 or 104 samples to get the Monte Carlo prices still leaves the price in a rather large confidence interval. Overall, we have established in this section that the proposed closed-form price approximations provide a very efficient way to compute spread option prices in a switching regime model with two states. For the chosen parameters, the accuracy of the methodology is comparable to that of Monte-Carlo methods, but a lot more efficient from a computational point of view.

41

Numbers of samples in Monte-Carlo MonteCarlo 103 104 105 106 16.96±1.88 15.72±0.58 15.77±0.18

Price Linear appr. 16.14 16.14 16.14 Quadratic appr. 15.73 15.73 15.73 15.73

Running Time MonteCarlo 0.36 1.45 12.55 121.63 Appr. model 0.025 0.022 0.023 0.028

15.77±0.059 16.14

Table 3.6: Linear and quadratic approximated prices for  = 1 and different Number of simulation in Monte Carlo

42

Chapter 4

PRICING APPROXIMATION UNDER A SWITCHING REGIME WITH THREE STATES

In this chapter we solve the same problem as in Chapter 3 but now in the case of a Markov switching process with three states. While some of the steps are analogous to the two-states case, having three states instead of two is an interesting step forward in several aspects. On one hand, from the modelling point of view it shows the flexibility of the model. On the other hand, from a purely mathematical point of view, the complexity of the problem also increases in two meaningful ways: 1-In order to find the moments of the occupation we will have to solve linear systems of ordinary differential equations with constant coefficients. These systems will have three equations, which adds considerable difficulty to the problem, compared to the systems of (two) differential equations that we solved in Section 3.4. 2-We will have to rely on multivariate Taylor expansion instead of the univariate Taylor expansions that we used in Chapter 3. In Section 4.1 we go over the bivariate model with two switching regimes. In Section 4.2 we discuss the pricing problem under this model and we formulate the closed form approximation for the derivatives prices using Taylor expansions. In section 4.4 we shows simulated results that prove the accuracy of the proposed methodology.

43

4.1

Regime switching model with three states

Consider the asset price model in expression (3.3). We will assume that d = 2, and X is a Markov process with state space (e1 , e2 , e3 ). If TX,i is defined as in (3.5) we have that: T = TX,1 + TX,2 + TX,3 (4.1)

Under the risk neural measure Q, The distribution of log S (T ) is given by expression (3.4) for N = 3. Using (4.1) in this case we get the following expression expression for G :

G = TX,1 1 + TX,2 2 + (T - TX,1 - TX,2 )3

(4.2)

In this case, conditionally on TX,1 and TX,2 , the distribution of log S (T ) is the same as in the constant parameters model (2.12) by taking T  = G , or equivalently we can write  as a function of TX,1 and TX,2 : = 1 [TX,1 1 + TX,2 2 + (T - TX,1 - TX,2 )3 ] =  (TX,1 , TX,1 ) T (4.3)

These equations can be written in terms of the individual volatilities and correlations. Consider   1 =  
2 1 ,1s




2 1 ,2s



1s 1,1s 2,1s 
2 1 ,3s

2s 1,2s 2,2s  1s 1,1s 2,1s    ,2 =      2 2 2     2 s 1 , 2 s 2 , 2 s 2,2s ,1s  3s 1,3s 2,3s    2 2 ,3s

 and 3 =  

3s 1,3s 2,3s

44

According to expression (4.3) we can write:    = 
2 1

1 2

1 2   = 1 [TX,1 1 + TX,2 2 + (T - TX,1 - TX,2 )3 ]  T 2 2

(4.4)

Then we can easily get:
2 i =

1 2 2 2 TX,1 i, 1s + TX,2 i,2s + (T - TX,1 - TX,2 )i,3s for i = 1, 2 T

(4.5)

and = (TX,1 1 1,is 1,js + TX,2 2 2,is 2,js + (T - TX,1 - TX,2 ) 3 3,is 3,js ) T js is (4.6)

4.2

Approximated closed form under a switching regime model with three states

Again we assume a European derivative with payoff h and interest rate r. Analogous to what we did in Section 3.2 we have that the price of such derivative is given by: P = e-rT EQ h(ST ) = e-rT EQ [EQ (h (ST ) |(TX,1 , TX,2 ))] (4.7) = EQ e
-rT

EQ (h (ST ) |(TX,1 , TX,2 )) = EQ [Pc ((TX,1 , TX,2 )]

As before, we got P = EQ  (TX,1 , TX,2 ) where  = Pc  . This expected value is difficult to find in general, so we will approximate  by other functions close to it, such that the expected value can be found explicitly.
  Let T  = (T1 , T2 ) where Ti = EQ (TX,i ) for i = 1, 2 and consider the Taylor linear

approximation of  around T   R2 . (TX,1 , TX,2 ) = (T  ) +
-

    (T  ) (TX,1 - T1 )+ (T  ) (TX,2 - T2 ) TX,1 TX,2 45

(4.8)

Then, the first order price can be obtained: p1 = EQ (TX,1 , TX,2 ) = (T  ) The second Taylor approximation is: (TX,1 , TX,2 ) = (T  ) + + +
 -

(4.9)

    (T  ) (TX,1 - T1 )+ (T  ) (TX,2 - T2 ) TX,1 TX,2 (4.10)

1 2 1 2   2   2 ( T ) ( T - T ) + X, 1 1 2 2 (T ) (TX,2 - T2 ) 2 TX, 2 T 1 X,2 2   (T  ) (TX,1 - T1 ) (TX,2 - T2 ) TX,1 TX,2

Taking expected values we have:
  p2 =EQ (TX,1 , TX,2 ) = (T1 , T2 )+ 

1 2 1 2   ( T ) V ar ( T ) + X,1 2 2 (T )V ar (TX,2 ) 2 TX, 2 T 1 X,2 + 1 2 (T  )Cov (TX,1 , TX,2 ) 2 TX,1 TX,2

(4.11)

As  is known, then we can evaluate (4.9) (4.11) as long as the involved moments of TX,i can be computed. In Section 4.3 we will compute these moments for the case of a three states switching process X . Regarding the mixed second order moment Cov (TX,1 , TX,2 ) it is worth noticing that it can be written in terms of the variances of TX,i (i = 1, 2, 3) as follows: V ar(TX,1 + TX,2 ) = V ar(T - TX,3 ) = V ar(TX,3 ) = V ar(TX,1 ) + V ar(TX,2 ) + 2Cov (TX,1 , TX,2 ) = Cov (TX,1 , TX,2 ) = 1 (V ar(TX,3 ) - V ar(TX,1 ) - V ar(TX,2 )) 2 (4.12)

46

4.3

Calculation of moments of occupation times

Assume that the Markov Process X has space state (e1 , e2 , e3 ) and its transition rate matrix is give by:

  q1,1 q1,2 q1,3   Q=  q2,1 q2,2 q2,3   q3,1 q3,2 q3,3

       

(4.13)

We know from Section 2.1.2 that after reaching state ei , the Markov process X will remain there for a random length of time that is exponentially distributed with parameter i = -qi,i . Also, after this length of time is passed, the Markov process will move from state ei to state ej with probability pi,j as in expression (2.5)
t

Define Y (t) =
0

< Xs , e1 > ds and consider mi (t) = EQ (Y (t)|X0 = ei ). Then we have

mi (t) = EQ (Y (t)|X0 = ei ) = EQ (Y (h) + (Y (t) - Y (h)) |X0 = ei ) = EQ (Y (h)|X0 = ei ) + EQ (Y (t) - Y (h)|X0 = ei ) =
3

EQ (Y (h)|X0 = ei ) +
j =1

EQ (Y (t) - Y (h)|Xh = ej ) Q (Xh = ej |X0 = i)

47

Then we get     h[(1 - 1 h) + hp12 1 + hp13 1 ]+     i=1      (1 - 1 h)m1 (t - h) + 1 hp12 m2 (t - h) + 1 hp13 m3 (t - h) + o(h)                    0(1 - 2 h) + h2 p21 2 + 0hp23 2 + mi (t) = i=2     (1 - 2 h)m2 (t - h) + h2 p21 m1 (t - h) + h2 p23 m3 (t - h) + o(h)                   0(1 - 3 h) + h2 p31 3 + 0hp32 3 +     i=3      (1 - 3 h)m3 (t - h) + h3 p32 m2 (t - h) + h3 p31 m1 (t - h) + o(h) Subtracting mi (t - h) from both sides, dividing by h and taking limits as h approaches 0, we get the following system of linear ordinary differential equations:      i=1  1 (-m1 (t) + p12 m2 (t) + p13 m3 (t)) + 1                mi (t) = i=2 2 (-m2 (t) + p21 m1 (t) + p23 m3 (t))                     3 (-m3 (t) + p32 m2 (t) + p31 m1 (t)) i=3 We can proceed in a similar way to find EQ (TX,2 ). Defining:
t

(4.14)

ni (t) = EQ

< Xs , e2 > ds|X0 = ei
0

i = 1, 2, 3

(4.15)

48

we can derive the system of equations:        1 (-n1 (t) + p12 n2 (t) + p13 n3 (t))               ni (t) = 2 (-n2 (t) + p21 n1 (t) + p23 n3 (t)) + 1                     3 (-n3 (t) + p32 n2 (t) + p31 n1 (t))

i=1

i=2

(4.16)

i=3

We solved the systems (4.14) and (4.16), using the symbolic toolbox in MATLAB. We are not writing the full solutions here as they are very long. On the other hand it is clear that :
t

ki (t) = EQ

< Xs , e3 > ds|(X0 = ei )
0

= T - ni (t) - mi (t)

i = 1, 2, 3

(4.17)

We can find the variance of random variable TX,1 as follows:

V arQ (TX,1 |X0 = e1 ) = M1 (T ) - m2 1 (T ) Where Mi (t) = EQ Y 2 (t)|X0 = ei for i = 1, 2, 3. Then we have: Mi (t) = EQ Y 2 (t)|X0 = ei = EQ (Y (h) + Y (t) - Y (h))2 |X0 = ei = EQ Y (h)2 + (Y (t) - Y (h))2 + 2Y (h)(Y (t) - Y (h))|X0 = ei

(4.18)

(4.19) = EQ Y (h)|X0 = ei + EQ (Y (t) - Y (h)) |X0 = ei + EQ (2Y (h)(Y (t) - Y (h))|X0 = ei ) 49
2 2

Using again the infinitesimal properties of the Markov process X we     h2 + o(h) + (1 - 1 h)M1 (t - h) + h1 p12 M2 (t - h)           + h1 p13 M3 (t - h) + 2h(1 - 1 h)m1 (t - h)          + 21 p12 hm2 (t - h) × 0 + 21 p13 hm3 (t - h) × 0                   o(h) + (1 - 2 h)M2 (t - h) + h2 p21 M1 (t - h)      Mi (t) = + h2 p23 M3 (t - h) + 2(1 - 2 h)m2 (t - h) × 0         + 2h2 p21 hm1 (t - h) + 22 p23 hm2 (t - h) × 0                    o(h) + (1 - 3 h)M3 (t - h) + h3 p32 M2 (t - h)           + h3 p31 M1 (t - h) + 2(1 - 3 h)m3 (t - h) × 0         + 2h3 p31 hm1 (t - h) + 23 p32 hm2 (t - h) × 0

get

i=1

i=2

(4.20)

i=3

Subtracting Mi (t - h) from both sides, dividing by h and taking limits as h approaches 0, we get:       1 (-M1 (t) + p12 M2 (t) + p13 M3 (t)) + 2m1 (t)                2 (-M2 (t) + p21 M1 (t) + p23 M3 (t))                     3 (-M3 (t) + p32 M2 (t) + p31 M1 (t)) i=1

Mi (t) =

i=2

(4.21)

i=3

50

This system of differential equations can also be solved using the MATLAB symbolic toolbox. In order to find the variances of TX,2 and TX,3 we can derive similar systems of differential equations for Ni (t) and Ki (t) where
t 2

Ni (t) = EQ Ki (t) = EQ Then we have:

Xs , e2 ds
0 t 2

|(X0 = ei (4.22) |(X0 = ei

Xs , e3 ds
0

2 2 V arQ (TX,2 |X0 = e1 ) = K1 (T ) - k1 (T ) , V arQ (TX,3 |X0 = e1 ) = K1 (T ) - k1 (T )

4.4

Numerical case study

In this Section we will implement the linear and quadratic approximated prices under the three states switching regime model in Section 4.2. We will compare these results with Monte Carlo prices. As in the previous sections, we will consider a spread option. For the case of three states, the function  has two arguments: TX1 and TX2 , and we need to consider the domain TX,1 + TX,2  T , with TX,1 , TX,2  0. We will approximate  with its linear and
- 

quadratic Taylor approximations:  and  respectively. Figures 4.1 and 4.2 show the error of the linear and quadratic approximation of : R1 =  -  and R2 =  - 
- 

51

Figure 4.1: Error of linear approximated price R1

Figure 4.2: Error of quadratic approximated price R2

52

Figure 4.3: Scatter plot of generated values of pairs (TX,1 , TX,2 ), case  = 5 As expected, we can see that the error R2 is considerably smaller (in absolute terms)


than the error R1 . The second order approximation  is very close to  in a large region of the domain. On the other hand, Figure 4.3 shows a scatter-plot of pairs (TX,1 , TX,2 ). In these figure we can see that the random pairs (TX,1 , TX,2 ) fall in a region of the plane for which the errors discussed above, particularly R2 , are very small. This intuitive argument justifies the utilization of the proposed approximated pricing method. The parameters used to generate these three figures are as follows. The switching process is initialized in the first state e1 and its transition rate matrix is:    -5 3.5 1.5   Q=  3.5 -5 1.5   3.5 1.5 -5       

-Maturity time is T = 1, r = 0.03,S1 = 100, S2 = 110 and the strike price is K = 5. 53

- The volatilities and correlations under each regime are given by: Regime 1: 1,1s = 0.2, 2,1s = 0.3, 1s = 0.4 Regime 2: 1,2s = 0.4, 2,2s = 0.6, 2s = 0.5 Regime 3: 1,2s = 0.6, 2,2s = 0.9, 2s = 0.6 In this example the intensities satisfy 1 = 2 = 3 =  = 5. Table 4.1 below compares the approximated prices using the linear and quadratic Taylor approximations with Monte-Carlo prices. The first line corresponds to the parameters and figures previously discussed. We can see that for this case ( = 5) both the linear and quadratic approximation give very good results compared to Monte Carlo. Price  MonteCarlo 5 1 22.89±0.28 19.34± 0.23 Linear Appr. 23.01 19.98 Quadratic appr. 22.71 19.16 Simulation Time MonteCarlo 37.07 13.77 Appr. model 0.03 0.025

Table 4.1: Linear and quadratic approximated prices for two different  = 5 and  = 1

As in the case of two states, we perform similar computations corresponding to the case  = 1. All other parameters remain the same as discussed before. Here the switching process is initialized in the first state e1 with transition matrix:

54

 0.3000  -1.0000 0.7000   Q=  0.7000 -1.0000 0.3000   0.7000 0.3000 -1.0000

       

Figures 4.4 and 4.5 show the error of the linear and quadratic approximations, and Figure 4.6 shows a scatter-plot of pairs (TX,1 , TX,2 ), when  = 1. Compared to figure 4.3( which corresponds to  = 5), the points in the scatter-plot for  = 1 have more dispersion. In this setting, it is expected that the difference between the linear and quadratic approximated prices (in absolute value) increases with the dispersion in the scatter-plot. We can see in Table 4.1 that this is exactly what happens. For the case  = 1 the linear and quadratic prices are more different, and as expected, the quadratic approximation is considerably more accurate when compared to the Monte Carlo price.

Figure 4.4: Error of linear approximated price R1 for  = 1

55

Figure 4.5: Error of linear approximated price R1 for  = 1

Figure 4.6: Scatter plot of generated values of pairs (TX,1 , TX,2 ), case  = 1 In Table 4.2 we can see that the proposed approximated prices perform very well compared to Monte Carlo for different choices of the volatility parameters. For the simulations reflected in this table, all the other parameters remain the same as mentioned before, and

56

 = 1. On the other hand, Table 4.3 includes MonteCarlo prices with different number of realizations. We can see that in order to get a small confidence interval (plus minus 7 cents) using Monte Carlo, it is necessary to generate 106 scenarios, with a high computational cost. Similar results can be obtained at a tiny fraction of the cost using the quadratic approximated price. Price Volatility of second MonteCarlo Linear Appr. Quadratic appr. Simulation Time MonteCarlo Appr. model

derivative 2,1s = 0.3, 2,2s = 0.6 , 2,3s = 0.9 2,1s = 0.5, 2,2s = 0.8, 2,3s = 0.3 2,1s = 0.6, 2,2s = 0.9, 2,3s = 0.1 28.18±0.30 28.11 27.89 12.86 0.02 24.40±0.30 24.49 24.25 13.03 0.02 19.36±0.23 19.98 19.16 12.64 0.02

Table 4.2: Monte-Carlo simulation v.s. Approximated for different volatility of second derivative for  = 1

57

Numbers of samples in Monte-Carlo Monte-Carlo

Price Linear appr. Quadratic appr. 19.16 19.16 19.16 19.16

Simulation Time MonteCarlo 0.43 1.57 12.73 123.95 0.02 0.02 0.02 0.02 Appr.

103 104 105 106

17.88±1.95 19.08 ±0.71 19.17±0.23 19.26±0.07

19.98 19.98 19.98 19.98

Table 4.3: Monte Carlo simulation, first and second order approximation for  = 1 for different number of Monte Carlo simulation

58

Chapter 5

COMPUTATION OF VALUE AT RISK UNDER SWITCHING REGIME MODELS

Value at Risk (VaR) is a widely used measure of financial risk. For a given portfolio or asset whose value over time is described by St , for given values of 0 <  < 1 and time horizon T , the VaR ( or -VaR) is defined as a threshold value such that the probability of ST going below that threshold is . This means that the VaR is the quantile at level  of the probability distribution of ST . Typically, the considered values of  are 0.1, 0.05 and 0.01, but in some applications even smaller values of  are considered. If ST is a continuous random variable and the cumulative probability distribution F of ST is known, then the -VaR can be found as F -1 (). The main difficulty is that finding F -1 () analytically is only possible in a handful of cases. For many interesting models for ST , the probability distribution of ST is not known, and it becomes impossible to find the VaR analytically. The most used method to find VaR, even for moderately complicated models is MonteCarlo simulations: after simulating a sample of N independent copies ST , ST , ...ST
(1) (2) (N )

of

the random variable ST , it is possible to find the sample quantile at level . As usual with Monte Carlo methods, there are advantages and drawbacks about using this methodology. An obvious advantage is that this kind of approach can be used as long as there is a reliable

59

simulation method for the random variable ST , so it can be applied in most situations. On the other hand, in order to get accurate results we need to simulate a large number N of realizations of ST , which may result in a substantial computational burden. This problem becomes more obvious for very small values of . In this Chapter we deal with the problem of VaR estimation under switching regime models. We will use an approximation technique based on Taylor polynomials to provide a closed-form approximation of the VaR under these switching regime models. This approach will allow us to estimate VaR with minimal computational cost. We will prove that using the proposed methodology, we can get results that are comparable in accuracy to Monte-Carlo Methods, but at a fraction of its computational cost. In Section 5.1 we cover the VaR computation in the case of a single asset, while in Section 5.3. we study the problem of VaR estimation for a portfolio of two assets.

5.1

Closed-form VaR approximation for an asset under switching regime models

In this section we will provide a closed-form approximation for the VaR under switching regime. Assume that the state of the economy is described by a continuous time Markov chain X = {X (t); t  T} with two states (e1 , e2 ) as in Chapter 3. The respective volatilities under each state of the economy are 1 and 2 . So we have that the instantaneous volatility is given by:
2

X,t =
j =1

j Xt , ej

(5.1)

60

Then, assume that the asset under consideration is described by:

d (logS (t)) = µdt + X,t dWt

(5.2)

This may be considered as a particular version of the multivariate model in (3.3) for the one dimensional case, and with drift parameter µ identical in all states. Like in expression in (3.5) consider that TX,1 is defined as the occupation time of the Markov process X on state e1 . Then, we can easily check that conditionally on TX,1 , the distribution of log S (T ) is normal with mean µT and variance
2 2 2 T T = 1 TX,1 + 2 (T - TX,1 )

(5.3)

This means that, while we do not have the unconditional distribution of ST , we do know its probability distribution, conditionally on TX,1 . The VaR in this case is defined as the number v such that

g (v ) = P (ST < v ) = 

(5.4)

Another equivalent way of defining the VaR, given that g is an increasing function (therefore one-to-one) is : v = g -1 () = V aR() We have: g (v ) = P (ST < v ) = E 1(-,v) (ST ) = E E (1(-,v) (ST )|TX,1 ) (5.6) = E (P(ST < v |TX,1 )) = E (f (TX,1 , v )) (5.5)

61

where f is defined as

f (y, v )  P (ST < v |TX,1 = y ) For a model like (5.2) the function f is known, but not the expected value g (v ) = E (f (TX,1 , v )). Then, as in previous chapters we will approximate f using Taylor polynomials, so that we can get a closed-form expression for approximations of g . Consider Taylor polynomials around (T  , v  ) where T  = E (TX,1 ) and v  is defined as the value such that f (T  , v  ) = . The first and second order Taylor polynomials of f around (T  , v  ) are: f1 (TX,1 , v ) = f (T  , v  ) + f   f (T , v )(v - v  ) + (T  , v  )(TX,1 - T  ) v TX,1

f2 (TX,1 , v ) = f (T  , v  ) + + +

f f   (T , v )(v - v  ) + (T  , v  )(TX,1 - T  ) v TX,1

(5.7)

1 2f   1 2f  2    2 ( T , v )( v - v ) + 2 (T , v )(TX,1 - T ) 2 v 2 2 TX, 1 2f (T  , v  )(TX,1 - T  )(v - v  ) TX,1 dv

Taking expected values on both sides of the equations in 5.7 , and using that f (T  , v  ) =  we have the following approximations for g (v ): g1 (v ) = + f   (T , v )(v - v  ) v

f   1 2f   g2 (v ) = + (T , v )(v - v  ) + (T , v )(v - v  )2 v 2 v 2 1 d2 f   + 2 (T , v )var (TX,1 ) 2 dTX, 1 62

(5.8)

It is important to notice that, when taking expected values in (5.7), the only random quantity is TX,1 . Now, to approximate the -VaR, we can solve for v in equations g1 (v ) =  and g2 (v ) = . The function g1 is a linear function of v . Moreover, it is increasing as the partial derivative v = v. For the second order approximation g2 , things are slightly more complicated. The function g2 is a quadratic function of v , so the equation g2 (v ) = , which can be reduced to 1  2 f2   1  2 f2 f2    2   (T , v )(v - v  ) + ( T , v )( v - v ) + 2 (T , v )var (TX,1 ) = 0 v 2 v 2 2 TX, 1 f is clearly positive. Then, the equation g1 (v ) =  has a single solution: v

(5.9)

may have two real solutions, one solution or no real solutions at all. In the simulated examples from Section 5.2, we get two real solutions in all cases. It is not clear whether other sets of parameters will result in g2 (v ) =  having no solutions. Even in the case that we get two solutions for g2 (v ) = , a legitimate questions is: which of the two solutions can be accepted as the approximate VaR? While we do not have a definite answer to that question, it is important to make some observations. Notice that locally (around the point) (T  , v  ), the function f2 is increasing, therefore g2 will be locally increasing around v  . This means that there is an open interval containing v  for which g2 is increasing. There can be at most one solution of the equation g2 =  in that interval, and that would be the solution of the quadratic equation that is closest to v  . This is giving us an intuitive and clear criteria to select one of the two solutions of g2 (v ) = 0, when it has two solutions. We will apply this criteria in the simulations study in Section 5.2. 63

One last observation is that we approximated f by its Taylor polynomials at point (T  , v  ). That does not mean that the proposed approximations for g are the Taylor polynomials corresponding to function g at v  . For instance

g2 (v  ) =  +

1 d2 f    2 (T , v )var (TX,1 ) =  = g1 (v ) 2 dTX, 1

5.2

Numerical case study

In this Section we will compare the proposed methodology to compute VaR, with the results obtained using Monte Carlo simulations. Figure 5.1 shows a histogram of 105 Monte Carlo realizations of the switching regime model ST and the graphical interpretation of the VaR.

Figure 5.1: Histogram of ST and corresponding -VaR The parameters used in this example are µ = 0.03, 1 = 0.3, 2 = 0.5,  = 1 = 2 = 10,  = 0.1, T = 0.5 and S0 = 100. For this set of parameters we have T  = 0.2746 and v  = 67.6695 Figures 5.2 and 5.3 show the errors corresponding to the linear and quadratic Taylor 64

polynomials around the point (T  , v  ), respectively: f1 (tX,1 , v ) and f2 (tX,1 , v ). We can see that the second order approximation f2 (tX,1 , v ) is very close to f in the considered region.

Figure 5.2: Error of linear approximation f1 (TX,1 , v ) - f (TX,1 , v )

Figure 5.3: Error of quadratic approximation f2 (TX,1 , v ) - f (TX,1 , v )

65

Figure 5.4: g (v ), g1 (v ), g2 (v )

Closed form(second order)  Monte-Carlo v


v1 0.1 0.05 0.01 0.001 67.7366 60.9166 49.6219 39.4864 67.6695 61.0396 50.2263 40.4570 29.0929 35.6483 36.7223 34.1993

v2 67.6477 60.8848 49.7456 38.5055

Table 5.1: Linear and quadratic values for VaR for  = 10 and different parameters for  Figure 5.4 shows graphs for g (v ) and its approximations g1 (v ) and g2 (v ). While g2 is a quadratic function, which is not invertible, in the interval under consideration it is an increasing function. Moreover, we can clearly see that in this graph that the equation

66

Closed form(second order)  Monte carlo v


v1 0.3 - 0.3 0.3 - 0.4 0.3 - 0.5 0.3 - 0.6 0.3 - 0.7 75.6873 71.7597 67.7298 63.6495 59.6439 75.6101 71.7843 67.6695 63.4469 59.2290 45.6391 37.5994 29.0929 20.1485 11.4219

v2 75.6101 71.8134 67.6477 63.6444 59.4777

Table 5.2: Linear and quadratic values for VaR for  = 10 and different parameters for the volatility of the second asset

g2 (v ) = 0.1 has a solution in this interval, and that solution is between 65 and 70. Actually, the first row of Table 5.1 covers that case. The quadratic equation g2 (v ) = 0.1 has two solutions v1 and v2 , but according to the criteria mentioned earlier in this Chapter, v2 will be our choice for the VaR in this case, which corresponds to the geometric intuition from Figure 5.3 Also Table 5.1 compares the VaR results for Monte-Carlo simulation and linear and quadratic approximation analysis for different . All other parameters remain as mentioned at the begining of the section. We can see that the VaR obtained using the second order approximation, given by the second root v2 of the quadratic equation g2 (v ) =  provides an accurate estimation of the VaR, when compared to the results obtained using Monte Carlo. We can also see in Table 5.2 the result of VaR estimation with these linear and quadratic 67

approximations, and how they compare to the VaR obtained using Monte Carlo for different sets of volatility parameters. We can see again that that the second order VaR estimation given by v2 is very accurate.

5.3

Closed-form VaR approximation for a two-assets portfolio

Following notation of 3.1 we assume a general d-dimensional multivariate model for asset prices that switches between N = 2 different Markov model regimes. Assume that we have a portfolio formed with two assets. The portfolio value at maturity will be:

RT = wS1 (T ) + (1 - w)S2 (T )

(5.10)

where w is a weight parameter. Similar to our development in Section 5.1, we can define

g (v ) = P (RT < v ) From this expression we get g (v ) = P (RT < v ) = E 1(-,v) (RT ) = E E (1(-,v) RT |S2 (T ), TX,1 ) = E (P(RT < v )|S2 (T ), TX,1 )) = E f (v, Tx,1 , ST ) where f (t, v, s)  P(RT < v |Tx,1 = t, S2 (T ) = s) This function f can be evaluated easily as f (t, v, s) = P (S1 (T ) < v1 ) = P (S1 (T ) < v1 )
(2)

(5.11)

(5.12)

68

where v 1 =

v - (1 - w)s and S1 (T ) has a log-normal distribution with know parameters w

(that depend on s and t). As in the previous section, the fact that f can be evaluated easily does not imply that its expected value g , as in expression (5.12) is easy to obtain. Even more difficult can be finding the -VaR: g -1 (). In order to find -VaR we will use the same procedure as in the previous section:
 approximating f by Taylor polynomials. The point of expansion will be (T  , v  , S2 ) where  T  = E (TX,1 ), S2 = EQ (S2 (T )), and v  , is such that f (T  , v  , s ) = .

The first order Taylor polynomial is:
 f1 (TX,1 , v, S2 (T )) = f (T  , v  , S2 )+

f    (T , v , S2 )(v - v  ) v f    f   + (T , v , S2 )(TX,1 - T  ) + (T  , v  , S2 )(S2 (T ) - S2 ) T S2 (T )

(5.13)

and the second order Taylor polynomial is:

 f2 (TX,1 , v, S2 (T )) = f (T  , v  , S2 )+

f    (T , v , S2 )(v - v  ) v f    f   + (T , v , S2 )(TX,1 - T  ) + (T  , v  , S2 )(S2 (T ) - S2 ) T S2 (T ) 1 2f    1 d2 f  2     2 ( T , v , S )( v - v ) + 2 2 (T , v , S2 )(TX,1 - T ) 2 v 2 2 dTX, 1

+

1 d2 f d2 f     2  + ( T , v , S )( S ( T ) - S ) + (T  , v  , S2 )(TX,1 - T  )(v - v  ) 2 2 2 2 (T ) 2 dS2 dTX,1 dv + + d2 f   (T  , v  , S2 )(TX,1 - T  )(S2 (T ) - S2 ) dTX,1 dS2 (T ) d2 f   (T  , v  , S2 )(S2 (T ) - S2 )(v - v  ) dS2 (T )dv

(5.14)

Now taking expected values and using that f (T  , v  , s ) =  we get 69

g1 (v ) = Ef1 (TX,1 , v, S2 (T )) =  + Then, the only solution to g1 (v ) =  is v = v  .

f    (T , v , S2 )(v - v  ) v

(5.15)

On the other hand, for the second order approximation g2 (v ) = Ef2 (TX,1 , v, S2 (T )) we have that:

g2 (v ) = + +

f   1 2f   1 d2 f  (T , v )(v - v  ) + (T , v )(v - v  )2 + 2 (T , v )var (TX,1 ) 2 v 2 v 2 dTX, 1 d2 f (T  , v, ST (2)
(2)

dTX,1 dSt

)cov (TX,1 , St ) +

(2)

1 d2 f    2 (T ) (T , v , S2 )var (S2 (T )) 2 dS2 (5.16)

Although TX,1 and S2 (T ) are not independent random variables, it is easy to prove that they are uncorrelated, meaning that solving the equation g2 (v ) =  is equivalent to solve the quadratic equation:

0=

f   1 2f   1 d2 f  2  (T , v )(v - v  ) + ( T , v )( v - v ) + 2 (T , v )var (TX,1 ) v 2 v 2 2 dTX, 1 1 d2 f    + 2 (T ) (T , v , S2 )var (S2 (T )) 2 dS2

(5.17)

As mentioned in the previous section, we can not guarantee the unicity of the solution of this quadratic equation. The remarks that we made there are applicable here as well

70

Chapter 6

CONCLUSION

In this thesis we developed a method to approximate the price of derivatives under switching regime. First we introduced some basic concepts of financial mathematics in Chapter 2. These concepts include the Brownian motion and continuous time Markov chain in Section 2.1 and geometric Brownian motion in Section 2.2. These concepts are provided in a single asset environment and a multiple asset environment. In Section 2.3 we walked through the classification of derivatives. we explained the black-Scholes equation which provides an analytical solution to price derivatives on one or many assets. We also talked about multivariate derivative who are not able to being solved by Black-Scholes equation. In this section we referred to few well-known methods with approximated analytical solution. In Chapter 3 we expanded the concept of multivariate derivative by applying switching regime with two states. In this Chapter first we introduced the multivariate regime switching model in Section 3.1. Next in Section 3.2 we explained the derivative under this condition. We also proposed a method to approximate the price of derivative. The approximated model ended to calculation of expected value and variance of occupation time which covered in Section 3.4.The results of the numerical examples described in Section 3.5. In Chapter 4 we went through the same concept with increasing the switching regime states to three, the numerical examples also described in Section 4.4.

71

At last we used the approximated analytical model to calculate VAR in Chapter 5. We applied the concept on both single and two derivatives in Section 5.1 - 5.3 Regarding parameter choices, Estimating the parameters of a switching model from real data can be a challenging problem. In this thesis we have not covered the estimation problem. Then, the parameters that we have chosen for our simulations are within realistic ranges, but they do not come from specific real data sets. For some of these simulations, we have used different parameter sets to show that the proposed methods work well in many instances. However, it is fair to say that a more comprehensive simulation study could give us more information about the accuracy of the proposed methods in a larger set of the parametric space.

72

Appendix A

SYSTEM SOLUTION

The solution of systems (4.14) and (4.16), for two different  = 5 and  = 1 are given as below. The transition matrix regarding to   = 5 is:   1.5000  -5.0000 3.5000   Q=  3.5000 -5.0000 1.5000   3.5000 1.5000 -5.0000 0 0.7000 0.3000        P =  0.7000 0 0.3000       0.7000 0.3000 0

       

mm1 = (7  t)/17 - (20  exp(-(17  t)/2))/289 + 20/289 mm2 = (7  t)/17 + (14  exp(-(17  t)/2))/289 - 14/289 mm3 = (7  t)/17 + (14  exp(-(17  t)/2))/289 - 14/289

M M 1 = (560  t)/4913 + (320  exp(-(17  t)/2))/83521 (A.1) - (400  t  exp(-(17  t)/2))/4913 + (49  t2 )/289 - 320/83521 M M 2 = (84  t)/4913 + (728  exp(-(17  t)/2))/83521 + (280  t  exp(-(17  t)/2))/4913 + (49  t2 )/289 - 728/83521 M M 3 = (84  t)/4913 + (728  exp(-(17  t)/2))/83521 + (280  t  exp(-(17  t)/2))/4913 + (49  t2 )/289 - 728/83521

73

Result of the system equation for : = 5 nn1 = (79  t)/221 - (6  exp(-(13  t)/2))/169 + (20  exp(-(17  t)/2))/289 - 1646/48841 nn2 = (79  t)/221 - (6  exp(-(13  t)/2))/169 - (14  exp(-(17  t)/2))/289 + 4100/48841 nn3 = (79  t)/221 + (20  exp(-(13  t)/2))/169 - (14  exp(-(17  t)/2))/289 - 3414/48841

N N 1 = (387732  t)/10793861 + (330  exp(-(13  t)/2))/28561 + (14  exp(-(17  t)/2))/83521 - (36  t  exp(-(13  t)/2))/2197 + (280  t  exp(-(17  t)/2))/4913 + (6241  t2 )/48841 - 27961784/2385443281 N N 2 = (1295600  t)/10793861 - (684  exp(-(13  t)/2))/28561 + (2156  exp(-(17  t)/2))/83521 - (36  t  exp(-(13  t)/2))/2197 - (196  t  exp(-(17  t)/2))/4913 + (6241  t2 )/48841 - 4449152/2385443281 N N 3 = (108388  t)/10793861 + (954  exp(-(13  t)/2))/28561 - (1890  exp(-(17  t)/2))/83521 + (120  t  exp(-(13  t)/2))/2197 - (196  t  exp(-(17  t)/2))/4913 + (6241  t2 )/48841 - 25698744/2385443281 74 (A.2)

kk 1 = (3  t)/13 + (6  exp(-(13  t)/2))/169 - 6/169 kk 2 = (3  t)/13 + (6  exp(-(13  t)/2))/169 - 6/169 kk 3 = (3  t)/13 - (20  exp(-(13  t)/2))/169 + 20/169

KK 1 = (84  t)/2197 + (408  exp(-(13  t)/2))/28561 (A.3) + (120  t  exp(-(13  t)/2))/2197 + (9  t )/169 - 408/28561 KK 2 = (84  t)/2197 + (408  exp(-(13  t)/2))/28561 + (120  t  exp(-(13  t)/2))/2197 + (9  t2 )/169 - 408/28561 KK 3 = (240  t)/2197 - (320  exp(-(13  t)/2))/28561 - (400  t  exp(-(13  t)/2))/2197 + (9  t2 )/169 + 320/28561 Transition by:  matrix regarding to  = 1 is given   0.3000  -1.0000 0.7000   Q=  0.7000 -1.0000 0.3000   0.7000 0.3000 -1.0000 0 0.7000 0.3000        P =  0.7000 0 0.3000       0.7000 0.3000 0        
2

75

The solution of the system for  = 1 is given by: mm1 = (7  t)/17 - (100  exp(-(17  t)/10))/289 + 100/289 mm2 = (7  t)/17 + (70  exp(-(17  t)/10))/289 - 70/289 mm3 = (7  t)/17 + (70  exp(-(17  t)/10))/289 - 70/289

M M 1 = (2800  t)/4913 + (8000  exp(-(17  t)/10))/83521 (A.4) - (2000  t  exp(-(17  t)/10))/4913 + (49  t )/289 - 8000/83521 M M 2 = (420  t)/4913 + (18200  exp(-(17  t)/10))/83521 + (1400  t  exp(-(17  t)/10))/4913 + (49  t2 )/289 - 18200/83521 M M 3 = (420  t)/4913 + (18200  exp(-(17  t)/10))/83521 + (1400  t  exp(-(17  t)/10))/4913 + (49  t2 )/289 - 18200/83521
2

76

nn1 = (79  t)/221 - (30  exp(-(13  t)/10))/169 + (100  exp(-(17  t)/10))/289 - 8230/48841 nn2 = (79  t)/221 - (30  exp(-(13  t)/10))/169 - (70  exp(-(17  t)/10))/289 + 20500/48841 nn3 = (79  t)/221 + (100  exp(-(13  t)/10))/169 - (70  exp(-(17  t)/10))/289 - 17070/48841

N N 1 = (1938660  t)/10793861 + (8250  exp(-(13  t)/10))/28561 + (350  exp(-(17  t)/10))/83521 - (180  t  exp(-(13  t)/10))/2197 + (1400  t  exp(-(17  t)/10))/4913 + (6241  t2 )/48841 - 699044600/2385443281 N N 2 = (6478000  t)/10793861 - (17100  exp(-(13  t)/10))/28561 + (53900  exp(-(17  t)/10))/83521 - (180  t  exp(-(13  t)/10))/2197 - (980  t  exp(-(17  t)/10))/4913 + (6241  t2 )/48841 - 111228800/2385443281 N N 3 = (541940  t)/10793861 + (23850  exp(-(13  t)/10))/28561 - (47250  exp(-(17  t)/10))/83521 + (600  t  exp(-(13  t)/10))/2197 - (980  t  exp(-(17  t)/10))/4913 + (6241  t2 )/48841 - 642468600/2385443281 (A.5)

77

kk 1 = (3  t)/13 + (30  exp(-(13  t)/10))/169 - 30/169 kk 2 = (3  t)/13 + (30  exp(-(13  t)/10))/169 - 30/169 kk 3 = (3  t)/13 - (100  exp(-(13  t)/10))/169 + 100/169

KK 1 = (420  t)/2197 + (10200  exp(-(13  t)/10))/28561 (A.6) + (600  t  exp(-(13  t)/10))/2197 + (9  t )/169 - 10200/28561 KK 2 = (420  t)/2197 + (10200  exp(-(13  t)/10))/28561 + (600  t  exp(-(13  t)/10))/2197 + (9  t2 )/169 - 10200/28561 KK 3 = (1200  t)/2197 - (8000  exp(-(13  t)/10))/28561 - (2000  t  exp(-(13  t)/10))/2197 + (9  t2 )/169 + 8000/28561
2

78

Appendix B

MATLAB CODES

B.1

Spread option under switching regime with two states

Main function including calculation of the spread option price by Monte-Carlo and call the function regarding the approximation analytic model
1 % 2 clear all ; 3 close all ; 4 S1 = 1 0 0 ; S2 =110; % Value o f t h e u n d e r l y i n g 5 K = 10; % Strike ( exercise price ) 6 r = 0 . 0 3 ; % Risk f r e e i n t e r e s t r a t e 7 h=0.1; 8 rho1 = 0 . 4 ; rho2 = 0 . 5 ; 9 sigma11 = 0 . 2 ; sigma12 = 0 . 4 ; 10 sigma21 = 0 . 3 ; sigma22 = 0 . 6 ; 11 T = 1 ; % Time t o e x p i r 12 T ; 13 j =5; 14 M=10^ j ; % Number o f Monte C a r l o t r i a l s 15 i =1; 16 Q= [ i i ; i i ];

17 Q1=Q d i a g ( d i a g (Q) ) ;

79

18 J=d i a g ( 1 . / sum (Q1 , 2 ) ) Q1 ; 19 t i c 20 %U = rand ; X = (U <= 1 / 2 ) + 2  (U > 1 / 2 ) ; 21 d e l t a t=m a r k o v e s t a t e (Q, J ,M, T) ; 22 %  23 %  Monte C a r l o  24 %  25 d i s p ( ' sigma s t a r t ' ) 26 sigma1 =[ sigma11 sigma12 ] ; 27 sigma2 =[ sigma21 sigma22 ] ; 28 r h o 0 =[ rho1 rho2 ] ; 29 s i g m a 1 2 t =(sigma1 . ^ 2 )  d e l t a t ; 30 s i g m a 2 2 t =(sigma2 . ^ 2 )  d e l t a t ; 31 cov1=rho1  sigma11  sigma21 ; 32 cov2=rho2  sigma12  sigma22 ; 33 c o v t =[ cov1 cov2 ]  d e l t a t ; 34 rho=c o v t . / s q r t ( s i g m a 1 2 t .  s i g m a 2 2 t ) ; 35 N1=randn ( 1 ,M) ; 36 N2=randn ( 1 ,M) ; 37 mu1=( r T 0 . 5  s i g m a 1 2 t ) ; 38 mu2=( r T 0 . 5  s i g m a 2 2 t ) ; 39 f i n a l v a l s 1=mu1 + s q r t ( s i g m a 1 2 t ) .  N1 ; 40 f i n a l v a l s 2=mu2 + s q r t ( s i g m a 2 2 t ) .  41 ...

( rho .  N1+ s q r t ( 1 rho . ^ 2 ) .  N2 ) ;

42 % E v a l u a t e t h e Put o p t i o n o p t i o n s 43 o p t i o n v a l u e s=max ( ( S2  exp ( f i n a l v a l s 2 ) . . .

80

44

S1  exp ( f i n a l v a l s 1 ) ) K, 0 ) ;

45 % D i s c o u n t under r n assumption 46 p r e s e n t v a l s=exp ( r T)  o p t i o n v a l u e s ; 47 % Compute c o n f i d e n c e i n t e r v a l s 48 i n t e r v a l =1.96  s t d ( p r e s e n t v a l s ) / s q r t (M) 49 % Take t h e a v e r a g e 50 c a l l m o n t c a r l o=mean ( p r e s e n t v a l s ) 51 t i c 1=t o c 52 53 t i c 54 apprx=A n a l y t i c A p p r x ( S1 , S2 , T, K, r , r h o 0 , sigma11 , . . . 55 sigma12 , sigma21 , sigma22 , Q( 1 , 1 ) , Q( 2 , 2 ) , J ( 1 , 2 ) , h ) ;

56 t i c 2=t o c 57 t i c 2=t i c 2 apprx ( 1 , 6 ) 58 f i r s t a p p r x=apprx ( 1 , 1 ) 59 s e c o n d a p p r x=apprx ( 1 , 2 ) 60 t 1 s t a r=apprx ( 1 , 3 ) ; 61 t 1 v a r=apprx ( 1 , 4 ) ; 62 s e c o n d d e r=apprx ( 1 , 5 ) ;

Analytic solution including the function for system calculation and function regarding the approximation model for spread option with constant parameters
1 f u n c t i o n v a l u e=A n a l y t i c A p p r x ( S1 , S2 , T, K, r , r h o 0 , sigma11 . . . 2 3 4 , sigma12 , sigma21 , sigma22 , lambda1 , lambda2 , p12 , h ) tic t s t a r=d s o l v e m a t l a b ( lambda1 , lambda2 , p12 ) ;

81

5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20

m1=d o u b l e ( s u b s ( t s t a r ( 1 ) ,T) ) ; M1=d o u b l e ( s u b s ( t s t a r ( 2 ) ,T) ) ; v a r t 1 =(M1 m1^ 2 ) ; t 1 s t a r=m1 ; t i c 3=t o c rho1=r h o 0 ( 1 , 1 ) ; rho2=r h o 0 ( 1 , 2 ) ; p0=d e r i v a t i v e p i ( sigma11 , sigma12 , sigma21 , . . . sigma22 , r , T, t 1 s t a r , rho1 , rho2 , S1 , S2 ,K) ; ph=d e r i v a t i v e p i ( sigma11 , sigma12 , sigma21 , . . . sigma22 , r , T, t 1 s t a r+h , rho1 , rho2 , S1 , S2 ,K) ; p h=d e r i v a t i v e p i ( sigma11 , sigma12 , sigma21 , . . . sigma22 , r , T, t 1 s t a r h , rho1 , rho2 , S1 , S2 ,K) ; s e c o n d d e r =(ph ( 2  p0 )+p h ) / ( h ^ 2 ) ; s e c o n d o r d e r=p0 +0.5  s e c o n d d e r  v a r t 1 ; v a l u e =[p0 , s e c o n d o r d e r , t 1 s t a r , v a r t 1 , . . . second der , t i c 3 ] ;

function for solving system equation
1 f u n c t i o n t s t a r = d s o l v e m a t l a b ( lambda1 , lambda2 , p12 ) 2 % 3 %s o l u t i o n t o t h e e x p e c t e d v a l u e 4 %(m1, m2) and v a r i a n c e (M1,M2) 5 % 6 7 8 syms m1( t ) %r r=r r+t t eqn1 = d i f f (m1) == lambda1  p12  . . . m2( t ) %lambda1 lambda2 p12

82

9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 end

m2

lambda1 m1+1; lambda2  p12  . . .

eqn2 = d i f f (m2) == m1 lambda2 m2 ;

S = d s o l v e ( eqn1 , eqn2 , m1( 0 ) ==0,m2( 0 ) ==0) ; mm1=s i m p l i f y ( S . m1) ; % mm2=s i m p l i f y ( S . m2) ; syms M1( t ) M2( t ) % mm1 mm2 eqn3= d i f f (M1) == M2 lambda1  . . . p12 M1 lambda1+2mm1; eqn4= d i f f (M2) == M1 lambda2  . . . p12 M2 lambda2 ; S = d s o l v e ( eqn3 , eqn4 ,M1( 0 ) ==0,M2( 0 ) ==0) ; %S = d s o l v e ( eqn3 ,M1( 0 ) ==0) ; MM1 =s i m p l i f y ( S .M1) ; % MM2 =s i m p l i f y ( S .M2) ; t s t a r =[mm1,MM1] ;

This function set the parameters for the calling the function regarding approximation for spread option with constant parameters
1 function 2 3 4 5 6 v a l u e=d e r i v a t i v e p i ( sigma11 , . . .

sigma12 , sigma21 , sigma22 , r , T, t 1 s t a r , rho1 , rho2 , S1 , S2 ,K) sigma1=s q r t ( ( sigma11 ^2  t 1 s t a r + . . . sigma12 ^ 2  (T t 1 s t a r ) ) /T) ; sigma2=s q r t ( ( sigma21 ^2  t 1 s t a r + . . . sigma22 ^ 2  (T t 1 s t a r ) ) /T) ;

83

7 8 9 10 11 12 13 cov1=rho1  sigma11  sigma21 ; cov2=rho2  sigma12  sigma22 ; c o v t=cov1  t 1 s t a r+cov2  (T t 1 s t a r ) ; rho=c o v t / (T sigma1  sigma2 ) ; Pi=Deng ( rho , T, K, S1 , S2 , sigma1 , sigma2 , r ) ; v a l u e=Pi ;

Approximation for spread option with constant parameters
1 f u n c t i o n D e n g P r i c e=Deng ( Rho est , T , . . . 2 3 % 4 v 1=sigma1  s q r t (T) ; 5 v 2=sigma2  s q r t (T) ; 6 u 1=l o g ( S1 ) +(r sigma1 ^ 2 / 2 ) T ; 7 u 2=l o g ( S2 ) +(r sigma2 ^ 2 / 2 ) T ; 8 R=exp ( u 2 ) ; 9 e p s = v 2 ^2 RK/ ( 2  (R+K) ^ 2  . . . 10 v 1  s q r t ( 1 Rho est ^2) ) ; K, S2 , S1 , sigma2 , sigma1 , r ) ;

11 C 3=(u 1 l o g (R+K) ) / ( v 1  . . . 12 s q r t ( 1 Rho est ^2) ) ;

13 D 3=( R h o e s t  v 1 v 2 R/ (R+K) ) . . . 14 /( v 1  s q r t ( 1 Rho est ^2) ) ;

15 C 1=C 3+D 3  R h o e s t  v 1+e p s  ( R h o e s t  v 1 ) ^ 2 + . . . 16 v 1  s q r t ( 1 Rho est ^2) ;

17 D 1=D 3+2 v 1  s q r t ( 1 R h o e s t ^ 2 )  e p s ;

84

18 C 2=C 3+D 3  v 2+e p s  v 2 ^ 2 ; 19 D 2=D 3+2 v 2  e p s ; 20 I 1=J0 ( C 1 , D 1 )+J1 ( C 1 , D 1 )  e p s + . . . 21 J2 ( C 1 , D 1 )  ( e p s ) ^ 2 / 2 ;

22 I 2=J0 ( C 2 , D 2 )+J1 ( C 2 , D 2 )  e p s + . . . 23 J2 ( C 2 , D 2 )  ( e p s ) ^ 2 / 2 ;

24 I 3=J0 ( C 3 , D 3 )+J1 ( C 3 , D 3 )  e p s + . . . 25 J2 ( C 3 , D 3 )  ( e p s ) ^ 2 / 2 ;

26 D e n g P r i c e=S1  I 1 S2  I 2 . . . 27 28 K exp ( r T)  I 3 ;

1 f u n c t i o n J0=J0 ( a , b ) 2 J0=normcdf ( a / s q r t (1+b ^ 2 ) ) ;

1 f u n c t i o n J1=J1 ( a , b ) 2 J1=normpdf ( a / s q r t (1+b ^ 2 ) )  (1+(1+a ^ 2 )  b ^ 2 ) /(1+b ^ 2 ) ^ ( 5 / 2 ) ;

1 f u n c t i o n J2=J2 ( a , b ) 2 f a b = ( 6 6  a ^ 2 )  b ^ 2 + ( 2 1 2  a ^ 2 a ^ 4 )  b^4+4  (3+a ^ 2 )  b ^ 6 3 ; 3 J2=normpdf ( a / s q r t (1+b ^ 2 ) )  a  f a b /(1+b ^ 2 ) ^ ( 1 1 / 2 ) ;

B.2

Spread option under switching regime with three states

Main function including calculation of the spread option price by Monte-Carlo and call the function regarding the approximation analytic model

85

1 clear all ; 2 close all ; 3 S1 = 1 0 0 ; S2 =110; % Value o f t h e a s s e t 4 K = 5; % Strike ( exercise price ) 5 r = 0 . 0 3 ; % Risk f r e e i n t e r e s t r a t e 6 h=0.01; 7 rho1 = 0 . 4 ; rho2 = 0 . 5 ; rho3 = 0 . 6 ; 8 sigma11 = 0 . 2 ; sigma12 = 0 . 4 ; sigma13 = 0 . 6 ; 9 sigma21 = 0 . 3 ; sigma22 = 0 . 6 ; sigma23 = 0 . 9 ; 10 f i l l 1 = [ ] ; f i l l 2 = [ ] ; f i l l 3 = [ ] ; f i l l 4 = [ ] ; . . . 11 f i l l 5 =[]; f i l l 6 =[]; f i l l 7 =[];

12 T = 1 ; % Time t o e x p i r 13 j =6; 14 M=10^ j ; % Number o f Monte C a r l o t r i a l s 15 i =1; 16 j =0.7  i ; k =0.3  i 17 Q= [ i j k ; j i k; j k i ];

18 Q1=Q d i a g ( d i a g (Q) ) ; 19 J=d i a g ( 1 . / sum (Q1 , 2 ) ) Q1 ; 20 t i c 21 d e l t a t=m a r k o v e s t a t e (Q, J ,M, T) ; 22 a=cov ( d e l t a t ( 1 , : ) , d e l t a t ( 2 , : ) ) ; . . . 23 cov t1t2m=a ( 1 , 2 ) ;

24 %  25 %  Monte C a r l o  26 % 

86

27 sigma1 =[ sigma11 sigma12 sigma13 ] ; 28 sigma2 =[ sigma21 sigma22 sigma23 ] ; 29 r h o 0 =[ rho1 rho2 rho3 ] ; 30 s i g m a 1 2 t =(sigma1 . ^ 2 )  d e l t a t ; 31 s i g m a 2 2 t =(sigma2 . ^ 2 )  d e l t a t ; 32 cov1=rho1  sigma11  sigma21 ; 33 cov2=rho2  sigma12  sigma22 ; 34 cov3=rho3  sigma13  sigma23 ; 35 c o v t =[ cov1 cov2 cov3 ]  d e l t a t ; 36 rho=c o v t . / s q r t ( s i g m a 1 2 t .  s i g m a 2 2 t ) ; 37 N1=randn ( 1 ,M) ; 38 N2=randn ( 1 ,M) ; 39 mu1=( r T 0 . 5  s i g m a 1 2 t ) ; 40 mu2=( r T 0 . 5  s i g m a 2 2 t ) ; 41 f i n a l v a l s 1=mu1 + s q r t ( s i g m a 1 2 t ) .  N1 ; 42 f i n a l v a l s 2=mu2 + s q r t ( s i g m a 2 2 t ) .  . . . 43 44 ( rho .  N1+ s q r t ( 1 rho . ^ 2 ) .  N2 ) ; % E v a l u a t e t h e Put o p t i o n o p t i o n s

45 o p t i o n v a l u e s=max ( ( S2  exp ( f i n a l v a l s 2 ) . . . 46 S1  exp ( f i n a l v a l s 1 ) ) K, 0 ) ;

47 % D i s c o u n t under r n assumption 48 p r e s e n t v a l s=exp ( r T)  o p t i o n v a l u e s ; 49 % Compute c o n f i d e n c e i n t e r v a l s 50 i n t e r v a l =1.96  s t d ( p r e s e n t v a l s ) / s q r t (M) 51 % Take t h e a v e r a g e 52 c a l l m o n t c a r l o=mean ( p r e s e n t v a l s )

87

53 t o c 1=t o c ; 54 t i c 55 56 apprx=A n a l y t i c A p p r x ( S1 , S2 , T, K, r , r h o 0 , . . . 57 sigma1 , sigma2 , Q, J , h ) ;

58 t i c 2=apprx ( 1 , 1 0 ) 59 %t o c 2=t o c ; 60 t o c 1 61 f i r s t a p p r x=apprx ( 1 , 1 ) 62 s e c o n d a p p r x=apprx ( 1 , 2 ) 63 c a l l m o n t c a r l o 64 i n t e r v a l

Analytic solution including the function for system calculation and function regarding the approximation model for spread option with constant parameters
1 f u n c t i o n v a l u e=A n a l y t i c A p p r x ( S1 , S2 , T , . . . 2 3 4 5 6 7 8 9 10 11 t 2=d o u b l e ( s u b s ( t s t a r ( 1 , 4 ) ,T) ) ; v2=d o u b l e ( s u b s ( t s t a r ( 1 , 1 0 ) ,T) ) ; t 1=d o u b l e ( s u b s ( t s t a r ( 1 , 1 ) ,T) ) ; v1=d o u b l e ( s u b s ( t s t a r ( 1 , 7 ) ,T) ) ; v a r t 1 =(v1 t 1 ^ 2 ) ; K, r , r h o 0 , sigma1 0 , sigma2 0 , Q, p , h ) tic t s t a r=d s o l v e m a t l a b (Q, p , T) ;

88

12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37

v a r t 2 =(v2 t 2 ^ 2 ) ;

t 3=d o u b l e ( s u b s ( t s t a r ( 1 , 1 3 ) ,T) ) ; v3=d o u b l e ( s u b s ( t s t a r ( 1 , 1 6 ) ,T) ) ; v a r t 3 =(v3 t 3 ^ 2 ) ; c o v t 1 t 2 =( v a r t 3 v a r t 1 v a r t 2 ) / 2 ; t i c 3=t o c

p0=d e r i v a t i v e p i ( sigma1 0 , sigma2 0 , . . . r h o 0 , r , S1 , S2 , K, T, t1 , t 2 ) ; pht1=d e r i v a t i v e p i ( sigma1 0 , sigma2 0 , . . . r h o 0 , r , S1 , S2 , K, T, t 1+h , t 2 ) ; p h t 1=d e r i v a t i v e p i ( sigma1 0 , sigma2 0 , . . . r h o 0 , r , S1 , S2 , K, T, t1 h , t 2 ) ; pht2=d e r i v a t i v e p i ( sigma1 0 , sigma2 0 , . . . r h o 0 , r , S1 , S2 , K, T, t1 , t 2+h ) ; p h t 2=d e r i v a t i v e p i ( sigma1 0 , sigma2 0 , . . . r h o 0 , r , S1 , S2 , K, T, t1 , t2 h ) ; p h h t 1 t 2=d e r i v a t i v e p i ( sigma1 0 , sigma2 0 , . . . r h o 0 , r , S1 , S2 , K, T, t 1+h , t2 h ) ; p h h t 1 t 2=d e r i v a t i v e p i ( sigma1 0 , sigma2 0 , . . . r h o 0 , r , S1 , S2 , K, T, t1 h , t 2+h ) ; phh=d e r i v a t i v e p i ( sigma1 0 , sigma2 0 , . . . r h o 0 , r , S1 , S2 , K, T, t 1+h , t 2+h ) ; p h h=d e r i v a t i v e p i ( sigma1 0 , sigma2 0 , . . . r h o 0 , r , S1 , S2 , K, T, t1 h , t2 h ) ;

89

38 39 40 41 42 43 44 45 46 47

s e c o n d t 1 =(pht1 ( 2  p0 )+p h t 1 ) / ( h ^ 2 ) ; s e c o n d t 2 =(pht2 ( 2  p0 )+p h t 2 ) / ( h ^ 2 ) ; s e c o n d t 2 t 1 =(phh+p h h p h h t 1 t 2 p h h t 1 t 2 ) . . . /(4h^2) ; s e c o n d d e r =0.5  s e c o n d t 1  v a r t 1 + 0 . 5  . . . s e c o n d t 2  v a r t 2+s e c o n d t 2 t 1  c o v t 1 t 2 ; s e c o n d o r d e r=p0+s e c o n d d e r ;% % d ( p i ) /d ( sigma )

v a l u e =[p0 , s e c o n d o r d e r , t1 , t2 , v a r t 1 , . . . var t2 , second der , cov t1t2 , var t3 , t i c 3 ] ;

unction for solving system equation
1 f u n c t i o n t s t a r = d s o l v e m a t l a b (Q, p , T) 2 % 3 %s o l u t i o n t o t h e e x p e c t e d v a l u e (m1, m2) 4 %and v a r i a n c e (M1,M2) 5 % 6 7 8 9 10 11 12 13 14 ddd=t i c lambda1 = Q( 1 , 1 ) ; lambda2 = Q( 2 , 2 ) ; . . . lambda3 = Q( 3 , 3 ) ; syms m1( t ) m2( t ) m3( t ) clear

eqn1 = d i f f (m1) == p ( 1 , 3 ) m3

lambda1  ( p ( 1 , 2 ) m2 + . . .

m1 ) + 1 ; lambda2  ( p ( 2 , 1 ) m1 + . . .

eqn2 = d i f f (m2) == p ( 2 , 3 ) m3

m2 ) ; lambda3  ( p ( 3 , 1 ) m1 + . . .

eqn3 = d i f f (m3) ==

90

15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40

p ( 3 , 2 ) m2

m3 ) ;

S = d s o l v e ( eqn1 , eqn2 , eqn3 , m1( 0 )==0 , . . . m2( 0 )==0 , m3( 0 )==0 ) ; mm1=s i m p l i f y ( S . m1) mm2=s i m p l i f y ( S . m2) ; mm3=s i m p l i f y ( S . m3) ; %r r=t t+r r syms M1( t ) M2( t ) M3( t ) c l e a r eqn4 = d i f f (M1) == lambda1  ( M2 p ( 1 , 2 ) + . . . M3 p ( 1 , 3 ) M1 ) + 2 mm1;

eqn5 = d i f f (M2) == lambda2  ( M1 p ( 2 , 1 ) + . . . M3 p ( 2 , 3 ) M2 ) ;

eqn6 = d i f f (M3) == lambda3  ( M1 p ( 3 , 1 ) + . . . M2 p ( 3 , 2 ) M3 ) ;

S = d s o l v e ( eqn4 , eqn5 , eqn6 , M1( 0 )==0 , . . . M2( 0 )==0 , M3( 0 )==0 ) ; MM1 =s i m p l i f y ( S .M1) MM2 =s i m p l i f y ( S .M2) ; MM3 =s i m p l i f y ( S .M3) ; %t s t a r =[mm1,mm2,MM1,MM2] ;

syms n1 ( t )

n2 ( t ) n3 ( t )

clear

eqn7 = d i f f ( n1 ) == p ( 1 , 3 )  n3

lambda1  ( p ( 1 , 2 )  n2 + . . .

n1 ) ; lambda2  ( p ( 2 , 1 )  n1 + . . .

eqn8 = d i f f ( n2 ) == p ( 2 , 3 )  n3

n2 ) + 1 ;

91

41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66

eqn9 = d i f f ( n3 ) == p ( 3 , 2 )  n2

lambda3  ( p ( 3 , 1 )  n1 + . . .

n3 ) ;

S = d s o l v e ( eqn7 , eqn8 , eqn9 , n1 ( 0 )==0 , . . . n2 ( 0 )==0 , n3 ( 0 ) ==0) ; nn1=s i m p l i f y ( S . n1 ) nn2=s i m p l i f y ( S . n2 ) ; nn3=s i m p l i f y ( S . n3 ) ; %r r=t t+r r syms N1( t ) N2( t ) N3( t ) c l e a r eqn10 = d i f f (N1) == lambda1  ( N2  p ( 1 , 2 ) + . . . N3  p ( 1 , 3 ) N1 ) ;

eqn11 = d i f f (N2) == lambda2  ( N1  p ( 2 , 1 ) + . . . N3  p ( 2 , 3 ) N2 ) + 2  nn2 ;

eqn12 = d i f f (N3) == lambda3  ( N1  p ( 3 , 1 ) + . . . N2  p ( 3 , 2 ) N3 ) ;

S = d s o l v e ( eqn10 , eqn11 , eqn12 , N1 ( 0 )==0 , . . . N2 ( 0 )==0 , N3 ( 0 ) ==0) ; NN1=s i m p l i f y ( S . N1) NN2=s i m p l i f y ( S . N2) ; NN3=s i m p l i f y ( S . N3) ;

%kk3=T mm3 nn3 ; syms k1 ( t ) k2 ( t ) k3 ( t ) c l e a r lambda1  ( p ( 1 , 2 )  k2 + . . .

eqn30 = d i f f ( k1 ) == p ( 1 , 3 )  k3 k1 ) ;

eqn31 = d i f f ( k2 ) ==

lambda2  ( p ( 2 , 1 )  k1 + . . .

92

67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 end

p ( 2 , 3 )  k3

k2 )

; lambda3  ( p ( 3 , 1 )  k1 + . . .

eqn32 = d i f f ( k3 ) == p ( 3 , 2 )  k2

k3 )+ 1 ;

S = d s o l v e ( eqn30 , eqn31 , eqn32 , k1 ( 0 )==0 , . . . k2 ( 0 )==0 , k3 ( 0 ) ==0) ; kk1=s i m p l i f y ( S . k1 ) kk2=s i m p l i f y ( S . k2 ) ; kk3=s i m p l i f y ( S . k3 ) ;

syms K1( t ) K2( t ) K3( t )

clear

eqn13 = d i f f (K1) == lambda1  ( K2 p ( 1 , 2 ) + . . . K3 p ( 1 , 3 ) K1 ) ;

eqn14 = d i f f (K2) == lambda2  ( K1 p ( 2 , 1 ) + . . . K3 p ( 2 , 3 ) K2 ) ;

eqn15 = d i f f (K3) == lambda3  ( K1 p ( 3 , 1 ) + . . . K2 p ( 3 , 2 ) K3 ) + 2  kk3 ;

S = d s o l v e ( eqn13 , eqn14 , eqn15 , K1 ( 0 )==0 , . . . K2 ( 0 )==0 , K3 ( 0 ) ==0) ; KK1=s i m p l i f y ( S . K1) KK2=s i m p l i f y ( S . K2) ; KK3=s i m p l i f y ( S . K3) ;

t s t a r =[mm1,mm2,mm3, nn1 , nn2 , nn3 ,MM1,MM2,MM3, NN1 , . . . NN2, NN3, kk1 , kk2 , kk3 , KK1, KK2,KK3 ] ;

93

This function set the parameters for the calling the function regarding approximation for spread option with constant parameters
1 function 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 Pi=Deng ( rho , T, K, S1 , S2 , sigma1 , sigma2 , r ) ; v a l u e=Pi ; cov1=rho1  sigma11  sigma21 ; cov2=rho2  sigma12  sigma22 ; cov3=rho3  sigma13  sigma23 ; c o v t=cov1  t 1+cov2  t 2+cov3  (T t1 t 2 ) ; rho=c o v t / (T sigma1  sigma2 ) ; sigma1=s q r t ( ( sigma11 ^2  t 1+sigma12 ^2  t 2 + . . . sigma13 ^ 2  (T t1 t 2 ) ) /T) ; sigma2=s q r t ( ( sigma21 ^2  t 1+sigma22 ^2  t 2 + . . . sigma23 ^ 2  (T t1 t 2 ) ) /T) ; rho1=r h o 0 ( 1 , 1 ) ; rho2=r h o 0 ( 1 , 2 ) . . . ; rho3=r h o 0 ( 1 , 3 ) ; sigma11=s i g m a 1 0 ( 1 , 1 ) ; sigma12=s i g m a 1 0 ( 1 , 2 ) . . . ; sigma13=s i g m a 1 0 ( 1 , 3 ) ; sigma21=s i g m a 2 0 ( 1 , 1 ) ; sigma22=s i g m a 2 0 ( 1 , 2 ) . . . ; sigma23=s i g m a 2 0 ( 1 , 3 ) ; v a l u e=d e r i v a t i v e p i ( sigma1 0 , . . .

sigma2 0 , r h o 0 , r , S1 , S2 , K, T, t1 , t 2 )

94

B.3

Value at Risk regarding one single asset

Main function including calculation of the value at risk using Monte Carlo and calling the function regarding the analytic model
1 clear all ; 2 close all ; 3 S1 =100; % Value o f t h e u n d e r l y i n g 4 r = 0 . 0 3 ; % Risk f r e e i n t e r e s t r a t e 5 %z a l p h a = 3 . 0 9 ; a l p h a = 0 . 0 0 1 ; 6 z alpha = 1 . 2 8 2 6 ; alpha =0.1; 7 %z a l p h a = 2 . 3 3 ; a l p h a = 0 . 0 1 ; 8 %z a l p h a = 1 . 6 4 4 9 ; a l p h a = 0 . 0 5 ; 9 h=0.1; 10 k = 0 . 0 1 ; 11 rho1 = 0 . 0 ; rho2 = 0 . 0 ; 12 sigma11 = 0 . 3 ; sigma12 = 0 . 5 ; 13 f i l l 1 = [ ] ; f i l l 2 = [ ] ; f i l l 3 = [ ] ; f i l l 4 = [ ] ; 14 f i l l 5 = [ ] ; f i l l 6 = [ ] ; f i l l 7 = [ ] ; 15 t i c 16 T = 0 . 5 ; % Time t o e x p i r 17 j =6; 18 M=10^ j ; % Number o f Monte C a r l o t r i a l s 19 i =10; 20 Q= [ i i ; i i ];

21 Q1=Q d i a g ( d i a g (Q) ) ; 22 J=d i a g ( 1 . / sum (Q1 , 2 ) ) Q1 ;

95

23 %t i c 24 %U = rand ; X = (U <= 1 / 2 ) + 2  (U > 1 / 2 ) ; 25 d e l t a t=m a r k o v e s t a t e (Q, J ,M, T) ; 26 %t o c 27 %  28 %  Monte C a r l o  29 %  30 sigma1 =[ sigma11 sigma12 ] ; 31 r h o 0 =[ rho1 rho2 ] ; 32 s i g m a 1 2 t =(sigma1 . ^ 2 )  d e l t a t ; 33 N1=randn ( 1 ,M) ; 34 mu1=( r T 0 . 5  s i g m a 1 2 t ) ; 35 f i n a l v a l s 1=mu1 + s q r t ( s i g m a 1 2 t ) .  N1 ; 36 p v a l u e s=S1  exp ( f i n a l v a l s 1 ) ; 37 qq=q u a n t i l e ( p v a l u e s , a l p h a ) 38 t i c 1=t o c 39 apprx=A n a l y t i c A p p r x ( sigma1 , r , S1 , T, Q, J , h , k , z a l p h a ) ; 40 %n b i n s = 5 0 ; 41 %h i s t ( p v a l u e s , n b i n s )

Analytic solution
1 function 2 3 4 5 t s t a r=d s o l v e m a t l a b (Q, J ) ; t 1 s t a r=d o u b l e ( s u b s ( t s t a r ( 1 ) ,T) ) ; v a l u e=s p r e a d d e r i v e ( sigma1 0 , r , . . .

S1 0 , T, Q, J , h , k , z a l p h a )

96

6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31

M1=d o u b l e ( s u b s ( t s t a r ( 3 ) ,T) ) ; v a r t 1 =(M1 t 1 s t a r ^ 2 ) ;

R s t a r=R v a l u e ( sigma1 0 , S1 0 , T , . . . t 1 s t a r , z a l p h a , r ) ;% v s t a r t1 star R star v=d e r i v a t i v e p i ( sigma1 0 , S1 0 , T , . . . t1 star , z alpha , r , R star ) ; %P i 0=normcdf ( v ) ;

syms x c l e a r f =1/( s q r t ( 2  p i ) )  i n t ( exp ( ( 1 / 2 )  ( x ^ 2 ) ) , . . . i n f , x ) ;% c d f f i r s t f =d i f f ( f , x ) ; s e c o n d f= d i f f ( d i f f ( f , x ) ) ; f i r s t P i =d o u b l e ( s u b s ( f i r s t f , { x } , { v } ) ) s e c o n d P i=d o u b l e ( s u b s ( s e c o n d f , { x } , { v } ) )

syms x c l e a r sigma11=s i g m a 1 0 ( 1 , 1 ) ; sigma12=s i g m a 1 0 ( 1 , 2 ) ; sigma1=s q r t ( ( sigma11 ^2  t 1 s t a r + . . . sigma12 ^ 2  (T t 1 s t a r ) ) /T) ; sigma1T=T sigma1 ^ 2 ; f= ( l o g ( x/ S1 0 ) T r+sigma1T /2 ) . . .

/ s q r t ( sigma1T ) ;

97

32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57

d e r v= d i f f ( f , x ) ; s e c v= d i f f ( d i f f ( f , x ) ) ; d e r i v v=d o u b l e ( s u b s ( d e r v , { x } , . . . { R star }) ) s e c d e r i v v=d o u b l e ( s u b s ( s e c v , { x } , . . . { R star }) )

syms x c l e a r sigma11=s i g m a 1 0 ( 1 , 1 ) ; sigma12=s i g m a 1 0 ( 1 , 2 ) ; sigma1=s q r t ( ( sigma11 ^2  x + . . . sigma12 ^ 2  (T x ) ) /T) ; sigma1T=T sigma1 ^ 2 ; f= ( l o g ( R s t a r / S1 0 ) T r + . . .

sigma1T /2 ) / s q r t ( sigma1T ) ; d e r t= d i f f ( f , x ) ; s e c t= d i f f ( d i f f ( f , x ) ) ; d e r i v t=d o u b l e ( s u b s ( d e r t , { x } , . . . { t 1 s t a r }) ) s e c d e r i v t=d o u b l e ( s u b s ( s e c t , . . . {x } ,{ t 1 s t a r }) )

f i r s t P i v= f i r s t P i  d e r i v v s e c o n d P i t 1=s e c o n d P i  ( d e r i v t ) ^ 2 + . . . sec deriv t first Pi s e c o n d P i v=s e c o n d P i  ( d e r i v v ) ^ 2 + . . .

98

58 59 60 61 62 63 64 65 66 67 68 69 70

sec deriv v  first Pi

syms t 2 v2 v1 R1 v a r t c l e a r pp=s o l v e ( ' 0 . 5  t 2  v a r t +0.5  v2  ( v R1) ^2+v1  ( v R1) ==0 ' , 'v ' ) ; pp ( 1 ) pp ( 2 ) p21=d o u b l e ( s u b s ( pp ( 1 ) , [ t2 , v2 , v1 , R1 , v a r t ] , . . . [ second Pi t1 , second Pi v , . . . f i r s t P i v , R star , var t1 ] ) ) ; p22=d o u b l e ( s u b s ( pp ( 2 ) , [ t2 , v2 , v1 , R1 , v a r t ] , . . . [ second Pi t1 , second Pi v , . . . f i r s t P i v , R star , var t1 ] ) ) ; v a l u e =[ R s t a r , p21 , p22 , v a r t 1 ] ;

Expected value for Value at Risk
1 function 2 3 4 5 6 7 8 9 10 v a l u e=v v a l u e ( sigma1 0 , S1 0 , . . .

T, t1 , z a l p h a , r ) ; %(sigma1 0 , S1 0 , T, t 1 s t a r , z a l p h a , r ) ; sigma11=s i g m a 1 0 ( 1 , 1 ) ; sigma12=s i g m a 1 0 ( 1 , 2 ) ; sigma1=s q r t ( ( sigma11 ^2  t 1 + . . . sigma12 ^ 2  (T t 1 ) ) /T) ; sigma1T=T sigma1 ^ 2 ; v a l u e=S1 0  exp ( z a l p h a  . . . s q r t ( sigma1T ) + T r sigma1T /2 ) ;

f function 99

1 function 2 3 4 5 6 7 8 9 10 11

v a l u e=f ( sigma1 0 , S1 0 , T, t1 , r , R s t a r ) %(sigma1 0 , sigma2 0 , S2 , S1 , T, t1 , r , w) ;

%f u n c t i o n f=p ( z<v a l u e ) %(sigma1 0 , r , S1 , K, T, t 1 s t a r h , z a l p h a , w, S2 ) sigma11=s i g m a 1 0 ( 1 , 1 ) ; sigma12 = . . . sigma1 0 ( 1 , 2 ) ; sigma1=s q r t ( ( sigma11 ^2  t 1+sigma12 ^ 2  . . . (T t 1 ) ) /T) ; sigma1T=T sigma1 ^ 2 ; v a l u e= ( l o g ( R s t a r / S1 0 ) T . . .

r+sigma1T /2 ) / s q r t ( sigma1T ) ;

100

REFERENCES

[1] Tim Bollerslev. Generalized autoregressive conditional heteroskedasticity. Journal of Econometrics, pages 307­327, 1987. [2] Hamilton, James D. Rational-expectations econometric analysis of changes in regime: An investigation of the term structure of interest rates. Journal of Economic Dynamics and Control 12, pages 385­423, 1988. [3] Minqlang Li, Shijie Deng and Jieyun Zhou. Closed-form approximations for spread option prices and greeks. Journal of derivatives, pages 72­88, 2012. [4] Schwartz E. The valuation of warrants: implementing a new approach. Journal Financial Economics, pages 79­93, 1977. [5] Alexander ing two Alvarez , Marcos Escobar and under Pablo Olivares. Priccorrelation.

dimensional

derivatives

stochastic

DOI:10.1504/JFMD.2011.045598,RAMLab,Ryerson university department of mathematics, 2010. [6] J. Michael, Pliska, Stanley R. Harrison. Martingales and stochastic integrals in the theory of continuous trading. Stochastic Processes and their Applications, pages 215­ 260, 1981. [7] Duran J.C. The garch option pricing model. Mathematical finance, pages 13­32, 1995.

101

[8] Steve Kummer and Christian Pauletto. The history of derivatives:A few Milestone. PhD thesis, EFTA Seminar on Regulation of Derivatives Markets. Zurich, 2012. [9] Bachelier, L. Th´ eorie de la sp´ eculation www://eudml.org/doc/81146. Annales scien´ tifiques de l'Ecole Normale Sup´ erieure 17, 1900. [10] Mike K. P. So, K. Lam and W. K. Li. A stochastic volatility model with markov switching. Journal of Business and Economic Statistics, pages 244­253, 1998. [11] Apostol,Tom M. Wesley, 1974. [12] Bernt Oksendal. Stochastic Differential Equations: An Introduction with Applications Paperback. Springer, 2010. [13] Romuald Herve Momeya Ouabo. Les Processus additifs markoviens et leurs applications en finance mathematique. PhD thesis, Universite de Montreal, 2012. [14] Philip E. Protter. Stochastic Integration and Differential Equations Hardcover. Mathematical Analysis.Reading, MA:Addison-Wesley. Addison-

Springer,Stochastic Modelling and Applied Probability, 2003. [15] Roll R. An analytic formula for unprotected american call options on stocks with known dividends. Financial Economics, 1994. [16] Campbell S., and Canline Li. Option Pricing in Regime-Switching Environments. PhD thesis, University of California, Department of computer Science, 2002. Seminar.

102

[17] Karlin S. and Taylor H. A first course in Stochastic Processes. Academic Press, 1975. Second ed. [18] Fischer Black,Myron Scholes. The pricing of options and corporate liabilities. The journal of political economy, pages 637­654, 1973. [19] Turner Christopher M., Richard Startz, and Charles R. Nelson. A markov model of heteroscedasticity: Risk and learning in the stock market. Journal of Financial Economics. Vol. 25, pages 3­22, 1989. [20] Kijima M, Yoshida T. A simple option pricing model with markovian volatilities. Journal of the Operations Research Society of Japan, pages 149­166, 1993. [21] Nicolas P.B. Bollen,Stephan F. Gray, Robert E. Whaley. Regime switching in foreign exchange rates: Evidence from currency option prices. Journal of Econometrics, pages 239­276, 1994.

103

