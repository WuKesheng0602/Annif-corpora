Ryerson University

Digital Commons @ Ryerson
Theses and dissertations

1-1-2011

Signal processing techniques for operator independent Doppler ultrasound : potential for use in transcranial Doppler ultrasound
Benjamin Lee
Ryerson University

Follow this and additional works at: http://digitalcommons.ryerson.ca/dissertations Part of the Atomic, Molecular and Optical Physics Commons Recommended Citation
Lee, Benjamin, "Signal processing techniques for operator independent Doppler ultrasound : potential for use in transcranial Doppler ultrasound" (2011). Theses and dissertations. Paper 1045.

This Thesis is brought to you for free and open access by Digital Commons @ Ryerson. It has been accepted for inclusion in Theses and dissertations by an authorized administrator of Digital Commons @ Ryerson. For more information, please contact bcameron@ryerson.ca.

SIGNAL PROCESSING TECHNIQUES FOR OPERATOR
INDEPENDENT DOPPLER ULTRASOUND

- POTENTIAL FOR USE IN TRANSCRANIAL DOPPLER ULTRASOUND
by Benjamin Lee B.Eng. Electrical Engineering, Ryerson University, 2008 A thesis presented to Ryerson University in partial fulfillment of the requirements for the degree of Master of Science in the Program of Biomedical Physics Toronto, Ontario, Canada, 2011 Â© Benjamin Lee 2011

I hereby declare that I am the sole author of this thesis.

I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research.

I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

ii
  

     

SIGNAL PROCESSING TECHNIQUES FOR OPERATOR INDEPENDENT DOPPLER ULTRASOUND POTENTIAL FOR USE IN TRANSCRANIAL DOPPLER ULTRASOUND Master of Science 2011 Benjamin Lee Biomedical Physics Ryerson University

2D Doppler ultrasound can be used for continuous monitoring of vasospasm. However, the use of Doppler ultrasound suffers from operator dependence requiring a skilled ultrasonographer to make Doppler angle corrections. The aim of the research is to minimize the need of dedicated ultrasonographers for Doppler ultrasound monitoring of cerebral vasospasms. In this thesis, three studies including a steady flow phantom, pulsatile flow phantom and in vivo human internal carotid artery (ICA) were completed with the use of 3D Doppler ultrasound. The 3D vascular structure of the phantom and ICA were obtained using binary skeletonization from 3D power Doppler images. The vascular structure was used in combination with angle independent pulsed-wave Doppler to reconstruct the temporal blood velocity profiles at various parts of the vasculature. The results indicate that Doppler angle corrections can be minimized with the use of 3D Doppler ultrasound, and operator independent monitoring of blood flow is possible.
  

iii
  

     

Acknowledgements
I would like to thank my supervisors, Dr. Victor Yang and Dr. Joseph Carl Kumaradas for accepting me as their graduate student. Throughout the two years of studies, they have provided me with a lot of support and guidance. Not only have I gained the invaluable experience in research, but it also allows me to be better person under their supervision. Working with them as a graduate student provided me with an extremely fruitful and gratifying experience. In addition, I would like to thank my supervisory committee members Dr. Michael C. Kolios and Dr. Jahan Tavakkoli for providing their labs and giving me constructive advice on my thesis. Moreover, I would like to thank all the lab members in the group especially Dr. Beau Standish and Ms. Jenny Yeow, who have provided support in lab management and logistics. Furthermore, I would like to thank Mr. Arthur Worthington for his technical support of the operation of lab equipment. Special thanks must also be given to Dr. Alfred Yu, Mr. Billy Y. S. Yiu and Mr. Donald L. S. Chan from the University of Hong Kong. They have provided me with the lab equipment and the support for the flow phantom design during my visit to their lab. In the University of Hong Kong. Last but not least, I would like to thank my friends and fellow graduate students from the Department of Physics, Ryerson University, for sharing my joy and happiness during my two years of journey.

iv
  

     

Dedication
Dedicated to my family

v
  

     

Contents
Chapter 1 Introduction ........................................................................................................ 1 1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 2.1 2.1.1 2.1.2 2.1.3 2.1.4 2.1.5 2.2 2.2.1 2.2.2 Chapter 3 3.1 3.2 3.3 3.4 Cerebral Aneurysms ......................................................................................... 1 Cerebral Vasospasms ........................................................................................ 4 Detection of Vasospasms.................................................................................. 5 Treatment of cerebral vasospasm ..................................................................... 7 Doppler Ultrasound Based Monitoring ............................................................ 7 2D Image vs. 3D Image .................................................................................... 8 Hypothesis ...................................................................................................... 11 Purpose of this Research................................................................................. 11 Benefits of this Research ................................................................................ 11 Doppler Ultrasound ........................................................................................ 13 Non-Directional Demodulation of Doppler Signals ................................... 16 Directional Demodulation of Doppler Signals ........................................... 17 Pulsed Doppler and its Limitations ............................................................. 18 Pulsed-Wave Doppler Mode ....................................................................... 20 Power Doppler Mode .................................................................................. 21 Basics of Fluid Mechanics in Blood Flow...................................................... 22 Volumetric Discharge Rate ......................................................................... 22 Reynolds Number ....................................................................................... 22 Materials and Methods ................................................................................ 25 3D Image Acquisition..................................................................................... 25 Centerline Extraction ...................................................................................... 28 Doppler Angle Calculation ............................................................................. 30 Velocity Calculation ....................................................................................... 32

Chapter 2 Theory .............................................................................................................. 13

vi
  

     

3.5 3.6 3.7 3.8 4.1 4.1.1 4.1.2 4.2 5.1 5.2

Phantom Design.............................................................................................. 33 In-Vivo Study ................................................................................................. 36 Further Processing .......................................................................................... 37 Calculation of Uncertainty.............................................................................. 37 Flow Phantom ................................................................................................. 40 Steady Flow ............................................................................................... 40 Pulsatile Flow ............................................................................................. 50 In-Vivo Data ................................................................................................... 57 Discussion....................................................................................................... 62 Conclusion ...................................................................................................... 65

Chapter 4 Results .............................................................................................................. 40

Chapter 5 Discussion and Conclusion .............................................................................. 62

Chapter 6 Future Work ..................................................................................................... 66 References ......................................................................................................................... 68

vii
  

     

List of Tables
Table 3-1: Amount of different materials used for the flow phantom .............................. 33 Table 3-2: Comparison of the physical properties between actual blood, IEC specification and the proposed blood mimicking fluid .......................................................................... 34 Table 4-1: Time average velocities with uncertainties obtained from the four locations illustrated in Figure 4-5 using different methods. ............................................................. 46 Table 4-2: Time average velocities with uncertainties obtained from the four locations illustrated in Figure 4-7 using different methods. ............................................................. 49 Table 4-3: Time average velocities with uncertainties obtained from the four locations illustrated in Figure 4-9 using different methods. ............................................................. 53 Table 4-4: Time average velocities with uncertainties obtained from the four locations illustrated in Figure 4-11 using different methods. ........................................................... 56

viii
  

     

List of Figures
Figure 1-1: Cerebral aneurysms at the branching points of blood vessels. ........................ 2 Figure 1-2: The two types of cerebral aneurysms. .............................................................. 2 Figure 1-3: Subarachnoid hemorrhage................................................................................ 3 Figure 1-4: Aneurysmal clipping. ....................................................................................... 3 Figure 1-5: Major arteries in the brain. ............................................................................... 6 Figure 1-6: A diagram labeling the different regions of a human skull.............................. 6 Figure 1-7: Transcranial colour Doppler scan showing discrete blood vessels. ................. 9 Figure 2-1: Doppler Ultrasound Parameters. .................................................................... 16 Figure 2-2: A pulsed-wave Doppler image. ...................................................................... 20 Figure 2-3: The velocity profile of a laminar flow and turbulent flow. ............................ 24 Figure 3-1: Flow chart of the algorithm. ........................................................................... 25 Figure 3-2: A 2D image obtained directly from the 3D probe. ........................................ 26 Figure 3-3: Principle of the 4DC7-3/40 probe. ................................................................. 27 Figure 3-4: Interpolation of Doppler images into a rectangular mesh. ............................. 27 Figure 3-5: Steps of binary skeletonization. ..................................................................... 29 Figure 3-6: Comparison of a line before and after laplacian smoothing. ......................... 30 Figure 3-7: An example showing two different points `a' and `b' of a blood vessel, the Doppler angles are not the same. ...................................................................................... 30 Figure 3-8: Illustration of the Doppler angle calculation.................................................. 31 Figure 3-9: Flow phantom design for steady flow and pulsatile flow. ............................. 35 Figure 3-10: The two positions that the ultrasound probe was placed when acquiring Doppler data of the phantom............................................................................................. 35 Figure 3-11: Schematic diagram showing the structure of the flow phantom with the two probe positions indicated. ................................................................................................. 36 Figure 3-12: The position of the ultrasound probe when imaging the internal carotid artery. ................................................................................................................................ 37 Figure 4-1: 2D Power Doppler images of the flow phantom with steady flow inside the tube.................................................................................................................................... 41 Figure 4-2: The 3D image of the reconstructed tube shown in MATLAB. ...................... 42 Figure 4-3: 3D images of the reconstructed tube geometry, extracted centerline and smoothened centerline shown in Gorgan (steady flow and probe location 1). ................. 43 Figure 4-4: Tube centerline projected onto the xy, yz and xz-plane (steady flow and probe location 1). ........................................................................................................................ 43

ix
  

     

Figure 4-5: The calculated Doppler angles along the centerline (steady flow and probe location 1). ........................................................................................................................ 44 Figure 4-6: Velocity-time graphs at different locations of the centerline as described by Figure 4-5 (steady flow and probe location 1). ................................................................. 46 Figure 4-7: The centerline projected onto the xy-plane, and the calculated Doppler angles along the centerline (steady flow and probe location 2). .................................................. 47 Figure 4-8: Velocity-time graphs at different locations of the centerline as described by Figure 4-7 (steady flow and probe location 2). ................................................................. 49 Figure 4-9: The centerline projected onto the xy-plane, and the calculated Doppler angles along the centerline (pulsatile flow and probe location 1). ............................................... 51 Figure 4-10: Velocity-time graphs at different locations of the centerline as described by Figure 4-9 (pulsatile flow and probe location 1). ............................................................. 52 Figure 4-11: The centerline projected onto the xy-plane, and the calculated Doppler angles along the centerline (pulsatile flow and probe location 2). ................................... 54 Figure 4-12: Velocity-time graphs at different locations of the centerline as described by Figure 4-11 (pulsatile flow and probe location 2). ........................................................... 56 Figure 4-13: The reconstruction of the ICA geometry. .................................................... 57 Figure 4-14: The extracted centerline from the ICA geometry. ....................................... 58 Figure 4-15: The ICA of a human volunteer. ................................................................... 59 Figure 4-16: Graph showing the uncorrected and corrected velocity-time graph of the ICA blood flow of the human volunteer, obtained using automatic angle calculation..... 60 Figure 4-17: Velocity-time graph of the ICA blood flow of the human volunteer, obtained using manual angle determination and automatic angle calculation. 61

x
  

     

Symbols
f

Frequency [Hz]. Doppler frequency [Hz]. Wavelength of sound [m]. Speed of sound [m/s]. Time [s]. Bandwidth [Hz]. Angular frequency [rad/s]. Volumetric discharge [m3/s]. Cross-sectional area of vessels [m2]. Diameter of vessels [m]. Reynolds number [1]. Dynamic viscosity of fluids [PaÂ·s]. Density of fluids [kg/m3].

c t B

fd 


Q A D Re

Âµ 

Abbreviations
SAH DSA CTA MRA ICA MCA TCD ACA PCA ACoA PRF PRP IEC Subarachnoid hemorrhage. Digital subtraction angiography. Computed tomographic angiography. Magnetic resonance angiography. Internal carotid artery. Middle cerebral artery. Transcranial Doppler ultrasound Anterior cerebral artery. Posterior cerebral artery. Anterior communicating artery. Pulse repetition frequency. Pulse repetition period. International Electrotechnical Commission.

xi
  

        

Chapter 1
  

Introduction

1.1 Cerebral Aneurysms
Stroke is currently one of the leading cause of death in the United States (Macdonald, 2008). In 2007, 135,952 cases of stroke were reported, which accounts for 5.6% of the total deaths in the country (Xu, 2010). It is a condition when there is rapid loss of brain functions due to decrease in oxygen supply. It is usually caused by blocked or burst blood vessels. Among all the stroke cases, 15% are related to the rupture of intracranial aneurysms, which occurs in approximately 15 out of 100000 people per year (Macdonald, 2008). Aneurysm refers to a condition when there is a balloon-like bulge in a blood vessel. It is caused by weakening of the wall of the blood vessels, i.e. collagen deficiency; or ongoing vascular injury, caused by mechanical damage due to hypertension or hemodynamic (Awad, 1993). Blood flowing passed the weakened wall will create a pressure that pushes the wall outwards, resulting in the balloon-like bulge. It usually occurs at the branching points of blood vessels as shown in Figure 1-1. Some risk factors for the weakening include female gender, age, cigarette smoking (Bonita, 1986; Sacco RL, 1984), use of oral contraceptives (Lindegard, 1987; Petitti, 1978), alcohol intoxication (Monte, 1985) and genetics (Awad, 1993).

1
  

  

CHAPTER 1. INTRODUCTION

Figure 1-1: Cerebral aneurysms at the branching points of blood vessels. The inset image shows the close up of the aneurysm (Darling, 2011).

Aneurysms can remain stable indefinitely with no treatment (Awad, 1993). However, the blood pressure on the vessel wall over a prolonged period will cause the aneurysm to grow, resulting in an increasing risk of rupture. Brain aneurysms generally take two different shapes as illustrated in Figure 1-2 (Lufkin, 2001). The first type is a `saccular brain aneurysm' that forms on one side of the blood vessel. The second type is a `fusiform brain aneurysm' that is an outward bulge expanding in all directions of the blood vessel.

Figure 1-2: The two types of cerebral aneurysms (Darling, 2011).

The rupturing of cerebral aneurysms can lead to subarachnoid hemorrhage (SAH) (Figure 1-3) (Awad, 1993). It is a life threatening event with few patients fully recover. According to Macdonald, 15 to 20% of patients die before reaching the hospital (Macdonald, 2008). Moreover, the overall mortality or morbidity rate of SAH is 2
  

  

CHAPTER 1. INTRODUCTION
approximately 50% (Awad, 1993). Patients who arrive at the hospital after SAH will receive aneurysmal clipping (Figure 1-4) to stop the bleeding in the artery (Awad, 1993).

Figure 1-3: Subarachnoid hemorrhage (Barrow Neurological Institute, 1993).

Figure 1-4: Aneurysmal clipping (Stroke Center, 2007-2010).

        

3
  

  

CHAPTER 1. INTRODUCTION

1.2 Cerebral Vasospasms
For those patients who survive the SAH, cerebral vasospasm is a complication that can occur afterwards. Vasospasm refers to a condition when blood vessels spasm, leading to vasoconstriction. It is likely to occur when any subarachnoid artery is covered with a sufficient amount of blood for a long enough period of time (Macdonald, 2006). Cerebral vasospasms occur to the intracranial arteries. This will restrict and limit the blood flow in order to reduce further bleeding; however, at the same time, the amount of blood flow to the brain will also decrease, which will limit the supply of oxygen to the brain. Inadequate oxygen supply to the brain may cause permanent brain damage. The onset of cerebral vasospasm is usually on day 3 after SAH, peaks on day 7 and continues until day 14 (Macdonald, 2008; Kassell, 1985). Cerebral vasospasm after SAH is one of the most common causes of cerebral ischemia and remains a leading cause of mortality and morbidity after SAH. According to Dorsch et. al., almost all patients who suffer from SAH will develop cerebral vasospasm (Dorsch, 1994). Moreover, some of the patients may develop symptomatic vasospasm, which is a more severe form of vasospasm that will cause ischemic problems. As reported in a study, the number of cases of symptomatic vasospasm from 297 references is 10445 cases among 32188 patients, which is 32.45% (Dorsch, 1994). In addition, approximately 17% of patients will die or suffer from permanent morbidity (Macdonald, 2006). However, even with the high mortality and morbidity rate, cerebral vasospasm is also the most preventable complication after SAH (Macdonald, 2008). As long as cerebral vasospasm is diagnosed early, ischemia can be prevented. As a result, continuous monitoring of the blood vessels in the brain starting from day 3 until day 14 after SAH is imperative to determine whether vasospasm has occurred.

4
  

  

CHAPTER 1. INTRODUCTION

1.3 Detection of Vasospasms
When vasospasms occur, the affected blood vessels constrict. By using digital subtraction angiography (DSA), computed tomographic angiography (CTA), or magnetic resonance angiography (MRA), the diameter of the blood vessels can be measured. As reported by Wintermark et. al., the accuracy, sensitivity and specificity of DSA for diagnosing vasospasm are all 100%. It is considered as the `gold standard' for imaging blood vessels (Wintermark, 2006). For CTA, the accuracy, sensitivity and specificity was 91.4%, 75.6% and 95.3% respectively (Wintermark, 2006). And finally for MRA, the accuracy, sensitivity and specificity was 96%, 92% and 98% (Grandin, 2000). Despite their high accuracies, the main disadvantage of all these three methods is that they require transportation of patients to the scanner, thus unsuitable for continuous monitoring of patients. One other characteristic of vasospasm is that the blood flow velocity inside the affected blood vessel increases. The internal carotid artery (ICA) and the middle cerebral artery (MCA) are commonly used when determining the signs of vasospasm. Figure 1-5 shows the location of these two arteries in the skull. The internal carotid arteries extend along the neck, whereas the middle cerebral arteries are located inside the temporal bone of the skull (Figure 1-6). There are two criteria that are commonly used to determine the occurrence of vasospasm. The first criterion is to use the Lindegaard Ratio, which states that when the ratio between the time average velocities at the centerline of the MCA and ICA is greater than 3.9, it could indicate the presence of vasospasm (Lindegaard, 1989). The second criterion is that when the peak velocity at the centerline of the MCA at systole is greater than 150 cm/s, the patient could be suffering from vasospasm (Krejza, 2005). Transcranial Doppler Ultrasound (TCD) can be used as one of the techniques to measure the velocity of blood flow. It has a sensitivity of 86% and a specificity of 98% to detect MCA vasospasm (Lennihan, 1993). Compared to DSA, CTA and MRA, TCD is relatively cheap and does not involve the use of ultrasound contrast agent. It can be performed on the bedside and repeated as needed (Sloan, 2004). Also, it can provide real time images. This makes it a good choice to be used for monitoring. 5
  

  

CHAPTER 1. INTRODUCTION

Figure 1-5: Major arteries in the brain (Thomas Jefferson University Hospital, 2011).  

Figure 1-6: A diagram labeling the different regions of a human skull (Norman, 1999).

6
  

  

CHAPTER 1. INTRODUCTION

1.4 Treatment of cerebral vasospasm
Accurate diagnosis of vasospasm is crucial because of the need for immediate treatment. Treatment for vasospasm involves the `triple H' therapy, i.e., hypervolaemia (an increase in the volume of circulating plasma), induced arterial hypertension, and haemodilution, with an aim to reverse brain ischemia. However, there are also side effects for this treatment. Excess fluid can affect gas exchange, which in turn, decreases oxygen supply. Therefore, it is also important to continuously monitor patients during this treatment so that patients are overloaded with fluid that is sufficient to overcome the vasospasms (Awad, 1987; Sen, 2003; Lee, 2006).

1.5 Doppler Ultrasound Based Monitoring
TCD was introduced in 1982 by Aaslid and colleagues as a non-invasive technique for monitoring blood flow velocity in the cerebral arteries (Aaslid, 1982). The typical ultrasound frequency range used in clinical TCD systems is usually from 2MHz to 2.5MHz (Ivancevich, 2004; Perren, 2004). Imaging of blood flow and vessel structure is one of the most important applications of ultrasound (Perren, 2004; Sloan, 2004). Some areas of application include the detection of cerebral vasospasm following subarachnoid hemorrhage (Aaslid, 1982; Aaslid, 1984; Aaslid, 1986). Due to the advancement in technology, 3D ultrasound applications have become more popularized and continue to expand. Nowadays, applications are commonly used in cardiology, obstetrics, gynecology, cardiology, dermatology, opthamology and vascular imaging (Nelson, 1998). 3D ultrasound images can be obtained by acquiring slices of 2D ultrasound images (Klotzsch, 2006; Postert, 1997). The 3D image can then be created by placing each pixel of the acquired 2D images at the proper location of the 3D image, resulting in data in an array of voxels (Nelson, 1998).

7
  

  

CHAPTER 1. INTRODUCTION

1.6 2D Image vs. 3D Image
Traditional 2D Doppler Ultrasound has widely been used to provide Doppler images and velocity measurements in the blood vessels. It has been reported by Hoskins that it can be used for the diagnosis of diseases like arterial stenosis which is related to the change in blood flow velocity (Hoskins, 2010). It has also been reported by Lennihan et al. that TCD can be used to detect vasospasm (Lennihan, 1993). One major problem for 2D Doppler ultrasound is that it only provides information in 2D, eliminating the information in the third dimension (Lennihan, 1993). As a result, when using 2D Doppler ultrasound to image the blood vessels, the `third dimension component' of the velocity vector outside of the 2D image will be lost. In order to measure the velocity accurately using 2D, the ultrasonographer needs to first align the transducer with the blood vessel, so that blood flows entirely in the plane that contains the 2D image, eliminating the velocity vector of blood flow in the `third dimension' not contained by the 2D plane. In addition, the measurements of the Doppler angle between the blood vessel and the ultrasound beam is required. This is one reason why there is operator dependency for using traditional 2D Doppler ultrasound. 3D Doppler ultrasound can provide a more complete picture of the blood vessel, and can provide information in the `third dimension' that is not shown in 2D images. However, a 3D image alone will not completely eliminate operator dependency. Since a 3D image provides an image in all three dimensions, the transducer does not need to be aligned with the blood vessel, but will still require the manual measurement of the Doppler angle. In light of that, we are proposing a solution that allows the automatic measurement of the Doppler angle and the determination of the blood flow velocity with minimal operator dependency in 3D. For the past decade or two, there have been studies on using 3D ultrasound for both imaging of the brain structure and flow detection. In 2004, Ivancevich et. al. performed 3D B-mode scans on a 56 year old, 100 kg male through the temporal window. The 3D ultrasound scan was able to identify structures such as the mid cerebral 8
  

  

CHAPTER 1. INTRODUCTION
fissure, the atria of the lateral ventricles, the contralateral skull bone, and the corpus callosum (Ivancevich, 2004). The scan was able to penetrate to at least a depth of 14 cm. B-mode and colour Doppler were also used on a sheep with the aid of contrast agents (10 mL of 400 mg/mL, levovist, Shering AG) injected into the internal carotid artery, and ultrasound scanning was performed through the left temple with the transducer array pointing toward the circle of Willis. In the 3D scan of the coronal section of the sheep skull, the anterior portions of the lateral ventricles, and the upper and lower mid cerebral fissures were identified using B-mode imaging (Ivancevich, 2004). In addition, colour Doppler was able to indicate blood flow on the right side of the brain in opposite directions through two discrete vessels at 9 cm and 10 cm from the transducer as shown in Figure 1-7 below.

Figure 1-7: Transcranial colour Doppler scan showing discrete blood vessels (Ivancevich, 2004)

It has been shown by Klotzsch et. al. in 2006 that the MCA aneurysms can be detected by the use of Colour Doppler (Klotzsch C, 1999); the blood flow inside the MCA allows its location to be detected. He also suggested that power Doppler is a good choice for 3D reconstruction due to its high sensitivity to low flow near the vessel wall. By using 3D colour Doppler, Klotzsch et. al. was able to detect 29 out of 30 intracranial aneurysms that were already found by using DSA (Klotzsch C, 1999).

9
  

  

CHAPTER 1. INTRODUCTION
Another study done by Perren et. al. used a 2MHz phased array transducer and 3D reconstruction software (Perren, 2004). Her studies showed the power Doppler images of the anterior cerebral artery (ACA), MCA and posterior cerebral artery (PCA) acquired through the temporal bone region. In addition, seven patients with severe subarachnoid hemorrhage were imaged with 3D power Doppler through the temporal bone region, five of them were diagnosed with anterior communicating artery (ACoA) aneurysms and the other two were diagnosed with MCA aneurysms. All of these cases were confirmed with the images using DSA. In order to image the blood vessels inside the skull, ultrasound transducers can be placed on the temporal bone where it is thinner than other areas of the skull. However, even though the temporal bone region is thinner, it does not mean that it is always thin enough for ultrasound imaging. According to Postert et. al. in 1997, the average percentage of patients with inadequate temporal bone window for transcranial ultrasound imaging varies between 6% and 20%. Out of the 172 patients in his study, 21 had insufficient temporal window, which shows that most people have adequate temporal bone window for TCD (Postert, 1997). Even though Doppler ultrasound is non-invasive, can provide real time images, and is a better method than DSA, CTA and MRA to be used for continuous monitoring, problems still exist. The use of Doppler ultrasound is operator dependent and requires a skilled ultrasonographer who has received special training and experience to make Doppler angle adjustments (Sloan, 2004). Therefore, the use of Doppler ultrasound as a tool for continuous monitoring implies that the ultrasonographer will be required on a continuous basis to hold the probe on the patients head, make adjustments and to interpret the data, which is not practical for continuous monitoring.

10
  

  

CHAPTER 1. INTRODUCTION

1.7 Hypothesis
3D Doppler ultrasound can image cerebral vasculature and provide diagnostic information similar to traditional Doppler ultrasound for detecting vasospasm in the setting of SAH, with DECREASED operator dependency.

1.8 Purpose of this Research
There is currently no off-the-shelf technology that allows the continuous monitoring of vasospasm. It would be beneficial if Doppler ultrasound can be used continuously with minimal need of an operator. Therefore, the aim of this thesis is to investigate the improvements to the current Doppler ultrasound technology, in order to minimize the continuous need of a trained ultrasonographer. The long-term goal for this research is to develop a Doppler ultrasound technology for the automatic detection of the Doppler angle. This new technology can be used to detect vasospasm after SAH with decreased operator dependency, which will allow the continuous monitoring of vasospasm with minimal operator dependency, providing the early diagnosis of the disease. This decreases the chance of ischemia, and in turn, decreases the mortality and morbidity rate of cerebral vasospasm. The new technology can also be applied to other areas where the continuous measurement of blood flow velocity is required.

1.9 Benefits of this Research
This project will improve the current TCD technology to aid in the diagnosis of cerebral vasospasm with decreased operator dependency. This project, if implemented successfully, will result in a technique to use TCD to perform continuous monitoring of vasospasm with minimal need of an ultrasonographer. Given that patients after SAH require continuous monitoring from day 3 to day 14 after SAH, the elimination of the 11
  

  

CHAPTER 1. INTRODUCTION
need for an operator will result in substantial financial savings for hospitals. Moreover, the ultrasonographers will be free to do other clinical work. The new TCD will allow the more efficient usage of human resources.

12
  

        

Chapter 2
  

Theory

2.1 Doppler Ultrasound
The Doppler effect describes a phenomenon that there will be a change in the frequency of a wave perceived by the observer when the source, observer or both are moving relative to the sound wave. This change of frequency is denoted as the Doppler frequency f d (Shung, 2006). The perceived frequency changes when the source and/or the observer move. The reason for the perceived frequency to change is described as follows. Given that a stationary sound point source is continuously emitting sound waves in all directions radially away from the source with a frequency f and the speed of sound c , the wavelength of the sound waves will be  , which is related by the equation c = f . If both the source and observer are not moving, the observer will perceive a frequency that is the same as the emitting sound frequency from the source. Consider that the observer is moving towards the sound source while the sound source is stationary, the speed of sound relative to the velocity of the observer, vo will be

c + vo . Since the wavelength of the sound wave is unchanged, the perceived frequency
f ' will be

f '=

v'



=

c + vo



=

c + vo f. c

On the other hand, if the observer is moving away from the sound source, the perceived frequency f ' will be 13
  

  

CHAPTER 2. THEORY
f '= c - vo f c

Now, consider that the sound source is moving at a velocity v s towards the observer while the observer is stationary, the moving source will change the distance between the crests and troughs of the wave, thus changing the wavelength. The magnitude of the change of wavelength  depends on the speed of the moving source, which is  =

vs . Therefore, the observed wavelength will be f

 ' =  -  =
Therefore, the perceived frequency f ' will be

c vs - . f f

f '=

c

'

=

c c c = = f  -  c v s c - v s - f f

On the other hand, if the sound source is moving away from the observer, the perceived frequency f ' will be

f '=

c f. c + vs

As a result, by combining the two equations, the general relationship between the emitted frequency and the perceived frequency when both the observer speed and emitter speed are taken into account is given by

f '=

c Â± vo f (Jewett, 2004). c  vs

(2-1)

Doppler flow measurements have widely been used to determine blood flow velocities in clinical settings. Ultrasound waves are emitted into the blood vessels by the emitting transducer. The back scattering of the red blood cells can be detected by the 14
  

  

CHAPTER 2. THEORY
receiving transducer (Shung, 2006). However, for the Doppler flow measurements in the clinical settings, it utilizes the Doppler effect twice. Since the ultrasound probe remains stationary during imaging, its velocity is 0; on the other hand, the velocity of the red blood cells is denoted as v . When the ultrasound waves are emitted from the emitting transducer to the underlying red blood cells, the transducer is considered to be the source, and the red blood cells are considered to be the observer. As a result, by using equation 2-1, the perceived frequency at the observer, i.e., red blood cells f a ' will be

fa '=

c+v f. c

At the moment when the ultrasound waves hit the red blood cells, the whole situation is reversed. Now, the red blood cells are backscattering the incident ultrasound waves, and are considered to be the source, and the transducer is considered to be the observer. As a result, by using equation 2-1 again, the perceived frequency f ' at the receiving transducer will be

f '=

c c c+v c+v fa '= f = f. c-v c-v c c-v

The Doppler frequency f d is equal to the difference between the perceived and emitted frequency, the Doppler frequency will be

f d = f '- f =

c+v 2v  c + v   c + v c - v  f - f =  - 1 f =  - f.  f = c-v c-v  c - v   c - v c - v 

As the speed of sound inside the human tissue and blood is approximately

1540m / s (Shung, 2006; Hoskins, 2008), and the speed of the red blood cell movement
in human body is in the order of a few m/s, as a result, c >> v . Therefore, the above equation can further be approximated to

fd =

2v f. c

15
  

  

CHAPTER 2. THEORY
The angle  the ultrasound beam makes with the direction of the red blood cell velocity is called the Doppler angle (Figure 2-1). The Doppler frequency can then be found by multiplying the above equation by cos . As a result,

fd =

2vf cos . c

(2-2)

Figure 2-1: Doppler Ultrasound Parameters (Deane, 2002).

2.1.1 Non-Directional Demodulation of Doppler Signals
The frequency perceived by the receiving transducer depends on the flow velocity. Given that the initial frequency of the emitted ultrasound is !! , the flow in the tube will tend to shift the frequency of the emitted signal by the Doppler frequency !! , shifting the whole spectrum of the original signal relative to the original frequency !! . As a result, the returned echo has a frequency of !! + !! . Suppose the original transmitted signal is represented by ! cos 2!!! ! , where ! represents the signal amplitude, and !! 16
  

  

CHAPTER 2. THEORY
represents the frequency of the transmitted signal. The returned signal is thus represented by ! cos 2! !! + !! ! , where ! represents the signal amplitude, and !! + !! represents the frequency after the Doppler shift. In order to obtain the Doppler frequency !! , the combined signal needs to be demodulated so that the useful signals can be obtained. This can be done by multiplying the returned signal by the original transmitted signal. Therefore, the demodulated signal is ! cos 2!!! ! ! cos 2! !! + !! ! = !" cos 2! 2!! + !! ! + cos 2!!! ! . As shown in the above equation, the demodulated signal consists of two frequency components, i.e., 2!! + !! and !! . Therefore, to obtain the Doppler frequency !! , a low pass filter can be used to filter out the higher frequency component 2!! + !! .

2.1.2 Directional Demodulation of Doppler Signals
There are a few methods that can be used to determine the direction of flow. The first method is single sideband filtering. Given that the transmitted signal has a frequency !! , a high pass filter can be used to filter out frequencies below !! , and a low pass filter can be used to filter out the frequencies above !! . If the remaining frequency is above !! , it means that the flow is directed towards the direction of the ultrasound beam, vice versa. However, one major drawback of this method is that it is difficult to implement filters with steep cutoff frequencies at !! (Shung, 2006). The second method is the heterodyne demodulation in which an oscillator and a heterodyne oscillator are used to generate signals at frequencies !! and !! respectively. There are two paths for the generated signals. For the first path, the two signals were allowed to mix by multiplying them together. For simplicity, the amplitudes of the two signals are assumed to be 1. As a result, the two signals are cos 2!!! ! and cos 2!!! ! respectively. By multiplying the two signals, the product will be 0.5 cos 2! !! + !! ! + cos 2! !! - !! ! .

17
  

  

CHAPTER 2. THEORY
By using a low pass filter, the output will be cos 2! !! - !! ! . On the other hand, for the second path, the oscillator emits signals to the transducer for imaging. The received signals from the transducer will have a Doppler shift of either !! + !! for forward flow, or !! - !! for backward flow. By multiplying the signals from paths 1 and 2, the product for the forward flow will be 0.5 cos 2! !! + !! ! + cos 2! 2!! - !! + !! ! . By using a low pass filter, the output becomes 0.5 cos 2! !! + !! ! . On the other hand, the product for the backward flow will be 0.5 cos 2! !! - !! ! + cos 2! 2!! - !! + !! ! . By using a low pass filter, the output becomes 0.5 cos 2! !! - !! ! . Once the Doppler frequency is obtained, and the Doppler angle is measured, the velocity can be calculated by using equation 2-2.

2.1.3 Pulsed Doppler and its Limitations
When using Doppler ultrasound for imaging, ultrasound signals backscattered coming from different depths may overlap. In order to solve the problem, pulses instead of continuous ultrasound waves are emitted from the transducer. These pulses are emitted at the PRF, and the time period between successive pulse firings is the pulse repetition period (PRP), which is represented by PRP =

1 . Ultrasound pulses are fired at the PRF

beginning of the PRP from the transducer, and the ultrasound system will then `listen to' or `wait for' the returning signals until the end of the PRP before pulses are fired at the beginning of the next PRP. Therefore, the limit for the highest Doppler frequency, !!"# , 18
  

  

CHAPTER 2. THEORY
that it can measure is determined by the PRF of the device, which must be at least twice as large as the maximal Doppler frequency (Shung, 2006). Therefore,

PRF  2 f max .

(2-3)

By combining equation 2-2 and equation 2-3 when the Doppler angle is at zero degrees, the velocity of flow will be at the maximum. Therefore,

PRF 

4 f t v max c

v max 

PRF  c . 4 ft

Therefore, the maximum velocity of flow that one can measure using Doppler ultrasound is a compromise between the transducer frequency and the PRF (Shung, 2006). In addition to the above limitation to the measured velocities, there are also limitations on the imaging depth. As mentioned above, every time when ultrasound pulses are fired, the pulses travel into the imaging object below the transducer, and the receiving transducer can detect the returning echoes reflected from below. The deeper the depth, the longer it takes for the transmitted beam to reach the imaging depth, and the returning echoes to reach back to the receiving transducer. As a result, for an arbitrary imaging depth !, the total distance for the emitted ultrasound to reach z and the returning echo back to the transducer is 2 z , and thus, the time for such distance is

2z . Pulsed c

Doppler is designed in a way that all the echoes received during a PRP are considered by the ultrasound system to be echoes backscattered from the probe firing at the beginning of that same PRP; any echoes that is received during the next PRP is considered to be echoes backscattered from the successive probe firing at the beginning of the next PRP. For example, if the imaging object is placed at a depth that require the returning echoes to take longer than the duration of PRP to reach the receiver transducer, these returning echoes will be interpreted as echoes from the successive firing that is backscattered at a shallower depth. Therefore, 19
  

  

CHAPTER 2. THEORY
2z 1 = PRP > max PRF c
z max <
As a result, the PRF needs to be at least

c . 2 PRF
and smaller than !!
!

!!! !!"# !

!"#

(Shung, 2006).

2.1.4 Pulsed-Wave Doppler Mode
When imaging in pulsed-wave Doppler mode, ultrasound pulses are fired at the PRF, and back-scattered pulses are received alternately along the same ultrasound beam line. In addition, the back-scattered signal from a selectively small segment along the beam line, known as the `range gate' or `sample volume' is analyzed, so that Doppler shift data can be provided across that region. Once the Doppler shift is obtained, the velocity is obtained by using equation 2-2 above. The velocity-time graph is then plotted on the image. Figure 2-2 shows an image obtained from using the pulsed-wave Doppler mode imaging.

Figure 2-2: A pulsed-wave Doppler image.

20
  

  

CHAPTER 2. THEORY 2.1.5 Power Doppler Mode
One way to display flow information within the Doppler signals is to utilize the `power mode' or `energy mode', which displays the power or energy contained within the Doppler signals. It is a method that was popularized by Jonathan Rubin in 1994 (J M Rubin, 1994) in which autocorrelation analysis of the Doppler beam information is used to produce color flow images. By definition, autocorrelation is the cross correlation of a function with itself. According to the Wiener-Khinchine theorem, the autocorrelation function H ( ) of a function ! ! is the Fourier transform of the power spectrum of that function. If f (t ) represents the signals from the backscattered echoes, the autocorrelation of this backscattered echoes H ( ) is
 

H ( ) =

-



f (t ) f (t -  )dt =

-

 P( )e

j

d

(2-4)

where t represents time,  represents time shift,  represents angular frequency, and

P( ) represents the power spectrum of f (t ), which represents the power at each angular
frequency  of the signal f (t ) (Lathi, 1998). The power of the signal can be calculated by setting  = 0 in equation 2-4 (Shung, 2006). Therefore,
 

-



f 2 (t )d =

-

 P( )d ,

which is the total power contributed by all the spectral components of the power spectrum P( ).

21
  

  

CHAPTER 2. THEORY

2.2 Basics of Fluid Mechanics in Blood Flow
Fluid mechanics refer to the study of the properties of fluids. Although this thesis is not directly related to the study of fluids, fluids is used in the experimental setup. The use of the properties of fluids can assist in the verification of results.

2.2.1 Volumetric Discharge Rate
The volumetric discharge rate is the volume of fluid that passes through a surface area in a given period of time. It is represented by the following equation:

Q = Avavg ,
where !  [!! /!] is the volumetric discharge, !  [!! ] is the cross-sectional area of the tube, and !!"#   [!/!] is the velocity of the flow on the cross-sectional area (Young, 2004).

(2-5)

2.2.2 Reynolds Number
The shape of the velocity profile changes at different situations. This shape depends on the Reynolds number, which is a dimensionless parameter named after Osborne Reynolds (Donald F. Young, 2004). This number can be used to distinguish the shape of the velocity. The Reynolds number can be expressed as follows:

Re =

vD , Âµ

(2-6)

where v m/s is the mean velocity of the object relative to the fluid, D m is the diameter of the vessel, Âµ Pa  s is the dynamic viscosity of the fluid, and  kg/m! is the density of the fluid. 22
  

  

CHAPTER 2. THEORY
In general, the shape of flow can be divided into three types: laminar, transitional and turbulent flow. Laminar flow usually occurs at stable and low flow rates. Its fully developed velocity profile is parabolic in shape. The maximum velocity occurs at the centerline of the tube, and is two times the average velocity of the tube. The maximum velocity for laminar flow can be derived as follows: For blood flow in a vessel, the velocity is related to the radial distance r , the equation of the velocity is given by

  r  n  v(r ) = v max 1 -    ,   R    
where v max is the peak velocity, n is an index indicating the nature of flow, and R is the radius of the vessel (Shung, 2006). For parabolic flow, n = 2 . The average velocity v avg can be found by integrating the velocity profile across the cross section of the vessel, and dividing the cross sectional area of the vessel,

vavg

1 = 2 R

R    r  2     vmax  2r 1 -   dr     R     0   

v avg =

v max . 2

(2-7)

Transitional flow usually occurs at flow rates slightly higher than that in laminar flow. This type of flow has both the characteristics of both laminar and turbulent flow. Turbulent flow occurs at flow rates that are higher than that in transitional flow. Compared to laminar flow, the velocity profile of laminar flow is flatter in shape. The shape of the velocity profile for laminar and turbulent flow is shown in Figure 2-3.

23
  

  

CHAPTER 2. THEORY

Figure 2-3: The left picture shows the shape of the velocity profile of a laminar flow, and the right picture shows the shape of the velocity profile of a turbulent flow (Plant engineering magazine, 1984).

The type of flow is classified according to the Reynolds number. When the Reynold's number is less than or equal to 2300, the flow is laminar; between 2300 to 4000, the flow is transitional; and greater than or equal to 4000, the flow is turbulent.

24
  

        

Chapter 3

Materials and Methods

Several steps are involved in developing angle independent Doppler ultrasound. Figure 3-1 provides a flow chart of the steps involved. Each of the steps in chart is explained in the following sections.

1. 3D Image Acquisition

2. Centerline Extraction

4. Velocity Calculation
Figure 3-1: Flow chart of the algorithm

3. Doppler Angle Calculation

  

3.1 3D Image Acquisition
The first step involves the 3D image acquisition of the vessel geometry. There are different ultrasound imaging modes that can be used for the reconstruction. Power Doppler was selected for the reconstruction of 3D images. This is because power Doppler images provide signals only at the locations where there is flow, which makes it an excellent candidate to distinguish between the blood vessel and the surrounding tissue when compared to B-mode imaging. In addition, since power Doppler measures the strength of the signal that undergoes Doppler shift, and not the magnitude of the shift. Therefore, when compared to colour Doppler, power Doppler is less dependent on the Doppler angle (Shung, 2006), and does not require angle corrections during reconstruction. 25
  

  

CHAPTER 2. THEORY
In order to acquire power Doppler images, the 3D probe 4DC7-3/40 (Ultrasonix, Vancouver, British Columbia) was used. The transducer of this probe has a linear curved array attached with 128 elements arranged in a line; the frequency of the emitted ultrasound waves available for Doppler ultrasound imaging was 2.0MHz, 2.5MHz or 3.5MHz. 2D ultrasound images can then be acquired. Since the probe has a curved linear array, the 2D image obtained is in fan-shaped. Figure 3-2 below shows the outline an actual 2D image.

Figure 3-2: Due to the curvature of the transducer of the 3D probe, 2D ultrasound image obtained from the probe is in fan-shape. The diagram above shows a 2D image obtained directly from the 3D probe

In addition, the probe has a motor that is attached to the linear curved array. By using the software Propello (Ultrasonix, Vancouver, British Columbia), which is a software to control and move the motor inside the probe, the motor can rotate the transducer in the third dimension around the hinge point as illustrated in Figure 3-3. As a result, 2D ultrasound images at different locations can be obtained. A 3D ultrasound image can be obtained by combining these 2D images. The shape of the combined image is shown in Figure 3-3. Same as the 2D images, the 3D image obtained is also fanshaped. According to Figure 3-3, the angle  represents the field of view of the 2D image, and the angle  represents the angle of the sweeping motion of the motor. Since the distance between each pixel of the slices of 2D ultrasound images is fixed, and the

26
  

  

CHAPTER 2. THEORY
angle  can be set manually, the location of each voxel of the combined 3D image can be calculated.
Hinge point   

Slices    of 2D ultrasound images

Figure 3-3: Principle of the 4DC7-3/40 probe (Cobbold, 2007).

MATLAB (The Mathworks Inc., Natick, MA) was used to create the 3D image in rectangular coordinates. The process of interpolation is explained using a two dimensional case. Figure 3-4 shows an arbitrary schematic diagram of a 2D image. The orange dots represent the points where the data of the ultrasound image was obtained. In order to convert the ultrasound image into a rectangular array, the data points were linearly interpolated by using the MATLAB class TriScatteredInterp.

1

2

3

Y Direction

4

5

6

7

5

4

3

2

1

0

-1

-2

-3

-4

-5

Z Direction

Figure 3-4: The orange dots are the locations where the Doppler image is saved. For further processing, these dots are interpolated into the black dots that are aligned in rectangular grids.  

27
  

  

CHAPTER 2. THEORY

3.2 Centerline Extraction
After the reconstruction and interpolation of the image, the extraction of the centerline is required for the reconstructed vessel geometry. This step is necessary because as mentioned in chapter 1, the centerline velocity of a blood vessel can be used to determine the signs of vasospasm. In order to accomplish this, the software Gorgon (Washington University, St. Louis, Missouri) was used. It uses binary skeletonization to extract the centerline. Skeletonization is a process of thinning objects, so that the resulting objects are one pixel/voxel thick, and have the same connectivity as the original objects. Moreover, binary skeletonization is a process in which the skeletonization is done on binary objects. Binary objects can be obtained by first setting a threshold value of the image. The process of skeletonization of this binary image is illustrated for a two dimensional case in Figure 3-5. Any voxel whose value is below the threshold value is considered to be background. The object voxels are separated into either interior or boundary voxels. An interior voxel is a voxel where all its adjacent voxels are object voxels; and a boundary voxel is a noninterior voxel, where at least one of its adjacent voxel is background. The boundary voxels can then be converted to background, and the process repeats until only boundary voxels remain. The resulting object is its skeleton (Eberly, 2001). By using binary skeletonization alone, the extracted centerline from the vessel geometry may be rough and noisy. Laplacian smoothing is an algorithm to smooth a polygonal mesh (Chen, 2007). It is used in this thesis to smooth the centerline of the reconstructed blood vessel geometry. The position of each pixel or voxel is replaced with the average position of the neighbouring pixel or voxel (Chen, 2007). Essentially, for each pixel or voxel in a mesh, a new position is assigned based on the position of its neighbouring vertices. The equation for the assignment is as follows:

xi =

1 N xj , N j =0
28

  

  

CHAPTER 2. THEORY
where i represents the index of the current vertex where a new position has to be assigned, j represents the indexes of the neighbouring vertices, xi represents the new position of the current vertex, x j represents the positions of the neighbouring vertices, and N represents the number of neighbouring vertices. Laplacian smoothing is chosen because it is simple to implement, and computationally efficient. It can produce acceptable results to both 2D and 3D meshes (Hansen, 2005). Figure 3-6 shows a comparison of two meshes with and without smoothing.

(i) (i)

(ii)

(iii)

(iv)

Set a threshold value of the image that separates between the vessel geometry (represented by `1') with the background (represented by `Â·')

(ii)

The vessel geometry is classified into the interior (represented by `2') or boundary pixels (represented by `1'). A boundary pixel is adjacent to a `background voxel', and an interior pixel is a non-boundary pixel

(iii) (iv)

The boundary pixels that are beside the interior pixels are eliminated The above process repeats until no more boundary voxels can be eliminated

Figure 3-5: Steps of binary skeletonization (Eberly, 2001).

29
  

  

CHAPTER 2. THEORY

Figure 3-6: Comparison of a line before (left) and after (right) laplacian smoothing.

3.3 Doppler Angle Calculation
The Doppler angle is not the same at different locations of a vessel. Figure 3-7 illustrates an example of this. Given two arbitrary points at the centerline `a' and `b', the Doppler angles `a' and `b' are not the same. Therefore, in order to determine the Doppler angles at every location of the centerline, the two vectors `u' and `v' have to be calculated for each location as shown in Figure 3-8, so that the Doppler angle at each location can be determined.

Ultrasound source

a  
a

b  

b

Figure 3-7: The diagram above shows an example at two different points `a' and `b' of a blood vessel that the Doppler angles are not the same.

30
  

  

CHAPTER 2. THEORY
As a result, the steps to determine the Doppler angle are as follows. a) The first step is to determine a point of interest at the centerline where the Doppler angle is required. b) The direction of the ultrasound beam u can be calculated by finding the difference of the coordinates of the hinge point and the point of interest as illustrated in Figure 3-8. c) Vector `v' can be found by first considering a cube with the cube center located at the point of interest as illustrated in Figure 3-8. Vector `v' can be found by connecting the point of interest, and the point on the extracted centerline that is located within the cube but the farthest point to the point of interest. d) The Doppler angle  at the point of interest can be calculated by !  ! = ! ! cos !. e) Steps a) to d) are repeated for all other points on the centerline.
Ultrasound source Tubings u

v

Figure 3-8: Illustration of the Doppler angle calculation.

31
  

  

CHAPTER 2. THEORY

3.4 Velocity Calculation
There are two imaging modes that can be used to obtain the uncorrected velocities of the flow inside the tube. They are colour Doppler and pulsed-wave Doppler. Pulsedwave Doppler has been selected because of the relatively higher frame rate when compared to colour Doppler. With the Doppler angle set to zero degrees, the velocity obtained is the uncorrected velocity vu . From equation 2-2,

fd =

2 f t vu cos(0 ) c 2 f t vu . c
(3-1)

fd =

The Doppler frequency can be obtained. If we combine the calculated Doppler angle into equation 2.2, the velocity obtained is the corrected velocity vc . Therefore,

fd =

2 f t vc cos( ) c

vc =

fd c 2 f t cos( )

(3-2)

By substituting equation 3-1 into equation 3-2,

vc =

2 f t vu c c 2 f t cos( )
vc = vu cos( )
(3-3)

Therefore, the corrected velocity is the uncorrected velocity divided by the Doppler angle.

32
  

  

CHAPTER 2. THEORY

3.5 Phantom Design
The first step in developing operator independent flow measurements was to use a flow phantom. As mentioned by (Hoskins, 2008), the process of ultrasound imaging and measurements is complex, especially in diseased tissues. As a result, experimental setups called phantoms allow controlled arterial ultrasound images to be collected. The purpose of this flow phantom is to aid in the development of the new Doppler ultrasound technique. A review of flow phantom design has been reported by Hoskin et al. that the design should imitate the environment inside the human body (Hoskins, 2008). In other words, both the physical and acoustic properties of the flow phantom should be similar to that of the human body. This allows the flow phantom to provide images and measurements that are realistic and relevant to that inside the human body. The design of the flow phantom in this thesis will follow the guidelines provided by the International Electrotechnical Commission (IEC) (International Electrotechnical Commission, 2001). IEC is the leading global organization that publishes consensus-based International Standards and manages conformity assessment systems for electric and electronic products, systems and services, collectively known as electrotechnology. The amount of the materials for the flow phantom developed in this study is shown in Table 3-1 below:
Table 3-1: Amount of different materials used for the flow phantom

Amount Water Agar Glycerol Graphite 720 mL 18 g 78.12 g 36 g

A blood mimicking fluid (Shelley Medical Imaging Technologies, Toronto, Ontario) used in the flow phantom was formulated to meet the requirements for blood

33
  

  

CHAPTER 2. THEORY
mimicking fluid as specified in the IEC specifications. The physical properties of the human blood, IEC specifications and blood mimicking fluid are compared in Table 3-2.
Table 3-2: Comparison of the physical properties between actual blood, IEC specification and the proposed blood mimicking fluid

Blood

IEC Specifications

Blood Mimicking Fluid

Acoustic Velocity [m/s] Density of Fluid [kg/m3] Acoustic Attenuation [dB/cm/MHz] Viscosity [mPaÂ·s]

1583

1570 +/- 30

1548 +/- 5

1060

1050 +/- 100

1037 +/- 2

0.17

<0.1

0.05 +/- 0.01

3

4.1 +/- 0.1

Blood flow in the human body is a pulsatile flow initiated by the pumping action of the heart. However, in the flow phantom, both steady flow and pulsatile flow were used. Steady flow was first used to test the implementation of algorithm. The design of the flow system is illustrated in Figure 3-9. The Masterflex Easy Load L/S peristaltic pump (Cole-Parmer Instrument Company, Vernon Hills, IL) was used to produce flow inside the tubes of the flow phantom.

34
  

  

CHAPTER 2. THEORY
Funnel (4) (5) Ultrasound Probe Mounted on a Stand

(2)

Blood Mimicking Fluid

Flow Direction Tank Flow Direction Water (1) Peristaltic Pump Tubings Flow phantom

(3)

Beaker

Flow Direction

Figure 3-9: Flow phantom design for steady flow. The peristaltic pump at location (1) was used to initiate flow inside the tubings. For steady flow, the funnel is placed at location (2). Both the funnel and the beaker at locations (2) and (3) respectively are used to absorb the pulses generated from the pump at (1), so that the flow passing through the flow phantom from location (2) to (3) changes from pulsatile to steady flow. On the other hand, for pulsatile flow, the funnel at location (2) is removed, and the tube at location (4) is connected to location (5) directly.

Two sets of results have been obtained by placing the probe at different locations during imaging. The ultrasound probe was placed at two different locations as illustrated in Figure 3-10 and Figure 3-11.

Figure 3-10: The above pictures show the two positions that the ultrasound probe was placed when acquiring Doppler data of the phantom. The left picture shows the first position while the right picture shows the second position.

35
  

  

CHAPTER 2. THEORY
Probe position 2 Probe position 1 Upper Branch Lower Branch Silicone tube located inside the tissue-mimicking block (shown in dotted line)

Flow phantom

Locations where velocities are measured

Figure 3-11: Schematic diagram showing the structure of the flow phantom with the two probe positions indicated.

These two locations were chosen because they can show the effect of Doppler angle towards velocity measurements. The Doppler angles inside the oval for probe location 1 are smaller when compared to that of probe location 2 at the centerline inside the oval as shown in Figure 3-11. Also, these two probe locations can be good representations of the Doppler angles that can be measured in the ICA and MCA. Based on the location of the ICA and MCA, the measured Doppler angles for the ICA are greater than that of the MCA, which is approximately 60Â° and approximately 20Â° respectively.

3.6 In-Vivo Study
After the use of the flow phantom, the implemented algorithm was used on a human volunteer to show the feasibility of the technique on humans. The probe was placed on the volunteer's neck on top of the internal carotid artery as shown in Figure 3-12 below.

36
  

  

CHAPTER 2. THEORY

Figure 3-12: The position of the ultrasound probe when imaging the internal carotid artery (Darling, 2011).

3.7 Further Processing
After the corrected velocities were obtained, they were compared with traditional 2D and pulsed-wave Doppler ultrasound with manual Doppler angle adjustments in order to determine velocity estimation accuracy. In addition, for steady flow, the corrected velocity is compared with the velocity calculated from the volumetric flow rate as stated in equation 2-5.

3.8 Calculation of Uncertainty
Whenever taking measurements, there are often errors associated with them. As a result, it is a common practice to express the final measurements with their uncertainties. In this research, the velocities obtained from the measurements are expressed with their uncertainties. 37
  

  

CHAPTER 2. THEORY
For steady flow in the flow phantom, the uncertainty of velocity for each velocitytime graph was obtained by measuring the difference of the maximum and minimum velocities in that particular graph. On the other hand, for pulsatile flow and in vivo study, the uncertainty of velocity for each velocity-time graph was determined from the range of the average velocities of each pulse cycle in that particular graph; in other words, the average velocities in each pulse cycle of that velocity-time graph was first determined, and the uncertainty was the difference between the maximum and minimum average velocity in that particular graph. For the corrected velocities using automatic angle calculation, the velocities were not obtained directly from the velocity-time graph. According to Equation 3-3, the corrected velocities depend on the uncorrected velocities and the Doppler angles. As a result, propagation of error was used. The uncertainty from the corrected velocity for the automatic angle calculation was obtained (from Equation 3-3) using,
!! !!

=

!! ! !! !! ! !!

+

 !"# ! ! !"# ! ! !"# ! ! !"# ! ! !"# ! ! !"# !

!! !!

=

+

!! = !!

!! ! !!

+

.

Moreover, the uncertainty for the Doppler angle can be obtained by finding the absolute value of the difference of the Doppler angle between using automatic angle calculation and manual angle determination, which can be represented by ! = !! - !! , where ! is the uncertainty of the Doppler angle, !! is the Doppler angle obtained from automatic angle calculation, and !! is the Doppler angle obtained from manual angle determination.

38
  

  

CHAPTER 2. THEORY
For the corrected velocities obtained from the volumetric flow rate, the uncertainty can be calculated as follows. As stated in Equation 2-5, !!"# = !
!

!!"# = !! ! . By combining and Equations 2-7 and 3-4, !!"# = !! ! . Therefore, !!"# = 
! !! ! ! ! !!

!

(3-4)



! !!

!

(3-5)

= !!
 !! !!

!

! ! ! !! !

+

 !! ! !!

(3-6) (3-7)

=

By combining Equations 3-6 and 3-7, 
! !!

= !!

!

! ! !

+

!! ! !

(3-8)

Finally, by combining Equations 3-5 and 3-8, !!"# =
! ! ! ! !! ! ! !

+

!! ! !

!

.

Since the volumetric discharge and radius were measured by a measuring cylinder and caliper, ! and ! were obtained directly from the equipment, ! = Â±1mL and ! = Â±0.05mm.
  

39
  

        

Chapter 4

Results

Two main setups were used for this research. The first setup is the flow phantom as described in the previous chapter, and the second setup is the internal carotid artery of a human volunteer.

4.1 Flow Phantom
There were two types of flow generated inside the phantom tube, they were steady flow and pulsatile flow.

4.1.1

Steady Flow
The volumetric discharge rate inside the tube was set to 170mL/min, and the inner

tube radius was 2.65mm. The average flow velocity in the tube was 12.84cm/s using equation 2-5, and the Reynolds number was 168.87 using equation 2-6. Since the Reynolds number is smaller than 2300, the flow was laminar. As a result, the maximum velocity at the centerline was determined to be 25.69cm/s using equation 2-7. The probe was first placed at location 1 as shown in Figure 3-10 and Figure 3-11, and the results are shown as follows. Two of the 2D power Doppler images are shown in Figure 4-1 below. It can be seen from the images that no power Doppler signals were shown at the lower branch of the tube as indicated by Figure 3-11. This can be explained from the design of the flow phantom. Since the upper branch is located right between the lower branch and the transducer, the backscattered signal from the lower branch may have been contaminated or blocked by the upper branch before reaching the transducer. 40
  

  

CHAPTER 4. RESULTS
Also, since the lower branch of the tube is thinner and deeper than the upper branch of the tube, the backscattered signal from the lower branch may not be strong enough that the amplitude threshold that was set to eliminate noise in the image was possibly above the amplitude of the signal from the lower branch. As a result, the signal from the lower branch was unable to show on the image.

Figure 4-1: 2D Power Doppler images of the flow phantom with steady flow inside the tube.

The resulting 3D binary image of the tube is shown in Figure 4-2. Each voxel of the image has a dimension of 1mm by 1mm by 1mm. The threshold value for the binary image was set to be 50% of the maximum value of the original image. This value was chosen for the purpose of centerline extraction that will be explained in detail below.

41
  

  

CHAPTER 4. RESULTS
Reconstructed Vessel Vessel Shadow

Bifurcation

Figure 4-2: The 3D image of the reconstructed tube and the projection of its shadow onto the xy, yz and xz-plane shown in MATLAB.

The tube centerline was extracted by skeletonization of the binary image. As mentioned above, the threshold value of the binary image was chosen to be 50% of its maximum value, which was determined by trial-and-error. A range of threshold values from 20% to 80% of the maximum value had been tested for the skeletonization, and the optimal threshold value was between 40% and 60% of the maximum value. Therefore, for simplicity, this value was chosen to be 50%. However, the extracted skeleton was noisy and rough. In order to have a smooth skeleton, `laplacian smoothing' was used. Figure 4-3 shows the reconstructed tube geometry, extracted skeleton, and smoothened skeleton displayed in Gorgon, and Figure 4-4 shows the extracted skeleton plotted in MATLAB.

42
  

  

CHAPTER 4. RESULTS

X-Direction Figure 4-3: 3D images of the reconstructed tube geometry (left), extracted centerline (center) and smoothened centerline (right) shown in Gorgan on the xy-plane.

  
Centerline Centerline Shadow

Bifurcation   
Figure 4-4: Tube centerline (orange) and the projection of its shadow onto the xy, yz and xz-plane (grey)  

After the centerline was obtained, the Doppler angles of the centerline were calculated at locations along the centerline, Figure 4-5 shows the resulting angles.

43
  

  

CHAPTER 4. RESULTS
60 70 80 90

Y Axis [mm]

1 2 4 3

100 110 120 130 140

Bifurcation
0 10 20 30 40 X Axis [mm] 50 60 70 80

90 80 70
Doppler Angle [degrees]

60 50 40 30 20 10 0

3 4

2

1

0

10

20

30

40 X Axis [mm]

50

60

70

80

Figure 4-5: The top figure shows the centerline projected onto the xy-plane, and the calculated Doppler angles along the centerline are shown in the bottom figure. The velocities were obtained at four locations of the centerline, and are indicated by the green dots labeled 1, 2, 3 and 4 respectively.

Through the use of pulsed-wave Doppler, the velocities without Doppler angle corrections were obtained at four locations of the centerline in real time. Referring to equation 3-3, the corrected velocities were obtained by dividing the uncorrected velocity by the cosine of the Doppler angle that was found by using the implemented algorithm. It is indicated in Figure 4-5 for the four locations on the centerline where the pulsed-wave Doppler data were obtained, and Figure 4-6 shows the velocity-time graphs of the angle uncorrected and corrected velocities at these four different locations.

44
  

  

CHAPTER 4. RESULTS
35 30 25 35 30 25

Velocity [cm/s]

20 15 10 5 0 0 1 Uncorrected Corrected with new algorithm Corrected manually 2 3 Time [seconds] 4 5

Velocity [cm/s]

20 15 10 5 0 0 1 Uncorrected Corrected with new algorithm Corrected manually 2 3 Time [seconds] 4 5

(a)
35 30 25 35 30 25

(b)

Velocity [cm/s]

20 15 10 5 0 0 1 Uncorrected Corrected with new algorithm Corrected manually 2 3 Time [seconds] 4 5

Velocity [cm/s]

20 15 10 5 0 0 1 Uncorrected Corrected with new algorithm Corrected manually 2 3 Time [seconds] 4 5

(c)
35 30 25 35 30 25

(d)

Velocity [cm/s]

20 15 10 5 0 0 1 Uncorrected Corrected with new algorithm Corrected manually 2 3 Time [seconds] 4 5

Velocity [cm/s]

20 15 10 5 0 0 1 Uncorrected Corrected with new algorithm Corrected manually 2 3 Time [seconds] 4 5

(e)

(f)

45
  

  

CHAPTER 4. RESULTS
35 30 25 35 30 25

Velocity [cm/s]

20 15 10 5 0 0 1 Uncorrected Corrected with new algorithm Corrected manually 2 3 Time [seconds] 4 5

Velocity [cm/s]

20 15 10 5 0 0 1 Uncorrected Corrected with new algorithm Corrected manually 2 3 Time [seconds] 4 5

(g)

(h)

Figure 4-6: Velocity-time graphs at different locations of the centerline as described by Figure 4-5. (a), (c), (e) and (g) are graphs showing the measured velocity vs. time at locations 1, 2, 3 and 4 respectively. In addition, (b), (d), (f) and (h) are the respective graphs of (a), (c), (e) and (g) when a moving average filter is applied.

Table 4-1 below summarizes the angle corrected and uncorrected velocities for probe position 1 at the four locations using the implemented algorithm, manual Doppler angle adjustment and volumetric flow rate.
Table 4-1: Time average velocities with uncertainties obtained from the four locations illustrated in Figure 4-5 using different methods.

Uncorrected Velocities Velocities [cm/s] Method Location 1 2 3 4 19.36 Â± 2.01 19.63 Â± 2.21 20.98 Â± 2.10 23.01 Â± 2.43 21.91 Â± 2.49 22.05 Â± 2.67 23.41 Â± 2.55 25.69 Â± 3.02 No adjustments Implemented algorithm Manual Doppler angle adjustment 22.83 Â± 2.36 22.67 Â± 2.55 24.22 Â± 2.44 26.06 Â± 2.75 25.69 Â± 0.62 Volumetric flow rate Corrected Velocities [cm/s]

46
  

  

CHAPTER 4. RESULTS
The experiment was repeated for simulating steady flow in the flow phantom, with the probe placed at probe position 2 as indicated in Figure 3-10 and Figure 3-11. The results are shown in Figure 4-7 and Figure 4-8.
60 70 80 90

1 2

Y Axis [mm]

100

3
110 120 130 140

4

Bifurcation
0 10 20 30 40 X Axis [mm] 50 60 70 80

90 80 70
Doppler Angle [degrees]

3 4

2 1

60 50 40 30 20 10 0

0

10

20

30

40 X Axis [mm]

50

60

70

80

Figure 4-7: The experiment was repeated for steady flow in the phantom. The top figure shows the centerline projected onto the xy-plane, and the calculated Doppler angles along the centerline are shown in the bottom figure. The velocities are obtained at four locations of the centerline, and are indicated by the green dots labeled 1, 2, 3 and 4 respectively.

47
  

  

CHAPTER 4. RESULTS
40 35 30 40 35 30

Velocity [cm/s]

25 20 15 10 5 0 0 1 Uncorrected Corrected with new algorithm Corrected manually 2 3 Time [seconds] 4 5

Velocity [cm/s]

25 20 15 10 5 0 0 1 Uncorrected Corrected with new algorithm Corrected manually 2 3 Time [seconds] 4 5

(a)
40 35 30

(b)

40 35 30

Velocity [cm/s]

Velocity [cm/s]

25 20 15 10 5 0 0 1 Uncorrected Corrected with new algorithm Corrected manually 2 3 Time [seconds] 4 5

25 20 15 10 5 0 0 1 Uncorrected Corrected with new algorithm Corrected manually 2 3 Time [seconds] 4 5

(c)
40 35 30 40 35 30

(d)

Velocity [cm/s]

25 20 15 10 5 0 0 1 Uncorrected Corrected with new algorithm Corrected manually 2 3 Time [seconds] 4 5

Velocity [cm/s]

25 20 15 10 5 0 0 1 Uncorrected Corrected with new algorithm Corrected manually 2 3 Time [seconds] 4 5

(e)

(f)

48
  

  

CHAPTER 4. RESULTS
40 35 30 40 35 30

Velocity [cm/s]

25 20 15 10 5 0 0 1 Uncorrected Corrected with new algorithm Corrected manually 2 3 Time [seconds] 4 5

Velocity [cm/s]

25 20 15 10 5 0 0 1 Uncorrected Corrected with new algorithm Corrected manually 2 3 Time [seconds] 4 5

(g)

(h)

Figure 4-8: Velocity-time graphs at different locations of the centerline as described by Figure 4-7 where the probe was placed at a second location. (a), (c), (e) and (g) are graphs showing the measured velocity vs. time at locations 1, 2, 3 and 4 respectively. In addition, (b), (d), (f) and (h) are the respective graphs of (a), (c), (e) and (g) when a moving average filter is applied.

Table 4-2 below summarizes the angle corrected and uncorrected velocities for probe position 2 at the four locations using the implemented algorithm, manual Doppler angle adjustment and volumetric flow rate.
Table 4-2: Time average velocities with uncertainties obtained from the four locations illustrated in Figure 4-7 using different methods.

Uncorrected Velocities Velocities [cm/s] Method Location 1 2 3 4 No adjustments 14.12 Â± 2.58 14.38 Â± 3.16 14.33 Â± 3.37 15.10 Â± 3.32 Implemented algorithm 22.90 Â± 5.18 24.18 Â± 6.32 22.49 Â± 6.01 25.74 Â± 6.38 Manual Doppler angle adjustment 26.65 Â± 4.87 25.71 Â± 5.65 24.38 Â± 5.74 23.49 Â± 5.16 25.69 Â± 0.62 Volumetric flow rate Corrected Velocities [cm/s]

49
  

  

CHAPTER 4. RESULTS 4.1.2 Pulsatile Flow
After the use of steady flow, pulsatile flow was simulated in the flow phantom as indicated in Figure 3-9, and the probe was placed at the two locations as indicated in Figure 3-10 and Figure 3-11. The frequency of the pump was set to 4 Hz. Same as steady flow, through the use of pulsed-wave Doppler, the velocities without Doppler angle corrections were obtained at four locations of the centerline in real time. The corrected velocities were then obtained by dividing the uncorrected velocity by the cosine of the Doppler angle that was found by using the extracted centerline. It is indicated in Figure 4-9 for the four locations on the centerline where the pulsed-wave Doppler data were obtained, and Figure 4-10 shows the velocity-time graphs of the angle uncorrected and corrected velocities at these four different locations.

50
  

  

CHAPTER 4. RESULTS
60 70 80

1
90

Y Axis [mm]

2
100

3
110 120

4

Bifurcation
130 140 0 10 20 30 40 50 60 X Axis [mm] 70 80 90 100

90 80 70
Doppler Angle [degrees]

60 50 40 30 20 10 0

4

3

2 1

0

10

20

30

40

50 60 X Axis [mm]

70

80

90

100

Figure 4-9: The top figure shows the centerline projected onto the xy-plane, and the calculated Doppler angles along the centerline are shown in the bottom figure. The velocities are obtained at four locations of the centerline, and are indicated by the green dots labeled 1, 2, 3 and 4 respectively.
40 35 30 40 35 30

Velocity [cm/s]

25 20 15 10 5 0 0 Uncorrected Corrected with new algorithm Corrected manually 0.2 0.4 0.6 0.8 1

Velocity [cm/s]

25 20 15 10 5 0 0 Uncorrected Corrected with new algorithm Corrected manually 0.2 0.4 0.6 0.8 1

Time [seconds]

Time [seconds]

(a)

(b)

51
  

  

CHAPTER 4. RESULTS
40 35 30 40 35 30

Velocity [cm/s]

25 20 15 10 5 0 0 0.2 0.4 uncorrected corrected with new algorithm corrected manually 0.6 0.8 1

Velocity [cm/s]

25 20 15 10 5 0 0 0.2 0.4 Uncorrected Corrected with new algorithm Corrected manually 0.6 0.8 1

Time [seconds]

Time [seconds]

(c)
40 35 30 40 35 30

(d)

Velocity [cm/s]

25 20 15 10 5 0 0 0.2 0.4 Uncorrected Corrected with new algorithm Corrected manually 0.6 0.8 1

Velocity [cm/s]

25 20 15 10 5 0 0 0.2 0.4 Uncorrected Corrected with new algorithm Corrected manually 0.6 0.8 1

Time [seconds]

Time [seconds]

(e)
40 35 30 40 35 30

(f)

Velocity [cm/s]

25 20 15 10 5 0 0 0.2 0.4 Uncorrected Corrected with new algorithm Corrected manually 0.6 0.8 1

Velocity [cm/s]

25 20 15 10 5 0 0 0.2 0.4 Uncorrected Corrected with new algorithm Corrected manually 0.6 0.8 1

Time [seconds]

Time [seconds]

(g)

(h)

Figure 4-10: Velocity-time graphs at different locations of the centerline as described by Figure 4-9 where the probe was placed at location 1. (a), (c), (e) and (g) are graphs showing the measured velocity vs. time at locations 1, 2, 3 and 4 respectively. In addition, (b), (d), (f) and (h) are the respective graphs of (a), (c), (e) and (g) when a moving average filter is applied.

52
  

  

CHAPTER 4. RESULTS
Table 4-3 below summarizes the time-average angle corrected and uncorrected velocities for probe position 1 at the four locations using the implemented algorithm and manual Doppler angle adjustment.
Table 4-3: Time average velocities with uncertainties obtained from the four locations illustrated in Figure 4-9 using different methods.

Uncorrected TimeVelocities Average Velocities [cm/s] Method Location 1 2 3 4 No adjustments 17.62 Â± 1.27 16.72 Â± 2.21 20.24 Â± 1.74 18.34 Â± 4.18 Implemented algorithm 19.61 Â± 2.45 18.92 Â± 3.27 28.21 Â± 6.23 23.22 Â± 6.50 Manual Doppler angle adjustment 24.49 Â± 1.77 21.83 Â± 2.87 25.68 Â± 2.21 23.49 Â± 5.30 Corrected Time-Average Velocities [cm/s]

The experiment was repeated with the ultrasound probe placed at position 2 as shown in Figure 3-10 and Figure 3-11, and the results are shown in Figure 4-11 and Figure 4-12.

53
  

  

CHAPTER 4. RESULTS
60 70 80 90

1 2 3 4

Y Axis [mm]

100 110 120 130 140

Bifurcation
0 10 20 30 40 X Axis [mm] 50 60 70 80

90 80 70
Doppler Angle [degrees]

43

2 1

60 50 40 30 20 10 0

0

10

20

30

40 X Axis [mm]

50

60

70

80

Figure 4-11: The experiment was repeated for pulsatile flow in the phantom. The top figure shows the centerline projected onto the xy-plane, and the calculated Doppler angles along the centerline are shown in the bottom figure. The velocities are obtained at four locations of the centerline, and are indicated by the green dots labeled 1, 2, 3 and 4 respectively.

54
  

  

CHAPTER 4. RESULTS
45 40 35 45 40 35

Velocity [cm/s]

25 20 15 10 5 0 0 0.2
Uncorrected Corrected with new algorithm Corrected manually

Velocity [cm/s]

30

30 25 20 15 10 5
Uncorrected Corrected with new algorithm Corrected manually

0.4 0.6 Time [seconds]

0.8

1

0 0

0.2

0.4 0.6 Time [seconds]

0.8

1

(a)
45 40 35
45 40 35

(b)

Velocity [cm/s]

25 20 15 10 5 0 0 0.2
Uncorrected Corrected with new algorithm Corrected manually

Velocity [cm/s]

30

30 25 20 15 10 5 Uncorrected Corrected with new algorithm Corrected manually 0 0.2 0.4 0.6 0.8 1

0.4 0.6 Time [seconds]

0.8

1

0

Time [seconds]

(c)
45 40 35 45 40 35

(d)

Velocity [cm/s]

25 20 15 10 5 0 0 Uncorrected Corrected with new algorithm Corrected manually 0.2 0.4 0.6 0.8 1

Velocity [cm/s]

30

30 25 20 15 10 5 0 0 0.2 0.4 Uncorrected Corrected with new algorithm Corrected manually 0.6 0.8 1

Time [seconds]

Time [seconds]

(e)

(f)

55
  

  

CHAPTER 4. RESULTS
45 40 35 Uncorrected Corrected with new algorithm Corrected manually
45 40 35

Uncorrected Corrected with new algorithm Corrected manually

Velocity [cm/s]

25 20 15 10 5 0 0 0.2 0.4 0.6 0.8 1

Velocity [cm/s]

30

30 25 20 15 10 5 0

0

0.1

0.2

0.3

0.4

0.5

0.6

0.7

0.8

0.9

1

Time [seconds]

Time [seconds]

(g)

(h)

Figure 4-12: Velocity-time graphs at different locations of the centerline as described by Figure 4-11. (a), (c), (e) and (g) are graphs showing the measured velocity vs. time at locations 1, 2, 3 and 4 respectively. In addition, (b), (d), (f) and (h) are the respective graphs of (a), (c), (e) and (g) when a moving average filter is applied.

Table 4-4 below summarizes the time-average angle corrected and uncorrected velocities for probe position 2 at the four locations using the implemented algorithm and manual Doppler angle adjustment.
Table 4-4: Time average velocities with uncertainties obtained from the four locations illustrated in Figure 4-11 using different methods.

Uncorrected TimeVelocities Average Velocities [cm/s] Method Location 1 2 3 4 No adjustments 12.26 Â± 2.67 12.63 Â± 3.83 14.32 Â± 1.04 15.71 Â± 0.86 Implemented algorithm 20.06 Â± 4.92 20.73 Â± 6.71 23.48 Â± 3.11 25.38 Â± 3.19 Manual Doppler angle adjustment 21.92 Â± 4.76 23.83 Â± 6.84 25.61 Â± 1.86 28.09 Â± 1.54 Corrected Time-Average Velocities [cm/s]

56
  

  

CHAPTER 4. RESULTS

4.2 In-Vivo Data
Through the use of a flow phantom as a platform, it was shown in the previous section that the implemented algorithm allows the automatic determination of the Doppler angle at all the locations of the phantom tube. In order to demonstrate the feasibility of the technique on humans, the algorithm was used on a human volunteer. As explained in the previous chapter, since the ICA is one of the indicators to determine the occurrence of vasospasm, the algorithm was tested on the ICA of the human volunteer. As in the phantom experiments, the 4DC7-3/40 transducer in power Doppler mode was used to obtain 2D images of the ICA. In addition, in order to show that the use of 3D Doppler ultrasound does not require the probe to be aligned with the plane that contains the blood vessel, the probe was purposely positioned at a location that does not align with the plane. The reconstructed 3D ICA geometry was obtained by using linear interpolation on the combined slices of 2D images, the centerline was extracted, and the Doppler angles along the centerline are calculated. The results are shown in Figure 4-13 and Figure 4-14.
ICA geometry ICA shadow

40

30
Z Axis [mm]

20

10

0 0 20 40 60 80 Y Axis [mm] 25 20 X Axis [mm] 15 10

0 5

Figure 4-13: The reconstruction of the ICA geometry, with its projection onto the xy, yz and xzplane, and extracted centerline shown in MATLAB.

57
  

  

CHAPTER 4. RESULTS
ICA centerline ICA centerline shadow

40

30
Z Axis [mm]

20

10

0 0 20 40 60 80 Y Axis [mm] 20 15 X Axis [mm] 10 5

0

Figure 4-14: The extracted centerline from the ICA geometry, with its projection onto the xy, yz and xz-plane, and extracted centerline shown in MATLAB.

After the Doppler angle was determined, pulsed-wave Doppler was used to obtain the uncorrected velocity at a location of the extracted centerline from the ICA geometry as indicated in the first graph of Figure 4-15. By dividing the uncorrected velocity by the cosine of the Doppler angle, the corrected velocity was calculated. The velocity-time graph between the uncorrected and corrected ICA velocities using the implemented algorithm is shown in Figure 4-16.

58
  

  

CHAPTER 4. RESULTS
44 46 Doppler Angle = 69.2414 Degrees 48 50

Y Axis [mm]

52 54 56 58 60 16

18

20

22 Z Axis [mm]

24

26

28

90 80 70

Doppler Angle [degrees]

60 50 40 30 20 10 0 16

18

20

22 Z Axis [mm]

24

26

28

Figure 4-15: The ICA of a human volunteer was imaged. Doppler data was obtained, and the ICA geometry was reconstructed. The top figure shows the centerline of the geometry projected onto the xy-plane, and the calculated Doppler angles along the centerline with respect to the x axis are shown in bottom figure. The arrow indicates the location where the velocities were obtained using pulsedwave Doppler.

59
  

  

CHAPTER 4. RESULTS

Uncorrected Corrected with new algorithm 100 90 80 70

Velocity [cm/s]

60 50 40 30 20 10 0 0 0.5 1 1.5 2 2.5 Time [seconds] 3 3.5 4 4.5

Figure 4-16: Graph showing the uncorrected and corrected velocity-time graph of the ICA blood flow of the human volunteer, obtained using automatic angle calculation.

In order to verify that the ICA blood flow velocity was correct, the velocity inside the ICA was measured by using pulsed-wave Doppler with manual angle correction. However, since the probe was not aligned with the plane that contained the ICA, in order to manually adjust the Doppler angle, the probe was repositioned in order to align with the plane. Figure 4-17 shows the comparison of the velocity vs. time graph between the velocity of the ICA obtained by using manual angle correction and the implemented algorithm.

60
  

  

CHAPTER 4. RESULTS
100 90 80 70

Velocity [cm/s]

60 50 40 30 20 10 0 Corrected with automatic angle calculation Corrected with manual angle determination 0 0.5 1 1.5 2 2.5 Time [seconds] 3 3.5 4

Figure 4-17: Velocity-time graph of the ICA blood flow of the human volunteer, obtained using manual angle determination and automatic angle calculation.

As explained earlier, the time average velocity should be considered when determining the signs of vasospasm. The time average velocity obtained from the implemented algorithm was 32.51 Â± 8.61 cm/s, whereas that for manual angle correction was 35.48 Â± 2.33 cm/s.

61
  

        

Chapter 5

Discussion and Conclusion

This research studies the utilization of the existing clinical ultrasound imaging system for operator independent Doppler ultrasound imaging for the detection of cerebral vasospasm. Essentially, it determines whether the upgrade of the existing Doppler ultrasound technology can eliminate the manual measurement of Doppler angle by a dedicated ultrasonographer during velocity estimation in blood vessels. The developed algorithm was tested on three settings: flow phantom with steady flow, flow phantom with pulsatile flow, and the ICA of a human volunteer. The method used in this research includes the reconstruction of 3D power Doppler images on the vascular structure, extraction of the centerline by using binary skeletonization, calculation of Doppler angle and construction of the temporal blood velocity profiles at various parts of the vasculature. We have successfully used the above methods to obtain the corrected velocities in a flow phantom setting and in the ICA of a human volunteer.

5.1 Discussion
Two other methods were used to determine the accuracy of the developed algorithms: comparison against volumetric flow rate (equation 2-5) for steady flow only; and comparison against Doppler velocity measurements with manual angle correction (method used clinically) for both steady and pulsatile flow. Both methods were used for the first sets of results from using steady flow inside the flow phantom. Referring to Table 4-1, the velocity at the centerline obtained from the volumetric discharge rate is 25.69 Â± 0.62 cm/s. Using this method as comparison, the percentage differences are 14.71%, 14.17%, 8.88% and 0% respectively for locations `1', `2', `3' and `4' on Figure 4-5. 62
  

CHAPTER 5: DISCUSSION AND CONCLUSION
The limitation for this method is that it is based on the assumption that the flow across the tube is laminar. However, this may not be the case, and the velocity profile of the flow may be distorted especially at the point closest to the branching point like locations 1 and 2 as shown in Figure 4-5. This may explain why the velocities at those two locations give higher percentage differences than that at locations 3 and 4. Using the manual corrected velocities as a means of comparison, the results are displayed in Table 4-1. The percentage differences obtained by using this method of comparison are 4.03%, 2.73%, 3.34% and 1.42% respectively for locations `1', `2', `3' and `4' on Figure 4-5. This supports the assumption that the flow near the branching point may not be laminar. There are also limitations for the second verification method. Firstly, it is difficult to align the probe perfectly with the plane that contains the vessel, causing a component of the velocity to be outside of the 2D image, leading to error for manual velocity corrections. For the second set of results from using steady flow inside the flow phantom, the probe was placed at a different location as shown in Figure 3-10 and Figure 3-11. Through the use of the first method, the velocity at the centerline obtained from the volumetric discharge rate is 25.69 Â± 0.62 cm/s, and the percentage errors were 10.86%, 5.88%, 12.46% and 0.19% respectively for locations `1', `2', `3' and `4' on Figure 4-7. Compared to the manual Doppler velocity measurements, the percentage errors obtained were 14.07%, 5.96%, 7.75% and 9.58% respectively for locations `1', `2', `3' and `4' respectively. It can be shown that the first set of results were more accurate than the second set of results. This could be explained by the difference of the probe location. For probe location 1, the Doppler angles measured for the four locations are around 30  , whereas for probe location 2, the Doppler angles measured for the four locations are around 50  . Also, the larger the angle, a one degree difference will result in a larger difference in

cos . This means that each degree difference at larger angles will result in larger errors
63
  

CHAPTER 5: DISCUSSION AND CONCLUSION
when compared to smaller angles when used in equation 3-3. Also, as specified by Edward et. al., when the Doppler angle is greater than 60  , measurements are likely to be inaccurate (Grant, 2003). For pulsatile flow inside the flow phantom, the results are displayed in Figure 4-10 and Figure 4-12, which provide the velocity measurements when the probe is placed at two different locations. For probe location 1, by using the manual corrected velocities as a means of comparison, the results are displayed in Table 4-3. The percentage errors were 19.93%, 13.33%, 9.85% and 1.15% respectively for locations `1', `2', `3' and `4' on Figure 4-9. It can be seen that for location `1', the error is higher than the other locations. This discrepancy can be explained from Figure 4-9. By comparing Figure 4-9 with Figure 4-5, Figure 4-7 and Figure 4-11, the extracted centerline in Figure 4-9 is more crooked at the area close to the bifurcation when compared to the other three, which in turn, affects the Doppler angle measurements especially at vessel location 1 and 2. This error in centerline extraction could have been affected by noise in the ultrasound images acquired from the probe. For probe location 2, by using the manual corrected velocities as a means of comparison, the results are displayed in Table 4-4. The calculated percentage errors were 8.49%, 13.01%, 8.32% and 9.65% respectively for locations `1', `2', `3' and `4' indicated on Figure 4-11. Velocity corrections were obtained from the ICA of a human volunteer in order to demonstrate the feasibility of the technique on a human subject. It can be seen from Figure 4-17 that the corrected velocities obtained from the implemented algorithm are very close to that obtained from the manual adjustments of an operator. By using manual angle correction in Figure 4-17 as a means of comparison, the percentage error for the time-average velocity is 8.37%. The results show the effect of Doppler angle on the velocity measurements. For smaller Doppler angles, the difference between the corrected and the uncorrected velocities may not be significant. However, when the Doppler angle is relatively larger, the difference can be significant, which demonstrates the importance of Doppler angle 64
  

CHAPTER 5: DISCUSSION AND CONCLUSION
adjustments while measuring velocities. Figure 4-16 shows that the difference between the uncorrected and corrected velocities can be large when the Doppler angle is large.

5.2 Conclusion
The results obtained from the implemented algorithm were verified with that from manual angle adjustments. For steady flow in a phantom, the method was able to determine the centerline velocity from 1.42% to 4.03% error for smaller Doppler angles, and from 0.19% to 10.86% error for larger Doppler angles, depending on the proximity to the bifurcation. For pulsatile flow in the phantom, the method was able to determine the centerline velocity from 1.15% to 19.93%. As discussed in the discussion section, the higher error can be explained by the centerline extraction that could have been affected by noise. Finally, for in-vivo flow in a human ICA, the error was 8.37%. To conclude, this thesis has demonstrated that operator independent monitoring of blood flow is possible.

65
  

        

Chapter 6

Future Work

Through the use of a flow phantom and the ICA of a human volunteer as platforms, this thesis demonstrates that Doppler angle corrections can be done automatically without the need of an operator. Since the ultimate goal of this project is to determine the signs of cerebral vasospasm for patients who suffers from SAH, and the lindegaard ratio states that the ICA and the MCA are used to determine the signs of vasospasm. As a result, the next step of the research involves the automatic calculations of the Doppler angle and its velocity corrections in the MCA. Once the feasibility of the new technique is shown in the MCA, this new ultrasound technique should be implemented for clinical use. This can be divided into software and hardware components. For the software part, a software platform should be developed that combines all the functions and methods used in this thesis. This includes the acquisition of power Doppler and pulsed-wave Doppler images, the reconstruction and interpolation of a 3D image from the power Doppler images, the extraction of centerline from the blood vessel geometry of the 3D images, the calculation of the Doppler angles from the centerline, and finally, the correction of velocities using the calculated Doppler angles. For the hardware part, it involves developing a brain helmet that contains two probes for the acquisition of images from the ICA and MCA. This helmet can be worn by the patient, and the probe position can be adjusted in order to obtain the images in the ICA and MCA. The brain helmet and the software platform should be combined into one single system, so that it can be used clinically. The brain helmet should be tested on healthy people for the determination of ICA and MCA velocities, followed by testing on patients for the signs of vasospasm. As written in the long term objective of the introduction of 66
  

  

CHAPTER 5. FUTURE WORK
this thesis, the ultimate goal is that, the use of this technique will provide similar Doppler angle measurements and velocity calculations as that by using a dedicated ultrasonographer for the manual corrections.

67
  

        

References
Aaslid R, Markwalder TM, Nornes H. Noninvasive transcranial Doppler ultrasound recording of flow velocity in basal cerebral arteries. J Neurosurg. 1982. 57, pp. 769-74. Aaslid R, Huber P, Normes H. Evaluation of cerebrovascular spasm with transcranial Doppler ultrasound. 1984. 60, pp. 37-41. Aaslid R, Huber P, Nornes H. A transcranial Doppler method in the evaluation of cerebrovascular spasm. Neuroradiology. 1986. 28, pp. 11-16. Awad IA, Carter LP, Spetzler RF, Medina M and Williams FC Jr. Clinical vasospasm after subarachnoid hemorrhage: response to hypervolemic hemodilution and arterial hypertension. Stroke. 1987. Vol. 18, pp. 365-372. Awad Issam A., AANS Publications Committee. Current management of cerebral aneurysms. 1993. Barrow Neurological Institute. Stroke, Subarachnoid Hemorrhage. [Online] http://healthgoneow.blogspot.com/2009/09/stroke-subarachnoid-hemorrhage.html. Bonita R. Cigarette smoking, hypertension and the risk of subarachnoid hemorrhage: a population based case-control study. Stroke. 1986. 17, pp. 831-835. Chen Ligang, Zheng Yao, Chen Jianjun, Liang Yi. An Improved Laplacian Smoothing Approach for Surface Meshes, Computational science. Computational science - ICCS 2007, Lecture notes in computer science, 2007. 2007. Vol. 4487, pp. 318-325. Cobbold Richard S. C. Foundations of biomedical ultrasound. Oxford University Press, 2007. Darling David. Aneurysm. [Online] The encyclopedia of science, 2011. http://www.daviddarling.info/encyclopedia/A/aneurysm.html. Darling David. Carotid ultrasound. [Online] The encyclopedia of science, 2011. http://www.daviddarling.info/encyclopedia/C/carotid_ultrasound.html.

68
  

  

REFERENCES
Deane Colin. Doppler ultrasound: principles and practice. [Online] Centrus, 2002. http://www.centrus.com.br/DiplomaFMF/SeriesFMF/doppler/capituloshtml/chapter_01.htm. de la Monte SM, Moore GW, Mong MA. Rish factors for the development and rupture of intracranial berry aneurysms. Am J Med. 1985. 78, pp. 957-964. Department of Surgery, Canada. Clazosentan: an endothelin receptor antagonist for treatment of vasospasm after subarachnoid hemorrhage. 2008. Vol. 17, 11, pp. 17611767. Dorsch N. W. C., FRCS FRACS, King M.T. BSC (Hons). A review of cerebral vasospasm in aneurysmal subarachnoid haemorrhage. Part 1: Incidence and effects. Journal of clinical neuroscience. 1994. 1, pp. 19-26. Eberly David. Skeletonization of 2D binary images. Geometric tools, LLC. June 7, 2001. Grandin CÃ©cile B., Cosnard Guy, Hammer Frank, Duprez Thierry P., Stroobandt Guy and Mathurin Pierre. Vasospasm after subarachnoid hemorrhage: diagnosis with MR angiography. American Jurnal of Neuroradiology. 2000. 21, pp. 1611-1617. Grant Edward G., MD. Carotid artery stenosis: gray-scale and Doppler US diagnosis. Society of radiologists in ultrasound consensus conference. Radiology. 2003. 229, pp. 340-346. Hansen Glen A., Douglass R.W., Zardecki Andrew. Mesh enhancement. Imperial College Press, 2005. Hoskins P R. Haemodynamics and blood flow measured using ultrasound imaging. Proceedings of the Institution of Mechanical Engineers, Part H: Journal of Engineering in Medicine. Sage Publications, 2010. Vol. 224, 2, pp. 255-271. Hoskins Peter R., Medical Physics Section, University of Edinburgh. Simulation and Validation of Arterial Ultrasound Imaging and Blood Flow. Ultrasound in medicine & biology. Edinburgh, UK, 2008. Vol. 34, 5, pp. 693-717. International Electrotechnical Commission. IEC 61685. Ultrasonics--Flow measurement systems: Flow test object. International Electrotechnical Commission. Geneva, Switzerland, 2001.
     

69
  

  

REFERENCES
Ivancevich Nikolas M., Chu Kengyeh K., Dahl Jeremy D., Light Edward D., Trahey Gregg E., Idriss Salim F., Wolf Patrick D., Dixon-Tulloch Ellen, Smith Stephen W. Real time 3D ultrasound imaging of the brain. Ultrasonics Symposium, 2004 IEEE. Dept. of Biomed. Eng., Duke Univ., Durham, NC, USA, August 23-27, 2004. Vol. 1, pp. 110113. Jewett Serway. Physics for Scientists and Engineers. Volume 2. Thomson Brooks/Cole. 2004. Kassell NF, Sasaki T, Colohan AR, Nazar G. Cerebral vasospasm following aneurysmal subarachnoid hemorrhage. Stroke. 1985. 16, pp. 562-572. Klotzsch Christof, Harrer Judith U. Cerebral aneurysms and arteriovenous malformations. Ralf W. Baumgartner. Frontiers of neurology and neuroscience. Basel, 2006. Vol. 21, pp. 171-181. Klotzsch C, Bozzato A, Lammers G, Mull M, Lennartz B, Noth J. Three-dimensional transcranial color-coded sonography of cerebral aneurysms. Stroke. 1999. 30, pp. 22852290. Krejza Jaroslaw, MD, PhD. Middle cerebral artery spasm after subarachnoid hemorrhage: detection with transcranial color-coded duplex US. Radiology. 2005. 236, pp. 621-629. Lathi, B. P. Modern digital and analog communication systems. 3 New York : Oxford University Press, 1998. Lee Kendall H., Lukovits Timothy, and Friedman Jonathan A. "Triple-H" therapy for cerebral vasospasm following subarachnoid hemorrhage. Neurocrit. Care. 2006. 4, pp. 68-76. Lennihan Laura, Petty George W, Fink Matthew E, Solomon Robert A, Mohr J P. Transcranial Doppler detection of anterior cerebral artery vasospasm. Journal of Neurology, Neurosurgery, and Psychiatry. 1993. 56, pp. 906-909. Lindegard B, Hillbom M, Brody S. High-dose estrogen-progestrogen oral contraceptives: a risk factor for aneurismal subarachnoid hemorrhage? Acta Neurol Scand. 1987. 76, pp. 37-45. Lindegaard K. F., Nornes H., Bakke S. J., Sorteberg W. and Nakstad P. Cerebral vasospasm diagnosis by means of angiography and blood velocity measurements. Acta Neurochirurgica. 1989. Vol. 100, 1-2, pp. 12-24.

70
  

  

REFERENCES
Lufkin Robert B., Bradley William G. Jr., Brant-Zawadzki Michael. MRI of the Brain II. Second Edition. Lippincott Williams & Wilkins. 2001. pp. 25. Macdonald R Loch, St Michael Hospital, Division of Neurosurgery, Keenan Research Centre and the Li Ka Shing Knowledgw Institute of St Michael Hospital, Nelson Thomas R., and Petorius Dolores H. Three-dimensional ultrasound imaging. Ultrasound in med. & biol. 1998. Vol. 24, 9, pp. 1243-1270. Macdonald R Loch. Management of cerebral vasospasm. Neurosurg Rev. 2006. 29, pp. 179-193. Norman Wesley, PhD. Skull, Scalp and Superficial Face. [Online] 1999. http://www.wesnorman.com/lesson1.htm. Perren Fabienne, Horn Peter, Kern Rolf, Bueltmann Eva, Hennerici Michael, and Meairs Stephen. A rapid non-invasive method to visualize ruptured aneurysms in the emergency room: three-dimensional power Doppler imaging. J neurosurg. 2004. 100, pp. 619-622. Petitti DB, Wingerd J. Use of oral contraceptives, cigarette smoking, and the risk of subarachnoid hemorrhage. Lancet. 1978. 2, pp. 234-236. Plant engineering magazine. [Online] Plant engineering magazine, November 21, 1984. http://www.omega.com/techref/flowcontrol.html. Postert Thomas, Federlein Jens, Przuntek Horst and Bottner Thomas. Insufficient and Absent Acoustic Temporal Bone Window: Potential and Limitations of Transcranial Contrast-Enhanced Color-Coded Sonography and Contrast-Enhanced Power-Based Sonography. Ultrasound in medicine & biology. 1997. Vol. 23, 6, pp. 857-862. Rubin J M, Bude R O, Carson P L, Bree R L, and Adler R S. Power Doppler Ultrasound: a potentially useful alternative to mean frequency-based color Doppler Ultrasound. Radiology. March 1994. 190, pp. 853-856. Sacco RL, Wolf PA, Bharucha NE. Subarachnoid and intracerebral hemorrhage: natural history, prognosis, and precursive factors in the Framingham study. Neurology. 1984. 34, pp. 847-854. Sen Jon, Belli Antonio, Albon Helen, Morgan Laleh, Petzold Axel, and Kitchen Neil. Triple-H therapy in the management of aneurysmal subarachnoid haemorrhage. Lancet Neurol. 2003. 2, pp. 614-621. Shung K. K. Diagnostic ultrasound, imaging and blood flow measurements. CRC press. 2006. 71
  

  

REFERENCES
Sloan M.A. Assessment: Transcranial Doppler ultrasonography. Neurology. 2004. 62, pp. 1468-1481. Stroke Center. Subarachnoid Hemorrhage. [Online] Stroke Center, 2007-2010. http://www.strokecenter.org/patients/sah.htm. Thomas Jefferson University Hospital. Stroke. [Online] Thomas Jefferson University Hospital, 2011. http://www.jeffersonhospital.org/diseasesconditions/stroke.aspx?disease=fc21ddab-f37c-480c-a0b6-f612b8bfc144. Wintermark M., Ko N.U., Smith W.S., Liu S., Higashida R.T., Dillon W.P. Vasospasm after subarachnoid hemorrhage: Utility of perfusion CT and CT angiography on diagnosis and management. AJNR Am J Neuroradiology. Jan 2006. 27, pp. 26-34. Xu Jiaquan, M.D. Deaths: Final Data for 2007. 2010. Vol. 58, 19, pp. 1-136. Young Donald F., Munson Bruce R., Okiishi Theodore H. A brief introduction to fluid mechanics. John Wiley & Sons, Inc., 2004.
  

72
  

