Ryerson University

Digital Commons @ Ryerson
Physics Publications and Research Physics

2-1-2007

Two-Dimensional Velocity Estimation for Doppler Optical Coherence Tomography
Darren Morofke
Ryerson University

Michael C. Kolios
Ryerson University, mkolios@ryerson.ca

Victor XD Yang
Ryerson University

Follow this and additional works at: http://digitalcommons.ryerson.ca/physics Part of the Atomic, Molecular and Optical Physics Commons Recommended Citation
Morofke, Darren; Kolios, Michael C.; and Yang, Victor XD, "Two-Dimensional Velocity Estimation for Doppler Optical Coherence Tomography" (2007). Physics Publications and Research. Paper 7. http://digitalcommons.ryerson.ca/physics/7

This Conference Presentation is brought to you for free and open access by the Physics at Digital Commons @ Ryerson. It has been accepted for inclusion in Physics Publications and Research by an authorized administrator of Digital Commons @ Ryerson. For more information, please contact bcameron@ryerson.ca.

Two-Dimensional Velocity Estimation for Doppler Optical Coherence Tomography
Darren Morofkea,b,c , Michael C. Koliosa,b , Victor X.D. Yangb,d of Physics, Ryerson University, Toronto, Canada; of Electrical Engineering, Ryerson University, Toronto, Canada; c Dept. of Engineering Science, University of Oxford, United Kingdom; d Imaging Research, Sunnybrook Health Sciences Center, Toronto, Canada;
b Dept. a Dept.

ABSTRACT
In this paper we demonstrate a new algorithm for use in Doppler Optical Coherence Tomography (DOCT) to allow the detection of flow with a peak velocity of over 1.5 m/s. Previous Doppler estimation methods have utilized a transverse Kasai (TK) autocorrelation technique which computes the phase difference between points adjacent in time at the same spatial location, hereon referred to as transversely adjacent points. The maximum detectable TK velocity is low due to the small axial scanning frequency, fa which creates aliasing. To overcome the low sampling rate, we propose using data acquired in the axial direction which has a sampling rate orders of magnitude larger. Taking an autocorrelation in the depth, or axial direction, yields a quantity that can be related to the mean backscattered frequency. We demonstrate that through subtraction of the axial autocorrelation of a moving scatterer from that of a stationary scatterer at the same spatial location, one is able to obtain the Doppler shift with a much higher non-aliased limit. We have defined this method the axial Kasai (AK) technique. Through use of the AK, we demonstrate maximum non-aliased Dopler frequency estimate on a time domain DOCT system to be increased from the TK limit of ±4 kHz to the AK limit of ±1.6 MHz. In contrast to the high detection range of the AK, the TK maintains superior velocity resolution for low flow rates. Through a combined approach with the AK we have demonstrated a dynamic frequency range of over 100 dB with a velocity detection range from 10 µm/s to over 1.5 m/s. The velocity range has been extended to span both microcirculation and cardiac blood velocities. Keywords: Doppler optical coherence tomography, axial velocity estimation, Kasai velocity estimation

1. INTRODUCTION AND BACKGROUND
Optical Coherence Tomography (OCT) is a high-resolution, non-invasive technique to image subsurface tissue and tissue functions.1 Resolutions of 1-10 µm have been reported.2 OCT functions by emitting a broadband light source onto object and processing the backscattered photons via an interferometer. This signal is demodulated into inphase (I ) and quadrature (Q) components and then digitized. Doppler frequency shifts can be estimated in phase sensitive Doppler OCT systems3 (DOCT) in real-time. A Doppler shift is defined as change in frequency due to the a relative difference in velocities between a receiver and a transmitter. When applied to a moving scatterer and stationary transceiver, the backscattered Doppler shift is represented mathematically as, fD = 2vo nt cos, o (1)

where fD is the backscattered Doppler shift, vo is the velocity of the scatterer,  is the wavelength, nt is the index of refraction of the medium, and  is the Doppler angle defined by Figure 1. The Doppler frequency can be estimated through a transverse estimator which we refer to as the transverse Kasai4, 5 (TK). The TK detects a change in phase between transversely adjacent points at the same depth across multiple axial scans (a-scan) which are separated by time interval ta . The TK is computed as,
Send correspondence to Victor X.D. Yang at victor.yang@utoronto.ca and Michael C. Kolios at mkolios@ryerson.ca
Coherence Domain Optical Methods and Optical Coherence Tomography in Biomedicine XI edited by James G. Fujimoto, Joseph A. Izatt, Valery V. Tuchin Proc. of SPIE Vol. 6429, 64292F, (2007) · 1605-7422/07/$18 · doi: 10.1117/12.701372 Proc. of SPIE Vol. 6429 64292F-1

Figure 1. An example of the Doppler angle between a OCT probe and a capillary. In this figure  is the Doppler angle.

 M -1 N -2 fT K

 (2)

[Q(m, n)I (m, n + 1) - I (m, n)Q(m, n + 1)]    m=0 n=0  fa , arctan  =   M -1 N -2 2   [I (m, n)I (m, n + 1) + Q(m, n)Q(m, n + 1)]
m=0 n=0

where ftk is the TK estimated frequency, fa is the axial scanning frequency defined as 1/ta where ta is the time taken for one axial scan, I and Q are the inphase and quadrature demodulated signals, m and n are the respective indices, and M and N are the size of the window in the axial and transverse directions respectively. The arctangent function is evaluated in all four quadrants giving a result of ± . The the TK is then able to approximate the Doppler shift which can in turn be used for velocity estimation. From equation 2 it can be deduced that the maximum detectable frequency, before the first occurrence of aliasing, is fa /2. Time domain systems have been reported to have a-scan rates ranging from 8 to 15 kHz.3, 6, 7 On newer swept source systems the a-scan rate has been reported to be as high as 290 kHz8 which, with cos = 1 and nt = 1.33, gives a maximum velocity detection of 7 cm/s before aliasing. In order to extend the estimation range, phaseunwrapping9 techniques can be used. These techniques can extend the detection range until the separation between aliasing rings becomes smaller than the spatial resolution of the imaging system. Though the mm/s range of the TD systems is acceptable for microcirculatory imaging, there are applications that have higher velocity requirements, for example in the coronary vasculature. What we have proposed10 is a new method of analysis which allows the detection of an increased rate of flow on current generation Doppler OCT (DOCT) systems without need for hardware modification.

2. PROPOSED ALGORITHM
The maximum detectable velocity is determined by the wavelength of the light, refractive index of the medium, Doppler angle, and the time between samples or a-scan frequency. Since we have a fixed wavelength, set angle for in vivo applications, and a defined refraction index for the tissue; the sample time is the only dynamic variable. Increasing the a-scan rate is a technological challenge that is continuously being worked on. However, the sampling rate in the axial direction is orders of magnitude higher than fa . To take advantage of the fast sampling rate, we have proposed using a two dimensional (2D) approach through the use of an axial modification to the traditional Kasai estimation approach. A 2D approach has been previously applied to Doppler Ultrasound by Loupas5 et al, but this implementation was not used to detect flow. By taking the autocorrelation of the phase in the axial direction, Loupas estimated the mean backscattered carrier frequency as a means to correct for ultrasound frequency based attenuation, a significant problem in ultrasound, and thus better obtaining a more accurate estimate from a 2D TK. However, the physics of OCT allows the

Proc. of SPIE Vol. 6429 64292F-2

detection of a change in backscattered carrier frequency as attributed to motion. This has been shown in labratory settings by other groups through the use of the STFFT.11, 12 However, methods based on the STFFT are are computationally expensive and have very slow frame rates due to the number of points needed for estimation.11, 12 In contrast, autocorrelation methods can be performed in real time. We have proposed the axial Kasai10 (AK) as,  M -2 N -1 fAK  (3) [Q(m, n)I (m + 1, n) - I (m, n)Q(m + 1, n)]    m=0 n=0  fs  , arctan  M -2 N -1 =  2   [I (m, n)I (m + 1, n) + Q(m, n)Q(m + 1, n)]
m=0 n=0

where fAK is the estimated mean backscatter frequency and fs is the sampling rate. However, in contrast to the TK, to detect a Doppler shift due to motion with the AK, a background subtraction needs to be performed. Thus the Doppler frequency can be approximated by, fD fAKmoving - fAKstationary , (4)

where fAKmoving is the AK result for specific voxel containing scatterer's which are in motion and fAKstationary is the AK result for that same spatial location when no motion is present. Misalignments in the rapid scanning optical delayline (RSOD), wavelength dependent scattering and absorption, and non-linearity's in the demodulation process also contribute to a background axial phase change, even on stationary samples. Other groups have implemented similar techniques13, 14 but have not yielded the sensitivity, simplicity or the large dynamic range that we have obtained.

3. EXPERIMENTAL RESULTS 3.1. Equipment
Images were acquired using a time-domain DOCT system containing a 15 mW broadband light source centred at 1.3 µm with a 63 nm bandwidth. The system captured 512 axial points per axial scan depth of 1.1 mm. The axial scanning rate was fa = 8 kHz through a rapid-scanning optical delay (RSOD) line in the reference arm, which also contained a phase modulator for producing a carrier frequency of 4.3 MHz. The OCT signal was hardware demodulated and digitized at 10 MHz. The hardware demodulated I and Q signals were processed using the transverse Kasai (TK) and axial Kasai (AK) autocorrelation methods using different window sizes ranging from N = 2 to 128 and M = 2 to 128.

3.2. Flow Phantom Model
A flow phantom model was performed utilizing two different delivery methods: a gravity fed system, and an infusion pump delivering 1% Intralipid fluid to a glass capillary with 0.5 mm inner diameter. The infusion pump was able to set flow rates ranging from 0.1 mL/min to 200 mL/min, corresponding to peak center velocities of 290 µm/s to 57 cm/s. The length of the capillary was sufficient to alleviate entrance effects, and the Reynolds number was less than 2200 in all cases thus allowing laminar flow. It was assumed that the velocity profile would exhibit a parabolic profile with the peak center velocity being two times the mean velocity. Previously published results3 have demonstrated flow rate detection as low as 7 µm/s through use of the TK. To select an appropriate window size for the AK, a signal to noise ratio (SNR) analysis was performed on a moving flow phantom with a peak center velocity of 40 cm/s. This data set was analyzed through the center of the vessel, which was the point of peak velocity. A measure of the SNR of the AK estimate of standard deviation divided by the mean, was calculated across 8000 consecutive M-Mode a-scans. By changing the window size from N = 2 and M = 2 up to N = 128 and M = 128, an error versus window size was generated as seen in Figure 2. To ensure reliable results, we selected a maximum of 0.05. Note that on this figure the minimum number of points occurs to obtain this occurs when M=32 and N=32, or an area of 1024 points.

Proc. of SPIE Vol. 6429 64292F-3

Figure 2. SNR analysis. Standard deviation divided by the mean averaged over 8000 a-scans with varying window size in transverse (N) or axial (M) which correspond to the X and Y axis respectively.

In order to compensate for the background axial phase change, the phantom was imaged containing stationary Intralipid prior to imaging with flow. The result from the moving AK and the stationary AK was subtracting for visualization of the Doppler frequency. An example of a corrected M-mode AK image can be seen in Figure 3A using N = 32 and M = 32. Using a fixed flow rate images were acquired with two different Doppler angles which, when corrected for refraction, were 32 and 53 . The corresponding velocity versus depth profile after background subtraction, referred to hereon simply as the velocity profile, was plotted in Figure 3. This shows a consistent estimation of the velocity profile from two different angles. Finally, a 12 cm/s peak velocity phantom was analyzed, averaged over 20 a-scans, and plotted in figure 3C. Note the parabolic velocity profile occurs even with a small number of a-scans.

Figure 3. A) M-Mode image showing a Doppler shift of 350 kHz in a flow phantom Tube B) Axial Kasai velocity estimates from measurements at two different Doppler angles, corrected for the refractive index of the Intralipid. C) Velocity profile of a phantom experiment. Squares are the average of 20 A-scans. Red line is a parabolic fit of the data.

Dynamic range of the AK algorithm was tested by varying the flow rate over 157 different velocities corresponding to Doppler shifts ranging from a few Hz to 350 MHz. Due to phase instability in the OCT system that was used, the minimum detectable AK frequency shift was fairly large when compared to the detectable shift using the TK. However, the analyzed data10 demonstrated three distinct Doppler detection zones in which the TK, TK with unwrapping and AK were able to resolve the velocity information. Zone I could be resolved using the TK with and had a frequency range up to 4 kHz. Zone II ranged from 4 kHz up until 45 kHz and could be detected by unwrapping the aliased TK results. In Zone III the separation between the aliasing rings from the TK was smaller than the spatial resolution of the imaging system, making phase-unwrapping unreliable. However using the AK, one is able to visualize the Doppler shift from 45 kHz

Proc. of SPIE Vol. 6429 64292F-4

Figure 4. A) Structural M-Mode image of backscattered light intensity for a very high-flow rate - note that the signal is vanishing from the center of the tube due to the signal being outside of the bandwidth of the system. B) AK on high speed flow - note that the AK fails as the structural image disappears. The maximum frequency detected is 1.6 MHz which agrees with the calculated bandwidth of the system.

onward. Until Zone III, the AK was not able to accurately resolve the velocity information. To further investigate the limits of the detection range of the AK in Zone III, we performed a modification of the gravity fed system that involved the addition of a substantial amount of force. Due to the nature of the experimental setup, the flow could not be accurately estimated nor is the flow expected to be laminar. The M-Mode image for this experiment can be seen in Figure 4. As predicted, the AK was able to visualize a Doppler shift up until the system bandwidth of 1.6 MHz. However, note that both the structural M-Mode image, Figure 4A, which is the reflected intensity in dB and the AK M-Mode image, Figure 4B, have signal degradation in the center of the vessel due to the nature of the filters used in the signal processing. Based on the Doppler angle of 59 and the 1.6 MHz shift, this corresponds to a visualized velocity of 1.5 m/s. The variance3 of the TK was used to threshold the three regions.

3.3. Small Animal Model
In order to validate the practicality of the AK algorithm, it was utilized to image the aortic flow10 of a male fischer rate. The data was acquired using an in vivo endoscopic DOCT probe15 inserted through the esophagus. The procedures were performed in accordance with an institutionally approved animal utilization protocol. The endoscopic probe had an 82 Doppler angle which was used for velocity calculation. Using a combined AK+TK result, M-Mode images was generated10 that demonstrated the sensitivity to show aortic wall flexion upon the systolic crash as well visualization of non-aliased flow rates with a a peak velocity of over 1 m/s. This peak velocity is in good agreement with published literature for aortic flow velocities on sedated male fischer rats.16

4. CONCLUSIONS
Through phantom and in vivo experimentation, we have demonstrated that the AK is a viable method for detecting high flow rates using interferometric data. Using the three zone detection method, a time domain OCT system can now be used to image flow from the microcirculation and coronary vasculature in vivo, in real time, and with no additional hardware costs. A window size of N=M=32 was used and was found to be sufficient for this application. With an increase in the system bandwidth and sampling rate, the AK would be able to visualize aortic flow rates in a human patient.

4.1. Future Work
Prelimary data implies that the AK is a viable method for extending the flow detection rate on swept source systems as well. Since the a-scan rate is much higher on swept source systems, it is conceivable that there would only require a two-zone detection method with TK and AK frequency detection ranges overlapping.

Proc. of SPIE Vol. 6429 64292F-5

Furthermore, out preliminary data suggests that the stationary backscattered frequency changes observed with the AK partially due to scatterer size effects such (e.g. Rayleigh or Mie scattering). As such, we are currently investigating the AK as a method for realtime spectroscopic OCT.

ACKNOWLEDGMENTS
Support from the Canada Research Chairs program, Photonics Research Ontario and Canadian Institute of Health Research is acknowledged. We thank I. A. Vitkin, A. Mariampillai and B. Standish for their assistance.

REFERENCES
1. D. Huang, E.A.Swanson, C.P.Lin, J. S. Schuman, W. G. Stinson, W. Chang, M. R. Hee, T. Flotte, K. Gregory, C. A. Puliafito, and J. G. Fujimoto, "Optical coherence tomography," Science 254, pp. 1178­ 1181, 1991. 2. B. E. Bouma and G. J. Tearney, The Handbook of Optical Coherence Tomography, Marcel Dekker, Inc., New York, 2001. 3. V. X. D. Yang, M. Gordon, B. Qi, J. Pekar, S. Lo, E. Seng-Yue, A. Mok, B. Wilson, and I. A. Vitkin, "High speed, wide velocity dynamic range doppler optical coherence tomography (part i): System design, signal processing, and performance," Optics Express 11, pp. 794­809, 2003. 4. C. Kasai, K. Namekawa, A. Koyano, and R. Omoto, "Real-time two-dimensional blood flow imaging using an autocorrelation technique," IEEE Transactions on Ultrasonics SU-32, pp. 458­464, 1985. 5. T. Loupas, J. T. Powers, and R. W. Gill, "An axial velocity estimator for ultrasound blood flow imaging,based on a full evaluation of the doppler equation by means of atwo-dimensional autocorrelation approach," IEEE Transactions on Ultrasonics, Ferroelectrics, and Frequency Control 42, pp. 672­688, 1995. 6. Y. Zhao, Z. Chen, C. Saxer, S. Xiang, J. F. d. Boer, and J. S. Nelson, "Phase-resolved optical coherence tomography and optical doppler tomography for imaging blood flow in human skin with fast scanning speed and high velocity sensitivity," Optics Letters 25, pp. 114­116, 2000. 7. A. L. Oldenburg, J. J. Reynolds, D. L. Marks, and S. A. Boppart, "Fast-fourier-domain delay line for in vivo optical coherence tomography with a polygonal scanner," Applied Optics 42, pp. 4606­4611, 2003. 8. R. Huber, M. Wojtkowski, K. Taira, J. Fujimoto, and K. Hsu, "Amplified, frequency swept lasers for frequency domain reflectometry and oct imaging: design and scaling principles," Optics Express 13, pp. 3513­3528, 2005. 9. K. Qian, S. H. Soon, and S. A. Anand, "A simple phase unwrapping approach based on filtering by windowed fourier transform," Optics and Laser Technology 37, pp. 458­562, 2005. 10. D. Morofke, M. C. Kolios, I. A. Vitkin, and V. X. D. Yang, "Wide dynamic range detection of bi-directional flow in doppler oct using 2-dimensional kasai estimator," Optics Letters 32, p. 1, 2007. 11. X. J. Wang, T. E. Milner, Z. P. Chen, and J. S. Nelson, "Measurement of fluid-flow-velocity profile in turbid media by the use of optical doppler tomography," Applied Optics 36, pp. 144­149, 1997. 12. Z. Chen, T. E. Milner, D. Dave, and J. S. Nelson, "Optical doppler tomographic imaging of fluid flow velocity in highly scattering media," Optics Letters 22, pp. 64­66, 1997. 13. A. M. Rollins, S. Yazdanfar, J. K. Barton, and J. A. Izatt, "Real-time in vivo color doppler optical coherence tomography," Optics Letters 27, pp. 34­36, 2002. 14. A. W. Schaefer, J. J. Reynolds, D. L. Marks, and S. A. Boppart, "Real-time digital signal processing-based optical coherence tomography and doppler optical coherence tomography," IEEE Journal on Biomedical Engineering 51, pp. 186­190, 2004. 15. V. X. D. Yang, M. Gordon, S. j. Tang, N. Marcon, G. Gardiner, B. Qi, S. Bisland, E. Seng-Yue, S. Lo, J. Pekar, B. Wilson, and I. A. Vitkin, "High speed, wide velocity dynamic range doppler optical coherence tomography (part iii): in vivo endoscopic imaging of blood flow in the rat and human gastrointestinal tracts," Optics Express 11, pp. 2146­2424, 2003. 16. A. B. Driss, J. Benessiano, P. Poitevin, B. I. Levy, and J. B. Michel, "Arterial expansive remodeling induced by high flow rates," American Journal of Physiology - Heart and Circulatory Physiology 272, pp. 851­858, 1997.

Proc. of SPIE Vol. 6429 64292F-6

