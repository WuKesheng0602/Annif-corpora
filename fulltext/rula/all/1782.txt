Ryerson University

Digital Commons @ Ryerson
Theses and dissertations

1-1-2009

A Low-Cost AC-DC Rectifier For Variable-Speed Wind Energy Conversion Systems
Zhenhan. Luo
Ryerson University

Follow this and additional works at: http://digitalcommons.ryerson.ca/dissertations Part of the Electrical and Computer Engineering Commons Recommended Citation
Luo, Zhenhan., "A Low-Cost AC-DC Rectifier For Variable-Speed Wind Energy Conversion Systems" (2009). Theses and dissertations. Paper 1146.

This Thesis is brought to you for free and open access by Digital Commons @ Ryerson. It has been accepted for inclusion in Theses and dissertations by an authorized administrator of Digital Commons @ Ryerson. For more information, please contact bcameron@ryerson.ca.

~,....,

l

·

-

""'

'/

.

A LOW-COST A C-DC RECTIFIER FOR VARIABLESPEED WIND ENERGY CONVERSION SYSTEMS

by

Zhenhan Luo

BA, Harbin Institute of Technology, Harbin, China, 1994

A thesis presented to Ryerson University in partial fulfillment of the requirements for the degree of Master of Applied Science in the program of Electrical Engineering

Toronto, Canada
© Zhenhan Luo 2009
PROPC"~ OF RYERSON UftiVfM~TY LIMARV

I hereby declare that I am the sole author of this thesis or dissertation.

I authorize Ryerson University to lend this thesis or dissertation to other institutions or individuals for the purpose of scholarly research.

(Signature)

I further authorize Ryerson University to reproduce this thesis or dissertation by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

(Signature)

11

BORROWER'S PAGE
Ryerson University requires the signature of all persons using or photocopying this thesis. Please sign bellow. Name Address Date Signature

111

Abstract
Zhenhan Luo A Low-Cost AC-DC Rectifier for Variable-Speed Wind Energy Conversion Systems Electrical and Computer Engineering Master of Applied Science Ryerson University Toronto 2009

In the thesis, a novel AC-DC rectifier is adopted to convert the variable AC voltages from wind generator to a constant de-link voltage. A DC-AC inverter is used to transfer the energy to fixed ac grid as well as maintain the de link voltage constant. The rectifier is connected to the generator, which has two sets of three-phase windings. Electrical excited or permanent magnetic synchronous generators are suitable for this rectifier. The AC-DC rectifier features low cost, low power losses and simple control structure. The major content of this thesis consists of four parts. The first part investigates the operation of the AC-DC rectifier. The analysis illustrates the current paths in the rectifier and the remarkable voltage-boosting capability. A simulation model of the converter is built and verified. The second part models the synchronous generator with two sets of windings. The model is developed in the d-q synchronous reference frame. The simulation results from the model are verified by the experimental results. Then third part is the design of the control system, which involves the generator, the A C-DC rectifier and the constant de-link voltage source. The control system composites of the inner current loop and the outer speed loop. The control system achieves the variable-speed operation of the generator and the regulation of the de-link current. Finally, a prototype of wind turbine system is established in the lab to verify the analysis of rectifier, synchronous generator and control system design. The steady-state and transient responses of the wind system are compared. Simulation and experiment verify the analysis in this thesis.

IV

Acknowledgements

I would like to express my sincere gratitude to my supervising professor, Dr. Dewei Xu. Without his patient guidance and generous support, this thesis would not be achieved. University. I would also like to express deep appreciation to the candidates of PhD in LEDAR, Jiacheng Wang, Bing Gong and Moya Dai, for sharing their valuable trouble-shooting techniques and their friendships . I wish to share my achievements with my wife, Jing Liu, who provided me constant support and encouragement during my studying period. And special thanks to my son Tiger and my daughter Daisy for their love.
It has been my great pleasure to work as one of his students at Ryerson

v

TO MY PARENTS

Vl

Table of Contents

C h apt er 1 In t r od u cti on ...................................................................................... 1
1.1 Wind Energy ........................................................................................................................... 1 1.2 Operating Modes of Wind Turbine ....................................................................................... 2 1.3 Configuration of Wind Turbine System ............................................................................... 4 1.4 Wind Turbine Generator ....................................................................................................... 6 1.5 AC-DC-AC Converter ............................................................................................................ 8
1.5.1 Grid-Side Converter ........................................................................................................... 8 1.5.2 Generator-Side Converter .................................................................................................. 9

1.6 Motivation and Objectives in This Thesis .......................................................................... 11 1.7 Thesis Outline ........................................................................................................................ 12

Chapter 2 AC-DC Rectifier ................................................................................ 14
2.1. Introduction .......................................................................................................................... 14 2.2. Converter Operation ........................................................................................................... 15
2.2.1 Current Path Analysis ...................................................................................................... 15 2.2.2 Thyristor Conducting Angle ............................................................................................ 20

2.3. Analysis of AC-DC rectifier ................................................................................................ 22
2.3.1 Output Voltage without Effect of Source Impedance ...................................................... 22 2.3.2 Effect of Source Inductance ............................................................................................. 25 2.3.3 Equivalent Circuit for AC-DC rectifier ........................................................................... 29

2.4. Computer Simulation .......................................................................................................... 30 2.5. Conclusions ........................................................................................................................... 32

Chapter 3 Synchronous Generator.............................................................. 34
3.1. Introduction .......................................................................................................................... 34 3.2. Stator Winding Arrangement of Synchronous Generator .............................................. 34 3.3. Two-set 3-Phase Windings Synchronous Machine Model ............................................... 36
3.3.1. Voltage Equations in Machine Variables ....................................................................... 36

Vll

3.3.2. Synchronous Reference Frame ....................................................................................... 39 3.3.3. Stator Voltage Equations in Synchronous Reference Frame Variables .......................... 41 3.3.3.1. a-, b-and c-Phase Stator Voltage Equations ............................................................ 41 3.3.3.2. x-, y- and z-Phase Stator Voltage Equations ........................................................... 43 3.3.3.3. Rotor Voltage Equations .......................................................................................... 44 3.3.3.4 Torque Equations in Synchronous Reference-Frame Variables ............................... 44

3.4.

Computer Simulation and Experiment Results ........................................................... 46

3.4.1 Comparison when firing angle at 150° ............................................................................. 47 3.4.2 Experiment with Firing Angle at 0° ................................................................................. 49

3.5. Conclusions ........................................................................................................................... 52

Chapter 4 Control System Design ................................................................ 53
4.1. Introduction .......................................................................................................................... 53 4.2. MPPT Control of Wind Turbine ........................................................................................ 53 4.3. Controller Design ................................................................................................................. 55
4.3 .1 Equivalent Voltage Source .............................................................................................. 56 4.3.2. Design of The Current Loop ........................................................................................... 59 4.3.3. Design of the Speed Loop ............................................................................................... 66

4.4. Computer Simulation .......................................................................................................... 68 4.5. Conclusions ........................................................................................................................... 73

Chapter 5 Experimental Verification ........................................................ 74
5.1 Introduction ........................................................................................................................... 74 5.2 Experimental Setup .............................................................................................................. 74 5.3 Thyristor Gating Technique ................................................................................................ 77
5.3.1 Low-Pass Filter ..................................... ........ .. ................................................................. 77 5.3.2 Phase Angle Compensation .........·;................................................................................... 79

5.4 Experimental Test ................................................................................................................. 81
5.4.1 Steady-State Results ......................................................................................................... 82 5.4.2 Transient Response Test .................................................................................................. 84

5.5 Conclusion ............................................................................................................................. 88

Chapter 6 Conclusions ............................................................................................ 89
Vlll

6.1 Conclusions ............................................................................................................................ 89 6.2 Major Contributions ............................................................................................................. 90 6.3 Future Research Work ......................................................................................................... 91

References .......................................................................................................................... 92

Appendices ..................................................................................................................... 95
Appendix A: Simulation Blocks ................................................................................................. 95 Appendix B: DSP Program Code .............................................................................................. 99

IX

List of Figures

Figure 1.1 Cp versus /t ................................................................................................................... 2 Figure 1.2 Wind turbine output power and shaft speed .................................................................. 3 Figure 1.3 Conversion process from Mechanical Energy to Electrical Energy in wind turbine [4 ]4 Figure 1.4 VSCF wind turbine system configuration ..................................................................... 5 Figure 1.5 DC-AC converter (PWM VSI) ...................................................................................... 8 Figure 1.6 PWM boost converter system ...................................................................................... 10 Figure 1. 7 Single switching rectifier ............................................................................................. 10 Figure 1.8 Novel AC-DC rectifier for WECS .............................................................................. 11 Figure 2.1 Topology of the novel AC-DC rectifier ...................................................................... 14 Figure 2.2 AC-DC rectifier with a constant de current load ......................................................... 15 Figure 2.3 Waveforms of voltages: (a) van, v6n and vcn ; (b) vxn, vyn and vzn, (c) Vd 1 and (d) Vd 2 ............................................................................................................................................... 16 Figure 2.4 Current paths in section 1: (a) Thyristor I; is off; (b) Thyristor I; is on .................. 17 Figure 2.5 Current paths in Section 2: (a) Thyristor I; is off; (b) Thyristor I; is on .................. 17 Figure 2.6 Current paths in Section 3: (a) Thyristor I; is off; (b) Thyristor I; is on .................. 18 Figure 2.7 Current paths in Section 4: (a) Thyristor I; is off; (b) Thyristor I; is on ................... 18 Figure 2.8 Current paths in Section 5: (a) Thyristor I; is off; (b) Thyristor I; is on ......... .......... 18 Figure 2.9 Current paths in Section 6: (a) Thyristor I; is off; (b) Thyristor T2 is on ................. 19 Figure 2.10 Waveforms of output voltage when a

= 0 ............................................................... 20

Figure 2.11 Thyristors firing angle ............................................................................................... 21 Figure 2.12 Waveform of output voltage, when 0° <a< 30° ..................................................... 22 Figure 2.13 Waveform of output voltage, when 30° <a < 60° ................................................... 23 Figure 2.13 Waveform of output voltage, when 60° <a< 120° .................................................. 24 Figure 2.14 Waveform of output voltage, when 120° <a< 150° ................................................ 24 Figure 2.15 Plot of output voltage Vdo and firing angle a .......................................................... 25

X

Figure 2.16 Current commutation when two rectifiers are in parallel. ......................................... 26 Figure 2.17 Current commutation when two rectifiers are in series: (a) Phases are shorted through diodes; (b) Phases are shorted through thyristors .................................................... 28 Figure 2.18 Equivalent Circuit for AC-DC rectifier ................................................................... 29 Figure 2.19 Matlab simulation model ........................................................................................... 31 Figure 3.1 (a) 4-pole, 3-phase, wye-connected synchronous machine; (b) Winding arrangement for coils connected in series; (c) Winding arrangement for coils connected in parallel. ...... 35 Figure 3.2 3-phase voltages vabcs are displaced 180° with respect to voltages vxyzs .................... 36 Figure 3.3 4-pole, two-sets, 3 phases, wye-connected, synchronous machine without damping windings .................... ......................................... ... ... ... ............. ....... ... ................................... 37 Figure 3.4 Block diagram of simulation of synchronous machine in synchronous reference frame .................................................................... ............... ........ ........................... ................. ... ..... 45 Figure 3.5 Experiment setup for the machine model verification ............................ .................... 46 Figure 3.6 Waveforms of voltage Va 6 and Vxy when the firing angle is 150° : .......................... .... 47 Figure 3.7 Waveforms of voltage Van and Vxn when the firing angle is 150° : ............................ 48 Figure 3.8 Waveforms of current
fa

and

Ix

when the firing angle is 150° : .. .............................. 48

Figure 3.9 Waveform of voltage between two neutral points Vn . when the firing angle is 150° . 49 n Figure 3.10 Waveforms ofvoltage Va6 and Vxy when the firing angle is oo: ............................... 50 Figure 3.11 Waveforms ofvoltage Van and
~n

when the firing angle is 0° : .............................. 50

Figure 3.12 Waveforms of current I a and I x when the firing angle is 0° : .................................. 51 Figure 3.13 Waveform of voltage between two neutral points Vnn. when the firing angle is 0° .. 51 Figure 4.1 Wind turbine output power vs shaft speed .................................................................. 54 Figure 4.2 Cascade control structure ............................. ..................................................... .......... 55 Figure 4.3 Phasor diagrams: (a) No load condition; (b) 3-phase synchronous generator ............. 57 Figure 4.4 Equivalent voltage source ...................... ... ................................................................... 58 Figure 4.5 Equivalent circuit of the AC-DC rectifier ................................................................. 59 Figure 4.6 Block diagrams of current loop ................................................................................... 61 Figure 4. 7 Bode plots of transfer functions .................................................................................. 63

Xl

Figure 4.8 Bode plots with different firing angles (Alpha) .......................................................... 65 Figure 4.9 Block diagrams of the speed loop ............................................................................... 67 Figure 4.10 Block diagram of the control system ......................................................................... 68 Figure 4.11 Steady states with different rotor speed references ................................................... 70 Figure 4.12 Waveforms of control variables when generator decelerates .................................... 72 Figure 4.13 Waveforms of control variables when generator accelerates .................................... 72 Figure 5.1 Structure of prototype system ...................................................................................... 74 Figure 5.2 Prototype wind turbine system .................................................................................... 75 Figure 5.3 Block diagram of control implementation ................................................................... 76 Figure 5.4 Diagrams: (a) Analog Circuit; (b) Sallen-Key Filter................................................... 78 Figure 5.5 Phase angle and firing angle at different electrical speeds .......................................... 80 Figure 5.6 Phase voltage and current of generator when mr Figure 5. 7 Phase voltage and current of generator when mr
=

167rad Is : .................................. 82 : .................................. 82

= 128rad Is

Figure 5.8 Phase voltage and current of generator when mr = 87rad Is : ................................... 83 Figure 5.9 System transient responses when the speed reference steps from 167rad Is to
128rad Is: (a) Simulation results; (b) Experimental results ................................................ 85

Figure 5.10 System transient responses when the speed reference steps from 128rad Is to
87rad Is: (a) Simulation results; (b) Experimental results .................................................. 85

Figure 5.11 System transient responses when the speed reference steps up from 87rad Is to
128rad Is: (a) Simulation results; (b) Experimental results ................................................ 87

Figure 5.12 System transient responses when the speed reference steps up from128rad Is to
167rad Is: (a) Simulation results; (b) Experimental results ................................................ 87

Figure A -1 Simulation model of wind turbine system with MatlabiSimulink ............................. 95 Figure A-2 Simulation model of two-set three-phase windings synchronous generator. ............. 96 Figure A-3 Simulation model of thyristor gating ......................................................................... 97 Figure A-4 Simulation model of speed and current control loop ................................................. 98

Xll

List of Tables
Table 2.1 Simulation parameters .................................................................................................. 31 Table 2.2 Calculated and simulated Vd and Id with different firing angles ................................. 32 Table 3.1 Synchronous machine parameters ................................................................................ 46 Table 5.1 Power and control parameters of the synchronous machine ......................................... 75 Table 5.2 Rated parameters of the DC motor ............................................................................... 81 Table 5.3 Comparison of Simulation and Experimental results ................................................... 83

Xlll

List of Symbols
1. Wind Turbine Variables
~urbine p
vwind

Extracted wind power Air density Wind speed Turbine rotor radius Swiping area of turbine blade Turbine power coefficient Tip speed ratio

2. AC-DC Rectifier Variables
van'
VLL

Phase and line-to-line voltages Output de voltage without and with source inductance De voltage drop due to current commutation Output de current of rectifier Source inductance "Lossless" resistor due to current commutation Volt-radian area due to current commutation

vdo 'vd vd
Id
Ls

Ru Au

3. Synchronous Generator Model Variables
V,I,A
Matrix of voltages, currents and flux linkages Diagonal matrix of stator winding resistance Stator and rotor winding resistance
p
Lsfd Ls ,Lfd Lts 'Llfd

Rs

d Operatordt Mutual inductance between stator and rotor
Stat or and rotor magnetizing inductance Stator and rotor leakage inductance Transformation equation matrix Inverse transformation matrix

Ks
(KJ-1

XIV

Rotor angular displacement and angular speed Electromagnetic and mechanical torque
J
p

Machine inertia Number of the pole pairs ::: ;{
e - d ~)f
·

·1'

)-A ·

4. Control System Variables
Generator internal voltage Ideal switches Equivalent de inductance
fswi,min

J) -·:...

~

Air-gap magnetic motive force and induced voltage
w~ - ,.,,
·

~

;'';) t'
I)/~

/ ·
(

!'
J
r1

)

e)..--~~~. CRJ
/ 'J ·,:

-

/)re('c/ ;
tt.N/_)

t

I

Equivalent minimum switching frequency Crossover frequency Parameters of PI controller Rotor speed, electrical torque and de current references

I;_. f'J.t:lf'/ )&'

(·,, . . (' ,,

K p, Ki

w ;,I:*,1 ;

5. Low-Pass Filter Variables
Corner frequency in radls and Hz

Q
K
B(jw)

Quality factor Gain for pass band Phase angle of the transfer function

6. Experiment Variables
Generator output active power De-link power Shaft torque of the generator
1J
F

Efficiency of the DC motor Rotational coefficient

XV

Chapter 1 Introduction
1.1 Wind Energy
The demand for electrical power Increases 1n the world. Accompanying with that, the concern of environmental impact, such as natural resource exploitation, greenhouse emission and hazard nuclear waste, has been raised. Stimulated by the global warming, the whole world is seeking alternative energy sources to reduce the public stress on the environment. The potential alternative energy sources could be renewable energy sources, such as wind, solar, hydro, geothermal and tidal, which are naturally endless, environmentally friendly and domestic. Among them, in the past two decades, the wind energy has been developed progressively. However, wind power faces a severe challenge, which is its cost. Long-term growth of renewable energy sources should be market driven by providing an alternative clean source for consumers and through advanced technology and market development [ 1]. In order to compete with other conventional electrical powers in market, many advanced technologies of wind turbine blades, generators and operation methods have been applied in the wind industry to lower the cost of wind power. In America, over the last 20 years, the cost of electricity from utilityscale wind systems has dropped by more than 80%. Nowadays, state-of-the-art wind power plants can generate electricity for less than 5 US cents/kWh with the production tax credit. The National Renewable Energy Laboratory (NREL) is working with the wind industry to develop the next generation of wind turbine technology for generating electricity at even lower prices [2]. Wind power is always available domestically as long as there is wind. The advantage of wind energy cannot be achieved by conventional energy sources such as fossil fuels and nuclear. The endless cost-free wind power also implies that wind energy conversion system (WECS) will have relatively higher capital cost and significantly lower operation cost. In electrical engineering field, new technologies, such as power electronics, wind turbine generators (WTG) and new control algorithms for wind turbine operation, are contributed to reduce the over-all cost of wind turbine system and improve the efficiency of wind energy conversion. It can be foreseen that wind power is the most promising alternative energy source in the future.

1

1.2 Operating Modes of Wind Turbine
In existing wind energy conversion systems (WECS), two operating modes of wind turbine generators (WTG) have been developed. One is fixed-speed operating mode and the other is variable-speed operating mode. The determination of operating mode is based on the analysis of wind turbine aerodynamic characteristics. The aerodynamic power
~urbine

extracted by a wind turbine from wind is related to the power

coefficient and the cube of wind speed. The expression of ~urbine is shown in Equation ( 1.1)
~urbine =

2C

1

3 pp ~ V wind

=

2C

1

2 3 pptrrrotor V wind

(1.1)
rrotor

In the above equation, radius;
~

p

is the air density;

v wind

is the wind speed;

is the turbine rotor

is the swiping area of turbine blade; CP is the turbine power coefficient.

The power coefficient CPis a function of tip speed ratio 2 and turbine blade pitch angle

f3. For

reducing cost of control system and turbine design, normally, a small-scale wind turbine system does not contain a pitch angle control. While pitch angle

f3 is constant, the power coefficient

C P becomes only a function of tip speed ratio 2 . The tip speed ratio 2 is defined as

2
Where,

=

vtip vwind

=

rrotorOJrotor vwind

(1.2)

OJrotor

is turbine rotor angular velocity.

c

Figure 1.1 C P versus 2 Figure 1.1 shows the plot of power coefficient C P versus tip speed ratio 2 for a fixed-pitch wind turbine. At a certain wind speed, the maximum Cp,max can be obtained by the optimal 2 . Hence, the maximum power can be extracted from wind according to equation ( 1.1 ). Under fixed

2

speed operation, the maximum Cp ,max can only be achieved at one wind speed. It may be necessary to use pitch control of turbine blades to optimize performance, thus introducing additional mechanical control. Under variable speed operation, it is possible to maintain the optimal A at various wind speeds by regulating shaft speed of wind turbine generator (WTG). Hence, the maximum power is extracted from wind when wind speed is changing. Figure 1.2 illustrates turbine output power at different wind speeds under fixed-speed operation and variable-speed operation.

Turbine Power Characteristics (Pitch angle beta= 0 deg)

1.2

j
0
Q.

o.fij
s..~:::

~~ o~

0.8

.9-~ 0.6 ::7 E o_
c.E 0.4 :CE ... 0
~c .....
0 ::7
Q)

Variable Speed Operation

0.2 0 -0.2 0

.e:

0.2

0.4

0.6

0.8

1

1.2

1.4

Turbine speed (pu of nominal generator speed)

Figure 1.2 Wind turbine output power and shaft speed

Wind speed is highly variable in nature. The wind speed could change yearly, monthly, daily or over minutes. It has to be mentioned that the average of wind speed does not reflect the average power extracted by wind turbine. With identical average wind speed, wind turbine captures greater amount of energy over a period when wind speed has high fluctuation than when wind speed deviates very little. By considering the life span of wind turbine, over decades, the advantage of variable-speed operation is obvious.

3

For extracting maximum power from variable-speed wind, most modem WTGs are designed for variable-speed operation [3]. Compared with fixed-speed operating WTG, variable-speed operating WTG offers the advantages including: 1. It is more cost-effective by optimizing its output power for a larger wind speed range; 2. It reduces mechanical stresses in the drive train due to the capability of storing excessive energy of wind gusts in the mechanical system of the wind turbine; 3. It reduces audible noise when operating at low speed.

1.3 Configuration of Wind Turbine System
Typically, a wind turbine system consists of a wind turbine, generator, power electronics converter and grid connection circuit. The electrical part of wind turbine system becomes increasingly important in over-all system design. During the last two decades, various wind turbine concepts had been rapidly developed to offer both higher power density and lower price of electricity production. The different wind turbine configurations are shown in Figure 1.3 [4]. In Figure 1.3, power electronics converter has been referred to the general terms "Power Converter" or "PE converter".

I

Rotor

!I

I

Output

II

Figure 1.3 Conversion process from Mechanical Energy to Electrical Energy in wind turbine [4]

According to the types of drive trains, two configurations of WECS are classified into geardriven or direct-drive generation systems. A gearbox in the drive train of WECS introduces an
4

extra mechanical power loss and requires regular maintenance due to mechanical weanng. Hence, the application of gearbox can lower the over-all system efficiency and increase the system cost. Compared with the gear-driven wind turbines, the advantages of direct-driven wind turbines have simplified drive trains, the higher over-all efficiency, the higher reliability and the lower cost [5]. Since 1991, gearless generator systems, so-called direct-driven wind generators, have been implemented to reduce failures of gearboxes and to lower maintenance problems [6].

Generator Blade

Generator-Side Converter

Grid-Side converter

LC Filter

Figure 1.4 VSCF wind turbine system configuration

The combination of variable-speed operation and direct-drive train affects the configuration of generator and power converter, which will be detailed in the further part of this chapter. Figure 1.4 shows the typical configuration of a small-scale variable-speed constant-frequency (VSCF) wind turbine system where a voltage-source AC-DC-AC converter is used to interface the WTG to the electrical utility. The energy extracted from wind is transferred from the generator to the de-link by the generator-side rectifier and then to the utility by the grid-side inverter. In this type of systems, the de-link capacitor provides decoupling between the generator-side and the grid-side converters, and thereby offers separate control flexibilities for the two converters. This separation also allows the grid-side converter produce the constantmagnitude constant-frequency output voltage to the grid.
It can be observed in Figure 1.4 that the AC-DC-AC converter will handle the full rated

power of wind turbine system (WTS). The drawback of this configuration is that the power loss in power converter is high. Consequently, the high rating of devices in power converter results in a relatively high capital cost of over-all WTS.

5

1.4 Wind Turbine Generator
For the configuration shown in Figure 1.4, there are three most common types of electrical generator employed in WTS, such as conventional electrical excited synchronous generator (SG), permanent magnet synchronous generator and squirrel-cage or wound rotor induction generator (IG). Each type of generator has its unique operation characteristics. Hence, the design of power electronic and control scheme varies with respect to the specific type of generator.

· Induction Generators
Induction generators are generally classified into two categories, squirrel cage and wound rotor. Due to its robustness, low cost and low maintenance, induction generator has been popularly proposed in previous research and widely used in the commercial wind turbines. Especially, the squirrel cage induction generator has been recognized with its simple mechanical construction and occasional maintenance. In the earliest systems, squirrel cage induction generators driven by gearboxes are directly connected to the grid. This is known as Danish concept. The Danish concept has a very simple construction of the whole wind turbine with very low investment. Besides, it omits power converter or complex controller. The major disadvantage of the concept is the fixed-speed operation [7] and the usage of gearbox. Another major disadvantage of induction generator is the need for excitation of the magnetic field via the supply terminals. The magnetization reactance demands reactive current from the grid. Without the supply of reactive power, the induction generator cannot produce any active power. Under the variable-speed operation, a bidirectional power converter, which is commonly a back-to-hack converter, is required to interface the induction generator and the grid. This particular requirement increases the complexity of control and costs of over-all system.

· Wound Rotor Synchronous Generators
A wound rotor synchronous generator consists of a stator holding a set of three-phase windings, which supplies the external load, and a rotor that provides the source of magnetic field. The rotor is supplied from a direct current flowing in a wound field. The excitation provided by the de current in rotor implies that the synchronous generator do not require reactive power from

6

the grid. The quality allows the utilization of a unidirectional power rectifier, such as a diode rectifier. Hence, the control complexity and cost of power electronics can be reduced. The wound rotor synchronous generator offers some advantages. The efficiency of the generator is usually high, because that it employs the whole stator current for the electromagnetic torque production; the direct control of the power factor of generator is achievable [8]; in addition, the synchronous generator is capable to supply either inductive or capacitive reactive power to a load, and thereby offer the flexibility of terminal voltage control.

· Permanent Magnetic Synchronous Generators
Compared with a wound rotor synchronous generator, a permanent magnetic synchronous generator (PMSG) is excited by permanent magnet rather than de current. A larger pole number can be achieved by PMSG due to the application of permanent magnet, which allows small pole pitch [9]. The high pole number of PMSG results in the higher electrical frequency and terminal voltage, when PMSG operates at low speed in a direct-drive wind turbine system. With the improving performance and decreasing price of permanent magnet, PMSG draws increasing attention in wind turbine design. Most of advantages of PMSG are due to the permanent magnet excitation. Through eliminating losses caused by de current excitation, PMSG has a higher efficiency and reduces thermal problems on the rotor side. In addition, by omitting the maintenance of slip ring or bush, PMSG becomes more suitable for the offshore application of wind turbines. Furthermore, due to the poor conductivity of the permanent magnet, stator currents in PMSG only induce a negligible current on the surface of rotor. Hence, a better speed-voltage regulation can be achieved by PMSG. However, the design of PMSG has to take into account the demagnetization limit, which may be reached by too big stator current loading. The paper [9] shows that the danger of demagnetization decreases with increased pole numbers due to lower flux per pole. Corresponding to the trend of increasing PMSG application, National Renewable Energy Laboratory proposed a design of axial-flux, modular PMSG for wind turbine application [10]. The modular concept yields flexibility of PMSG configuration and is more suitable for the limited-quantity commercial application.

7

1.5 AC-DC-AC Converter
Numerous power converter topologies were presented in the literature for use in direct-drive variable-speed wind turbine systems. As seen in Figure 1.4, a typical structure of the power converter comprises a generator-side rectifier and a grid-side inverter connected through a delink, which is a capacitor as a voltage source. The generator-side converter rectifies the variablefrequency variable-magnitude generator terminal voltages into a constant de voltage. Then, the grid-side converter inverts the de voltage, and connects to the grid through LC filter and transformer. The de-link capacitor decouples the generator-side converter and the grid-side converter and, hence, offers flexibility of control of converter system. Owing to that, many solutions for AC-DC-AC converter were proposed in the previous research. The most popular and straightforward solution for AC-DC-AC converter in variable-speed wind turbines is the back-to-back two-level PWM voltage source converter (VSC) [5][11]. In order to improve the overall cost-efficiency, various alternative AC-DC-AC converters have been studied and proposed. An uncontrolled diode rectifier is frequently suggested as the generator-side converter. However, due to the lost control flexibility in the rectifier, the inverter has to provide control over the de stage to regulate the generator speed and it needs to be oversized to ensure proper power flow to the grid to accommodate low wind speeds, which significantly increases the overall cost. For solving this problem, a de-de boost converter is added between the diode rectifier and the grid-side converter.

1.5.1 Grid-Side Converter

Transformer LC Filter

PWM Inverter

Figure 1.5 DC-AC converter (PWM VSI)

8

In practice, a widely used scheme is to use a PWM voltage source inverter (VSI) as the gridside converter to maintain a constant de-link voltage [12], whereas the generator-side converter is responsible for generator speed or torque control. The PWM VSI is a converter through which the power flow is reversible. However, for extracting wind power, the power flow should be from the de-link to the grid, requiring an inverter mode of operation. Due to the fixed output voltage of VSI, for fulfilling this requirement, the de-link voltage has to be higher than the peak value of VSI output voltage. The different modulation algorithms result in different relationship between the VSI output voltage and the de-link voltage. With the sinusoidal pulse width modulation (SPWM), the maximum fundamental line-to-line voltage (rms), VSPWM max calculated by
VSPWM max
=
'

produced by the VSI can be

0.612Vd

(1.3)

In equation (1.3), Vd is the de-link voltage. The modulation technique known as third harmonic injection PWM can increase VSPWM max by 15.5%. By utilizing the space vector modulation scheme, the maximum fundamental line-to-line voltage (rms), VSVM max' produced by the VSI can be written as
VSVM max
= Q. 707Vd

(1.4)

Equations (1.3) and (1.4) indicate that the de-link voltage has to be maintained at a certain minimum value with which the PWM VSI can operate in the inverter mode. In other words, the generator-side converter should have capability to boost the de-link voltage when the generator operates at the low speed.

1.5.2 Generator-Side Converter
In order to achieve proper power flow control in the system, the de-link voltage has to be higher than the peak of the grid phase voltage. Due to this reason, two types of controlled rectifiers with voltage boost capability have been proposed for use as the generator-side converter in previous research works. The first one is a PWM AC-DC converter (rectifier) as shown in Fig.1.6 on which field oriented control (FOC) method can be implemented to control
9

the WTG [5], [12], [13]. The drawback of this solution is that the converter is too expensive when rated capacity of WTG is small. In addition, it generates high switching losses and increases complexity of control. An alternative PWM rectifier was proposed to reduce the cost and the control complexity by reducing six switches to four switches [14], but the DC-link voltage is doubled and the system stability is reduced.

PWM AC/DC Converter

Figure 1.6 PWM boost converter system

The second type of controlled rectifier is the combination of a three-phase diode front end in cascade with a controlled de-de converter. As shown in Figure 1. 7, the de-de converter can be a boost converter [15], or a buck-boost converter [16]. Hence, this combination is called single switching rectifier. This method requires one additional de-de converter to boost the DC-link voltage to the requested value at low wind speed. Though the switch is reduced to one, compared with the diode rectifier, the cost of the overall system is increased and the switching loss of the de-de converter is introduced. The overall efficiency of the converter is reduced as well.

+
-1

c
0

<(
...J

Diode Rectifier

Boost Converter

Figure 1. 7 Single switching rectifier
10

1.6 Motivation and Objectives in This Thesis
Based on the formal researches, the tendency of AC-DC rectifier design is to reduce the capital cost and the power losses. However, the proposed AC-DC rectifiers possess high switching losses, complexity of control and costly switches. The new design of AC-DC rectifier is needed to improve the overall cost-efficiency of wind energy conversion systems, especially for small wind energy conversion systems. This thesis adopts a new type of AC-DC rectifier for direct-driven variable-speed wind turbine systems, which was shown in Figure 1.8. The converter consists of two diode rectifiers and three thyristors. When the thyristers are on, two diode rectifiers are connected in series and when the thyristors are off, two diode rectifiers are connected in parallel. Thus, by controlling the firing angles of the thyristors, the de-link current can be controlled, and hence the generator speed can be regulated for variable-speed operation.

+

c
0

<C

..J

Figure 1.8 Novel A C-DC rectifier for WECS

By employing diodes and naturally commutated thyristors, the proposed rectifier topology features low cost, low power loss and high reliability. The converter requires two sets of 3-phase windings with 180° phase angle displacement. This demand can be fulfilled by reconfiguration of generator stator windings without extra cost. In addition, it seems that more devices are involved in the converter, but the rating of devices is only half of the converter rating. Compared with the previously proposed generator-side converter, the cost of the converter is significantly reduced. Furthermore, though the conducting losses cannot be avoided, the switching loss, in this AC-DC 11

rectifier, is absent due to that only current commutations occur during the operation. Besides, by adopting only diodes and thyristors, the over-heat and over-current capability of this rectifier is improved. Hence, the reliability is enhanced. Thus, the major objectives of this thesis are 1) To design and analyze the novel rectifier: A model of the AC-DC rectifier will be built to analyze the operation of the converter. 2) To obtain a two-set three-phase windings synchronous generator model: a conventional three-phase wound rotor synchronous machine will be converted into a two-set threephase windings synchronous generator. A model of the generator will be developed in dq synchronous reference frame. 3) To design a control system: a control system will be developed for the variable-speed operation of generator.

1.7 Thesis Outline
The thesis is organized in six chapters. Chapter 1 (this chapter) presents the background information about the small-, or middlescale direct-driven variable-speed wind turbine system. In addition, this chapter states the motivation and the objectives of this research. Chapter 2 analyzes of the novel AC-DC rectifier, which provides a high cost-efficient solution for a variable-speed WECS. In this chapter, the detailed information of the novel ACDC rectifier is presented. The content of this chapter includes the analysis of current paths, the arrangement of firing angle and the function of output de voltage. At the end of this chapter, a simulation model is developed to verify the analysis of the converter. Chapter 3 details the mathematical model of a two-set three-phase windings synchronous generator. In the chapter, a conventional three-phase wound rotor synchronous motor is converted into a two-set three-phase synchronous generator. First, the stator winding rearrangement is introduced. Following that, a machine model is established base on this reconfiguration to study the transient and steady state performance of the generator. The chapter is ended with the experimental verification of the machine model. Chapter 4 provides the detailed procedures of designing a feedback control system for the rectifier. The control system is design with a cascade structure: an inner current loop followed by
12

an outer speed loop. The control system has capability to achieve the speed control for the generator and to regulate the de-link current for protecting the system components. The simulation results are shown in the end of the chapter. In Chapter 5, first, a Sallen-Key low-pass filter is designed for thyristor gating. Next, a prototype of WECS is constructed for experimental purpose. The experimental platform introduced, and the experimental results are compared with the simulation. Finally, Chapter 6 draws conclusions of this thesis work. The major contributions and further research are introduced.
IS

13

Chapter 2 AC-DC Rectifier
2.1. Introduction
In small-scale wind turbine generator systems, an AC-DC-AC converter is the most commonly interface circuit to connect wind turbine generator to grid. This configuration allows wind turbine generator operate at variable speeds and extract maximum power from wind. In order to provide high quality electricity to grid, the DC-link voltage in AC-DC-AC converter has to be maintained higher than the peak value of DC-AC converter output voltage. Due to this reason, AC-DC rectifier is required to have capability to boost the DC-link voltage, when wind turbine generator operates at low speed. Compared with other AC-DC rectifiers proposed in previous research, the novel AC-DC rectifier studied here provides a higher cost-efficient solution for wind energy conversion systems.

yl!l.!+ n l_v;+

D~ ·~
ia

D2 ~

D3 ~

+

ib
ic

Jv
~

-~+

D4u

Ds ·~

D6 ~

r-- ,
~~

~.r
+~X.!!_

T2

r
Dg ~

/

vd

. D7 ·
IX

Ds ·~

I I I I 1-=;:=- !Load I I I I
-~

...

n

lv
'-7

I+:Ln
+~Z!!_

i~

i.
Dw ~

Dtt ~·

Dl2 .~

-

Figure 2.1 Topology of the novel AC-DC rectifier

The topology of the novel AC-DC rectifier is shown in Figure 2.1. The converter contains two three-phase, full-bridge diode rectifiers and three individual thyristors I;, I; and I;. The converter is fed by two sets of three-phase voltage sources, which have 180° electrical angle displacement to each other. With the assumption that the voltage sources are sin waves, as shown in Figure 2.1, the instantaneous voltages van, vbn, vcn, vxn, vyn and vzn can be expressed as

14

van vbn

J2v sin OJt = J2v sin(mt _3_;rr)
=

3

(2.1)

vcn

=

J2v sin( OJt + 3_ ;rr)
3

vxn

=

vyn
v zn

J2v sin(OJt + ;rr) = J2V sin( OJt + _!_ 1r)
3

(2.2)

= J2vsin(OJt-_!_;rr)

3

2.2. Converter Operation
2.2.1 Current Path Analysis

.
Yg_+
n

ia ib ic

: D2 : D,
~·

_vR+
_v~+
-~

·""'

fP l

! dl

...

!d
~~ l d2

+

-

.....,D4 ': D,

:n(, I ....

fN
Id vd

7;

~ · T2~

/_

r~ ~7;
D7 :DR : DCJ

.

+

fp'

+:..X!2_
n
+~!!....
+~Z!2_

ix iy iz..

-

v v

..

I

·:nn 1 N'
..: D _l2
....

... DIO

I

ld2

.. -

h / dl

-

Id

-

Figure 2.2 AC-DC rectifier with a constant de current load

The current paths in the AC-DC rectifier is analyzed with the assumption of the idealized circuit, in which the source inductance Ls is equal to zero and the de side is replaced by a constant de current Id. The converter in Figure 2.1 can be redrawn in Figure 2.2. The subscript 1

15

is used to denote the variables associated with the upper diode rectifier, which is fed by threephase voltages van, vbn and vcn; and the subscript 2 denotes the variables associated with the lower diode rectifier supplied by three-phase voltages vxn, vyn and vzn. In order to illustrate the A C-DC rectifier operation clearly, we can divide one cycle of voltage source waveforms into six sections, which are shown in Figure 2.3 (a) and (b). The six sections coincide with the six pulses in the instantaneous de voltage waveform, which is the output voltage waveform of the diode rectifier.

(a)

(b)

(c)

(d)

Figure 2.3 Waveforms of voltages: (a) van, vbn and vcn; (b) vxn, vyn and vzn, (c)

Vdt

and (d)

Vd 2

When the thyristors are off, the current I dt flows through one diode from the top group of diodes, D 1 , D 2 and D 3 , and one from the bottom group of diodes, D 4 , D 5 and D 6 · In the top group, the diode with its anode at the highest voltage potential will conduct due to the cathodes of the diodes are at a common voltage potential, and the other two are reversed biased. In the bottom group, the diode with its cathode at the lowest potential will conduct and the other two become reversed biased. Taking section 1 in Figure 2.3 (a) for example, the voltage VPn at the pointP with respect to the ac voltage neutral point n is equal to the phase voltage Van. Similarly,

16

The voltage

VNn

at the negative de terminal N is equal to the phase voltage

~n.

Therefore, the
VPn

output voltage vd1 is equal to the voltage vab. Since Id1 flows continuously, at any time,
VNn

and

can be obtained in terms of the source voltages

van '

vbn

and

vcn .

The instantaneous

waveform of Vd 1 consists of six segments per cycle of source frequency, and each segment belongs to one of six line-to-line voltages, as shown in Figure 2.3 (c). The similar rectification can be found in the lower diode rectifier. The instantaneous waveform of Vd 2 , which is the output de voltage of the lower diode rectifier, is shown in Figure 2.3 (d). Hence, two diode rectifiers maintain their own rectification separately and their output de voltages are in parallel on the AC-DC rectifier output terminals. Meanwhile, the load current Id is the sum of the current ld 1 and the current ld 2 · The current paths in the AC-DC rectifier are detailed in part (a) of Figures 2.4- 2.9.
I

p

cu;+

~~

J

~I

D,

D,

~

=tr

+

I

I I
')

IY'"+
D,

45

D,

I
vd (

v

n

(j -,:;,. ~+~'=~

...

D,

j
D,

D,

v

T

+D

Dl

D,
1

~
p

(b)

Figure 2.4 Current paths in section 1: (a) Thyristor T2 is off; (b) Thyristor T; 1s on.

I dl

=-I I d

p

~
~

Jv

~-f
u,

D,

o,

+

u,

~·

'--'---\
vd

____...._
D,

( D

o,
I

.j
n

~.
'1".
~

\
D~~
D,
I d2

D,

J
(a)

N.

'-I 2 d

(b)

Figure 2.5 Current paths in Section 2: (a) Thyristor I; is off; (b) Thyristor I; is on.

17

~--

-------..-+

p

DI
~.le!-

ut~-+

__)

o\

~

D,

-

-v:;j 1;-- 1),'

f~

-----1D,

\

vd

( :1

+~. v

D,

(

v
DIO

j'
D,
l

rl

l

- - --- _....,__

{b)

Figure 2.6 Current paths in Section 3: (a) Thyristor I; is off; (b) Thyristor I; is on.

DI

~ -~ v

[_v:;-;+
L

--, '
,---D, D, DrJ

p

------j_v
D,
D~

VJ

(~

T,

DJ
(

~·I

+--<

t"'

lvm
DIO

I

Ll

D.,
I

l -"-.:_
~~

_____../
{b)

Figure 2.7 Current paths in Section 4: (a) Thyristor

T; is off; (b) Thyristor T; is on.
p

dl -

- ---====-+

tI

DI lr~ _...------.,

D,

I v,.

':k+
L D,

J
D.;

'

n
II --~
N -

\

vd

( )

~;

D,

D~

t).»:

~t~·
DIO Dll D];
I

_ j
{b)

Figure 2.8 Current paths in Section 5: (a) Thyristor

T; is off; (b) Thyristor T; is on.

18

(b)

Figure 2.9 Current paths in Section 6: (a) Thyristor I; is off; (b) Thyristor I; is on.

The device of thyristor can be triggered into on state by applying a pulse of positive gate current when the thyristor is forward biased. Once the device begins to conduct, it is latched on and the gate current can be removed. The thyristor cannot be turned off by the gate, and the thyristor conducts as a diode. Only when the anode current tries to go negative, the thyristor turns off and the current goes to zero. In most of applications of thyristor, the thyristor is turned off by the influence of the circuit. This allows the gate to regain control in order to turn the device on at some controllable time after it is again forward biased. In the case of section 1, as shown in Figure 2.4 (a), the anode of the thyristor T2 has the same voltage potential with the point P and the cathode of the thyristor I; has the common potential with the node N. Then, the thyristor I; is forward biased by the converter output voltage Vd . Meanwhile, the thyristors T; and I; are reverse biased. It is worthy to notice that the diodes D 5 and D 8 will be reverse biased simultaneously when the thyristor T2 is triggered. As a result, the current path in the A C-DC rectifier is changed, as shown in Figure 2.4 (b). Thus, two diode rectifiers in the converter are in cascade. The converter output voltage Vd is equal to the sum of the voltage
Vd 1

and the voltage

Vd 2 ;

and the current I di and the current I dz are identical with the

current I d · The similar operations can be discovered in other sections, and the current paths are shown in part (b) of Figure 2.5-2.9.

19

2.2.2 Thyristor Conducting Angle

T,

on - ~

an - - - T ,

an- T,

on

Figure 2.10 Wave forms of output voltage when a

=

0

From the previous current paths analysis, the firing angle of thyristor can be arranged based on the following facts. Thyristor I; can be triggered in section 4 and section 5; thyristor T2 can be triggered in section 1 and section 6; thyristor I; can be triggered in section 2 and section3; when one thyristor is triggered, the other two are turned off by the influence of the circuit. At the instants of the beginning of section 4, section 6 and section 2, the line-to-line source voltages
~a, Vab

and

~c

are rising cross zero. Therefore, it is convenient to define the phase angles of and
~c

voltages

~a, V ab

zero at the instants and the firing angles of the thyristors I; , I; and I;

with respect to the instants respectively. At the beginning of section 2, as shown in Figure 2.5, the potential on the cathode of I; is lower than the potential on the cathode of T2 and the anode potential of I; is higher than the anode potential of I; . Hence, the thyristor I; can be triggered and the thyristor I; becomes reversed biased. The similar situations can be explained at the beginning of section 4 and section 6. Figure 2.10 shows the conducting durations of thyristors in one cycle of the source voltage frequency when the firing angle a is equal to zero. It can be observed that the AC-DC rectifier behaves as two diode rectifiers in cascade. Actually, this

20

commutation of thyristor occurs when the firing angle is less than 30° , and results on that each thyristor conducts 120° electrical angle.

Firing

range

150

Figure 2.11 Thyristors firing angle

For clear illustration, the thyristor I; conducting state is taken as the example to analyze the firing angle of thyristor. When 30° < a < 150° , once thyristor I; is triggered, it will keep conducting until
v bc

phase angle reaches 150° . At the instant, the converter output voltage,
v bc

which is the sum of the voltage voltage
vba

and the voltage v zy, is equal to the source line-to-line

in magnitude. After that, the diodes D 4 and D 7 are forward biased and begin

conducting. Consequently, the thyristor I; is reverse biased and turned off by the phase change of voltage source. Due to that, two diode rectifiers in the AC-DC rectifier operate in parallel, and the thyristor I; is ready to be triggered at the preferable instant. Figure 2.11 illustrates the relationship between the output voltage waveform and the firing angle between 30° and 150° . Thus, the range of firing angle is from 0° to 150° and the conducting angle of thyristor is still 120°.

21

2.3. Analysis of AC-DC rectifier
2.3.1 Output Voltage without Effect of Source Impedance
With the assumption that the source inductance Ls is equal to zero and the output de current 1s purely constant, there has no current commutation occurring in the converter operation. Consequently, the expression of the average output voltage
Vdo

is only varied with respect to the

change of the firing angle, where the subscription o is added due to the assumption Ls = 0 . For precisely predicting the operation of the converter, all of the available firing conditions are carefully studied in this section. The converter output voltage waveform repeats every thyristor conducting duration, 2TC I 3 radian per cycle, if the firing angle reminds the same in the steady state. To obtain the average value of the converter output de voltage, it is sufficient to consider only one of the conducting duration of thyristor and obtain its average over a 2TC I 3 radian interval. The time origin t = 0 for integrating can be chosen arbitrarily, while the value of volt-second area during any 2TC I 3 radian interval must be identical in one output voltage waveform. In the following, line-to-line source voltage.
VLL

is the

v

OJ!

a

Figure 2.12 Waveform of output voltage, when 0° < a < 30°

When 0° < a < 30° , the output average de voltage is

22

vdo

=

I
Jr

It ../2
-6
2

VLL

sin Md ( wt) -

_2_
2tr

r ../2
2

VLL

sin wtd (wt) (2.3)

= 2.70VLL

-1.35VLL(l-cosa)

= 1.35VLL COS a+ 1.35VLL

v

wt

a

Figure 2.13 Waveform of output voltage, when 30° <a< 60°

When 30° < a < 60° , the output average de voltage is

Vdo

=

_2_[ ~+~1r J2VLL sin wtd(wt) + Ja+-ll" ITll"l 2J2VLL sin wtd(wt) + ~ll" 2J2VLL sin Wtd(wt)] 2tr J.!_ll" J.!_ll"
2 3 3

(2.4)

= 0.675VLL COS( a+- tr) + 2.52VLL
3

1

23

v

wt

a

Figure 2.13 Waveform of output voltage, when 60° <a < 120°

When 60° < a < 120° , the output average de voltage is

= =

2_[ Q· J2vLL
2K
2

sinmtd(mt) +

£hvu sinmtd(mt) + t 2J2Vu sinmtd(mt)J
3

(2.5)

0.675VLL

COS a+ 1.84VLL

v

wt

a

Figure 2.14 Waveform of output voltage, when 120° <a< 150°

24

When 120° < a < 150° , the output average de voltage is

= - [ QJ2vLL sin wtd(wt) +
2Jr
2

3

2ff

f

2ff

J2vLL sin mtd(mt) +

h J2vLL sin mtd(mt)
3 3

-~

3

5

+ fff 2J2vLL sin mtd(mt)]

(2.6)
1

= l.35Vu cos a- 0.675 cos( a --1r) + 2.52VLL
3

Figure 2.15 plots the relationship between the percentage of output voltage Vdo with respect to the line-to-line voltage VLL, which is expressed as Vdo x 100%, and the firing angle a . If the
VLL

output de voltage is a function of the firing angle, the curve in Figure 2.15 shows that the function is continuous over the range of firing angle.

300 ~------~--------~----------------~------~

;e

~ 252

~270~--=·· ······ · ······~·············· ·· · ·· ·· ·· · ·· · · · · -~ ·- · ·· · · · · ·········· · ··· ··· · · ····· ··· ··· ·· ······· ··· · ·············· ~- ---········ · ·· · ·· ····· ·· · ···· -~

~

-----

218r- - -----··_ ·_ ·_ ·_ ·_ -__ ·_ · _-__· __ ·_ · _·_·_·_· _·_-_. .,., _.__-__

~~~-:: .:.· : · .: .: :_· _ : _· :~:~-~-~--: .: : · _·: : .: : :.:_·_: .: : : :_· _: .:
..

···: ___ ·: : ..:.:::::.·:.:.: . . :,.:_ · _::_· _::::: _ · _: __ · : .. ::: .· : ___ ·::

~200r············· ······-········ ··'···--·····························' -~ ---········-~-~ :············································'········ ·· ·····················-~

~ l
,._
:::s 0

~~~ r--········· · ·················· ·-:· ···· · ····························: · -····· · ··············· · ·· ·· ·· ······························ ..,.._~~ -

~

· · ··· ·· · · · · -

~100r-················ ····· ········ -+································lf··································································ll······························-~

E c
~ A.
41 41

41

30

60
Firing Angle Alpha (degree)

120

150

Figure 2.15 Plot of output voltage Vdo and firing angle a

2.3.2 Effect of Source Inductance
In practice, the current commutations will not be instantaneous in the converter due to the source inductance Ls . The average de voltage Vd will drop in presence of these finite

25

commutation intervals, u . There are various types of current commutation associated with the different firing angles during the converter operation, and they are different from each other.

--...L.t- ~J-d.....1.'-=><=---i a ___ ib .;:o~.'-~-Jd--lt~-.....
0

{JJ(

(b)

u

(a)

(c)

Figure 2.16 Current commutation when two rectifiers are in parallel

Figure 2.16 shows current commutation from section 2 to section3, when two diode rectifiers in the converter operate in parallel. Consider the commutation of current from diode D, to diode
D 2 in the upper diode rectifier, beginning at OJt = 0 (the time origin is chosen arbitrarily). Prior to

this, the current I dt is flowing through diode D, . The sub-circuit pertinent to this current commutation is shown in Figure 2.16 (a). In the upper diode rectifier, the current commutation only involves phase a and b , and the commutation voltage responsible is vcom =van - vbn. The commutation current iu flows due to a short-circuit path provided by the conducting diode D 1 · As shown in Figure 2.16 (b), the phase current
ib

builds up form zero to I dt

,

which is half of the de current I d

,

at the end of the

commutation interval OJt = u . The phase current can be expressed as

(2.7) (2.8)

In the circuit of Figure 2.15 (a),

26

v v

La Lb

- L dia- -L diu s dt s dt
= L
s

(2.9)

dib = L diu dt s dt

(2.10)

Applying Kirchhoff Voltage Law in the commutation current loop in the upper diode rectifier and using the above equations yield

diu Vcom = Vbn - Van = VLb - VLa = 2Ls dt

(2.11)

Therefore from the above equation,

L diu = vbn -van s dt 2

(2.12)

During the commutation interval 0 < mt < u in Figure 2.15 (c), where m ts the source voltage electrical angular speed. By using equation (2.12), we have

di = vbn +van V = V _ L _u Pn bn s dt 2

(2.13)

The integral of the voltage drop is the area Au,. By using equations (2.12) and (2.13), Au, can be expressed as

Au!

=
=

(j)

r r
.b
1

(vbn- VPn)d(mt) vbn ; van dt diu dt dt
(2.14)

=

(j)

rf L
s ld

=

mLs .b f2 diu
2

= -mLsld

27

n

_

VbnS:-

+

c=;:
V Lb

-

ib

+

+

- vc" +

Ls

+Vzn DIO
n

iu :

;:
(a)

n

N

(b)

Figure 2.17 Current commutation when two rectifiers are in series: (a) Phases are shorted through diodes; (b) Phases are shorted through thyristors.

Figure 2.17 (a) shows current commutation from section 2 to section3, when two diode rectifiers operate in series and the commutation current flows through diodes. Figure 2.16 (b) shows current commutation from section 3 to section4, when two diode rectifiers operate in series and the commutation current flows through thyristors. In the above two conditions, the converter output voltage is generated by two times of line-to-line source voltage. It can be equivalent with the situation that two times of phase voltages are shorted through two times of source inductance Ls in each phase. Besides, the phase current builds up form zero to the current
Id
.

The reduction in volt-radian area caused by the natural current commutations can be

expressed as (2.15) When the firing angle is between 30° and 150°, turning on thyristors will not cause phases shortage through source inductance Ls , but the phase current will increase from _!_Id to I d · The
2

reduction in volt-radian area is written as

Au3 =

r

4vLsd(mt) = 4mLS

t
2

diu = 2mLsid
vbc

(2.16)

At the instant where the phase angle of voltage

is 150°, as shown in Figure 2.14, two

diode rectifiers in the converter naturally convert from operating in series to operating in parallel. The current commutation involves phases a and c in the upper diode rectifier, and the current in

28

phase a tends to increase from zero to _!_ Jd. This will result on a reduction in volt-radian area. 2 Meanwhile, the current in phase b decreases Jd to _!_ Jd, which will cause an increase in volt2 radian area. If we assume the current changing rate of increasing is the same as the one of decreasing, there will be no volt-radian area change in this interval. Therefore, the drop of the converter de output voltage varies with different firing angles. The value of voltage drop is determined by various combinations of three types of reductions in voltradian area, which are discussed above. The detailed calculation is demonstrated in the following section.

2.3.3 Equivalent Circuit for AC-DC rectifier
According to the prevtous analysis, it is capable to establish a model for the AC-DC

rectifier. As shown in Figure 2.18, Vdo is the output de voltage of the converter with source
inductance Ls = 0 ; Vd is the output de voltage of the converter with finite source inductance; Ru is a "lossless" resistor to represent the voltage drop due to current commutation; k is the coefficient associated with relative firing angle;
~ Vd

is the voltage drop across the resistor Ru .

Hence, the AC-DC rectifier can be modeled as a de voltage source with an equivalent internal resistance.

+
R
u

=

k

OJLS
1r

+

Figure 2.18 Equivalent Circuit for AC-DC rectifier

29

When 0° < a < 30° , 3 3 60JLs flVd =-(Au 2 +Au 2 ) =-(4wLsld) =--Jd 2tr 2tr
1r

(2.17) (2.18)

6 Vd = 1.35VLL COS a+ 1.35VLL- 0JLs ]d
1r

When 30° < a < 60° , (2.19) (2.20)

When 60° <a< 120° ,
flVd = -(Au3 + Au 1) = -(-OJLsfd) = Vd = 0.675VLL
COS a+ 1.94VLL-

3 2tr

3 5 2tr 2

150JLs

4tr

Jd

(2.21) (2.22)

150JLs

4tr

]d

When 120° <a< 150°, 3 3 90JLs flVd =-(~ 2 +2Au 1 ) =-(3wLsld) =--]d 2tr 2tr 2tr
1 90JLs Vd =1.35VLL cosa-0.675cos(a--tr)+2.52VLL ---Jd

(2.23) (2.24)

3

2tr

2.4. Computer Simulation
A Matlab simulation is established to verify the AC-DC rectifier model, as shown in Figure 2.19. In the simulation, the AC-DC rectifier is connected to a load resistor R1oad in series with a capacitor Cd . Hence, the average de current I d and the de voltage Vd can be obtained with various firing angles. The parameters, which are used in the simulation model, are shown Table 2.1, and the calculated results and the simulated results are compared in Table 2.2.

30

fontinuou}
potrJtrgui

01

~~

ll02

03

+-& ~~
V2

:~----+----+-----' ~--------_,------+------+~
RL2

Figure 2.19 Matlab simulation model

Table 2.1 Simulation parameters Voltage source inductance:
L s =43x10-3 H

Line-to-line source voltage: VLL = 300V

Converter load resistor:

Rtoad

= 400

Voltage source frequency:

f

= 60Hz

Converter load capacitor: Cd = 2200 J-LF

31

Table 2.2 Calculated and simulated Vd and I d with different firing angles

a
Firing angle
Vd(V)

oo
456.6

10°

45°

100°

150°

449.7

396.7

369.6

339.2

Calculated
Vd(V)

456.3 Simulated
ld(A)

455.0

410

347

352

11.4 Calculated
ld(A)

11.2

9.9

9.24

8.5

11.4 Simulated

11.4

10.3

8.7

8.8

The calculation of the voltage drop is based on some assumptions such as the constant de output current, and the constant current changing rate. In the simulation, we can discover that neither of them is true. When the current ripple is bigger, the calculated result deviates further from the simulated result.

2.5. Conclusions
The main circuit of the converter consists of two diode rectifiers and three thyristors. The conducting of the thyristors forces the diode rectifiers convert from operating in parallel to operating in cascade. In this chapter, the detail analysis of converter operation is illustrated with current paths, followed by theoretical analysis of ideal de voltage and source impedance. Simulation model is constructed to verify the results. By properly control the firing angle of the thyristors, the converter output voltage can be changed accordingly. Thus, the energy from supply to de link can be controlled by controlling the firing angle. In the analysis, constant de current (in current continuous mode) is assumed. When the converter is connected to a constant de voltage source, the assumption may not be valid when the 32

de current discontinuous. The formulas of predicting de voltage/current are limited. In wind applications, the synchronous machines usually have large source impedance, which results in continuous current mode at most cases. In wind turbine systems, the rectifier is connected to wind generator. The non-sinusoidal current causes torque ripple in the generator. The ripple, which reduces the life of shaft connecting turbine and generator, is often a concern for large-scale turbines. To reduce the ripple, filters are needed at generator side.

33

Chapter 3 Synchronous Generator
3.1. Introduction
The novel AC-DC rectifier proposed in Chapter 2 requires two sets of 3-phase power supply with 180° electrical angle displacement to each other. In order to fulfill this requirement in wind turbine systems, there are two solutions. One is employing two generators in one wind turbine system, in which two generators are mechanically interlocked; the alternative solution is supplying the converter with a two-set of 3-phase windings, which is similar to a 6-phase generator. In this thesis, the later solution is adopted to improve overall cost-efficiency of a small-scale wind turbine system. In the beginning of this chapter, winding arrangement of a 4-pole machine is introduced. Next, the model of a two-set 3-phase windings synchronous machine is established on synchronous reference frame. At the end, the model is verified by experimental results and conclusions are drawn.

3.2. Stator Winding Arrangement of Synchronous Generator
The stator windings of the synchronous machine are embedded in slots around the inside circumference of the machine stationary member. Figure 3.1 (a) shows the cross-section view of a 4-pole, 3-phase, wye-connected synchronous machine. In the 4-pole machine, each phase winding contains two coils; and each coil, which can be as , bs, cs , xs , ys or zs , is displaced
60° with respect to each other along the stator circumference. The field or fd windings are

wound on the rotating member of the machine. It is assumed that each coil sprays 90° of the stator circumference for a 4-pole machine. One side of the coil is represented by a
(8)

indicating

that the assumed positive direction of current is down the length of the stator (into the paper). The 0 indicates that the current direction is out of the paper. The as, bs, cs, xs, ys, zs, fd1 and fd3 axes denote the positive direction of the flux produced by current flowing in each of the coils. The induced voltages vas and vxs in coil as and xs , respectively, are identical if each coil

34

has the same inductance and resistance. The similar conditions can be discovered on coils bs and
ys , and coils cs and zs .

bs axis

~
ys axJS zs zs axis

+

(a)

(b)

(c)

Figure 3.1 (a) 4-pole, 3-phase, wye-connected synchronous machine; (b) Winding arrangement for coils connected in series; (c) Winding arrangement for coils connected in parallel

The two coils in each stator winding can be connected in series or in parallel according to the different requirements of the machine operation. For the series coil connection, in the case of the phase a winding, positive current flows in the coil side as and back at the coil side as' , then renters the stator through the coil side xs and comes out at the coil side xs'. The b and c windings are arranged similarly, and the coil sides xs', ys' and zs' are connected together to form a wye-connected stator, as shown in Figure 3.1 (b). Higher terminal voltages can be obtained through this connection. For the parallel coil connection, in the case of the phase a winding, the coil sides as and xs are connected together, and the coil sides as' and xs' are connected together too. The b and c windings are arranged similarly, and the coil sides as' ,
bs', cs' , xs', ys' and zs' are connected together to form a wye-connected stator, as illustrated in

Figure 3.1 (c). This connection results on lower terminal voltages but higher stator currents. The parallel coil connection gives the hint how to obtain two sets of 3-phase, wye-connected stators through the reconfiguration of the stator coils. The coils as , bs and cs can be configured to be one set of 3-phase stator windings by connecting the coil sides as' , bs' and cs' together,

35

and the coils xs , ys and zs are set to form another set of 3-phase stator windings by connecting the coil sides xs , ys and zs together. These two sets of winding are completely separated in connection by two neutral points, as shown in Figure 3.2. It is easily observed that the 3-phase voltages
v xyzs

have 180° electrical angle displacement with respect to the 3-phase voltages

v abcs .

Thus, through this winding configuration, we can have two sets of 3-phase voltage sources to fulfill the requirement of the AC-DC rectifier operation.

Figure 3.2 3-phase voltages

v abcs

are displaced 180° with respect to voltages

v xyzs

3.3. Two-set 3-Phase Windings Synchronous Machine Model
In this section, a model of two-set windings, 4-pole, 3-phase, wye-connected synchronous machine will be established. The analysis given in this section is valid for a linear magnetic system; saturation and salient effect are not considered. Furthermore, the flux linkages of stator windings are assumed ideally coupled.

3.3.1. Voltage Equations in Machine Variables
The synchronous machine is shown in Figure 3.3. The stator windings are identical and sinusoidally distributed with leakage inductance L1s , magnetizing inductance Ls , and resistance

"s . The rotor is equipped with a field winding and no damping windings. The field winding ( fd
winding) has leakage inductance
Llfd ,

magnetizing inductance

L fd ,

and resistance r1d .

36

cs

axis

bs'

bs

axis

as

ys

axis

zs

ys

zs

axis

Figure 3.3 4-pole, two-sets, 3 phases, wye-connected, synchronous machine without damping windings

The magnetic axes of stator windings in Figure 3.3 are denoted by the as, bs, cs, xs, ys and
zs axes. The direction of positive stator currents in windings as , bs and cs is assumed out of the

terminals of the machine for describing the generator operation. Consequently, xs, ys and zs currents flow into the terminals of the machine. In addition, the positive direction of magnetic axes is opposite to the positive direction of flux linkages created by the positive stator currents. The quadrature axis ( q axis) and direct axis ( d axis) are also introduced in Figure 3.3. The 37

xs winding is 360° electrical angle lagging with respect to the as winding. The 180° electrical

angle displacement between terminal voltages vas and vxs is achieved by the means of terminal connection, as shown in Figure 3.3. With the assumptions above, the voltage equations in machine variables can be expressed in matrix form corresponding to the winding connection as [ 17]

(3.1)

Vxyzs -RI s xyzs -pA xyzs

(3.2) (3.3)

Where

Fa~cs

=

[fas

hs

fcs]

(3.4) (3.5)

Rs = diag [ rs rs ~ ]

The matrix F can be the matrix of voltages V , currents I and flux linkages A . The abcs and xyzs subscripts denote variables associated with the abc and xyz stator windings. The matrix Rs is the diagonal matrix of the stator winding resistance rs . The symbol p denotes the

d operator-. dt
Also, the s and r subscripts denote variables associated with the stator and rotor windings respectively.
L sfd

is the mutual inductance between the stator winding and the field winding.

Hence, flux linkage equations become

-Ls12 Ls22 -(Lsr)T

[

=~abc '] xyzs
ifd

(3.6)

Where,

38

Lis +Ls --L 2 s
L s ll

1

--L 2 s
1 (3.7)

1

=

--L 2 s --L 2 s
1

1

Lis +Ls --L 2 s --L 2 s
1

Lis +Ls

Ls
L s l2

--L --L 2 s 2 s Ls
1

1

1

=

--L 2 s
1

1

--L 2 s Ls

1

(3.8)

--L --L 2 s 2 s

Lsfd sin2Br
2 L, = L,1d sin(2B, - ; )
L ifd

(3.9)

2 sin(2B, + ; )

(3.10) (3.11)

3.3.2. Synchronous Reference Frame
Choosing reference frame is usually used in analysis of ac machines to eliminate timevarying inductances. In order to study the transient and dynamic stability of the synchronous machine, all the variables of the synchronous machine are represented in a rotating reference frame. The rotating
sp~ed

can be either the rotor speed or the synchronous speed. For the study

of a 4-pole synchronous machine, it is convenient to use the synchronous reference frame. In the two-set winding machine, there are six independent variables due to the existing six phases. These six phases are divided into two groups of three phases by two neutral points. Therefore, the transformation of variables in the machine can be achieved in three-dimension

39

vector space, and flux linkages among the stator windings and the field winding must be taken into account. Hence, the change of variables, which transforms variables of machine stationary circuit elements to the synchronous reference frame, may be expressed as

Fqd! = Ks!Fabcs Fqd2 =Ks2 Fxyzs
Where

(3.12) (3.13)

pab Tcs -

[.fas

hs

fcs]

(3.14) (3.15)

Fx~zs = [fxs f ys
Fq:
=

fzs]
Jr

[fq f d]
=

3_[ cos2B,
3 sin2Br

cos2(Br sin2(Br -

Ks!

3

)

cos2(Br -3)
2ff 2 sin 2(B, - ;)

~)
2tr

=

3_[ cos2B,
3 stn2 . er

cos(2Br -

3

)

cos(2Br +3)
2ff 2 sin(2B, + ; )

2 sin(2B, - ; )

l l
~)

(3.16)

(3.17)

=

3_ [cos 2( B, 3

ff)

4tr cos2(Br -3) cos 2( B, +

Ks2

sin 2(Br - tr)

. 4~r) stn2( 8r -3
2tr

sin2(Br +~)

l
(3.18) (3.19)

=

3_[ cos 2B,
3 stn2 . er

cos(2Br -3) cos(2Br +3)
2 sin(2B, - ;)
2ff 2 sin(2B, + ; )

l

(j)=

d(2Br) =2mr dt

The subscripts 1 and 2 are used to denote variables associated with the stator windings
abc and xyz ' respectively. (j) is the synchronous speed, (j)r is the rotor angular speed, and er is

the angle between the q -axis and

as- axis . From equations (3 .17) and (3 .18), the
40

transformation equations Ks1 and Ks2 are identical. For reducing the complexity, the symbol Ks will be used to replace them in the future writing.
It can be shown that for the inverse transformation we have

COS 2{)r

sin 2Br
Sill

(KJ-' = cos(2Br -

) 3 2tr cos(2Br +3)

2tr

. ( () 2tr 2 r -3)

(3.20)

2 sin(2B, + ; )

3.3.3. Stator Voltage Equations in Synchronous Reference Frame Variables 3.3.3.1. a-, b- and c-Phase Stator Voltage Equations
Voltage equations in synchronous-reference frame can be expressed as

Vqdl

= =

K sVabcs -RsKsJabcs + KspAabcs
(3 .21)

= -RsKsJabcs + Ksp[(KJ-! Aqd!]
= =

-RsK sl abcs +Ksp[(Ksr'JAqd! +KJ(Ksr'JpAqd! -Rsl qdl + wAdqi + pAqdi

Where,

R,

=[ ~ ~l
1

(3.22)

K sp(KJ _ = w [

-1

o 1] 0

(3.23)

(3.24) Flux linkage equations in synchronous reference frame can be expressed as

41

(3.25)

After careful calculation, we can have

Lis +-Ls
K s Ls ll (Ks )- 1 = [ 0 2 (3.26)

3

K L
s

s12

(K )-1 = 2
s

[

~L
s

(3.27)

0

(3.28)

Equations, (3 .21) and (3 .25), can be written in the expanded form as (3.29) (3.30) (3.31)

(3.32)

42

3.3.3.2. x-, y- and z-Phase Stator Voltage Equations
Voltage equations in synchronous-reference frame can be expressed as

~d2

=KV s xyzs

= RsK sJxyzs - K r2 PAxyzs
=

RsKsJxyzs - Ksp[(KJ- ]A qdJ RsKsl xyzs - Ksp[(KJ- ]Aqd2 - KJ(KJ- ]pAqdt Rsl qd2 - (j)Adq2 - pAq d2
1

(3.33)
1

= =

Where, (3.34)

Flux linkage equations in synchronous-reference frame can be expressed as

=KA s xyzs

(3.35)

Where 3 L +-L (K )-l = Is 2 s
s22
s

K L
s

(3.36)

[

0

K L
s

s 2l

(K )- t = 2
s

[

~L
s

(3.37)

0

43

Equations, (3.33) and (3.35), can be written in the expanded form as (3.38) (3.39) (3.40) (3.41)

3.3.3.3. Rotor Voltage Equations
(3.42)

Afd

= [ (Lsr )r

-(Lsr )r
1

Llfd + Lfd ]

[=~:::]
1

Jd

= =

-(Lsr )r [(Ksr l qdl] + (Lsr)r[(KJ- l q d2] + (Lifd + Lfd )iJd -[(Lsr )r (KJ- ]lqd l + [(Lsr )r (KJ- ]lq d2 + (Lifd + Lfd )ifd
1 1

1

(3.43)

(3.44) In expanded form, we can have (3.45) (3.46)

3.3.3.4 Torque Equations in Synchronous Reference-Frame Variables
The electromagnetic torque electromagnetic torque

I:

in the machine is formed by to components. One is the

T:1

generated by the abcs windings and the field winding, while

T: 2

is

generated by the xyzs windings and the field winding. The expressions of them can be described as (3.47)

44

T,I

=%P(Amd!iq! -Amq!id!)
(3.48)
=

i2 P{[i Ls( -idt + id2 ) +i Lsfdifd ]iqt _i Ls ( -iqt + iq2 )idt} 2 2 2
3 (3.49)

T,,

=% P(Amd,iq, - Amq,id, )
3 3 3 =- P{[- Ls(idl - id2 ) +- Lsfdifd ]iq2 - - Ls (iqt - iq2 )id2}
2 2 2 2

Where, P is the number of the pole pairs. The relationship between the mechanical torque Tm and the electromagnetic torque expressed as

I:

can be

T =T +Jdmr
m e

dt

(3 .50)

Where, J is the machine inertia; mr is the rotor speed. The two-set three-phase windings synchronous machine is simulated in current-source mode. Figure 3.4 shows block diagram of the computer simulation model.
idl
c
:.;::::.
'-

0

ia ib ic

n

abcs Stator Equations (3 .29)- (3 .32)

en E

Q)

co

iql

c en - c

~.E

'-

I-

co '-

v xn

0 :.;::::.

c

vd2
xyzs Stator Equations (3.38) - (3.41)

id2
Q) Q)
'-

n

o-E -cs
'-

co

0 :.;::::.

c

ix iy iz

en E
0
'-

co

co

c

en

vq2

iq2

c en - c
'-

> .....

co

I-

I-

Tm

Torque and Motion Equations (3.4 7) - (3.50)

I:
{()r

Figure 3.4 Block diagram of simulation of synchronous machine in synchronous reference frame

45

Computer Simulation and Experiment Results

+
Rload

= 240Q

Synchronous Machine

AC-DC Converter

Figure 3.5 Experiment setup for the machine model verification Table 3.1 Synchronous machine parameters
Parameters Values

Stator winding leakage inductance, Stator winding inductance,
Ls

L,s

(mH)

10 55

(mH)
Llfd

Rotor winding leakage inductance, Rotor winding self-inductance,
L fd

(mH)

30 300
Lsfd

(mH) (mH)

Magnetizing inductance between rotor and stator winding, Stator winding resistance, Field winding resistance,
rs r d 1

90 0.6 2.3

(Q) (Q)

The accuracy of the synchronous machine model is verified by the experimental test. The experimental machine is a 4-pole, 3-phase, wound induction motor. By the proper rearrangement of the stator windings and the excitation on the wound rotor, the induction machine is converted into a 4-pole, two-set winding, 3-phase synchronous machine. Therefore, the accuracy of the synchronous machine model becomes a big concern for the further study of the wind energy conversion system. The experiment environment is set up as shown in Figure 3.5. During the experiment, the thyristors in the AC-DC rectifier, which are described in the previous chapter, are triggered at two different firing angles, 150° and 46

oo. In other words, the AC-DC

rectifier

operates in parallel and in series. The synchronous generator is driven by a de motor, which runs at the fixed speed. The terminal voltage, phase voltage, phase current and voltage between two neutral points of the synchronous generator are measured under the different firing angles and compared with the simulation results. The parameters of the synchronous generator are shown in Table 3.1.

3.4.1 Comparison when firing angle at 150°
The following conditions are applied for experiment and simulation: · · · · · · Generator rotor speed: 1500RPM Electrical frequency: 50Hz Rotor excitation current: 6.0A Load resistor: 240 0 DC-link capacitor: 4500 J.lF Firing angle: 150°

The waveforms of line-to-line voltages, phase voltages, line currents and neutral voltages are shown in the figures 3.6 to 3.9.

Line-to-Line Voltages: Vab and Vxy (V)

Tek +

.JL

e Stop

MPos: 1.S80s

,I
3.02 3.025 3.03 3.035 3.04 3.045 3.05 3.055 3.06
Time(s)

._ f
CH2 1OOV M S.OOms

\__
CH3 I

(a)

(b)

Figure 3.6 Waveforms of voltage Va b and Vxy when the firing angle is 150° : (a) Simulation result; (b) Experimental result.
47

Phase Voltages: Van and Vxn (V)

400 300 200 100

I
j
7

A
:

Tek -

L

/-~
an

..

.JL
/~\ .

e Stop

M Pos: 1.980s

\

I \
J
\
""'
/

[_
j
/

/
It-

I

~~
f

,;

:

\
""' /

I
//

\

\

\

\

I

/

v

0

"'
M S.OOms

"" " "\ -200
-100 -300

\

J
""'/

v ""\
Vxn

\
""'· i/

I ""\ \ J
""'

2+

:\

\
CH2 1001/

-4~$15

3.02 3.025 3.03 3.035 3.04 3.045 3.05 3.055 3.06 Time(s)

1'

\

CH3 f

(a)

(b)

Figure 3.7 Waveforms of voltage

Van

and ~n when the firing angle is 150°:

(a) Simulation result; (b) Experimental result.

Phase Currents: Ia and lx (A)

4

Tek

...

.J1._

e Stop

M Pos: 1.980s

J\ J,
1\)
0
-1
-2

I

\
j

\)

I JJ
: :

\

\)

1

1\

-3

\

\)

1\
'T
A

\ \)

I 1\

\
t.
CH3 1.00A CH4 1.00A

-4

3.02 3.025 3.03 3.035 3.04 3.045 3.05 3.055 3.06 Time(s)

M 5.00ms

CH3 I

(a)

(b)

Figure 3.8 Waveforms of current

fa

and

Ix

when the firing angle is 150°:

Simulation result; (b) Experimental result.

48

Tek +

Jl.

M Pos: 1.980s

CH2 1OOV

M 5.00ms

CH3 I

Figure 3.9 Waveform of voltage between two neutral points Vnn. when the firing angle is 150° From above comparison, it can be seen that the model of machine is accurate and error between two results are negligible. It should be noted that in the simulation, the de link voltage
Vdc

is 242V and 240.5V in the experiment, which causes the slight different of line current.

3.4.2 Experiment with Firing Angle at oo
The following conditions are applied for experiment and simulation when the firing angle is zero: · · · · · · Generator rotor speed: 1500RPM Electrical frequency: 50Hz Rotor excitation current: 6.0A Load resistor: 240 .0 DC-link capacitor: 4500 JLF Firing angle: 0°

The waveforms of line-to-line voltages, phase voltages, line currents and neutral voltages are shown in the figures 3.10 to 3.13.

49

Line-to-Line Voltages: Vab and Vxy (V)

400 300 200 l 100

Tek

r··J.

(
~·:

"v

w~(

~V

+

JL

e Stop

M Pos: 1.S80s

\

I

0
-100 -200 -300

\
I
\___

\ v \ \

h r . . . . ,. : \ I

/l

r-··
j

~

I \

( \ ( \ ( J \ .. . . . . .
~J

I

I

\ \

I

\
\...
,

I

\._j

I I \ \ ____
]

\

\._

-400 3.015 3.02 3.025 3.03 3.035 3.04 3.045 3.05 3.055 3.06
Time(s) (a)

CH2 1OOV

M 5.00ms

CH3 I

(b)

Figure 3.10 Waveforms ofvoltage Vab and Vxy when the firing angle is oa: (a) Simulation result; (b) Experimental result.

Phase voltages: Van and Vbn (V)

400 300 200 100

Tek
+
/

JL

e Stop

M Pos: 1.S80s

/ : \

T!

I
)
./

l

an

! \
I : \
"'f

I
)

/\

l

I

-100 ~ -200 -300 40

"'

_(

\
""'

)
_(

/\
~

/'A1

,If.

!

~)

"";

I

l
)

/ ~
v xn

l

: ; l
\
)
""f

/ ~

1 \

\

g.015 3.02 3.025 3.03 3.035 3.04 3.045 3.05 3.055 3.06 Time(s)

CH2 100'...'

M 5.00ms

CH3 f

(a)

(b)

Figure 3.11 Waveforms of voltage Van and

~n

when the firing angle is oa:

(a) Simulation result; (b) Experimental result.

50

Phase Currents: Ia and lx (A)

Tek
~

.JL

e Stop

M Pos: 1.980s

.
:
'

:

:

. :

i.o15 3.02 3.025 3.03 3.035 3.04
Time(s)

3.~45

3.05 3.055 3.os

CH3 1.00A

CH4 1.00A

M 5.00ms

CH3 .I

(a)

(b)

Figure 3.12 Waveforms of current fa and I x when the firing angle is 0° : (a) Simulation result; (b) Experimental result.

Tek +

.JL

e Stop

M Pos: 1.980s

Wv\M/0

CH2 100\·'

M 5.00ms

CH3 I

Figure 3.13 Waveform of voltage between two neutral points Vnn. when the firing angle is 0°

From above comparison through figures 3.9 to 3.11, it can be verified that the model of machine is accurate. It also should be noted that in the simulation, the de link voltage
Vdc

is

467V and 440V in the experiment, which causes the slight different of line current in Figure 3.13.

51
R'l~

3.5. Conclusions
The winding arrangement introduced in this chapter provides an economical solution to obtain a two-set, 3-phase windings from a conventional 3-phase machine. The synchronous machine must have an even number of pole pairs, such as two pole-pairs. The model for the machine is developed under synchronous reference frame. The conventional synchronous machine model is modified to adopt two sets of windings. A simulation model in Matlab is built to verify the analysis. The experiment results verify the model developed through waveforms of line-to-line voltages, line currents and phase voltages. There are small deviations between the simulation results and the experimental results. The error of the model is around 5%, which is acceptable.

52

Chapter 4 Control System Design
4.1. Introduction
In this chapter, a feedback control system is designed to regulate the generator speed according to optimal speed of wind turbine. The optimal speed is fed as a reference speed for controller. The output variables such as de current and rotor speed are sensed and are fed back to control system, in which they are compared with the desired references. The error signals between the references and the feedback values are amplified to control the AC-DC rectifier in order to minimize and eliminate these errors. At the beginning of the chapter, wind turbine characteristics and proposed-control algorithms are studied to determine the control variable. Next, the detail of the control system design is demonstrated. In this part, the converter and generators are modeled using small signal model; the design of the de current control loop and the rotor speed control loop is discussed. Furthermore, the computer simulation is carried on to verify the design of the control system.

4.2. MPPT Control of Wind Turbine
According to equation ( 1.1 ), the aerodynamic power extracted by a wind turbine is related to the power coefficient and the cube of wind speed. By maintaining an optimal tip speed ratio (TSR), A, the maximum power can be extracted from wind by blades. The method of capturing the maximum power at various wind speeds is named maximum power point tracking (MPPT). Previous research proposed different types of control algorithms for MPPT, namely tip speed ratio (TSR) control, power signal feedback (PSF) control, hill-climb searching (HCS) [18], [19], [20] and optimal torque control [21]. TSR control regulates the speed of wind turbine generator to maintain an optimal TSR. In this control scheme, the wind speed has to be measured and the optimal value of TSR, which is often available at manufacture, is needed. When a wind speed is measured by the system, an optimal generator speed can be calculated by employing equation (1.2). The optimal speed is fed back to the control system as the reference speed. Hence, the optimal TSR is achieved.

53

PSF control requires the knowledge of the maximum power curve of wind turbine and tracks this curve. The maximum power curve needs to be obtained via simulations or tests for an individual wind turbine. This makes PSF control difficult and expensive in implementation. HCS control has been proposed to avoid the measurement of wind speed and the knowledge of maximum power curve. However, due to the high inertia of wind turbine and the interlacement of the extracted wind power and the turbine mechanical power, HCS method is not effective when the change of generator speed is slow. In [19], a torque control is suggested for HCS method. Optimal torque control adjusts the generator torque reference to obtain the turbine optimal torque and, hence, achieves the maximum power extraction. The torque reference is calculated by the square of generator speed and the turbine coefficient. When the wind speed increases, the turbine torque increases, but the generator speed cannot increase instantaneously due to the turbine inertia. At this moment, the torque reference is smaller than the turbine torque. This results in the acceleration of the turbine until the torque reference reaches the optimal torque. In these control algorithms, MPPT is achieved by controlling either torque of WTG or speed of WTG. In this thesis, a speed control system is designed for the synchronous generator to achieve variable speed operation. As shown in Figure 4.1, when the wind speed is beyond the rated speed, the control system is able to regulate the rotor speed to achieve the constant rated wind power extraction.
Turbine Power Characteristics (Pitch angle beta= 0 deg)

1.2

j
,_c.
0

1

~ ~ 0.8
g_~

'5-5 sG)

0.6 0.4

::IE

o_
G)

~~
~c:
... 0

!11

'0 0.2 ::I .:;
0~----~-~ ~ ~= -----~-- - ------

Half of RatediSpeed

-0.2t::..___ _ 0 0.2

__J.___ ____,__ _

____,c__ _- - ' - - - - - - ' - - - - - - - - l_ _ _...L.....:::::::sl

0.4

0.6

0.8

1

1.2

1.4

Turbine speed (pu of nominal generator speed)

Figure 4.1 Wind turbine output power vs shaft speed 54

4.3. Controller Design
The subjects involved in the control system design consist of transfer functions of the ACDC rectifier, the generator and the mechanical load. In response to a desired input, rotor speed reference

m;, the output of the control system is rotor speed mr , which is expected to be equal to

the reference

m;. Two objectives will be achieved by the control system. One is to eliminate or

reduce the steady state error; the other one is to obtain a suitable dynamic response, which does not imply a fast transient response for a step-change in the input due to large inertia of the turbine generator system. The control system is designed with a unity feedback. In Laplace domain, the frequency, at which the open-loop gain is equal to unity, is defined as the crossover frequency

fc

(angular

frequency me ). At the crossover frequency, the phase delay introduced by the open-loop transfer function must be less than 180° for the closed-loop feedback system to be stable. The phase margin is defined as the phase angle of the open-loop transfer function at

fc , which is measured

with respect to -180° . For a satisfactory dynamic response without oscillations, the phase margin should be greater than 45°, preferably close to 60°.

Current Speed

Figure 4.2 Cascade control structure

The cascade control structure is popular in drive industry because of its flexibility. The feedback controller designed here consists of two control loops; the inner current loop is followed by the speed loop. Cascade control requires that the bandwidth (speed of response) increase towards the inner loop, with the current loop being faster than the speed loop. In the

55

control system, as shown in Figure 4.2, the bandwidth of the current loop is designed one order of magnitude faster than the one of the speed loop.

4.3.1 Equivalent Voltage Source
In the wind energy converston system studied in this thesis, the AC-DC rectifier is connected to the wind turbine generator, which is analyzed in Chapter 3. Under variable speed operation, the magnitude and frequency of the generator terminal voltage vary when wind speed changes. Besides, the relationship between the internal voltage of generator and the terminal voltage of generator is nonlinear due to the winding leakage inductance. Fortunately, through the analysis below, it can be shown that the generator internal voltage is proportional to the electrical angular speed. Hence, an equivalent voltage source for the generator is obtained. Based on this, a control scheme for the generator and the AC-DC rectifier can be developed. First, let us assume the condition that the terminals of generator are not connected and the phase currents of generator are equal to zero. The current ifd flowing in the field winding produces the magnetic motive force (MMF), F1d , in the air gap of generator. The MMF F1d rotates along the stator circumference at the electrical angular velocity of me due to the rotor motion. Hence, the air-gap flux density due to i fd links the field winding fd and the stator winding as together, as shown in Figure 3.5. From the view of the stator winding as, the flux linkage between the stator winding as and the field winding fd can be expressed as

(4.1)

Where, the symbol instant
()r

()r

is the rotor angular displacement. If the time origin t = 0 is set at the
Asfd

=

0, due to the rotating of the rotor, the expression of the flux linkage

can be

rewritten as (4.2) Where

56

(4.3) The time-varying flux linkage A.sfd induces a voltage eq in the stator winding as . The expression of voltage eq can be written as
dA,sfd

dt
= .!!_[Lsfdifd sin(wi)]

dt

(4.4)

= weLsfdifd

cos(wi)

When the phase current is zero, the induced voltage eq is equal to the phase terminal voltage
vr, and the rms value of eq is

(4.5) Therefore, the MMF F1d in the air gap can be viewed as a phasor from the stator winding. In the phasor diagram, it leads the induced voltage eq by electrical angle 90°, as shown in Figure 4.3 (a).

0

(a)

(b)

Figure 4.3 Phasor diagrams: (a) No load condition; (b) 3-phase synchronous generator.

If the generator has only one set of stator windings abcs and is connected to a load, the stator currents in three phases will produce a MMF Fa in the air gap. When the MMF Fa is viewed as a phasor, it is in phase with the phase current under balanced, steady state condition. 57

Thus, the total air-gap MMF F8 is formed by superimposing the MMF F1d and the MMF Fa together. The MMF F8 results in an induced air-gap voltage E 8 in the stator winding. The relationship between the air-gap voltage E 8 and the terminal voltage

v;

is expressed as (4.6)

(4.7) Where,
rs

is the phase winding resistance and X 1s is the impedance caused by the leakage

inductance of phase winding L,s . With the assumption that the phasor 11 is in phase with the phasor

v; , the all phasors stated in equation (4.6) can be shown in Figure 4.3 (b).

In the experiment, the rotor of the synchronous generator is supplied by a current-controlled converter. In other words, the de excitation current is regulated constant. Owning to that, the airgap MMF F8 is maintained constant and the effect of the MMF Fa can be neglected, in practice. Consequently, the air-gap voltage E8 is equal to the voltage Eq, which is induced by time varying flux linkage produced by the rotating MMF F1d in the air gap. Therefore, the machine internal voltage Eq is positively proportional to the electrical angular velocity is equivalent to a voltage source with an internal resistance Figure 4.4. Hence, by neglecting the resistance two sets of terminal voltages described in Chapter 2.
V abcs rs , rs
())e ·

In addition, it

and an inductance L 1s , as shown in

the two sets of internal voltage Eq behind the

and

V xyzs

are equivalent to the two sets of voltage sources

Figure 4.4 Equivalent voltage source

58

4.3.2. Design of The Current Loop
The model of the AC-DC rectifier developed in Chapter 2 is helpful for the steady-state analysis, but insufficient for the transient-response study. In order to obtain the detailed description and computation, a great effort had been made in modeling the diode and SCR rectifiers in AC-DC-AC converter systems [22-24]. Most of the models were developed in switching mode with the constant de current over an averaging period. In these models, the concept of the equivalent de inductance was established.
St

L,s

Figure 4.5 Equivalent circuit of the AC-DC rectifier

According to the previous research, the equivalent circuit of the AC-DC rectifier can be developed and illustrated in Figure 4.5 by neglecting the winding resistance. In Figure 4.5, the symbol id is the average de current over 120° electrical angle, which is defined as the averaging period. In addition, S1 and S 2 are ideal switches. When the thyristors in the converter are triggered, the converter DC-side equivalent inductance is equal to 4L1s . The condition can be modeled as that S1 is off and S2 is on. When the thyristors are turned off, the converter DC-side equivalent inductance changes to L 1s · The situation is similar as that S1 is on and S2 is off.
It is obvious that the conducting times of switches S1 and S2 in an averaging period are

determined by the firing angle of thyristor. With the assumption that de current id is constant over the average period, the equivalent de inductance
Ldc

can be calculated as

59

(4.8) In the above equation, t1,on is the conducting time of the switch S 1 ; lz,on is the conducting time of the switch

s2 ; the averaging period is equal to

ti,on + t2,on .

From equation (4.8), the equivalent de inductance varies with different firing angles. The maximum value of Ldc is 4L1s and the minimum value of Ldc is L1s. This variance introduces a function of firing angle into the expression of equivalent inductance and, hence, generates difficulties for expressing the converter transfer function. However in the small signal model, the variance of Ldc can be linearized and maximum Ldc will be considered in each firing angle section. When 0° <a< 30°, the relationship among the de voltages and the de current can be expressed as, where Ldc is constant at 4L1s.

. did(t) Vdo (t) = Vd + Ru zd (t) + Ldc ____;,;_ dt
Vdo (t) = 1.35Eq,LL COS a(t) + 1.35Eq,LL

(4.9)
(4.1 0) (4.11)

In the Laplace domain, equation (3) can be written as

Id(s) =

Vd (s)- Vd 1.35£q LL COS a(s) + 1.35£ LL - Vd 1 o = , q, Ru + sLdc Ru 1+ s Ru I Ldc

( 4.12)

Hence, block diagrams of the current feedback control loop can be obtained in Figure 4.6 (a). In the control loop, one proportional-integral (PI) controller is utilized to compensate the current close-loop. The inner current loop is designed one order magnitude faster than the outer speed loop. Hence, in the current loop, the rotor speed and the electrical frequency are considered constant. Using the equation (4.5), we have

60

--'------=

1.35Eq,LL

1.3 5 X J3

eli
2
1r

m,L,fdifd)
=

L i

0.865

sfd fd

(4.13)

60JeL/s

Lis

By applying small variant and neglecting the constant item, Vd -1.35£q, LL, Figure 4.6 (a) can be redrawn as Figure 4.6 (b).
Vd -1.35£q, LL

PI cosa 1·35 Eq ,LL Controlle

1

(a)

PI Controlle

(b)

Figure 4.6 Block diagrams of current loop

It is worth to note that the electrical frequency varies with the changing generator speed. If

the electrical frequency fe is designed to be within the range of 26.5 Hz to 53 Hz, the operating frequency is 26.5 Hz when the firing angle a is equal to 0°, and the operating frequency is about 53Hz when the firing angle a is equal to 150° . The minimum switching frequency of the converter can be calculated as
. . = JI' swt,mm fswi min

3 x J1'e,mm . = 79.5 Hz

(4.14)

For suppressing the switching noise in the circuit and improving the stability of the current control loop, the crossover frequency fc,c of the compensated open loop has to be chosen between
1 5 fswi,min

and

1

10

fswi ,min .

For the bigger bandwidth of the outer speed loop, the

61

crossover frequency rad/s.

fc.,

is chosen to be

~ / ,w;,min , which can be calculated equal to around

I 00

From Figure 4.6 (b), the uncompensated open loop transfer function is written as

T
u,c

(s) =

Jd(s)

=

0.865

L .
sf d zf d

1 1

cosa(s)

L 1s

+

s Ru I L dc

(4.15)

Where, the subscription c is used to denote the current loop. From Table 3.3, we have
L1 s

=

10mH,

Lsfd

=

90mH and i1d = 6A. Therefore, the de gain of

the uncompensated open loop transfer function is calculated as

Tdc c '

=

0.865

L

i

sfd fd Lis

=

46.7 A

(4.16)

The comer frequency is expressed as

(4.17)

The minimum comer frequency can be calculated as

(l)com er ,min

=

6m . L 6 x 84 L e, mm Is = L L Is = 40.13rad IS 1r dc, max 1r X 4 Is

(4.18)

The transfer function of the uncompensated open loop is plotted in Figure 4.7 (a). At the frequency of 100 rad/s, the transfer function has a magnitude 24.3dBA = 16.4A . The Laplace-domain transfer function of the PI controller is expressed as

62

Gc ( s )

1+~s Ki ,c 1 =Kp c +Ki c -=Kpc_K_....;,___

K

'

' s

'

(4.19)

~s

Ki ,c

The compensated open-loop transfer function of the current loop is expressed as
1+~s

K

K z,c .

)

(4.20)

Kp ,c S Ki ,c

2:~
40

Bode Diagram ·Uncompensated Open Loop

::

- o- ..

~

f

: -45

90 " 1

f

: I : : .... .I
. j........ :· .,............

i
i

: : : · · : ": · 1·1;~Nk: · · :~ :· - · · ·~l · · :· :···~· > ._ ... .... ...... ... . .........;. . . , ··:.·· r ··n . . . n. ...
i
·

-~,~-- ,-,~,i T~.~'.'_: -2~1;cua, ,i jl ,l \ r ll!!!f
! .

.,_,,_~~~·

'l~ 'J.J.i u : l: . · ~·~·i i: ·
II: II ··· · ·1 u ;~
11 1·
1

Bode Diagram PI Controller

·: ~: ~: ·~
·

i I ·i
· · . · . . .

i I : : :~
· · . · · · . ·

· _I II II
· . ;

· -T .. ·: · .· · ··
; ; ; ; '

-45 ....

: I : :: J : f I ·: · 1 ·. ·.· ;.. ; ·. ,_·_ ._·_ · ·. . · · ... ·_ · _ ·_·__· _ ··.-.. ·. ;.. ·.· __-~.- _ .....; , .._. j i ·i i i 90 · · ' · ·· : .. · · · · . · ··· ·
I I
r

. . · .1:
1: . . .

· .,-. ·.· ... ·_ + ._-.· ...
r ... r

:' ·_· .. '_-_ _ ·_·_···_ _ ._ · .·_ · _ ·: ···_ ·_· ·.
·

:1:.~:

l

·.

10

40,13
Frequency (rad/sac)

100

1000

- 100

I

I

101

102
Frt~<~uencv

. · · · · ·· . · ··· ···· . . 103 . !104

i II II

(rad/secl

(a)

(b)

10
0

Bode Diagram -Close Loop
: ··
:

.

.

..i.
·

-10
-20

:

.
·

·

··
··

"'
10
2

·

"~

·

·'
.
:

.. .. ..

.... ......

:

.. .

-30
·

.
··

.

-40

0

I;

'"''
.

'

10

10

1

10

3

Frequency (rad/secl

(c)

(d)

Figure 4. 7 Bode plots of transfer functions Then the parameters of the PI controller can be calculated as
K
p,c

=-=0.061 16.4 = OJc,c K p,c = 100 X 0.061 = 6.1

1

(4.21) (4.22)

Ki ,c

63

The transfer functions of the PI controller and the compensated open loop are plotted in Figure 4.7 (b) and Figure 4.7 (c), respectively. The phase margin of the compensated open loop is expected higher than 45° , which is proved in Figure 4. 7 (c). Figure 4. 7 (d) shows the plot of the unity-feedback closed-loop transfer function. When 30° <a< 60°,
I (s) =
d

0.675Eq LL COS a(s) + 2.52Eq LL ' ' R
u

-

Vd

1

1+---

s

(4.23)

Ru I Ldc
(4.24) 0.67 5 X J3
=

T

eli
2
e

m,L,fdifd)
=

L i

dc,c

6m

L

0.433

sfd fd

Is

L

= 23.4A

(4.25)

Is

1[

Due to variance of

Ldc,

the minimums comer frequency of system will be
= 40.13rad IS

OJcorner,min

(4.26)

When 60° <a< 120°,
Id(s) =

0.675Eq LL cos a(s) + 1.94Eq LL- vd
' '

1
1+
S

(4.27)

Ru

Ru I Ldc
(4.28)

(4.29)

OJ . corner,mm

=

15me,minLis = 15x122L1s =5 S.3radls 4 L 4 X 2 5L
1[

(4.30)

dc,max

1[

·

Is

When 120° <a< 150°, the system parameters are approximately equal to the ones with the firing angle between 60° and 120° .

64

40
""": ....

Bode Diagram - Compensated Open Loop

:. ~~ :-.!1!-,. ,. .:c____ ;!:...;.. ~- ;- ~-:-~- - - - - - ~- - - ~- - :- -: ..;.. :-~-~-~- - - 1 Al~h~ o-;o ...
--

"2

2
Cl

Cll

- - Alpha 3G-60 Alpha GG-150

0

~ -20
40~~~~~~~~~~~~~~~~~~~~
45r - -- ------ : ------ ~ --- ~-- ~- - -:- - ~- -~ -~-: ---- -- -- ---:- - ----:- -- ~--~ -- ~- - ~ --~ -:- ~- ----- - ---~ --- - -- : -- : --- : -- ~- - : - ~-~-~- -----------:----- -~ -- --: ---:-- : --:- :-~~

-135r----------:------:----:---i---:--:--~-~-~----------:-----:----i---:-:-+~-:--:---- -- ---- - -:------:----:---:--:--:-:--:-;------------- -:------+----:---:--:--:- : -:~

10°

10

2

Frequency (rad/sec)

(a)
Bode Diagram - Closed Loop with Unity Feedback

5 ~--~~~~~--~~~~~~--~~~~~~--~~~~~
' '

-5

'

''' '' ''

m-10
~
Cll

--- -- --- --

~ -

--- --, ---- .,. - - -·- -

'' . . . ...'. ...... -- -- -

~ -15 ----

-35~~~~~~~--~~~~~--~~~~~--~~~~LU

1

10

66100
Frequency (rad/sec}

1000

10000

(b)

Figure 4.8 Bode plots with different firing angles (Alpha)

The transfer functions of the compensated open loop and the closed loop are plotted in Figure 4.8 (a) and (b), respectively, under the whole range of the firing angle. In the Bode diagrams, all the transfer functions are compensated with the same PI controller. Consequently, the crossover frequencies of the compensated open loop vary with the different firing angles. It can be observed in Figure 4.8 (b) that the minimum crossover frequency of the current loop is around 66

65

rad/s when the firing angle is between30° and 60°, which is the worst scenario of the system design. This variance of inner-loop crossover frequency should be considered for the design of the outer speed loop. In order to avoid the interaction between the two control loops, the bandwidth of the outer loop has to be chosen one order of magnitude smaller than the minimum crossover frequency of the inner loop. Hence, the effect of the variance can be neglected for the performance of the control system.

4.3.3. Design of the Speed Loop
In order to establish the relationship between the de current I d and the generator electrical torque

I:, note that the output active power,
~c

~ut,

of the generator is given by (4.31)

Then the de-link power

can be written as (4.32)

By neglecting the AC-DC rectifier losses, the output power of generator must be equal to the de-link power. Therefore, from equations (4.23) and (4.24), we have

I:= Id

vd
OJr

(4.33)

In the generating mode, the mechanical equation is given by
T:haft -

dOJr T: = J -

dt

(4.34)

Where,

I:haft

is the shaft torque of the generator; J is the inertia of the generator.

The bandwidth of the speed loop will be selected one order of magnitude smaller than that of the current loop. Therefore, the closed-current loop can be assumed ideal for design purposes and represented by unity. The block diagram of the speed loop is shown in Figure 4.9 (a). Note that the block Vd in the speed loop consists the output variable
OJr OJr .

The design of the speed

controller has to compensate this nonlinear item.

66

Speed Controller

(a)

PI

Controlle

+
(b)

Figure 4.9 Block diagrams of the speed loop

A PI controller is utilized in the speed controller. The input to the PI controller is the error of the rotor speed wr . Then, the controller will generate an electrical torque reference current reference

I:*.

The de

1; is obtained by the equation
(4.35)

Hence, by introducing the feedback of the rotor speed wr , the block diagram of the speed loop is shown in Figure 4.9 (b). The resulting open-loop transfer function loop is as follows, where the subscript s denotes the speed loop.
~

(s) of the speed

(4.36)

Where, J is equal to 0.01 kg.m 2 · This shows that the open-loop transfer function consists of a double pole at the origin. At low frequencies in the Bode diagram, this double pole at the origin causes the magnitude to decline at the rate of --40 dB per decade while the phase angle is -180° . By selecting the crossover frequency fs,c to be 1Hz and choosing the phase margin 60° , equation (4.28) yields two equations at the crossover frequency: 67

1+~s

K

Ki ,s )-1Kp,s s 0.01s Ki ,s
1+~s
s=Jws,c

=1

(4.37)

K

Kis L(Kp,s _K___;_ '~s

1

)
s= Jws ,c

(4.38)

0.01s

K.

I,S

where

ms,c = 2trh ,c

=

6.28rad / S

(4.39)

Solving equations (4.29) and (4.30), we have

Kp,s = 0.349
K . = 1.269
I ,S

(4.40) (4.41)

4.4. Computer Simulation

+

vd= 2sov

Synchronous Machine

AC-DC Converter

Figure 4.10 Block diagram of the control system

68

One of the major benefits of cascade control is that the intermediate variable such as the de current Id can be limited to acceptable ranges by putting limits on their reference values. The limitation of Id provides safe operation of the inverter (no overloading during transient). The maximum value of the de current reference
~ated

1; can be calculated from the equation (4.34), where
Vd ,rated

is the rated power of the converter and
]*
d ,max

is the rated de-link voltage of the converter. (4.42)

=

V

~ated
d ,rated

The minimum de current reference is set as 1;,min

=

OA. Due to 0° <a< 150°, the control signal

to the AC-DC rectifier such as cos a has to be limited. The maximum control signal is set as cos a max = 1 and the minimum control signal is set as cos a min = -0.866 . Figure 4.10 shows the block diagram of the control system.
It should be noted that the de current is assumed constant in the previous analysis conducted

in Chapter 2. It is true only when the source impedance is relatively large enough or when the de load consists of a large inductance. However, in our case, the source inductance, which is represented by the leakage inductance of generator winding, is relatively small and the de load is a constant de voltage source. Consequently, the waveform of de current will consists of big ripples or only pure pulses according to various firing angles. The analytical determination of the phase current at the corresponding fundamental frequency is extremely difficult and, in our case, impractical. In this regard, the steady state and dynamic response of control system are studied through the computer simulation. Based on the previous work, a simulation model is built to verify the operation of control system, as shown in Appendix A. In the simulation model, the de-link capacitor is replaced with a battery. This is true when the de-link voltage is regulated by the DC-AC converter, which has much faster response than the rectifier. The input mechanical torque Tm is set to be 2Nm . The references of rotor speed are 167rad/s, 122 rad/s, 99 rad/s and 83 rad/s.

69

Phase Current (A) and Voltage (X30V)
5 ,_
0

Phase Current (A) and Voltage (X30V)
5
--~-··----~---.........-·~ . ·-=-:y--·-··--.,-·-·--·--r ,-

"t- Fundame11tal V an

YV0f\/\AtJ & j ~[ rr 5.Bf·+ PLJ
Instantaneous and Averaged DC Current (A) Instantaneous and Averaged DC Current (A)
5.29 5.295 5.3 5.305 5.31 5.315 3.655 3.66 3.665 3.67 3.675 3.68 3.685

Time (s)

Time (s)

wr

=166.7rad l s;fe = 53.1Hz ; =1.3A;a = 150°.

Wr

=122rad l s; J. =38.9Hz;

l d ,avg

l d ,avg

=0.94A;a=108°.

(a)
Phase Current (A) and Voltage (X30V)

(b)
Phase Current (A) and Voltage (X30V)

Instantaneous and Averaged DC Current (A)

~ · · ~~ ~· f_·rl,'d 7J u· ·· · :er-~;l _:.··~t·_ . '. l . ·.·J i ,:~~ 'Etcit . ·Jft . t\ ill._'·~ . ii,_' td :tt±J
2
·· . UA ·········
·.·.1.·.'·

.....

.i· ..

=
Id ,avg

Instantaneous and Averaged DC Current (A)

9.85

9.855

9.86

9.865

9.87

9.875

9.88

9.885

9.89

9.9

9.91

9.92

9.93

9.94

Time (s)
wr =
I d .avg

Time (s)

99.5rad I s; fe

= 31.7 Hz ;

wr
Id

= 0.76A;a = 94S.

{c)

= 83.8rad I s ;fe = 26.7 Hz; v = 0.65A;a = 0°.
{d)

,a g

Figure 4.11 Steady states with different rotor speed references Figure 4.11 shows the phase current voltage
van ian

along with the fundamental component of phase along with the instantaneous de current
Id

and the average of de current

in

four steady states. It can be observed that the maximum rotor speed is 166.7 rad/s and the minimum rotor speed is 83.8 rad/s while the firing angle is 150° and 0°, respectively. In Figure 4.11 (a) and (d), the phase currents are in phase with the phase voltages due to the pure diode rectifying operation. Though these two currents are identical, the phase voltage in Figure 4.11 (a) is two times of the one in Figure 4.11 (d). This phenomenon is associated with the in-parallel operation and in-series operation of two diode rectifiers in the A C-DC rectifier. Figure 4.11 (b) and (c) show that the firing angle delays the phase current from the phase voltage. The response of control system demonstrates the extremely nonlinear characteristics. However, in steady state, the electrical torque of generator must be equal to the input mechanical torque. In other wards, the de current should be constant over the averaging period due to the

70

constant mechanical torque. The relationship of the average of de current I d,avg and the rotor speed
wr

should fulfill the equation
I
d,avg

=

Tm{J)r

V

(4.43)

d

The above equation can be proved true by calculating the simulated steady-state values. In addition, an error, which is less than 3 percents of the calculated result, is caused by neglecting the power loss on the winding resistance and power converter. As we discussed previously, the inner current loop of control system is able to provide the protection for the generator and AC-DC-AC converter system by setting the current reference at the desirable value. If the rated rotor speed is 166 rad/s, the rated de current can be calculated as
I
d,rated

=

Tmwr ,rated

V

=

d

2x166 = 1.33A 250

(4.44)

When the rotor speed steps down from the rated speed, the kinetic energy storied in the rotor starts to release. During the deceleration, the electrical torque torque
Tm.

I:

is higher than the mechanical

As a result, the de current will exceed the rated value, and the DC-AC inverter may

be overloaded. When the rotor speed drops rapidly, the de current Id may be much higher than the rated current. In order to prevent the inverter from protection, the de current has to be limited by the de current reference. In the simulation, the maximum value of de current reference is set as I; ,max = 1.7 A, and the rotor speed decreases from 166 rad/s to122 rad/s and then to 83 rad/s. Figure 4.12 shows the transient response of control system during the period of generator deceleration. When the rotor speed steps down from 166 rad/s to 122 rad/s, the speed controller generates a de current reference. The maximum current reference is limited at 1. 7 A. Responding to the input of current reference, the current controller generates a signal of firing angle. When the current reference is greater than the feedback current, the firing angle tends to decease. Due to that, the de current and the electrical torque increase. Therefore, through the mechanical system, the rotor speed decreases. This transient response of control system ends when the system reaches the next steady state. A similar response can be observed in Figure 4.13 when the rotor speed steps down from 122 rad/s to 83 rad/s.

71

wr and wr.ref- Rotor Speed and Its Reference (rad/s)

ld_ref- DC Current Reference (A)

:::fL___::::::::::::______,l___::

t:_:

!L___ :::::::::::::::______,l___ps_: uu

tL___ ----:::----:::___L_n ~-: : __ :::::::::~_ ---::::;:::-----'-----ju______J : ~

ld_avg -Average of DC Current (A)

Alpha- Firing Angle (degree)

::~~u··t :... l?. t~ j_
8 9 10 11 12

--~:(
13 14 15

~

16

Time (s)

Figure 4.12 Waveforms of control variables when generator decelerates

wr and wr.ref- Rotor Speed and Its Reference (rad/s)

ld_ref- DC Current Reference (A)

1l--

----~ 1 --------------- -,--------------- ---,--- ---- -J--u------~------ .. .. ------------- ----!------------------,------------------,----------------0.5 ----------------;----- --- ---- --!- ------ ---------~ ------- ------ ----;----- ----------- --~- ------ ----- -i -----------------;__ ------------- ---~--------- -------

nu --ru

USE:

ld_avg- Average of DC Current (A)

----&:Zl----uuu

UT ____ !______
u____

0 ----------------·- -- ------ --- ------' ___________ ___ ___ : ___________ ·__ ____ :__________________ : _________________ : ___________ ___ ___ :_____ __ ____ ___ ____ : ----------------

Alpha- Firing Angle (degree)

Figure 4.13 Waveforms of control variables when generator accelerates

When the rotor speed reference starts to decrease, the speed controller generates a new de current reference, of which the minimum value is set zero in the simulation. If the speed

72

reference is higher than the feedback speed, the current reference is lower than the sensed de current. Thus, the value of firing angle generated by the current controller tends to increase. The de current and the electrical torque will decrease. With a constant mechanical torque input, the generator accelerates. This procedure repeats until the next steady state. Figure 4.13 shows the transient responses of control system, when the rotor speed reference changes from 84 radls to 122 radls and then to 166 radls.

4.5. Conclusions
In this chapter, the WECS is modeled using small signal model and transfer functions are developed for regulator design. A cascaded controller consists of speed loop and current loop is proposed to regulate the turbine speed at optimal tip-speed ratio as well as limit the de link current. The control system is capable to provide the system protection when the wind turbine decelerates. The simulation results show that the control system has excellent dynamic responses. The transient response of control system is relatively slow due to the low crossover frequencies of speed loop and current loop. However, this is sufficient for WECS due to the large inertia of wind turbine. Over all, the objectives of the control system design are achieved.

73

Chapter 5 Experimental Verification
5.1 Introduction
In this chapter, the thyristor gating technique with the filter design is introduced. Following that, the experimental environment is described. Next, the steady states and the dynamic responses of the system are measured and compared to the simulation results.

5.2 Experimental Setup
A prototype of wind turbine system is constructed to verify the models and designs presented in the previous chapters. The structure of the prototype wind turbine system is shown in Figure 5 .1. The DC motor is driven by a wind turbine emulator. The generator rotor speed
OJr ,

the de

current Id and the zero crossings of line-to-line terminal voltages are sensed and sent into the rectifier controller, which generates the thyristor gating pulses for the AC-DC rectifier. The de link is connected to the DC-AC PWM inverter, and the de-link voltage Vd is regulated constant by the inverter controller. The inverter output voltage is connected to grid through a LC filter.
Rotor Speed m,

Wind Turbine Emulator DC Motor Drive

.s en
u
0
1-o

Oll

0

en

1-o
Cl)

N

Gating Pulses

PWM Gating

Synchronous Generator

A C-DC Rectifier

DC-ACPWM Inverter

Figure 5.1 Structure of prototype system

74

The experimental setup of wind turbine system is shown in Figure 5.2 (a). The prototype of wind turbine system consists of the prime mover, which is a DC machine (A), the two-set threephase windings synchronous generator (B), and the stator windings connection box of the generator (C), which is connected to the AC-DC rectifier.

(a)
Figure 5.2 Prototype wind turbine system

(b)

Table 5.1 Power and control parameters of the synchronous machine Items rower rrerminal voltage
~xcitation

Values

Items Stator leakage inductance Stator winding inductance Rotor leakage inductance Rotor self-inductance Mutual inductance

Values

1KW
190V

10mH 55mH 30mH 300mH 90mH
2.30 0.60

current

6A 5A
4

Stator current Pole Rated speed

1610 rpm Rotor winding resistance Stator winding resistance

In the experimental setup, the two-set three-phase windings synchronous generator (B) is mechanically coupled with the DC machine (A), which is supplied with a de voltage source. The synchronous machine is converted from a three-phase wound induction machine. The stator winding arrangement is implemented through the stator connection box (C). The rotor of 75

generator is excited by a constant de current source, of which the de current is 6 A. According to the machine analysis presented in Chapter 3, the excitation of rotor is similar with the permanent magnet excitation. Hence, the synchronous generator can be replaced by a permanent magnet synchronous generator in the current experimental setup, and the performance of prototype wind turbine system will not be significantly impacted. The electromechanical parameters of the synchronous machine are provided in Table 5.1. The generator is connected to the grid through an AC-DC-AC converter system. The DC-AC converter is a PWM voltage source inverter, which is decoupled by a de-link capacitor with the AC-DC rectifier. As shown in Figure 5.2 (b), the experimental setup related with the thesis consists of the AC-DC analog converter (F). The control system designed in Chapter 4 is implemented on the DSP platform. The control system shown in Figure 5.2 (b) consists of the analogue signal conditioning board, the Texas Instruments F2812 DSP board, and the interface circuit. The digital-to-analog converter (F) is used for displaying the output of control system.

rectifier (D), the digital signal processing unit (E) and the digital-to-

Synchronous Generator and AC-DC Rectifier

Conditioning Board

FPGA
Thyristor Triggering Signal

Zero Crossin

GPIO

DSP- TMS F2812 (Controller Implementation)

PC or D/A Converter

Figure 5.3 Block diagram of control implementation

76

Figure 5.3 shows the block diagram of control implementation. The generator terminal voltages are sensed and filtered for DSP to detect the zero-crossing instants. The generator speed and de current are sensed and input to the conditioning board, and then converted into digital signals by the analog-to-digital converter as the feedback signals. The digital signals are received by the DSP and used for the control algorithm implementation. The control algorithm has been transferred onto the DSP platform by using the C programming language. All the computations in the program are carried out using IQ math format provided by the DSP manufacture. After the precise calculation, the DSP outputs the firing signal for thyristors at the desired timing. Through the interface circuit, the thyristors are triggered with the preferable firing angle. Therefore, the entire cycle of control procedure is completely implemented.

5.3 Thyristor Gating Technique
In the AC-DC rectifier, there are six current commutations per electrical frequency circle. During each commutation, in one set of voltage source, two out of three phase terminal voltages are shorted together by the converter diodes through the leakage inductance L 1s in each phase. Consider a line-to-line terminal voltage
~a,

of which the instant of zero-cross raising is the

reference for the firing angle of thyristor T;. The line-to-line voltage is short-circuited twice per cycle, resulting in zero voltage during the commutating interval. Besides, conducting of thrystors can cause deep notches in line-to-line voltages. Hence, the false detection of zero crossing will occur.

5.3.1 Low-Pass Filter
In order to have correct detection of the zero crossing, a low-pass Sallen-Key filter is utilized in the analog circuit board to filter out the distortion of sensed line-to-line voltage, as shown in Figure 5.4 (a). Figure 5.4 (b) shows the circuit that provides the second-order transfer function for the Sallen-Key filter. The analysis of this circuit begins by writing the s-domain nodal equations at the noninverting terminal of the op amp and at the node labeled
~

.

77

C3l

IN vA

(a)

(b)

Figure 5.4 Diagrams: (a) Analog Circuit; (b) Sallen-Key Filter.

By applying KCL at node labeled

~

, V 2 and

v; , we have
(5.1)

(5.2)

(5.3) By solving equations ( 5.1) - (5.3 ), the ideal transfer function for the Sallen-Key filter can be written as
H(s) = _ a = - 2- - - - - - - - - - - - - - - v; s (R1R2 C1Cz) + s[R1C1 + R2 C1 + R1C2 (1- K)] + 1

V

K

(5.4)

where
K = R3 +R4

(5.5)

R3
The transfer function for a second order low-pass filter can be written in the standard frequency domain equation as

78

V K H(s)=-a = - 2 - - - V s s
I

(5.6)

-+--+1
OJ~

QOJC

Where OJc is the comer frequency, which is the breakpoint between the pass band and stop band, Q is the quality factor and K is the gain for the pass band. Let s = j OJ. When OJc >> OJ , the transfer function becomes H(s) = K ; when OJ= OJc , the transfer function is written as

- jKQ; when OJc <<OJ, the transfer function is reduced to -K(OJc ) 2 , and the input signals are OJ
attenuated by the square of the frequency ratio. By comparing equation (5.4) with equation (5.6) and choose R1 = R2 = 24KQ ,
R3 = R4 = lOKQ and C1 = C2 = O.lJLF, we have

(5.7)

fc = _OJc = 66.3Hz
2tr

(5.8)

(5.9) The

fc

is chosen based on the fundamental frequency of the synchronous generator as well

as the notch width. In the experiment, the value of notch and correct the zero crossing detection.

fc, about 60Hz, is enough to filter out the

5.3.2 Phase Angle Compensation
The qualitative frequency response to the second-order low-pass filter consists of two separated components: One is that the amplitude of H(jOJ) varies with frequency, which is discussed in the previous discussion, and the other is that the phase angle of H (j OJ) varies with frequency. In Bode diagram, the phase angle plots uses asymptotes. However, in order to obtain a precise result, the phase angle can be calculated by utilizing equation (5.6). By letting s = jOJ, equation (5.6) becomes

79

H(jm)

=

K

- -+--+
OJ~

(jm)2

jm

1

Qmc

K {[1- (!!!_ ) 2]- j ____!!!_} 01c Qmc

[1- (!!!_ )2 f 01c

- (____!!!_)2
Qmc

(5.10)

K{[l-(_1_) 2]- }_[_} =

fc

Qfc Qfc

[1-(_1_)2]2 -(_[_)2

fc
f 1fc 1- (/I fc

Note that Q = 1 . The phase angle of the transfer function can be written as
B(jm) =-arctan

)2

(5.11)

Where, -180° < B(jm) < oo. Due to variable speed operation of WES, the electrical frequency

f

vanes. In the

experiment, the phase angle is calculated simultaneously when the generator speed changes. Then, the newest calculated phase angle is utilized by the control system to compensate the delay of phase angle. Hence, the thyristor can be triggered at the desired instant.

Voltage Waveforms ( X90V)

Voltage Waveforms ( X90V)

(a)

(b)

Figure 5.5 Phase angle and firing angle at different electrical speeds

Figure 5.5 shows the delayed phase angle B and the firing angle a. In Figure 5.5 (a), the rotor speed is 166 rad/s and the firing angle is 140°. In Figure 5.5 (b), the rotor speed is 84 rad/s and the firing angle is 10°. As shown in Figure 5.5,
VLL

is the sensed terminal line-to-line

80

voltage. After the filter, the phase angle of filtered Vu is delayed. At this moment, the clear instant of zero crossing is detected by the control system. Meanwhile, the delayed phase angle () is calculated by the control system according to the feedback signal of rotor speed. Hence, by compensating the angle (), the real instant of voltage zero crossing is known. Therefore, the control system can send out the trigging pulses for thyristors based on the desired firing angle a .
It has to be mentioned that the correct firing angle a is delayed one electrical cycle when () is

bigger than a .

5.4 Experimental Test
The experiment test is carried out to verify the theory and design suggested in the previous chapters, by using the experimental setup described in the Section 5.2. The prototype wind turbine system is verified under the constant torque condition. Both the steady-state results and the transient responds of the prototype system are verified in the test. The constant torque is provided by the separate-excitation DC motor coupled with the generator. The nameplate of the DC motor suggests the rated parameters of the DC motor in Table 5.2. According to that, the rated rotor angular velocity
wr rated

can be calculated as (5.12)

{()r,rated = 21l nrated = l83.2rad / S
60 Table 5.2 Rated parameters of the DC motor

Items
tRated armature voltage, ~ated !Rated armature current, Rated rotor speed,
nrated !rated

Values 125V

SA
l750rpm

From the experimental measurement, the efficiency of the DC motor r; is equal to 95%. Therefore, the rated torque of the DC motor is obtained as
T
rated

= 1J~ated]rated = 5 ·2Nm
wr ,rated

(5.13)

Hence, by maintaining the armature current of the DC motor at the rated value, the synchronous generator is supplied with the constant torque, which is equal to 5 .2Nm .

81

5.4.1 Steady-State Results
In the steady state, as in previous experimental results in Chapter 3, the de-link voltage is regulated at 250 volts by the DC-AC converter. By setting the rotor speed references as 167 rad Is , 128rad Is and 87 rad Is for the control system, the wind turbine system operates in three steady states. During the steady state, the system variables including the de-link current Id, the firing angle a and the rotor angular velocity
OJr

are measured and compared with the

theoretical values in Table 5.3. In addition, the waveforms of generator phase voltage and current are plotted and shown in Figure 5.6- 5.8.
Phase Valtage fX20Vt and Phase Current fAt

Tek

JL

...e

Stop

M Pos: 7.200ms

·YL.,--51------,--1-,-,--------:--',-:-~-----="=-2.s3 ::---::2.~ s3s,-------::--l 2.54~2-,L-. 54s::---::-2.sl..,--s- 2 ,..-l-:. 55:-::-5-2,J .56
Timefst

CH3-H OOA

CH4+60.01/

MS.OOms 28-Jul-03 06:12

CH4 I 808.711

(a)

(b)
OJr =

Figure 5.6 Phase voltage and current of generator when

167rad Is

(a) Simulation waveforms; (b) Experimental waveforms
Phase Valtage fX20V) and Phase Current fA)

2
9

Tek

JL

...

e Stop

M Pos: 7.200ms

6;tt\~1(
Ji
0

)

'hase

Volta!~e

I

\\

A1\l
\ \ IV! v~
'\.../
4.535 4.54 4.545
Timefs)

I \\

3

\
\
/
4.55 4.555 4.56

VI

v

Ph: ~seC Jrrent
1-.

9

·~52

4.525

4.53

4.565

4.57

CH3+3.00A

CH4+60.0V

M S.OOms 28-Jul-03 06:12

CH4 .I 474.%3

(a)

(b)
OJr =

Figure 5.7 Phase voltage and current of generator when

128rad Is

(a) Simulation waveforms; (b) Experimental waveforms

82

Phase Valtage IX20Vl and Phase Current IAI 2 9 6
Phase Voltage
!

~

Tek

JL

+

e Stop

M Pos: 7.200ms

·

:

:

3

o'v/~

~/ --

:

/'""1-..

3

~~(_(
""-'~

// /~~ ~
·

Phal ~e Cu1 ~rent

"""
7.775 7.78

9

·1f.h

I

7.735

7.74

7.745

7.75

7.755 7.76 Time lsi

7.765

7.77

CH3+3.00A

CH4+60.0V

M 5.00ms 28-Jul-09 06:10

CH4 I I 252.3331

(a)

(b)
OJr =

Figure 5.8 Phase voltage and current of generator when

87rad Is

(a) Simulation waveforms; (b) Experimental waveforms

Table 5.3 Comparison of Simulation and Experimental results Items Rotor angular speed rF'iring angle, a
OJr

Simulation 150°
2.4A

Experimental 150°
2.4A

= 167rad Is

tDC-link current, Id

Rotor angular speed rF'iring angle, a
OJr

100°
2.0A

86°
2.0A

= 128rad Is

IDC-link current, I d

Rotor angular speed firing angle, a
OJr

oo
l.6A

oo
l.6A

= 87rad Is

DC-link current, Id

It has to be mentioned that the power loss in the system is high when the generator operates

at the rated speed. Ideally, the real power output by the AC-DC rectifier should be equal to the input mechanical power. The input mechanical power
~n

can be expressed as (5.14)

In the above equation, Tm is the mechanical torque input by the DC motor. In addition, the output electrical power is written as

83

(5 .15) Where, Id is the de-link current and Vd is the de-link voltage, which is fixed at 250 V. From equations (5.14) and (5.15), if the input torque is constant, the de current Id should be reduced to half when the generator decelerates for 167rad Is to 87rad Is. However, in Table 5.3, this phenomenon is not observed. In reality, the power losses will occur in both the AC-DC

rectifier and the generator. By neglecting the conducting loss in the converter, the power losses
in the generator includes the stator copper losses, the stator iron losses and the rotational losses. Except the stator copper losses, the other losses is significantly affected by the generator speed, typically the friction and windage losses. In other words, the power losses become higher when the generator speed increases. The rotational coefficient F can be roughly calculated by neglecting the copper losses and using the equation (Tm - F ())r )())r

= I dVd

(5.16)

According to the experimental data, the rotational coefficient F is equal to 0.009Nm · s. The simulation results confirm that.

5.4.2 Transient Response Test
In the wind turbine system, the speed control system often must respond to large changes in the speed reference value due to the swift changes of wind speed. For large step changes of speed reference, the control system must reject the disturbances and the overall system is nonlinear. The nonlinearity comes about the wind turbine output torque, which is a square function of wind speed. Additional nonlinearity is introduced by the de current limit designed in the inner current loop and the generator terminal voltage. The control system proposed in Chapter 4 is designed in a small-signal analysis. To evaluate the adequacy of the control system, simulations on computer and experiments are carried out under large-signal conditions to study the transient response of control system. The input mechanical torque is set constant in the simulations and experiment. Actually, due to the rotational losses, the input torque to the generator is not constant. The input torque of generator increases with the decreasing of generator speed. This is opposite to the characteristic of wind turbine output torque. However, in this thesis, the input torque is not the control 84

subjective for the control system. The transient responses of control system are studied with large-steps of speed reference when the input torque is constant.
wr and wr.ref ·Rotor Speed and Its Reference (rad/s)

Tek

+

JL

M Pos: 2.120s
128rad I s

167rad I s
ld_avg ·Average of DC Current (A)

{J)/Low-..w.--~~----- r ,ref

2AA

Alpha· Firing Angle (degree)

::r : ~il l
5

u

6

u

7

Time(s)

u

8

~

9

u

~

CH2 2.00V

M 500ms

CH3 f

~

(a)

(b)

Figure 5.9 System transient responses when the speed reference steps from 167rad Is to 128rad Is: (a) Simulation results; (b) Experimental results

wr and wr.ref ·Rotor Speed and Its Reference (rad/s)

Tek

+

JL

M Pos: 2.1 20s

128rad I s
ld_avg ·Average of DC Current (A)

3·

L6A

:~t ~ m ~
11

11.5

12

5.
12.5 13

Alpha· Firing Angle (degree)

!
13.5

l l '
14 14.5 15

15.5

~]

4-t

86°

1+f
H
t: ,,

CH2 2.00'./

M 500ms

CH3

Time(s)

I:

(a)

(b)

Figure 5.10 System transient responses when the speed reference steps from 128rad Is to 87rad Is: (a) Simulation results; (b) Experimental results

85

Figure 5.9 shows the dynamic changes of the generator rotor speed

OJr,

the average de

current I d and the firing angle a when the rotor speed reference steps down from 167 rad Is to
128rad Is . The results of transient response from simulation and experiment are highly matched.

In the experimental results, the controlled variables, rotor speed and de current, have zero steady state errors and desirable dynamic responses. During the transient period, the de current is limited within 4A to protect the overall system. It can be said that the objectives of the control system design are achieved and verified by the experimental results. However, there are some minor differences between simulation results and experimental results in details. The differences are associated with two major reasons. One is that the accurate value of the system inertia cannot be obtained in the simulation. Resulting from that, the transient periods are slightly different and the PI parameters of speed control loop have to be tuned in the experiment. The other one is that the low-pass filters applied in the simulation and the experiment for the de current are different. In the simulation, a continuous first-order lowpass filter is used to obtain the average value of the de current. Differently, in the experiment, a discrete moving-average filter is utilized for the de current. Therefore, during the transient period, the shape of de current curve in experiment differs from the one in simulation. The similar phenomena can be observed in Figure 5.1 0, which shows the transient responses when the rotor speed reference steps down from 128rad Is to 87rad Is. Note that the firing angle a is extremely nonlinear in this system. According to the analysis tn the previous chapters, the value of a is determined by the multi variables such as the generator air-gap voltage Eq varied by the rotor speed, the stator leakage inductance L1s of the generator, the reduce volt-radian area Au caused by current commutations, the de-link current Id and the de-link voltage Vd . The simulation model of the generator is established on some idealized assumption, which approximates the real conditions of generator such as flux linkage coupling and linear magnetic system. In the analysis of the AC-DC rectifier operation, the de current is assumed purely constant and, based on that, the de voltage drop is calculated. Those approximations lead the firing angle a in simulation deviate from the one in experiment. Fortunately, this deviation does not significantly affect the system performance.

86

wr and wr.ref ·Rotor Speed and Its Reference (rad/s)

Tek
F
/

M Pos: 1.820s
oJ
r,ref

ld_avg ·Average of DC Current (A)

·---;JI'" -~~-'~
87 rad I s ·
{J)r

128rad I s T t 1 .

j

Alpha· Firing Angle (degree)

:~[ 0 0 , mm~ ~ J 1 ,j
u
4

u

u
Time(s)

6

u

7

u

8

CH2 2.00\t'

M 500ms

CH3 f:

(a)

(b)

Figure 5.11 System transient responses when the speed reference steps up from 87rad Is to 128rad Is: (a) Simulation results; (b) Experimental results

wr and wr.ref ·Rotor Speed and Its Reference (rad/s)

Tek

+

JL

M Pos: 1.820s
167rad I s

128rad I s

l[' [ [ &J2t . . ·L.~ A
2
Alpha· Firing Angle (degree)

ld_avg ·Average of DC Current (A)

2.4A

140~ m.: ;·····+ ~~~ = T ............... :........... ....(..... 80 8.5 ~ 9:5
...... ,. . . . . . . . . . . . . . . . . , .:

~:~~

..

~.:

..

f:·

'

,. .·

.. . . . . . . . . . . . ,:

. .........., ::::::::::::;:::::::::::::::;::::::::::::::::;:::::
10 10.5 11 Time(s) 11.5 12 12.5 13

' moo· · ···· · ··
.. .: . . . . . . . . . . . . . . . .

i: ~
·
H
c

CH2 2.00V

M 500ms

CH3

f:

(a)

(b)

Figure 5.12 System transient responses when the speed reference steps up from128rad Is to 167rad Is: (a) Simulation results; (b) Experimental results

Figure 5.11 and Figure 5.12 show the transient responses when the when the speed reference steps up from 87rad Is to 128rad Is and from 128rad Is to 167rad Is, respectively. In order to accelerate the generator during the transient period, the de current I d is regulated to decrease

87

by the control system. In both the simulation and the experiment, the minimum de current is set as OA. The minimum de current can be set at a value higher than OA. Hence, the generator acceleration and the de power output are smoothened. In steady state, when the firing angle a changes from 150° to 0° , the rotor speed cannot be reduced from the maximum speed to half of the maximum speed. In reality, the rotor speed changes from 167 rad Is to 87 rad Is . This is caused by the effect of rotational losses, which is negatively proportional to the rotor speed, and the nonlinearity of the generator terminal voltage. The quantitative analysis of this phenomenon is completely impractical.

5.5 Conclusion
The thyristor gating technique is successfully implemented in the experiment to fire the thyristors with variable electrical frequencies. The experimental results of the prototype wind turbine system support the theories applied to develop the simulation models. The performance of the prototype system confirms the design of control system and proves the achievement of control objectives.

88

Chapter 6 Conclusions
6.1 Conclusions
In this thesis, a new rectifier is adopted in the wind energy conversion system. The controller and rectifier design are developed and verified by experiments. The prototype wind turbine system consists of a two-set three-phase windings synchronous generator, a novel AC-DC rectifier, a constant-voltage de-link inverter and a speed control system. The novel AC-DC rectifier is proposed to boost the terminal voltage of wind turbine generator at low speeds. When the firing angles of thyristors are changed, the output de average current of the rectifier varies accordingly when being connected to an inverter. Hence, the energy from the voltage source to the de link can be controlled by controlling the firing angles of thyristors. The operation of the AC-DC rectifier is analyzed and the model of the rectifier is developed to verify the analysis. In the analysis of the rectifier operation, the de current is assumed constant or continuous, which may not be true when the de-link voltage is stiff and the de current is discontinuous. Therefore, the formulas developed according to the assumption have the limitation. However, in most wind power applications, the source impedance is relatively high and results in a continuous de current. Besides, the results of simulation show that the error of theory is acceptable. In order to supply the AC-DC rectifier, a two-set three-phase windings synchronous generator is converted from a conventional 3-phase machine through winding rearrangement. The winding arrangement introduced in this chapter provides an economical solution. The simulation model for the "new" generator is developed under synchronous reference frame and is derived from the conventional synchronous machine model. With a setup of experimental environment, the model is verified by comparison of the waveforms of line-to-line voltages, line currents and phase voltages. The small deviations between the simulation results and the experimental results are mostly associated with the absence of the saturation in the model. The feedback control system is designed in cascade structure. The transfer functions for regulators design are obtained from the small signal model. Within the cascaded control system, the outer speed loop regulates the generator speed and achieves the optimal tip speed ratio (TSR) control, and the de current is regulated by the inner current loop. The simulation results show

89

that the control system has excellent dynamic responses and is capable to limit the de current during the machine deceleration for protecting the overall system. The low crossover frequencies of the current loop and the speed loop result in the relatively slow transient response of the control system. However, it is sufficient for wind energy conversion systems due to the high inertia of wind turbine. Over all, the objectives of the control system design are achieved. In the experiment, the thyristor gating technique for triggering at variable electrical frequencies is successfully developed and implemented. The prototype wind turbine system is able to operate at variable speeds within the range between the rated speed and the half of the rated speed. The theories applied to develop the simulation models are confirmed with the performance of the prototype system.

6.2 Major Contributions
The novel AC-DC rectifier proposed in this thesis provides an alternative solution for the generator-side converter in a small-scale direct-driven variable-speed wind turbine system. The low cost, high efficiency and simple control of the AC-DC rectifier improves the costefficiency of the wind turbine system. Besides, the winding arrangement method insures the feasibility of two-set three-phase windings synchronous generator. The practical solution in this thesis is potential to improve the competitive capability of wind power in the electricity market. The main contribution of the thesis is as following:
1. Analysis the rectifier operation and develop the mathematical model for design and

simulation. 2. The mathematical model for two-set three-phase windings synchronous generator 1s developed. The model is verified by the experiment. 3. A two-loop control system is proposed to regulate the wind turbine speed to achieve the maximum power point tracking. The parameter design of the regulators is introduced. 4. Experimental results obtained from a small prototype in the lab verify the theoretical analysis. Simulation and experimental results are compared to valid the design of the control system.

90

6.3 Future Research Work
Due to the operation of diode rectifiers, which are consisted in the proposed AC-DC rectifier, the generator-side current waveforms are not sinusoidal. The distorted current causes torque ripple in the generator, which can reduce the life of shaft connecting turbine and generator and becomes a big concern for large-scale wind turbines. Besides, in some cases, the discontinuous de current causes the inaccuracy of the theories applied in this thesis. Owning to these, further studies in the harmonics analysis and control system stability are suggested. The research of the wind energy conversion system in this thesis does not involve the study of the DC-AC inverter. The de-link voltage is assumed constant for the analysis. The research of grid connection is absent in this thesis. For the integrity of wind energy conversion system, the further research should involve grid-side inverter and consider the stability of entire system.

91

References
[1] Al-Hallaj, S.; "More than enviro-friendly: renewable energy is also good for the bottom line"; Power and Energy Magazine, IEEE; Volume 2, Issue 3, May-Jun 2004 Page(s): 16- 22 [2] American Wind Energy Association; " How much does wind energy cost?"; Washington, D.C., USA; http://www.awea.org, accessed April20, 2009 [3] Muller, S.; Deicke, M.; De Doncker, R.W.; "Doubly fed induction generator systems for wind turbines"; Industry Applications Magazine, IEEE; Volume 8, Issue 3, May-June 2002 Page(s):26- 33 [4] Hansen, L.H. ; Madsen, P.H.; Blaabjerg, F.; Christensen, H.C.; Lindhard, U.; Eskildsen, K.; "Generators and power electronics technology for wind turbines"; Industrial Electronics Society, 2001. IECON '01. The 27th Annual Conference of the IEEE; Volume 3, 29 Nov.-2 Dec. 2001 Page(s):2000- 2005 vol.3 [5] Li, H.; Chen, Z.; "Optimal direct-drive permanent magnet wind generator systems for different rated wind .speeds"; Power Electronics and Applications, 2007 European Conference on; 2-5 Sept. 2007 Page( s): 1 - 10 [6] Polinder, H.; van der Pijl, F.F.A.; de Vilder, G.-J.; Tavner, P.J.; "Comparison of direct-drive and geared generator concepts for wind turbines"; Energy Conversion, IEEE Transaction on; Volume 21, Issue 3, Sept. 2006 Page(s):725- 733 [7] Soter, S.; Wegener, R.; "Development of Induction Machines in Wind Power Technology"; Electric Machines & Drives Conference, 2007. IEMDC '07. IEEE International; Volume 2, 3-5 May 2007 Page(s): 1490- 1495 [8] Seung-Ho Song; Shin-il Kang; Nyeon-kun Hahm; "Implementation and control of grid connected AC-DC-AC power converter for variable speed wind energy conversion system"; Applied Power Electronics Conference and Exposition, 2003. APEC '03. Eighteenth Annual IEEE; Volume 1, 9-13 Feb. 2003 Page(s):154- 158 vol.1 [9] Grabic, S.; Celanovic, N.; Katie, V.A.; "Permanent Magnet Synchronous Generator Cascade for Wind Turbine Application"; Power Electronics, IEEE Transactions on; Volume 23, Issue 3, May2008Page(s):1136-1142 [10] Muljadi, E.; Butterfield, C.P.; Yih-Huei Wan; "Axial flux, modular, permanent-magnet generator with a toroidal winding for wind turbine applications"; Industry Applications 92

Conference, 1998. Thirty-Third lAS Annual Meeting. The 1998 IEEE; Volume 1, 12-15 Oct. 1998 Page(s): 174- 178 vol.l [11] Jones, R.; "Power electronic converters for variable speed wind turbines"; Power Electronics for Renewable Energy (Digest No: 1997/170), lEE Colloquium on; 16 June 1997 Page(s ): 111 - 118

~//"[12] Mihet-Popa, L.; Groza, V.; Prostean, G.; Filip, 1.; Szeidert, 1.; "Variable Speed Wind
Turbines Using Cage Rotor Induction Generators Connected to the Grid"; Electrical Power Conference, 2007. EPC 2007. IEEE Canada; 25-26 Oct. 2007 Page(s): 8- 13 / [13] Zitao Wang; Liuchen Chang; "PWM AC/DC boost converter system for induction generator in variable-speed wind turbines"; Electrical and Computer Engineering, 2005. Canadian Conference on; 1-4 May 2005 Page(s): 591-594 [14] El-Tamaly, A.M.; El-Tamaly, H.H.; Cengelci, E.; Enjeti, P.N.; Muljadi, E.; "Low cost PWM converter for utility interface of variable speed wind turbine generators"; Applied Power Electronics Conference and Exposition, 1999. APEC '99. Fourteenth Annual; Volume 2, 14-18 March 1999 Page(s): 889- 895 vol.2 [15] Haque, M.E.; Muttaqi, K.M.; Negnevitsky, M.; "Control of a stand alone variable speed wind turbine with a permanent magnet synchronous generator"; Power and Energy Society General Meeting - Conversion and Delivery of Electrical Energy in the 21st Century, 2008 IEEE; 20-24 July 2008 Page(s):l- 9 [16] Tafticht, T.; Agbossou, K.; Cheriti, A.; "DC bus control of variable speed wind turbine using a buck-boost converter"; Power Engineering Society General Meeting, 2006. IEEE; 0-0 0 Page(s): 5 pp. [17] Paul C. Krause; Oleg Wasynczuk; Scott D. Sudhoff; "Analysis of Electric Machinery and Drive Systems", Second Edition; IEEE Power Engineering Society; Published by A John Wiley
& Sons, INC.

[ 18] Quincy Wang; Liuchen Chang; "An intelligent maximum power extraction algorithm for inverter-based variable speed wind turbine systems"; Power Electronics, IEEE Transactions on; Volume 19, Issue 5, Sept. 2004 Page(s):1242- 1249 [19] Jeong Min Kwon; Jung Hun Kim; Sung Hyo Kwak; Hong Hee Lee; "Optimal power extraction algorithm for dtc in wind power generation systems"; Sustainable Energy

93

Technologies, 2008. ICSET 2008. IEEE International Conference on; 24-27 Nov. 2008 Page(s): 639-643 [20] Datta, R.; Ranganathan, V.T.; " A Method of Tracking The Peak Power Points for A Variable Speed Wind Energy Conversion System"; Energy Conversion, IEEE Transaction on; Volume 18, Issue 1, March 2003 Page(s): 163- 168 [21] Yao Xing-Jia; Liu Shu; Jiang Hong-Liang; Guo Chang-chun; "Control strategy for variable speed wind turbine";Power Electronics and Motion Control Conference, 2009. IPEMC '09. IEEE 6th International; 17-20 May 2009 Page(s):2228 - 2232; Digital Object Identifier 10.1109; IPEMC.2009.5157773 [22] Carbone, R.; De Rosa, F.; Langella, R.; Testa, A.; "A new approach to model AC/DC/AC conversion systems"; Power Engineering Society Summer Meeting, 2001. IEEE; Volume 1, 1519 July 2001 Page(s):271 - 276 vol.1 [23] Carbone, R.; De Rosa, F.; Langella, R.; Sollazzo, A.; Testa, A.; "Modelling of ACIDCIAC conversion systems with PWM inverter"; Power Engineering Society Summer Meeting, 2002 IEEE; Volume 2, 25-25 July 2002 Page(s): 1004- 1009 vo1.2 [24] Lihua Hu; Morrison, R.E.; "The use of modulation theory to calculate the harmonic distortion in HVDC systems operating on an unbalanced supply"; Power Systems, IEEE Transactions on Volume 12, Issue 2, May 1997 Page(s): 973- 980

94

Appendices
Appendix A: Simulation Blocks
~--------------~~----------------~

~

3

.q<p.
0

"' 0

.q<p.
0

.q<p.
0

.q<p.
0

0

.q<p.

.q<p.

Figure A-1 Simulation model of wind turbine system with Matlab/Simulink

95

Jbc2qd

·
I

IJmfd

upru(2]+ u]4]"u]1) (u]41"(2"u)1]+u[2D+(sq.w;JJ'u(2rul3)))13
v q2
(u[2r(·u(3~sq.w;JJ' uJ41)+ uJ1r(sq.w;J;r'u(3)·uJ4D)'O.~

(ul3r(2"u]1]+u[2))<-(·sq.w;JJ' u(2J"uJ4D)'3

vd2
This subsystem convertsid,iqto ix,iy,iz This subsystem converts Vxy
o~nd o~nd

Vyz to Vd,Vq . The sine

cosi ne co m·

putedhereo~resenttotheinveiSetro~nsformdionsubsystemqdlo~bo

Figure A-2 Simulation model of two-set three-phase windings synchronous generator

96

alpha_deg

Freq_acl

'-------------------------\--+tomoga '

phueshift -;/

J

'-r . . .
I I I

1iHer S)'Stem

t
k"(2"pi"1c)"2 s2+(2" p i"1c/Q)s+(2" p i"1c)"2 2nd Order LPF k"(2"pl"1c)"2 s2+(2" p i"1c/Q)s+(2" p i"1c)"2 2nd Order LPF1 k"(2"pi"1c)"2 s2+(2" p i"1c/Q)s+(2" p i"1c)"2 2nd Order LPF2 phaseshift 1iltered

omega

Figure A-3 Simulation model of thyristor gating

97

wr,ref

Ki

Integrator

(a) Speed control loop

Kp

Saturatiolirigonometric deg Function

Saturation1

ld

Ki

Integrator

(b) Current control loop

Figure A-4 Simulation model of speed and current control loop

98

Appendix B: DSP Program Code
I************************************************ Filename: Description: Processor: History: rectifier wind.c Main function file of rectifier for wind TMS320F2812 DSP (Fixed point) 20090325- Jiacheng Wang, Initial setup, 20090520 - Zhenhan Luo, Modified ************************************************I #include File #include File #include #include #include #include #include "FPGA CSI F2812 .h" "IQmathLib.h" "rectifier wind.h" "adc.h" "dac.h" Uintl6 i; void main(void) <DSP281 x_ Examples.h> II DSP281 x Examples Include <DSP281 x Device.h> II DSP281 x Headerfile Include _iq23 alpha_ref, alpha_ref_new; _iq23 alpha_rnin = 0, alpha_max = _IQ23(160), alpha_step = _IQ23(50); _iq23 cos_alpha_ref, cos_alpha_min = _IQ23(-0.939), cos_alpha_max = _IQ23(1); _iq23 idc_ref= 0, ide_ref_new= 0, idc_err, idc_err_i = 0; Uintl6 idc_err_choice = 2; _iq23 idc_rnin = 0, idc_max = _IQ23(8), idc_step = _IQ23(5); II limits _iq28 kp_idc = _IQ28(0.0000027), ki_idc = _IQ28(0.0004);

I* for DAC output *I
int32 dac_value = 0;

I*--------------------------- global variables -----------------*I Uint16 SCR_firing_ON = 1; II flag for enabling firing signals Uint16 relay_ON = 1; Uint16 control_ ON= I;

I* Step I. Initialize System Control *I
InitSysCtrl();

II flag for turning ON relays
II flag for enabling closeloop control

I* Initialize the Xintf clocks *I
init_XintfClocks(); EALLOW; SysCtrlRegs.HISPCP.all = OxO; II HSPCLK = SYSCLKOUTi l EDIS;

I* variables for calculating generator speed *I
Uint 16 cap 1_ value[2], cap2 _ value[2], cap3 _ value[2]; Uintl6 firing_flag_T2 = 0, firing_flag_T3 = 0, firing_flag_Tl = 0; II flags Uintl6 pulse_len_count = 4000; II firing signal width _iq23 gen_speed_cal = 0; _iq23 gen_speed_encoder = 0; Uintl6 enc_spd_index = 0; II generator speed calculcated from ZCs

I* Step 2. Initalize GPIO *I
init_ GPIO();

II generator speed from encoder II variable for encoder speed cal

I* Step 3. Clear all interrupts and initialize PIE vector table *I
DINT; II Disable CPU interrupts

Uintl6 gen_speed_threshold = 18;/1 no firing below this value

I*
* Initialize the PIE control registers to their default state. * The default state is all PIE interrupts disabled and flags are cleared.

I* for encoder speed detection *I
Uintl6 T2CNT_NEW, T2CNT_OLD; _ iq23 alpha= _ IQ23( 150); _iq23 alpha_ offset= _IQ23( -5); error _iq23 alpha_array[8192]; Uintl6 alpha_count = 0; Uint16 speed_loop_ON = 1, single_loop_control = 0; _iq23 speed_ratio, speed_ratio_3; II sampling freq over gen speed _iq23 gen_speed_ref= _IQ23(36), gen_speed_err, gen_speed_err_i =
0;

II firing angle in degrees

II for compensating filter delay

*I
InitPieCtrl(); IER = OxOOOO; II Disable CPU interrupts IFR = OxOOOO; II Clear all CPU interrupt flags InitPieVectTable();
II Initialize the PIE vector table

I* Interrupts used are re-mapped to ISR functions *I
EALLOW; 1/PieVectTable.PDPINTA = &pdpinta_isr; IIPieVectTable.XINTI = &xintl_isr; PieVectTable.ADCINT = &adc_isr;

_iq28 kp_speed = _IQ28(0.0002), ki_speed = _IQ28(0.0005); _iq23 idc_top, idc_bottom;

II sensed de currents from LEM

_iq23 idc_array[l024], idc_avg, idc_avg_3, idc_mav, idc_mav_3; Uintl6 idc_count = 0; #if (USE_ZC_SPEED)

99

PieVectTable.T2PINT = &timer2p_isr; PieVectTable.CAPINTl = &capl_isr; PieVectTable.CAPINT2 = &cap2_isr; PieVectTable.CAPINT3 = &cap3_isr; #else PieVectTable.TlPINT = &timerlp_isr; #end if

PieCtrlRegs.PIEIER3.bit.INTx6 = I; II Enable EVA CAP2INT PieCtrlRegs.PIEIER3.bit.INTx7 = 1; II Enable EVA CAP3INT #else PieCtrlRegs.PIEIER2.bit.INTx4 = 1; II Enable Timerl Period INT #endif

PieCtrlRegs.PIEIER4.bit.INTxl = 1; II Enable EVB CMP4INT PieCtrlRegs.PIEIER4.bit.INTx2 = 1; II Enable EVB CMPSINT

PieVectTable.CMP4INT = &cmp4_isr; PieVectTable.CMPSINT = &cmp5_isr; PieVectTable.CMP6INT = &cmp6_isr;

PieCtrlRegs.PIEIER4.bit.INTx3 = 1; II Enable EVB CMP6INT

PieCtr1Regs.PIEIER5 .bit.INTx 1 = 1; II Enable Timer4 Period INT PieCtr1Regs.PIEIER5.bit.INTx5 = 1; II Enable EVB CAP4INT

PieVectTable.T4PINT = &timer4p_isr; PieVectTable.CAPINT4 = &cap4_isr; PieVectTable.CAPINT5 = &cap5_isr; PieVectTable.CAPINT6 = &cap6_isr; EDIS;

PieCtrlRegs.PIEIER5 .bit.INTx6 = 1; II Enable EVB CAPSINT PieCtrlRegs.PIEIER5.bit.INTx7 = 1; II Enable EVB CAP6INT

#if (USE_ZC_SPEED) IER 1= (M_INTliM_INT3IM_INT41M_ INT5); II Enable CPU INT1 ,3,4,5;

I* Step 4. Initialize all the device peripherals *I init_FPGA(); init_interrupt();

#else IER I= (M_INTliM_INT21M_INT4IM_ INT5); II Enable CPU INT1,2,4,5; #endif

#if(USE_ZC_SPEED) in it_eva_capture(); #endif EINT; II Enable Global interrupt INTM ERTM; II Enable Global realtime interrupt DBGM

init_ evb_capture(); init_evb_compare(); init_ADC(); init_ ev_timers();

I* Step 6. AD calibration and system operation initialization *I AD_bias_temp();

I* DAC initialization *I init_dac();

lllnit_QEP();

dac_preset(); dac_value = Ox7FF;

I* Step 5. User specific code, enable interrupts * I IIEvaRegs.EVAIFRA.bit.PDPINTA = 1; IIEvaRegs.EV AIMRA.bit.PDPINT A= 1; Interrupt IIPieCtrlRegs.PIEIERl.bit.INTxl = 1; IIPieCtrlRegs.PIEIERl.bit.INTx4 = 1; 1/PieCtrlRegs.PIEIERl.bit.INTxS = 1; II Enable PDPINTA II Clear PDPINTA flag

(*SEND_COMM_CODE) = Ox590F; (*SEND_COMM_CODE) = Ox69FO; for (i = 0; i < 16; i++) dac_out(dac_value, i); dac_latch();

II Enable PO PINT A

II Enable XINTl
II Enable XINT2 I* initialization done, enter main loop *I

PieCtrlRegs.PIEIERl.bit.INTx6 = 1; II Enable ADCINT: GRPl IRQ6

while(!)

if(relay_ON) { #if(USE_ZC_SPEED) PieCtrlRegs.PIEIER3.bit.INTxl = 1; II Enable Timer2 Period INT PieCtrlRegs.PIEIER3.bit.INTx5 = 1; II Enable EVA CAP liNT Close_Relay(3); Close_Relay(4);

100

} else { Open_Relay(3); Open_Relay(4);

if(gen_speed_err_i > idc_max) gen_speed_err_i = idc_max; if(gen_speed_err_i < idc_min) gen_speed_err_i = idc_min;

if (speed_loop_ON)

dac_value = _IQ18int(_IQ18mpyiQX(_IQ23(80), 23, gen_speed_cal, 23)); dac_out(dac_value, 0); dac_latch();

I* idc_ref = gen_speed_err * 2*PI*Gen_Speed I Vdc */
ide_ref_new = _IQ23mpy1QX(kp_speed, 28, gen_speed_err, 23) + gen_speed_ err_i; ide_ref_ new= _ IQ23mpy(_IQ23(Pix2), idc_ref_new); ide_ref_ new = _IQ23mpyiQX(idc_ref_new, 23, _IQ30(INV_ VDC), 30); idc_ref_new = _IQ23mpy(gen_speed_cal, idc_ref_new);

I************************************************ Function: void gen_speed_ control() if (idc_ref_new > idc_max) idc_ref_new = idc_max; if(idc_ref_new < idc_min) idc_ref_new = idc_min; Description : Dual loop PI controller for generator speed control ************************************************I void gen_speed_control(void) if ( (idc_ref_new > idc_ref) && ((idc_ref_new- idc_ref) > idc_step)) ide_ref+= ide_ step; else if( (idc_ref_new < idc_ref) && _iq23 temp; _iq30 delta_angle; int32 delta_ num; ((idc_ref- ide_ref_new) > idc_step)) idc_ref -= idc_step; else idc_ref = idc_ref_new;

I* speed control loop *I
if (single_loop_ control)

gen_speed_err = gen_speed_ref- gen_speed_cal;

switch (idc_err_choice) II choice of ide feedback

gen_ speed_err_i += _IQ23mpy1QX(ki_speed, 28, gen_speed_err, 23);

case 0: II instantaneous ide idc_err =- (idc_ref- idc_array[idc_count]); break;

if(gen_speed_err_ i > alpha_max) gen_speed_err_i = alpha_max; if(gen_speed_err_i < alpha_min) gen_speed_err_i = alpha_min;

case I : II average per cycle idc_err =- (idc_ref- idc_avg); break;

alpha_ref_new = _IQ23mpyiQX(kp_speed, 28, gen_speed_err, 23) + gen_speed_ err_ i;

case 2: II averate per 113 cycle idc_err = - (idc_ref- idc_avg_3); break; case 3: II moving average per cycle

else II dual loop

idc_err =- (idc_ref- idc_mav); break;

gen_speed_err =- (gen_speed_ref- gen_speed_cal);

case 4: II moving average per 1/3 cycle idc_err=- (idc_ref- idc_mav_3);

gen_speed_err_i += _IQ23mpyiQX(ki_speed, 28, gen_speed_err, 23);

break; default: idc_ err=- (idc_ref- idc_avg);

101

break;

#if (USE_ ZC_SPEED) ide_ err= - ide_err;

I************************************************
idc_err_i += _IQ23mpy1QX(ki_idc, 28, idc_err, 23); Function: interrupt void timer2p_isr(void)

if (idc_err_i > cos_alpha_max) idc_err_i = cos_alpha_max; if(idc_err_i < cos_alpha_min) idc_err_i = cos_alpha_min;

Description:

Timer 2 period ISR, 20KHz for ADC sampling

cos_alpha_ref= _IQ23mpy1QX(kp_idc, 28, idc_err, 23) + idc_ err_i; if(cos_alpha_ref > cos_alpha_max) cos_alpha_ref = cos_alpha_ max; if(cos_alpha_ref < cos_alpha_min) cos_alpha_ref = cos_ alpha_min; alpha_ref_new = _IQ23mpyLIQ23acos(cos_alpha_ref), _ IQ23(57.29578));

************************************************I
interrupt void timer2p_isr(void)

EvaRegs.EV AIFRB.bit.T2PINT = 1; II Clear T2PINT flag PieCtrlRegs.PIEACK.all = PIEACK_GROUP3; II Acknowledge interrupt to PIE

#else

I************************************************
if (alpha_ref_new > alpha_max) alpha_ref_new = alpha_max; if(alpha_ref_new < alpha_min) alpha_ref_new = alpha_min; Description: if(control_ON) II apply to alpha Timer I period ISR, 20KHz for ADC sampling Function: interrupt void timer 1p_isr(void)

if( (alpha_ref_new > alpha_ref) && ((alpha_ref_new- alpha_ref) > alpha_step)) alpha_ref+= alpha_step; else if( (alpha_ref_new < alpha_ref) && ((alpha_ref- alpha_ref_new) > alpha_step)) alpha_ref-= alpha_ step; else alpha_ref= alpha_ref_ new;

************************************************I
interrupt void timer 1p_ isr( void)

EvaRegs.EV AIFRA.bit.TI PINT= 1; II Clear Tl PINT flag PieCtrlRegs.PIEACK.all = PIEACK_GROUP2; II Acknowledge interrupt to PIE

#endif I* apply firing instant to compare register and set firing flag *I if (firing_flag_ T2) EvbRegs.CMPR4 = EvbRegs.CMPR4 + (intl6)delta_num; if (firing_flag_ T3) EvbRegs.CMPR5 = EvbRegs.CMPR5 + (intl6)delta_num; if (firing_flag_ Tl ) EvbRegs.CMPR6 = EvbRegs.CMPR6 + (intl6)delta_num; Description: Timer 4 period ISR, 1.5KHz for control sampling

I************************************************
Function: interrupt void timer4p_isr(void)

************************************************I
interrupt void timer4p_isr(void)

alpha = alpha_ref; Uint16 i, s_r, s_r_3; _iq23 tmp = 0;

102

I* get generator speed from encoder *I
#if !(USE_ZC_SPEED) encoder_ speed(); gen_speed_cal = gen_speed_encoder; #endif

gen_speed_control();

EvbRegs.EVBIFRB.bit.T4PINT = l; II Clear T4PINT flag PieCtrlRegs.PIEACK.all = PIEACK_GROUP5; II Acknowledge interrupt to PIE

alpha_array[alpha_count] =alpha; alpha_ count ++; if (alpha_ count == 8192) alpha_ count = 0;

I************************************************
Function: interrupt void xintl_isr(void)

idc_top = get_ADC(O, 3); idc_bottom = get_ADC(8, 3); idc_array[idc_count] = idc_top + idc_bottom;

Description:

Xint ISR

speed_ratio = _IQ20div(_IQ20(1500), (gen_speed_cal>>3))

* 8;

************************************************I
interrupt void xintl_isr(void)

speed_ratio_3 = _IQ23div(speed_ratio, _ IQ23(3));

I* moving average filter *I
ide mav= _IQ23mpy(idc_avg, _IQ23div(speed_ratio- _IQ23(l), speed_ratio)) + _IQ23div(idc_array[idc_count], speed_ratio); #if (USE_ZC_SPEED)

I************************************************
idc_mav_3 = _IQ23mpy(idc_avg_3, _ IQ23div(speed_ratio_3- _IQ23(l), speed_ratio_ 3)) + _ IQ23div(idc_array[ ide_count], speed_ratio _3); Description: CAPI,2,3 ISRs for calculating gen speed from zero-crossings, Timerl running at l50MHz/l28 = l.l71875MHz, each count is Function: interrupt void cap l_isr(void)

I* average per cycle *I
s_r = _IQ23int(speed_ratio); for (i = 0; i < s_r; i++) tmp += _IQ23div(idc_array[(idc_count- i)% 1024], speed_ratio); idc_avg = tmp; Uintl6 temp;

0.000000853 (second)

************************************************I
interrupt void cap l_ isr(void)

_iq23 temp_Q23;

tmp = 0; s_r_3 = _IQ23int(speed_ratio_3); for (i = 0; i < s_r_3; i++) tmp += _IQ23div(idc_array[(idc_count- i)% 1024], speed_ratio_3); idc_avg_ 3 = tmp;

temp= EvaRegs.CAPIFBOT; temp_Q23 = _IQ30mpyiQX(_IQI5(temp-capl_value[O]), 15, _IQ30(0.000000853), 30) >> 7; gen_speed_cal = _IQ23div(_IQ23(l), temp_Q23); cap l_value[O] = cap I_value[ l ]; capl_value[I] =temp;

idc_count ++; if(idc_count == 1024) ide_count= 0;

I* acknowledge interrupt *I
EvaRegs.EVAIFRC.bit.CAPIINT = I; II Clear CAP liNT flag

if(gen_speed_cal > _IQ23(gen_speed_threshold))

103

PieCtrlRegs.PIEACK.all = PIEACK_GROUP3; II Acknowledge interrupt to PIE

I************************************************ Function: interrupt void cap4_isr(void)

Description: interrupt void cap2_isr(void)

CAP4,5,6 ISRs are used as zero-crossing references, delay angle and compensation are calculated here to set the time instants of

Uint\6 temp; _iq23 temp_Q23;

SCR firing ************************************************I interrupt void cap4_isr(void)

temp = EvaRegs.CAP2FBOT; temp_Q23 = _IQ30mpyiQXLIQ15(temp-cap2_value[O]), 15, _IQ30(0.000000853), 30) >> 7; gen_speed_cal = _IQ23divLIQ23(1), temp_Q23); cap2_value[O] = cap2_value[ I]; cap2 _value[ I] = temp; if((gen_speed_cal > _IQ23(100)) II (gen_speed_cal < _IQ23(5))) _iq30 f_ div_ fc; _iq30 theta_delayed, angle_to_add; II in per unit value Uint32 num_to_add; _iql2 temp;

I* acknowledge interrupt *I
EvaRegs.EV AIFRC.bit.CAP2INT = I; II Clear CAP2INT flag PieCtrlRegs.PIEACK.all = PIEACK_GROUP3; II Acknowledge interrupt to PIE

I* acknowledge interrupt * I
EvbRegs.EVBIFRC.bit.CAP4INT = 1; II Clear CAP4INT flag PieCtrlRegs.PIEACK.all = PIEACK_GROUP5; II Acknowledge interrupt to PIE return;

interrupt void cap3 _isr(void)

I*
* calculate the angle that needs to be compensated. 2nd-order

Uintl6 temp; _iq23 temp_Q23 ;

hardware *filter on firing board has fc=66.31Hz, Tc=l/66.31=0.01508

*I
temp= EvaRegs.CAP3FBOT; temp_Q23 = _IQ30mpyiQXLIQ15(temp-cap3_value[O]), 15, _ IQ30(0.000000853), 30) >> 7; gen_speed_cal = _IQ23divLIQ23(1), temp_Q23); cap3 _ value[O] = cap3 _value[ I]; cap3 _value[ 1] = temp; theta_delayed = _IQ30atan2PU( f_div_fc, _IQ30(1)- _IQ30mpy(f_div_fc, f_div_fc) ); f_div_fc = _IQ30mpyiQX(gen_speed_cal, 23, _IQ30(0.01508), 30);

I*
* falling edge captured, so firing signal should be sent at

I* acknowledge interrupt *I
EvaRegs.EVAIFRC.bit.CAP3INT =I; II Clear CAP3INT flag PieCtrlRegs.PIEACK.all = PIEACK_GROUP3; II Acknowledge interrupt to PIE

*(PI- theta+ alpha), alpha_offset is used for error compensation, * 11360 = 0.002778

*I
angle_to_add = _IQ30(0.5)- theta_delayed + _IQ30mpyiQX((alpha+alpha_offset), 23, _IQ30(0.002778), 30);

#endif

I* fclock for Timer3 is 150MhZI 128 = 1171875Hz *I
temp= _IQ12divLIQ23(1), gen_speed_cal); temp= _IQI2mpyiQXLIQ10(1171875), 10, temp, 12);

104

temp= _IQ12mpylQX(angle_to_add, 30, temp, 12);

+ _IQ30mpylQX((alpha+alpha_offset), 23, _IQ30(0.002778), 30);

num_to_add = _IQ12int( temp);

I* fclock forTimer3 is 1SOMhZI128 = 117187SHz *I I* apply firing instant to compare register and set firing flag *I
EvbRegs.CMPR4 = EvbRegs.CAP4FBOT + (Uint16)num_to_add; firing_ flag_ T2 = 1; temp= _ IQ12div(_IQ23(1), gen_speed_cal); temp = _ IQ12mpy1QX(_IQ10(117187S), 10, temp, 12); temp= _IQ12mpyiQX(angle_to_add, 30, temp, 12);

I* acknowledge interrupt *I
EvbRegs.EVBIFRC.bit.CAP4INT = 1; II Clear CAP4INT flag PieCtrlRegs.PIEACK.all = PIEACK_GROUPS; II Acknowledge interrupt to PIE

num_to_add = _IQ12int( temp);

I* apply firing instant to compare register and set firing flag *I
EvbRegs.CMPRS = EvbRegs.CAPSFBOT + (Uint16)num_to_add; firing_ flag_ T3 = 1;

I* acknowledge interrupt *I
interrupt void capS _ isr(void) EvbRegs.EVBIFRC.bit.CAPSINT = 1; II Clear CAPSINT flag PieCtrlRegs.PIEACK.all = PIEACK_GROUPS; II Acknowledge _iq30 f_div_ fc; _iq30 theta_delayed, angle_to_add; II in per unit value Uint32 num_to_add; _iql2 temp; interrupt void cap6_ isr( void) if((gen_speed_cal > _IQ23(100)) II (gen_speed_cal < _IQ23(S))) _iq30 f_div_fc; interrupt to PIE

I* acknowledge interrupt *I
EvbRegs.EVBIFRC.bit.CAPSINT = I; II Clear CAPSINT flag PieCtrlRegs.PIEACK.all = PIEACK_GROUPS; II Acknowledge interrupt to PIE return;

_iq30 theta_delayed, angle_to_add; II in per unit value Uint32 num_to_add; _iq12 temp;

if((gen_speed_cal > _IQ23(100))

II (gen_speed_cal < _IQ23(S)))

I* acknowledge interrupt *I I*
EvbRegs.EVBIFRC.bit.CAP6INT = 1; II Clear CAP6INT flag PieCtrlRegs.PIEACK.all = PIEACK_GROUPS; I I Acknowledge interrupt to PIE return;

* calculate the angle that needs to be compensated. 2nd-order
hardware

* filter on firing board has fc=66.31 Hz, Tc= 1/66.31 =0.0 1S08
*I
f_div_fc = _IQ30mpyiQX(gen_speed_cal, 23, _IQ30(0.01S08),
3~; ~

* calculate the angle that needs to be compensated. 2nd-order
theta_delayed = _IQ30atan2PU( f_div_fc, _IQ30(1)- _IQ30mpy(f_div_fc, f_div_fc) ); hardware

* filter on firing board has fc=66.31 Hz, Tc=1 166.31 =0.01S08
*I
f_div_fc = _IQ30mpyiQX(gen_speed_cal, 23, _IQ30(0.01S08), 30);

I*

* falling edge captured, so firing signal should be sent at
*I
angle_to_add = _IQ30(0.S)- theta_delayed

theta_delayed = _IQ30atan2PU( f_div_fc, _IQ30(1)- _IQ30mpy(f_div_fc, f_div_fc) );

105

I*

* falling edge captured, so firing signal should be sent at
*I
angle_to_add = _IQ30(0.5)- theta_delayed + _IQ30mpyiQX((alpha+alpha_offset), 23, _IQ30(0.002778), 30);

I* acknowledge interrupt *I
EvbRegs.EVBIFRA.bit.CMP4INT = l; II Clear CMP4INT flag PieCtrlRegs.PIEACK.all = PIEACK_ GROUP4; II Acknowledge interrupt to PIE

I* fclock for Timer3 is 150MhZi l28 = ll71875Hz *I
temp= _IQ12div(_IQ23(l), gen_speed_cal); temp= _IQ12mpyiQX(_IQlO(ll71875), 10, temp, 12); temp= _IQ12mpyiQX(angle_to_add, 30, temp, 12);

interrupt void cmp5 _isr(void)

if(firing_flag_T3 && SCR_firing_ON && (gen_speed_cal > _IQ23(gen_speed_threshold)))

num_to_add = _IQ12int( temp);

T3_FIRING_ON; EvbRegs.CMPR5 = EvbRegs.CMPR5 + pulse_len_count;

I* apply firing instant to compare register and set firing flag *I
EvbRegs.CMPR6 = EvbRegs.CAP6FBOT + (Uintl6)num_to_add; firing_ flag_ Tl = l ;

firing_ flag_T3 = 0;

else

I* acknowledge interrupt *I
EvbRegs.EVBIFRC.bit.CAP6INT = l; II Clear CAP6INT flag PieCtrlRegs.PIEACK.all = PIEACK_GROUPS; II Acknowledge interrupt to PIE

T3_FIRING_OFF; firing_ flag_T3 = 0;

I* acknowledge interrupt *I
EvbRegs.EVBIFRA.bit.CMP5INT = 1; II Clear CMP5INT flag PieCtrlRegs.PIEACK.all = PIEACK_GROUP4; II Acknowledge

I************************************************
Function: interrupt void cmp4_isr(void)

interrupt to PIE

Description:

CMP4,5,6 ISRs are for sending the firing signals, firing signal length is determined by pulse_len_count

interrupt void cmp6_isr(void)

if(firing_flag_Tl && SCR_firing_ON && (gen_speed_cal > _IQ23(gen_speed_threshold)))

***********************************************I
interrupt void cmp4_isr(void) Tl_FIRING_ON; EvbRegs.CMPR6 = EvbRegs.CMPR6 + pulse_len_count; if(firing_flag_T2 && SCR_firing_ON && (gen_speed_cal > _IQ23(gen_speed_threshold))) else T2_FIRING_ON; EvbRegs.CMPR4 = EvbRegs.CMPR4 + pulse_len_count; firing_ flag_T2 = 0; Tl_FIRING_OFF; firing_ flag_Tl = 0; firing_ flag_T l = 0;

else

I* acknowledge interrupt *I
T2_FIRING_OFF; firing_ flag_T2 = 0; EvbRegs.EVBIFRA.bit.CMP6INT = l; II Clear CMP4INT flag

106

PieCtrlRegs.PIEACK.all = PIEACK_GROUP4; II Acknowledge interrupt to PIE

GpioMuxRegs.GPBMUX.all=Ox0700; II CAPIQEP 4-6 GpioMuxRegs.GPDMUX.all=OxOOOO; GpioMuxRegs.GPEMUX.all=OxOOOO; GpioMuxRegs.GPFMUX.all=OxOOOO;

I************************************************ Function: interrupt void pdpinta_isr(void)

GpioMuxRegs.GPGMUX.all=OxOOOO;

I* GPIO DIR select GPIOs as output or input, 0- input; 1 -output *I
Description: Protection interrupt generated from FPGA, not used ************************************************I interrupt void pdpinta_isr(void) GpioMuxRegs.GPADIR.all=Ox1880; II A7,A11,A12 for Relays GpioMuxRegs.GPBDIR.all=Ox18BF; II B7,B11,B12 for Relays, B0-5 for SCRs GpioMuxRegs.GPDDIR.a1l=OxOOOO; GpioMuxRegs.GPEDIR.all=OxOOOO; fault_protection() ; GpioMuxRegs.GPFDIR.all=OxOOOO; GpioMuxRegs.GPGDIR.all=OxOOOO;

I* Set GPIO input qualifier values (0) *I
I************** ********************************** Function: void fault_protection(void) GpioMuxRegs.GPAQUAL.all=OxOOOO; GpioMuxRegs.GPBQUAL.all=OxOOOO; GpioMuxRegs.GPDQUAL.all=OxOOOO; Description: Called when fault happens, not used GpioMuxRegs.GPEQUAL.all=OxOOOO;

************************************************I void fault_protection(void)

I* qualification SYSCLKOUTI15 (0.5us for 6 consecutive cycles) *I
GpioMuxRegs.GPEQUAL.all=OxOOOf;

Open_Relay(3) ; Open_Relay(4);

I* clear Relays *I
GpioDataRegs.GPACLEAR.bit.GPIOA 7 = 1;

*XINTI _CONFIG = OxO;

GpioDataRegs.GPBCLEAR.bit.GPIOB7 = I; GpioDataRegs.GPBCLEAR.bit.GPIOB 11 = 1;

DINT;

GpioDataRegs.GPACLEAR.bit.GPIOA11 = I; GpioDataRegs.GPACLEAR.bit.GPIOA12 = 1;

while( I);

GpioDataRegs.GPBCLEAR.bit.GPIOB 12 = I;

EDIS;

I************************************************ Function: void init_ GPIO(void)

I************************************************ Function: void initXintfClocks(void)

Description:

Configure 2812 GPIO

Description:

System clock configuration

************************************************I void init_GPIO(void)

************************************************I void init_XintfClocks(void)

EALLOW;

XintfRegs.XTIMINGO.all = Ox000358AC; XintfRegs.XTIMING6.all = Ox0003E746; 113D4A5;

I* Configure MUXs as digital VOs or peripheral VOs *I
GpioMuxRegs.GPAMUX.all=Ox0700; II CAPIQEP 1-3

XintfRegs.XINTCNF2.all = Ox00000007;

107

EvaRegs.T2CON.all = Ox1040;

!************************************************ Function: void init_ev_timers(void)

/*Start EVA ADC Conversion on Timer2 Period interrupt*/ EvaRegs.GPTCONA.bit.T2TOADC = 2;

Description:

Initialize Timers

#else

EVA_T1: for calculating generator speed from rising and falling zero-crossings (speed from ZC) triggering ADC sampling (speed from encoder) EVA_T2 : triggering ADC sampling (speed from ZC) for encoder speed measurement (speed from encoder) EVB _ T3 : for ABC rising zero-crossings capture as firing reference EVB _ T4 : for control /* Enable Period interrupt bits for Timerl */ EvaRegs.EV AIFRA.bit.Tl PINT= I; EvaRegs.EVAIMRA.bit.TIPINT = I; /*EVA Timer! Registers*/ //EvaRegs.TIPR = OxFO; II 625kHz for ADC bias calibration EvaRegs.TIPR = OxlD4C; EvaRegs.TlCMPR = OxOOOO; EvaRegs.TICNT = OxOOOO;

II 20kHz sampling for ADC II compare II clear counter

**************************** ********************!

/*continuous-up, internal_clk (150MHz), disable compare, use own period*/

void in it_ev_timers( void)

EvaRegs.TICON .all = Oxl040;

/*EVA, Timerl and Timer2 */ EvaRegs.GPTCONA.all = 0;

!*Start EVA ADC Conversion on Timerl Period interrupt*/ EvaRegs.GPTCONA.bit.TITOADC = 2;

#if (USE_ ZC_SPEED)

!* EVA Timer2 Registers *I
EvaRegs.T2PR = OxFFFF; II 10000 pulses per cycle of encoder

!*EVA Timerl Registers*/ EvaRegs.TlPR = OxFFFF; EvaRegs.TICMPR= OxOOOO; EvaRegs.TICNT = OxOOOO;

EvaRegs.T2CMPR = OxOOOO; II compare

II period II compare II clear counter

EvaRegs.T2CNT = OxOOOO;

!*directional-up/down count mode input clock from QEP *I EvaRegs.T2CON.all = Ox1870;

/*continuous-up, internal_clkxl28, disable compare, use own period*/ EvaRegs.Tl CON.all =Ox 1740;

EvaRegs.T2CON.bit.TENABLE = I; II enable Timer 2

#endif

/*EVA Timer2 Registers*/ //EvaRegs.T2PR = OxFO; II 625kHz for ADC bias calibration EvaRegs.T2PR = Ox1D4C; II 20kHz sampling for ADC EvaRegs.T2CMPR = OxOOOO; II compare

/* EVB, Timer3 */ EvbRegs.GPTCONB.all = 0;

/* Timer3 Registers (EVB) */ EvbRegs.T3PR = OxFFFF;

II period II compare II clear counter

!* Enable Period interrupt bits for Timer2 */
EvaRegs.EV AIFRB.bit.T2PINT = 1; EvaRegs.EV AIMRB.bit.T2PINT = 1; EvaRegs.T2CNT = OxOOOO;

EvbRegs.T3CMPR = OxOOOO; EvbRegs.T3CNT = OxOOOO;

/*continuous-up, internal_clkxl28, disable compare, use own period*/

/*continuous-up, internal_clk (150MHz), disable compare, use own period*/

EvbRegs.T3CON.all = Oxl740;

108

I* Timer4 Registers (EVB) *I
EvbRegs.T4PR = OxOC35; EvbRegs.T4CMPR = OxOOOO;

I************************************************

II 1.5kHz for control II compare

Function:

void init_ eva_ capture(void)

Description:

Initialize EVA Capturel-3 for generator speed calculation from zero-crossings

I* Enable Period interrupt bits for Timer4 *I
EvbRegs.EVBIFRB.bit.T4PfNT = I; EvbRegs.EVBIMRB.bit.T4PfNT = I; EvbRegs.T4CNT = OxOOOO;

** **********************************************I void init_ eva_ capture( void)

II clear counter

I* continuous-up, internal_ clkx32, disable compare, use own period *I
EvbRegs.T4CON.all
=

I* clear CAPFIFO status *I
EvaRegs.CAPFIFOA.all
=

OxOOOO;

Oxl540;

I*
*enable Captures 1-3, use Timer! as time base, detect both rising and I*************************** ********************* Function: void init_ evb_compare( void) * falling edges

*I
EvaRegs.CAPCONA.all
=

Ox36FC;

Description:

Initialize EVB compare for sending out SCR firing signals EvaRegs.EVAIFRC.bit.CAPlfNT

= 1;

II Clear CAP! flag II Clear CAP2 flag II Clear CAP3 flag

************************************************I void init_evb_compare()

EvaRegs.EV AIFRC.bit.CAP2fNT = 1; EvaRegs.EV AIFRC.bit.CAP3fNT = 1;

I* Enable compare for PWM7-PWMI2 *I
EvbRegs.CMPR4 EvbRegs.CMPR5
= =

EvaRegs.EVAIMRC.bit.CAPl INT = 1; EvaRegs.EV AIMRC.bit.CAP2INT = 1; EvaRegs.EV AIMRC.bit.CAP3INT = 1;

II Enable CAP! Interrupt II Enable CAP2 Interrupt II Enable CAP3 Interrupt

OxOOOO; OxOOOO;

EvbRegs.CMPR6 = OxOOOO;

EvbRegs.ACTRB.all

=

OxOOOO;
=

I******** **************************************** Function: void in it_evb_capture( void)

EvbRegs.DBTCONB.all

OxOOOO; II disable deadband

I* compare enable, cmpr register reload immediately *I
EvbRegs.COMCONB.all
=

Description:

Initialize EVB Capture4-6 for capturing zero-crossings as firing angle reference

OxCOOO;

CAP4 - Vab for CMP4 for firing T2 EvbRegs.EVBIFRA.bit.CMP4fNT = I; EvbRegs.EVBIFRA.bit.CMP5fNT = I; EvbRegs.EVBIFRA.bit.CMP6fNT = 1;

II Clear CMP4 flag II Clear CMP5 flag II Clear CMP6 flag

CAPS - Vbc for CMP5 for firing T3 CAP6 - V ca for CMP6 for firing Tl ************************************************I void init_evb_capture( void)

EvbRegs.EVBIMRA.bit.CMP4fNT = 1; Interrupt EvbRegs.EVBIMRA.bit.CMP5fNT = 1; Interrupt EvbRegs.EVBIMRA.bit.CMP6fNT = 1; Interrupt

II Enable CMP4 I* clear CAPFIFO status *I II Enable CMP5
EvbRegs.CAPFIFOB.all
=

OxOOOO;

II Enable CMP6

I* enable Captures 4-6, use Timer3 as time base, detect falling
edges *I EvbRegs.CAPCONB.all
=

Ox36A8;

EvbRegs.EVBIFRC.bit.CAP4fNT = 1;

II Clear CAP4 flag

109

EvbRegs.EVBIFRC.bit.CAP5INT = l; EvbRegs.EVBIFRC.bit.CAP6INT = I;

// Clear CAPS flag

*FAN_COMPARE_B = OxO; *FAN_CONFIG_B = OxO;

II Clear CAP6 flag

EvbRegs.EVBIMRC.bit.CAP4INT = l; EvbRegs.EVBIMRC.bit.CAP5INT = l; EvbRegs.EVBIMRC.bit.CAP6INT = l;

// Enable CAP4 Interrupt // Enable CAPS Interrupt

II Fault signal distribution
*FAULT_DISTRIBUTE = OxFFFF;

II Enable CAP6 Interrupt
*PHASE_SHIFT_A = OxBOOO; with Vab.Ox4E58 *DPLL_CONFIG_A = Oxll8; //Ox818 // MS-SVM //Zero Crossing ofVab in phase

/************************************************ Function: void init_interrupt(void)

II bitl2 .. ll 01 PLL feedback signal from overflow of A side PWM
counter

II bit10 ..8 00 input from zero crossing of VA or VAB
Description: Initialization of system control variables

II bit 7 .. 0 divider D=24+ 1,DPLL freq=Fclock/(D+ 1)=6M;
*DPLL_CONFIG_B = Ox118; //Ox818

************************************************/ void init_interrupt(void)

*PHASE_SHIFT_B = *PHASE_SHIFT_A;

/* external interrupt con fig *I XlntruptRegs.XINT l CR. all = OxO; //disable XINT I interrupt XIntruptRegs.XINT2CR.all = OxO; //disable XINT2 interrupt

//*N_MAX_A = MS_SVM_NO- l; // Zero-crossing counter max value // MS-SVM //*N_MAX_B = MS_SVM_NO- l; II Zero-crossing counter max value // MS-SVM

//10 pin configuration

/************************************************ Function: void init_FPGA(void)

*GPIOA6_CONFIG = OxOA; //A side PLL output *GPIOB6_CONFIG = OxOB; //A side SYN signal

Description:

Initialization of FPGA registers, current configuration generates 50KHz pulse train for triggering the thyristors

//XINT interrupt configuration *XINTl_CONFIG = OxO; //Disable XINTl, 2 *XINT2_CONFIG = OxO;

************************************************/ void init_FPGA(void)

*COUNT_CONFIG_A = Ox3504; //Ox7504

//MS-SVM

II bit 15 0 Synchronize Mode II bit 14 l Synchomous PWM counter

II Hardware Protection
*FAULT_ENABLE_A = OxFF; *FAULT_ENABLE_B = OxFF;

II bit 13 .. 12 ll Enable counter A&B II bit 10 l Double buffered registers loaded at counter overflow II bit 8 l Counter running in count up mode (only over flow) II bit 7-0 PWM counter clock lSOMHz/([7 .. 0]+1) = 30MHz

II Thermal Protection (disabled)
*FAULT_THERMO_ENABLE = OxO; *COUNT_CONFIG_B = Ox3504; //Ox3504 *FAN_PERIOD_A = OxO; *FAN_COUNT_A = OxO; *FAN_COMPARE_A = OxO; *FAN_CONFIG_A = OxO; //MS-SVM

II bit 15 0 Synchronize Mode II bit 14 0 Controlled by PWM counter II bit 13-12 ll Enable counter A&B II bit lO l Double buffered registers loaded at counter overflow II bit 8 l Counter running in count up mode (only over flow)

*FAN_PERIOD_B = OxO; *FAN_COUNT_B = OxO;

II bit 7-0 PWM counter clock l50MHz/([7 .. 0]+ l) = 30MHz

110

//FPGA internal operation l50MHz //Fcounter == 150000000/((*COUNT_CONFIG_A & Oxft)+l); //points=((Sw_ freq/Syn_ freq+ I )/2.0)*2-l;

/************************************************

Function:

Close_ Relay(Uint 16 RelayNumber)

/lent_ max=Fcounter/(Syn_ freq *points*2); I /safe_ margin=(Uint 16)(cnt_ max/ l 000);
Description: Close the relay specified by the number

*COMPARE_CONFIG_A == Ox07;

************************************************/ void Close_Relay(Uintl6 RelayNumber)

II bit 5 0 Load gate pattern from preloaded pattern 1 to 3 II bit 4 1 Reference vector rotate direction is CCM (anticlockwise) II bit 3 X SYN_ A, synchronous bit output to GPIOA6 and/or
GPIOB6

switch(RelayNumber)

II bit 2 .. 0 Ill Enable compare 0, I ,2

case l : // Reserved GpioDataRegs.GPBSET.bit.GPIOBl2 == l;

*COMPARE_CONFIG_B == Ox07;

break; case 2: // Reserved GpioDataRegs.GPASET.bit.GPIOA7 == l ; break; case 3: // Relay 3: GpioDataRegs.GPBSET.bit.GPIOB7 == 1; break;

II bit 50 Load gate pattern from preloaded pattern l to 3 II bit 4 I Reference vector rotate direction is CCM (anticlockwise) II bit 3 X SYN_ A, synchronous bit output to GPIOA6 and/or
GPIOB6

II bit 2 .. 0 Ill Enable compare 0, l ,2

*SV_PATTERN_A == Ox0007; II Zero Vector (1,4) *SV_ PATTERN_B == Ox0007; *PROTECT_CONFIG_A == OxOFFO; //Protection not activate *PROTECT_CONFIG_B == OxOFFO;

case 4: // Relay 4: GpioDataRegs.GPBSET.bit.GPIOB ll == l ; break; case 5: II Relay 5: GpioDataRegs.GPASET.bit.GPIOA ll == l;

*COUNTER_PERIOD_A == 600; *COMPAREO_A == 300; *COMPAREI_A == 300; *COMPARE2_A == 300;

break; case 6: II Relay 6: GpioDataRegs.GPASET.bit.GPIOA12 == 1; break;

*COUNTER_PERIOD_B == 600; *COMPAREO_B == 300; *COMPAREI_B == 300; *COMPARE2_B == 300; !************************************************ Function: Open_Relay(Uintl6 RelayNumber)

//Key input Text LCD displace interface //*KEY_IN == OxF; //*SWITCH_IN == OxO;

Description:

Open the relay specified by the number

************************************************! void Open_Relay(Uintl6 RelayNumber)

//FPGA LED *FPGA_LED == OxO; switch(RelayNumber)

II Kp
*PLL_KP_A== OxF9F;

case 1: // Reserved GpioDataRegs.GPBCLEAR.bit.GPIOB 12 == l ; break; case 2: // Reserved GpioDataRegs.GPACLEAR.bit.GPIOA7 == l ;

111

break; case 3: II GpioDataRegs.GPBCLEAR.bit.GPIOB7 = 1; break; case 4: II GpioDataRegs.GPBCLEAR.bit.GPIOB 11 = 1; break; case 5: II GpioDataRegs.GPACLEAR.bit.GPIOA11 = l; break; case 6: II GpioDataRegs.GPACLEAR.bit.GPIOAl2 = 1; break; else if (EvaRegs.GPTCONA.bit.T2ST AT== 0) II negative direction T2CNT_NEW = EvaRegs.T2CNT; tmp = (T2CNT_NEW- T2CNT_OLD);

I* delta_count/ENCODER_PULSE

* 1.5KIENC_SPD_RATE

* pole_pair(2) *I
gen_speed_encoder= _IQ23mpyiQX(_IQ15(tmp), 15, _IQ30(0.1), 30); T2CNT_OLD = T2CNT_NEW;

I* speed calculation *I
if(enc_spd_index == (ENC_SPD_RATE- 1))

I************************************************
Function: void encoder_ speed( void)

T2CNT_NEW = EvaRegs.T2CNT; tmp = (T2CNT_NEW - T2CNT_OLD);

I* delta_count/ENCODER_PULSE
Description: Measure generator speed from encoder

* 1.5K/ENC_SPD_RATE

* pole_pair(2) *I
gen_speed_encoder= _IQ23mpyiQX(_IQ15(tmp), 15, _IQ30(0.1), 30); T2CNT_OLD = T2CNT_NEW;

************************************************I
void encoder_speed(void)

Uint16 tmp;

if (EvaRegs.GPTCONA.bit.T2ST AT== 1) II positive direction

enc_ spd_index++; if(enc_spd_index
=

ENC_SPD_RATE) enc_spd_index = 0;

I* speed calculation *I
if(enc_spd_index == (ENC_SPD_RATE- 1))

112

