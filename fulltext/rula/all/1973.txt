Ryerson University

Digital Commons @ Ryerson
Theses and dissertations

1-1-2012

Sit-To-Stand and Stand-To-Sit Energetics for Assistive Devices and Robotics Design
Ronnie Joseph Wong
Ryerson University

Follow this and additional works at: http://digitalcommons.ryerson.ca/dissertations Part of the Robotics Commons Recommended Citation
Wong, Ronnie Joseph, "Sit-To-Stand and Stand-To-Sit Energetics for Assistive Devices and Robotics Design" (2012). Theses and dissertations. Paper 1674.

This Thesis is brought to you for free and open access by Digital Commons @ Ryerson. It has been accepted for inclusion in Theses and dissertations by an authorized administrator of Digital Commons @ Ryerson. For more information, please contact bcameron@ryerson.ca.

SIT-TO-STAND & STAND-TO-SIT ENERGETICS FOR ASSISTIVE DEVICES & ROBOTICS DESIGN

Ronnie Joseph Wong B.Eng. Ryerson University 2009

A thesis presented to Ryerson University in partial fulfillment of the requirements for the degree of Master of Applied Science in the Program of Electrical and Computer Engineering

Toronto, Ontario, Canada, 2012 c Ronnie Joseph Wong 2012

AUTHOR'S DECLARATION FOR ELECTRONIC SUBMISSION OF A THESIS I hereby declare that I am the sole author of this thesis. This is a true copy of the thesis, including any required final revisions, as accepted by my examiners. I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research. I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research. I understand that my thesis may be made electronically available to the public.

ii

Abstract
This research presents the development of a Sit-to-Stand and Stand-to-Sit model for regenerative energy recovery with applications in orthoses, protheses and humanoid robot design. Sit-to-Stand and Stand-to-Sit are routine activities and are crucial pre-requisites to walking and running. Determining design parameters for devices which can aid people to perform these activities in an effective manner is a key goal here. MapleSim was used to simulate a 1/10-scale multi-domain model and a nonlinear torque controller was used to control the trajectory profiles of the Sit-to-Stand-to-Sit gait. The model allows accurate simulation of hardware components for use in a future robot. This study addresses the usage in regenerative braking towards sit-to-stand-to-sit and the relationship between Coriolis/centrifugal torque components to inertial and gravitational torque components. This study examines the level of regeneration at ankle, knee and hip. Furthermore, it examines the significance of Coriolis and centrifugal versus inertial and gravitational components of a nonlinear controller in order to determine if these components would be needed in a real robot controller. By applying joint trajectories from human trials it was found that the regenerative effect in the robot model was most significant in the hip and least significant in the ankle. Furthermore, we determined that the Coriolis and centrifugal terms were approximately 1% of the inertial and gravitational terms in the applied nonlinear controller, making them insignificant. We also determined upper bounds for gearing in the joints such that battery autonomy is maximized without encountering motor saturation and inaccurate trajectory following. From these findings, we recommmend that robot designs neglect the Coriolis and centrifugal terms and that regenerative hardware be prioritized at the hip.

iii

Acknowledgment
I would like to thank the following people who have been instrumental towards the success of my research: 1. Dr. James A. Smith: my supervisor, for his help and guidance throughout the course of this thesis. Dr. Smith's ability to alway make everything positive has been a huge source of encouragement and support. He has also been a great mentor and in helping me stay focused. 2. Dr. Matt Kyan: professor and friend. Thank you for your support and guidance. 3. Bruce Derwin, Jim Koch, Jason Naughton and Dan Giannitelli: For always being there for my computer issues and causing havok in the EE-labs but still forgiving me for it - thank you. One day, I will get a hold of the master keys! 4. Cindy Ao: thank you for all the great conversations and support. And for your snack tray with all the chocolates. 5. Matija Milosevic: a good friend that has helped me with personal as well as academic advice. 6. Dr. Kei Masani: thank you for all your help at TRI. 7. Jamil Jivraj: a great friend and colleague. Jamil has been there with me through the best of times and worst. And is still supportive as always. 8. Kathryn Atwell: you're cool. Thanks for also forgiving me during the worst of times. Coffee runs aren't the same without you. 9. Igor Ivanecky: a great friend and colleague. He's always available for my spontaneous Chinatown food runs. 10. Valerie Chamberlain: I would not have been able to complete this without you. Thank you. 11. Edwin Steele: a great friend, the guru of the embedded world. Thanks for putting 'regenerative braking' in simple terms. Why didn't I think of that?

iv

Dedication
I would like to thank the following people who I hold very close to my heart and that has always supported me in my endeavors: 1. Parents and Family: Thanks mom, dad and everyone for all your love and support. 2. Grandma: Thank you for always being there - back then and now in my heart, 'never judging but always forgiving. 3. Pamela Qu: to my fiancee, I love you. I would like to thank you for all your love and support. Thank you for believing in me and in our dreams together. 4. Kevin Lougheed / Mauro Godinho: Guys, this research is as much a part of you. Thank you for always being there for me to bounce ideas off of. Thanks for giving me guidance both academically and personally - its helped me survive in the most stressful times.

v

Contents
1 Introduction 1.1 Motivation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1.2 Biomechanics Background . . . . . . . . . . . . . . . . . . . . . . . . 1.3 Humanoid Robots and Assistive Devices . . . . . . . . . . . . . . . 1.3.1 Humanoid Robots . . . . . . . . . . . . . . . . . . . . . . . . 1.3.2 Traditional (Non-Regenerative) Assistive Devices . . . . . . 1.3.3 Regenerative Power and Biomechanical Energy Harvesting 1.3.4 Scope and Objective . . . . . . . . . . . . . . . . . . . . . . . General Modeling of a Planar Robot 2.1 Biomechanics of Sitting & Standing 2.1.1 General Kinematic Model . 2.1.2 General Dynamics Model . 2.2 Actuation . . . . . . . . . . . . . . . 2.2.1 Electrical Motor Model . . . 2.3 Regenerative Braking . . . . . . . . 2.3.1 Four Quadrant Operation . 2.3.2 H-Bridge Theory . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 1 3 4 4 5 6 9 12 14 14 17 18 18 20 20 20 25 25 25 27 27 28 28 35 39 41 47 48 48

. . . . . . . . . . . . . . . . . . . . . . . . . . .

. . . . . . . . . . . . . . . . . . . . . . . . . . .

. . . . . . . . . . . . . . . . . . . . . . . . . . .

. . . . . . . . . . . . . . . . . . . . . . . . . . .

. . . . . . . . . . . . . . . . . . . . . . . . . . .

2

3

Component Design & Simulations 3.1 Kinematic Data . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3.1.1 Data Extraction for Biomechanics Literature . . . . . . . 3.1.2 Kinematic Model Parameters . . . . . . . . . . . . . . . . 3.1.3 Trajectory Generator . . . . . . . . . . . . . . . . . . . . . 3.2 MapleSim Component Design . . . . . . . . . . . . . . . . . . . . 3.2.1 Dynamixel RX-28 Servo . . . . . . . . . . . . . . . . . . . 3.2.2 NiMH Battery Model . . . . . . . . . . . . . . . . . . . . . 3.2.3 Continuous-time H-Bridge Model . . . . . . . . . . . . . 3.2.4 Nonlinear Controller Block . . . . . . . . . . . . . . . . . 3.2.5 Ground Contact Models . . . . . . . . . . . . . . . . . . . 3.3 Parameter Space Search Simulations . . . . . . . . . . . . . . . . 3.3.1 Maple-MapleSim Scripting & MATLAB Post-Processing vi

4

Results and Analysis 4.1 State-of-Charge (SOC) Analysis . . . . . . . . . . . . . . . . . . . . . . 4.2 Effect of Variable Gearing and Battery Voltage . . . . . . . . . . . . . 4.2.1 Trajectory (Position) Tracking . . . . . . . . . . . . . . . . . . . 4.2.2 Angular Velocity Tracking . . . . . . . . . . . . . . . . . . . . . 4.2.3 Supply Voltage Considerations . . . . . . . . . . . . . . . . . . 4.2.4 Torque Analysis: Are Centrifugal & Coriolis terms necessary? 4.2.5 Current/Torque Tracking . . . . . . . . . . . . . . . . . . . . . . 4.2.6 Power Cycles . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4.2.7 Motor and Gearing Selection Space . . . . . . . . . . . . . . . 4.3 Recommendations for Design . . . . . . . . . . . . . . . . . . . . . . . Conclusions Suggested Future Work

. . . . . . . . . .

. . . . . . . . . .

. . . . . . . . . .

. . . . . . . . . .

51 52 55 55 55 58 58 63 63 70 70 73 75 76 84 86 86 88 90 91 94

5 6

A Sit-to-Stand Dynamic Model B Maxon Motor RE-max 17 C Joint Torque Controller Equations C.1 Ankle torque, ankle . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . C.2 Knee torque, knee . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . C.3 Hip torque, hip . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . D Ryerson ELCE-Network Computers E Maple Source-code

F MATLAB Source-code 98 F.1 Checksum . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 98 F.2 Data Extraction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 100 G MapleSim RX-28 Model H MapleSim Battery Test Circuit Model I J MapleSim H-Bridge DC-to-DC Model MapleSim Ground Contact Model 105 107 110 113

vii

List of Tables
1.1 2.1 2.2 2.3 2.4 3.1 3.2 3.3 3.4 3.5 3.6 Operational Time between Charge/Refueling for Active Assistive Devices . Published kinematic and kinetic data on Si2St, Si2St2Si and St2Si2St Stance MapleSim three-segment, three-revolute inverted pendulum parameters . . DC motor equivalent circuit parameters [41] . . . . . . . . . . . . . . . . . . H-Bridge Operation Map . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Anthropometric measurements between a full-scale model (left) and 1:10scaled no-foot model (right). The variables can be found on Fig. 2.1 . . . . Correlation values between raw and filtered signals of the ankle, knee and hip. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Dynamixel RX-28 Performance Specifications [27, 52] . . . . . . . . . . . . Comparison between RX-28 and RE-max 17 Maxon Motors . . . . . . . . . Maxon Motor RE-max 17 data . . . . . . . . . . . . . . . . . . . . . . . . . . H-Bridge simulation times for Continuous-time and Discontinuous-time Models . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6 13 16 19 22

. 27 . . . . 28 32 33 34

. 42

D.1 Hardware specifications in ENG406 and ENG412 . . . . . . . . . . . . . . . . 91 D.2 Computer assignment for Regeneration-Enabled Simulations (ENG412) . . 92 D.3 Computer assignment for Regeneration-Disabled Simulations (ENG406) . . 93

viii

List of Figures
1.1 1.2 2.1 2.2 2.3 2.4 3.1 3.2 3.3 3.4 3.5 3.6 3.7 3.8 3.9 Sit-to-Stand and Stand-to-Sit Motion . . . . . . . . . . . . . . . . . . . . . . . 2 Robot model based on anatomical data [67] scaled by 1:10. . . . . . . . . . . 10 Progressive development of the Si2St2Si "pendulum" model . . . . . . . . Equivalent circuit of a dc motor. Adapted from [41]. The parameter descriptions can be found in Table 2.3 . . . . . . . . . . . . . . . . . . . . . . . Four-Quadrant Operation . . . . . . . . . . . . . . . . . . . . . . . . . . . . Current flow for forward and reverse motor control . . . . . . . . . . . . . Trajectory data after a low-pass Butterworth filter . . . . . . . . . . . . . . Trajectory data after a low-pass Butterworth filter . . . . . . . . . . . . . . GARP5: Example project that also uses the Dynamixel RX-28 actuator. (Photo courtesy of Jamil Jivraj, BioRRG, Ryerson University.) . . . . . . . . RX-28 internal circuitry and motor . . . . . . . . . . . . . . . . . . . . . . . Functional block view of the RX-28 Actuator Model. The MapleSim implementation is found in Appendix G on pg. 105. . . . . . . . . . . . . . . . . MapleSim NiMH Battery Model Test Circuit . . . . . . . . . . . . . . . . . 1-Cell discharge testing at 1C, 4.5Ahr . . . . . . . . . . . . . . . . . . . . . . Block diagram for Test Circuit of the Discontinuous-time H-Bridge Model. The MapleSim implementation is found in Appendix I on pg. 110 . . . . . Functional block diagram for Continuous-time model of discontinuoustime H-Bridge. The MapleSim implementation is found in Appendix I on pg. 110 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . State of Charge versus Time Graph of Continuous-time and Discontinuoustime H-Bridge Models. The initial SOC level is 0.8 at time = 0s . . . . . . . Nonlinear controller derived from Craig [7] . . . . . . . . . . . . . . . . . . Functional block of ground-contact model. The MapleSim implementation is found in Appendix J on pg. 113 . . . . . . . . . . . . . . . . . . . . . . . . Typical motion of MapleSim Model performing Sit-to-Stand and Stand-toSit Motion. Trajectory of the Centre of Mass (COM) is shown, as is the ground-projected COM (gCOM). . . . . . . . . . . . . . . . . . . . . . . . . . 15 . 18 . 21 . 23 . 26 . 29 . 30 . 31 . 35 . 37 . 38 . 39

. 40 . 41 . 45 . 48

3.10 3.11 3.12 3.13

. 50

ix

4.1

4.2

4.3 4.4 4.5 4.6 4.7 4.8 4.9 4.10 4.11 4.12 4.13 4.14

Regeneration-enabled versus regeneration-disabled SOC Deviation comparison (193 Gear Ratio, 18.1V, 4.5 Ahr NiMH Battery). The initial state of the SOC level is 0.8 at time = 0s. . . . . . . . . . . . . . . . . . . . . . . . . . SOC Deviation for varying gear ratios, with regeneration enabled, for one Si2St2Si movement cycle (18.1V, 4.5 Ahr NiMH). The best regeneration results were obtained for the highest gear ratios where there was little deviation change. The initial SOC level is 0.8 at time = 0s. . . . . . . . . . . Angular Position Tracking of the Ankle, Knee, and Hip Joints, 193:1 vs. 600:1 gear ratios (18.1V, 4.5 Ahr NiMH). . . . . . . . . . . . . . . . . . . . . Joint Tracking Error for GR100 to GR600 (18.1V, 4.5 Ahr NiMH) . . . . . . Angular Velocity Tracking of the Ankle, Knee, and Hip Joints (18.1V, 4.5 Ahr NiMH). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Actuator voltage input for ankle, knee and hip joints (note: saturation is most visible at the hip joint) . . . . . . . . . . . . . . . . . . . . . . . . . . . Percent-change in SOC after one Si2St2Si cycle. Shorter bars indicate more efficient operation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Detailed view of ankle torque components. Note that Coriolis & centrifugal components are minimal . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Detailed view of knee torque components. Note that Coriolis & centrifugal components are minimal . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Detailed view of hip torque components. Note that Coriolis & centrifugal components are minimal . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Current tracking for GR193 . . . . . . . . . . . . . . . . . . . . . . . . . . . Current tracking for GR600 . . . . . . . . . . . . . . . . . . . . . . . . . . . Motor electrical power and SOC Performance . . . . . . . . . . . . . . . . . SOC levels after single-Si2St2Si cycle for different battery sizes (12V, 15V, 18V). Regeneration is enabled. Note that the best results occur for highest battery voltage and gear ratio . . . . . . . . . . . . . . . . . . . . . . . . . .

. 53

. 54 . 56 . 57 . 59 . 60 . 61 . 64 . 65 . . . . 66 67 68 69

. 71

B.1 Dynamixel RX-28 Actuator [42] . . . . . . . . . . . . . . . . . . . . . . . . . . 85 E.1 Maplescript Source-code Example . . . . . . . . . . . . . . . . . . . . . . . . 95 E.2 Command-line instructions for starting maplescript . . . . . . . . . . . . . . 96 E.3 Screenshot of Maplescript running . . . . . . . . . . . . . . . . . . . . . . . . 97 G.1 MapleSim RX-28 Model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 106 H.1 MapleSim NiMH Battery Model with SOC and Temperature Ports . . . . . . 108 H.2 MapleSim NiMH battery model test circuit . . . . . . . . . . . . . . . . . . . 109 I.1 I.2 I.3 I.4 Test Circuit for Discontinuous-time H-Bridge Model Exploded view of H-Bridge Subsystem . . . . . . . . Test Circuit for Continuous-time H-Bridge Model . Exploded view of Simplified H-Bridge subsystem . x . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 111 111 112 112

J.1

MapleSim ground-contact model (Courtesy of Gilbert Lai) . . . . . . . . . . 114

xi

Chapter 1 Introduction

T
1.1

HIS thesis examines transistions between sitting and standing. By better understanding the dynamics and energetics of these movements we hope to work towards

objective design methods for designing prosthesis, orthoses and humanoid robots.

Motivation

The study of human, animal and robot locomotion has, in general, focused on steadystate aspects. However, in reality, steady-state locomotion is generally short-lived and is accentuated by frequent transistions between states. The aspects related to starting, turning, standing up, sitting down, accelerating and decelerating of everyday animal, human and now even robot locomotion is a key focus for contemporary research labs. To understand how these transisitions occur and how to control them, we must have a clear understanding of the underlying mechanisms available to the locomotor, whether they are control or mechanical in nature. For instance, elastic storage and release of energy in muscles and tendons play an important role in movement of humans and animals [3] and can be artificially implemented sucessfully in orthotic applications [19]. There are fundamental differences between natural actuators and artificial ones and if we are to develop artificial aides to assist in locomotory activities of people it is important to understand their limitations. This is specially important due to the increasing aging of the baby boomers, population projections indicate one in five Canadians will be 65 or older 1

Figure 1.1: Sit-to-Stand and Stand-to-Sit Motion

by 2026 [66]. Muscle weaknesses, diseases and disabilities such as Parkinsons disease and strokes can lead to declining functional mobility and health in the aging population. This eventually can lead to falls and is the most common cause of injuries among seniors in Canada [6]. Many of the injuries sustained from falling were to the hip, thigh, knee, lower leg, ankle or foot. Fall-related injuries have a significant impact on the well-being of the individual and in Activities of Daily Living (ADL). It can lead to a decline in quality of life as well as to institutionalization. For those that do recover, psychological impact from fear of falling can result in loss of confidence and restriction in daily activities [6]. There is currently a worldwide interest in developing Assistive Technologies (AT) that can assist people with ADLs. It can enable a person to have independence at home, to function independently, as well as to increase their confidence in ADL which leads to an increase in quality of life. Scientific studies have shown that ATs enables patients to have greater self-reliance and less dependence in personal caregiver assistance [24, 38]. 2

It is estimated that 4 million persons required the help of another person with ADL in the US in 2009 [2]. Statistical data gathered by the US-based Medicare Current Beneficiary Survey (MCBS) and the Centres for Disease Control (CDC) in 2008 showed that 11.3% of non-institutionalized Medicare beneficiaries had difficulty with getting in/out of bed/chairs compared to 68.9% for institutionalized beneficiaries [1]. Sitting down and standing up from a chair as shown in Fig. 1.1 is an essential ADL function that precede or follow walking which is a common method of locomotion in humans. There is an ongoing interest in development of humanoid robots, from the pioneering work of Vukobratovic [64] to the recently announced humanoid robotic research program by DARPA [10] in the United States. The work outlined here is applicable to both the robotics and ADL domains.

1.2

Biomechanics Background

There have been a number of studies on the kinematics and dynamics of the sit-to-stand (Si2St) and stand-to-sit (St2Si) activity [31, 51, 54, 44]. The objective is to gain insight into the kinematics and dynamics of the Si2St and St2S movement during normal gait and its performance. This serves as a baseline to analyze Si2St and St2S gait deficiencies and to compare it to therapeutic intervention. Difficulty in rising from and sitting into a chair is common among elderly people and various factors such as Parkinsons Disease and muscle weakness can have a significant impact on the quality of life and confidence of the individual [36]. Rising from and sitting into a chair is a coordinated effort between the trunk and lower extremities and deficiencies in the muscle contractions and joint torques can reduce the performance of this gait transfer. The peak hip joint moment and pressure and muscle strength requirement in the Si2St movement was found to be greater than stair climbing or running [69]. Yoshioka et al. found the relationship between the peak joint moments at the hip and knee joints was cummulative requiring a sum of moments greater than 1.53 Nm/kg [69]. This indicates 3

that there is a prerequisite to the timing profiles of the position and velocities of the lower extremities in order to generate the required joint torques in a stable Si2St and St2Si transfer. When compared to Parkinson's Disease subjects, Mak et al. found that they developed smaller hip flexion torques and a prolonged rate of torque production that disrupts the Si2St performance [36]. Consequently, an inability to develop sufficient joint torques in the lower extremities can increase the risk of falling [28] and hip fractures [6].

1.3

Humanoid Robots and Assistive Devices

Inspired by observations from biomechanics, researchers have developed a wide range of devices to mimic human movements or to assist human movements. Contemporary humanoid robot developments typically trace their lineages back to two camps: slower statically stable systems [63] and faster dynamically stable systems [49]. Assistive devices were mostly passive in nature until the advent of the popular Ottobock C-Leg in 1985. Typically, devices to help raise or lower people with mobility problems tend to be large and are often a fixture of a room (such as those found in hospitals or pools) [29]. A range of new orthotic devices, which contain active components [32] are now being developed. Furthermore, there is interest in both assistive device and humanoid robot communities to develop energy efficient devices, sometimes inspired by technologies such as the Toyota Prius hybrid vehicle. This section explores all three of these issues.

1.3.1

Humanoid Robots

New developments in locomotion control algorithms has led to impressive results. The family of controllers encompassed by Zero Moment Point (ZMP) [65], Centre of Pressure and Foot Rotation Index [20] has permitted the development of capable bipeds such as the Honda Asimo [22] and TUM Johnnie [59]. An alternative approach was taken, beginning in the 1980s to simplify substructures, sensing, actuation and control to aid in the better 4

understanding of the dynamics of legged locomotion. This approach led to robots such as the MIT Quadruped and Boston Dynamics BigDog and McGill PAW robot [60], which incorporate dynamic effects into the control mechanisms, permitting fast and relatively robust control. In the past, much attention has been placed on steady state humanoid walking [65, 20, 59]. Transitional behaviors such as standing up and sitting down have received less attention, likely due to the tendency of these behaviors to transistion the robot out of clearly defined stability boundaries, such as the ZMP. However, with the success of dynamically stable robots such as PETMAN [14], this is changing. Yamamoto and Kuniyoshi [68] examined how body dynamics could be exploited by humanoid robots while rising up. Likewise, Kanehiro et al. [30] examined rising from the ground, rather than from a chair, likely due to contemporary robot competitions such as RoboCup. At Disney Research Pittsburgh, Mistry et al. examined coordination and control of the body's center-of-mass (COM) during the Si2St motion between a human and Carnegie Mellon's Sarcos humanoid robot [40].

1.3.2

Traditional (Non-Regenerative) Assistive Devices

There is an ongoing development of technology in assistive devices that are commercially available and in research and development. They range from commercially available passively-supported grab bars and standing frames that provide the user stability during rising to the high performance and powered exoskeletons such as the eLEGS by Berkeley Bionics and the Cyberdyne HAL [43, 61]. The eLEGS allows a person with lower-extremity paralysis or weakness in muscles to stand and walk again while the HAL uses servo actuators located at the joints to improve the physical capability of the user. Kobetic et al. have developed a hybrid system of an exoskeletal bracing and a multichannel functional electrical stimulation (FES) component. Together, this system aides a person with spinal cord injury (SCI) to walk, stand and stair climb. Mobility is

accomplished by coordinating the hydraulic hip actuators with a knee clutch that en-

5

System Ottobock C-Leg Ekso Exoskeleton Cyberdyne HAL Boston Dynamics' LS3 Boston Dynamics' Big Dog Kobetic et al. hybrid orthoses Raytheon Sarcos

Time between Refueling/Charging 40 - 45 hours 3 hours 5 hours 20 miles with 400lb payload capacity 12.8 miles with 340lb payload capacity 4 hours N/A, thethered

Table 1.1: Operational Time between Charge/Refueling for Active Assistive Devices gages/disengages during stance and swing. Ankle movement is controlled by the FES. The Ottobock C-Leg [45] is a microprocessor-based prosthetic leg. The microprocessorcontrolled hydraulics in the leg dynamically adapts the leg motion to all walking speeds. This allows the wearer to walk without having to focus on walking with a reduction in falls. Actuated assistive devices are also of interest to the military. The Raytheon Sarcos [50] is a powered exoskeleton with the ability to lift 200 lbs with minimal strain to the wearer. The suit is built with a combination of sensors, actuators and high-pressure hydraulics. It currently is tethered to a power supply. The active devices described above all allow the wearer freedom in its environment. The trade-off is that it requires a battery storage unit which can interfere with the natural dynamics of the gait and limit the duration of the usability of the system. Table 1.1 lists the operational time between charges or refueling for the described systems. All active systems require fuel or battery power and therefore have a finite operational life. Therefore it is desirable to explore alternative technologies that can extend the operation time between refueling/recharging.

1.3.3

Regenerative Power and Biomechanical Energy Harvesting

There has been active interest in recent years in regenerative power. This technology is most active in the automotive industry for its use hybrid and electric automotive vehicles

6

and has also benefitted the e-bike industry [62, 17]. The design of next generation active orthoses, prostheses, and powered exoskeletons may take advantage of the benefits of this technology. The idea behind regenerative power is to collect power from the motor during braking and reuse it with the objective of improving the energy utilization of the machinery or system. Similarly, biomechanical energy harvesting is the collection of energy by converting mechanical power into electrical power. The conservation and renewability of power is a necessary design consideration for electrical devices which operate on modular battery power. These considerations make regenerative systems an attractive addition to active orthoses designs [35]. Two well known and successful university research and development projects that have spun out into business entities include the PowerWalk by BionicPower and Lightning Packs by Lightning Packs [5, 46] while another successful university research team has been actively working on a regenerative braking-based lightweight prosthetic foot [23]. PowerWalk The PowerWalk converts mechanical power to electrical power via an electric generator attached to the knee. PowerWalk was originally conceived by Donelan et. al. at Simon Fraser University, British Columbia and it selectively engages and disengages the power generation during negative cycles of the walking gait. The movement of the knee joint during walking can be used to generate electricity through a regenerative system and subsequently power the orthoses with negligible additional input from the user. The system will selectively engage when the body is performing negative work. In a healthy gait, this occurs during the end of the swing phase. At this time the muscles of the leg are resisting the movement of the joint and negative power is produced [48]. A regenerative system for human activity relies on metabolic energy from the individual as its input and provides electrical energy as its output. The system can be attached across a joint which inherently provides a large range of motion

7

during walking such as the knee. Positioned on the sagittal plane the device generally contains a one-way clutch which turns spur gears during the end swing phase. At this point metabolic power from the individual is transformed into mechanical power. The gears will increase the angular velocity of the joint movement and translate its torque to the armatures of a brushless DC rotary magnetic generator, converting the mechanical power into electrical power [48]. Lightning Pack The Lightning Pack was spun out from research led by Rome et. al. at the University of Pennsylvania. It is another biomechanical energy harvester that takes advantage of the dynamics of the walking gait to collect energy. In their design, a load cell is suspended via springs. Movement drives the spring-mass system and the oscillating kinetic energy is converted into electrical energy and stored in super capacitors [55]. The major benefit of this system is that the backpack generates more electrical energy during human locomotion than any other human energy harvesting method currently available. SPARKy - Active Robotic Ankle using Regenerative Kinetics Sugar et al. have developed a lightweight prosthetic foot based on regenerative kinetics and is a form of regenerative braking [23]. Here, the momentum energy during motion is conserved in the form of compliant springs during compression (braking of the foot fall) and that energy is redirected during the stance phase (retracting to lift-off of the foot). Since energy is stored, a light-weight DC motor can adjust the optimal power required for a given gait and this reduces the effort required by the individual. The energy storage ability of the springs also helps to reduce the overall size and weight of the device. The first two models were designed for a walking gait. The team is currently working on the third revision which allows running and jumping without increasing the overall weight of the device when compared to its two previous models [4].

8

1.3.4

Scope and Objective

In this dissertation, the objective is to provide an empirical quantification of the functionality and energy utilization improvement of a Si2St and St2Si activities through the use of regenerative power. The hypothesis is that through regenerative braking, energy can be recovered during certain phases and injected back into others. A computer simulation model was developed using MapleSim 5.0 and Matlab was used to process the data. The model shown in Fig. 1.2 is based on scaled parameters from Winter [67]. Utilization of rapid prototyping software tools such as Maplesoft MapleSim and Mathworks Matlab allow for optimization of the electrical generator characterization to answer questions such as: What is the best gearing for energy recovery and joint load reduction without impeding natural gait dynamics? What are the significant components of the nonlinear controller and what can be reasonably removed in a future robot controller?

Overview of Thesis · Background: Sit-to-stand (Si2St) and stand-to-sit (St2Si) (see Fig. 1.1 is an essential activity of daily living that requires sufficient strength in the leg muscles and places large moments on the joints during movement. Much of the Si2St and St2Si movement is attributed to the hip and knee joints with very little movement at the ankle. Little effort is required by healthy individuals to perform these motions but patients suffering from muscular deficiencies such as stroke recovery, Parkinson's Disease and age may experience minor to major difficulties. Difficulties in the stability of the Si2St and St2Si transfer will therefore increase the likelihood of injuries. · Observation: Regenerative braking is a common technology that is actively used in the automotive and electric bike industries. During braking, the electric motor acts as a generator and recovers some of the electrical power that would otherwise be lost due to mechanical friction in the form of heat. As a generator, the motor is reversed and the electromotive torque acts a braking mechanism against the direction of the 9

vehicle. · Hypothesis: We can apply regenerative technology to the hip, knee and ankle joints in sitting and standing transistions. During regeneration, electrical power can be recovered and stored. Some of the energy can then be used to power the active Si2St motion thus extending the duration of battery life between charge cycles. · Simulation: Using biomechanical data, a 1:10 scaled computer simulation of the robotic surrogate has been developed in Maplesoft MapleSim 5.0, as shown in Fig. 1.2. The model's electric actuators (generator) are based on the Robotis Dynamixel RX-28. Kinematic parameters are based on Winter's textbook [67] and scaled according to the 1:10 requirement. Maple is used to run simulations to optimize for energy recovery by varying motor gearing and battery voltage parameters. Through an inverse dynamics model and using the kinematic parameters, joint torques are extracted from the data and scaled to 1:10 to provide parameters for the computer model.

Figure 1.2: Robot model based on anatomical data [67] scaled by 1:10.

· Outcome: Through regenerative braking, the robotic surrogate simulation demon10

strated regenerative energy capturing at the joints during braking of the St2Si motion. It was found that hip regeneration is found to be the most significant that while better energy usage is found with using larger gear ratios, an upper bound of 520:1 is found beyond which motor saturation leads to inaccurate tracking of the desired joint trajectories. Lastly, the Coriolis and centrifugal terms of the nonlinear controller were found to be insignificant.

11

Chapter 2 General Modeling of a Planar Robot

I

N order to examine the energetics inherent in transistioning from siting to standing and vice-versa we begin by analysing the motion in human subjects. A number of peer-

reviewed publications have been examined for this, with the data by Kralj [33] selected for examination. In order to examine how the human subject's dynamics can be incorporated into humanoid robot or robot prosthetic design, a nonlinear dynamics controller was developed to coordinate and control each of the ankle, knee and hip joints. The robot simulation examined in this thesis is shown in Fig. 2.1c. Each of the humanoid robot's ankle, knee and hip joints is actuated by a servo actuator. Regenerative braking is realized through four-quadrant operation of the DC motor (inside the servo actuator) via an H-Bridge. This chapter details the background and theory that is used to drive the kinematics of the robot model. Specifics related to anatomical dimensioning, joint trajectories and motor characteristics are discussed in Ch. 3. The resulting dynamics data is examined in Chapter 4.

12

Author 10 (23 - 35) Si2St Yes (hip/knee/ankle graphs) No Yes (hip/knee/ankle graphs) Yes (hip/knee/ankle graphs) No Yes (Engauge)

# of Subjects (Age)

Transfer Motion

Kinematic

Kinetics

Extractable Data?

Roebroeck et al. [54]

Kerr et al. [31] Mak et al. [36]

Si2St2Si Si2St

No Yes (Engauge)

Yoshioka et al. [69]

50 (20.1 - 78.3) 13 (63 - 72) [6 Healthy,7 Parkinson's Disease] 5 (23 - 29) Si2St

Yes (Engauge)

Schultz et al. [57]

51 (19-31:63-86:75-92) [17 Healthy:23 Healthy Elderly:11 Assistancerequired Elderly] N/A (Simulated data) Si2St2Si Si2St 55 (20 - 48)

Si2St

No

Hemami et al. [21]

No (figures are faint) Yes (MATLAB)

13
20 (24 - 51) Si2St2Si 9 (23.5 - 30.5) 6 (20 - 30) Ltd 1 (no subject data) St2Si2St Si2St Si2St Yes (hip/knee/ankle graphs) Yes (hip/knee/ankle graphs) Yes (hip/knee/ankle numerical data)

Nuzik et al. [44]

Yes (joint torque and velocity graphs) No Yes (ground force and joint torque graphs) Yes (joint torque and velocity graphs) Yes (Mean joint torque values with comparison values from other literature) Yes (joint torque graphs) No

Kralj et al. [33]

Yes (hip/knee/ankle graphs) Yes (hip/knee/ankle numerical data) Yes (hip/knee/ankle graphs)

Yes (Engauge)

Doorenbosch et al. [13]

Yes (Engauge) Yes (Engauge) Yes (MATLAB)

Shepherd et al. [58]

Eyes, JAPAN Co. [16]

No (raw force plate data only) Yes (joint torque graphs) Yes (joint torque graphs) No

Table 2.1: Published kinematic and kinetic data on Si2St, Si2St2Si and St2Si2St Stance

2.1

Biomechanics of Sitting & Standing

A robot model was created in MapleSim to mimic a 1/10th scale human adult male, based primarily on data from [67]. The model is based on the kinematics and dynamics for a three-segment-three-revolute manipulator arm. To study the energetics of the Si2St2Si motion, we require motion data of the gait. There has been extensive research on lower extremity kinematics of the Si2St and Si2St2Si movements but limited papers on St2Si. There has generally been more focus on the Si2St movement as it is a prerequisite for gait (like walking and running) while Si2St2Si and St2Si requires greater control effort durint the sit-down phase. Sitting-down requires more joint and muscle control since the person is generally not looking at his/her approach towards the chair. Table 2.1 is a summary of published articles that contain kinematic information. In this chapter we examine the fundamental development of the generalized robot model, with specifics related to anatomical features and joint trajectories discussed in Ch. 3.

2.1.1

General Kinematic Model

Maplesoft's MapleSim 5 was used to perform kinematic and dynamic simulations [37]. MapleSim is a physical modeling and simulation tool that we used to develop our multibody biomechanical model. A one degree of freedom (DoF) inverted pendulum model (Fig. 2.1a) was first constructed in MapleSim as a basis for understanding modeling and control. The nonlinear angular trajectory controller was derived from Craig [7, pg 293-94] and is explained in greater detail in section 2.1.2. Two biomechanical models were then developed that extended the one DOF model. The first model features a ground-fixed ankle while the second model features a foot with two ground-contact points (heel and ball of foot). A review of literature on biomechanical research show that most computer models exploit sagittal plane symmetry and use one leg in simulations [21, 51, 69, 36, 11]. To simplify analysis, this research will also use sagittal symmetry to simplify the model. 14

1 m1 l11 l12 COM REVOLUTE

(a) Single DOF inverted pendulum model (left) and MapleSim model (right)

m3 3 l31 l22

l32

m2  2 l21 1 m1 l11 l12

NO FOOT

(b) Ground-fixed 3-segment, 3-revolute inverted pendulum (left) and 3D MapleSim model (right)

m3 3 l31 l22

l32

m2 l21

2

1

m1 l11 l02 m0 FH FB

l12

l01

(c) 3-segment, 3-revolute inverted pendulum with foot (left) and 3D MapleSim model (right)

Figure 2.1: Progressive development of the Si2St2Si "pendulum" model

15

Parameter 1 2 3 m0 m1 m2 m3 l01 l02 l11 l12 l21 l22 l31 l32 FH FB

Description Ankle angle Knee angle Hip angle Foot mass Shank mass Thigh mass Head,arms,trunk (HAT) mass Lower foot segment length Upper foot segment length Lower shank segment length Upper shank segment length Lower thigh segment length Upper thigh segment length Lower HAT segment length Upper HAT segment length Foot heel force Foot ball force

Unit [deg .] [deg .] [deg .] [kg] [kg] [kg] [kg] [m] [m] [m] [m] [m] [m] [m] [m] [N] [N]

Table 2.2: MapleSim three-segment, three-revolute inverted pendulum parameters

Since feet movement is not required and moves very little in the Si2St and St2Si movement, the first computer model was simplified to a three-segment, three revolute inverted pendulum model [8] where the ankle was fixed to the ground (i.e. no foot). This is shown in Fig. 2.1b and the equivalent MapleSim 3D world model is shown on the right. The model parameters are described in Table 2.2. Our second computer model is unhinged from the ground and two ground contact models are added to represent the foot (heel and ball of foot contact points). This allows us to measure the contact forces exerted by the model onto the ground. This is shown in Fig. 2.1c and the parameters are described in Table 2.2.

16

2.1.2

General Dynamics Model

To begin, the equation of motion for the pendulum of Fig. 2.1a is shown in Eq. 2.1. This was generated using the MapleSim multibody analysis worksheet function. d2 d2 2  ( t ) + l m 1 (t) + sin(1 (t))l11 gm1 (2.1) 1 11 1 dt2 dt2 where  is the joint torque, Izzshank is the z-axis inertia, l11 is the lower link length, 1 is the (t) = Izzshank revolute angle, m1 is the link center of mass and g is the gravitational constant. Following a similar approach to the single pendulum, the equations of motion were generated for the fixed-ankle model (Fig. 2.1b). This assumes that foot movement is neglible during the Si2St and St2Si movements and therefore behaves as a three-segment, three-revolute inverted pendulum. The rigid-body dynamics have the form ¨ + V (,   ) + G()  = M()

(2.2)

 ) is where M() is the n x n mass matrix of the three-segment, three-revolute arm, V(,  an n x 1 vector of centrifugal and Coriolis components, and G() is an n x 1 vector of gravitational components.The mass matrix for Fig. 2.1b is represented by a 3 x 3 system of the form   1 2 3          M() =      1 2 3  1 2 3 The 3 x 1 vector of centrifugal and Coriolis components is of the form    1   2   ) =  V (,        3 and the 3 x 1 vector of gravitational components is of the form   1         G() =     2  3 The expanded form for Eq. 2.3 - 2.5 can be found Appendix A. 17

(2.3)

(2.4)

(2.5)

Figure 2.2: Equivalent circuit of a dc motor. Adapted from [41]. The parameter descriptions can be found in Table 2.3

2.2

Actuation

In each of the model's actuated joints is a servo that is composed of a DC permanent magnet (PM) motor and a gear box. This section describes the electromechanical relationship in a DC PM motor.

2.2.1

Electrical Motor Model

We require a direct current (DC) motor model in MapleSim to simulate our Dynamixel RX-28 actuator. One method is to use the Maple custom component worksheet to create a DC motor model from a set of mathematical equations that describe the conversion between electrical and mechanical power. The equivalent circuit of a dc motor is shown in Fig. 2.2 and is described in Mohan [41, pg. 7-13 - 7-15]. A summary of the variables is described in Table 2.3. The armature current ia produces an electromagnetic torque

18

Parameter ia va Ra La ea m JM JL Tem TL

Description

Unit

armature current A armature voltage V armature resistance  armature inductance H back-electromotive force (back-emf) V motor shaft rotational speed rad/s Motor inertia kg · m2 Load inertia kg · m2 Electromagnetic torque Nm Load torque Nm

Table 2.3: DC motor equivalent circuit parameters [41]

Tem = kT ia

(2.6)

where kT is the motor torque constant that is given in the manufacturer motor datasheet. The rotational speed of the motor m induces a voltage that is proportional to the rate at which the conductors cut through a magnetic field. This induced voltage is also called the back-electromotive force (back-emf). This voltage opposes the armature voltage and its magnitude can be calculated by ea = kE m

(2.7)

where kE is the motor voltage constant that is given in the manufacturer motor datasheet. The electrical and mechanical equations that describe Fig. ?? are va = ea + Ra ia + La and dm 1 = (Tem - TL ) dt ( JM + JL ) The above equations are used to simulate the DC permanent magnet motor model. 19 dia dt

(2.8)

(2.9)

2.3

Regenerative Braking

Regenerative braking refers to using the power associated with the counter electromotive force (CEMF) voltage of an electric motor to charge a battery. In normal operation mode, the battery is used to provide positive power to an electric motor. In braking, the electric motor acts as a generator and negative power assists in injecting energy back into the battery.

2.3.1

Four Quadrant Operation

Four quandrant operation of a DC motor refers to the four possible regions that a dc motor can operate in. This is shown in Fig. 2.3. In quadrant one, positive velocity and positive torque is applied to the system and therefore will be in motoring mode generating positive power. In quadrant two, the system is braking but continues to have positive momentum (hence positive velocity due to the inertia of the system). However, the torque is now negative and therefore generates negative power. During braking, if the CEMF and inductance of the motor wiring were to generate a voltage greater than the applied motor voltage, the resulting effect will be a reverse current (i.e. negative current) through the motor circuit. Since electric motor torque is proportional to the current, a negative current will result in negative torque. The motor is acting as a generator. Similarly, quadrant three is in motoring mode but in the reverse direction. Quadrant four is in braking.

2.3.2

H-Bridge Theory

The circuit in Fig. 2.4a is called an H-bridge for its four switching elements (Q1 to Q4 ) that are located in each corner of the 'H-configuration' with a load sitting across the middle bar. Q1 and Q2 will be referred to as high-side switches while the bottom bridge will have low-side switches. The bridge takes in a DC single supply voltage and applies four quadrant control to the load via the switching elements. In general, all switches can be turned on and off 20

Speed, 

:-'ve :+'ve

:+'ve :+'ve

batt

M

CEMF

batt

M

CEMF

(GENERATOR) II (MOTORING) III

I (MOTORING) IV (GENERATOR)



batt

M

CEMF

batt

M

CEMF

:-'ve :-'ve

:+'ve :-'ve

Figure 2.3: Four-Quadrant Operation

21

Switch State Q1 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 Q2 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 1 Q3 0 0 1 1 0 0 1 1 0 0 1 1 0 0 1 1 Q4 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 Bridge/Motor Effect n/a n/a n/a Dynamic braking n/a Not permitted Reverse/Regeneration Not permitted n/a Forward/Regeneration Not permitted Not permitted Dynamic braking Not permitted Not permitted Not permitted

Table 2.4: H-Bridge Operation Map independently but certain switching combinations will result in bridge failure. Table 2.4 is a mapping of the possible on and off states and its effect on the bridge. The motor is engaged forward when switch Q1 and Q4 are on as shown in Fig. 2.4b. This allows current to flow through the positive terminal of the motor. Similarly, reversing the direction of the motor is achieved by switching Q2 and Q3 on (Fig. 2.4c). Dynamic braking is achieved by either turning on the high-side switches or turning on the low-side switches. This effectively shorts the motor and the generator effect of the motor works against itself. Switches on the left-side or right-side must never be turned on at the same time (i.e. Q1 and Q3 on) as this will cause a shorting between power and ground. Sign-Magnitude Drive Sign-magnitude drives require a direction signal bit and another bit to vary the power (PWM) delivered to the motor. One control method is to enable one of the low-side

22

(a) H-Bridge Schematic with Motor

(b) Motor forward control

(c) Motor reverse control

Figure 2.4: Current flow for forward and reverse motor control

23

switches (i.e. forward or reverse) while its corresponding high-side switch is pulsed (PWM). Another method is to have the signal bit turn on one high-side/low-side switch pair (i.e. Q1 and Q4 or Q2 and Q3 ) and have the power bit enable the PWM power to the bridge. Regenerative energy is acquired when the back-emf voltage is greater than the applied voltage to the motor. When the switch pairs are on in braking, negative current is fed back into the power supply. However, regeneration is recoverable only in the direction that the direction bit is activated. Locked Anti-Phase Drive In locked anti-phase drive mode, the bridge is always powered on and is forward and reverse driven at each cycle. One single PWM signal is sent to the bridge that engages or disengages diagonally opposite pairs of switches, hence "anti-phase." If a 50% duty cycle is applied to the bridge, the average voltage across the motor terminals is zero. If we increase the duty cycle greater than 50%, the average on-time across the motors will be greater on the left-side than on the right-side and the average applied voltage will drive the motor direction forward. Similarly, motor reversal is achieved when the duty cycle is below 50%. Since the bridge is always active in both forward and reverse directions, regeneration happens automatically in all four quadrants. The PWM control resolution is also reduced by half when compared to the sign-magnitude drive mapping. Whereas the sign-magnitude drive system can utilize the full spectrum of the PWM signal for one direction, the locked anti-phase drive has to use the same signal to control forward and reverse directions. Our simulations will be modeled after the locked anti-phase drive for its simplicity in using one control signal bit (PWM) to modulate motor power, for its autonomous four quadrant operation and for its compatibility with the continuous-time model. The details for this model will be discussed in section 3.2.3.

24

Chapter 3 Component Design & Simulations

T

HE process of simulation and analysis is widely used in the industry and has helped to reduce total design time by finding errors and/or improvments early during the

design stage before its implemented in hardware development. This section presents simulation and design for a scaled robot. The model was used to show and verify possible regenerative energy recovery during specific phases of the Si2St and Stand to Sit (St2Si) movements. First, a computer model was designed with the proposed 1/10-scaled anthropometric data and hardware specifications. The computer model follows Sit to Stand, Stand to Sit trajectories from extracted biomechanical data in the form of a look-up table. Next, the proposed hardware is examined in simulation to show that it will generate the required joint torques to follow the desired trajectory. Finally, a 1/10 scaled robot model is developed with Dynamixel RX-28 actuators to actuate the ankle, knee and hip joints in MapleSim.

3.1
3.1.1

Kinematic Data
Data Extraction for Biomechanics Literature

The simulation model and proposed robotic testbed requires trajectory data for the ankle, knee and hip joint actuators. Since we are interested in determining the specific phases of one complete Si2St2Si cycle for electrical energy recovery, it is desired to have a continuous Si2St2Si or Si2St and St2Si combinations per subject trial. It was mentioned in Chapter 1 25

Ankle|Knee|Hip Trajectory Control for Gear Ratio 193 120 100 80 Angle,deg. 60 40 20 0 -20 0 2 4 Time,s 6 8 10 Ankle Knee Hip

(a) Original data from [33] being examined by Engauge [15] and

(b) Extracted data plotted in MATLAB

Figure 3.1: Trajectory data after a low-pass Butterworth filter that age plays a significant factor in the Si2St and St2Si gait as required muscle strength in performing the movement decreases with increasing age. Since we were looking for a general baseline of normal trajectories for the robot, it was therefore important to choose datasets that were composed of young healthy adults. Since we did not have access to the original Si2St and St2Si datasets, we extracted datapoints from various high-quality print published literatures using a software tool called Engauge as shown in Fig. 3.1a. Engauge extracts data points by digitizing the original graphical plot and the user traces over the digitized plot by placing points along the curve. The extracted data is saved as a Microsoft Excel file that can be imported into the MapleSim model. Fig. 3.1b shows a MATLAB plot of the extracted data. There were five papers [54, 36, 69, 13, 58] that published the clearest Si2St joint trajectory profile figures for Engauge extraction.From Table 2.1, Hemami et al. [21] and Kralj et al. [33] published complete Si2St2Si kinematic trajectory figures for the lower extremity joints. However, only [33] were suitable for extraction. The axes are calibrated by adjusting the length of the scaling bar and entering the minimum and maximum axis values. Engauge then uses extrapolation to find all the data points on the curve. However, the precision between the digitized plot and the

26

Parameter Shank length [cm] Thigh length [cm] Hip to HAT (Head,Arms,Torso) [cm] Shank mass [kg] Thigh mass [kg] HAT mass [kg]

Variable l11 + l12 l21 + l22 l31 + l32 m1 m2 m3

1:1 Scale 43.3 43.1 33.4 3.2 6.8 46.0

1:10 Scale 4.33 4.31 3.34 0.32 0.68 4.60

Table 3.1: Anthropometric measurements between a full-scale model (left) and 1:10-scaled no-foot model (right). The variables can be found on Fig. 2.1 original data plot is dependent on the number of placed data points. The use of original biomechanical data would be an ideal and accurate method for trajectory generation but this method is sufficient with some limitations in accuracy.

3.1.2

Kinematic Model Parameters

Kinematic parameters for the robotic surrogate are derived from experimental subject data collected from Roebroeck et al. [54] and anthropometric segment ratios from Winter [67]. Ten healthy subjects with a mean age of 27 ± 3.5 years, mean height of 1.76 ± 0.1 m and a mean weight of 67.8 ± kg participated in Roebroeck et al.'s study. The anthropometric summary based on this data is summarized in Table 3.1 in the left and 1/10-scaled data on the right.

3.1.3

Trajectory Generator

The ankle, knee and hip trajectories that were collected from Kralj et al. [33] were ported into MapleSim. There was significant noise in the trajectories due to digitization extraction. A low-pass Butterworth filter (with a filter order of two and 5 Hz cut-off frequency) was then applied to the trajectory signal to smooth out the noise. As shown in Fig. 3.2a, the two signals have a close correlation to each other. The MATLAB 'xcorr' command was used to determine the cross-correlation between the two signals. The two signals have a cross-correlation index of 0.999 with a time-lag of 10.

27

MATLAB xcorr Results Joint Parameter Ankle Trajectory Knee Trajectory Hip Trajectory Correlation Index 0.999 0.999 0.999 Time-Lag 10 10 10

Table 3.2: Correlation values between raw and filtered signals of the ankle, knee and hip. Similarly, the knee and hip trajectories were also passed through the same filter and their figures shown in Fig. 3.2b and in Fig. 3.2c. Table 3.2 summarizes the cross-correlation results determined from MATLAB.

3.2
3.2.1

MapleSim Component Design
Dynamixel RX-28 Servo

Actuation of the lower limb joints of the robot model will require electrical actuators capable of generating the required trajectory torques and angular speeds. The largest moment force will be experienced at the knee during initial chair lift-off. From Table 3.1, the maximum knee torque for the 1/10-scaled model was calculated to be 0.22 Nm assuming that chair lift-off is 90 degrees. The maximum angular velocity amongst the joints is located at the hip and measured to be approximately 100 deg/s (or 1.75 rad/s) [54]. Our objective was to develop a low-cost off-the-shelf prototype to study regenerative braking feasibility towards lower extremity orthosis/prothesis applications. To meet this requirement, we used existing components in the lab. Within the Biomedical Robotics and Rehabilitation Group at Ryerson University, our lab uses Dynamixel RX-28 actuators for many of the lab projects. Fig. 3.3 is an example of a legged robot project that uses the Dynamixel RX-28. The Dynamixel RX-28 actuator is a high performance digital servo shown in Fig. 3.4a. The unit comes off-the-shelf with internal circuitry to track angular shaft speed, angular shaft position, voltage and load over a RS-485 communication bus (Fig. 3.4c). It has

28

Original versus Filtered Trajectory Signal (Ankle) -0.1 -0.15 Angle,rad. -0.2 -0.25 -0.3 -0.35 -0.4 0 2 4 Time,s 6 8 10 Original Signal Butterworth Low-Pass Signal

(a) Ankle trajectory data extracted using Engauge ("original signal") and after a low-pass Butterworth filter
Original versus Filtered Trajectory Signal (Knee) 1.5 Angle,rad. Original Signal Butterworth Low-Pass Signal

1

0.5

0 0

2

4 Time,s

6

8

10

(b) Knee trajectory data after a low-pass Butterworth filter
Original versus Filtered Trajectory Signal (Hip) 0.5 0 Angle,rad. -0.5 -1 -1.5 -2 0 2 4 Time,s 6 8 10 Original Signal Butterworth Low-Pass Signal

(c) Hip trajectory data after a low-pass Butterworth filter

Figure 3.2: Trajectory data after a low-pass Butterworth filter 29

Figure 3.3: GARP5: Example project that also uses the Dynamixel RX-28 actuator. (Photo courtesy of Jamil Jivraj, BioRRG, Ryerson University.)

30

(a) Off-the-shelf RX-28

(b) RX-28 internal motor

(c) Original RX-28 internal circuitry including microcontroller and power stage (H-bridge)

Speed [rad/s] vs Torque [Nm] (Electrical) 1400 Angular speed,rad/s 1200 1000 800 600 400 200 0 0 0.005 Torque,Nm.
(d) Speed versus Torque Graph of RE-max 17 in MapleSim 5.0. Saturation is evident in the curve from lower right to the upper left.

0.01

0.015

Figure 3.4: RX-28 internal circuitry and motor 31

Parameter Weight Gear Ratio (material) Operation Voltage

Published Values

Metric Values 0.072 kg n/a n/a n/a n/a n/a 3.62 Nm (at 18.5 V, 1.9 A) 2.78 Nm (at 12.0 V, 1.2 A) 6.3 rad/s (at 12.0 V) 8.3 rad/s (at 16.0 V) 8.9 rad/s (at 18.5 V)

72 g 1:193 (metal) 12 V - 18.5 V 12 V (Nominal) 14.8 V (Recommended) 18.5 V (Maximum) Stall Torque (after gearing) 37.0 kgf.cm (at 18.5 V, 1.9 A) 28.3 kgf.cm (at 12.0 V, 1.2 A) No load speed (after gearing) 60 rpm (at 12.0 V) 79 rpm (at 16.0 V) 85 rpm (at 18.5 V) Motor "Proprietary Maxon Motor"

Table 3.3: Dynamixel RX-28 Performance Specifications [27, 52] a built-in microcontroller that continuously monitors and handles all the control and communication. The RX-28 hardware and performance specifications are listed in Table 3.3. Next, the RX-28 actuator was modeled in MapleSim. To develop the actuator, electrical and mechanical parameters of the Maxon motor inside the RX-28 were required. However, Robotis and Maxon Motors have made this information proprietary. To determine the motor parameters, we extracted the motor from its plastic casing to measure its physical dimensions (Fig. 3.4b). The nameplate number on the motor was 275338. A Procise Vernier caliper (model #: 0121230) [47] was used to measure the dimensions of the motor. The diameter was measured to be 17 mm with a length of 25.2 mm. The mass of the motor was measured to be 0.026 kg using a Starfrit 93016 digital scale [26]. The terminal inductance and resistance of the motor were each measured three times and averaged with a Wavetek Meterman LCR55 component tester [39]. The user's manual data on the gear ratio, stall torque and no-load speed at nominal voltage (at shaft-output) was used to determine the input-shaft no-load speed and stall torque

32

RX-28 Maxon Motor Parameter Stall torque (shaft input) No-load speed (shaft input) Nominal voltage Start current Terminal resistance Terminal inductance Motor diameter Motor length Motor weight Nameplate data Maxon RE-max 17 [42] 0.0144 Nm 11500 rpm (1204 rad/s) 12.0 V 1.45 A 8.30 0.206 mH 17 mm 25.4 mm 0.026 kg 214897 Calculated/Measured 0.0144 Nm 11580 rpm (1212 rad/s) 8.55 (avg.) 0.196 mH (avg.) 17.0 mm 25.2 mm 0.026 kg 275338 Robotis [27, 53] 3.63 Nm (gear output shaft) 8.90 rad/s (gear output shaft) 12.0 V 1.2 A n/a n/a n/a n/a n/a n/a

Table 3.4: Comparison between RX-28 and RE-max 17 Maxon Motors

gear sha f t speed (rpm) x gear ratio = motor sha f t speed (rpm) 60 rpm x 193 = 11580 rpm (3.1)

gear stall torque (Nm) / gear ratio = motor stall torque (Nm) 2.78 Nm / 193 = 0.0144 Nm (3.2)

With the calculated values in Eq. 3.1 and 3.2, measured dimensions and measured electrical characteristics, the RX-28 motor was a close match to the Maxon RE-max 17, order number 214897 [42] and is summarized in Table 3.4. The values for stall torque and no-load speed were calculated while the physical parameters of the motor and terminal resistance/inductance were measured. The datasheet for the Maxon RE-max 17 can be found in Appendix B. Neither Maxon Motors nor Robotis will confirm the RE-max 17 and the name plate on the RX-28 motor does not match any known type in the current Maxon product catalog. Similar parameter studies on RX-28 motor determination have also concluded on the RE-max 17, order number 214897 [25, 56]. Next, the motor parameter specifications are used to create the RX-28 actuator. MapleSim is capable of creating a motor model in one of the following ways, 33

Motor Data Parameter Motor order number Nominal voltage No-load speed Stall torque Terminal resistance Terminal inductance Torque constant Speed constant Rotor inertia As published [42] 214897 12.0 V 11500 rpm 14.4 mNm 8.30 0.206 mH 9.92 mNm/A 962 rpm/V 0.864 gcm2 SI 1204 rad/s 0.0144 Nm 2.06 x 10-4 H 9.92 x 10-3 Nm/A 100.7 rad/s/V 8.64 x 10-8 kgm2

Table 3.5: Maxon Motor RE-max 17 data · Directly typing in Eq. 2.6 - 2.9 into a custom-component block · Using the MapleSim discrete components · Using the DC permanent magnet motor component · Create a MATLAB Simulink-like model. Each one of these methods is capable of producing the same equivalent motor model. We seek to create a model that will allow us to measure and visualize the electrical relationship between the internal components of the motor. The MapleSim discrete components method was therefore chosen for its ability to allow measurement of the required internal electrical characteristics of the motor. The completed model is based on the characterization values in Table 3.4 and the Maxon Motor RE-max 17 datasheet [42]. Table 3.5 displays the motor data from the Maxon Motor catalog that is used in our MapleSim model. The block diagram for the model for the RX-28 actuator is shown in Fig. 3.5 and the MapleSim equivalent model can be found in Appendix G. Fig. 3.4d is the speed-torque graph of the RE-max 17 model. The motor model has a stall torque of 14.4 mNm and 11500 rpm (1200 rad/s) which correlates well with the published values of the RE-max 17 motor data. 34

RX-28 Actuator

DC Motor Model Maxon RE-max 17

Gear Ratio

Gear Inertia

MapleSim Blocks Armature Resistance Armature Inductance Rotational EMF

Figure 3.5: Functional block view of the RX-28 Actuator Model. The MapleSim implementation is found in Appendix G on pg. 105.

3.2.2

NiMH Battery Model

Power must be delivered to the dc motor actuators during positive cycles of the Si2St2Si motion. For an unconstrained Si2St2Si rehabilitative device to be feasible for everyday use, the system must run on its own power supply. Many battery technologies exist in the industry to power various portable devices. Some of the more popular topologies include lead acid; nickel-metal hydride (NiMH); lithium polymer (LiPo) as well as lithium ion. To simplify analysis, our robotic surrogate testbed will use the common NiMH rechargeable battery supply. Our model will assume that the battery is capable of handling the recharge levels during regenerative braking without damage and therefore will not require any additional power conditioning circuitry. Software-based battery modeling is an active area of research but until recently, has been limited to simple models that often do not adequately describe the complex chemical reactions in the battery. Accurate models have the benefit of predicting and optimizing the lifetime in battery performance. Given an applied load to a battery over a certain period,

35

performance criteria such as state of charge (SOC) or knowing when battery failure occurs can be used to trade-off system performance for extending battery lifetime at the design stages of model development. The MapleSim modeling library contains a battery model that is based upon the work by Dao et al. [9]. This model accounts for the electrochemical processes and thermodynamic behavior of the NiMH battery and describes these equations as a set of equivalent electrical components interconnected to each other. The nickel-metal hydride battery model is shown in Appendix H (Fig. H.1) on pg. 107. It is based on a 4.5 Ahr made by North American Battery Company (NABC). The battery data was measured at A&D Technology's laboratory in Ann Arbor, Michigan, USA [9]. To validate this battery model, a MapleSim test circuit was constructed (Fig. 3.6a) to discharge the battery to assess its performance characteristics. The MapleSim equivalent model can be found in Appendix H. The discharge curve in Fig. 3.6b shows voltage levels for different discharge rates. Fig. 3.7 shows total charge depletion, SOC and voltage levels for a 1C, 4.5 Ahr discharge rate.

36

NiMH Battery Model

Draw current at 4.5 Ahr

Is it depleted?

YES

Stop Simulation

NO

Record Battery Voltage & Charge Drawn

(a) Functional block of battery discharge circuit for MapleSim. The MapleSim implementation is found in Appendix H on pg. 107

Battery performance curves for MapleSim NiMH Model 1.32 1.3 Cell Voltage,V 1.28 1.26 1.24 1.22 1.2 0 5000 Time,s
(b) Discharge curves for 1C, 0.5C, 0.25C and 0.425C

1C 0.5C 0.25C 0.425C

10000

15000

Figure 3.6: MapleSim NiMH Battery Model Test Circuit 37

Total Charge (4.5Ahr (1C) Discharge
18000 16000 14000

coulombs

12000 10000 8000 6000 4000 2000 0 0 500 1000 1500 2000 2500 3000 3500 4000

Time,s

(a) Total charge depletion
SOC Level (4.5Ahr (1C) Discharge
100 90 80 70 60 50 40 30 20 10 0 500 1000 1500 2000 2500 3000 3500 4000

SOC Level (initial level = 0.8 (100%))

Time,s

(b) Battery SOC level
Voltage Level (4.5Ahr (1C) Discharge
1.32 1.3 1.28 1.26 1.24 1.22 1.2 0

Voltage,V

500

1000

1500

2000

2500

3000

3500

4000

Time,s

(c) Battery voltage level

Figure 3.7: 1-Cell discharge testing at 1C, 4.5Ahr 38

NiMH Battery Model

Signal

Voltage-to-PWM Converter

H-Bridge

RX-28 Actuator

Figure 3.8: Block diagram for Test Circuit of the Discontinuous-time H-Bridge Model. The MapleSim implementation is found in Appendix I on pg. 110

3.2.3

Continuous-time H-Bridge Model

Our simulations will be modeled after the locked anti-phase drive for its simplicity in using one control signal bit (PWM) to modulate motor power, for its autonomous four quadrant operation and for its compatibility with the continuous-time model. The block diagram for the test circuit of the discontinuous H-Bridge is shown in Fig. 3.8. Its MapleSim equivalent models are detailed in Appendix I. The operation of this circuit was discussed in section 2.3.2. It is desirable to have a continuous-time model for simulation speed. The H-bridge that has been discussed above is a discontinuous-time model because of the switching elements. High frequency switch firing results in the variable changing rapidly at the discontinuous points. This leads to longer simulation times because the solver needs to take many small time steps within the vicinity. Simulation engines in modeling programs such as MATLAB and MapleSim use techniques that try to determine these discontinuities to improve simulation time but it can also halt simulations before they are completed. Thus, it is desired to simplify the model to reduce or eliminate these discontinuities while preserving its behavior and operation. At high frequency switching speeds, the motor inductance acts as a low-pass filter that changes the alternating current into a DC value. This value is the average DC voltage that is applied to the motor. Thus, we can treat the average DC voltage as a continuous

39

Voltage Source Signal

RX-28 Actuator

NiMH Battery

I(t) = P(t) / V(t)

Sensor: Power, P(t)

Sensor: Voltage, V(t)

Figure 3.9: Functional block diagram for Continuous-time model of discontinuous-time H-Bridge. The MapleSim implementation is found in Appendix I on pg. 110

voltage signal applied to our motor simulation model. Fig. I.3 is a modified test circuit of Fig. I.1. The functional block diagram for the continuous-time domain model is shown in Fig. 3.9. Fig. I.4 in Appendix I shows the simplified MapleSim converter block that models the behavior of locked anti-phase driven H-Bridge. The trajectory-based input voltage signal is fed into the signal voltage component (SV1 ) and a power (EPS1 ) sensor takes measurements per time step. The voltage sensor (VS1 ) measures the voltage across the battery terminals and this value is divided by the power sensor reading to determine the current draw and direction on the battery. Recharging and discharging of the battery is accomplished by the signal current component (SC1 ). The simplified drive was validated against the discontinuous locked anti-phase model shown in Fig. I.1. The state of charge (SOC) comparison graph in Fig. 3.10 show that the continuous-time model is a close approximation to the discontinuous-time H-bridge model. The SOC regeneration in the discontinuous model is slightly less than the continuous model and maybe attributed to regeneration losses during switching. The simulation firing frequency of the H-Bridge switches was set at 32 kHz while the continuous-time model has no discontinuities and all available energy is recovered. Furthermore, the Si2St2Si motion is completed within ten seconds, with the largest deviation on the graph 40

SOC Deviation (initial level = 0.8)

State of Charge (SOC) vs Time Graph for Continuous-time and Discontinuous-time H-Bridge Models 0.00e+000 Continuous Model -1.00e-006 Discontinuous Model -2.00e-006 -3.00e-006 -4.00e-006 -5.00e-006 -6.00e-006 -7.00e-006 -8.00e-006 -9.00e-006 -1.00e-005 0 1 2 3 4 5 6 7 8 9 10

Time,s
Figure 3.10: State of Charge versus Time Graph of Continuous-time and Discontinuoustime H-Bridge Models. The initial SOC level is 0.8 at time = 0s

occuring around 9.5 seconds. This also bounds the error to have a maximum full scale error of 3.89×10-5 %. Table 3.6 lists the performance times for two different computer systems. There is a significant impact in simplifying model as seen between the simulation times. The performance increase between continuous and discontinuous modeling is a factor of 500x for the Dell Inspiron 6000) and 583x for the Mac.

3.2.4

Nonlinear Controller Block

The Si2St and St2Si motion can be thought of as a three-link, three-revolute manipulator problem (Torso:Thigh:Shank and Hip:Knee:Ankle). Robotic manipulator systems in many areas of industrial robotics are generally nonlinear systems with a large envelope of control space. If the operation space is relatively small or if operation speed is relatively slow, then the controller can be linearized to a set of N independent single input, single output 41

Simulation Times Computer Specifications Dell Inspiron 6000 Intel Pentium M at 1.73 GHz 2 GB RAM Win XP SP3 Apple iMac Intel Dual Core i3 at 3.06 GHz 4 GB RAM Mac OS X 10.6.8 Continuous 2.7s Discontinuous 1323s (22 min.)

0.53s

309s (5.1 min.)

Table 3.6: H-Bridge simulation times for Continuous-time and Discontinuous-time Models (SISO) control systems. In the case of human locomotion, gait transfers such as Si2St and St2Si are highly dynamic and follow a large trajectory where nonlinearities play a more dominant role. In the study of biological systems and cybernetics, it is proposed that the nervous system performs inverse dynamics in accomplishing a task [51]. Required forces to accomplish the desired task are calculated by the nervous system and the signals are sent to the joints and muscles to produce those forces. One important task in a robot system is trajectory tracking control. Computed torque control is a nonlinear control scheme and has been shown to be an effective scheme for controlling robotic manipulators under low speed operation [18]. Hemami et al. [21] also explored a ground-fixed three-link, three-revolute Si2St model with a nonlinear controller for trajectory control at the joints. However, their model limitations include the absence of surface support from a chair (i.e. no account for support forces during Si2St and St2Si) and no saturation limits were considered for joint angles and their rates. Our objective is to control the movment of the model to follow trajectories specified in biomechanical literature and to derive from this model the controlled dynamics of the mechanical torques and electrical characteristics that are required to achieve these trajectories.

42

One degree-of-freedom control example To begin, consider the open loop model of the manipulator in Eq. 2.1 in which we wish to design a control law as seen in Fig. 3.11. We will adopt the convention outlined in Craig [7, pg. 262 - 316] where the controller will be partitioned into a model-based portion and a servo-based portion. The model-based portion is of the form  =  + 

(3.3)

where  and  are functions or constants and are chosen to isolate  such that it appears to have a unit moment of inertia for any given input [7]. Equating Eq. 2.1 and Eq. 3.3 gives [Izzshank + l11 2 m1 ] in which we choose  and  to be  = Izzshank + l11 2 m1 and  = sin(1 (t))l11 gm1 . d2 1 (t) + sin(1 (t))l11 gm1 =  +  dt2

(3.4)

(3.5)

(3.6)

Substituting Eq. 3.5 and 3.6 into Eq. 3.4 has the effect of reducing the system to appear as a unit moment of inertia for  input d2  = Ium 2 1 (t) dt single degree of freedom example.

(3.7)

where Ium is the unit moment of inertia and has units in kg · m2 . It is equal to one for the

Next, we seek a servo-based portion of the control law to close the open-loop dynamics of Eq. 3.7 for a given trajectory. The trajectory is a function of time, d (t), that specifies 43

the desired angular position of the manipulator joint at each time t. The servo error is therefore defined as the difference between the desired and actual angular trajectory, e = d - . A servo control law is realized by ¨d + Kv e  + Kp e  =

(3.8)

where Kv and Kp are the control gains that we seek to obtain critical damping for the system. Substituting Eq. 3.7 into Eq. 3.8 and equating it to zero is ¨ + Kv e  + Kp e 0=e

(3.9)

This is our characteristic error equation in which we can tune coefficients Kv and Kp to the desired response that we seek. The nonlinear torque controller for the single pendulum is therefore

(t) = (Izzshank + l11 2 m1 )(

d2 d 1d (t) + Kv e1 (t) + Kp e1 (t)) + sin(1 (t))l11 gm1 2 dt dt

(3.10)

where 1d is the desired angular trajectory, Kv is the derivative gain, Kp is the proportional gain and e1 is the trajectory tracking error. The diagram for Eq. 3.10 is shown in Fig. 3.11. Three-link, three-revolute model Using a similar approach to the single pendulum model example, the model is now extended to a three-link, three-revolute system. This manipulator configuration is a multiinput, multi-output (MIMO) type problem. In other words, we have a vector of desired joint positions, velocities and accelerations and the control law must calculate a vector of joint actuator signals that are tightly coupled together. Since the system is a MIMO-type problem, the control law and its model-based and servo portions are now given in matrix-vector form [7, pg. 295 - 296]. Equation 3.3 becomes

44

¨d
Desired Acceleration

+ + Kp



+ Kd



m

+



System +
(Robot Model)

x x °

bx+kx °d
Desired Velocity

+




-

Velocity Feedback

d
Desired Position

+

-

Position Feedback

Figure 3.11: Nonlinear controller derived from Craig [7]

 =  + 

(3.11)

,  and  are 3x1 vectors and  is a 3x3 matrix. For our rigid-body model, the open loop equation of motion is of the form ¨ + V (,   ) + G()  = M()

(3.12)

 ) is a 3x1 vector of centrifugal and where M() is the 3x3 inertia matrix (Eq.2.3), V (,  Coriolis terms (Eq.2.4) and G() is a 3x1 vector of gravity terms (Eq.2.5) that were defined in section 2.1.2. We choose  and  to be  = M()      1 2 3          =   1 2 3     1 2 3  ) + G()  = V (,    1 +  1     +     =  2 2     3 +  3 45

(3.13)

(3.14)

Again, equating Eq.3.12 with Eq.3.11 reduces the system to appear as an identity mass matrix for  ¨  = I

(3.15)

The identity mass matrix has units in kg · m2 . To simplify analysis, we have ignored friction and disturbances that are non-rigid-body related. The servo-based portion of the control law is ¨d + Kv E  + Kp E)I  = ( where the 3x1 angular position error matrix E is defined as E = d - 

(3.16)

(3.17)

 is the 3x1 angular velocity error matrix. Equating Eq. 3.15 with Eq. 3.16 results in and E the characteristic error equation ¨ + Kv E  + Kp E 0=E where the gain vectors Kv and Kp are diagonal 3x3 matrices,  Kp1 0 0      0 K 0 Kp =   p2     0 0 Kp3  Kv 0 0    1   Kv =    0 Kv2 0    0 0 Kv3 realized by expanding Eq.3.16 and Eq.3.11    ¨ 1 ) d1 + Kp1 (d1 - 1 ) + Kv1 (d1 -  1            ¨d2 + Kp2 (d2 - 2 ) + Kv2 (d2 -  2 )      = =        2    ¨ 3 ) 3 d3 + Kp3 (d3 - 3 ) + Kv3 (d3 -  46                        

(3.18)

(3.19)

(3.20)

The nonlinear joint torque controllers for the ankle (1 ), knee (2 ) and hip (3 ) can be

(3.21)

         1 + 1  1  1 2 3  ankle  1                  +               = 2  knee  + = =  2       2 1 2 3 2                    3 + 3 1 2 3 3 hip 3   1 1 + 2 2 + 3 3 + 1 + 1        1  + 2  + 3  + 2 + 2  =    2 3 1   1 1 + 2 2 + 3 3 + 3 + 3

(3.22)

where d1 , d2 and d3 are the desired angular position of the ankle, knee and hip. The expanded form of Eq.3.22 can be found in the Appendix on pages 86, 88 and 90.

3.2.5

Ground Contact Models

A unilateral ground contact model (Fig. J.1 is incorporated to verify the lower extremity joint motions meet stability during the Si2St2Si motion. A stable Si2St2Si transistion is realized by the total body COM over the foot as shown in Fig. 3.13. The ground contact model in the simulation was modified from Dr. Gilbert Lai's (MapleSim) simulation on a rotating rimless wheel and can be found in Appendix J. The surface friction relationship is  F f riction = (-Kd ) · x

(3.23)

where Kd is the viscous damping coefficient with units of N · s/m. The normal force relationship is  Fnormal = Kp · z + Kd · z

(3.24)

where Kp and Kd are spring and damping coefficients with units of N/m and N · s/m. Kp and Kd were manually tuned to be 2×10-11 N/m and 1.5×10-11 N · s/m.

47

BODY

Ground CONTACT? YES Vertical or Horizontal?

NO

DO NOTHING

Fnormal

Vertical

Horizontal

Ffriction

Figure 3.12: Functional block of ground-contact model. The MapleSim implementation is found in Appendix J on pg. 113

3.3
3.3.1

Parameter Space Search Simulations
Maple-MapleSim Scripting & MATLAB Post-Processing

Maplesoft Maple 15 was used to run parameter space searches on the effects of performance when varying gear ratio and battery size. A custom Maple script was written to execute simulations in parallel using computers in Ryerson University's Electrical Engineering undergraduate computer labs (EE Network - Room's ENG406 and ENG412). A total of thirty-six computers (18 for regeneration (ENG412) and 18 for no-regeneration(ENG406)) were used and each computer was assigned a specific gear ratio for simulations. Each computer is assigned a name in the network that simplifies remote login from terminal. The computer hardware specifications for ENG406 and ENG412 are listed in Table D.1 in Appendix D. Table D.2 and Table D.3 summarizes how the computers were utilized. Due to memory and processing power constraints, the simulations are constrained to thirty minute increments. The data is saved to file and imported into MATLAB for

48

post-processing. A series of screenshots from a typical simulation is shown in Fig. 3.13. In Frame 1, the model is sitting on an invisible chair. The ground projected center of mass (gCOM) extends from the system's overall COM. Given that the gCOM is behind the foot in Frame 1, if the chair was not present, the model would fall over. From Frames 2 - 4, the model rises from the chair. This is the Sit-to-Stand (Si2St) movement. The gCOM moves towards the foot to prevent tipping over. The trajectory of the system's COM is traced in space as the model moves. For Frames 5-8, the model sits down again (St2Si). As the model contacts the seat, the gCOM leaves the foot region. The trajectory of the COM for both Si2St and St2Si is visible in Frame 8. MATLAB was used to process the simulated data from the Maple-MapleSim simulations. The data packages for each gear ratio is concatenated to produce a complete set of simulation data.

49

(a) Frame 1 (t = 0s)

(b) Frame 2 (t = 1.6s)

(c) Frame 3 (t = 2s)

(d) Frame 4 (t = 3s)

(e) Frame 5 (t = 5.5s)

(f) Frame 6 (t = 6s)

(g) Frame 7 (t = 6.4s) (h) Frame 8 (t = 9.5s)

Figure 3.13: Typical motion of MapleSim Model performing Sit-to-Stand and Stand-to-Sit Motion. Trajectory of the Centre of Mass (COM) is shown, as is the ground-projected COM (gCOM).

50

Chapter 4 Results and Analysis

T

HIS chapter details energy and efficiency comparisons between regeneration-enabled and regeneration-disabled Si2St2Si actuated systems. Worst-case-scenario (WCS)

analysis are presented emphasizing energy consumption and time-of-actuation-failure (i.e. zero-trajectory tracking due to battery depletion) between regeneration-enabled and regeneration-disabled systems. For orthoses, prostheses and legged robots, the WCS situation is critical for the developer and end-user as field operation will not have a power outlet for battery recharging. WCS also allows us to gauge the benefits in applying regenerative technologies for design. The analysis assumes that regeneration is achieved through an ideal H-bridge continuous-time domain model that was presented in Appendix C.1. Three main topics are analyzed in this chapter. First, in Section 4.1, we determine whether regeneration is possible in the Si2St2Si movement and, if so, how does it affect battery state of charge. The analysis is done for a 10:1 scale robot model powered by 18.1V batteries and using the stock RX-28 Dynamixel (193:1 gear ratio), while examing variable gear ratios. The scale model is the one shown in Fig. 2.1c and Fig. 3.13. The second analysis, in Sec. 4.2, we examine the effect that varying both gear ratio and battery voltage have on the battery's state of charge, as well as on the model's ability to track desired joint trajectory profiles over time. The third analysis is with respect to the level of detail of the model. The model currently takes into account torque contributions due to inertia, gravity, Coriolis and

51

centrifugal components, as detailed in Eq. 2.2. This leads to a complex control model with a large number of terms which will be computationally taxing when implemented on a real device. Therefore we examine whether the Coriolis and centrifugal terms are necessary.

4.1

State-of-Charge (SOC) Analysis

State-of-charge (SOC) is an indicator on the capacity of a battery (0% = empty and 100% = full). Fig. 4.1 demonstrates that regeneration helps minimize the amount of SOC drop over one movement cycle (Si2St2Si). The objective of this section is to quantify and determine if the current RX-28 actuator is regenerative-optimized for the current scaled model. The RE-max 17 Maxon Motor parameters in the RX-28 was fixed while the gear ratio was varied to determine the gear ratio value that offered optimal regeneration. Fig. 4.2 shows regenerative effects on the SOC level for one Si2St2Si cycle as the gear ratio is varied between 100 to 600 in increments of 50. It is apparent that a ratio of 100:1 gearing results in the highest drain on the battery while the best results are found from 400:1 to 500:1. It is evident in Fig. 4.2 that maximum regeneration occurs at higher gear ratio values. There has been extensive biomechanical studies and development for developing walking and running regenerative devices located at the knee. The knee also experiences the greatest load that further suggests regeneration maybe most effective at the knee. However, Fig. 4.2a - 4.2c suggests that regeneration is most effective at the hip for Si2St2Si motions. The ankle and knee actuators also benefit from regeneration but to a lesser degree.

52

Ankle Actuator SOC: Regeneration versus No-Regeneration 0.00e+000 SOC Deviation (initial level = 0.8) SOC Deviation (initial level = 0.8) Regeneration-Enabled Regeneration-Disabled -5.00e-006 -1.00e-005 -1.50e-005 -2.00e-005 -2.50e-005 0 -5.00e-006 -1.00e-005 -1.50e-005 -2.00e-005 -2.50e-005 2 4 Time,s 6 8 10

Ankle Actuator SOC: Regeneration versus No-Regeneration Regeneration-Enabled Regeneration-Disabled

5.5

6

6.5 Time,s

7

7.5

(a) Ankle joint actuator

(b) Detailed view: Ankle joint actuator SOC drain at 10s
Knee Actuator SOC: Regeneration versus No-Regeneration -5.00e-006 SOC Deviation (initial level = 0.8) -1.00e-005 -1.50e-005 -2.00e-005 -2.50e-005 -3.00e-005 -3.50e-005 -4.00e-005 5.5 6 6.5 Time,s 7 7.5

Knee Actuator SOC: Regeneration versus No-Regeneration 0.00e+000 SOC Deviation (initial level = 0.8) -5.00e-006 -1.00e-005 -1.50e-005 -2.00e-005 -2.50e-005 -3.00e-005 -3.50e-005 -4.00e-005 0 2 4 Time,s 6 8 10 Regeneration-Enabled Regeneration-Disabled

Regeneration-Enabled Regeneration-Disabled

(c) Knee joint actuator

(d) Detailed view: Knee joint actuator SOC drain at 10s
Hip Actuator SOC: Regeneration versus No-Regeneration SOC Deviation (initial level = 0.8) -2.00e-006 Regeneration-Enabled Regeneration-Disabled

Hip Actuator SOC: Regeneration versus No-Regeneration 0.00e+000 SOC Deviation (initial level = 0.8) -5.00e-007 -1.00e-006 -1.50e-006 -2.00e-006 -2.50e-006 -3.00e-006 -3.50e-006 0 2 4 Time,s 6 8 10 Regeneration-Enabled Regeneration-Disabled

-2.50e-006

-3.00e-006

-3.50e-006

5.5

6

6.5 Time,s

7

7.5

(e) Hip joint actuator

(f) Detailed view: Hip joint actuator SOC drain at 10s

Figure 4.1: Regeneration-enabled versus regeneration-disabled SOC Deviation comparison (193 Gear Ratio, 18.1V, 4.5 Ahr NiMH Battery). The initial state of the SOC level is 0.8 at time = 0s.

53

SOC Deviation (Initial SOC Level = 0.8)

Ankle SOC Deviation
0.00e+000 -1.00e-005 -2.00e-005 -3.00e-005 -4.00e-005 -5.00e-005 -6.00e-005 -7.00e-005 -8.00e-005 0 2 4 6 8 GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 10

GR600 GR100

Time,s

(a) Ankle joint actuator
SOC Deviation (Initial SOC Level = 0.8) Knee SOC Deviation
0.00e+000 -2.00e-005 -4.00e-005 -6.00e-005 -8.00e-005 -1.00e-004 -1.20e-004 -1.40e-004 0 2 4 6 8 GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 10

GR600 GR100

Time,s

(b) Knee joint actuator
SOC Deviation (Initial SOC Level = 0.8) Hip SOC Deviation
1.00e-006 0.00e+000 -1.00e-006 -2.00e-006 -3.00e-006 -4.00e-006 -5.00e-006 -6.00e-006 -7.00e-006 0 2 4 6 8 GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 10

GR600

GR100

Time,s

(c) Hip joint actuator

Figure 4.2: SOC Deviation for varying gear ratios, with regeneration enabled, for one Si2St2Si movement cycle (18.1V, 4.5 Ahr NiMH). The best regeneration results were obtained for the highest gear ratios where there was little deviation change. The initial SOC level is 0.8 at time = 0s. 54

4.2

Effect of Variable Gearing and Battery Voltage

It was shown in the previous section that peak SOC regeneration occurs at larger gear ratios. A larger gear ratio also reduces the amount of current draw for lower motor speeds. As a result, the operational time between charges is increased by simply increasing the gear ratio. This section details the design consideration and limitations on motor selection for a Si2St2Si scaled model.

4.2.1

Trajectory (Position) Tracking

The trajectory tracking error decreases for increasing gear ratio values up to the point of motor saturation. This is shown in Fig. 4.4. Minimal tracking error is achieved between a gear ratio of 100:1 to 500:1. The error is bounded in this region and can be calculated by substituting the maximum angular velocity developed at the joint into the following formula

Maximum angular speed o f motor = Operating voltage x Motor speed constant 18.1 Vx100.7 rad/s/V = 1822.67rad/s Maximum Gear Ratio = Maximum angular speed o f motor/Maximum joint angular velocity 1822.67rad/s / 3.5rad/s = 520 Gear Ratio (4.1)

4.2.2

Angular Velocity Tracking

Increasing the gear ratio affects trajectory tracking and will lead to errors in angular velocity. For large ratios, the shaft of the motor is required to spin faster than a motor with a smaller gear ratio for a specific shaft output speed. An increase in gear ratio results in an increase in the applied voltage at the motor terminals. The input voltage will increase until saturation at the supply voltage. Fig. 4.5 shows that a gear ratio of 600 was not able to generate the required joint velocity compared to a gear ratio of 193. The 600 gear ratio 55

Ankle Trajectory Control
22 20 18 Desired Trajectory GR193 Actual Trajectory GR600 Actual Trajectory 0.4 0.35 0.3

Ankle Trajectory Tracking Error
GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 8 10

Angle,deg.

Angle,deg.

16 14 12 10 8 6 4 0 2 4 6

0.25 0.2 0.15 0.1 0.05

GR600 GR100

GR600 GR193 Desired Trajectory
8 10

0 0

2

4

6

Time,s

Time,s

(a) Ankle Tracking between reference, GR193 and GR600
Knee Trajectory Control
100 80 Desired Trajectory GR193 Actual Trajectory GR600 Actual Trajectory

(b) Error: Ankle Tracking GR193 vs. GR600

Knee Trajectory Control Tracking Error
1.6 1.4 GR193 GR600

Angle,deg.

60 40 20 0 0

Angle,deg.

1.2 1 0.8 0.6 0.4 0.2

GR600

GR600

GR193 Desired Trajectory
6 8 10

GR193

2

4

0 0

2

4

6

8

10

Time,s

Time,s

(c) Knee Tracking between reference, GR193 and GR600
Hip Trajectory Control
120 100 80 Desired Trajectory GR193 Actual Trajectory GR600 Actual Trajectory

(d) Error: Knee Tracking GR193 vs. GR600

Hip Trajectory Control Tracking Error
3 2.5 GR193 GR600

Angle,deg.

60 40 20 0 -20 0 2 4 6

Angle,deg.

2 1.5 1 0.5

GR600 GR193 Desired Trajectory
8 10

GR600 GR193
2 4 6 8 10

0 0

Time,s

Time,s

(e) Hip Tracking between reference, GR193 and GR600

(f) Error: Hip Tracking GR193 vs. GR600

Figure 4.3: Angular Position Tracking of the Ankle, Knee, and Hip Joints, 193:1 vs. 600:1 gear ratios (18.1V, 4.5 Ahr NiMH).

56

Ankle Trajectory Control Tracking Error
0.4 0.35 0.3 GR193 GR600

Angle,deg.

GR600
0.25 0.2 0.15 0.1 0.05 0 0 2 4 6 8 10

GR193

Time,s

(a) Ankle joint tracking error
Knee Trajectory Tracking Error
1.6 1.4 GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 8 10

Angle,deg.

1.2 1 0.8 0.6 0.4 0.2 0 0 2 4

GR600

GR100

6

Time,s

(b) Knee joint tracking error
Hip Trajectory Tracking Error
3 2.5 GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 6 8 10

Angle,deg.

2 1.5

GR600
1 0.5 0 0 2

GR100
4

Time,s

(c) Hip joint tracking error

Figure 4.4: Joint Tracking Error for GR100 to GR600 (18.1V, 4.5 Ahr NiMH) 57

system would require the motor to spin 407 times faster than the 193 gear ratio (assuming that the actual motor is capable of meeting the accelerations required). The bounded voltage is the supply voltage of 18.1V and the required hip joint voltage can be realized with Eq. 4.1 where the calculated value is 20.85 V.

4.2.3

Supply Voltage Considerations

The motor voltage input for each for each joint actuator is shown in Fig. 4.6. As calculated in the previous section, the required hip voltage around 2.1 seconds saturates at the supply voltage and therefore is not able to follow the desired joint angular velocity. Motor selection for exoskeletal devices should require knowledge of the trajectory, speed and accelerations of the joint angles to take advantage of the actuator performance in specific regions of gait. Simulation results showed that saturation occured only in the hip actuator and not at the ankle and knee at a gear ratio of 600. The ankle and knee joints can potentially be optimized for a larger gear ratio and/or different motor to increase the efficiency of the regeneration. However, increasing gear ratios also reach a converging performance on the operation/regeneration of the actuator as shown in Fig. 4.2. It appears that increasing the gear ratio past 400 has little effect on return in performance. Fig. ?? shows the percentchange in SOC after one Si2St2Si cycle. There is little change in performance in gear ratios between 400:1 to 600:1. The trend in increasing gear ratios have shown to extend the operational time limit but it also asymptotically reaches an efficiency limit where there is little return on performance. As the gear ratio reaches a motor's performance limitations (maximum angular velocity and acceleration), trajectory tracking will begin to decrease.

4.2.4

Torque Analysis: Are Centrifugal & Coriolis terms necessary?

The mechanical model tested in this thesis includes inertial, gravitational and Coriolis and centrifugal components. One of the objectives of this thesis was to examine the

58

Reference Ankle Angular Velocity
0.8 0.6

GR193 Reference

GR600

Angular Velocity,rad./s

0.2 0 -0.2 -0.4 -0.6 -0.8 0 2 4 6 8 10

Angular Velocity,rad./s

0.4

Reference GR193 GR600

Ankle Angular Velocity Tracking Error between GR193 and GR600
0.1 0.08 0.06 GR193 GR600

GR600
0.04 0.02 0 0

GR193
2 4 6 8 10

Time,s

Time,s

(a) Ankle Tracking between reference, GR193 and GR600

(b) Ankle Tracking error of GR193 and GR600

Knee Angular Velocity Tracking Error between GR193 and GR600
0.7 0.6 GR193 GR600

Reference Knee Angular Velocity Angular Velocity,rad./s
3 Reference GR193 GR600

0.5 0.4 0.3 0.2

Angular Velocity,rad./s

2 1 0 -1 -2 -3 0 2

GR600

GR600 GR193 Reference
4

GR193
0.1 6 8 10 0 0

Time,s

2

4

Time,s

6

8

10

(c) Knee Tracking between reference, GR193 and GR600
Reference Hip Angular Velocity
4 3 2 1 0 -1 -2 -3 0 2 4 6 8 10

(d) Knee Tracking error of GR193 and GR600

Hip Angular Velocity Tracking Error between GR193 and GR600
Reference GR193 GR600 0.8 GR193 GR600

Angular Velocity,rad./s

Angular Velocity,rad./s

GR193 Reference GR600

0.7 0.6 0.5 0.4 0.3 0.2 0.1 0 0

GR600 GR193
2 4 6 8 10

Time,s

Time,s

(e) Hip Tracking between reference, GR193 and GR600

(f) Hip Tracking error of GR193 and GR600

Figure 4.5: Angular Velocity Tracking of the Ankle, Knee, and Hip Joints (18.1V, 4.5 Ahr NiMH).

59

Ankle Actuator Input Voltage
5.00

GR600
0.00

Voltage,V

-5.00 -10.00 -15.00 -20.00 0

GR100

GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 6 8 10

2

4

Time,s

(a) Ankle Joint
Knee Actuator Input Voltage
15.00 10.00 5.00 GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 6 8 10

GR600

Voltage,V

0.00 -5.00 -10.00 -15.00 -20.00 0 2 4

GR100

Time,s

(b) Knee Joint
Hip Actuator Input Voltage
20.00 15.00 10.00 GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 6 8 10

Voltage,V

5.00 0.00 -5.00 -10.00 -15.00 -20.00 0 2

GR600

GR100

4

Time,s

(c) Hip Joint

Figure 4.6: Actuator voltage input for ankle, knee and hip joints (note: saturation is most visible at the hip joint) 60

Figure 4.7: Percent-change in SOC after one Si2St2Si cycle. Shorter bars indicate more efficient operation.

61

contribution of these individual components on the underlying dynamics of sitting and standing. The dynamics for our 3-link, 3-revolute Si2St2Si model is described by the equation ¨ + V (,   ) + G()  = M()

(4.2)

where M is the inertia matrix, V are the Coriolis and centrifugal matrix and G is the gravitational matrix. The nonlinear controller that was discussed in Section 3.2.4 calculates the required joint trajectory torques based on the feedback between the desired trajectory LUT and the actual joint angles. The torque signals are converted to a current signal based on the motor torque constant. An inner current-controlled PID loop tracks the current (torque) of the actuator to ensure that the desired trajectory is met. It was observed that the Coriolis and centrifugal torque components had little contribution to the total torque input (Fig. 4.8 - 4.10). Figures 4.8c, 4.9c, and 4.10c show that inertia and gravitational torques have the largest significance to the total net torque at each joint. Saturation at the hip actuator is observed in Fig. 4.10a. Motor voltage saturation occurs at gear ratios 550:1 and 600:1 in which affects the actuator's ability to track its angular position and angular velocity (and thus acceleration). Therefore, the nonlinear controller calculates a reference torque that is many magnitudes larger. However, the generated torque (hence, current) saturates the input voltage signal to the actuator. In the future, it would be useful to validate this work on an experimental platform, necessitating the implementation of the controller model - which incorporates the aforementioned components - on a microcontroller or microprocessor, the removal of controller components which have minor effect will reduce computational load on the computer hardware. The peak ankle Coriolis and centrifugal torque was approximately 0.03 Nm while the knee and hip Coriolis and centrifugal torques was approximately 0.01 Nm. Thus, the torque components due to Coriolis and centrifugal terms in the dynamics model is 62

approximately 1% of the gravitational and/or inertial terms.

4.2.5

Current/Torque Tracking

The current/torque signal sent to the actuator is maintained by an inner-loop PID controller that responds to the feedback given between the measured current applied to the motor and the reference current (torque) calculated by the nonlinear controller. The motor current tracking performance of each joint actuator is shown in Fig. 4.11 - 4.12. Gear ratio 600:1 shows how saturation affects the tracking performance. The actuator tracking performance decreases at saturation causing the nonlinear controller to generate a large reference torque to the motor. In gear ratio 193:1, the tracking performance experienced little error during 75% of the Si2St2Si cycle. Further optimization of the P, I, and D gains and/or integrating an anti-windup factor may help minimize/eliminate the errors shown.

4.2.6

Power Cycles

Electrical and mechanical power performance for gear ratios 193:1 and 600:1 are shown in Fig. 4.13. Regenerative energy is recovered into the battery during negative regions in the power cycle. The hip experiences the maximum benefit of regeneration followed by the knee and then the ankle (for a RX-28 actuator with a gear ratio of 193). Regeneration performance can be improved by increasing the gear ratio for the ankle and knee actuators and/or by selecting a motor with a larger speed constant. However, it should be noted that even at large gear ratios, regeneration at the ankle is minimal. Since the Si2St2Si cycle experiences very little angular movement per joint during one cycle, gearing and motor selection should be optimized for a large angular velocity during negative power cycles while meeting torque and current requirements.

63

Ankle Torque due to Inertia
1.50000 1.00000 GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 2 4 6 8 10

Torque,Nm

0.50000 0.00000 -0.50000 -1.00000 -1.50000 0

Time,s

(a) Ankle: Torque due to inertia
Ankle Torque due to Coriolis and centrifugal
0.03000 0.02500 0.02000 GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 2 4 6 8 10

Ankle Torque due to Inertia|Coriolis/centrifugal|Gravity (GR193)
1.50000 1.00000 Inertia Coriolis/centrifugal Gravity

Torque,Nm

Torque,Nm

0.01500 0.01000 0.00500 0.00000 -0.00500 -0.01000 0

0.50000 0.00000 -0.50000 -1.00000 -1.50000 0 2

Gravity Coriolis/centrifugal Inertia

Time,s

4

Time,s

6

8

10

(b) Ankle: Torque due to Coriolis and centrifugal
Ankle Torque due to Gravity
1.20000 1.00000 0.80000 GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 2 4 6 8 10

(c) Ankle: Torque Component Summary

Torque,Nm

0.60000 0.40000 0.20000 0.00000 -0.20000 0

Time,s

(d) Ankle: Torque due to gravity

Figure 4.8: Detailed view of ankle torque components. Note that Coriolis & centrifugal components are minimal

64

Knee Torque due to Inertia
1.50000 1.00000 GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 2 4 6 8 10

Torque,Nm

0.50000 0.00000 -0.50000 -1.00000 -1.50000 0

Time,s

(a) Knee: Torque due to inertia
Knee Torque due to Coriolis and centrifugal
-0.00200 GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 2 4 6 8 10

Knee Torque due to Inertia|Coriolis/centrifugal|Gravity (GR193)
1.50000 1.00000

Gravity

-0.00400

Inertia Coriolis/centrifugal Gravity

Torque,Nm

-0.00600

Torque,Nm

0.50000 0.00000 -0.50000 -1.00000 -1.50000 0 2 4 6 8 10

Inertia

Coriolis/centrifugal

-0.00800

-0.01000 0

Time,s

Time,s

(b) Knee: Torque due to Coriolis and centrifugal
Knee Torque due to Gravity
1.40000 1.20000 1.00000 GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 2 4 6 8 10

(c) Knee: Torque Component Summary

Torque,Nm

0.80000 0.60000 0.40000 0.20000 0.00000 0

Time,s

(d) Knee: Torque due to gravity

Figure 4.9: Detailed view of knee torque components. Note that Coriolis & centrifugal components are minimal

65

Hip Torque due to Inertia
40.00000 35.00000 30.00000 25.00000 20.00000 15.00000 10.00000 5.00000 0.00000 -5.00000 0 2 4 GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 6 8 10

Torque,Nm

Time,s

(a) Hip: Torque due to inertia
Hip Torque due to Coriolis and centrifugal
0.01200 0.01000 0.00800 GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 2 4 6 8 10 1.00000 0.80000 0.60000 0.40000 0.20000 0.00000 -0.20000 -0.40000 -0.60000 0 2 4

Hip Torque due to Inertia|Coriolis/centrifugal|Gravity (GR193)
Inertia Coriolis/centrifugal Gravity

Torque,Nm

0.00600 0.00400 0.00200 0.00000 -0.00200 0

Torque,Nm

Inertia Gravity

Coriolis/centrifugal
6 8 10

Time,s

Time,s

(b) Hip: Torque due to Coriolis and centrifugal
Hip Torque due to Gravity
0.20000 0.10000 0.00000 GR100 GR150 GR193 GR200 GR250 GR300 GR350 GR400 GR450 GR500 GR550 GR600 2 4 6 8 10

(c) Hip: Torque Component Summary

Torque,Nm

-0.10000 -0.20000 -0.30000 -0.40000 -0.50000 0

Time,s

(d) Hip: Torque due to gravity

Figure 4.10: Detailed view of hip torque components. Note that Coriolis & centrifugal components are minimal

66

Ankle Torque (Current) Tracking for Gear Ratio 193
0.1 0 -0.1 -0.2 -0.3 -0.4 -0.5 -0.6 -0.7 0 2 4

Ankle Torque (Current) Tracking Error for Gear Ratio 193
0.12 0.1

Actual Reference

Reference Current Actual Current

Current,A.

Current,A.
8 10

0.08 0.06 0.04 0.02

Time,s

6

0 0

2

4

Time,s

6

8

10

(a) Ankle: Current tracking for GR193
Knee Torque (Current) Tracking for Gear Ratio 193
0 -0.1 -0.2 -0.3 -0.4 -0.5 -0.6 -0.7 -0.8 0 2 4

(b) Error: Current tracking for GR193
Knee Torque (Current) Tracking Error for Gear Ratio 193
0.14 0.12

Actual Reference

Reference Current Actual Current

Current,A.

0.1

Current,A.

0.08 0.06 0.04 0.02

Time,s

6

8

10

0 0

2

4

Time,s

6

8

10

(c) Knee: Current tracking for GR193
Hip Torque (Current) Tracking for Gear Ratio 193
0.25 0.2 Reference Current Actual Current

(d) Error: Current tracking for GR193
Hip Torque (Current) Tracking Error for Gear Ratio 193
0.04 0.035 0.03 0.025 0.02 0.015 0.01 0.005 0 0

Current,A.

0.1 0.05 0 -0.05 -0.1 -0.15 0 2 4 6 8 10

Current,A.

0.15

Time,s

2

4

Time,s

6

8

10

(e) Hip: Current tracking for GR193

(f) Error: Current tracking for GR193

Figure 4.11: Current tracking for GR193

67

Ankle Torque (Current) Tracking for Gear Ratio 600
0.05 0

Ankle Torque (Current) Tracking Error for Gear Ratio 600
0.04 0.035 0.03

Actual

Reference Current Actual Current

Current,A.

-0.05 -0.1 -0.15 -0.2 0

Current,A.
8 10

Reference

0.025 0.02 0.015 0.01 0.005

2

4

Time,s

6

0 0

2

4

Time,s

6

8

10

(a) Ankle: Current tracking for GR600
Knee Torque (Current) Tracking for Gear Ratio 600
0.15 0.1 0.05 Reference Current Actual Current 0.04 0.035 0.03 0.025 0.02 0.015 0.01 0.005 2 4 0 0

(b) Error: Current tracking for GR600
Knee Torque (Current) Tracking Error for Gear Ratio 600

Actual
Current,A.
6 8 10

Current,A.

0 -0.05 -0.1 -0.15 -0.2 -0.25 0

Reference

Time,s

2

4

Time,s

6

8

10

(c) Knee: Current tracking for GR600
Hip Torque (Current) Tracking for Gear Ratio 600
7 6 5 Reference Current Actual Current 7 6 5

(d) Error: Current tracking for GR600
Hip Torque (Current) Tracking Error for Gear Ratio 600

Current,A.

Current,A.
6 8 10

4 3 2 1 0 -1 0 2 4

Reference Actual

4 3 2 1 0 0 2 4 6 8 10

Time,s

Time,s

(e) Hip: Current tracking for GR600

(f) Error: Current tracking for GR600

Figure 4.12: Current tracking for GR600

68

SOC Deviation (Initial SOC Level = 0.8)

Ankle electrical power to motor (GR193) 10 0.00e+000

Ankle electrical power to motor (GR600) SOC Deviation (Initial SOC Level = 0.8) SOC Deviation (Initial SOC Level = 0.8) SOC Deviation (Initial SOC Level = 0.8) 4 0.00e+000

Power,W

5

-1.00e-005

Power,W

SOC Deviation Power
0 -2.00e-005

2

-1.00e-006

Power
0

SOC Deviation
-2.00e-006

-5 0

2

4

Time,s

6

8

-3.00e-005 10

-2 0

2

4

Time,s

6

8

-3.00e-006 10

(a) Ankle: electrical motor power and SOC, GR193 (b) Ankle: electrical motor power and SOC, GR600
Knee electrical power to motor (GR193) 15 0.00e+000

Knee electrical power to motor (GR600)
SOC Deviation (Initial SOC Level = 0.8)

SOC Deviation
10 Power,W -1.00e-005

4 3 2 Power,W 1 0 -1 -2 -3 0 2

-2.50e-006

-3.00e-006

5

-2.00e-005

Power

-3.50e-006

Power
0 -3.00e-005

-4.00e-006

SOC Deviation
4 6 8

-4.50e-006 10

-5 0

2

4

Time,s

6

8

-4.00e-005 10

Time,s

(c) Knee: electrical motor power and SOC, GR193 (d) Knee: electrical motor power and SOC, GR600
Hip electrical power to motor (GR193) SOC Deviation (Initial SOC Level = 0.8) 2 0.00e+000 4 Hip electrical power to motor (GR600) 5.00e-007

2 Power,W

0.00e+000

Power
Power,W 0 -1.00e-006

Power
0 -5.00e-007

-2

-1.00e-006

SOC Deviation
-2 0 2 4 Time,s 6 8 -2.00e-006 10

SOC Deviation
-4 0 2 4 Time,s 6 8 -1.50e-006 10

(e) Hip: electrical motor power and SOC, GR193

(f) Hip: electrical motor power and SOC, GR600

Figure 4.13: Motor electrical power and SOC Performance

69

4.2.7

Motor and Gearing Selection Space

Motor and gearing selection is important for orthoses, prostheses and legged robots. For legged robots, regenerative power can potentially extend the time of operation. For orthoses and prostheses design, regenerative power can also increase the usage safety for the user by assisting the Si2St2Si gait. The resistivity to angular motion in motors increases with increasing gear ratios. However, gear selection should also take into account the natural gait dynamics of the user. The actuated system should not impede the natural movement of the user but assist when requested. As it was seen in Fig. 4.2, increasing gear ratios also corresponds to an increase in battery autonomy as seen in the hip motor. It should also be noted that a larger gear ratio will have slower acceleration times which is an important variable in matching trajectory position and torques profiles. In this thesis, the Dynamixel RX-28 was used as the test device for modeling the effects of regeneration against no-regeneration. However, very little regenerative recovery was noticeable compared to the non-regeneration model. This can be attributed to the fact that the Si2St2Si gait uses very little power over the ten second movement cycle. Angular velocities that were reached during the Si2St2Si gait were not sufficient to efficiently recharge the battery. The next iterative process would be to incorporate battery size testing with the experimental surrogate. Our simulations modeled the battery sizing at 14-cells (18V). This is the maximum recommended operation voltage that is suggested by Robotis. Battery sizing should reflect on the motor and gearing selection by choosing a system that optimizes regeneration by varying between the battery size and the maximum angular velocity that can reached during generator mode (negative power cycles).

70

Regeneration: Final ankle SOC after 1 Si2St2Si SOC Deviation (Initial SOC Level = 0.8)

0.00e+000 -2.00e-005 -4.00e-005 -6.00e-005 -8.00e-005 -1.00e-004 -1.20e-004 18 16 14 200 300 400 500 600

Battery Voltage Size, V

12

100

Gear Ratio

(a) Ankle SOC
Regeneration: Final knee SOC after 1 Si2St2Si SOC Deviation (Initial SOC Level = 0.8)

0.00e+000 -5.00e-005 -1.00e-004 -1.50e-004 -2.00e-004 18 16 14 200 300 400 500 600

Battery Voltage Size, V

12

100

Gear Ratio

(b) Knee SOC
Regeneration: Final hip SOC after 1 Si2St2Si SOC Deviation (Initial SOC Level = 0.8)

0.00e+000 -2.00e-006 -4.00e-006 -6.00e-006 -8.00e-006 -1.00e-005 18 16 14 200 300 400 500 600

Battery Voltage Size, V

12

100

Gear Ratio

(c) Hip SOC

Figure 4.14: SOC levels after single-Si2St2Si cycle for different battery sizes (12V, 15V, 18V). Regeneration is enabled. Note that the best results occur for highest battery voltage and gear ratio 71

4.3

Recommendations for Design

There are three major disadvantages with increasing the gear ratio of the actuators: 1. Mass 2. Reduced backdrivability 3. Motor saturation All of the targeted applications place a premium on mass because of its detrimental effect on mobility. Bigger gears increase mass and therefore reduce mobility. Motor saturation occurs in all motors, as they are driven at high torques, speeds or both. The saturation curve of the RX-28 is visible in Fig. 4.6c. As one approaches the saturation limit of an actuator, one reduces the margin within which a controller can modulate behavior of the actuator. Once the saturation threshold is reached the robot/prothesis is at the mercy of uncontrollable external forces. Typically, the actuator system should be designed close to the limit, but far enough from it that large errors in achieved trajectory do not occur. Backdrivability is useful when the actuator is used for regeneration and for sensing. Typically, the larger the gear ratio, the more difficult it becomes to overcome internal friction in the gearing. While gear friction was not modeled here, it should be taken into account during implementation. In the context of this study, the main negative factor examined is motor saturation and its effect on joint trajectory error during Si2St and St2Si movements. In Fig. 4.3 we compare the RX-28 (with 193:1 gear ratio) to an imaginary actuator with the same DC motor, but with a 600:1 gear ratio. The same controller gains were used in both cases. Note how the error is dramatically higher with the 600:1 gear ratio. This is due to saturation. The saturation is most visible in the velocity data of Fig. 4.5, just after two seconds, for the ankle, knee and hip plots.

72

Chapter 5 Conclusions

T

HIS thesis presented research on the successful development of a nonlinear torque control strategy for an actuated Si2St2Si biped model. This was achieved by de-

veloping a multi-domain simulation model in MapleSim where each physical system of the proposed physical model is modelled. Each subsystem was tested and analyzed to validate the component specifications to its manufacturer (i.e. Maxon RE-max 17, RX28) datasheets. Regeneration was shown to increase the autonomy of the robot model. The simulation model that was developed is not limited to a 10:1 scale but is modular and expandable that can be used to simulate performance measurements on any actuator subsystem. The study has led to a better understanding in Si2St2Si motion and trajectory regions where regeneration and optimization should be focused on. There has been extensive research on regeneration capturing in running and walking but never on Si2St2Si. In walking and running cases, it has been shown that maximum energy recovery is obtained at the knee [12, 34]. In contrast to work by Donelan where regenerative technology is applied at the knee for walking and running, we find here that it would be most effective if placed at the hip for sitting/standing behaviors. The Coriolis and centrifugal torque components was found to be approximately 1% of the inertial or gravitational torque components and are, thus, deemed insignificant. Therefore a robot controller could safely ignore these components and likely still have

73

good performance. The simulated RX-28 actuator component was not an optimal for regeneration. This study shows that the gear ratio on all three joints could be increased to an upper limit of 520:1 to increase battery autonomy. Beyond 520:1, motor saturation leads to larger and larger trajectory errors. In summary, the study shows that regeneration and motor braking can be used to assist the Si2St2Si behavior. It was shown that regeneration during negative cycles extended the operational time by injecting energy back into the battery. Battery autonomy was therefore increased, extending the operation time of the device. This in return can help reduce joint loads during standing-to-sitting for the user. Selection of large gears aids in increasing the battery autonomy, but is bounded by saturation effects which lead to poor tracking performance. We recommend that the hip joint be prioritized for regeneration since the ankle and knee show less potential for useful regenerative effects. The increase in battery autonomy due to regeneration and gearing can lead to designs with smaller, lighter batteries. This has important implications for prostheses, orthoses and humanoid robot design.

74

Chapter 6 Suggested Future Work

I

N terms of future modeling and simulation studies it would be valuable to examine the effect of gear mass and battery mass on the design. While it appears that increasing

the battery voltage and gear ratio leads to better performance, these are likely limited by the obvious increase in mass associated with larger batteries and gears. Optimization of the parameters should incorporate a battery model and hardware testing should include various battery sizes. Battery technology is a proprietary industry field that does not release its specifications other than the voltage and current charge/discharge rates. Load testing will help determine which batteries may be better suited for the Si2St2Si model. Another important suggestion for future work is to use these findings to design and test a 1:10 scale robotic platform. As suggested in this study, two test cases should be conducted: one with Coriolis and centrifugal torque components modeled in and another model without them.This will allow us to benchmark computational performance and compare the tracking accuracy between the two models.

75

Appendix A Sit-to-Stand Dynamic Model
This section details the expanded form of the matrix and vector elements in Eq. 2.3 - 2.5. The mass matrix in Eq. 2.3 is      1 2 3          M() =    1 2 3     1 2 3 The first row of the mass matrix is made up of three terms: 1 ,2 and 3 . The first row of these, 1 is 1 = m3 l31 2 + l22 2 m3 + m2 l21 2 +m3 l21 2 + l11 2 m2 + l12 2 m2 +l11 2 m1 + l12 2 m3 + l11 2 m3 +2 l31 m3 cos(3 (t))l21 + 2 l11 m3 l22 cos(2 (t)) +2 l11 m3 l21 cos(2 (t)) + 2 l11 m2 l21 cos(2 (t)) +2 l12 m3 l22 cos(2 (t)) + 2 l12 m3 l21 cos(2 (t)) +2 l12 m2 l21 cos(2 (t)) + 2 l31 m3 cos(3 (t))l22 +2 l22 m3 l21 + 2 l11 m2 l12 + 2 l11 m3 l12 +2 l31 cos(2 (t)) cos(3 (t))m3 l11 + 2 l31 cos(2 (t)) cos(3 (t))m3 l12 -2 l31 sin(2 (t)) sin(3 (t))m3 l11 - 2 l31 sin(2 (t)) sin(3 (t))m3 l12 +Izzshank + Izzhat + Izzthigh 76 (A.1)

the second term, 2 is 2 = l11 m3 l22 cos(2 (t)) + l11 m3 l21 cos(2 (t)) +l11 m2 l21 cos(2 (t)) + l12 m3 l22 cos(2 (t)) +l12 m3 l21 cos(2 (t)) + l12 m2 l21 cos(2 (t)) +2 l31 m3 cos(3 (t))l22 + 2 l31 m3 cos(3 (t))l21 +2 l22 m3 l21 +l31 cos(2 (t)) cos(3 (t))m3 l11 + l31 cos(2 (t)) cos(3 (t))m3 l12 -l31 sin(2 (t)) sin(3 (t))m3 l11 - l31 sin(2 (t)) sin(3 (t))m3 l12 +Izzhat + Izzthigh +l22 2 m3 + m2 l21 2 +m3 l21 2 + m3 l31 2 and the third term 3 is 3 = l31 m3 cos(3 (t))l22 + l31 m3 cos(3 (t))l21 +l31 cos(2 (t)) cos(3 (t))m3 l11 + l31 cos(2 (t)) cos(3 (t))m3 l12 -l31 sin(2 (t)) sin(3 (t))m3 l11 - l31 sin(2 (t)) sin(3 (t))m3 l12 +Izzhat + m3 l31 2 (A.3) (A.2)

77

The second row of the mass matrix is also made up of three terms: 1 ,2 and 3 . The first term, 1 is 1 = l11 m3 l22 cos(2 (t)) + l11 m3 l21 cos(2 (t)) +l11 m2 l21 cos(2 (t)) + l12 m3 l22 cos(2 (t)) +l12 m3 l21 cos(2 (t)) + l12 m2 l21 cos(2 (t)) +2 l31 m3 cos(3 (t))l22 + 2 l31 m3 cos(3 (t))l21 +2 l22 m3 l21 +l31 cos(2 (t)) cos(3 (t))m3 l11 + l31 cos(2 (t)) cos(3 (t))m3 l12 -l31 sin(2 (t)) sin(3 (t))m3 l11 - l31 sin(2 (t)) sin(3 (t))m3 l12 +Izzhat + Izzthigh +l22 2 m3 + m2 l21 2 +m3 l21 2 + m3 l31 2 while the second term, 2 is 2 = 2 l31 m3 cos(3 (t))l22 + 2 l31 m3 cos(3 (t))l21 + 2 l22 m3 l21 +Izzhat + Izzthigh + l22 2 m3 +m2 l21 2 + m3 l21 2 + m3 l31 2 and the third term, 3 is (A.5) (A.4)

3 = l31 m3 cos(3 (t))l22 + l31 m3 cos(3 (t))l21 + Izzhat + m3 l31 2

(A.6)

78

Finally, the last row of the mass matrix is made up of three terms: 1 ,2 and 3 . The first term, 1 is 1 = l31 m3 cos(3 (t))l22 + l31 m3 cos(3 (t))l21 +l31 cos(2 (t)) cos(3 (t))m3 l11 + l31 cos(2 (t)) cos(3 (t))m3 l12 -l31 sin(2 (t)) sin(3 (t))m3 l11 - l31 sin(2 (t)) sin(3 (t))m3 l12 +Izzhat + m3 l31 2 the second term, 2 is (A.7)

2 = l31 m3 cos(3 (t))l22 + l31 m3 cos(3 (t))l21 + Izzhat + m3 l31 2 and the third term, 3 is

(A.8)

3 = Izzhat + m3 l31 2 The 3 x 1 Coriolis and centrifugal vector in Eq. 2.4 is    1   2   ) =  V (,        3 The Coriolis and centrifugal components contain three terms: 1 , 2 and 3 .

(A.9)

79

The first term, 1 is

1 = 2 l11 m2 l21 (

d d d d 1 (t))( 2 (t)) sin(2 (t)) + 2 l12 m3 l22 ( 1 (t))( 2 (t)) sin(2 (t)) dt dt dt dt d d d d +2 l12 m3 l21 ( 1 (t))( 2 (t)) sin(2 (t)) + 2 l12 m2 l21 ( 1 (t))( 2 (t)) sin(2 (t)) dt dt dt dt d d d d +2 l11 m3 l21 ( 1 (t))( 2 (t)) sin(2 (t)) + 2 l21 m3 l31 ( 2 (t))( 3 (t)) sin(3 (t)) dt dt dt dt d d d d +2 l21 m3 l31 ( 1 (t))( 3 (t)) sin(3 (t)) + 2 l22 m3 l31 ( 2 (t))( 3 (t)) sin(3 (t)) dt dt dt dt d d d d +2 l11 m3 l22 ( 1 (t))( 2 (t)) sin(2 (t)) + 2 l22 m3 l31 ( 1 (t))( 3 (t)) sin(3 (t)) dt dt dt dt d d +2 l11 m3 l31 ( 1 (t))( 2 (t)) cos(2 (t)) sin(3 (t)) dt dt d d +2 l11 m3 l31 ( 1 (t))( 3 (t)) cos(2 (t)) sin(3 (t)) dt dt d d +2 l11 m3 l31 ( 2 (t))( 3 (t)) sin(2 (t)) cos(3 (t)) dt dt d d +2 l12 m3 l31 ( 1 (t))( 3 (t)) cos(2 (t)) sin(3 (t)) dt dt d d +2 l11 m3 l31 ( 1 (t))( 2 (t)) sin(2 (t)) cos(3 (t)) dt dt d d +2 l11 m3 l31 ( 1 (t))( 3 (t)) sin(2 (t)) cos(3 (t)) dt dt d d +2 l11 m3 l31 ( 2 (t))( 3 (t)) cos(2 (t)) sin(3 (t)) dt dt d d +2 l12 m3 l31 ( 1 (t))( 2 (t)) cos(2 (t)) sin(3 (t)) dt dt d d +2 l12 m3 l31 ( 1 (t))( 2 (t)) sin(2 (t)) cos(3 (t)) dt dt d d +2 l12 m3 l31 ( 1 (t))( 3 (t)) sin(2 (t)) cos(3 (t)) dt dt d d +2 l12 m3 l31 ( 2 (t))( 3 (t)) cos(2 (t)) sin(3 (t)) dt dt d d +2 l12 m3 l31 ( 2 (t))( 3 (t)) sin(2 (t)) cos(3 (t)) dt dt d d +l12 m3 l31 ( 2 (t))2 cos(2 (t)) sin(3 (t)) + l12 m3 l31 ( 2 (t))2 sin(2 (t)) cos(3 (t)) dt dt d d +l12 m3 l31 ( 3 (t))2 cos(2 (t)) sin(3 (t)) + l12 m3 l31 ( 3 (t))2 sin(2 (t)) cos(3 (t)) dt dt

(A.10)

80

d d 2 (t))2 sin(2 (t)) cos(3 (t)) + l11 m3 l31 ( 2 (t))2 cos(2 (t)) sin(3 (t)) dt dt d d +l11 m3 l31 ( 3 (t))2 cos(2 (t)) sin(3 (t)) + l11 m3 l31 ( 3 (t))2 sin(2 (t)) cos(3 (t)) dt dt d d +l22 m3 l31 ( 3 (t))2 sin(3 (t)) + l21 m3 l31 ( 3 (t))2 sin(3 (t)) dt dt d d +l11 m3 l22 ( 2 (t))2 sin(2 (t)) + l12 m3 l22 ( 2 (t))2 sin(2 (t)) dt dt d d +l12 m3 l21 ( 2 (t))2 sin(2 (t)) + l12 m2 l21 ( 2 (t))2 sin(2 (t)) dt dt d d +l11 m3 l21 ( 2 (t))2 sin(2 (t))l11 m2 l21 ( 2 (t))2 sin(2 (t)) dt dt +l11 m3 l31 ( the second term, 2 is

2 = 2 l21 m3 l31 (

d d d d 2 (t))( 3 (t)) sin(3 (t)) + 2 l21 m3 l31 ( 1 (t))( 3 (t)) sin(3 (t)) dt dt dt dt d d d d +2 l22 m3 l31 ( 2 (t))( 3 (t)) sin(3 (t)) + 2 l22 m3 l31 ( 1 (t))( 3 (t)) sin(3 (t)) dt dt dt dt d d -l31 m3 cos(2 (t)) sin(3 (t))( 1 (t))2 l12 - l31 m3 cos(2 (t)) sin(3 (t))( 1 (t))2 l11 dt dt d d -l31 m3 sin(2 (t)) cos(3 (t))( 1 (t))2 l12 - l31 m3 sin(2 (t)) cos(3 (t))( 1 (t))2 l11 dt dt d d +l22 m3 l31 ( 3 (t))2 sin(3 (t)) + l21 m3 l31 ( 3 (t))2 sin(3 (t)) dt dt d d -l11 m3 l22 ( 1 (t))2 sin(2 (t)) - l11 m3 l21 ( 1 (t))2 sin(2 (t)) dt dt d d -l11 m2 l21 ( 1 (t))2 sin(2 (t)) - l12 m3 l22 ( 1 (t))2 sin(2 (t)) dt dt d d -l12 m3 l21 ( 1 (t))2 sin(2 (t)) - l12 m2 l21 ( 1 (t))2 sin(2 (t)) dt dt

(A.11)

81

and the third term, 3 is

3 = -2 l31 sin(3 (t))m3 l21 (

d d d d 1 (t)) 2 (t) - 2 l31 sin(3 (t))m3 l22 ( 1 (t)) 2 (t) dt dt dt dt d d -l31 m3 cos(2 (t)) sin(3 (t))( 1 (t))2 l12 - l31 m3 cos(2 (t)) sin(3 (t))( 1 (t))2 l11 dt dt d d -l31 m3 sin(2 (t)) cos(3 (t))( 1 (t))2 l12 - l31 m3 sin(2 (t)) cos(3 (t))( 1 (t))2 l11 dt dt d d -l31 sin(3 (t))m3 l22 ( 1 (t))2 - l31 sin(3 (t))m3 l22 ( 2 (t))2 dt dt d d -l31 sin(3 (t))m3 l21 ( 1 (t))2 - l31 sin(3 (t))m3 l21 ( 2 (t))2 dt dt

(A.12)

The 3 x 1 vector of gravitational components in Eq. 2.5 is   1      2   G() =       3 where the gravitational components are composed of three terms: 1 ,2 and 3 .

82

The first term, 1 is 1 = sin(1 (t))l11 gm3 + sin(1 (t))l11 gm1 + sin(1 (t))l11 gm2 + sin(1 (t))l12 gm3 +l31 cos(1 (t)) cos(2 (t)) sin(3 (t)) gm3 + l31 cos(1 (t)) sin(2 (t)) cos(3 (t)) gm3 -l31 sin(1 (t)) sin(2 (t)) sin(3 (t)) gm3 + l31 sin(1 (t)) cos(2 (t)) cos(3 (t)) gm3 +l22 cos(1 (t)) sin(2 (t)) gm3 + l22 sin(1 (t)) cos(2 (t)) gm3 +l21 cos(1 (t)) sin(2 (t)) gm3 + l21 sin(1 (t)) cos(2 (t)) gm3 +l21 cos(1 (t)) sin(2 (t)) gm2 + l21 sin(1 (t)) cos(2 (t)) gm2 + sin(1 (t))l12 gm2 the second term, 2 is 2 = l31 cos(1 (t)) cos(2 (t)) sin(3 (t)) gm3 + l31 cos(1 (t)) sin(2 (t)) cos(3 (t)) gm3 -l31 sin(1 (t)) sin(2 (t)) sin(3 (t)) gm3 + l31 sin(1 (t)) cos(2 (t)) cos(3 (t)) gm3 +l22 cos(1 (t)) sin(2 (t)) gm3 + l22 sin(1 (t)) cos(2 (t)) gm3 +l21 cos(1 (t)) sin(2 (t)) gm3 + l21 sin(1 (t)) cos(2 (t)) gm3 +l21 cos(1 (t)) sin(2 (t)) gm2 + l21 sin(1 (t)) cos(2 (t)) gm2 and the third term, 3 is 3 = l31 cos(1 (t)) cos(2 (t)) sin(3 (t)) gm3 + l31 cos(1 (t)) sin(2 (t)) cos(3 (t)) gm3 +l31 sin(1 (t)) cos(2 (t)) cos(3 (t)) gm3 - l31 sin(1 (t)) sin(2 (t)) sin(3 (t)) gm3 (A.14) (A.13)

(A.15)

83

Appendix B Maxon Motor RE-max 17
The RX-28 motor was determined to be a close match to the Maxon RE-max 17 order number 214897. Details about the characterization can be found in section 3.2.1. The datasheet is shown in the next page.

84

RE max 17 Æ17 mm, Precious Metal Brushes CLL, 4 Watt
maxon RE-max
M 1:1
Stock program Standard program Special program (on request)

Order Number

214895 214896 214897 214898 214899 215982 215983 215985 215986 215987

Motor Data
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 Values at nominal voltage Nominal voltage V No load speed rpm No load current mA Nominal speed rpm Nominal torque (max. continuous torque) mNm Nominal current (max. continuous current) A Stall torque mNm Starting current A Max. efficiency % Characteristics Terminal resistance W Terminal inductance mH Torque constant mNm / A Speed constant rpm / V Speed / torque gradient rpm / mNm Mechanical time constant ms Rotor inertia gcm2 3.0 4.5 12.0 15.0 21.0 12200 10500 11500 11600 12200 32.6 16.9 7.38 6.02 4.66 11300 8380 8760 8870 9440 1.33 2.39 3.41 3.38 3.36 0.600 0.600 0.350 0.281 0.209 17.1 12.1 14.4 14.3 14.9 7.32 2.95 1.45 1.17 0.910 87 86 86 86 86 0.410 0.0114 2.34 4090 718 7.93 1.05 1.52 0.0349 4.09 2340 871 7.44 0.816 24.0 12000 3.94 9210 3.38 0.180 14.7 0.772 86 24.0 10600 3.26 7870 3.37 0.160 12.9 0.604 86 30.0 11100 2.79 8300 3.34 0.132 13.3 0.518 86 36.0 11800 2.57 8960 3.28 0.115 13.7 0.473 86 48.0 10400 1.56 7450 3.22 0.0745 11.5 0.262 85

8.30 12.8 23.1 31.1 39.7 57.9 76.2 183 0.206 0.314 0.558 0.759 0.956 1.38 1.75 4.04 9.92 12.3 16.3 19.1 21.4 25.7 29.0 44.0 962 779 584 501 446 372 329 217 804 815 825 817 828 839 865 906 7.27 7.29 7.30 7.31 7.35 7.32 7.35 7.47 0.864 0.854 0.844 0.854 0.848 0.834 0.811 0.788

Specifications
17 18 19 20 21 22 23 24 25 26 27 28 23 24 25 26 27 28

Operating Range

Comments
Continuous operation In observation of above listed thermal resistance (lines 17 and 18) the maximum permissible winding temperature will be reached during continuous operation at 25°C ambient. = Thermal limit. Short term operation The motor may be briefly overloaded (recurring). Assigned power rating

Thermal data n [rpm] Thermal resistance housing-ambient 35 K / W Thermal resistance winding-housing 12 K / W Thermal time constant winding 7.7 s Thermal time constant motor 455 s Ambient temperature -30 ... +65°C Max. permissible winding temperature +85°C Mechanical data (sleeve bearings) Max. permissible speed 19000 rpm Axial play 0.05 - 0.15 mm Radial play 0.012 mm Max. axial load (dynamic) 0.8 N Max. force for press fits (static) 35 N Max. radial loading, 5 mm from flange 1.4 N Mechanical data (ball bearings) Max. permissible speed 19000 rpm Axial play 0.05 - 0.15 mm Radial play 0.025 mm Max. axial load (dynamic) 2.2 N Max. force for press fits (static) 30 N Max. radial loading, 5 mm from flange 7.8 N 1 7 26 g

maxon Modular System
Planetary Gearhead Æ16 mm 0.06 - 0.18 Nm Page 214 Planetary Gearhead Æ16 mm 0.1 - 0.3 Nm Page 215

Overview on page 16 - 21

Other specifications 29 Number of pole pairs 30 Number of commutator segments 31 Weight of motor CLL = Capacitor Long Life Values listed in the table are nominal. Explanation of the figures on page 49. Option Ball bearings in place of sleeve bearings Pigtails in place of terminals Without CLL

Recommended Electronics: LSC 30/2 Page 282 Notes 18

May 2011 edition / subject to change

maxon DC motor

119

Figure B.1: Dynamixel RX-28 Actuator [42]

85

Appendix C Joint Torque Controller Equations
The expanded form of Eq.3.22 for the ankle, knee and hip joint torque controllers are listed here.

C.1

Ankle torque, ankle
ankle = sin(1 (t))l11 gm3 + sin(1 (t))l11 gm1 + sin(1 (t))l11 gm2 + sin(1 (t))l12 gm3 + sin(1 (t))l12 gm2 d d +l11 m3 l31 ( 2 (t))2 cos(2 (t)) sin(3 (t)) + l11 m3 l31 ( 2 (t))2 sin(2 (t)) cos(3 (t)) dt dt d d +l11 m3 l31 ( 3 (t))2 cos(2 (t)) sin(3 (t)) + l11 m3 l31 ( 3 (t))2 sin(2 (t)) cos(3 (t)) dt dt d d d d +2 l11 m3 l22 ( 1 (t))( 2 (t)) sin(2 (t)) + 2 l11 m3 l21 ( 1 (t))( 2 (t)) sin(2 (t)) dt dt dt dt d d d +2 l11 m2 l21 ( 1 (t))( 2 (t)) sin(2 (t)) + l12 m3 l31 ( 2 (t))2 cos(2 (t)) sin(3 (t)) dt dt dt d d +l12 m3 l31 ( 2 (t))2 sin(2 (t)) cos(3 (t)) + l12 m3 l31 ( 3 (t))2 cos(2 (t)) sin(3 (t)) dt dt d d d +l12 m3 l31 ( 3 (t))2 sin(2 (t)) cos(3 (t)) + 2 l12 m3 l22 ( 1 (t))( 2 (t)) sin(2 (t)) dt dt dt d d d d +2 l12 m3 l21 ( 1 (t))( 2 (t)) sin(2 (t)) + 2 l12 m2 l21 ( 1 (t))( 2 (t)) sin(2 (t)) dt dt dt dt +l31 cos(1 (t)) sin(2 (t)) cos(3 (t)) gm3 - l31 sin(1 (t)) sin(2 (t)) sin(3 (t)) gm3 d d d d +2 l22 m3 l31 ( 1 (t))( 3 (t)) sin(3 (t)) + 2 l21 m3 l31 ( 1 (t))( 3 (t)) sin(3 (t)) dt dt dt dt d d d d +2 l22 m3 l31 ( 2 (t))( 3 (t)) sin(3 (t)) + 2 l21 m3 l31 ( 2 (t))( 3 (t)) sin(3 (t)) dt dt dt dt 86

+l31 cos(1 (t)) cos(2 (t)) sin(3 (t)) gm3 + l31 sin(1 (t)) cos(2 (t)) cos(3 (t)) gm3 d d +2 l11 m3 l31 ( 1 (t))( 2 (t)) cos(2 (t)) sin(3 (t)) dt dt d d +2 l11 m3 l31 ( 1 (t))( 3 (t)) cos(2 (t)) sin(3 (t)) dt dt d d +2 l11 m3 l31 ( 2 (t))( 3 (t)) sin(2 (t)) cos(3 (t)) dt dt d d +2 l12 m3 l31 ( 1 (t))( 3 (t)) cos(2 (t)) sin(3 (t)) dt dt d d +2 l11 m3 l31 ( 1 (t))( 2 (t)) sin(2 (t)) cos(3 (t)) dt dt d d +2 l11 m3 l31 ( 1 (t))( 3 (t)) sin(2 (t)) cos(3 (t)) dt dt d d +2 l11 m3 l31 ( 2 (t))( 3 (t)) cos(2 (t)) sin(3 (t)) dt dt d d +2 l12 m3 l31 ( 1 (t))( 2 (t)) cos(2 (t)) sin(3 (t)) dt dt d d +2 l12 m3 l31 ( 1 (t))( 2 (t)) sin(2 (t)) cos(3 (t)) dt dt d d +2 l12 m3 l31 ( 1 (t))( 3 (t)) sin(2 (t)) cos(3 (t)) dt dt d d +2 l12 m3 l31 ( 2 (t))( 3 (t)) cos(2 (t)) sin(3 (t)) dt dt d d +2 l12 m3 l31 ( 2 (t))( 3 (t)) sin(2 (t)) cos(3 (t)) dt dt d d +l22 m3 l31 ( 3 (t))2 sin(3 (t)) + l21 m3 l31 ( 3 (t))2 sin(3 (t)) dt dt +l22 cos(1 (t)) sin(2 (t)) gm3 + l22 sin(1 (t)) cos(2 (t)) gm3 +l21 cos(1 (t)) sin(2 (t)) gm3 + l21 sin(1 (t)) cos(2 (t)) gm3 +l21 cos(1 (t)) sin(2 (t)) gm2 + l21 sin(1 (t)) cos(2 (t)) gm2 d d +l11 m3 l22 ( 2 (t))2 sin(2 (t)) + l11 m3 l21 ( 2 (t))2 sin(2 (t)) dt dt d d +l11 m2 l21 ( 2 (t))2 sin(2 (t)) + l12 m3 l22 ( 2 (t))2 sin(2 (t)) dt dt d d 2 +l12 m3 l21 ( 2 (t)) sin(2 (t)) + l12 m2 l21 ( 2 (t))2 sin(2 (t)) dt dt +(2 l31 m3 cos(3 (t))l21 + 2 l11 m3 l22 cos(2 (t)) +2 l11 m3 l21 cos(2 (t)) + 2 l11 m2 l21 cos(2 (t))

87

+2 l12 m3 l22 cos(2 (t)) + 2 l12 m3 l21 cos(2 (t)) +2 l12 m2 l21 cos(2 (t)) + 2 l31 m3 cos(3 (t))l22 +m3 l31 2 + l22 2 m3 + m2 l21 2 + m3 l21 2 + l11 2 m2 +l12 2 m2 + l11 2 m1 + l12 2 m3 + l11 2 m3 + 2 l22 m3 l21 + 2 l11 m3 l12 + 2 l11 m2 l12 +2 l31 cos(2 (t)) cos(3 (t))m3 l11 + 2 l31 cos(2 (t)) cos(3 (t))m3 l12 -2 l31 sin(2 (t)) sin(3 (t))m3 l11 - 2 l31 sin(2 (t)) sin(3 (t))m3 l12 d d2  ( t ) + Kv e1 (t) + Kp1 e1 (t)) d 1 1 dt2 dt +(l11 m3 l22 cos(2 (t)) + l11 m3 l21 cos(2 (t)) + l11 m2 l21 cos(2 (t)) +Izzshank + Izzhat + Izzthigh )( +l12 m3 l22 cos(2 (t)) + l12 m3 l21 cos(2 (t)) + l12 m2 l21 cos(2 (t)) +2 l31 m3 cos(3 (t))l22 + 2 l31 m3 cos(3 (t))l21 + 2 l22 m3 l21 +l31 cos(2 (t)) cos(3 (t))m3 l11 + l31 cos(2 (t)) cos(3 (t))m3 l12 -l31 sin(2 (t)) sin(3 (t))m3 l11 - l31 sin(2 (t)) sin(3 (t))m3 l12 +Izzhat + Izzthigh + l22 2 m3 +m2 l21 2 + m3 l21 2 + m3 l31 2 )( d2 d d2 (t) + Kv2 e2 (t) + Kp2 e2 (t)) 2 dt dt +(l31 m3 cos(3 (t))l22 + l31 m3 cos(3 (t))l21

+l31 cos(2 (t)) cos(3 (t))m3 l11 + l31 cos(2 (t)) cos(3 (t))m3 l12 -l31 sin(2 (t)) sin(3 (t))m3 l11 - l31 sin(2 (t)) sin(3 (t))m3 l12 +Izzhat + m3 l31 2 )( d2 d d3 (t) + Kv3 e3 (t) + Kp3 e3 (t)) 2 dt dt

C.2

Knee torque, knee
knee = -l31 m3 cos(2 (t)) sin(3 (t))( d 1 (t))2 l12 dt d -l31 m3 cos(2 (t)) sin(3 (t))( 1 (t))2 l11 dt d -l31 m3 sin(2 (t)) cos(3 (t))( 1 (t))2 l12 dt d -l31 m3 sin(2 (t)) cos(3 (t))( 1 (t))2 l11 dt

88

+l31 cos(1 (t)) sin(2 (t)) cos(3 (t)) gm3 - l31 sin(1 (t)) sin(2 (t)) sin(3 (t)) gm3 d d d d +2 l22 m3 l31 ( 1 (t))( 3 (t)) sin(3 (t)) + 2 l21 m3 l31 ( 1 (t))( 3 (t)) sin(3 (t)) dt dt dt dt d d d d +2 l22 m3 l31 ( 2 (t))( 3 (t)) sin(3 (t)) + 2 l21 m3 l31 ( 2 (t))( 3 (t)) sin(3 (t)) dt dt dt dt +l31 cos(1 (t)) cos(2 (t)) sin(3 (t)) gm3 + l31 sin(1 (t)) cos(2 (t)) cos(3 (t)) gm3 d d +l22 m3 l31 ( 3 (t))2 sin(3 (t)) + l21 m3 l31 ( 3 (t))2 sin(3 (t)) dt dt +l22 cos(1 (t)) sin(2 (t)) gm3 + l22 sin(1 (t)) cos(2 (t)) gm3 +l21 cos(1 (t)) sin(2 (t)) gm3 + l21 sin(1 (t)) cos(2 (t)) gm3 +l21 cos(1 (t)) sin(2 (t)) gm2 + l21 sin(1 (t)) cos(2 (t)) gm2 d d -l11 m3 l22 ( 1 (t))2 sin(2 (t)) - l11 m3 l21 ( 1 (t))2 sin(2 (t)) dt dt d d -l11 m2 l21 ( 1 (t))2 sin(2 (t)) - l12 m3 l22 ( 1 (t))2 sin(2 (t)) dt dt d d -l12 m3 l21 ( 1 (t))2 sin(2 (t)) - l12 m2 l21 ( 1 (t))2 sin(2 (t)) dt dt +(l11 m3 l22 cos(2 (t)) + l11 m3 l21 cos(2 (t)) +l11 m2 l21 cos(2 (t)) + l12 m3 l22 cos(2 (t)) +l12 m3 l21 cos(2 (t)) + l12 m2 l21 cos(2 (t)) +2 l31 m3 cos(3 (t))l22 + 2 l31 m3 cos(3 (t))l21 + 2 l22 m3 l21 +l31 cos(2 (t)) cos(3 (t))m3 l11 + l31 cos(2 (t)) cos(3 (t))m3 l12 -l31 sin(2 (t)) sin(3 (t))m3 l11 - l31 sin(2 (t)) sin(3 (t))m3 l12 +Izzhat + Izzthigh + l22 2 m3 + m2 l21 2 + m3 l21 2 d2 d d1 (t) + Kv1 e1 (t) + Kp1 e1 (t)) 2 dt dt +(2 l31 m3 cos(3 (t))l22 + 2 l31 m3 cos(3 (t))l21 +m3 l31 2 )( +2 l22 m3 l21 + Izzhat + Izzthigh + l22 2 m3 + m2 l21 2 + m3 l21 2 d d2 +m3 l31 )( 2 d2 (t) + Kv2 e2 (t) + Kp2 e2 (t)) dt dt +(l31 m3 cos(3 (t))l22 + l31 m3 cos(3 (t))l21
2

+Izzhat + m3 l31 2 )(

d2 d d3 (t) + Kv3 e3 (t) + Kp3 e3 (t)) 2 dt dt

89

C.3

Hip torque, hip
hip = (l31 m3 cos(3 (t))l22 + l31 m3 cos(3 (t))l21 +l31 cos(2 (t)) cos(3 (t))m3 l11 + l31 cos(2 (t)) cos(3 (t))m3 l12 -l31 sin(2 (t)) sin(3 (t))m3 l11 - l31 sin(2 (t)) sin(3 (t))m3 l12 d2 d +Izzhat + m3 l31 )( 2 d1 (t) + Kv1 e1 (t) + Kp1 e1 (t)) dt dt +(l31 m3 cos(3 (t))l22 + l31 m3 cos(3 (t))l21
2

d2 d d2 (t) + Kv2 e2 (t) + Kp2 e2 (t)) 2 dt dt 2 d d +(Izzhat + m3 l31 2 )( 2 d3 (t) + Kv3 e3 (t) + Kp3 e3 (t)) dt dt +l31 cos(1 (t)) cos(2 (t)) sin(3 (t)) gm3 + l31 cos(1 (t)) sin(2 (t)) cos(3 (t)) gm3 +Izzhat + m3 l31 2 )( +l31 sin(1 (t)) cos(2 (t)) cos(3 (t)) gm3 - l31 sin(1 (t)) sin(2 (t)) sin(3 (t)) gm3 d d -l31 m3 cos(2 (t)) sin(3 (t))( 1 (t))2 l12 - l31 m3 cos(2 (t)) sin(3 (t))( 1 (t))2 l11 dt dt d d -l31 m3 sin(2 (t)) cos(3 (t))( 1 (t))2 l12 - l31 m3 sin(2 (t)) cos(3 (t))( 1 (t))2 l11 dt dt d d -l31 sin(3 (t))m3 l22 ( 1 (t))2 - l31 sin(3 (t))m3 l22 ( 2 (t))2 dt dt d d -l31 sin(3 (t))m3 l21 ( 1 (t))2 - l31 sin(3 (t))m3 l21 ( 2 (t))2 dt dt d d d d -2 l31 sin(3 (t))m3 l22 ( 1 (t)) 2 (t) - 2 l31 sin(3 (t))m3 l21 ( 1 (t)) 2 (t) dt dt dt dt

90

Appendix D Ryerson ELCE-Network Computers
The computer network at Ryerson University's Department of Electrical and Computer Engineering allows remote login via SSH. This section lists the computer box names that were used to run the simulations. Hardware/Software Specifications Computer Model Operating System Processor Number of Cores Memory (RAM) ENG406 DELL XX Fedora Intel 4 X ENG412 DELL XX Fedora Intel 4 X

Table D.1: Hardware specifications in ENG406 and ENG412

91

Computer Name bronte oshawa york ajax malton whitby eglinton clarkson theex appleby danforth finch guelph brampton bloor kipling dixie keele acton caledon

Gear Ratio 100 150 193 (RX-28) 200 250 300 350 400 450 500 550 600 650 700 750 800 850 900 EXTRA EXTRA

Table D.2: Computer assignment for Regeneration-Enabled Simulations (ENG412)

92

Computer Name hactar hig desiato garkbit halfrunt benjy frogstar agrajag gogrilla krikkit arthur effrafax milliway vranx yooden mella grunthos fit azgoths kria

Gear Ratio 100 150 193 (RX-28) 200 250 300 350 400 450 500 550 600 650 700 750 800 850 900 EXTRA EXTRA

Table D.3: Computer assignment for Regeneration-Disabled Simulations (ENG406)

93

Appendix E Maple Source-code
Maplescript (.mpl) was used to collect MapleSim simulation data on the EE-network (via command-line). An example script is shown below in Fig. E.1. A login and start-up Unix example is also provided in this section. We begin by logging into one of the EE-network workstations (i.e. "bronte") as shown in Fig. E.2a. Next, we cd (change directory) into the folder with a gear ratio 100 (Fig. E.2b). The screen command is then activated (Fig. E.2c) to keep the "window" active even after we close the terminal window. The nice command is then used in conjunction with the maple command to set the priority of the maple simulation. We set nice to 19 for second lowest-priority as shown in Fig. E.2d. This effectively forces the computer to allocate priority to current users and their applications and run our script only when in idle. By minimizing the CPU time to multiple processes, this decreases the likelihood of the current user into rebooting the machine. The final screenshot of maple running is shown in Fig. E.3.

94

restart: gc(): kernelopts(printbytes=false): printlevel := 0: switchdir := "/home/grad/r25wong/Desktop/MapleSimulations/Linux_100/"; currentdir(switchdir); A := MapleSim:-LinkModel('filename' = "S2S2S_regen_Probes_v13.msim"); A:-GetSubstitutions(); with(ExcelTools); with(LinearAlgebra); initanklegearratio := 100; initkneegearratio := 100; inithipgearratio := 100; currentanklesoclevel := .8; currentkneesoclevel := .8; currenthipsoclevel := .8; resultpackage := "matlabresults_regen_100.mat"; arrayresults := A:-Simulate(output = datapoint, returnTimeData = true, duration = 10, method = rosenbrock, params = [`Main.anklegearratio` = initanklegearratio, `Main.kneegearratio` = initkneegearratio, `Main.hipgearratio` = inithipgearratio, `Main.anklesoclevel` = currentanklesoclevel, `Main.kneesoclevel` = currentkneesoclevel, `Main.hipsoclevel` = currenthipsoclevel]); matrixresults := convert(arrayresults, Matrix); ExportMatrix(resultpackage, matrixresults, target = Matlab, format = rectangular, mode = binary);

Figure E.1: Maplescript Source-code Example

95

(a) SSH: Remote login into EE workstation

(b) Directory change

(c) Screen command

(d) Nice: priority scheduling

Figure E.2: Command-line instructions for starting maplescript

96

Figure E.3: Screenshot of Maplescript running

97

Appendix F MATLAB Source-code
MATLAB 2011a was used to post-process the MapleSim simulation data. The MapleSimMaplescript exports a matrix of data from the MapleSim model's various sensors and packages it into a .mat file. This section details the main m-scripts that were used to process the data.

F.1

Checksum

The checksum is first used to validate the .mat data files. It compares the final simulation time in the file against the desired simulation time and outputs a 'good data' and 'bad data' array.

98

%% CHECKSUM for files... % max is 3600 (for 1hr) clear; clc; % What is the simulation time? % 10s for 1 movement cycle % 1800s for 1/2 hr of 180 cycles... % 3600s for 1 hr of 360 cycles... simulationtime = 1000; ratioheader = [100,150,193,200,250,300,... 350,400,450,500,550,600];

%% For Regen for i = 1:length(ratioheader) myfilename = sprintf('matlabresults_regen_%d.mat',ratioheader(i)); mydata = importdata(myfilename); if max(mydata(:,1)) == simulationtime good_data(i) = ratioheader(i); else bad_data(i) = ratioheader(i); end end

99

F.2

Data Extraction

The data files were decomposed into separate variables using the following m-script.

%% Column Definitions % See MS Excel print-out gearticker = [100 150 193 200 250 300 350 400 ... 450 500 550 600]; numFiles = 12;

%% Extract and Rearrange the Data for i = 1:numFiles myfilename = sprintf('matlabresults_regen_%d.mat',i); mydata{i} = importdata(myfilename); clockdata{i} = mydata{1,i}(:,1); % ----- JOINT TRAJECTORIES ----- % desiredankletraj{i} = mydata{1,i}(:,2); desiredkneetraj{i} = mydata{1,i}(:,3); desiredhiptraj{i} = mydata{1,i}(:,4); actualankletraj{i} = mydata{1,i}(:,5); actualkneetraj{i} = mydata{1,i}(:,6); actualhiptraj{i} = mydata{1,i}(:,7); % ----- JOINT TORQUE ----- % ankletorqueinertia{i} = mydata{1,i}(:,8); ankletorquecorriolis{i} = mydata{1,i}(:,9); ankletorquegravity{i} = mydata{1,i}(:,10); kneetorqueinertia{i} = mydata{1,i}(:,11); kneetorquecorriolis{i} = mydata{1,i}(:,12);

100

kneetorquegravity{i} = mydata{1,i}(:,13); hiptorqueinertia{i} = mydata{1,i}(:,14); hiptorquecorriolis{i} = mydata{1,i}(:,15); hiptorquegravity{i} = mydata{1,i}(:,16); % ----- JOINT ACTUATOR VOLTAGES ----- % ankleinputvoltage{i} = mydata{1,i}(:,17); kneeinputvoltage{i} = mydata{1,i}(:,18); hipinputvoltage{i} = mydata{1,i}(:,19); % ----- ANKLE COMPONENT ----- % anklesoclevelstate{i} = mydata{1,i}(:,20); anklebatteryvoltage{i} = mydata{1,i}(:,21); anklebatteryinstantcurrent{i} = mydata{1,i}(:,22); anklebatteryintegralcurrent{i} = mydata{1,i}(:,23); ankleelectpowermotor{i} = mydata{1,i}(:,24); anklecurrenttomotor{i} = mydata{1,i}(:,25); anklearmresvoltage{i} = mydata{1,i}(:,26); anklearmindvoltage{i} = mydata{1,i}(:,27); ankleemfvoltage{i} = mydata{1,i}(:,28); anklemechpowerbeforegear{i} = mydata{1,i}(:,29); anklemechtorquebeforegear{i} = mydata{1,i}(:,30); ankleangvelaftergear{i} = mydata{1,i}(:,31); ankleangposaftergear{i} = mydata{1,i}(:,32); anklemechpoweraftergear{i} = mydata{1,i}(:,33); anklemechtorqueaftergear{i} = mydata{1,i}(:,34); % ----- KNEE COMPONENT ----- % kneesoclevelstate{i} = mydata{1,i}(:,35); kneebatteryvoltage{i} = mydata{1,i}(:,36); kneebatteryinstantcurrent{i} = mydata{1,i}(:,37);

101

kneebatteryintegralcurrent{i} = mydata{1,i}(:,38); kneeelectpowermotor{i} = mydata{1,i}(:,39); kneecurrenttomotor{i} = mydata{1,i}(:,40); kneearmresvoltage{i} = mydata{1,i}(:,41); kneearmindvoltage{i} = mydata{1,i}(:,42); kneeemfvoltage{i} = mydata{1,i}(:,43); kneemechpowerbeforegear{i} = mydata{1,i}(:,44); kneemechtorquebeforegear{i} = mydata{1,i}(:,45); kneeangvelaftergear{i} = mydata{1,i}(:,46); kneeangposaftergear{i} = mydata{1,i}(:,47); kneemechpoweraftergear{i} = mydata{1,i}(:,48); kneemechtorqueaftergear{i} = mydata{1,i}(:,49); % ----- HIP COMPONENT ----- % hipsoclevelstate{i} = mydata{1,i}(:,50); hipbatteryvoltage{i} = mydata{1,i}(:,51); hipbatteryinstantcurrent{i} = mydata{1,i}(:,52); hipbatteryintegralcurrent{i} = mydata{1,i}(:,53); hipelectpowermotor{i} = mydata{1,i}(:,54); hipcurrenttomotor{i} = mydata{1,i}(:,55); hiparmresvoltage{i} = mydata{1,i}(:,56); hiparmindvoltage{i} = mydata{1,i}(:,57); hipemfvoltage{i} = mydata{1,i}(:,58); hipmechpowerbeforegear{i} = mydata{1,i}(:,59); hipmechtorquebeforegear{i} = mydata{1,i}(:,60); hipangvelaftergear{i} = mydata{1,i}(:,61); hipangposaftergear{i} = mydata{1,i}(:,62); hipmechpoweraftergear{i} = mydata{1,i}(:,63); hipmechtorqueaftergear{i} = mydata{1,i}(:,64);

102

anklerefcurrent{i} = mydata{1,i}(:,65); kneerefcurrent{i} = mydata{1,i}(:,66); hiprefcurrent{i} = mydata{1,i}(:,67); ankledesiredangularvelocity{i} = mydata{1,i}(:,68); kneedesiredangularvelocity{i} = mydata{1,i}(:,69); hipdesiredangularvelocity{i} = mydata{1,i}(:,70); anklemechanicalwork{i} = mydata{1,i}(:,71); kneemechanicalwork{i} = mydata{1,i}(:,72); hipmechanicalwork{i} = mydata{1,i}(:,73); anklemotorefficiency{i} = mydata{1,i}(:,74); ankleelectricalwork{i} = mydata{1,i}(:,75); ankleelectricalaveragepower{i} = mydata{1,i}(:,76); anklemechanicalworkbeforegear{i} = mydata{1,i}(:,77); anklemechavgpowerbeforegear{i} = mydata{1,i}(:,78); anklemechavgpoweraftergear{i} = mydata{1,i}(:,79); kneemotorefficiency{i} = mydata{1,i}(:,80); kneeelectricalwork{i} = mydata{1,i}(:,81); kneeelectricalaveragepower{i} = mydata{1,i}(:,82); kneemechanicalworkbeforegear{i} = mydata{1,i}(:,83); kneemechavgpowerbeforegear{i} = mydata{1,i}(:,84); kneemechavgpoweraftergear{i} = mydata{1,i}(:,85); hipmotorefficiency{i} = mydata{1,i}(:,86); hipelectricalwork{i} = mydata{1,i}(:,87); hipelectricalaveragepower{i} = mydata{1,i}(:,88); hipmechanicalworkbeforegear{i} = mydata{1,i}(:,89); hipmechavgpowerbeforegear{i} = mydata{1,i}(:,90); hipmechavgpoweraftergear{i} = mydata{1,i}(:,91); anklebatteryelectricalpower{i} = mydata{1,i}(:,92);

103

kneebatteryelectricalpower{i} = mydata{1,i}(:,93); hipbatteryelectricalpower{i} = mydata{1,i}(:,94); ankledesiredtorque{i} = mydata{1,i}(:,95); kneedesiredtorque{i} = mydata{1,i}(:,96); hipdesiredtorque{i} = mydata{1,i}(:,97); ankletrajectoryerror{i} = mydata{1,i}(:,98); kneetrajectoryerror{i} = mydata{1,i}(:,99); hiptrajectoryerror{i} = mydata{1,i}(:,100); end

104

Appendix G MapleSim RX-28 Model
The completed MapleSim RX-28 model is shown in Fig. G.1. The upper block is composed of the DC Motor model, gear ratio and the inertia of the motor. The bottom block is the detailed view of the DC Motor in its discrete component form. The DC motor is modeled from an armature resistance, armature inductance and a rotational emf block.

105

Figure G.1: MapleSim RX-28 Model

106

Appendix H MapleSim Battery Test Circuit Model
The MapleSim NiMH battery block is shown in Fig. H.1. The MapleSim battery test circuit model is shown in Fig. H.2.

107

Figure H.1: MapleSim NiMH Battery Model with SOC and Temperature Ports

108

>

B

R

0

1 s

Probe3 TotalCharge

Probe1 soclevel
A

k=4.5

1Ahr = 3600 coulombs 3600 x 4.5 Ahr = 16200 coulombs 4.5Ahr = 1hr total discharge 16200 coulombs collected 0.16Ahr = 30hr total discharge ~ 1.22V @ 30hr w/ ~ 0 SOC ~ 16200 coulombs collected

nimhbattery

V

Probe2 batteryvoltage

Figure H.2: MapleSim NiMH battery model test circuit

109

Appendix I MapleSim H-Bridge DC-to-DC Model
The MapleSim H-Bridge discontinuous and continuous-time domain models are detailed in this section. The discontinuous-time model is shown in Fig. I.1 and Fig. I.2 is an exploded view of the H-Bridge subsystem in Fig. I.1.

110

Figure I.1: Test Circuit for Discontinuous-time H-Bridge Model

Figure I.2: Exploded view of H-Bridge Subsystem

111

Figure I.3: Test Circuit for Continuous-time H-Bridge Model

Figure I.4: Exploded view of Simplified H-Bridge subsystem

112

Appendix J MapleSim Ground Contact Model
The MapleSim ground contact model is shown in Fig. J.1.

113

Figure J.1: MapleSim ground-contact model (Courtesy of Gilbert Lai)

114

Bibliography
[1] Difficulty performing activities of daily living among medicare beneficiaries, ages 65: U.s., 1992-2009. Technical report, Centers for Disease Control and Prevention, National Center for Health Statistics, 2009. [2] P.F. Adams, M.E. Martinez, and J.L. Vickerie. Summary health statistics for the u.s. population: National health interview survey 2009. Technical Report 248, 2010. [3] R. McN. Alexander. Three uses for springs in legged locomotion. Int. J. Rob. Res., 9(2):53­61, March 1990. [4] R.D. Bellman, M.A. Holgate, and T.G. Sugar. Sparky 3: Design of an active robotic ankle prosthesis with two actuated degrees of freedom using regenerative kinetics. In Biomedical Robotics and Biomechatronics, 2008. BioRob 2008. 2nd IEEE RAS & EMBS International Conference on, pages 511­516. IEEE, 2008. [5] BionicPower. Powerwalk, 2011. [6] D. Butler-Jones. The chief public health officers report on the state of public health in canada, 2010. Ottawa: Public Health Agency of Canada, 2010. [7] J.J Craig. Introduction to Robotics Mechanics and Control. Pearson Prentice Hall, 3rd edition, 2005. [8] John J. Craig. Introduction to Robotics: Mechanics and Control (3rd Edition). Prentice Hall, 3 edition, August 2004.

115

[9] T. Dao and J. McPhee. Dynamic modeling of electrochemical systems using linear graph theory. In Journal of Power Sources, 2011, volume 196, pages 10442­10454, 2011. [10] DARPA. Darpa robotics challenge, 2012. [11] R. Davoodi and B.J. Andrews. Computer simulation of fes standing up in paraplegia: a self-adaptive fuzzy controller with reinforcement learning. Rehabilitation Engineering, IEEE Transactions on, 6(2):151 ­161, jun 1998. [12] JM Donelan, Q. Li, V. Naing, JA Hoffer, DJ Weber, and AD Kuo. Biomechanical energy harvesting: generating electricity during walking with minimal user effort. Science, 319(5864):807, 2008. [13] C.A.M. Doorenbosch, J. Harlaar, M.E. Roebroeck, and G.J. Lankhorst. Two strategies of transferring from sit-to-stand; the activation of monoarticular and biarticular muscles. Journal of biomechanics, 27(11):1299­1307, 1994. [14] Boston Dynamics. Petman. http://www.bostondynamics.com, 2012. [15] Engauge. Engauge digitizer. http://digitizer.sourceforge.net/, 2009. [16] JAPAN Co. Ltd. Eyes. Chair. http://mocapdata.com/product.cgi?product_id= 4002, 2009. [17] P. Fairley. China's cyclists take charge: electric bicycles are selling by the millions despite efforts to ban them. Spectrum, IEEE, 42(6):54­59, 2005. [18] L. Fan and E.M. Joo. Linear and nonlinear pd-type control of robotic manipulators for trajectory tracking. In Industrial Electronics and Applications, 2009. ICIEA 2009. 4th IEEE Conference on, pages 3442­3447. IEEE. [19] Daniel P. Ferris, Joseph M. Czerniecki, and Blake Hannaford. An ankle-foot orthosis powered by artificial pneumatic muscles. J. Appl. Biomech., 21:189­197, 2005.

116

[20] A. Goswami. Foot rotation indicator (fri) point: a new gait planning tool to evaluate postural stability of biped robots. In Robotics and Automation, 1999. Proceedings. 1999 IEEE International Conference on, volume 1, pages 47­52, 1999. [21] H. Hemami and V.C. Jaswa. On a three-link model of the dynamics of standing up and sitting down. Systems, Man and Cybernetics, IEEE Transactions on, 8(2):115­120, 1978. [22] Hirose M. Haikawa Y. Takenaka T. Hirai, K. The development of honda humanoid robot. IEEE Int. Conf. on Robotics and Automation, (2):1321­1326, 1998. [23] JK Hitt, TG Sugar, MA Holgate, and R. Bellman. An active ankle-foot prosthesis with biomechanical energy regeneration. Transactions of the ASME Journal of Medical Devices, 4:0011003­1, 2010. [24] H. Hoenig, D.H. Taylor Jr, and F.A. Sloan. Does assistive technology substitute for personal assistance among the disabled elderly? American Journal of Public Health, 93(2):330, 2003. [25] A.J. Ijspeert. Improvement of the cheetah locomotion control. 2010. [26] Les Promotions Atlantiques Inc. starfrit.com/. [27] Robotis Inc. Robotis e-manual v1.08.00. http://support.robotis.com/en/, 2011. [28] W.G.M. Janssen, H.B.J. Bussmann, and H.J. Stam. Determinants of the sit-to-stand movement: a review. Physical Therapy, 82(9):866, 2002. [29] Bajd T. Kamnik, R. Human voluntary activity integration in the control of a standingup rehabilitation robot: A simulation study. In Medical Engineering & Physics, volume 29, pages 1019­1029, 2007. Starfrit 93016 electronic scale. http://www.

117

[30] Fumio Kanehiro, Kenji Kaneko, Kiyoshi Fujiwara, Kensuke Harada, Shuuji Kajita, Kazuhito Yokoi, Hirohisa Hirukawa, Kazuhiko Akachi, and Takakatsu Isozumi. The first humanoid robot that has the same size as a human and that can lie down and get up. In in IEEE International Conference on Robotics & Automation, pages 1633­1639, 2003. [31] KM Kerr, JA White, DA Barr, and RAB Mollan. Analysis of the sit-stand-sit movement cycle in normal subjects. Clinical Biomechanics, 12(4):236­245, 1997. [32] R. et al. Kobetic. Development of hybrid orthosis for standing, walking, and stair climbing after spinal cord injury. 46(3):447­462, 2009. [33] A. Kralj, R.J. Jaeger, and M. Munih. Analysis of standing up and sitting down in humans: definitions and normative data presentation. Journal of biomechanics, 23(11):1123­1138, 1990. [34] Q. Li, V. Naing, JA Hoffer, DJ Weber, AD Kuo, and JM Donelan. Biomechanical energy harvesting: Apparatus and method. In Robotics and Automation, 2008. ICRA 2008. IEEE International Conference on, pages 3672­3677. IEEE. [35] G. Luo, Z. Chen, Y. Deng, M. Dou, and W. Liu. Research on braking of batterysupplied interior permanent magnet motor driving system. In Vehicle Power and Propulsion Conference, 2009. VPPC'09. IEEE, pages 270­274. IEEE, 2009. [36] M.K.Y. Mak, O. Levin, J. Mizrahi, and C.W.Y. Hui-Chan. Joint torques during sit-tostand in healthy subjects and people with parkinson's disease. Clinical Biomechanics, 18(3):197­206, 2003. [37] Maplesoft. MapleSim User's Guide. Waterloo, Canada, 2011. [38] L. McDonald and J. Janes. Aging in place: Bridgepoint/lhin literature review, 2007. [39] Meterman. Component testers (lcr55,cr50). http://www.wavetekmeterman.com/ mmusen/products/MM+LCR55+CR50.htm?catalog_name=MetermanUnitedStates. 118

[40] M. Mistry, A. Murai, K. Yamane, and J. Hodgins. sit-to-stand task on a humanoid robot from human demonstration. In ieee-ras international conference on humanoid robots (humanoids 2010), 2010. [41] N. Mohan. Electric Drives An Integrative Approach. MNPERE, 2003. [42] Maxon Motor. Re-max 17, 17mm, 4 watt. http://shop.maxonmotor.com/ishop/ article/article/214897.xml, 2011. [43] A. Naditz. New frontiers: Telehealth innovations of 2010. Telemedicine and e-Health, 16(10):986­992, 2010. [44] S. Nuzik, R. Lamb, A. VanSant, and S. Hirt. Sit-to-stand movement pattern. Physical Therapy, 66(11):1708, 1986. [45] Ottobock. C-leg. http://c-leg.ottobock.com/en/, 2012. [46] Lightening Packs. Lightening packs, 2011. [47] Procise. Vernier caliper. http://www.rona.ca/shop/

~caliper-vernier-procise-344760_hand-tools_shop. [48] L. Qingguo and D.J. Maxwell. Development of a biomechanical energy harvester. Journal of NeuroEngineering and Rehabilitation, 6. [49] M.H. Raibert. Legged Robots That Balance. Mit Press, 1986. [50] Raytheon. Sarcos. http://www.raytheon.com/newsroom/technology/rtn08_

exoskeleton/, 2012. [51] P.D. Roberts and G. McCollum. Dynamics of the sit-to-stand movement. Biological cybernetics, 74(2):147­157, 1996. [52] Trossen Robotics. Rx-28 stats. http://www.trossenrobotics.com/

dynamixel-rx-28-robot-actuator.aspx. 119

[53] LTD. Robotis CO. Robotis user's manual dyanmixel rx-28 v1.10. http://www. crustcrawler.com/motors/RX28/docs/RX28_Manual.pdf. [54] ME Roebroeck, CAM Doorenbosch, J. Harlaar, R. Jacobs, and GJ Lankhorst. Biomechanics and muscular activity during sit-to-stand transfer. Clinical Biomechanics, 9(4):235­244, 1994. [55] L.C. Rome, L. Flynn, E.M. Goldman, and T.D. Yoo. Generating electricity while walking with loads. Science, 309(5741):1725, 2005. [56] E. Schuitema, M. Wisse, T. Ramakers, and P. Jonker. The design of leo: a 2d bipedal walking robot for online autonomous reinforcement learning. In Intelligent Robots and Systems (IROS), 2010 IEEE/RSJ International Conference on, pages 3238­3243. IEEE, 2010. [57] A.B. Schultz, N.B. Alexander, and J.A. Ashton-Miller. Biomechanical analyses of rising from a chair. Journal of biomechanics, 25(12):1383­1391, 1992. [58] R.B. Shepherd and AM Gentile. Sit-to-stand: functional relationship between upper body and lower limb segments. Human movement science, 13(6):817­840, 1994. [59] B. Siciliano and O. Khatib, editors. The Handbook of Robotics. Springer, Berlin, Heidelberg, Germany, 2008. [60] J.A. Smith. Paw: a hybrid wheeled-leg robot. In Proc. of the Int. Conf. on Robotics and Automation, May 2006. [61] A. Tsukahara, R. Kawanishi, Y. Hasegawa, and Y. Sankai. Sit-to-stand and stand-tosit transfer support for complete paraplegic patients with robot suit hal. Advanced robotics, 24(11):1615­1638, 2010. [62] J. Voelcker. Top 10 tech cars [fuel efficient cars]. Spectrum, IEEE, 43(4):34 ­ 35, april 2006.

120

[63] Hristic D. Stojiljkovic Z. Vukobratovic, M. Development of active anthropomorphic exoskeletons. In Medical and Biological Engineering, volume 12, 1975. [64] M. Vukobratovic. Biped Locomotion. Springer-Verlag New York, Inc., Secaucus, NJ, USA, 1990. [65] M. Vukobratovic. Zero-moment point-thirty five years of its life, 2004. [66] C. Williams. The sandwich generation. Perspectives on Labour and Income, 16(4):7­14, 2004. [67] D.A. Winter. Biomechanics and motor control of human movement. John Wiley & Sons Inc, 2009. [68] Tomoyuki Yamamoto and Yasuo Kuniyoshi. Stability and controllability in a rising motion: a global dynamics approach. In proceedings of IROS2002, pages 2467­2472. 2002. [69] S. Yoshioka, A. Nagano, R. Himeno, and S. Fukashiro. Computation of the kinematics and the minimum peak joint moments of sit-to-stand movements. Biomedical engineering online, 6(1):26, 2007.

121

