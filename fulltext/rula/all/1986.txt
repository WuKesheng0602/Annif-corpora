MODELING OF THE LIGHTNING RETURN STROKE CURRENT AT A TALL STRUCTURE USING THE DERIVATIVE OF THE HEIDLER FUNCTION

by

Kristofer Bitner BEng. Ryerson University, 2002

A thesis presented to Ryerson University in partial fulfillment of the requirement for the degree of Master of Applied Science in the Program of Electrical and Computer Engineering.

Toronto, Ontario, Canada, 2004

©

Kristofer Bitner, 2004

UMI N um ber: EC 53458

INFORMATION TO USERS

The quality of this reproduction is dependent upon the quality of the copy submitted. Broken or indistinct print, colored or poor quality illustrations and photographs, print bleed-through, substandard m argins, and improper alignment can adversely affect reproduction. In the unlikely event that the author did not send a com plete m anuscript and there are missing pages, th ese will be noted. Also, if unauthorized copyright material had to be rem oved, a note will indicate the deletion.

UMI
UMI Microform EC 53458 Copy right2009 by ProQ uest LLC All rights reserved. This microform edition is protected against unauthorized copying under Title 17, United S ta te s Code.

ProQ uest LLC 789 E ast Eisenhow er Parkway P.O. Box 1346 Ann Arbor, Ml 48106-1346

A u th o r's D eclaration
I hereby declare that I am the sole author of this thesis. I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research.

I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

11

In stru ction s for Borrowers
Ryerson University requires the signatures of all persons using or photocopying this thesis. Please sign below, and give address and date. Nam e Signature Address D ate

m

Abstract
M od eling o f th e L ightning R etu rn Stroke Current at a Tall Structure U sin g th e D erivative o f th e H eidler F unction
© K ristofer Bitner 2004 M aster of Applied Science Department of Electrical and Computer Engineering Ryerson University Traditionally tall structures have been modeled as simple lossless transmission lines. This model is inadequate for the ON Tower, which may be modeled as a series of transmission lines with different characteristic impedances resulting in a reflection coefficient at each discontinuity. Analysis shows that these vary significantly and are related to the ratio of the current derivative peak to the current derivative 10%-90% risetime, suggesting that they are frequency dependent. The magnitude of the reflec tion from the return stroke front, if it does exist, is much smaller than was previously proposed. An alternative approach to modeling, based on modeling the current derivative, is proposed and it is found to provide a better match with the measured waveforms. The CN Tower is modeled as a series of uniform lossless transmission lines and the channel is represented by the MTLL model. The features of the measured magnetic field waveform are well reproduced.

IV

Acknowledgments
I would like to express my deepest thanks to my thesis supervisor, Dr. Ali M. Hussein for his insight, constant guidance and encouragement, and financial support. I would also like to thank the Department of Electrical and Computer Engineering and the School of Graduate Studies for their financial support. I am also grateful to my fellow graduate students Petros Liatos, Mariusz Milewski, Jahir Islam, and Serhat Erkucuk for their assistance and support.

C ontents
1 Introduction 1 4 6 7 9 10 10 11 13 15 17 21 22 24 26 33 34 41 43 48 50 58 58 60 63 68

2 The Lightning Return Stroke 2.1 Return Stroke P a ra m e te rs ...................................................................... 2.1.1 Current P e a k ................................................................................. 2.1.2 Current R ise tim e........................................................................... 2.1.3 Maximum S te e p n e ss.................................................................... 2.1.4 Return Stroke V elocity................................................................ 2.2 Tall Structures in the Lightning P a t h ................................................... 3 Lightning Return Stroke M odeling 3.1 Models for the Lightning C hannel.......................................................... 3.1.1 The Engineering M o d e ls.............................................................. 3.2 Tall Structure Models............................................................................... 3.2.1 The Modified Transmission Line M odel...................................... 3.2.2 Antenna Theory M odel.................................................................

4 The CN Tower 4.1 The MTL Model Applied to the CNTow er............................................ 4.1.1 The Reflection Coefficients........................................................... 4.2 The MTLL Model Applied to the Lightning C h a n n e l........................ 4.3 The Current W aveform............................................................................ 4.4 Simulation Procedure............................................................................... 4.5 Simulation Results and Discussion......................................................... 5 Conclusions and Future Research 5.1 C onclusions.............................................................................................. 5.2 Future Research........................................................................................

Bibliography A Main Modeling Programs

VI

List o f Figures
3.1 4.1 4.2 4.3 4.4 4.5 4.6 4.7 4.8 4.9 4.10 4.11 4.12 4.13 4.14 4.15 4.16 4.17 4.18 4.19 4.20 A vertical current distrib u tio n................................................................ A photo of lightning striking the CN Tower taken 2 km north of the T o w e r ........................................................................................................ A photo of lightning striking the CN Tower taken south of the Tower The Rogowski coil and its location ....................................................... Typical old coil current derivative and current waveforms.................. CN T o w e r.................................................................................................. Typical old coil current derivative and current waveforms.................. PR ratio vs. ground reflection coefficient........................................ PR ratio vs. observation level top reflection coefficient ............... PR ratio vs. observation level bottom reflection coefficient...... Observation level top reflection distance vs. PR r a t i o ............... Observation level bottom reflection distance vs. PR r a t i o ......... Ground reflection distance vs. PR r a tio ................................................. Cumulative distribution of ground reflection locations for different ranges of d i/dt ............................................................................................ Current derivative and associated current waveform used as the channel base c u rre n t............................................................................................... The matched current impulse and the corresponding current derivative The matched current derivative impulse and the corresponding current Reflection diagram indicating the reflections involved in the field cal culations ..................................................................................................... Measured and calculated current derivative and current waveforms for the matched current ................................................................................ Measured and calculated current derivative and current waveforms for the matched current derivative................................................................. Measured and calculated current derivative and current waveforms for the matched current derivative with included reflections from the re turn stroke front ...................................................................................... Tower contribution and total magnetic field for the matched current . Tower contribution and total magnetic field for the matched current d e riv a tiv e .................................................................................................. Total magnetic field for the matched current derivative waveform for 2 return stroke velocities............................................................................. Measured and calculated magnetic field for the matched current . . . vii 15 27 28 29 30 31 32 37 37 38 39 40 40 41 45 47 48 49 51 52

4.21 4.22 4.23 4.24

53 54 55 56 56

4.25 Measured and calculated magnetic field for the matched current deriva tive .............................................................................................................. 4.26 Calculated magnetic field for the matched current derivative with and without return stroke front reflections....................................................

57 57

vm

List o f Tables
3.1 P(z') and v for several engineering m o d e ls ..................................... 18

4.1 Maximum and minimum reflection coefflcients............................... 36 4.2 Parameters used in (4.3) to obtain the current derivative waveform in Figure 4.14 ............................................................................................... 45 4.3 Heidler function parameters used to match the current waveform in Figure 4.15 . ............................................................................................ 46 4.4 Heidler function parameters used to match the current derivative wave form in Figure 4 .1 6 ............................................................................ 47 4.5 Reflection coeflScients estimated from the measured current derivative waveform .................................................................................................. 50

IX

Chapter 1 Introduction
Atmospheric electricity has fascinated scientists for centuries. Much has been learned about lightning since Benjamin Franklin's supposition that it was an electric current and his famous experiment with the kite and key. The tools of modern science provide us with much better means to study and understand this powerful and dangerous phenomenon. The practical purpose for the study of lightning is the same now as it was over 250 years ago, for protection. Lightning has caused untold amounts of damage to life and property, from the hundreds of annual world-wide lightning deaths to the destruction of homes and land due to lightning-caused fires. Lightning backfiashover on power transmission lines can produce currents strong enough to destroy high voltage transformers and deprive populations of electricity. Lightning has also been found to cause damage to both the power and electronic systems of wind power plants, most often resulting in power outages [1]. In order to design lightning protection circuits it is necessary to estimate the expected parameters of lightning flashes, such as the peak, risetime, and maximum steepness of the return stroke current and the associated electric and magnetic fields. The relationship between the fields and the current parameters should be established by a combination of statistical data and an appropriate model for the lightning re 1

turn stroke current. Such a model may be used to determine the expected current parameters from electric and magnetic field measurements in the area of interest. The variation of conditions in the area of interest, including ground conductivity, terrain, elevation and the presence of man made structures, will influence the accuracy of the model used to estimate the return stroke current parameters. For the validation of a model it would be necessary to have measurements of both the electromagnetic fields and the lightning current. The fields are easily measured, all that is required is the installation of the proper instrumentation within a distance of a lightning strike. This distance varies from tens of meters to hundreds of kilometers [2], [3]. The measure ment of the lightning current is not such a simple matter. In order to directly measure the lightning current it is necessary to know exactly where lightning will strike. It is for this reason that the two main sources of light ning current data are rocket triggered lightning and lightning striking tall structures. Tall structures and triggered lightning stations can be instrumented to measure the lightning current and current derivative and data collected in this manner can be used with the correlated electromagnetic field waveforms to obtain insight into the lightning current. Triggered lightning is carried out based on the fact that lightning is more readily initiated when it has a shorter path to ground. The rocket trails a wire behind it which is connected to ground and so takes advantage of this characteristic of lightning. A tall structure will also be expected to receive more lightning strikes than the area surrounding it, the frequency of which should be expected to increase with structure height. Lightning striking tall structures is of particular interest in lightning protection because it has been found that the presence of a tall structure in the lightning path significantly enhances the magnitude of the resultant electric and magnetic fields. Lightning strikes to the CN Tower have been observed since 1978 [4]. The lightning

flash density in Toronto is about 2 flashes per square kilometer per year but the CN Tower receives several tens of strikes during a lightning season [5]. In fact, in the summer of 1991 the tower received 72 flashes, 24 of which occurred within 100 minutes [6]. This frequency with which the tower receives lightning makes it an excellent source for the collection of lightning data. The work presented represents the development of a model of the lightning return stroke current using current and electromagnetic field data pertaining to lightning striking the CN Tower. The current tower is modeled using sound theory and analysis and the results are favorable. Each chapter begins with a brief summary of the chapter contents. In C h ap ter 2 the lightning process is discussed both for cloud-to-ground lightning and lightning to tall structures. The concept of the return stroke current and its important parameters are introduced and the effects of a tall structure in the lightning path are described. An overview of return stroke current modeling is presented in C h ap ter 3. This includes a review of the most recent "engineering" models for the return stroke current in the lightning channel and a summary of validation testing. The basic model types for tall structures are also introduced. C h a p te r 4 outlines the development of a model for the lightning current based on measurements made at the CN Tower. An analysis of the structure of the tower and the effects the structure will have on the measured waveforms and generated fields is presented. The results of the application of the proposed model are also presented and compared with other work. In C h ap te r 5 the conclusions arrived at from the results of the previous chapter are presented along with suggestions for improvement and future research.

Chapter 2 T he Lightning R eturn Stroke
A lightning flash is a process that consists of several phases, the most important of which is called the return stroke. In this chapter the lightning process is described for typical cloud-to-ground lightning and for lightning to a tall structure. This includes an overview of the major parameters of the return stroke; the current peak, current risetime, maximum steepness, and return stroke velocity. The effects of the presence of a tall structure in the lightning path on the radiated electromagnetic fields are also described. In order for lightning to occur, the static electric field between the cloud and the ground must reach a high enough level to enable breakdown to occur. This depends for the most part on the accumulation and distribution of charge within the the cloud. In most cases it is a negative charge center in the cloud that produces the breakdown field. The majority of lightning strikes lower negative charge to ground; this is referred to as negative lightning and is the only type that will be considered herein. The entire lightning event is called a flash and typically consists of 2 or 3 phases: the downward stepped leader, the return stroke, and possibly the dart leader. In a typical lightning strike to ground the potential difference between the ground and the cloud charge distribution initiates a downward stepped leader from the cloud. 4

This downward stepped leader progresses, partially ionizing the channel, in a series of steps that are usually about 50 m long and a few meters in diameter. As each step progresses it becomes luminous in less than 1 /js and then becomes dark for a period usually lasting 50 //s [7]. After the period of darkness the next step becomes luminous and the process continues until the stepped leader reaches the ground or an upward-connecting leader. When the downward stepped leader meets the upwardconnecting leader the return stroke phase of the lightning strike begins. The return stroke current immediately begins to flow upward from the ground illuminating the channel as it moves upward. As the return stroke front progresses it heats the air in the channel and completely ionizes the channel by thermal ionization [7]. Once the return stroke current has ceased to flow a downward dart leader may form. This downward dart leader does not travel in steps as does the stepped leader since the channel is still partially ionized. The dart leader, upon reaching the ground, will initiate a subsequent return stroke. This may be followed by yet another dart leader - return stroke sequence and so on. In the event that there is no dart leader following the first return stroke, the flash is a single stroke flash. The most important phase in the lightning flash is the return stroke phase. Although the stepped leader and dart leader are involved in the transport of charge, their contributions to the current and electromagnetic fields is minimal. The substantial current flow occurs in the return stroke phase of the lightning flash, where the velocity of the charge is fast. It is for this reason that lightning modeling efforts have focused almost exclusively on the return stroke phase. A lightning strike to a tall tower differs from a natural cloud-to-ground strike in that the lightning is usually initiated by the structure. Lightning striking a tall structure tends to be mostly of the upward initiated type for tower heights in excess of 500 m [8]. The structure initiated discharge usually begins when the electric field over some critical distance from the object tip exceeds the breakdown level. At this point

6 an upward leader extending from the top of the tall structure is formed. The upward positive leader propagates upward in steps, similar to the downward stepped leader in a cloud-to-ground flash. When the upward leader reaches the charge distribution it merges smoothly into continuous current and another leader is formed, this time a downward leader from the cloud which may be similar to the dart leader preceding a subsequent stroke in cloud-to-ground lightning. When the downward leader reaches the top of the tall structure it is followed by an upward first return stroke. Subsequent dart leaders may follow that give way to subsequent return strokes [9]. Since the first return stroke in a lightning strike to a tall structure is preceded by a dart leader as opposed to a stepped leader, it resembles the subsequent return stroke of a cloud-toground flash.

2.1

Return Stroke Parameters

In the past several years the indirect estimation of lightning parameters has become more important due to the many installations globally of the so-called Lightning Lo cating Systems which measure the electric and magnetic fields due to lightning and use them to infer the lightning location and peak currents [10]. It is also important to be able to accurately determine other lightning return stroke current parameters from the measured electromagnetic fields. The parameters determined in this manner depend on certain assumptions being made about the spatial and temporal distribu tion of the return stroke current but the parameters cannot be uniquely determined in this way. In many cases different combinations of parameters such as the current peak, current risetime, and return stroke velocity may generate the same electromag netic fields [11]. This is why collection and statistical analysis of lightning data is of primary concern to lightning researchers. Among other things it provides for the establishment of relationships between the lightning parameters which will aid in the

development of a physically and theoretically sound model. A model for lightning return strokes is needed to determine the return stroke cur rents from measured fields, to predict the fields close to the lightning where it is often impractical to measure them, and to better understand the nature of lightning and other related phenomena [3]. Modeling combined with the collection of information on the characteristics of lightning is important for the protection of tall structures and nearby objects and for the insulation coordination of power lines and substations [12], [13]. Despite the protection of the phase wires on distribution towers from direct lightning strikes a large number of outages can occur due to a back-flashover. This occurs when a ground wire or transmission tower is struck by lightning. The current flows to ground and causes an instantaneous rise in the tower voltage that leads to a fiashover to one of the phase wires from the tower [14]. Lightning currents can also endanger equipment with electronic components on and nearby tall structures. For a direct strike the lightning current peak and maximum steepness are very important parameters, and for an indirect strike the magnetic field parameters, the maximum steepness in particular, are important due to the induction effects they produce. [1] [15]. A great deal of research has been focused on the threats posed by indirect lightning strikes. In the analysis of lightning-induced surges on above-ground power distribution and telecommunication lines, the lightning electromagnetic fields within a few kilometers of the strike point during the first lOjis are especially important [16].

2.1.1

C urrent P eak

The lightning peak current is one of the most important lightning parameters; in fact almost all of the lightning protection standards worldwide are based on lightning peak measurements from two towers in Switzerland [17]. Measured current waveforms at tall structures and at triggered lightning facilities, and by inference also the current in a cloud-to-ground flash, have more or less the same waveshape. This is true for

8 the ''undisturbed" current, that is the current at the channel base that would be measured in the absence of the structure. The waveform consists of a very short slow rising portion, followed by a fast rising portion that levels off briefly at the peak. This is followed by a short period of moderate decrease which precedes a very long period of slow decrease. The action integral, which provides a measure of the energy dissipated in a resistor and may be used to predict the physical damage caused by a lightning current, is the integration of the square of the current over time [8]. Thus if the current peak is higher, the action integral will be higher, and the flash is more likely to cause damage to any object within its path. The peak current also has an effect on the fields radiated by the lightning current. A positive correlation was found between the measured electric and magnetic field peaks and the current peaks measured at the CN Tower [9]. Theoretical work has also been done and it has been concluded that a current waveform whose amplitude decreases along the channel produces a radiation field that has a faster decay than does the radiation field of a current waveform whose amplitude does not vary with height. The faster the peak decreases with height, the more apparent is the decay in the electric field [11]. It is this evidence both experimental and theoretical that support the use of this relationship to determine the current peak from field measure ments. In fact, the estimated lightning peak current is one of the outputs of modern lightning locating systems [17]. Although the empirical evidence suggests a positive relation between the current peak and the fields, there are other parameters that could influence the fields. For instance it has not been established whether or not a relationship between peak fields and current peaks determined in a given region will apply to other regions with a different ground conductivity [17].

2.1.2

Current R isetim e

The risetime of the return stroke current is usually taken between 10% and 90% of the peak current value. Optical measurements suggest that the return stroke current risetime increases with the height of the return stroke front [18] and at least one model has predicted a rapid increase in risetime over the first few hundred meters of the channel followed by a slower increase with height [19]. The effect of risetime on the radiation field was studied in [11] and it was found that the radiation field magnitude tends to decrease for a current with an increasing risetime. If the current risetime is assumed to increase monotonically with the return stroke front height then after the initial field peak the field will be smaller at all times. If the risetime is assumed to increase rapidly over the first few hundred meters and then increase more slowly afterwards, the initial field peak will be lower but the field will approach that of a return stroke current with constant risetime. Channel tortuosity, though usually not considered in determining the return stroke current from measured fields, can vary from less than 1 m to more than 1 km [8]. Since the channel is established in steps, a tortuous channel may consist of vertical and tortuous sections. At points where these steps join there is a change in direction of propagation of the current wave. The effect of such changes in direction is to introduce fine structure into the electromagnetic radiation fields [20], [11]. The effect of channel tortuosity on the electromagnetic fields has been found to depend to a certain extent on the risetime of the return stroke current; if the risetime is shorter than the time it takes for the return stroke front to traverse a tortuous section of channel then the variations in the fields will be more significant [11].

10

2.1.3

M axim um S teep ness

The maximum steepness of the current is synonymous with the maximum current derivative. The maximum steepness is related to both the peak and risetime of the current and a strong correlation between the maximum steepness and current peak has been found [21]. Thus not unexpectedly this parameter has been found to have a positive relationship with the maximum steepnesses of both the electric and magnetic fields [9]. The steepnesses of the fields are responsible for the induction effects in electronic equipment and so the peak current derivative is a critical parameter in the design of lightning protection equipment [22].

2.1.4

R etu rn Stroke V elocity

The measurement of return stroke velocity has been done using streak camera photog raphy and, more recently, using photodiode arrays. In most cases the time resolution of streak photography is not good enough to determine the changing return stroke velocity so photodiode array measurements are preferred. Optical measurements us ing both methods indicate that the return stroke velocity decreases with height [3], [23],[24] [25]. This variation of the return stroke velocity with height has also been predicted by theory [11]. In cloud-to-ground lightning the return-stroke velocity de creases significantly over the first few hundred meters [26]. The return stroke velocity for natural and triggered lightning over a short section longer than 500m of the bottom of the lightning channel has been measured using photoelectric arrays for a relatively large sample of events [25]. The natural lightning mean return stroke velocity was found to be 1.9 X 10* m /s and the triggered lightning mean velocity was calculated as 1.3 X 10* m /s. Some researchers have proposed a relationship between the peak return stroke current and the velocity [26]. There is no experimental evidence to suggest that this may be the case. In fact a lack of correlation between the two parameters has been found for triggered lightning [25], [27]. If a positive relationship were to

11 exist, based on what is known of lightning physics, then it would depend on many factors and so the correlation data would be scattered [8]. It was observed in [23] that the channel luminosity tends to decrease with the up ward progression of the return-stroke front. Since the current peak is also attenuated with increasing height it would be reasonable to assume that the two phenomena are related. Laboratory experiments with long sparks has shown that the optical out put from such sparks agrees with the rising part of the measured current waveform. There is however no substantial evidence to suggest a similar relationship between the channel luminosity and the return-stroke current peak [3]. It is probable that the luminous front of the return stroke is the portion of the channel where the power losses are greatest and it is likely that the peak of the power loss occurs earlier in time than the current wave peak [8]. The return stroke velocity has been found to have an effect on the radiated fields. The magnitude of the electromagnetic field shows a dependence on the return stroke velocity such that a higher return stroke velocity will result in a higher electromagnetic field peak [13]. For a return stroke whose velocity is decreasing with height, the tail of the resulting radiation field decays more rapidly than does that of a return stroke with constant velocity [11]. A rapid decrease in the return stroke velocity across the first few hundred meters of the channel will produce a narrow initial peak in the radiation field [11]. The velocity will also affect the fields radiated by a tortuous channel. A decrease in return stroke velocity results in the broadening of the variations that may be found in the fields generated by tortuous channels [11].

2.2

Tall Structures in the Lightning Path

Most tall structures, such as telecommunication towers and skyscrapers, are elec trically well grounded. When lightning attaches to a well grounded strike object 2

12 current waves propagate simultaneously away from the attachment point, one up wards into the channel and the other downwards into the tall structure. The return stroke current within the structure propagates at a speed very near the speed of light. Based on the relationship between return stroke velocity and field magnitudes it is reasonable to expect the presence of a tall structure in the lightning path to enhance the radiated fields. In fact the presence of a grounded elevated strike object in the lightning path does have a significant effect on the return stroke current waveform and on the electromagnetic fields radiated [28]. Lightning to a tall structure has been found to result in an increase in both the electromagnetic field peak and maximum steepness compared to lightning strikes to ground with similar current parameters [13], [8]. In the case of lightning striking the CN Tower it was experimentally deter mined that the field peak associated with a lightning strike to the tower was 2 to 3 times as large as that associated with a similar strike to ground [13], [9]. The measured lightning current waveforms at tall structures may be affected by transient processes in the structure related to reflections from the extremities and impedance discontinuities in the structure [29]. Such processes can give rise to in creased and decreased current peaks at the locations where reflections overlap. This is particularly noticeable upon the arrival at the ground of the return stroke current peak where it experiences reflection that could result in it nearly doubling [8]. The dependence of the radiated fields on the peak current thus partly explains the en hancement of the fields by lightning strikes to tall structures. Such effects are also noticeable, to a lesser degree, in triggered lightning. It is argued that lightning occurring in mountains is similar to that striking tall structures so the information collected at the CN Tower and other similar sites should be particularly useful in the application to the lightning protection of power lines crossing mountain ridges [12].

Chapter 3 Lightning R eturn Stroke M odeling
As mentioned in the previous chapter, lightning to a tall structure is different from lightning to ground. The modeling of the return stroke current for lightning to a tall structure reflects this difference. The four categories of lightning return stroke models are presented in this chapter. The models relating the return stroke current to the electromagnetic fields at a distance are predominantly of the so called engineering type. The most common accepted models of the engineering type are described and compared, and the two types of models of tall structures, the transmission line and antenna theory models, are also introduced. There are two methods that have been used to determine the electromagnetic fields from known current and charge distributions, namely the dipole and monopole methods [30], [31]. The two differ in that the dipole method requires only that the current distribution be known, whereas for the monopole method the charge distribution must also be known. The monopole method does not lend itself to application to the more complex models that must be used in order to model a process such as the lightning return stroke. On the other hand, the dipole method is often used to determine the fields from antennas and is suitable for the determination of lightning generated fields. The dipole method uses the Lorentz condition relating 13

14 the vector magnetic potential to the scalar electric potential and Maxwell's equations to obtain expressions for the electromagnetic field. The vector magnetic potential due to the current distribution is determined by taking a summation of the contributions of all of the incremental time-varying current elements that constitute the current path. For a current distribution confined to a vertical line located above a perfectly conducting ground as shown in Figure 3.1, the expressions for the incremental electric and magnetic fields at ground level at a radial distance r from the channel base are given by [3]

dEz{r,t) =

27ren

BP{z`
h{z' )

2z'^ -- r ^ . . , cR^{z') '

R{z'). c

di{z', t -- R{z') / c) c^R?{z') dt

(3.1)

dH4r,t)=^

dz'

R ^ z ') ' '

^

' cR?i^z')

dt

(3.2)

The term containing the integral of the current in (3.1), the charge transferred through dz', is the electrostatic field component which is the dominant field compo nent within tens of meters of the channel. The electrostatic component of the electric field contributes significantly to the total electric field for distances up to a few kilo meters [10]. The term containing the current is called the induction component of the electric field and the term containing the current derivative is the radiation compo nent which, due to its relatively weak dependence on distance, is the dominant field at greater distances from the channel. The term containing the current in (3.2) is

15 referred to as the induction or magnetostatic term and is the dominant field compo nent close to the channel. The term containing the current derivative is called the radiation term and is the dominant magnetic field component at greater distances from the source [20]. The radiation term has also been found to be the dominant term at close range at the beginning of the return stroke discharge at the time of current derivative peak [22].

dz':

IMAGE

LJ

Figure 3.1: A vertical current distribution

3.1

Models for the Lightning Channel

Models for the lightning return stroke current fall into one or two of four categories as defined in [8] and [32].

16 (1) The gas dynamic models are based on the radial evolution of a short segment of the lightning channel and its associated shock wave. Models of this type rely on the solution of 3 gas dynamic equations and output physical quantities such as pressure and mass density. (2) The electromagnetic models usually represent the channel by a lossy thin-wire antenna approximation. They rely on the numerical solution of Maxwell's equations to determine the current distribution in the channel which can be used to calculate the electromagnetic fields. (3) The distributed-circuit models represent the lightning channel by a transmission line with per unit length resistance, inductance, and capacitance. The circuit is used to determine the current distribution along the channel from which the electromag netic fields may be calculated. (4) The engineering models are based on the specification of the current or charge density distribution. The actual physics of the lightning process is not the focus, rather the objective of these models is to match the predicted to the measured elec tromagnetic fields at several distances from the channel. In general the models upon which lightning protection is based are of the elec tromagnetic and engineering types. There are generally few parameters to specify once the exciting current or voltage waveform has been specified, making models of these types relatively simple to apply. Among the 4 classes of models, the engineering models have been most often used in the analysis of lightning-induced voltages [2]. This is probably because most power systems engineers are familiar with the concepts upon which these models are based. Almost all of the engineering models that are still considered viable fall into one of two categories: transmission line type models and traveling current source type models, also referred to as current propagation and current generation models [33]. The primary difference between these two types is the direction of propagation of the current wave [8]. For the transmission line models

17 the current wave propagates upwards whereas for the traveling current source type models it propagates downwards from the return stroke front. Although the current wave travels in opposite directions, the current in both models still flows in the same direction, that is with negative charge being transported to ground. Modern return stroke models have been signiflcantly improved since the first one was published in 1941. Most of the recent models are able to reasonably well reproduce the measured fields [3].

3.1.1

T h e E ngineering M od els

In the basic transmission line (TL) model the channel is represented by a lossy trans mission line extending upwards from the ground. It is seen as a lumped parameter line in which the speed of current propagation is less than the speed of light. The simplest TL model assumes that the field point, normally specified at ground level, is far enough removed from the channel location that all points on the channel are equidistant from the field point. This assumption in addition to the assumption that the ground conductivity is high enough that propagation effects will be negligible can be used to relate the electric radiation field to the current at the channel base by [32]

=

-'/<=)

(3 3)

where v is the current wave velocity which is equal to the return stroke velocity, and r is the distance to the field point. It has also been assumed that r is much greater than the height to which the return stroke front has risen by time t -- r/c. The basic TL model assumes that the return stroke is a current impulse that travels up the channel at a constant velocity without undergoing any attenuation or change of waveshape. Using a TL return-stroke velocity of 1.5 x 10® m /s the peak return stroke current may be estimated from the measured field [26]. Given measured current and

18 Model TL MTLL MTLE TCS P{z!)
1 V

Vf Vf Vf

1 - z 'f H exp{--z!j\)
1

--c

Table 3.1: P{z') and v for several engineering models far field waveforms, 3.3 has also been used to estimate the return stroke velocity v [32]. In a comparison between the measured electric field at 2km and those obtained by Lin et al. [34] using the TL model for a lightning strike to ground, the TL model field deviated significantly from the measured field. The magnetic field at the same distance was however roughly reproduced. In the same study the TL model was found to generate fields that were similar to the measured fields at 200km but only for the first 20//S or so. The basic TL model is rather simplistic in that it makes several assumptions that do not hold in many cases and it ignores the contribution of rest of the channel above ground to the fields. For the more complex transmission line models, and models of the traveling current source type, the current is specified at every point on the lightning channel as a function of the current at the channel base 7(0, t) [32]. In these models the current at an arbitrary time and height z' is given by [8] as

I{z', t) = u{t --

(z')7(0, t -- z'/v)

(3.4)

where u is the heaviside function, P{z') is a height dependent attenuation factor, Vf is the return stroke front velocity, and v is the current wave velocity. The variable values for several engineering type models are summarized in Table 3.1. In the simple TL model the current amplitude does not experience any attenuation as it propagates up the channel. In the other two transmission line models, the modified transmission line with linear current decay (MTLL)[35] and the modified

19 transmission line with exponential current decay (MTLE) [36], the current undergoes attenuation as a function of height. The supposition in the simple TL model that the current propagates unattenuated is not physically sound, as it is much more likely that some charge is deposited on the channel as the current wave propagates, thereby resulting in a decrease of the channel current [37]. The current decay in the MTLL model is linear with height. Once the return stroke front, and the current wave which propagates at the same speed, reaches the effective channel height H the current has decayed to zero. This model is based on the assumption that the charge distribution on the leader channel is uniform below H and zero above it and so the deposited charge is uniform below H, leaving the channel with no net charge. The current decay in the MTLE model is exponential, such that by the time the return stroke front has reached a height of A the current has decayed to 37% of its initial value. In this case it is assumed that there is no charge on the leader channel so that the net charge on the channel after the current wave has traversed it has an exponential distribution with the greater portion of the charge being near the ground. All three of the TL type models assume that the return stroke front and current wave propagate with the same velocity. This assumtion is accepted since in the case of a return stroke current velocity slower than that of the front velocity in the TL models there is no apparent difference in the resultant radiation fields [38] and there is no evidence to support the possibility that the current wave may propagate faster than the return stroke front. Most of the recently introduced return stroke models assume that the charge de posited on the corona sheath of the leader is the source of the return stroke current [26]. The simple traveling current source (TCS) [39] model assumes that the current is generated at the upward moving return stroke front and propagates to ground at the speed of light. As the return stroke front moves upward the current is assumed to turn on instantaneously, resulting in a current discontinuity at the front. The TCS

20 model also assumes that there is no impedance discontinuity at the channel base, an unrealistic assumption since for a well grounded object or a highly conducting ground there is significant reflection expected at the attachment point. This may result in in accurate field predictions for short distances from the channel. The Diendorfer-Uman (DU) model is a modified TCS model that attempts to account for the discontinuity at the current front by allowing the current at the return stroke front to turn on with a time constant is given by
td -

The expression for the current at a height z' for the DU model

/(z ',

(o. ( + 1 ) - / (o. ^

exp

Td

(3.5)

Setting Td = 0 reduces the DU model to the TCS model. The DU model is an improvement in that it corrects for the discontinuity at the return stroke front but the discontinuity at ground is still present. There are two approaches used for model validation. One involves using a typical return stroke channel base current with a typical return stroke velocity and then comparing the model generated electromagnetic fields to typically measured fields. The other consists in using the measured channel base current and measured return stroke velocity for an event to compute the generated fields and then comparing them with the measured fields for the same event [32]. The second approach is preferred but it is only possible to apply it to lightning striking tall structures and triggered lightning. A recent comparison of the TL model and the TCS model for fields measured very close to triggered lightning indicated that the TL model was able to reproduce the measured data for the first microsecond or so for return stroke speeds between 1 x 10® m/s and 2 x 10® m /s whereas the TCS model was not [40]. The deficiency of the TCS model may be due to its supposition that a negative charge density exists at and near the channel bottom based on the unrealistic condition that

21 matched conditions exist at ground [40]. Various comparisons of engineering models have been carried out using both validation approaches [37], [32],[40],[16]. A recent summary of validation results of the engineering models is found in [8]. Based on the validation results and mathematical simplicity the models are ranked in the following order: MTLL, DU, MTLE, TCS, and TL. However, for simultaneously measured current, current derivative, and 2-dimensional return stroke velocity, the TL model was found to better reproduce than the MTLE, TCS, and DU models the main peak at a distance of 5 km [41]. The TL model may still be considered useful for calculating the field peak from the current peak or vice-versa, since it is mathematically simple and predicts the peak relationship as well or better than other more complex models. No simple engineering model has managed to reproduce all of the features of the fields that comprise the benchmark for models for lightning strikes to ground. The discharge type model proposed by Cooray [15] that has been found to reproduce all of the typical field waveform features is relatively complex compared to the engineering models [2]. It is worth mentioning that a TCS type model has recently been proposed that can apparently successfully reproduce all the features of typical electromagnetic field waveforms of natural and triggered lightning return strokes [2]. This model has not been subjected to further testing and so is not considered here. It is also worth mentioning that since there is presently no method available to measure the charge and current distribution along the lightning channel the physical basis of the models can not be validated.

3.2

Tall Structure Models

As mentioned earlier the introduction of a tall structure into the lightning path has a noticeable effect on the generated fields and indeed the single upward propagating current pulse assumed by the TL model cannot account for the fine structure notice

22 able in the fields due to lightning strikes where an elevated object is in the lightning path [22]. A model involving two current pulses, one propagating upward from the top of the tower and the other propagating down the tower is better able to repro duce the measured fields [10]. The speed of propagation of the current wave in a well grounded structure is expected to be very near the speed of light. In modeling the return stroke current in a tall structure the ground is generally considered to be per fectly conducting, as it is for cloud-to-ground lightning modeling. This assumption greatly simplifies the modeling of the return stroke current and it is supported by measurements of induced voltages on distribution lines within a few hundred meters of triggered lightning and lightning to a tall structure which have been found to agree with calculated values assuming a perfectly conducting ground. There were also cases where it was found that ground conductivity was a significant factor in generating induced voltages on distribution lines, with the factor increasing with distance [42].

3.2.1

T h e M odified Transm ission Line M od el

A tall structure is usually modeled, as a lossless uniform transmission line vertically extended above a perfectly conducting ground. Such a model is referred to as the modified transmission line (MTL) model. When the return stroke is initiated the current wave begins its propagation down the tall structure at the speed of light. Due to impedance discontinuities at the top and bottom of the structure, current waves will be partially refiected and transmitted at the extremities. The current reflection coefficient Pg for a downward current wave incident at ground is given by

where Z,, is the characteristic impedance of the tall structure and Zg is the grounding impedance. Thus for a grounding impedance less than the characteristic impedance

23 of the structure pg will be positive. In such a case the magnitude of the current at ground will be the sum of the incident and reflected waves. For pp = +1 this would result in a doubling of the current wave when it reaches ground. This characteristic of lightning strikes to tall structures is one of the major contributing factors to the field enhancement effect. Once the current has been reflected it propagates back up the tall structure until it arrives at the top, where it is partially reflected back down into the structure and partially transmitted up into the channel. The multiple reflection process along the tall structure continues until the pulse energy is dissipated in the ground and the lightning channel [13]. The expressions for the current in the channel and within the tall structure modeled as a uniform lossless transmission line of height h are derived in [10]. For a channel current that does not vary with height the expression is given by

(3.7)

for Q < z < h

i(z, t) = io (* - ^

)

+ E

- A)io

^

(3.8) fo r z > h where pt and pg are the reflection coefficients at the top and bottom of the tall structure, respectively, fo(t) is the original return stroke current pulse at the top of the structure, and n is the reflection number. In prior works the reflection coefficients at ground and at the top of the tall structure have been assumed to be constant and independent of frequency [10], [13], [43]. It has been proposed that the reflection coefficients may be frequency dependent and thus may be related to the current peak and risetime parameters [28]. However,

24 Fuchs [44] found that for the Peissenberg tower in Germany the reflection coefficients at the top and bottom were apparently independent of current peak and maximum steepness, which might suggest that they are not linearly frequency dependent. The reflection coefficient at ground can be influenced by nonlinear effects in the soil that depend on the magnitude of the current. The reflection coefficient at the tower top is expected to decrease with the decrease in channel impedance that would be expected to accompany a higher current [8j. The determination of the reflection coefficients at the extremities and at its major internal structural discontinuities is not always an easy task [28]. Extraction of the coefficients from current waveforms can involve a great deal of approximation, depending on the structure height and current magnitude. Determination of the coefficients from the current derivative is generally simpler as the reflection peaks are usually easier to discern, although overlapping reflections can make the determination impossible. Recently the adequacy of the transmission line model for the extraction of the primary lightning current parameters from measurements at tall structures was val idated [45]. This was done using a reduced scale model of the ON Tower. It was concluded that the MTL model is adequate for the determination of the primary current parameters from measurements.

3.2.2

A n ten n a T h eory M od el

The response of a conducting body, such as a wire, to an incident electromagnetic pulse is equivalent to the diffraction of electromagnetic waves by metallic obstacles. Assuming that the wire has a small circular cross section compared to the wavelength, it may be approximated by a thin wire. Given such an assumption, the current is assumed to be confined to the axis of the wire and the boundary condition for the electric field at the surface of the conductor may be used in combination with Maxwell's equations to obtain an electric field integral equation [46]. In the antenna

25 theory model the tower may be represented by a thin wire and the channel by a lossy wire antenna. A voltage source is located at the tower tip and once the voltage waveform is specified the method of moments may be applied to solve the electric field integral equation which may consequently be used to determine the current
distribution along the tall structure and the channel.

Such a model was recently

applied to the CN Tower [28].

C hapter 4 T he C N Tower
In this chapter the CN Tower structure is described along with the instrumentation that has been used in the study of lightning at the tower. An analysis of the reflection coefficients at the bottom of the tower and at the internal structural discontinuities is presented and the model for lightning striking the CN Tower is introduced. The matching of the Heidler current and current derivative to the initial impulse of the measured waveforms is followed by the evalution of the model using the measured current derivative and magnetic field waveforms. The effects of the variation of return stroke velocity and reflections from the return stroke front are also considered. Lightning at the CN Tower has been observed since 1978, two years after it was erected. Figure 4.1 shows a photo of lightning striking the tip of the CN Tower. This photo was taken 2 km north of the tower using a VHS camera in the fall of 1996. Figure 4.2 is a photo taken from the south of the CN Tower, lypically lightning to the CN Tower involves the attachment of a single channel to the tower top, as shown in Figures 4.1 and 4.2. By 1991 the tower was instrumented to measure the lightning return stroke current derivative and a measuring station was set up 2 km north of the tower to measure the azimuthal and radial magnetic fields and the vertical electric field. The recording system used to capture the waveforms consists of a 10 ns 26

27

BE: D 3 :

23:32:

H

Figure 4.1: A photo of lightning striking the CN Tower taken 2 km north of the Tower 10 bit dual-channel digitizer and a computer. In most cases there are simultaneously measured azimuthal magnetic field and vertical electric field waveforms. In many cases the measured waveforms exceeded the set range of the digitizer making it impossible to determine the field peak. There are fewer records for the radial magnetic field which is usually assumed to be low. The lightning current derivative is measured using a 3 m, 40 MHz Rogowski Coil located at 474 m above ground level (AGL). The coil has a risetime of 8.7 ns, a sensitivity of 0.32 V/(A/ns), and an accuracy of ± 6%. The CN Tower steel structure above the skypod (447 m AGL) is a hollow steel structure with a pentagonal cross section. At 474 m each side of the steel structure has an elliptic opening in its middle. The Rogowski coil passes through 2 adjacent openings, encircling 1/5 of the tower structure. This is illustrated in Figure 4.3. For a lightning strike sufficiently far from the coil location the current should be evenly distributed between the 5 sides before it arrives at the coil. Thus the coil may be assumed to measure 20% of the current [5]. The recording system used to capture the waveforms used here is located at 372 m AGL and consists of a 10 ns 10 bit

28

1

Figure 4.2: A photo of lightning striking the CN Tower taken south of the Tower dual-channel digitizer and a computer. The digitizer is connected to the Rogowski Coil by a 146 m triaxial cable. The total risetime of the current derivative measuring system is estimated to be approximately 20 ns [5]. A typical current derivative measured by the Rogowski Coil is shown in Figure 4.4. There are several distinct peaks visible in the current derivative waveform. These correspond to reflections from the structural discontinuities within and the extremities of the tower. The CN Tower is depicted in Figure 4.5 with the major discontinuities labeled. The first peak in the current derivative waveform corresponds to the initial peak from the injected current at the top of the tower. The second peak corresponds to the reflection from the top of the observation level. The third peak is negative and corresponds to the reflection from the bottom of the observation level. The fourth peak is the largest after the first peak and corresponds to the reflection from ground. The fifth peak is negative and is due to the reflection of the ground reflected wave

29

,CN T o w e l'S steel structure

Rogowski Coil
I |BNCwmM«

'iè 'B o iiip it .

Figure 4.3: The Rogowski coil and its location from the top of the tower. The origin of the sixth peak is uncertain but it may come from an intermediate reflection, be a sum of reflections, or it may be due to reflection from the return stroke front. In the summer of 1997 a new current derivative measurement system was installed at the CN Tower. The new system features a 6 m, 20 MHz Rogowski Coil which encircles the whole of the steel structure at 509 m AGL. The coil is connected to the recording station via an optical fiber link. The signal to noise ratio of the new system is superior to that of the old because it measures the whole current derivative and uses an optical fiber instead of a triaxial cable [4]. The coil located at 474 m is referred to hereafter as the old coil and the coil located at 509 m will be referred to as the new coil. For the past 3 years the new coil performance has deteriorated so its signal has been used only to trigger the digitizer. A waveform measured by the new coil is shown in 4.6. This waveform displays all of the peaks visible in the old coil waveform. The second peak that immediately follows the first peak is due to reflection from the

30

30

First Peak

0 ) 3 p

Second Peak

20 10

Fourth Peak Fifth Peak Sixth Peak

Third Peak -4
-2 0 2

4 Time (us)

6

8

10

12

10

I
o
3

-6

-4

-2

0

2

4 Time (us)

6

8

10

12

Figure 4.4: Typical old coil current derivative and current waveforms the skypod. This reflection is not visible in most old current waveforms except in those with a very sharp first peak. This is due to the relative proximity of the old coil to the skypod, which leads to a short propagation time between the skypod and the old coil, resulting in the overlap of the initial peak and this reflection. The reflection from the tower top is less visible in the new coil waveform for similar reasons. The new coil is located closer to the tower top so there is overlap between the ground reflection and the tower top reflection, making it difficult to accurately estimate the reflection coefficient of the tower top from new coil waveforms. As was mentioned previously, a current wave traveling down a tall structure will be reflected at ground and at the top of the structure. For shorter structures the determination of the current waveform injected at the channel base can be difficult. In this case, the reflections from ground and the top of the structure may overlap with that of the initial current pulse due to the relatively short propagation time

31

T ow er T op 553 m O ld R o g o w s k i C o ll ·474 m Skypod 444 m . O b s e r v a tio n L evel T o p 360 m O b s e r v a tio n L e v e l B o tto m 330 m

g

T ovver B o tto m Om

Figure 4.5: CN Tower

32

20 w' 15

 o

-5
1

0

1

2

3 Time (us)

4

5

6

7

4

Î3

1
3

2
1

Ü

0 -2 0

-10

0

10

20

30

40

50

60

Time (us)

Figure 4.6: Typical old coil current derivative and current waveforms of the current wave in the shorter structurer. A taller structure, such as the CN Tower which is one of the tallest instrumented structures in the world, does not have this problem. The location of the sensing coils far above the ground ensures that the main reflection from ground arrives after a substantial amount of time such that the main waveform peak may be considered to be uncontaminated as compared to measurements taken closer to ground on smaller structures [5]. Peak currents measured at tall structures are expected to be lower than those of typical lightning strikes to ground. This is due in part to the fact that the enhanced electric field strength at the top of the tower provides better conditions for the initi ation of a discharge than those present at the ground. The quantity of charge in the cloud required to initiate a strike is lower than for a strike to ground since the tower is at the same potential as the ground but closer to the charge distribution. Thus

33 the quantity of charge that will be transferred to ground, and hence the current, is less than for a corresponding lightning flash to ground. It is for this reason that the peak currents measured at the CN Tower compared to those measured elsewhere are statistically lower [5]. The vast majority of lightning strikes to the CN Tower are upward-initiated and so all of the experimental data from the tower are similar to those of subsequent strokes, as opposed to first strokes, in downward initiated lightning [28]. For the period between 1992-2001 there were only 2 downward initiated flashes out of 308 confirmed strikes to the CN Tower [4]. First strokes from flashes to the CN Tower usually have a lower current steepness, higher current peak, and longer risetime than subsequent strokes. These features are also common to first strokes in cloud-tcnground lightning but there are features which differ between first strokes at the CN Tower and first strokes from lightning to ground.

4.1

The MTL Model Applied to the CN Tower

The 3 major discontinuities in the CN Tower, indicated in Figure 4.5, will result in current reflections. The CN Tower has traditionally been modeled as a single, uniform, lossless transmission line [13],[9] where only the reflections from the top and bottom of the tower are considered. For a more accurate reproduction of the measured current and field waveforms, a better representative model of the tower should be used. Representing the tower by multiple transmission lines in order to account for internal discontinuities should provide better results than those obtained from the single transmission line model. Using the old coil waveforms, which are far more numerous than the new coil waveforms, allows us to determine how many transmission lines should be used and where they ought to terminate. Since the reflection from the skypod is rarely visible

34 in the current derivative waveforms, it will not be considered in the model. The first major reflection after the initial peak in the current derivative waveform as shown in Figure 4.4 is that from the top of the observation level. Therefore the first transmission line may be defined as existing between the top of the Tower and the top of the observation level. The next major reflection comes from the bottom of the observation level; this suggests that a second transmission line should be located between the top and bottom of the observation level. The next major reflection is due to the ground and so a third and final transmission line is located between the bottom of the observation level and the ground. The last reflection, referred to as peak six in Figure 4.4 may be due to a reflection from the channel, but this has yet to be established.

4.1.1

T h e R eflection CoefRcients

Each of the 3 transmission lines will have impedance discontinuities at their ends. These discontinuities will have associated reflection coefficients that may be estimated using the current derivative waveform. For waveforms with non-overlapping peaks the reflection coefficients can be fairly accurately estimated by taking the ratio of the peak magnitude to the initial peak magnitude. It is not necessary to consider intermediate discontinuities between the discontinuity of interest and the top of the tower. In fact, ignoring the skypod reflection will not have an effect on the determination of the other reflection coefficients. When calculating the magnitude of the ground reflection with and without the intermediate reflections from the observation level gave values which differed by less than 1 %. This margin of error is acceptable given that the noise in the measured current derivative waveforms is of the same order of magnitude. As mentioned in 3.2.1 the reflection coefficients in tall structure models are typi cally assumed to be constant and independent of frequency and current parameters. In an analysis of a number of CN Tower current derivative waveforms there is evidence M r"-.-..,..

35 to suggest that this assumption may be incorrect. The magnitude of the reflection coefficients was found to vary substantially for the top and bottom of the observation level and the ground. The reflection coefficient from the tower top was not included in the analysis because it is often difficult to determine. There are 2 likely reasons for this: l)When the current pulse is reflected from ground it tends to be wider than the incident wave and so for a wider initial peak is more likely to overlap with the tower top reflection, and 2) As mentioned in 3.2.1 there may be a relationship between current amplitude and the reflection coefficient at the top of the tower such that the reflection coefficient may decrease for increasing current magnitude. The combination of these 2 factors, especially for a high current derivative which is usually the type preferred for coefficient estimation due the improved signal to noise ratio, make the estimation of the tower top reflection coefficient guesswork at best in most cases. Some previous researchers have tried to establish a relationship between the varia tion of current parameters, mainly the current peak and 10 % - 90 % current risetime, and the variation of reflection coefficients. These 2 parameters together can give an indication of the frequency content of the waveform. A waveform with a higher peak and short risetime should have more significant high frequency content than a wave form with a lower peak and longer risetime. No detailed analysis of the relationship between the reflection coefficients and any current parameters is available in the lit erature. After performing an analysis with old coil waveforms it was not possible to firmly establish a relationship between any of the 3 reflection coefficients and the cur rent peak or risetime parameters. The reflection coefficients were found to vary but not with either of the parameters. The maximum and minimum reflection coefficient values for the ground (pg), observation level top (pi), and observation level bottom (pz) are given in Table 4.1. At this point a possible relationship between the peak and risetime of the current derivative was considered, based on the assumption that these two parameters could provide frequency content information. Taking a ratio of the

36 Reflection CoefF. Pi P2
Pg

Maximum 0.3053 -0.1028 0.5685

Minimum 0.1188 -0.3861 0.2553

Table 4.1: Maximum and minimum reflection coefficients current derivative peak to risetime could provide an even better idea of the frequency content than considering each individually [47]. This ratio, referred to hereafter as the peak to risetime (PR) ratio, was plotted against the estimated reflection coeffi cients and the results are shown in Figures 4.7 to 4.9. It is evident from the figures that there is a trend to convergence at higher values of the PR ratio. This trend is more evident for the observtion level bottom and ground refiection coefficients. The variation between the reflection coefficients from waveforms with a lower PR ratio may be due to the higher signal to noise ratio in those waveforms. In the case of the ground reflection coefficient, it seems to converge to a lower value with increasing PR ratio. There is a slight trend in the reflection coefficient from the observation level top to converge to a higher value for increasing PR ratio. The observation level bottom reflection coefficient appears to converge to a less negative value as the PR ratio increases. These trends would suggest that the reflection coefficients at the CN Tower may vary with frequency. The distance between the Rogowski coil and the various reflections may be cal culated assuming the current wave is traveling at the speed of light. The distance between the coil and the ground reflection has always been assumed to be 474 m but this value has been found to vary. In Figures 4.10 to 4.12 the reflection distance from the coil as a function of the PR ratio is plotted for the top and bottom of the obser vation level and ground reflections. In all three figures it is evident that the distance from the reflection to the coil varies. It is also evident that the distance varies more at lower values of the PR ratio and tends to converge at higher values of the PR ratio. In the case of the observation level reflection distances the variation at lower

37

0.6

0.5

I
Td

C C O
0.2

0.1

0

1 00

200

300

400

500

600

700

800

900

1 000

Peak to R isetim e Ratio [kA/(us'^2)]

Figure 4.7: PR ratio vs. ground reflection coefflcient

0.35

0.3

025
         

0

0.2

1 = 0.15 £ E
0.1

0.05

100

200

300

400

500
PR [kA/(us''2)]

600

700

800

900

1000

Figure 4.8: PR ratio vs. observation level top reflection coefflcient

38
0.0000 100 -0.0500 200 300 400 500 600 700 800 900 1000

-

0.1000

-0.1500
  
$

(g -02000
^ -02500

g
-0.3000

-0.3500

-0.4000

-0.4500
PR IkA/(us`'2)]

Figure 4.9: PR ratio vs. observation level bottom reflection coeflicient values of the PR ratio may be accounted for by the fact that the peaks will be less sharp and there may be some overlap between the two observation level reflections. From the apparent convergence of the values for the distances of the observation level reflections a better estimate of where the reflections occur may be 366 m and 325 m above ground level for the top and bottom respectively. Previously these values were considered to be 360 m and 330 m. The discontinuity at the ground may not be as abrupt as those at the observation level, it may be a more gradual transition between the tower and the grounding impedances. This may account for the widening of the ground reflection peak in Figure 4.4 and it may explain to some extent the variation of the ground reflection distance variation. Overlap between the ground reflection and the tip reflection in the current derivative waveform may also be expected for lower values of the PR ratio, contributing to the variation of ground reflection distances. Figure 4.12 suggests that a better estimate of the ground reflection distance from the Rogowski coil may be

39 478.5 m, rather than 474 m which has been used in the past.

113

1 12 1 1 1
c 110

  
·B 109

108

107

106 0 1 00 200 3 00 4 00 PR 500 600 70 0 800 900 1 000

[kA/{us^2)]

Figure 4.10: Observation level top reflection distance vs. PR ratio The convergence of the ground reflection location for a higher PR ratio is evident, however the PR ratio is not one of the primary parameters of the current deriva tive waveform. It would be desirable to establish, for the sake of future modeling endeavors, the distribution of ground reflection locations as a function of a primary parameter, such as the current derivative. Figure 4.13 shows the cumulative distribu tion for ground reflection locations for several ranges of the current derivative peak. For the highest range of current derivative peak, which would be expected to provide for more accurate determination of waveform characteristics, the ground location is almost always more than 3 m below ground, and the distribution suggests that it is usually near 4.5 m below ground level. This agrees well with the determined ground reflection distance based on the PR ratio values and indicates that the ground location should be taken as 4.5 m below the conventional level.

40

165

160
        4 4»     44         

155

I 150

I

 



  

 



I I

      

Û C
140

135

130 0 1 00 200 300 40 0 500
PR [kA/(us''2)]

600

700

800

900

1 000

Figure 4.11: Observation level bottom reflection distance vs. PR ratio

495

490

e]

I £
CE







485

I

O 480

Ü
475

  »·

    



 

470
100 200 300 400 500
PR [kA/(us'^2)]

800

700

800

900

1 000

Figure 4.12: Ground reflection distance vs. PR ratio

41
100%
90% -- - dKdt < 20 70% -- -- 20<=di/dt<30 - - - 30<=di/dt<40 di/dt >= 40

5
q !

50%

30%

20%

10%
0% 16.5 -15 -13.5 -12 -10.5 -9 -7.5 6 -4.5 3 -1.5

w
0 1.5 3 4.5

Ground L ocation [m AGL]

Figure 4.13: Cumulative distribution of ground reflection locations for different ranges of di/dt

4.2

The MTLL Model Applied to the Lightning Channel

In the past the channel above the CN Tower has been modeled using either the TL or MTLE models [9]. Based on the most recent survey of the engineering models the MTLL model for the channel has been chosen for application here. The value for the effective channel height originally used by the developers of the model was 7.5 km [35]. Since the measured return stroke velocity and the current peak are both significantly lower for lightning striking the CN Tower than that striking ground, the effective channel height may be reduced. Details of the derivation of the effective channel height are not available so a value of 5 km will be selected. Modifying the attenuation factor P{zf) in order to account for the tower so that P{h) = 1 gives z' -- h H

(4.1)

42 Calculation of the electromagnetic fields requires the time derivative and time integral of the current. Since P{z') is not a function of time, the current derivative and current integral for the MTLL model are simply the channel base quantities multiplied by P(z'). Based on what is known about the return stroke velocity it would be difficult to estimate the velocity profile for the channel above the tower in the absence of measurements. The velocity most likely does decrease with height, that has been established elsewhere, but to what degree and based on what other parameters is not known. In the case of the CN Tower the return stroke velocity has been measured for a few events using an advanced photodiode array and was found to be between 0.15c and 0.3c [48]. The 2-dimensional velocity of the return-stroke front has been measured with a simpler photodiode array and was determined to reach a maximum of 144 m / fis, approximately 0.5c [5]. This is in keeping with the studies that have found that the return stroke velocity measured at triggered lightning sites is on average lower than the measured return stroke velocity of natural lightning. Since the current maximum steepness is on average lower in triggered lightning and lightning to tall structures than it is in natural lightning, the return stroke velocity may be associated with the maximum steepness of the return stroke current. Since the choice of a changing velocity over the channel would be arbitrary and given that for measurement locations at ground level involving early-time prediction the tall structure model probably influences the measurement more than the channel model [10], the return stroke velocity will be assumed to be constant. The possibility of current reflection from the return stroke front has been proposed but it has not been either proved or disproved. Based on transmission line theory there would be an impedance discontinuity expected at the return stroke front where the fully ionized channel meets the less conductive partially ionized channel. An estimate

43 of the reflection coefflcient of the return stroke front was made in [9] based on the estimated ratio of leader and return stroke channel impedances. The value obtained was -0.9, meaning that the magnitude of the wave reflected from the return stroke front would be 0.9 times the magnitude of the incident wave and opposite in polarity. If it is assumed that the return stroke current front is not far behind the luminous tip of the return stroke front then it should be possible to estimate the reflection location from optical return stroke velocity measurements. If the return stroke velocity is known and the assumption holds, then it should be possible to observe the reflection from the return stroke front at a tall structure like the CN Tower. It is possible that a reflection from the channel could overlap another measured reflection rendering it indistinguishable. In the case of shorter structures struck by lightning, such as power distribution towers, the reflections from the channel would be seen at ground much sooner than they would in a taller structure and so could contribute significantly to the current peaks measured at the tower [9].

4.3

The Current Waveform

The waveform that was is used as the channel base current is a summation of two Heidler functions [39]. The Heidler function has been used since its conception in 1985 by most researchers to reproduce the return stroke current waveform in return stroke modeling. Two Heidler functions are often added together to represent the subsequent return stroke current. The summation of the Heidler functions used to model the current in the CN Tower are given by -fo.2 1+

.

(4.2)

For each of the Heidler functions Iq is the channel base current amplitude in amperes, Ti and T3 are the front-time constants, Tg and T4 are the decay-time constants, a is

44 the amplitude correction factor, and k is an exponent between 1 and 5 [43]. These parameters can be adjusted to change the current derivative peak, current peak, and charge of the return stroke. In most return stroke modeling the focus is on the current waveform. In modeling the current in the CN Tower it would be prudent, because of the complex nature of the structure, to work with the current derivative as opposed to the current wave form. The measured current derivative is much easier to reproduce with the model because there is less overlapping between adjacent reflections. This is evident in Fig ure 4.4 where there is no overlap between the first and second peaks compared to the associated current waveform wherein the small peak corresponding to the second peak in the current derivative is clearly overlapping the original current waveform. The determination of the contributions of the various reflected currents becomes in creasingly diflficult as time progresses and more reflected current components appear. Although some overlap may be present in a current derivative, particularly for those with a high risetime, it will be much less troublesome to determine the return stroke parameters. The derivative of the Heidler function in (4.2) may be derived as

dijt) _ dt

^ 2or

n{{Tz/tY + l)

T3{{rz/tY+ \Y _

The current derivative waveform in (4.3) is plotted in Figure 4.14 along with its numerical integral, which is identical to (4.2), the current. The parameters used for the current derivative waveform in Figure 4.14 are given in Table 4.2. These pa rameters may be adjusted to better reproduce each measured return stroke current derivative. Once the measured current derivative is relatively well reproduced it may be numerically integrated to obtain the current waveform.

45

30
20

-1 0

Time [us]

Time [us]

Figure 4.14: Current derivative and associated current waveform used as the channel base current /o.l 10 kA fo,2 10 kA n 330 ns T2 500 ns
73 74

330 ns

120 fjs

a 0.6

k 4

Table 4.2: Parameters used in (4.3) to obtain the current derivative waveform in Figure 4.14

The return stroke parameters vary from stroke to stroke so the Heidler function parameters must vary accordingly in the modeling process. It would be ideal to match the measured current and current derivative waveforms with those obtained with the Heidler function. In the case of a return stroke at the CN Tower this matching may only be carried out on the front and peak of the initial current impulse, due to overlapping reflected currents. On the other hand, the initial impulse of the current derivative provides more information about the initial current impulse than may be obtained from the measured waveform. Therefore matching the initial current

46 derivative pulse rather than the initial current pulse should provide more accurate reproduction of the measured waveforms by the model. Matching was performed using the waveform in Figure 4.4. In the first case the initial current impulse was matched by aligning the midpoints of the measured and model currents and then using a least squares algorithm with the current amplitudes, time constants, and the exponent of the Heidler function as optimization parameters. The period to be matched was that between 0.3 fis and 0.6 fxs. After this time there is a reflected current visible in the measured current waveform. The resulting model current waveform is shown in Figure 4.15 along with the associated current derivative. There is significant deviation between the fronts of the measured and model current derivatives. The deviation in the current derivative front will result in error in the calculated field peak, the primary field parameter. The slowly rising portion preceding the main front in the current waveform is visible in most current waveform measurements. This portion is not well reproduced by the Heidler function. 4,1 8.218 kA 4,2 11.387 kA n 72 193.32 ns 0.357 fis 73 241.08 ns 74 22.3 fis a 0.791 k 3.354

Table 4.3: Heidler function parameters used to match the current waveform in Figure 4.15 In the second case the current derivative matching was done by aligning the peaks of the measured and model waveforms and first optimizing the decay portion of the impulse using the least squares algorithm as for the current waveform. Subsequently the decay time constants were kept and the rest of the Heidler parameters were allowed to vary and the least squares was taken over the entire pulse. The resulting matched current derivative and the associated current waveform are shown in Figure 4.16. The Heidler function parameters used to obtain the waveform are given in Table 4.4. There is a relatively good agreement between the risetimes of the measured and calculated current waveforms and the current peak is well reproduced. The

47

Model Measured
(0

I
2 " O
-1 0 0.1 0.2

0.3

0.4 0.5 Time [us]

0.6

0.7

0.8

0.9

--

Model Measured

-2

0.1

0.2

0.3

0.4 0.5 Time [us]

0.6

0.7

0.8

0.9

Figure 4.15: The matched current impulse and the corresponding current derivative discrepancy visible in the current front is due to the slowly rising portion of the current that was also excluded from the matching of the current derivative on account of the Heidler function's inability to reproduce this feature. Since in most cases the radiation term is the dominant field component, the field should be better reproduced using the matched current derivative rather than the matched current. The field derivative is important in lightning protection design [22]. The better matched current derivative front should better reproduce the front of the field. It is this front from which comes the major component of the field derivative. 4.1 8.63 kA 4,2 11.07 kA n 151.51 ns 72 109.78 ns 73 248.99 ns 74 168.68 fis a k 1.22906 4.31

Table 4.4: Heidler function parameters used to match the current derivative waveform in Figure 4.16

48

30
20 5 10
-

Model -- Measured

-1 0

0.1

0.2

0.3

0.4 0.5 Time [us]

0.6

0.7

0.8

0.9

--

Model Measured

-2

0.1

0.2

0.3

0.4 0.5 Time [us]

0.6

0.7

0.8

0.9

Figure 4.16: The matched current derivative impulse and the corresponding current

4.4

Simulation Procedure

The simulation of a return stroke current striking the CN Tower model described above was done in MatLab. The tower was divided into segments 5 m long and the channel base current derivative, current, and current integral were obtained for a time longer than the simulation time. At time t = 0 the channel base current was injected into the top of the tower and the bottom of the channel. The return stroke current was set to propagate with the same velocity as the return stroke front. The simple expressions in (3.7) and (3.8) were applied to the tower geometry. The reflections in the tower were included until the peak value became less than 2 %, and most often less than 1 %, of the initial peak value after which time the wave was terminated. The reflection locations from the return stroke front were determined by the intersection, to within 2.5 m, of each current wave transmitted through the tower top. For each time increment the electric and magnetic field components were calculated for all

49 the current segments in the tower and the channel, taking into consideration the contributions of all reflected and transmitted waves. The reflections considered for most waveforms are shown in the reflection diagram in Figure (4.17). The three horizontal lines represent, from the bottom up, the bottom of the observation level, the top of the observation level, and the top of the tower respectively. The uppermost diagonal line shows the location of the return stroke front at a given time. There are sections in which the reflections overlap but these are not explicitly indicated in the reflection diagram.
1000

900 800 700 600

E

500 400 300
200 100

T im e [u s ]

Figure 4.17: Reflection diagram indicating the reflections involved in the field calcu lations

50

4.5

Simulation Results and Discussion

Before calculating the fields the measured and simulated current derivatives were compared. The optimized Heidler function parameters were used with the reflection coefficients estimated from the measured waveform. The reflection coefficients were estimated from the ratios of the magnitudes of the reflection peaks to the first peak and are given in Table 4.5. The current derivative and current waveforms for both matching cases are shown in Figure 4.19 and Figure 4.18. The matched current derivative clearly provides a better match of the overall waveform. The discrepancy in the current absolute peak can be attributed to the slower front of the ground reflection in the measured current derivative waveform. It is interesting to note that the decay of the calculated current in Figure 4.18 is substantially greater than the measured decay, even though it was the current waveform that was matched in this case. P2 Pi 0.1967 -0.2025 Pt Pg 0.4815 -0.28

Table 4.5: Reflection coefficients estimated from the measured current derivative waveform As mentioned earlier it has been proposed that reflections may occur from the re turn stroke front. If they do occur then they should be visible in the measured current derivative waveform. It is reasonable to assume that the characteristic impedance of the channel below the return stroke front is lower than that channel above the front meaning that the return stroke front reflection coefficient should be negative. Thus the ground reflection from the return stroke front should be visible in the measured current derivative waveform as a negative peak, the location of which would be deter mined by the return stroke velocity. If such a peak could be found it may be possible to determine the mean return stroke velocity from the current derivative waveform. There is a negative peak in the measured current derivative waveform near 6 /xs that

51
40 30 20
§10

Model Measured

-a

Time [us] 15 Model Measured
10

s
5

0

0

1

2

3

4 Time [us]

5

6

7

8

Figure 4.18: Measured and calculated current derivative and current waveforms for the matched current may be due to a reflection from the return stroke front. An example of a model cur rent derivative including reflections from the return stroke front using the matched current derivative is shown in Figure 4.20. The return stroke velocity in this case is 0.2c, a reasonable value given optical measurements, and the reflection coeflicient of the return stroke front is -0.05. The model current derivative more closely resembles the measured current derivative when the reflections from the return stroke front are included. There are 2 minor peaks due to the reflections from the return stroke front of the peaks labeled as the second and third peaks in Figure 4.4. These are located between the third and fourth peaks and if, as suggested in [9], the return stroke front reflection coefficient were -0.9 there would definitely be a significant channel reflection visible between the third and fourth peaks for a reasonable return stroke velocity, at least for the return stroke velocities used in that study.

52
40 30 Model Measured

a 20

-1 0

Time [us] 15 Model Measured 10

5

0

0

1

2

3

4 Time [us]

5

6

7

8

Figure 4.19: Measured and calculated current derivative and current waveforms for the matched current derivative The azimuthal magnetic field was calculated for both of the matching cases. Both the current in the tower and in the channel will contribute to the magnetic field. The tower contribution along with the total magnetic field for the first and second matching cases are shown in Figure 4.21 and Figure 4.22 respectively. In these cases it is assumed that the return stroke velocity is 0.15c and that there are no reflections from the return stroke front. The channel contribution to the total field is much less than the tower contribution as expected. This observation has also been made in [28] and [13] where the return stroke velocities used were c and 0.63c respectively, values that are much higher than those obtained from optical measurements [48]. Varying the effective channel height does not have much of an effect on the resultant magnetic field. Changing the effective channel height to 2.5 km and 1 km does not affect the peak, only the tail of the field, as expected. The effect should be more noticeable

53

Model Measured

a 20
:? 10

%

-10 Time [us]

15
Model Measured 10

5

0

0

1

2

3

Time [us]

4

5

6

7

8

Figure 4.20: Measured and calculated current derivative and current waveforms for the matched current derivative with included reflections from the return stroke front for a higher return stroke velocity since in the first 10 fis of the field waveform the return stroke front will have traveled only 450 m for a return stroke velocity of 0.15c. The effect of increasing the return stroke velocity on the calculated magnetic field is shown in Figure 4.23. The two most noticeable effects are the widening of the third major peak and the increased magnitude of the entire waveform. It would be useful to compare the model magnetic field to the measured field. The total model magnetic field is plotted with the measured field associated with the lightning event in Figure 4.4 for both cases in Figure 4.24 and Figure 4.25. In the measured waveform there is a peak approximately 4.5 fis after the initial peak. This peak is visible in both Figure 4.21 and Figure 4.22. For a higher return stroke velocity, as shown in Figure 4.23, the peak would be wider and hence better reproduced. This

54
Tower and channel Tower only_______

0.9 0.8 0.7 0.6 0.5

--

0.3

0.1

- 0.1

-2

Time [us]

Figure 4.21: Tower contribution and total magnetic field for the matched current feature is noticeable in many other field waveforms and has not been reproduced in previous works. The magnitude of the model field is a factor of 3 smaller than the measured field for the return stroke velocity of 0.15c. Previous works [13],[28] have also found the calculated field magnitudes to be less than those measured. The difference factor in the previous works was lower but they were also using a higher return stroke velocity. The magnitude discrepancy may be in part due to the channel inclination, which can have a significant effect on the field [49]. If the channel is not vertical as assumed in the model then the magnetic field sensor would be measuring not only the azimuthal field but also the radial magnetic field. The sensor calibration and the fact that it is located on the top of a building may also contribute to the magnitude error. The relative decrease of the magnetic field approximately 3 fjs after the initial peak is greater and approaches zero in the measured field. This may be due to a changing return stroke velocity. The magnetic field may be obtained for the case in which the reflections from the return stroke front are considered. The field corresponding to the current derivative in Figure 4.20 is shown in Figure 4.26 along with the magnetic field due to the tower and channel with the same return stroke velocity. It is evident that the contribution

55

0.9 0.8 0.7 0.6

Tower and channel Tower only_______

0.3

0.1

-2

1

0

1

2

3

4

5

6

7

8

Figure 4.22: Tower contribution and total magnetic field for the matched current derivative of the reflections from the return stroke front to the magnetic field is not significant for the reflection coefficient and return stroke velocity specified. These parameters may vary according to some relationship between the return stroke current magnitude and the reflection coefficient, which is a reasonable assumption based on the increased charge present in the return stroke channel.

56

-Vv
0.8

- - 0.15c 0.3c

0.6

à

0.4

Time [us]

Figure 4.23: Total magnetic field for the matched current derivative waveform for 2 return stroke velocities

0.9 0.8 0.7 0.6 0.5

--

Tower and channel Tower only_______

0.3

0.1

-

0.1 -2

Time [us]

Figure 4.24: Measured and calculated magnetic field for the matched current

57

Model M easured 2.5

1.5

0.5

Time [us]

Figure 4.25: Measured and calculated magnetic field for the matched current deriva tive

-- 0.8

Not including front reflections Including front reflections

0.6

0.2

-2

Time [us]

Figure 4.26: Calculated magnetic field for the matched current derivative with and without return stroke front reflections

Chapter 5 C onclusions and Future R esearch
5.1 Conclusions

The MTL model applied to the CN Tower combined with the MTLL model of the lightning return stroke channel extended to include the reflections from the return stroke front represents the most thorough model developed to date of the lightning return stroke current at the CN Tower. The major structural discontinuities within the tower are included in the model and have been found to provide more accurate reproduction of the measured waveforms than simpler models exlcuding the disconti nuities. Validation was performed using a measured current derivative and a magnetic field for the same lightning event. The measured current derivative and current wave forms were very well reproduced and a reasonable agreement was found between the waveshapes of measured and calculated magnetic field waveforms. The use of the MTL model for the tall structure including the structural discontinuities along with the use of the MTLL model for the return stroke channel should also be used in the modeling of the return stroke current at other tall structures. Discrepancies between the measured and calculated current derivative waveforms may be due to the difference between the intial measured and calculated peak. The 58

59 algorithm used to match the model to the measurement has a tendency to find the local minimum so a good match is highly dependent on the initial guess of the Heidler parameters. This tendency is common to most simple optimization algorithms. The existence of minor structural discontinuities not considered in the model may also contribute to error. There are various small peaks in the measured waveform that are visible in other waveforms which suggests that they are not due to noise. The skypod, located at 447 m, may result in reflection of the initial current peak. In most cases a reflection is not evident in the measured return stroke current, either becuase the initial peak is so wide that it overlaps the reflection, or the reflection is not large enough compared to the initial peak to be detectable. The use of the Heidler function derivative to model the return stroke process re sults in a more accurate reproduction of the measured current derivative than that obtained using the Heidler function. Typically in return stroke modeling the empha sis is placed on the current. In the case of lightning to an elevated structure, the reproduction of the current waveform can be made difficult by reflections from the structure extremities and internal discontinuities. The focus in such cases should be shifted to the current derivative, the matching of which is more easily done and which accurately reproduces the current waveform of a complex structure such as the CN Tower. The radiation field, which is the dominant field component at most distances from the lightning channel, is dependent on the current derivative. The derivative of the radiation field, which by extension is also dependent on the current derivative, is an important quantity in the development of lightning protection. The possibility of reflections from the return stroke front was examined. The re sults obtained using reasonable values for the return stroke velocity and front reflec tion coefficient indicate that previous assumptions regarding the reflection coefficient based on estimated return stroke and leader channel characteristic impedances are

60 unreasonable. This suggests that the characteristic impedances of the return stroke and leader channel may be quite different from previous estimates made according to TL theory. This may indicate either an inadequacy of the TL theory applied to the return stroke channel, or incorrect conclusions about the physics of the return stroke process, particularly at the return stroke front. It may even be possible that a cur rent reflection arriving at the return stroke front may be absorbed by the front. This possibility depends on the charge distribution along the leader channel, a quantity that is not presently known, only inferred. The features of the magnetic field are reproduced better than in previous works, particularly the peak occurring approximately 4.5 yits after the initial peak. This is probably due in part to the use of a reasonable return stroke velocity. Error may be due to the presence of a metallic capping that covers the top of the perimiter of the building on which the sensor is located. This metallic structure may enhance electric and magnetic field peaks. Sensor calibration may be another cause of error, consid ering that a at the sensor had not been calibrated for 6 years when the measurement was taken. Discrepancies may also be due to the current derivative measurement error, since it is the measurement of the current derivative upon which the model current derivative is based.

5.2

Future Research

The assumption made by most researchers that the ground reflection coefficient is constant and independent of frequency requires some revision. Based on the observed relationship between the reflection coefficient and the PR ratio it might be useful to perform a frequency analysis of the initial current derivative peak and observe the associated ground reflection shape and reflection coefficient. The half width of the peak of the ground reflection should be analysed for as many waveforms as possible.

61 The width of the ground reflection peak is noticeable and may give insight into the relationship between the current parameters and the grounding impedance of the structure. The tendency of simple optimization algorithms to find the local minimum makes a good initial guess of the Heidler function parameters essential. Making such a guess can be very time consuming so a more sophisticated means of finding the global mimimum should be sought. The use of a genetic algorithm or some other such optimization algorithm should be used to obtain a better match between the measured and calculated current derivative waveforms. Recently the genetic algortihm was used to extract lightning current parameters from measurements of return stroke currents at a tall structure and the results were promising and it was proposed that the application could be extended to more complex cases. A more accurate reproduction of the initial current derivative peak could thus be obtained, and the calculated field could be made to better resemble the measured. The simultaneous measurements of return stroke current and return stroke velocity would provide for even better model validation. The availability of the 3 dimensional return stroke velocity would make it possible to precisely determine the effect of channel inclination on the resultant fields. A model taking into consideration channel inclination would me more complex but should definitely be able to better reproduce measured field waveforms since the radial field component can be significant for an inclined channel. Simultaneous measurements of the radial and azimuthal magnetic fields exist for lightning striking the CN Tower and in some cases the radial field magnitude has been found to be greater than the azimuthal field magnitude. In order to perform a thorough validation of a return stroke model simultaneously measured fields at several distances from the channel are required. Such records are not presently available for lightning striking the CN Tower. Field measurements are

62 made by the Lightning Location and Protection (LLP) system and are stored along with the GPS time of the events. The incorporation of GPS time into the measure ment of the return stroke current derivative at the CN Tower would make it possible to match the field waveforms measured by the LLP system to lightning striking the CN Tower. This would provide the necessary field data for model validation and would also be useful in the determination of the lightning current parameters from field measurements made by the LLP system. It would also facilitate the validation of the current parameter estimation of the LLP system.

Bibliography
[1] F. Fuchs, E.U. Landers, R. Schmid, and J. Wiesinger, "Lightning current and magnetic field parameters caused by lightning strikes to tall structures relating to interference of electronic systems", IEEE Trans. Electromagn. Compat., vol. 40, pp. 444-451, 1998. [2] Y. Baba, S. Miyazaki, and M. Ishii, "Reproduction of lightning electromagnetic field waveforms by engineering model of return stroke", IEEE Trans. Electro magn. Compat., vol. 46, pp. 130-133, 2004. [3] C. Gomes and V. Cooray, "Concepts of lightning return stroke models", IEEE Trans. Electromagn. Compat, vol. 46, pp. 82-96, 2000. [4] A.M. Hussein, W. Janischewskyj, M. Milewski, V. Shostak, W. Chisholm, and Chang J.-S, "Current waveform parameters of CN Tower lightning return strokes", J. Electrostatics, vol. 60, pp. 149-162, 2004. [5] A.M. Hussein, W. Janischewskyj, J.-S. Chang, V. Shostak, W.A. Chisholm, P. Dzurevych, and Z.-I. Kawasaki, "Simultaneous measurement of lightning parameters for strokes to the Toronto Canadian National Tower", J. Geophys. Res., vol. 100, pp. 8,853-8,861, 1995. [6] A.M. Hussein, "A review of the CN Tower lightning observations", in Proceedings of the International Workshop on Electromagnetic Radiation from Lightning to Tall Structures, Toronto, Ontario, Aug. 20-22, 2001. [7] John. J. Lowke, "On the physics of lightning", IEEE Trans, on Plasma Science, vol. 32, pp. 4-17, 2004. [8] V.A. Rakov and M.A. Uman, Lightning: Physics and Effects, Cambridge Uni versity Press, 2003. [9] V. Shostak, W. Janischewskyj, and A.M. Hussein, "Expanding the modified transmission line model to account for reflections within the continuously growing lightning return stroke channel", in Proceedings of the IEEE Power Engineering Society Summer Meeting, 2000, vol. 4, pp. 2,589-2,602. [10] S. Cuerrieri, C.A. Nucci, F. Rachidi, and M. Rubinstein, "On the influence of elevated strike objects on directly measured and indirectly estimated lightning currents", IEEE Trans. Power Delivery, vol. 13, pp. 1,543-1,551, 1998. 63

64 [11] Vernon Cooray and R.E. Orville, "The effects of variation of current amplitude, current risetime, and return stroke velocity along the return stroke channel on the electromagnetic fields generated by return strokes", J. Geophys. Res., vol. 95, pp. 18,617-18,630, 1990. [12] W. Janischewskyj, A.M. Hussein, V. Shostak, I. Rusan, J.-X. Li, and J.-S. Chang, "Statistics of lightning strikes to the Toronto Canadian National Tower (19781995)", IEEE Trans. Power Delivery, vol. 12, pp. 1,210-1,219, 1997. [13] F. Rachidi, W. Janischewskyj, A.M. Hussein, C.A. Nucci, S. Cuerrieri, B. Kordi, and J.-S. Chang, "Current and electromagnetic field associated with lightning return strokes to tall towers", IEEE Trans. Electromagn. Compat, vol. 43, pp. 356-365, 2001. [14] J.A. Gutierrez R., R Moreno, J.L. Naredo, J.L. Bermudez, M. Paolone, C.A. Nucci, and F. Rachidi, "Nonuniform transmission tower model for lightning transient studies", IEEE Trans. Power Delivery, vol. 19, pp. 490-496, 2004. [15] V. Cooray, "A model for subsequent return strokes", J. Electrostatics, vol. 30, pp. 343-354, 1993. [16] Y. Baba and M. Ishii, "Characteristics of electromagnetic return-stroke models", IEEE Trans. Electromagn. Compat, vol. 45, pp. 129-135, 2003. [17] G. Diendorfer, W. Schultz, and V.A. Rakov, "Lightning characteristics based on data from the Austrian lightning locating system", IEEE Trans. Electromagn. Compat., vol. 40, pp. 452-464, 1998. [18] D. Jordan and M.A. Uman, "Variation of light intensity with height and time from subsequent return strokes", J. Geophys. Res., vol. 88, pp. 6,555-6,562, 1983. [19] V. Cooray, "A return stroke model", in International Conference on Lightning and Static Electricity, University of Bath, England, September 1989, paper 6B.4, 6pp. [20] Martin A. Uman, "Lightning return stroke electric and magnetic fields", J. Geophys. Res., vol. 90, pp. 6,121-6,130, 1985. [21] C. Leteinturier and J.H. Hamelin A. Eybert-Berard, "Submicrosecond character istics of lightning return stroke currents", IEEE Trans. Electromagn. Compat, vol. 33, pp. 351-357, 1991. [22] C. Leteinturier, C. Weidman, and J. Hamelin, "Current and electric field deriva tives in triggered lightning return strokes", J. Geophys. Res., vol. 95, pp. 811-828, 1990. [23] C.E.R. Bruce and R.H. Golde, "The lightning discharge", J. lEE, London, vol. 88(pt.2), pp. 487-524, 1941.

65 [24] V.P. Idone, R.E. Orville, P. Hubert, L. Barret, and A. Eybert-Berard, "Corre lated observations on three triggered lightning flashes", J. Geophys. Res., vol. 89, pp. 1,385-1,394, 1984. [25] D.M. Mach and W.D. Rust, "Photoelectric return stroke velocity and peak current estimates in natural and triggered lightning", J. Geophys. Res., vol. 94, pp. 13,237-13,247, 1989. [26] Vernon Cooray, "Predicting the spatial and temporal variation of the electro magnetic fields, currents, and speeds of subsequent return strokes", IEEE Trans. Electromagn. Gompat, vol. 40, pp. 427-435, 1998. [27] J.C. Willett, J.C. Bailey, V.P. Idone, A. Eybert-Berard, and L. Barret, "Sub microsecond intercomparison of submicrosecond fields and currents in triggered lightning return strokes based on the transmission-line model", J. Geophys. Res., vol. 94, pp. 13,275-13,286, 1989. [28] B. Kordi, R. Moini, W. Janischewshyj, A.M. Hussein, V.O. Shostak, and V.A. Rakov, "Application of the antenna theory model to a tall tower struck by lightning", J. Geophys. Res., vol. 108, pp. ACL 7-1 to ACL 7-9, 2003. [29] V.A. Rakov, "On the distribution of lightning current along a tall strike object", in International Workshop on EM Radiation from Lightning to Tall Structures, Bologna, Italy, 2003, pp. 10-13. [30] M. Rubinstein and M.A. Uman, "Methods for calculating the electromagnetic fields from a known source distribution: Application to lightning", IEEE Trans. Electromagn. Gompat, vol. 31, pp. 183-189, 1989. [31] R. Thottappillil and V.A. Rakov, "On the computation of electric fields from a lightning discharge in time domain", in IEEE Symposium on Electromagnetic Compatibility, 2001, vol. 2, pp. 1,030-1,035. [32] V.A. Rakov and M.A. Uman, "Review and evaluation of lightning return stroke models including some aspects of their application", IEEE Trans. Electromagn. Gompat, vol. 40, pp. 403-426, 1998. [33] V. Cooray, "On the concepts used in return stroke models applied in engineering practice", IEEE Trans. Electromagn. Gompat, vol. 45, pp. 101-108, 2003. [34] Y.T. Lin, M.A. Uman, and R.B. Standler, "Lightning return stroke models", J. Geophys. Res., vol. 85, pp. 1,571-1,583, 1980. [35] V.A. Rakov and A.A. Dulzon, "A modified transmission line model for lightning return stroke field calculations", in Proceedings of the 9 th International Sympo sium on Electromagnetic Compatibility, Zurich, Switzerland, 1991, pp. 229-235.

66 [36] C.A. Nucci, C. Mazzetti, F. Rachidi, and M. lanoz, "On lightning return stroke models for LEMP calculations", in 9th International Conference on Lightning Protection, Graz, Austria, April 1988. [37] R. Thottappillil, V.A. Rakov, and M.A. Uman, "Distribution of charge along the lightning channel: Relation to remote electric and magnetic fields and to return-stroke models", J. Geophys. Res., vol. 102, pp. 6,987-7,006, 1997. [38] E.M. Thomson, "Exact expressions for electric and magnetic fields from a prop agating lightning channel with arbitrary orientation", J. Geophys. Res., vol. 104, pp. 22,293-22,300, 1999. [39] H. Heidler, "Traveling current source model for LEMP calculation", in 6th Int. Symp. on Electromagnetic Compatibility, Zurich, Switzerland, 1985, pp. 157-162. [40] J. Schoene, M.A. Uman, V.A. Rakov, K.J. Rambo, J. Jerauld, and G.H. Schnetzer, "Test of the transmission line model and the travelling current source model with triggered lightning return strokes at very close range", J. Geophys. Res., vol. 108, pp. ACL 10-1 to ACL 10-14, 2003. [41] R. Thottappillil and M.A. Uman, "Comparison of lightning return stroke mod els", J. Geophys. Res., vol. 98, pp. 22,903-22,914, 1993. [42] K. Michishita, M. Ishii, A. Asakawa, S. Yokoyama, and K. Kami, "Voltage induced on a test distribution line by negative winter lightning strokes to a tall structure", IEEE Trans. Electromagn. Gompat., vol. 45, pp. 135-140, 2003. [43] J.L. Bermudez, C.A. Pena-Reyes, F. Rachidi, and F. Heidler, "Use of genetic algorithms to extract primary lightning current parameters", in 5th International Symposium on EMC, Sorrento, Italy, 2002, pp. 241-246. [44] F. Fuchs, "On the transient behaviour of the telecommunication tower at the mountain Hoher Peissenberg" , in 24th International Conference on Lightning Protection, Birmingham, U.K., 1998, pp. 36-40. [45] J.L. Bermudez, F. Rachidi, W.A. Chisholm, M. Rubinstein, W. Janischewskyj, A.M. Hussein, V. Shostak, and J.S. Chang, "On the use of transmission line theory to represent a nonuniform vertically-extended object struck by lightning", in IEEE Symposium on Electromagnetic Compatibility, 2003, vol. 2, pp. 501-504. [46] R. Moini, B. Kordi, and M. Abedi, "Evaluation of LEMP effects on complex wire structures located above a perfectly conducting ground using electric field integral equations in time domain", IEEE Trans. Electromagn. Gompat, vol. 40, pp. 154-162, 1998. [47] K. Bitner and A.M. Hussein, "Modeling of the current for lightning striking the CN Tower", in International Conference for Upcoming Engineers (IGUE), 2004.

67 [48] D. Wang, Z.-I. Kawasaki, K. Yamamoto, K. Matsura, J.-S. Chang, and W. Janis chewskyj, "Luminous propagation of lightning attachment to the CN Tower", J. Geophys. Res., vol. 100, pp. 11,661-11,667, 1995. [49] V. Shostak, W. Janischewskyj, J.L. Bermudez, F. Rachidi, and A.M. Hussein, "Influence of channel inclination upon lightning electromagnetic field at two dis tances from a struck tall structure", in International Workshop on EM Radiation from Lightning to Tall Structures, 2003, pp. 18-20.

A ppendix A M ain M odeling Program s
%%%%%%%%%%%% crntd. m %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% % Kristofer Bitner 2004 %%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

This program plots the current, current derivative, and current integral waveforms for a heidler pulse. It also plots the associated electric and magnetic field components. The current consists of negative charge propagating downward from 553m above ground. The image current is 7o taken into consideration in the calculation of the fields % for changing the sampling rate use decimate. .R=original/new sampling rate % %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% % This program requires all of the following programs: heidler_d,initial_l, % initial_2,co_test,dir_set,emf,emfplot,emfrs,initial_rs, and get_set.
7.

% % % %

clear; datestr(now) segments=113; % segments to traverse the tower, 553/seg_size, 111 seg_size=5; % in meters gnd_shift=5; % number of meters to lower the actual grounding location by 7o t_inc: time to travel across a distance increment in seconds t_inc=16.67*(10''-9); pls_d=6000; % pulse duration (number of time increments) sim_d=1000; % simulation duration (number of time increments) %%%%%%%%%%%%%%%%%%% switches %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% inc_chan=l; % set to 1 to include channel reflections in the sim inc_ref=0; % include reflections from the channel do_fields=l; % set to 1 to calculate fields bounce_diagram=0; % set to 1 to generate bounce diagram animation field_comp=0; % set to 1 to calculate individual field components %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% sim_time=sim_d*t_inc*(10"6); rs_v_mul=0.2; % speed of RS front as a percentage of c rs_v=3*(10''8)*rs_v_mul; %return stroke speed in the channel 7o time (s) for the return stroke to traverse one segment rs_t_inc rs_t_inc = seg_size/rs_v;

68

69
chan_seg_size=t_inc*rs_v; % distance travelled by the RS in a t__inc rsr=zeros(l,10); % return stroke reflection locations above ground rrs= 0; 7,-0.053; % RS reflection coefficient r0u=-0.28; % reflection from the tip of the tower -.3276 fn='F1085443.446'; % choose the waveform to simulate F1085443.446 get_set; % get the 3 reflection coefficients for the above waveform % rld=rld+0.05 ; % adjusting for the changed heidler % rld=0.1631; % reflection coefficient of the top of the restaurant % r2d=-0.2575; % reflection coefficient of the restaurant bottom % r3d=0.2930; % reflection coefficient of ground rOd=-rOu; rlu=-rld; r2u=-r2d; % upward reflection coefficients % downward and upward transmission coefficients of the top of the % tower, top of the restaurant, and bottom of the restaurant respectively xOd=l-rOd; xld=l-rld; x2d=l-r2d; xOu=l-rOu; xlu=l-rlu; x2u=l-r2u; hO=segments; % index of the top of the tower hl=round((365+gnd_shift)/seg_size); % index of top of restaurant 360 h2=round((325+gnd_shift)/seg_size); % index of bottom of restaurant 330 %%% distances from the tip of the tower to the top of the restaurant, %%% bottom of the restaurant and ground respectively, and the distance %%% across the restaurant dl=hO-hl; d2=hO-h2; d3=hO; dr=hl-h2; coiloc=round((474+gnd_shift)/seg_size); % coil location 474 old, 509 new iint=zeros(pls_d,1); hdld=zeros(pls_d,1); I_coil=zeros(pls_d,1); dI_coil=zeros(pls_d,1); Iint_coil=zeros(pls_d,1); El=zeros(pls_d,1): E2=zeros(pls_d,1) E3=zeros(pls_d,1) : Hrad=zeros(pls_d,1); Hind=zeros(pls_d,1); Ez=zeros(pls_d,1); Hphi=zeros(pls_d,1); time_axis=zeros(pls_d,1); %%%%%%%%%%%%% for time axis labelling %%%%%%%%%%%% for x=l:pls_d time_axis (x) =x*t__inc* (lO'^O) ; end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
norg=l; % this part of the program will determine the current at a given segment % and time %%%%%%%%% store the heidler pulse in a matrix %%%%%%%% for i=l:pls_d

70
t=t_inc*i; heidler_d; hdld(i)=hdlrd; % *1.1166; end %%%%%%%%%%store the current in a matrix%%%%%%%%%%%%%%%%%%%%% % this operation will give the current hdli=cumtrapz(hdld)*t_inc; %%%%%%%%%% find the integral of the heidler current %%%%%%%%%%%%% hdliint=cumtrapz(hdli)*t_inc; %(2:pls_d) %%%%%%%% shift the pulse down along the channel by pushing it into the %%%%%%%% matrix 'current' % 'i' represents a time increment. % for a time "i" each point along the channel, denoted by "j", has its % contribution to the field calculated and these are all summed for that 7o value of "i" %%%%%%%%%%% find the points where the reflections from the RS front occur % store the location of the first reflection from the RS front for i=l:sim_d % find the location of the return stroke front rs_loc=i*t_inc*rs_v+hO*(seg_size); if abs(rs_loc-(hO+i-2*dl)*seg_size) < 2.5 rsr(1)=hO+i-2*dl; end if abs(rs_loc-(hO+i-2*d2)*seg_size) <2.5 rsr(2)=hO+i-2*d2; end % store the location of the third reflection from the RS front if abs(rs_loc-(hO+i-2*hO)*seg_size) <2.5 rsr(3)=h0+i-2*h0; end % innermost brackets ~ i_test if abs(rs_loc-(hO+i-(2*dl+2*hO))*seg_size) <2.5 rsr(4)=h0+i-(2*dl+2*h0); end if abs(rs_loc-(h0+i-(2*d2+2*h0))*seg_size) <2.5 rsr(5)=h0+i-(2*d2+2*h0); end if abs(rs_loc-(hO+i-(2*h24-2*hO))*seg_size) <2.5

% multiply to scale for selected waveform

71
rsr(6)=h0+i-(2*h2+2*h0); end if abs(rs.loc-(h0+i-(2*hl+2*h0))*seg_size) <2.5 rsr(7)=h0+i-(2*hl+2*h0); end end for k=l:length(rsr) if rsr(k)==0 rsr(k)=iOOOO; end end if bonnce_diagram==l demol=avifile('demol\'COMPRESSION', 'Cinepak', 'QUALITY',100); tt=[hO hO]*seg_size; % tower tip line ot=[hi hl]*seg_size; % obs. level top line ob=[h2 h2]*seg_size; % obs. level bot.line lp=[0 sim_d]; % line points plot(Ip,tt,'r',lp,ot,'r',lp,ob,'r') axis([0 time_axis(sim_d) 0 1050]) hold on end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

for i=l:sim_d %l:sim_d if i==norg*500 % lets me know how simulation is progressing i norg=norg+l; end %%%%%% start of the channel section %%%%%%%%% %%%%%%% this includes the RS in the channel %%%%%%%%% if inc_chan==l % find the location of the return stroke front rs_loc=round((i*t_inc*rs_v)/seg_size+hO); % find the fields due to RS channel last_seg=hO+l+i; coeff=1; initial_rs; end %%%%%%%%%% for reflections within the channel if inc_ref==l seg_num=0; i_tst=2*dl; coeff=rld*xOu; seg_label='CA'; if i > i.tst & i <= i_tst+rsr(1)-hO last_seg=hO+i-i_tst; initial_2; elseif i > i_tst+rsr(1)-hO last_seg=rsr(l); initial_2;
end % c o n te st;

72
i_tst=2*dl+rsr(l)-h0; coeff=rld*xOu*rrs; seg_label='CB^; if i > i_tst & i <= i_tst+rsr(1)-hO first_seg=rsr(1)-1; last_seg=rsr(l)-i+i_tst; start_h=rsr(l)+i_tst-l; initial_l; elseif i > i_tst+rsr(l)-hO first_seg=rsr(l)-l; last_seg=hO; start_h=rsr(1)+i_tst-1; initial_l; end co.test; i_tst=2*d2; coeff=xld*r2d*xlu*x0u; seg_label=^CC^; if i > i.tst & i <= i_tst+rsr(2)-hO last_seg=hO+i-i_tst; initial_2; elseif i > i_tst+rsr(2)-hO last_seg=rsr(2); initial_2; end 7o contest; i_tst=2*d2+rsr(2)-hO; coeff=xld*r2d*xlu*x0u*rrs; seg_label='CD^ if i > i_tst & i <= i_tst+rsr(2)-hO first_seg=rsr(2)-1; last_seg=rsr(2)-i+i_tst; start_h=rsr(2)+i_tst-l; initial_l; elseif i > i_tst+rsr(2)-hO first_seg=rsr(2)-1; last_seg=hO; start_h=rsr(2)+i_tst-l; initial_l; end contest; i_tst=2*h0; coeff=xld*x2d*r3d*x2u*xlu*x0u; seg_label=^T5'; if i > i_tst & i <= i_tst + rsr(3)-hO last_seg=hO+i-i_tst; initial_2; elseif i > i_tst + rsr(3)-hO last_seg=rsr(3); initial_2; end contest; i_tst=2*hO+rsr(3)-hO; coeff=xld*x2d*r3d*x2u*xlu*x0u*rrs; seg_label=^T6'; if i > i_tst & i <= i_tst+2*(rsr(3)-hO) first_seg=rsr(3)-1; last_seg=rsr(3)-i+i_tst; start_h=rsr(3)+i_tst-l; initial_l; elseif i > i_tst+2*(rsr(3)-hO) first_seg=rsr(3)-1; last_seg=hO; Start_h=rsr(3)+i_tst-l; initial_l; end contest;

73
i_tst=2*dl+2*h0; coeff=rld*r0u*xld*x2d*r3d*x2u*xlu*x0u; seg_label='*2H'; if i > i_tst & i <= i_tst + rsr(4)-h0 last_seg=hO+i-i_tst; initial_2; elseif i > i_tst + rsr(4)-h0 last_seg=rsr(4); initial_2; end contest; i_tst=2*d2+2*hO; coeff=xld*r2d*xlu*r0u*xld*x2d*r3d*x2u*xlu*x0u; seg_label='*3I'; if i > i_tst & i <= i_tst + rsr(5)-h0 last_seg=hO+i-i_tst; initial_2; elseif i > i_tst + rsr(5)-h0 last_seg=rsr(5); initial_2; end contest; i_tst=h0+2*h2+h0; coeff=xld*x2d*r3d*r2u*r3d*x2u*xlu*x0u; seg_label='*14E'; if i > i.tst & i <= i_tst + rsr(6)-hO last_seg=hO+i-i_tst; initial_2; elseif i > i_tst + rsr(6)-hO last_seg=rsr(6); initial_2; end contest; i_tst=hO+2*hl+hO; Coeff=xld*x2d*r3d*x2u*rlu*x2d*r3d*x2u*xlu*x0u; seg_label='*16F'; if i > i.tst & i <= i_tst + rsr(7)-h0 last_seg=hO+i-i_tst; initial_2; elseif i > i_tst + rsr(7)-h0 last_seg=rsr(7); initial_2; end contest; end %%%%%%%%% end of channel section %%%%%%%%%%% %%%%%%%%%%% first TL section, between the tip of the tower and the % top of the restaurant %%%%%%%%%% seg_num=10; i_tst=dl+l; coeff=l; seg_label='lA'; if i <= i_tst; first_seg=hO; last_seg=hO-i+l; start_h=hO; initial_l; elseif i > i_tst-l first_seg=hO; last_seg=hl; start_h=hO; initial_l; end %co_test;

74
seg_num=l; i_tst=dl+l; coeff=rld; seg_label='2A'; wdir=2; dir.set; % co_test; % i_tst is the distance travelled by the impulse to arrive at the % beginning of the reflection/section under consideration i_tst=d2+dr; coeff=xld*r2d*xlu; seg_label=^3B'; wdir=2; dir.set; % contest; % most likely not required i_tst=d2+3*dr; coeff=xld*r2d*rlu*r2d*xlu; seg_label=VB'; wdir=2; dir_set; contest; i_tst=2*dl+l; coeff=rld*rOu; seg_label='2B'; wdir=l; dir_set; % contest; i_tst=2*d2; coeff=xld*r2d*xlu*r0u; seg_label='3C^; wdir=l; dir_set; %co_test; i_tst=2*d2+dl; coeff=xld*r2d*xlu*rOu*rId; seg_label=^llA^; wdir=2; dir_set; contest; i_tst=3*d2+dr; coeff=xld*r2d*xlu*r0u*xld*r2d*xlu; seg_label= ^12B' ; wdir=2; dir_set; contest; i_tst=3*dl; coeff=(rld)''2*r0u; seg_label=^6A^ ; wdir=2; dir_set; % contest; if inc_ref==l i_tst=2*dl+2*(rsr(l)-h0); coeff=rld*xOu*rrs*xOd; seg_label='5A'; wdir=l; dir_set; %co_test; end if inc_ref==l i_tst=2*dl+2*(rsr(l)-hO)+dl; coeff=rId*x0u*rrs*x0d*rId; seg_label='lOA'; wdir=2; dir_set; contest ; end i_tst=2*dl+d2+dr; coeff=rld*r0u*xld*r2d*xlu; seg_label='9B'; wdir=2; dir_set; co_test; if inc_ref==l i_tst=2*d2+2*(rsr(2)-hO); coeff=xld*r2d*xlu*x0u*rrs*x0d; seg_label=^8A^; wdir=l; dir_set; % contest; end

75
if inc_ref==l i_tst=2*d2+2*(rsr(2)-hO)+dl; coeff=xld*r2d*xlu*x0u*rrs*x0d*rId; seg_label= ^15A'; wdir=2; dir_set; contest ; end i_tst=2*h0-dl; coeff=xld*x2d*r3d*x2u*xlu; seg_label='lF'; wdir=2; dir.set; % contest; i_tst=2*hO; coeff=xld*x2d*r3d*x2u*xlu*r0u; seg_label=*IG'; wdir=l; dir_set; % co_test; i_tst=2+hO+dl; coeff=xld*x2d*r3d*x2u*xlu*r0u*rld; seg_label='34A^; wdir=2; dir.set; % contest; i_tst=2*hO+2*dl; coeff=xld*x2d*r3d*x2n*xlu*rOu*rld*rOu; seg_label='34B'; wdir=l; dir_set; % contest; i_tst=2*h0+3*dl; coeff=xld*x2d*r3d*x2u*xlu*r0u*rld*r0u*rld; seg_label='35A'; wdir=2; dir_set; contest; i_tst=h0+2*h2+hl; coeff=xld*x2d*r3d*r2u*r3d*x2u*xlu; seg_label='14D'; wdir=2; dir_set; % contest; i_tst=h0+2*h2+h0; coeff=xld*x2d*r3d*r2u*r3d*x2u*xlu*r0u; seg_label='29C; wdir=l; dir.set; % contest; i_tst=h0+2*h2+h0+dl; coeff=xld*x2d*r3d*r2u*r3d*x2u*xlu*r0u*rId; seg_label='30A'; wdir=2; dir_set; contest; if inc_ref==l i_tst=2*hO+2*(rsr(3)-hO)+d2+dr; coeff=xld*x2d*r3d*x2u*xlu*xOu*rrs *xOd*xld*r2d*xlu; seg_label='28B'; wdir=2; dir_set; contest; end i_tst=h0+2*hl+hl; coeff=xld*x2d*r3d*x2u*rlu*x2d*r3d*x2u*xlu; seg_label='16E'; wdir=2; dir_set; % contest; i_tst=hO+2*hl+hO ; Coeff=xld*x2d*r3d*x2u*rlu*x2d*r3d*x2u*xlu*r0u; seg_label='33A^; wdir=l; dir_set; % contest; i_tst=h0+2*hl+h0+dl ; coeff=xld*x2d*r3d*x2u*rIu*x2d*r3d*x2u*xlu*r0u*rld ; seg_label='38A^; wdir=2; dir_set; contest; % i_tst=d2+2*hl+dr; coeff=xld*r2d*rlu*x2d*r3d*x2u*xlu; % seg_label='4E^; wdir=2; dir.set; co_test;

76
i_tst=h0+h2+3*dr; coeff=xld*x2d*r3d*x2u*rlu*r2d*xlu; seg_label=^17B^; wdir=2; dir.set; contest; i_tst=3*dl+2*hl; coeff=rld*rOu*x1d*x2d*r3d*x2u*xlu; seg_label=^2G'; wdir=2; dir_set; % co_test; i_t5t=3*dl+hl+hO; coeff=rld*r0u*xld*x2d*r3d*x2u*xlu*r0u; seg_label='25A'; wdir=l; dir_set; % co_test; i_tst=3*dl+hl+h0+dl; coeff=rld*r0u*xld*x2d*r3d*x2u*xlu*r0u*rld; seg_label='24C^; wdir=2; dir_set; contest; i_tst=3*d2+2*h2+dr; coeff=xld*r2d*xlu*r0u*xld*x2d*r3d*x2u*xlu; seg_label='3H'; wdir=2; dir_set; % contest; i_tst=3*d2+h2+h0; coeff=xld*r2d*xlu*r0u*xld*x2d*r3d*x2u*xlu*r0u; seg_label='23A'; wdir=l; dir_set; % contest; i_tst=3*d2+h2+h0+dl; coeff=xld*r2d*xlu*r0u*xld*x2d*r3d*x2u*xlu*r0u*rld; seg_label='24A'; wdir=2; dir_set; co_test; if inc_ref==l i_tst=2*h0+2*(rsr(3)-hO); coeff=xld*x2d*r3d*x2u*xlu*x0u*rrs*x0d; seg_label='26A'; wdir=l; dir_set; co_test; end if inc_ref==l i_tst=2*hO+2*(rsr(3)-hO)+dl; coeff=xld*x2d*r3d*x2u*xlu*x0u*rrs*x0d*rld; seg_label='27A'; wdir=2; dir_set; contest; end if inc_ref==l i_tst=3*h0+2*(rsr(3)-hO)+hl; Coeff=xld*x2d*r3d*x2u*xlu*x0u*rrs*x0d*xld*x2d*r3d*x2u*xlu; seg_label='26F'; wdir=2; dir_set; contest; end %%%%%%%%%%%%%% end of first TL section %%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%% second TL section, between the top and the bottom of % %%%%%%%%% the restaurant %%%%%%%%%% seg_num=2; i_tst=dl; coeff=xld; seg_label='IB'; wdir=l; dir_set; % contest; i_tst=d2+l; coeff=xld*r2d; seg_label='3A'; wdir=2; dir_set; % contest;

77
i_tst=d2+dr; coeff=xld*r2d*rlu; seg_label="4A'; wdir=l; dir_set; % contest; i_tst=d2+2*dr; coeff=xld*r2d*rlu*r2d; seg_label='7A'; wdir=2; dir.set; contest; i_tst=3*dl; coeff=rld*rOu*xld; seg_label='2C; wdir=l; dir_set; % contest; i_tst=2*dl+d2; coeff=rld*rOu*xld*r2d; seg_label=^9A'; wdir=2; dir_set; % contest; i_tst=2*dl+d2+dr; coeff=rld*r0u*xld*r2d*rlu; seg_label='ISA'; wdir=l; dir.set; contest; i_tst=2*d2+dl; coeff=xld*r2d*xlu*r0u*xld; seg_label='3D'; wdir=l; dir_set; % co_test; i_tst=3*d2; coeff=xld*r2d*xlu*r0u*xld*r2d; seg_label='12A'; wdir=2; dir_set; % co_test; i_tst=3*d2+dr; coeff=xld*r2d*xlu*r0u*xld*r2d*rlu; seg_label=^12C'; wdir=l; dir_set; contest; if inc_ref==l ,XAV^_XCJ. X i_tst=3*dl+2*(rsr(1)-hO); coeff=rld*xOu*rrs*xOd*xld; seg_label='5B'; wdir=l; dir_set; % contest; end if inc_ref==l i_tst=3*dl+2*(rsr(l)-h0)+dr; coeff=rld*x0u*rrs*x0d*xld*r2d; seg_label='ISA'; wdir=2; dir_set; contest ; end if inc_ref==l i_tst=2*d2+2*(rsr(2)-hO)+dl; coeff=xld*r2d*xlu*x0u*rrs*x0d*xld; seg_label='8B'; wdir=l; dir_set; % contest; end if inc_ref==l i_tst=2*d2+2*(rsr(2)-hO)+d2; coeff=xld*r2d*xlu*x0u*rrs*x0d*xld*r2d; seg_label='Y6'; wdir=2; dir_set; contest; end i_tst=hO+h2; coeff=xld*x2d*rSd*x2u; seg_label='lE^; wdir=2; dir_set; % contest;

78
i_tst=hO+hl; coeff=xld*x2d*r3d*x2u*rlu; seg_label='16A'; wdir=l; dir_set; % contest; i_tst=hO+hl+dr; coeff=xld*x2d*r3d*x2u*rlu*r2d; seg_label= ^17A'; wdir=2; dir.set; % contest; i_tst=h0+hl+2*dr; coeff=xld*x2d*r3d*x2u*rlu*r2d*rlu; seg_label=^18A^; wdir=l; dir_set; contest; % i_tst=dl+3*dr+2*h2; coeff=xld*r2d*rlu*x2d*r2d*x2u; % seg_label=MD^ ; wdir=2; dir.set; contest; i_tst=2*dl+d2+2*h2; coeff=rld*r0u*xld*x2d*r3d*x2u; seg_label='2F^; wdir=2; dir_set; % contest; i_tst=2*dl+d2+h2+bl; coeff=rld*r0u*xld*x2d*r3d*x2u*rlu; seg_label='22A'; wdir=l; dir_set; contest; i_tst=3*d2+2*h2; coeff=xld*r2d*xlu*r0u*xld*x2d*r3d*x2u; seg_label='3G^; wdir=2; dir_set; % co_test; i_tst=3*d2+h2+hl; coeff=xld*r2d*xlu*r0u*xld*x2d*r3d*x2u*rlu; seg_label='20A^; wdir=l; dir_set; contest; if inc_ref==l i_tst=2*h0+2*(rsr(3)-hO)+dl; coeff =xld*x2d*r3d*x2u*xlu*x0u*rrs *xOd*xId; seg_label=^26B^; wdir=l; dir_set; % contest; end if inc_ref==l i-tst=2*h0+2*(rsr(3)-hO)+d2; coeff=xld*x2d*r3d*x2u*xlu*x0u*rrs*x0d*xld*r2d; seg_label=^28A'; wdir=2; dir_set; % contest; end if inc_ref==l i_tst=2*hO+2*(rsr(3)-hO)+d2+dr; coeff=xld*x2d*r3d*x2u*xlu*x0u*rrs*x0d*xld*r2d*rlu; seg_label='29A^; wdir=l; dir_set; contest; end i_tst=3*dl+hl+h0+dl; coeff=rld*r0u*xld*x2d*r3d*x2u*xlu*r0u*xld; seg_label='25B'; wdir=l; dir_set; % contest; i_tst=3*dl+hl+h0+d2; coeff=rld*r0u*xld*x2d*r3d*x2u*xlu*r0u*xld*r2d; seg_label='24D'; wdir=2; dir.set; contest;

79

i_tst=h0+2*hl+h2; coeff=xld*x2d*r3d*x2u*rlu*x2d*r3d*x2u; seg_label='16D'; wdir=2; dir_set; % co_test; i.tst=h0+2*hl+hl; coeff=xld*x2d*r3d*x2u*rlu*x2d*r3d*x2u*rlu; seg_label='31A'; wdir=l; dir_set; contest; i.tst=3*d2+h2+h0+dl; coeff=xld*r2d*xlu*r0u*xld*x2d*r3d*x2u*xlu*r0u*xld; seg_label='23B'; wdir=l; dir_set; % contest; i_tst=3*d2+h2+hO+d2; seg_label='24B ^; Coeff=xld*r2d*xlu*r0u*xld*x2d*r3d*x2u*xlu*r0u*xld*r2d; wdir=2; dir_set; contest; i_tst=hO+3*h2; coeff=xld*x2d*r3d*r2u*r3d*x2u; seg_label='14C'; wdir=2; dir.set; %co_test; i_tst=hO+2*h2+hl; coeff=xld*x2d*r3d*r2u*r3d*x2u*rlu; seg_label='29B^; wdir=l; dir_set; co_test; i_tst=2*hO+3*dl; coeff=xld*x2d*r3d*x2u*xlu*r0u*rld*r0u*xld; seg_label='34C; wdir=l; dir_set; % contest; i_tst=2*hO+2*dl+d2; Coeff=xld*x2d*r3d*x2u*xlu*r0u*rld*r0u*xld*r2d; seg_label='36A'; wdir=2; dir_set; co_test; i«tst=h0+2*h2+h0+dl; coeff=xld*x2d*r3d*r2u*r3d*x2u*xlu*r0u*xld; seg_label='29D^; wdir=l; dir_set; % contest; i»tst=h0+2*h2+h0+d2; coeff=xld*x2d*r3d*r2u*r3d*x2u*xlu*r0u*xld*r2d; seg_label=^32A'; wdir=2; dir_set; contest; i.tst=h0+2*hl+h0+dll*Co'^f=xld*x2d*r3d*x2u*rIu*x2d*r3d*x2u*xlu*r0u*xld; seg_label='33B' ; wdir=l; dir_seti contest; if inc_ref==l '^^ulx^bèi^rux-iieob

i_tst=3*h0+2*(rsr(3)-hO)+h2; Coeff=xld*x2d*r3d*x2u*xlu*x0u*rrs*x0d*xld*x2d*r3d*x2u; seg_label='26E'; wdir=2; dir_set; % contest; end %%%%%%%%%%%% end of the second TL section %%%%%%%%%%%%%%%%%% %%%%%%%%%%% third TL section, between the bottom of the restaurant % and ground %%%%%%%%%% seg_num=3; i_tst=d2; coeff=xld*x2d; seg_label='1 C ;

80
wdir=l; dir_set; % contest; i_tst=d2+2*dr; coeff=xld*r2d*rlu*x2d; seg_label=MB^ ; wdir=l; dir_set; % contest; i_tst=d2+dr+hl; coeff=xld*r2d*rlu*x2d*r3d; seg_label=*4C*; wdir=2; dir_set; contest; l_tst=hO; coeff=xld*x2d*r3d; seg_label='lD'; wdir=2; dir_set; % co.test; %hO+l

i_tst=hO+h2; coeff=xld*x2d*r3d*r2u; seg_label='14A'; wdir=l; dir_set; % contest; i_tst=hO+hl+dr; coeff=xld*x2d*r3d*x2u*rlu*x2d; seg_label='16B'; wdir=l; dir_set; % contest; i_tst=hO+2*hl; coeff=xld*x2d*r3d*x2u*rlu*x2d*r3d; seg_label='16C'; wdir=2; dir_set; % contest; i_tst=h0+2*hl+h2; coeff=xld*x2d*r3d*x2u*rlu*x2d*r3d*r2u; 8eg_label=^Vl'; wdir=l; dir_set; contest; i_tst=hO+2*h2; coeff=xld*x2d*r3d*r2u*r3d; seg_label='14B'; wdir=2; dir_set; % co_test; i_tst=h0+3*h2; coeff=xld*x2d*r3d*r2u*r3d*r2u; seg_label='X8'; wdir=l; dir.set; contest; i_tst=2*h0+2*dl+d2; coeff=xld*x2d*r3d*x2u*xlu*r0u*rld*r0u*xld*x2d; seg_label=^34D'; wdir=l; dir_set; % contest; i_tst=2*h0+2*dl+h0 ; coeff=xld*x2d*r3d*x2u*xlu:*'rOu*rld*rOu*xld*x2d*r3d; seg_label=^34E'; wdir=2; dir_set; contest; i_tst=3*d2; coeff=xld*r2d*xlu*r0utxld*x2d; seg_label='3E'; wdir=l; dir_set; % co_test; i_tst=3*d2+h2; coeff=xld*r2d*xlu*r0u*xld*x2d*r3d; seg_label='3F'; wdir=2; dir_set; % contest; i_tst=3*d2+2*h2; coeff=xld*r2d*xlu*r0u*xld*x2d*r3d*r2u; seg_label=^21A'; wdir=l; dir_set; contest; i_tst=3*dl+dr; coeff=rld*r0u*xld*x2d; seg_label='2D'; wdir=l; dir_set; % contest;

81
i_tst=2+dl+hO; coeff=rld*r0u*xl(i*x2d*r3d; seg_label='2E'; wdir=2; dir_set; % contest; i_tst=2*dl+hO+h2; coeff=rld*r0u*xld*x2d*r3d*r2u; seg_label='19A'; wdir=l; dir_set; contest; if inc_ref==l i_tst=3*dl+dr+2*(rsr(l)-h0); coeff=rld*xOu*rrs*xOd*xld*x2d; seg_label=^5C; wdir=l; dir_set; % contest; end if inc_ref==l i_tst=2*dl+hO+2*(rsr(l)-hO); coeff=rld*x0u*rrs*x0d*xld*x2d*r3d; seg_label='5D^; wdir=2; dir_set; co_test; end if inc_ref==l i_tst=3*d2+2*(rsr(2)-hO); coeff=xld*r2d*xlu*x0u*rrs*x0d*xld*x2d; seg_label='8C; wdir=l; dir_set; % contest; end if inc_ref==l i_tst=3*d2+2*(rsr(2)-hO)+h2; coeff=xld*r2d*xlu*x0u*rrs*x0d*xld*x2d*r3d; seg_label=^8D'; wdir=2; dir_set; contest; end if inc_ref==l i_tst=2*hO+2*(rsr(3)-hO)+d2; coeff=xld*x2d*r3d*x2u*xlu*x0u*rrs*x0d*xld*x2d; seg_label='26C'; wdir=l; dir_set; % contest; end i_tst=3*dl+hl+hO+d2; Coeff=rld*r0u*xld*x2d*r3d*x2u*xlu*r0u*xld*x2d; seg_label=^25C^; wdir=l; dir_set; % contest; i_tst=3*dl+hl+2*h0; Coeff=rld*r0u*xld*x2d*r3d*x2u*xlu*r0u*xld*x2d*r3d; seg_label=^25D'; wdir=2; dir_set; contest; i_tst=3*d2+h2+hO+d2; Coeff=xld*r2d*xlu*r0u*xld*x2d*r3d*x2u*xlu*r0u*xld*x2d; seg_label='23C; wdir=l; dir_set; contest; if inc_ref==l i_tst=3*hO+2*(rsr(3)-hO); Coeff=xld*x2d*r3d*x2u*xln*x0u*rrs*x0d*xld*x2d*r3d; seg_label=^26D'; wdir=2; dir_set; % contest;

82

end if inc.ref==1 i_tst=3*h0+2*(rsr(3)-hO)+h2; Coeff=xld*x2d*r3d*x2u*xlu*x0u*rrs*x0d*xld*x2d*r3d*r2u; seg_label='37A^; wdir=l; dir.set; contest; end i_tSt=h0+2*h2+h0+d2; Coeff=xld*x2d*r3d*r2u*r3d*x2u*xlu*r0u*xld*x2d; seg.label='29E'; wdir=l; dir_set; co_test; %%%%%%%%%%%% end of the third TL section %%%%%%%%%%%%%%%%%% if bounce_diagram==l frame=getframe ; % animation demol=addframe(demol,frame); % animation end end % to end the i counting for loop if bounce_diagram==l demol=close(demol); % animation end %emfplot datestr(now)

83
%%%%%%%%%%%%% heidler.d.m %%%%%%%%%%%%%%%%%%%%% %%% Kristofer Bitner 2004 %%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% This program provides the heidler derivative based on the analytical % solution ·/define constants alpha=l; %92; match_case=0; if match_case==0 % for matched current derivative alpha=1.22906; %92; lo1=8.629*1000; % peak current in amps 8.629 Io2=l1.0741*1000; % 11.074 k=4.3102; % 4.31 taul=151.5106*(10"(-9)); % seconds 151.51ns tau2=109.7805*(10''(-6)); % seconds 109.78us tau3=248.993*(10"(-9)); % seconds 248.99ns tau4=168.6835*(10''(-6)) ; % seconds 168.68us elseif match_case==l % for matched current alpha=0.7906; %92; Iol=ll.3873*1000; % peak current in amps Io2=8.2176*1000; k=3.354; % 4 taul=193.3198*(10''(-9)) ; % seconds 23ns tau2=0.3571*(10"(-6)); % seconds 5us tau3=241.0769*(10"(-9)); % seconds 23ns tau4=22.2951*(10"(-6)); % seconds 120us end Constl=Iol/(2*alpha); Const2=Io2/(2*alpha); % equation terml=(-l/tau2)* (exp(-t/tau2))*(((t/taul)"(-k) + 1)"(-1)); term2=-(exp(-t/tau2))*((-k/taul)*((t/taul)"(-k-1)))*... (( (t/taul) X -k) + D X - 2 ) ) ; term3=(-l/tau4)*(exp(-t/tau4))*(((t/tau3)''(-k) + 1)"(-1)) ; term4=-(exp(-t/tau4))*((-k/tau3)*((t/tau3)"(-k-1)))*... (((t/tau3)"(-k) + D X - 2 ) ) ; hdlrd=Const 1* (terml+term2) +Const2* (term3+term4) ;

84
%%%%%%%%%%%%%%%% initial_l.m %%%%%%%%%%%%%%%%%%%%%%%%% %%% Kristofer Bitner 2004 %%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
7 * This subroutine will calculate the field components for the current % elements within the tower. This is for the initial % current pulse. Downward propagating waveforms. % The propagation time between the current and fields is condsidered % The current is also calculated at the coil location specified in crntd.m % add 1 to the first and last segments in order to assign the first % position in the current matrices to ground, i.e. current(1) = current at % Om % % % % % % the last_seg, at least for the top TL section of the tower, should be the top index of the section, ie.hl, minus i, plus i_tst. This is for while the beginning of the impulse is within the TL section. The start_h value should be the top index of the section, ie.hl, plus the distance travelled by the impulse to arrive at the bottom, ie.i_test, minus 1.

if seg_num==l first_seg=hO-l; start_h=hO+i_tst-l elseif seg_num==2 first_seg=hl-l; start_h=hl+i_tst-l elseif seg_num==3 first_seg=h2-l; start_h=h2+i_tst-l end for j=first_seg+l:-1:last_seg+l current(j)=hdli(j-start_h+i); current_i(j)=hdliint(j-start_h+i); current_d(j)=hdld(j-start_h+i); I=current(j)*coeff; Iint=current_i(j)*coeff; dI=current_d(j)*coeff; % in amps/second if j-l==coiloc % for actual height j-1 I_coil(i)=I_coil(i)4-I; dI_coil(i)=dI_coil(i)+dI; Iint__coil(i)=Iint_coil(i)-Hint ; end if do_fields==l emf; Ez(i+t.delay)=Ez(i+t_delay)+E.stat+E.ind+E_rad; Hphi (i+t .delay )=Hphi (i+t.delay )+H.rad+H.ind; if field.comp==l El(i+t.delay)=El(i+t.delay)+ E.stat; E2(i+t.delay)=E2(i+t.delay)+ E.ind;

85
E3(i+t_delay)=E3(i+t_delay)+ E_rad; Hrad(i+t_delay)=Hrad(i+t_delay)+H_rad; Hind(i+t_delay)=Hind(i+t.delay)+H_ind; end end end %%%%%%%%%% this part is for the bounce diagram animation %%%%%%%%%% if bounce.diagram==l if last.seg ~= 0 & last.seg ~= hi & last.seg ~= h2 & last.seg ~= hO plot(time.axis(i),(j-l)*seg_size,'b . O end end

86
%%%%%%%%%%% initial_2.m %%%%%%%%%%%%%%%%%%%%%%% %% Kristofer Bitner %%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
7o elements in the tower.
% This subroutine will calculate the field components for the current For upward propagating impulses. % The propagation time between the current and fields is condsidered % The current is also calculated at the coil location specified in crntd.m

7 , add 1 to the first and last segments in order to assign the first 7o position in the current matrices to ground. i.e. current(1) = current at 7. Om % the last_seg, at least for the top TL section of the tower, should be the % bottom index of the section, ie.hl, plus i, minus i_tst. This is for % while the beginning of the impulse is within the TL section. 7o The start_h value should be the bottom index of the section, ie.hl, minus 7o the distance travelled by the impulse to arrive at the bottom, 7o ie.d2+dr (i_tst), plus 1. if seg_num==l first_seg=hl+l; start_h=hl-i_tst+l; elseif seg_num==2 first_seg=h2+l; start_h=h2-i_tst+l; elseif seg_num==3 first_seg=l; start_h=0-i_tst+l; elseif seg_num==0 first_seg=hO+l; start_h=hO+l-i_tst; end for j=first_seg+l:last_seg+l current(j)=hdli(i+start_h+l-j); current_i(j)=hdliint(i+start_h+l-j); current_d(j)=hdld(i+start_h+1-j); 1=current(j)*coeff; Iint=current_i(j)*coeff; dI=current_d(j)*coeff; % in amps/second if j-l==coiloc % for actual height j-1 I_coil(i)=I_coil(i)+I; dI_coil(i)=dI_coil(i)+dl; Iint_coil(i)=Iint_coil(i)+Iint; end if do_fields==l emf; Ez(i+t_delay)=Ez(i+t_delay)+E_stat+E_ind+E_rad; Hphi(i+t_delay)=Hphi(i+t_delay)+H_rad+H_ind; if field_comp==l El(i+t_delay)=El(i+t.delay)+ E_stat;

87
E2(i+t_delay)=E2(i+t.delay)+ E.ind; E3(i+t.delay)=E3(i+t.delay)+ E.rad; Hrad(i+t.delay)=Hrad(i+t.delay)+H.rad; Hind(i+t.delay)=Hind(i+t.delay)+H.ind; end end end

%%%%%%%%%%%%%%% this part is for the animation bounce diagram %%%%%%%%%%% if bounce.diagram==l if last.seg"'=hl & last.seg~=h2 k last.seg'"=hO k last.seg~=rsr(l) ... k last.seg~=rsr(2) & last.seg~=rsr(3) ... k last.seg"=rsr(4) k last.seg~=rsr (5) k last.seg*"=rsr(6) ... k last.seg~=rsr(7) plot(time.axis(i),(j-l)*seg.size,'b.O end end

88
%%%%%%%%%%%% initial_rs.m %%%%%%%%%%%%%%%%%%%%%%%%%%%% %%% Kristofer Bitner 2004 %%% % This subroutine will calculate the field components for the current % elements in return stroke channel. For upward propagating impulses. % The propagation time between the current and fields is condsidered % add 1 to the first and last segments in order to assign the first % position in the current matrices to ground, i.e. current(1) = current at % Om % the last_seg, at least for the top TL section of the tower, should be the 7 « bottom index of the section, ie.hl, plus i, minus i_tst. This is for % while the beginning of the impulse is within the TL section. % The stsirt_h value should be the bottom index of the section, ie.hl, minus % the distance travelled by the impulse to arrive at the bottom, % ie.d2+dr (i_tst), plus 1. % the *(l-i*chan_seg_size/lambda); factor is for MTLL, H=1000; % the effective channel height in meters for j=hO+2:last_seg % the first point in the RS channel is actually hO+1 pz= (l-(j-hO+1)*chan_seg_size/H) ; current(j)=hdli(i-j+hO+2); current_i(j)=hdliint(i-j+hO+2); current_d(j)=hdld(i-j +hO+2); I=current(j)*coeff*pz; Iint=current_i(j)*coeff*pz; dl=current_d(j)*coeff*pz; % in amps/second if do_fields==l emfrs; Ez(i+t_delay)=Ez(i+t.delay)+E_stat+E_ind+E_rad; Hphi(i+t.delay)=Hphi(i+t.delay)+H.rad+H.ind; if field.comp==l El(i+t.delay)=E1(i+t.delay)+ E.stat; E2(i+t.delay)=E2(i+t.delay)+ E.ind; E3(i+t.delay)=E3(i+t.delay)+ E.rad; Hrad(i+t.delay)=Hrad(i+t.delay)+H.rad; Hind(i+t.delay)=Hind(i+t.delay)+H.ind; end end end %%%%%%%%%%%%%%% this part is for the bounce diagram animation %%%%%%%%%%% if bounce.diagram==l plot(time.axis(i),(rs.loc)*seg.size,^m.O end

89
%%%%%%%%%%%% emf.m %%%%%%%%%%%%%%%%% %% Kristofer Bitner 2004 %% % This program evalutes the expression for the electric and magnetic fields

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% rho2 the square of the distance in meters from the tower along ground rho2=4*(10"6);
% R i s t h e d i s t a n c e i n m e t e r s fro m t h e s e g m e n t t o t h e f i e l d p o i n t

R=sqrt(rho2+(seg_size*(j-l))''2) ; t_delay=round((R/(3*10"8))/t_inc);
R squ ared=R "2;

Eterml=seg_size/ (2*pi*8.854* (10''~12) ) ; Eterm2= ((2-3* (rho2/Rsquared) )/R"3) *Iint ; % electrostatic component Eterm3= ((2-3* (rho2/Rsquared) )/ (3* (10'*8) *Rsquared) )*I ; ` /.induction term Eterm4=-((rho2/Rsquared)/(R*9*(10"16)))*dI; % radiation term E_stat=Eterml*Eterm2; E_ind=Eterml*Eterm3; E_rad=Eterml*Eterm4; Hterml=-seg_size/(2*pi); Hterm2=2000*dI/(Rsquared*3*(10''8)) ; % radiation component Hterm3=2000*I/(R"3) ; % induction component H_rad=Hterml*Hterm2; H_ ind=Ht erm1*Hterm3;

90
%%%%%%%%% emfrs.m %%%%%%%%%%%%%% %% Kristofer Bitner 2004 %% % This program evaluates the electric and magnetic field expressions for % the current in the return stroke channel

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% rho2 is the square of the distance in meters from the tower along ground rho2=4*(10^6); % R is the distance in meters from the segment to the field R=sqrt (rho2+ (chan_seg_size* (j- (hO+1) )+hO*seg__size) "2) ; point t_delay=round((R/(3*10"8))/t_inc); Rsquared=R"2; Eterml=chan_seg_size/(2*pi*8.854*(10'` -12)); %%%%%%%%%%%% change Eterm2=((2-3*(rho2/Rsquared))/R"3)*Iint; % electrostatic component Eterm3= ((2-3* (rho2/Rsquared) )/ (3* (10''8) *Rsquared) )*I ; ` /.induction term Eterm4=-((rho2/Rsquared)/(R*9*(10''16)))*dI; % radiation term E_stat=Eterml*Eterm2; E_ind=Eterml*Eterm3; E_rad=Eterml*Eterm4; Hterml=-chan_seg_size/(2*pi); Hterm2=2000*dI/(Rsquared*3*(10"8)) ; 7 . radiation component Hterm3=2000*I/(R''3) ; % induction component H_rad=Hterml*Hterm2; H_ind=Hterml*Hterm3;

91
%%%%%%%%% dir.set.m %%%%%%%%%%%%%%%% %%% Kristofer Bitner 2004 %%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% this program determines whether the wave is going up or down and selects % the appropriate limits to be sent to initiall or initial2 7 , wdir=l for down and wdir=2 for up if seg_num==l if wdir==l if i > i_tst & i <= i_tst+dl last_seg=hO-i+i_tst; initial_l; elseif i > i_tst+dl last_seg=hl; initial_l; end elseif wdir==2 if i > i_tst & i <= i_tst+dl last_seg=hl+i-i_tst; initial_2; elseif i > i_tst+dl last_seg=hO; initial_2; end end elseif seg_num==2 if wdir==l if i > i_tst & i <= i_tst + dr last_seg=hl-i+i__tst ; initial_l; elseif i > i_tst + dr last_seg=h2; initial.1; end elseif wdir==2 if i > i.tst & i <= i.tst + dr last_seg=h2+i-i_tst; initial_2; elseif i > i.tst+dr last_seg=hl; initial.2; end end elseif seg_num==3 if wdir==l if i > i.tst & i <= i.tst + h2 last_seg=h2-i+i_tst; initial.l; elseif i > i_tst+h2 last_seg=0; initial.l; end elseif wdir==2 if i > i.tst & i <= i.tst+h2 last.seg=0+i-i.tst; initial.2; elseif i > i.tst+h2 last.seg=h2; initial.2; end

92
end end

93
%%%%%%%%%% contest.m %%%%%%%%%%%%%%%%%%% %%% Kristofer Bitner 2004 %%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% this program creates an array containing the segment labels and the % magnitude of the current wave in that segment. This may be used to % dotormino if the magnitude i s small en o u g h t o j u s t i f y i g n o r i n g f u r t h e r % reflections if i == 1
c o e ff_ te s t= i;

end if i==i_tst coeff_mat{coeff_test,l}=seg_label; coeff_mat{coeff_test,2}=coeff; coeff_test=coeff_test+l; end

94
%%%%%%%% optim.m %%%%%%%%%%%%% %%% Kristofer Bitner %%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% This program optimizes the difference between the main peak of the % measured current derivative and calculated current derivative peaks 7 o It also matches the current using by aligning the midpoints of the % measured and calculated waveforms datestr(now) didec; % get the measured waveform with 10ns resolution paramtr = 1; 7 , 0 for derivative, 1 for current global midpnt2_idx; global midpntl.idx; global ind_dif; global fxlength; global dd; if paramtr == 1 [yfact, yind] = max(deci(8200:8245)) ; % find the max of the measured else [yfact, yind] = max(decdi); % find the max of the measured end midpntl=yfact/2; smallest_dif=10; for i=8200:8245 if abs(deci(i)-midpnt1) <= smallest_dif smallest_dif=abs(deci(i)-midpnt1); midpntl_idx=i; end end pnts=90; % number of points to plot % tauO = initial guess for tau 7o [taul tau2 tau3 tau4 lol Io2 k] tau0=[160 20 250 70 10 10 4] ; lb=[100 0.1 200 20 7 7 3] ; % lower bound ub= [500 1000 500 1200 12 12 5] ; % upper bound 7o set the m£LX number of iterations options=optimset('Maxlter^ ,50, ' TolFim',0.0001, 'Display', 'iter') ; if paxamtr==0 % -7+12,-12+18 tau=LSqCURVEFIT (Oopt2dd,tauO,yfact,decdi (yind-6 :yind+13) ,... lb,u b ,options,pnts,decdi) % for dd else tau=LSQCURVEFIT(@opt2di,tauO,yfact,... deci(midpntl_idx-15:midpntl_idx+15),... lb,u b ,options,pnts,deci) %for di end

95
crntd; % create the time vector for i=l:sim_d w_time(i)=0.01*1; end if paramtr == 1 [yfact, yind] = max(deci(8200:8245)); % find the max of the measured dil=resample(I.coil,10,6); [xfact, xind] =max (dil (1:90) / (lO^'S) ) ;% 10"9 for di/dt di=(dil/(10"3))*(yfact/xfact); % normalize di=di'; ddl=resample(dI_coil,10,6); dd=(ddl/(10"9))*(yfact/xfact); % normalize dd=dd'; ind_dif=midpntl_idx-midpnt2_idx; else [yfact, yind] = max (decdi) ; % find the max of the measured ddl=resample(dI_coil,10,6); [xfact, xind]=max(ddl/(10''9)) ;% 10^9 for di/dt dd=(ddl/(10"9))*(yfact/xfact); dd=dd'; dil=resample(I_coil,10,6); di=(dil/(10''3))*(yfact/xfact) ; % normalize di=di ^; ind_dif=yind-xind; end if paramtr==0 figured) % for viewing subplot(2,1,1) plot(w_time(1rpnts),dd(l:pnts), % w_time(l:pnts), hold on plot(w_time(1:pnts),decdi(ind_dif+2:ind_dif+pnts+l),'k:O set(gca,^FontSize^,11,^FontWeight','bold') xlabel('Time [us]') ylabel('di/dt [kA/us]') legend('Model', 'Measured') %, 'difference') subplot(2,1,2) plot(w_time(l:pnts), di(lrpnts),'k') % w_time(l:pnts), hold on plot(w_time(l:pnts) , deci(ind.dif+2:ind_dif4-pnts+l) ,'k: ') set(gca,'FontSize',11,'FontWeight','bold') xlabel('Time [us]') ylabelCl [kA] ') legend('Model', 'Measured') %, 'difference') else figure(1) % for viewing subplot(2,1,1)

96
plot (w_time (1 : pnts) , dd(l:pnts) ,'kO hold on plot (w_time(1 : pnts) ,decdi(8172:8171+pnts) ,'kO y.plotCdidif 1(1:pnts) , set(gca,'FontSize',11,'FontWeight','bold') xlabel('time [us]') ylabel('di/dt [kA/us]') legend('Model', 'Measured') %, 'difference') subplot(2,1,2) plot(w_time(1:pnts), di(l:pnts),'k ') hold on plot(w_time(l:pnts),deci(8172:8171+pnts),' k ') set(gca,'FontSize',11,'FontWeight','bold') xlabel('Time [us]') y l a b e K 'I [kA]') legend('Model', 'Measured') %, 'difference') end datestr(now)

97
%%%% opt2di %%%%%%%%%%%%%% %%% Kristofer Bitner 2004 %%%%%% % This function provides the waveform for a given set of parameters so that % the least squares function can subtract it from the measured waveform function f = opt2(tau,yfact,pnts,deci) crntd; global midpnt2_idx; global midpntl_idx; global ind_dif; global fxlength; dil=resample(I_coil,10,6); [xfact, xind]=max(dil(l:90)/(10"3)); % 10^9 for di/dt di= (dil/(10''3))*(yf act/xf act) ; di=di'; midpnt2=yf act/2; smallest_dif=10; for i=l:60 if abs(di(i)-midpnt2) <= smallest_dif smallest_dif=abs(di(i)-midpnt2); midpnt2_idx=i; end end ind_dif=midpntl_idx-midpnt2_idx; f=di(midpnt2_idx-15: midpnt2_idx+15);

98
%%%%%% opt2dd.m %%%%%%%%%%%%% %%% Kristofer Bitner 2004 * / , * / , * / , % this function returns the current derivative waveform produced using a % given set of parameters so that the least squares algorithm can subtract % it from the measured waveform function f = opt2dd(tau,modwav,pnts,decdi) crntd; global dd; ddl=resample(dI_coil,10,6); [yfact, yind] = max(decdi); % find the max of the measured [xfact, xind]=max(ddl/(10"9)); % 10"9 for di/dt dd=(ddl/(10'9))*(yfact/xfact); dd=dd'; ind_dif=yind-xind; f=dd(xind-7:xind+12); % -12,+18 for .3-.6, -7+12 for .35-.55


