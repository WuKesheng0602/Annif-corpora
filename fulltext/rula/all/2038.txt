H A R D W A R E IN T H E LOOP T E ST IN G OF M ICROSATELLITE C O M P O N E N T S

by Sarah Hardacre, Bachelor of Engineering Ryerson University, Toronto, 2002

A thesis presented to Ryerson University in partial fulfillment of the requirements for the degree of M aster of Apphed Science in the Program of Mechanical Engineering

Toronto, Ontario, C anada, 2005 © S arah Hardacre 2005

PROPERTY OF R Y ERW N-iiW W iK iTV LieRARV

UMl Number: E C 53021

All rights reserved INFORMATION TO USERS

The quality of this reproduction is dependent upon the quality of the copy submitted. Broken or indistinct print, colored or poor quality illustrations and photographs, print bleed-through, substandard margins, and improper alignment can adversely affect reproduction. In the unlikely event that the author did not send a complete manuscript and there are missing pages, th ese will be noted. Also, If unauthorized copyright material had to be removed, a note will indicate the deletion.

UMI
UMI Microform EC53021 Copyright 2008 by ProQuest LLC All rights reserved. This microform edition is protected against unauthorized copying under Title 17, United States Code.

ProQuest LLC 789 East Eisenhower Parkway P.O. Box 1346 Ann Arbor, Ml 48106-1346

Authors Declaration
I hereby declare that I am the sole author of this thesis. I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research.

I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

u

B o rro w er's P a g e
Ryerson University requires the signatures of all persons using or photocopying this thesis. Please sign below, and give address and date.

Ill

Abstract Hardware in the Loop Testing of Microsatellite Attitude Control Components Mas ter's of Applied Science, 2005

Sarah Hardacre Mechanical Engineering Ryerson University The desire to bring space travel to a wider range of missions and uses has driven the market to using smaller and thus more affordable satellite systems. The Canadian Space Agency is completing the design and construction of a small satellite named QuickSat, which will utilize a magnetometer as one of its attitude and orbit determi nation instruments. A test bed comprised of three pairs of Helmoltz Coils was used for hardware in the loop testing of the magnetometer. Testing was initially completed to prove the capabilities of the test bed, and then was completed to demonstrate the capabilities of the flight qualified magnetometer. The three pairs of Helmholtz coils were driven by data calculated from a spherical harmonic model of the Earth's mag netic field. The coils were controlled using a robust controller and the magnetometer was used to drive the B-dot control law in the QuickSat simulation. The Ryerson Attitude and Control Experiment (RACE), which is a small satellite sized platform, free to spin about one axis on a near frictionless air bearing, was utilized to develop and test a system to deal with redundancy of satellite sensors. The possibility of missing, noisy or erroneous output during flight requires that a filter be applied to a satellite's flight code to determine with accuracy the attitude and orbit of the spacecraft. It was thus decided that a Kalman Filter be applied to RACE. The Kalman filter was applied to the RACE simulation successfully and initial hardware testing was carried out.

IV

A c k n o w le d g e m e n ts
I would first like to thank my thesis advisor, DJ McTavish for his guidance and direction, as well as all his patience and support during the completion of this degree. I would also like to show my appreciation to my advisors at the C anadian Space Agency, Alfred Ng and David Golla, for their help through out the completion of the QuickSat studies, as well as my co-workers, Christian Ribe and Suda M artins for their positive a ttitu d e during periods of discouragement and for all of the help they provided w ith technical details and program m ing issues. Finally, I would like to thank my supervisor at the E uropean Space Agency, Franco Ongaro, for all his support while I was w riting this thesis. I have appreciated his constant encourage m ent and m otivational talks, and the flexibility in scheduling th a t he allowed me to write while working full time. I am unable to express how much his understanding and constant positive spirit m otivated me to keep working.

Contents
Authors D e c la ra tio n ................................................ Borrower's P a g e ..................................................................................................................... A b s tr a c t................................................................ A cknow ledgem ents.............................................................................................................. Table of C o n te n ts.................................................................................................................. List of T a b l e s .......................................................................... List of F igures.................................................................................... List of S y m b o ls ...................................... ü hi iv v vi x xi xiii

1

In trod u ction 1.1 Scope 1.1.1 1.1.2 1.1.3 1.1.4 ........................................................................................................................... Q uickS at........................................................................................................... Magnetometer T e s t i n g ................................................................................. R A C E .............................................................................................................. RACE T esting..........................................................................

1 4 4 4 6 6

2 D e ta ile d S y stem D escrip tion s 2.1 Q uickS at......................... 2.1.1 2.2 QuickSat M a g n e to m e te r.............................................................................. ........................................................................
vi

7 7 7 8

Description of the Helmholtz Cage

2.3 2.4

Support S tru c tu re ....................................................... Hardware and Software C o m p o n e n ts ..................................................................... 2.4.1 2.4.2 2.4.3 2.4.4 S im u la tio n .......................................................................................................... Windows NT s t a t i o n ...................................................................................... QNX S t a t i o n .................................................................................................... D ata Acquisition and Control of Coils .....................................................

10 10 10 11 12 12 13 13 14

2.5

RACE C o m p o n e n ts........................................................................................................ 2.5.1 2.5.2 RACE Sensors ................................................................................................

A c t u a t o r s ..........................................................................................................

3

M o d e lin g 3.1 QuickSat M o d e lin g ........................................................... 3.1.1 3.1.2 3.1.3 3.1.4 3.1.5 3.1.6 3.2 System D y n a m ic s............................................................................................. Spacecraft K in e m a tic s .................................................................................... A c t u a t o r s ........................................................................................................... D isturbance T o r q u e s ............................................................................ O rbital Mechanics ..........................................................................................

15, 15 15 16 17 18 19 20 23 23 · ·
v ii

M agnetic F i e l d ................................................................................................. ...........................................................................................................

RACE Modeling 3.2.1 3.2.2

D y n a m ic s ............................. S tate Space M o d e l

23

3.2.3 3.2.4 4

Momentum W h e e l ................................................ Rate S e n s o r ......................................

27 29 30 30 34 38 38 39 44 46 46 47 49 49 52 52 54 56 56 56

C ontroller D esign for Q uickSat P ro ject 4.1 4.2 Robust C o n tro ller....................................................................................................... B-dot Control L a w ....................................................................................................

5

T esting o f H elm h oltz C age 5.1 5.2 5.3 Verification of Magnetometer M e a su re m e n ts....................................................... Axis Linearity and C o u p lin g .................................................................................... Transfer F u n c tio n .......................................................................................................

6

Q uickSat H ardware in th e Loop Sim ulation 6.1 Helmholtz Cage Controller Im plem entation.......................................................... 6.1.1 6.2 Misalignment of M agnetom eters.................................................................

Hardware in the Loop with QuickSat S im ulation................................................ 6.2.1 6.2.2 Open Loop S im u la tio n ................................................................................. Closed Loop S im u la tio n ..............................................................................

6.3

B-dot Control L a w .......................................................................... 6.3.1 Stability of B-dot Control L aw ....................................................................

7

C ontroller D esign for R A C E project 7.1 7.2 PID C o n tr o lle r ........................................................................................................... Kalman F i l t e r .............................................................................................
v iii

8

R A C E S im u la tio n s 8.1 8.2 8.3 R ate Sensor B i a s .......................................................................................................... Controller T e s tin g .......................................................................................................... K alm an Filter T e s t i n g .................................................................................................

61 62 65 66

9

C o n clu d in g R em ark s 9.1 9.2 9.3 Q u ic k S a t........................................................................................................................... R A C E ............................................................................................ Recom mendations for Future W o r k ..........................

71 71 72 72

R e fer en ce s

73

IX

L ist o f T ables
1 2 3 4 5 6 7 8 9 Helmholtz Coil C haracteristics................................................................................... Friction Coefficients...................................................................................................... Static Magnetic Field Measurements At Center ofHelmholtz C a g e ................... Billingsley Scaling F a c to r............................................................................................ Values of Coil Gains and Their Associated V a lu e s ............................................ 10 28 38 39 40 45 46 53

Time Constants for the Coil S y stem ......................................................................... Robust Controller Gains for Helmholtz C a g e ......................................................... B-Dot Controller Coefficients ...................................................................................

Various Initial Tumbling Rates and their Corresponding Time to Reach Mode 20 ..................................................................................................................................

54 66

10 Robust Controller Gains for Helmholtz C a g e .........................................................

L ist o f F ig u res
1 2 3 4 5 QuickSat M o d e l........................................................................................................ Ryerson Satellite A ttitude Control Experim ent (RACE) [1 6 ]........................ M agnetom eters Used for QuickSat (above :Billingsly, below:Baxington) . . . . Helmholtz Coil C o n fig u r a tio n .............................................................................. 9 5 6 8

The Support Structure Holding the M agnetom eters in the Centre of the Coil C o n fig u ra tio n ........................................................................................................... 11 The Hardware in the loop S y s te m ....................................................................... Definition of O rbital P a ra m e te rs.......................................................................... Friction Model ............................................................................................................... 13 20 27

6 7 8 9

A ngluar Velocity of RACE M omentum W heel in the presence of friction only w ith initial rate of rotation of 1 5 ° / s ................................................................... 28 35

10 11

R obust Controller Block D ia g r a m .......................................................................

R elationship between Input C urrent Along X-Axis and O utput Voltage of M a g n eto m ete r........................................................................................................... 41

12

Relationship between Input C urrent Along Y-Axis and O utput Voltage of M a g n eto m ete r........................................................................................................... 41

13

Relationship between Input Current Along Z-Axis and Output Voltage of M ag n eto m ete r........................................................................................................... 42 43 43

14 15 16

Response Along the X-Axis to a Step Input Response Along the Y-Axis to a Step Input

.......................................................... .......................................................... 44

Response Along the Z-Axis to a Step I n p u t ......................................................
xi

17 18

Circuit for determining the Time Constant of the coils

.....................................

45

Response of the Coils to Sine Wave Input, Measured with the Barington M agnetom eter.............................................................................................................. 47

19

Response of the Coils to sine Wave Input, Measured with the Billingsly Mag netometer ..................................................................................................................... 48 50 51 52

20 21 22

Error in Magnitude of Field with sine Input Alone Each A x is ........................... Magnitude of F i e l d ...................................................................................................... Magnitude of F i e l d ......................................................................................................

23 Response of Each Axis to Simulation Input W ith Billingsly Magnetometer D ata Driving S im u la tio n ........................................................................................... 24 Magnitude of the Magnetic Field with Simulation Running until Mode 70 . . 25 Summary of Kalman F ilte r ......................................................................................... 26 Rate Sensor Readings while RACE is fixed and actuators are powered off . . 27 Rate Sensor Readings while RACE is fixed and actuators are powered. ... 53 55 60 62 63 64 65 67

28 Effects of Increased Temperature on Rate Sensor................................................... 29 Angular Rates of a free spinning RACE platform ...............................................

30 Response of RACE to a Step I n p u t ......................................................................... 31 Kalman Filter Estimates of Angular Position (Sampling Frequency of the encoder = 0.2Hz), Angular Position Not Normalized to 2 7 r ............................. 32 Kalman Filter Estimates of Angular Velocity (Sampling Frequency of the encoder = 0.2 H z ) ........................................................................................................

69

70

X ll

L ist o f Sym bols
a a a
A Inverse of Tim e Constant Semi-M ajor Axis E quatorial Radius of E arth E rror Space State M atrix A rea Projected Normal to the Sun M agnetic Field E rror Space Feedback M atrix Desired Magnetic Field Along Each Axis of Coils O rientation M atrix Drag Coefficient Eccentricity S tate Error Vector S tate Error Vector Directly After State M easurement (Kalm an Filter) S tate Error Vector Directly Before State M easurement (K alm an Filter) Kinetic Energy System M atrix Aerodynamic Force Solar R adiation Force

Aps
B B Bdes C

Cd
e e ej

E
F Fa Fa

9n^ Gaussian Coefficients gum^ j^nm gchm idt Normalized Gaussian Coefficients
g Net Torque Acting on W heel Plus Platform Friction Model Param eters Net Torque Acting on Wheel Input M atrix Transfer Function Angular M omentum M easurement M atrix C urrent in Coils O rbital Inclination

go, Wo, b
g^ G

G{s)

h
H

ixyz i

xin

I

Ib Iw K Kk K Kd Ki Kp L
m n q= n

Inertia Inertia of Spacecraft W ithout Including Wheel Inertia of Reaction Wheel Spacecraft Reflectivity Kalman Filter Gain Robust Controller Gain PID Derivative Gain PID Integral Gain PID Proportional Gain Inductance Dipole Moment Satellite Axis of Rotation

Q i

q

Euler Param eters Nadir Vector Covariance Matrix Directly After Measurement (Kalman Filter) Covariance M atrix Directly Before Measurement (Kalman Filter) Covariance Matrix Directly After State Propagation Step (Kalman Filter) Legendre Polynomials Schmidt Normalized Legendre Polynomials Solar Pressure Covariance of process noise Distance from Center of E arth Reference Signal Vector from the Center of Mass to the Optical Center of Pressure Center of Pressure Vector Resistance Covariance of Process Noise Spacecraft Projected Area Time Time of Periapsis Passing

Pt P;
Pfc+i

· *n
Ps

pm

pnm

Qfe
r

r r Tcp

R
R -fc

S t

XIV

u

Input Vector PID Input P otential Function Voltage Spacecraft Velocity Process Noise Vector System Noise M atrix State Vector

u V V
V W fc W X

K alm an Filter State E stim ation Directly After M easurement Xj^ K alm an Filter State Estim ation Directly Before M easurem ent Xfc+i S tate a t Each Discrete Tim e Step X fc S tate a t Previous Tim e Step y z z Z fc Zfc O u tput Vector E rror Space S tate Vector S tate M easurement (Kalm an Filter) Discrete State M easurement (Kalm an Filter) Discrete E rror State M easurement (Kalm an Filter)

XV

a i, 0.2 /? < 5
Q e yl'k

Reference Signal Param eters Rate Sensor Bias Kronecker Delta Function Noise Term Co elevation Angular Position Error Space Input Vector Measurement Noise Vector Error Space State Vector Atmospheric Density Aerodynamic Torque Disturbance Torque External Torque Gravity Gradient Torque Magnetic Torque Solar Radiation Torque State Transition Matrix Satellite Angle of Rotation East Longitude from Greenwich Angular Velocity Frequency of a sine wave Argument of the Periapsis Argument of the Ascending Node Orbital Rate Angular Velocity of Reaction Wheel

e
p Ta Tdist Text
Ta

Tmag Ts < f>

0
U)

Ü J
U)

n

W o
U]V

XVI

1

In tr o d u c tio n

T he use of small and microsatellites for E arth observation, communications, navigation and science missions is increasing. It is generally accepted th a t small satellites have a mass less th a n 1000 kg, anything below 250 kg is considered a microsatellite and anything less th an 10 kg, a nanosatellite. Advancing technology in domains such as electronics, com puter systems, and m aterial science have made small satellites a viable option for space based solutions. T he smaller platforms offer advantages such as shorter design periods and lower mass to reach orbit, leading to, in many situations, significantly lower costs [5]. There are several programmes in flight and many planned th a t have utilized small satellite designs to complete their mission objectives. The European Galileo Program m e, for example, will be implementing a global navigation system, similar to the American GPS, which will use a constellation of thirty small satellites (mass of approxim ately 670 kg). O rstead is a satellite with launch mass of 62 kg th a t was put into orbit February 23, 1999. T his small satellite carried a payload th at precisely m apped the magnetic held of the E arth, m easured the charged particle environment and collected Global Positioning System (GPS) occultation d a ta [26]. These relatively small satellites require unique m iniaturized onboard systems, such as propub sion, electric and computer systems th a t have reduced mass, reduced volume and dem and m inim al power consum ption when compared to their predecessors. T he a ttitu d e and orbit determ ination and control system (ACS) is of particular interest as it can be the limiting factor to the applicability of small satellites to certain missions. Small satellites ten d to use passive attitude control devices to minimize mass and power consum ption as well as increase simplicity of design which lowers cost. Rigid booms, for example, are used to achieve gravity gradient stabilization [10]. Passive attitu d e control often lacks the pointing accuracy required for m any project objectives. The development of rehable m iniaturized electronics and low cost com putational capabilities has led to the movement towards using active stabilization onboard microsatellites. T his allows for higher pointing accuracy which in tu rn increases the range of missions th a t can be fulfilled using

small satellites. Active control can be achieved by using magnetic torquers which interact w ith the E arth 's magnetic field to create and control torque. These actuators have low mass, require low power consumption and are reliable due to their simplicity of design. Active magnetic control has been proposed for satellites ranging in mass from 40 to 200 kg in low E arth orbits with minimum inclinations of 28.5°[10]. Although active magnetic control is possible on its own, generally magnetic torquers are used in combination with reaction or momentum wheels to increase reliability and pointing accuracy. The momentum wheel and magnetic torquer configuration was used onboard the Canadian satellite, MOST (Microvariability and Oscillation of Stars), which was launched in June, ' 2003 and has now completed over a year of its mission successfully. MOST was designed to monitor tiny light variations th at are undetectable from E arth in stars and extra-solar planets. A similar actuator configuration was also used on Odin, a Swedish satellite which - : was launched February 20, 2001 for observations of the E arth's atmosphere and astronomy. ;As of early 2003, Odin had completed its two year design-goal lifetime successfully [24]. y w; Another example is ChipSat, the Cosmic Hot Interstellar Plasm a Spectrometer, which was launched January 13, 2003 and utilized four momentum wheels and three coils torquers to maintain its desired orientation. Accurate satellite pointing can only be carried out if the orientation of the satellite and any error th at may be present are known. A variety of sensors have been developed for use on satellites to enable the determination of satellite orientation. Satellites can be equipped ' with sun sensors, which determine the satellites position by measuring the angle at which  the sunlight hits their photosensitive surfaces, E arth horizon sensors th at use the therm al differences between the E arth (hot) and space (cold) to determine the orientation of the satellite, as well as magnetometers th at measure the magnetic field and compare it to an ' onboard model to determine orientation and orbit. The magnetometer is lightweight, compact, reliable and robust, making it an ideal choice for microsatellites. It has been shown th a t satellites equipped with magnetic control algorithms can converge to a stable state with initial errors of hundreds of kilometers and unknown

a ttitu d e as quickly as a couple of orbits [13]. The m agnetom eter is dependent on an accurate m odel of the E a rth 's magnetic field and measurements can be affected by m agnetic storm s and surrounding electronic and metallic equipment. Even so, there are studies th a t have shown accuracies in positioning within 1-2 km and 0.25 degrees using only m agnetom eter d a ta [13]. Many satellites have taken advantage of the E a rth 's magnetic field for a ttitu d e determ ination. Two Czech missions, APEX and Active, had components (or subsatellites) Magion-2 and Magion-3 respectively, th at used m agnetom eters as the sole source of a ttitu d e information. These satellites showed an orientation determ ination accuracy of 5° [6]. To increase and ensure accuracy, satellites are generally equipped w ith a variety of sensors. T he increased am ount of input d a ta to the systems flight code can prove to be a challenge to process. Multiple sensors are often reading the same information with variable degrees of accuracy and the flight code must be able to compute an estim ate th a t is based on all the information. Moreover, sensors can be susceptible to external perturbations, such as abnorm al fluctuations in the electrical equipment or solar flares, and certain sensors cannot ou tp ut information throughout the entire mission; for example, sun sensors cannot provide measurements during eclipse periods. Hence, the flight code m ust be able to handle redundant, possibly erroneous, missing and noisy d ata while still providing an accurate estim ate of the spacecraft attitude and orbit. One algorithm th a t is used regularly among satellite control system designers to estim ate the system properties is the Kalman filter. The Kalman filter was first developed in 1960 by R.E. Kalman as a way to handle problems th a t involve the separation of random signals from random noise and the detection of signals of known form in the presence of random signals [15]. T his filter uses a dynamical model for the time development of the system and a model of the sensor m easurements to obtain the most accurate estim ate possible of the system states using a linear estim ation based on present and past measurements [15]. The K alm an filter was initially used in linear estim ation, b u t was soon adapted for nonlinear orbital guidance and navigation problems, showing impressive results as early as 1967 [17].

1.1

S cop e

The work described in this thesis involves testing of hardware and software components two different small satellite systems. First, a magnetometer for a microsatellite project, QuickSat, was tested, and then a Kalman filter was developed to be used in a small satellite test facility, RACE.

1.1.1

QuickSat

In 1998, the Canadian Space Agency began the development of a small satellite engineer ing model called QuickSat. The QuickSat project was a precursor to C anada's small and microsatellite program, which was established to provide a low cost means for Canadian industries to put their technology in space, as well as to build the skills necessary for small satellite development within the Canadian workforce [21]. To take advantage of the expe rience gained while developing MOST, and to benefit from well proven technologies, it was ' decided that QuickSat would be equipped with an attitude and control system th a t is com prised of a magnetometer, sun sensors, horizon sensors, a momentum wheel and magnetic torquers. The primary payload of QuickSat is an amateur relay between earthbound HAM radio operators and the International Space Station. A secondary module was developed to support variable payloads of mass up to 25 kg. This will allow QuickSat to be functional for a variety of tasks and missions. The research and development of QuickSat has thus far improved internal expertise in many disciplines and domains, such as electronics, flight code, and attitude control.

1.1.2

M agnetom eter T esting

As part of the thesis work, the magnetometer th at will be flown aboard QuickSat was tested. This was done by using a test bed at the Canadian Space Agency, in conjunction w ith the QuickSat simulation for hardware in the loop testing.

Figure 1: QuickSat Model

C haracterization of the coils was carried out to determine the axis linearity and independence. T he transfer function was determined experimentally for each axis by determ ining each time constant simultaneously, so th a t accurate modeling could be completed and proper control param eters could be chosen. A robust controller was applied to the Helmholtz coils to ensure th a t the desired m agnetic fields could be created. The controller was tested, and it was shown th a t the coils could produce a m agnetic field equivalent to one a m agnetom eter would observe in orbit. Once control of the test bed was achieved, the second m agnetom eter, the flight-rated in strum ent, was added to the set-up. Static measurements --the m agnetic field was held constant-- were taken to calibrate the magnetometer. Following determ ination of the proper m agnetom eter gain, the m agnetom eter was then integrated into the hardw are in the loop sim ulation, first just taking measurements, and then fully integrated to drive the a ttitu d e control system w ithin the QuickSat flight code. Finally, the QuickSat flight code was altered to test a B-dot controller during hardw are in the loop simulations. Several different free tumbling rates -- considered as the initial conditions of the sim ulation -- were tested.

1.1.3

RACE

The Ryerson Satellite A ttitude and Control Experiment, RACE, is a mock satellite system used by undergraduate and graduate students for research in dynamics and control. RACE sits on a near frictionless air bearing and is free to rotate in one dimension.

Figure 2: Ryerson Satellite Attitude Control Experiment (RACE) [16]

RACE is capable of running in two configurations, as a rigid structure, or

e ls

a rigid structure

with the possibility of one to four flexible appendages -- designed to simulate the solar panels present on most microsatellites. For the purposes of this study, RACE will only be considered in the rigid structure configuration. RACE is battery operated making the system capable of running as an independent unit. The computer-based control system collects d a ta and controls angular position and rate. To enhance the facility's capabilities, making it further resemble an actual microsatellite system, a Kalman filter was designed and implemented.

1.1.4

R A C E T esting

A simulation of the RACE test equipment was completed and a Kalman filter was imple mented showing the theoretical capability of the system to handle inconsistent and erroneous data. Initial hardware testing was carried out, including testing of the onboard sensors, test ing of the controller and testing of the Kalman filter while RACE was spinning freely and while false initial conditions were applied.

2
2.1

D eta iled System D escriptions
Q u ick S a t

QuickSat is a microsatellite, which contrary to most satellite designs was not constructed around its payload, but was intended to be a generic satellite capable of handling various payloads. It is designed to have a mass of less than 80 kg, while supporting a payload of up to 30 kg.

2 .1 .1

Q uick Sat M a g n eto m eter

QuickSat is three-axis stabilized using sun sensors (six coarse resolution and two m edium resolution), earth horizon sensors (two), a m agnetom eter, a m omentum wheel and three m agnetorquers. T he m agnetom eter, the instrum ent of interest in this study, to be used onboard Q uicksat is a Billingsley TFM100G2, which is can measure magnetic fields in the range of -1 Gauss to 4-1 Gauss. It is a m iniature tri-axial m agnetometer, which consists of three magnetic sensors operating independently and simultaneously. Each of the three sensors has an analog o u tp u t relative to the magnetic field present along its axis. The m agnetom eter has a mass of 100g and dimensions of 3.51 cm x 3.23cm x 8.26cm. It has low mass and is compact, ideal for use onboard a microsatellite. Refer to Figure 3. One of the objectives of this study was to test this m agnetom eter to determ ine its capabilities onboard QuickSat. To elim inate the need for overly complicated robotics, or moving parts of any kind, a com bination of Helmholtz coils was used. A Helmholtz coil is an electric wire w rapped around two identical rings separated co-axially by a constant distance equivalent to its radius. T his configuration can produce a homogenous m agnetic field at its geometric center, where the m agnetom eter will be placed for testing. This type of apparatus has been widely used for testing m agnetom eters, and these cages are commercially available.

Figure 3: Magnetometers Used for QuickSat (above:Billingsly, below:Barington)

The Helmholtz Cage output was monitored by a separate non-space rated magnetometer, a Barington MAG-03MS. This magnetometer has a detectable range of ±1 G and an orthogonal error of ± 0.1 ° (as specified by the manufacturer).

2.2

D escrip tio n o f th e H elm h o ltz C age

The coils were designed and constructed at the Canadian Space Agency in 1999 by Steve Marchetti [18] to create a magnetic field of ±1G while taking into account the E arth 's magnetic field at the location of the test bed. This value was chosen because it is equivalent to the measurement range of the magnetometer. Three pairs of Helmholtz coils were erected at 90° to each other to be able to control the magnetic field on three axes. Traditional Helmholtz Coils consists of two identical circular rings of coils; however, it was decided to simplify the construction of the system by building
8

Figure 4: Helmholtz Coil Configuration

identical square rings. This simplification in construction did not compromise th e homo geneity of the magnetic field at the geometric center of the coils, the area of interest for testing. All th e item s used to construct the coils were made of non-magnetic m aterial to elim inate interference caused by the structure during testing. The frame was assembled using dried hardw ood, w ith wooden dowels at the corners and glue to hold everything together. T he wire was chosen to produce the maximum m agnetic field with 1 A of current,, thereby lim iting excess heat creation and allowing the use of a common off the shelf power supply. The coils were w rapped in two layers, which was found to provide enough strength in m agnetic field w ithout reducing the size of the homogenous field at the center of the coils. Properties of the coils can be found in Table 1. The design and construction of the Helmholtz cage was completed in 1999, and initial testing

Coil Pair 1 2 3

Length of Wire [cm] 362 376 390

Wire Weight [kg] 1.35 1.40 1.46

Resistance [H] 7.73 8.03 8.33

Table 1; Helmholtz Coil Characteristics

on the system began in 2000.

2.3

S u p p ort S tru ctu re

A secure system for suspending both the magnetometers in the geometric center of the coils was designed and constructed as one was not previously available. This device was made of wood and plastic so th at the surrounding electric current and magnetic fields would not be altered. The structure ensures that if dismantling of the system were necessary, the two magnetometers could be returned to the same position relative to each other and the coils during reassembly so th at minimal calibration would be necessary to restart testing. Refer to Figure 5.

2.4

H ardw are and Softw are C om p on en ts

Many hardware and software components were necessary for hardware in the loop testing, to control the Helmholtz Cage and access information from the magnetometers. These include a simulation created in Simulink, two computer workstations, both running versions of the same simulation, and data transfer hardware.

2.4.1

Sim ulation

During the QuickSat design phase, a simulation analysing the orbiting satellite was developed in MatLab Simulink by a team of engineers and software experts. This simulation was already 10

Figure 5: The Support Structure Holding the M agnetometers in the Centre of the Coil Configuration

in place and undergoing validation when coil testing began, and was utilized for the hardware in the loop experiments. The magnetic field th a t the satellite would experience was one of th e m any calculated values in the simulation, and this d a ta was used as the desired m agnetic field th a t needed to be created by the coils. The sim ulation was capable of communicating with hardware components in real time. A software package, RT Lab was used for real tim e simulations in conjunction w ith the Simulink package. The simulation was able to send information to the power sources driving the Helmholtz coils, as well as receive information from the m agnetometers.

2 .4 .2

W in d o w s N T sta tio n

T he W indows NT w orkstation was the user interface for the Helmholtz coils. Experimental d a ta was analyzed and logic was initiated on this workstation. The models and control algorithm s were built in M atLab Simulink, and the simulation was sent to the Opal-RT software to be compiled and run in real time.

11

2.4.3

Q N X S tation

A second station was used that had a QNX real-time operating system. This type of software allows the simulation to react to inputs in real time and thus simulate the events as they would actually occur. Control over the simulation (start, stop etc.) lies on the Windows platform; however, the real-time simulation itself was running independently of user interface simulation. D ata was passed back to the Windows station during simulation so th at the user could assess the information qualitatively through graphs, counters and numerical displays during the tests. However, the real time data was stored on the QNX station and was retrieved for analysis after the test was completed. The power supplies powering each axis of the Helmholtz cage received their instructions from the real time simulation running on the QNX system.

2.4.4

D a ta A cqu isition and C ontrol o f Coils

Each coil pair was powered with an HP6612C System DC power supply with a maximum output of 2A. The polarity of the power supplies was controlled with an external mechanical relay circuit. A general purpose interface bus (GPIB) was used to supply the coil power sources with commands. An A T-GPIB/TNT fits into the ISA slot of any standard personal computer and has a 20 ms delay which was deemed to have negligible effect on the results of the tests. It also has a digital output line, which is used to trigger the mechanical relay th at controls the polarity of the coil power sources. A PCI-MIO-16XE-10 data acquisition card (DAQ) was used to read the magnetometer sig nals, and send these values back to the QNX system for simulation purposes and then to the user interface for qualitative examining of the data during the tests. Refer to Figure 6 for a summary of all the test bed components.

12

station

Helmhottz

Figure 6: The Hardware in the loop System

2 .5

R A C E C o m p o n e n ts

RACE was m ade of several hardware and software components as well. T here were two distinct com puters, the user interface and the internal computer. Both system s run on W indows operating systems and had wireless communication available during experiments. T he RACE sensors and actuators were controlled by the internal computer.

2 .5 .1

R A C E Sensors

T here were two sensors used on board RACE, an optical sensor and a rate sensor. T he optical sensor m easured the angular position of RACE relative to the stationary base. T he statio n ary disk on the base was split into 2048 sections, and the rotating device was able to determ ine the position by reading the sections on the disk. Hence, position could be determ ined to an accuracy of 0.175°. The angular velocity could also be determ ined using th is base encoder by measuring the number of sections covered in a tim e step. 13

The angular rate was also determined with the on-board rate sensor. The sensor has many features, such as the lack of hysteresis, low power consumption and light weight. The manu facturer has stated th at it has a bias over a tem perature range (6 deg/secp p and a room tem perature drift of 0.01 ° which was taken into consideration in modeling and in apphcation with the hardware.

2.5.2

A ctuators

A ttitude control was achieved with two different torquing systems onboard, a reaction wheel and an air thruster, which was used to emulate a magnetorquer or similar device. The reaction wheel was the main actuator, while the air thruster was used mainly for momentum dumping when the reaction wheel saturated, although it could also aid in small adjustm ents of orientation. The reaction wheel,with an inertia of 7^, = 0.00321 kg-m^ (compared with a maximum plat form inertia of 7g = 3.5 kg-m^) could apply a peak stall torque of 2.259 N-m, and a continuous stall torque of 0.670 N-m. The air thruster could produce a maximum torque of 0.0025 N-m.

14

3
3 .1

M odeling
Q u ic k S a t M o d e lin g

T he model of the Quicksat system was in place and was undergoing validation when mag netom eter testing began. T he QuickSat system was modeled by separating the mission into different modes, corre sponding to the different stages after orbital insertion. Mode 10 corresponds to the de-tumble phase which occurs directly after the satellite is released from the launcher. In order to exit Mode 10, the satellite m ust be rotating on all axes at a rate less th an 1 °/s. Mode 20 is for coarse sun pointing which entails bringing the y-axis of the spacecraft to w ithin 5° of the sun. Mode 30 was the deployment of the solar arrays. During Mode 40 th e m om entum wheel begins to spin up. Orbit normal acquisition occurs in Mode 50, nadir acquisition in Mode 60 and finally Mode 70 is fine sun pointing. D uring Mode 10, the de-tum ble phase, the satellite utilizes the E a rth 's magnetic field to dissipate m om entum and slow the satellite down to a controllable state. It is during this phase th a t the magnetic field relative to the m agnetom eter is changing at the quickest rate. Due to these qualities, a significant portion of the testing of the m agnetom eter occurred in M ode 10. T hroughout the simulation, however, regardless of the system mode, the same dynamics, kinem atics, external torques etc. are applicable. The m ain difference between the modes is in th e control algorithm s, which are not discussed in this text.

3 .1 .1

S y s te m D y n a m ics

T he rate of change taken relative to the rotating satellite body frame of total angular mo m entum , h, is,

15

(fh

XI-

( 1)

where,

is the skew symmetric m atrix of the angular velocities, defined as

0

--UJ^ 0 Ui

U)2 --U)\ 0

=

0^3 --6^2

(2)

where w is the angular velocity of the spacecraft. The external torques, Text, take into consideration the disturbance torques, Tdist, and the torque from the magnetic thrusters,Tmap-

" ^ext -- '^dist T

m ag

(3)

The angular velocity was calculated as the product of inverse of the inertia m atrix. I, and angular momentum

(4)
3.1.2 S p a c e c ra ft K in e m a tic s

The kinematics of the system were represented using Euler parameters, q\ and q. The pa rameters are defined in terms of the axis of rotation, n and the angle of rotation, 0,

Q i = cos I
q = n sin I Therefore, the rotation of the spacecraft in term s of Euler Param eters is
(5)

16

q=

Qi

q

_ 1 ' 0 ~ 2 U)



Qi

-w X

q

(6 )

T he ro tatio n m atrix th a t defines the orientation of the satellite in the E arth Centered Inertial fram e can be found from the quaternion,

C = ( l - 2 q ^q ) Ï 3 X3 + 2 q q ^ - 2 giq*

( 7)

where the skew symmetric for the vector portion of the quaternion is equivalent to th a t defined above for angular velocity, and 1 3 * 3 is the identity m atrix.

I3x3 =

1 0 0 0 1 0 0 0 1

(8 )

3 .1 .3

A c tu a to r s

The two types of actuators onboard Quicksat are the magnetic torquers and th e m omentum wheel. T he reaction torque, T^ag, of the magnetic torquers is defined by

' m ag

m

X

B

(9)

where, B , is the m agnetic field acting on the spacecraft, and m is the dipole moment, which is a function of the current passing through the torquer. The am ount of current is determ ined by th e control system based on the desired result. T here are two components of the torque produced by the reaction wheel, the com m and torque and the wheel friction. The command torque is a function of the input com m and th a t was determ ined from test data. The friction is modeled as a sym m etric viscous friction m odel for simplicity, even though testing has shown th a t it is slightly asymmetric. 17

3.1.4

D istu rb ance Torques

There are several types of disturbance torques th at can affect the attitude and orbit of the spacecraft. Included in the modeling of QuickSat were the Aerodynamic, Gravity Gradient and Solar torques.

A erodynam ic Torque The aerodynamic torque, To, acting on the spacecraft is caused by the upper atmosphere and is due to the offset between the center of pressure of the spacecraft and the center of mass [11].

Ta=TcpX Fa

(10)

where, r^^, is the center of pressure in the body coordinates and the aerodynamic force vector. Fa, is

f

. = (5 ) p |v P s C d | ^

(11)

where, p is the atmospheric density [27], |F | is the scalar value of the velocity, Cd , the drag space coefficient, S is the spacecraft projected area, and a unit vector in the direction of the velocity of the spacecraft.

G ravity G radient Torque

The gravity gradient torque is a result of the differential

attraction of the two sides (the "lower" and "upper" sides relative to the body the object is orbiting) of an orbiting object having unequal principal moments of inertia. This torque will tend to rotate the object to align its minimum inertia axis with the local vertical [11]. The torque caused by the gravity gradient for a near circular orbit is.

TG = 3Wof x l r

(12)

18

where, r is the nadir vector, a unit vector pointing from the planet to the spacecraft, u)p is th e orbital rate, and I is the moment of inertia of the craft.

S o la r R a d ia ti o n T o rq u e Solar radiation pressure applies a force per unit area over the satellite in the anti-solar direction. Changes in all orbital elements are possible due to this solar radiation. T he solar torque, Tg, can be modeled as follows

Ts

= r

X

Fs

(13)

Here, r is the vector pointing from the body center of mass to the spacecraft optical center of pressure, and F g is a function of spacecraft reflectivity, K, the projected area norm al to the sun, Apg, and the solar pressure, Ps which is considered to be a constant value.

Fs = (1 + ^ ) p s ^ p s

(14)

As noted above, the solar torque is independent of the spacecraft position or velocity relative to th e E arth, as long as the vehicle is in the sunlight. In low earth orbit, the aerodynam ic and gravity gradients tend to be the prim ary disturbances acting on the spacecraft, although th e solar torque was included for completeness.

3 .1 .5

O rb ital M ech an ics

T he orbit was defined as a Kepler Orbit. The position and velocity of th e satellite was described using six orbital elements, {a, e, i, fi, u > , tp} The sem i-m ajor axis, a, and the eccentricity, e, describe the shape of an elliptical orbit, w ith e = 0 corresponding to a circular orbit.

19

The elements defining the orientation of the orbit are the inclination, i, the argument of the ascending node, fl, and the argument of the periapsis, u. The argument of the ascending node is defined as the angle from the x-axis of the E arth fixed reference frame to the ascending node of the line of nodes. The line of nodes is the line created from the points of intersection of the satellite orbit and the equatorial plane. The argument of the periapsis is the angle between the line of nodes, originating at the ascending node, and the periapsis. Refer to Figure 7 for a visual description of the orbital parameters.

/"Line of / Nodes

Periapsis

!

a

Figure 7: Definition of Orbital Parameters

The final of the orbital parameters, tp, is the time of a relevant periapsis passing and is used to establish the epoch.

3.1.6

M agnetic Field

The magnetic field was represented with a spherical harmonic model using the coefficients firom the International Geomagnetic Reference Field (IGRF). The E arth's magnetic field, B, 20

is defined as the gradient of a scalar potential function, V, which is represented as a series of spherical harmonics.

B = VV

(15)

k

n

F (r,

0) = a ^
n=l m=0

{g^!^ cos mcp + h ^ sin m({))

{6)

(16)

where a is th e equatorial radius of the E arth, defined as 6371.2 km for the IG RF, and are Gaussian coefficients, determ ined from m easurements of the E a rth 's m agnetic field and r, 6, and 0 are the distance from the E a rth 's centre, the coelevation, and the E ast Longitude from Greenwich; respectively. These last three variables can be combined to uniquely define any point in space relative to the E a rth 's centre. The first twelve empirically determ ined IG R F Gaussian coefficients from the 1995 d a ta set were used in this model (A : = 12). T he com ponents of the magnetic field are

dV A = ! ] ( ") dr ... n=l

( n + l ) ^ ( 5 " '"` cosm 0 + h"'"` s in m 0 ) P " '"` (0)
m =0

(17)

^ è
n= l m=0

cos m 0 +

sin m 0)

(18)

^

r

d(j)

n=l

m=0

where, g^'^ and h" -'^ are Schmidt normalized Gaussian coefficients, and P "'"* are Schmidt norm alized Legendre functions.

21

s'* 'TM=
/!" "* = S,, JiX
pm _ c p n ,m

( 20)

where the Schmidt Coefficient,

is defined as

(2 - O { n - m ) \ 5 ( 2 n - l ) ! ! (n --m)! (n + m)\ The Kronecker delta function, 5, is defined as

(21)

0 if )

(22)

The reason the coefficients and functions in this Magnetic Field Model must be normalized in this fashion is because the model itself assumes that the Legendre polynomials are normalized such th at

(23) Once the magnetic field is known in the r, 9, (j>frame of reference it can easily be transferred into any desired frame of reference for the model.

22

3 .2

R A C E M o d e lin g

System modeling of RACE was implemented in a M atLab Simulink model so th a t testing of the controller and the Kalman filter could be carried out before applying them to the hardw are.

3 .2 .1

D y n a m ic s

T he dynam ics of the RACE system for the rigid configuration can be viewed as a spinning platform plus wheel w ith the following equations of motion, where /g is the RACE moment of in ertia w ithout including the wheel and Iw is the moment of inertia of the wheel.

Ib + h v

I\V

Iw Iw



w



LO W

9 9w

(24)

u > is th e angular rate of the RACE platform, and u> \y the angular rate of the wheel, g is the net torque acting on the platform plus wheel and gyj is the net torque acting on the wheel
about its spin axis.

3 .2 .2

S ta te S p ace M o d el

A sta te space model was developed to better analyse and design the K alm an filter and control law for RACE. It was decided th a t the state vector, x, be composed of the angular position,

6, th e angular rate, w, and the rate sensor bias, /?.

(25) A sta te space model follows the form

23

X = F x + G u 4- W 77 y = Hx in terms of the system, F , input, G , measurement, H and system noise, W , matrices.

(26)

The rate of change of the angular position is equal to the angular velocity, thus the system m atrix is simply

0 1 0

F =

0 0 0 0 0 0

(27)

To define the angular rate, Equation 24 was rearranged and the values of inertia {Ib = 3.5kg-m^ and lu) = 0.00321 kg-m^) were included.

w

'

0.5286 -0.5286 -0.5286 345.3562

9 giv

(28)

Therefore the rate of change of angular velocity of the platform is

Û J = 0.5286 g - 0.5286 g^,
where g and are considered the inputs into the system, u feedback matrix, G, can be written in the form

(29) [ ^ Ptu ] · Therefore the

0 G = 0.5286 0 The sensor bias was modeled as 24

0 -0.5286 0 (30)

dt where 77 is a white noise term.

(31)

T his is the only term th a t contains a noise component, therefore the system noise m atrix is

0 W = 0 1 (32)

The only two measurement instrum ents onboard RACE are the base encoder for angular position and the rate sensor for the angular rate. The output from the rate sensor is a com bination of the sensor bias and the angular rate of RACE. Therefore the outp u t m atrix is

H =

1 0 0

0

1 1

(33)

Therefore assembling these definitions in a state space equation in term s the th e sta te vector, X, and the o utput vector, y, yields

' 0 X = _0

1 0 `
X+

0 0.5286 0 X

0 - 0 .5 2 8 6 0

' 0 '

0 0 0 0 0 _ 1 1 1 0 0

u+

0 _1

V
(34)

y =

0

However, when the Kalm an filter was designed for RACE, the error in the state variable was used, which required changes to the standard state equations. This was done because th e system the K alm an filter was designed for m easures error in angular position directly. To

25

facilitate the changes throughout the Kalman filter and state equation, the error in aU terms was taken as a new state vector.



e '



9 '

e=

X -- Xr =

w

--

w
desired

(35)

where the "desired" sensor bias was taken to be zero. Taking the derivative gives

e=

X -- Xr

(36)

In terms of state, feedback, measurement, and system noise matrices, the system becomes

è = Fx + Gu + W ?7 --Fxr ê --F (x --Xr) + Gu + W ?7
Simplifying gives the final error state equation

(37)

é = Fe + Gu + W ?7
And by defining the desired output vector as step in defining RACE in state space becomes.

(38)

= Hx^, the output equation and the final

y = He + Yr

(39)

26

3 .2 .3

M o m e n tu m W h eel

T he m om entum wheel used in RACE was modeled to produce a linear o utput relative to the in p u t w ith saturation limits of ± 6 N m. T he friction in the momentum wheel was modeled as a coulomb plus viscous model which uses three param eters to define the model, Q o, ujg, and b. As the system friction profile was not determ ined experimentally, this friction model was chosen for simplicity. Refer to Figure 8 for a definition of the model param eters and Table 2 for the param eters used.

-go -b u j 9fric{'-^) = \
g o -- b ijj

uj > Uo ~ ^o ^ ^ ^ W o
w < Wo

(40)

Friction Model

Figure 8: Friction Model T he coeflScients used were chosen in simulation to slow the m om entum wheel down to a stop 27

Coefficient

Value 1.95e-5 Nm le-6 rad/s 0.015kg · m ^/s

9o
W o

b

Table 2: Friction Coefficients

in approximately five minutes from an initial spinning rate of 15°/s. Refer to Figure 9 for the results of the friction model when applied to RACE.
Angular Velocity
0.3

0.25

0.2

I
0.15

1
>

ÎÔ

O )
<
0.05

-

0.05

50

100

150

200

250

300

350

Time [s]

400

450

500

Figure 9: Angluax Velocity of RACE Momentum Wheel in the presence of friction only with initial rate of rotation of 15°/s

28

3.2.4

R ate Sensor

A tru th model of the rate sensor was included in the simulation. W hite noise was added to th e m easurem ent, as well as bias drift due to tem perature variations, and th e analog to digital o u tp u t and gain to convert volts to radians per second were included for completeness. T he modeling accuracy of this instrum ent was vital for testing the K alm an filter.

29

4

Controller Design for QuickSat Project

There were three different tests th at were carried out using hardware in the loop simulations with the Helmholtz coils. The first was to test the Helmholtz cage to verify th at it was creating the necessary magnetic fields, the second was to test the flight qualified Billingsly magnetometer and the third was to test the control algorithm in the flight code in conjunction with the magnetometer. This required two controllers, one for the Helmholtz cage and one for the flight code. A robust controller that was designed to track second order reference signals was used to control the coils, and a B-dot controller was chosen for the QuickSat simulation.

4.1

R o b u st C ontroller

The Helmholtz Cage was modeled under the assumption that the threé coil axes behaved independently of each other and the external electronic disturbances were not accounted for. These two assumptions introduced uncertainty into the Helmholtz Cage model. Therefore, a robust controller was chosen for each axis of the Helmholtz cage because of its ability to maintain stability in linear systems in the presence of uncertainties. The robust controller that was chosen had been designed in an error space using a weighted error as the state. W ithin this error space, a feedback controller is used to drive the weighted error to zero in the presence of a non-decaying second order reference signal [8]. As it is a weighted error, small perturbations are quickly suppressed and the system remains stable. The following is a synopsis of the development of the controller that was implemented on the Helmholtz coils. The generic controller was designed by Gene Franklin; David Powell and Abbas Emani-Naeini as outlined in their text book Control for Dynamic Systems [8]. The system under consideration is represented in state space in terms of the state vector x, the input vector, u the noise vector rj and the output vector, y.

30

X = F x + G u + W t) y = Hx

.

where F is the system m atrix, G the input m atrix, H th e m easurem ent m atrix and W the system noise m atrix. T his controller was designed to follow a non-decaying reference signal, r, of th e form

r -4- a i T -f 0 : 2r = 0

(42)

W here, ot\ and « 2 were the coefficients th a t describe the p ath th a t the system m ust follow. T he following is the development of the generic form of the controller. The error in the system is defined in term s of the output as

e = y - r'

(43)

By replacing the reference signal with the error signal and o utput signals, the system defi nition becomes

ë -4- Q ié + 0!2e -- ÿ + a i ÿ -4- a z y or in term s of the state vector

ë -f Q!ié -f û 2 e = H x -4- o iH x + Q2 H x A new sta te vector, actu al sta te vector as

(44)

represents the states in the error space, and is given in term s of the

^ = X -t- O ix -f- o:2X 31

(45)

tmm mmiiTf im w

PROPfRTYOF

with a control input vector, fx, in error space

(46) Combining the above system definition and state vector in error space, the system under consideration becomes

ë + a ié + « 2 6 = The state equation in the error space is then defined as

(47)

^= A new variable, z = r e é -ir

X + o ix + a2X = , is

+ G/it

(48)

used to definethe error state space system.

z = A z + B/x where

(49)

0 A = 0

1 0

0 ` H F B =

' 0 ' 0 G (50)

--O i2 - a i

Applying a simple state feedback control law in the error space results in a controllable system in terms of gains, K.

e M= - [
a

2

Ko ]

è

= -Kz

(51)

32

T ranslating this control law back into term s of the system states results in the following robust control law.

^

(u + K ox) +
i=l

^

(u + K ox) = - J 2
i=l

(52)

In order to apply this controller to the Helmholtz cage, each axis was m odeled individually. Along each axis, the rate of change of magnetic field is a function of the input, in this case the electric current in the wires being applied to the system and the response capabilities of the coils (discussed in Section 5.3); therefore, the state space system collapses to the following equations,

y=x
W here the state variable, x, was the m agnetic field produced by éach axis, and a was the inverse of the tim e constant for the axis (refer to Section 5.3 for more inform ation regarding the tim e constant) and u was the input th a t will be determ ined by the controller. In th e case of th e Helmholtz Cage, each axis followed the commanded m agnetic field con trolled by the input current in the coils. A sine wave was used as the reference signal to design the controller. It was assumed th a t the magnetic field as felt by the m agnetom eter in orbit would be oscillating and periodic, therefore the Helmholtz cage would need to create a sim ilar field.

r = sin u)
Taking the second derivative

(54)

r= -- w^sinw

(55)

33

 Therefore, a sine wave can be written in the differential form as

(56)
where w is the frequency of the sine wave and Oi = 0 and a 2 --



Referring to Equations 41 and 53, it can be noted th at H = [a], F = [1] and G = [1] . Therefore each axis of the Helmholtz Cage is defined in this error space as (Equation 49)

z=

' 0' -- uP ' 0 a z -h 0 _1 0 1_ 0 0 1 0'

(57)

From this error space definition, the controller (Equation 52) for the Helmholtz cage can be w ritten as

Ü + K q x + cu^(u + K ()x) -- --K \G -- TTgG

(58)

for each axis of the Helmholtz Cage. The robust controller for the Helmholtz Cage axes is ; summarized in Figure 10

4.2

B -d o t C on trol Law

A B-dot controller is a common attitude control method on satellites. This type of controller was implemented into the QuickSat simulation and will become part of the satellite flight software. B-dot control is used to stabilize the satellite after separation from the launching system by using the measured magnetic field as rate feedback. This control law will help to dissipate the kinetic energy, E, present during free tumbling and bring the spacecraft into a controllable state.

34

e'

1 O ï - o -

U

Figure 10: Robust Controller Block Diagram

T he rate of change of kinetic energy of the system in the body-centered frame was

E = (jJ -T,mag

(59)

In this case, w was the angular velocity of the satellite and the torque, Tm ag> was provided by the m agnetic torquers and was defined as

35

T m a g

= m XB B was

(60) the E arth 's magnetic field. the above could be

where m was the net internal magnetic moment and Combining these two and utilizing the identity a rew ritten as

(b x c) = c - {ax b),

È -- · (m X B) È ---- w · (B X m ) È = -- m - (w X B)
The dipole moment was chosen in terms of gain, K , i.e.,

(61)

m = K (w X B ) Thus the kinetic energy equation became

(62)

= --(u? X B) · K (a;

X

B)

(63)

The result of this equation will be negative so long as K is non-negative definite, which means there will be a continual energy loss. W hen a spacecraft is tumbling, the change in magnetic field, observed by the sensors onboard, is primarily due to the rotation of the spacecraft, rather than its position in the orbit. The observed rate of change with respect to the rotating satellite frame of magnetic field could be w ritten as

B A ! -w X B Therefore, the magnetic moment th at will be applied by the control law is 36

(64)

m= -- KB

(65)

37

5

Testing of H elm holtz Cage

Several tests were done on the Helmholtz cage to determine characteristics and properties of the system in order to select appropriate parameters for the Helmholtz cage controller. First, the magnetometer calibration factors were tested by comparing the magnetometer output values against each other and a teslameter. Then the cage itself was characterized, determining how each axis behaved with respect to input current and under the influence of each other. Finally, the transfer function for each axis was determined experimentally.

5.1

V erification o f M a g n eto m eter M easu rem en ts

The first step was to confirm the magnetometer calibration factors specified by the m anu facturer. Values of the E arth 's magnetic field read from a teslameter were compared to the values determined by the magnetometers. Several static measurements were taken along the axes of the Barington and Billingsley magnetometers, the averages from the Barington magnetomter and the teslameter can be found in Table 3. Axis X-Axis Y-Axis Z-Axis Static Magnetic Field [G] 0.1192 -0.125 -0.4561 Barington Measurements [G] 0.1100 -0.123 0.4540 Percent Error [%] 7 1.6 <1

Table 3: Static Magnetic Field Measurements At Center of Helmholtz Cage

The Barington magnetometer was found to read within 10 % of the E arth's magnetic field on all axes. It was concluded th at the calibration factor given in the users manual (lO V /G ) was acceptable. However, the Billinglsy manufacturer specified calibration factor did not show consistent 38

values w ith the teslam eter and the Barington instrument. Therefore, a calibration factor was experimentally determined to be 15.84 V /G . Axis X-Axis Y-Axis Z-Axis Magnetic Field [G] 0.1192 -0.125 -0.4561 Billingsley Measurements [V] 1.79 -1.94 -7.75 Table 4; Billingsley Scaling Factor Scaling Factor [V/G] 15.01 15.52 16.99

5 .2

A x is L in ea rity and C o u p lin g

It was necessary to determine the linearity between the input current and the output mag netic held (in term s of voltage). This same test was used to determine whether the three axes behaved independently of each other. The current along each axis was increased incrementally, while the output voltage for each of the three axes was observed. The test was repeated while decreasing current as well to determ ine if there was a hysteresis effect in the system. This m ethod tested only the static m easurem ents of the coils, and was not dependent on dynamic capabilities of the coils. Note th a t these tests need to be repeated if the coils are moved as proper functioning of the coil system is dependent on the local magnetic field. Refer to Figures 11 to 13 for the results of each axis. A linear least-squares regression and an R ^ value was calculated for each axis to determine the correlating factor between the current and voltage or the coil output gain. R is defined as th e statistical measure of how well a regression line approximates real d a ta points, an R value of 1 (100%) indicates a perfect fit.

39

F? =

1 - X^(ï/i - Vi f 1=1
' n

(66 )

n
' ^ y f i =l

i =l

n

where % is the d ata point and yi is the regression line d ata point. Refer to Table 5 for the numerical results of the gains found during these tests. Input Current in X-Axis O utput Axis X Y Z X Y Z X Y Z Coil Gain [V/A] 13.198 -0.5373 0.0521 Input Current in Y-Axis 0.5803 12.306 -0.0169 Input Current in Z-Axis -0.1214 0.0486 12.696 0.9787 0.4899 1 Values 0.9982 0.9998 0.1003 1 0.9929 0.5943

Table 5: Values of Coil Gains and Their Associated

The axis linearity tests showed that the linear relationship between output and input was stable and consistent, and no hysteresis was present in the system, which made the coils easy to control with reliable results. However, it also demonstrated th at the coils do not behave entirely independently. Figure 11 and Figure 12 demonstrate th at the X and Y Axes are coupled.
40

rnn
O V O Z

o o o o

° ° B ° o o o o o o

Q

o

o

a

a

û

o

û

o

û

D

e

o

o

a

-1

-O J

-0 6

-0 4

-0 2

0

05

0.4

0.6

0.6

1

biputC urrer«[l)

Figure 11; Relationship between Input Current Along X-Axis and O utput Voltage of Mag netom eter
Uneartty T e s ts wtth Y - A xis Input

o

o

o

g

o

o

o

o

a

o

a

a

a

a

o

o

-1

-o.a

-o .e

-0 4

-0 .2 o 05 Input C u rer# [I]

o.4

o.e

0 .6

1

Figure 12: Relationship between Input Current Along Y-Axis and O utput Voltage of Mag netom eter

T he gains were used to construct a driving matrix, Equation 67, which was used for the open loop control of the coils. This m atrix took the inverse of the relationship between input current and output voltage (equivalently magnetic field), so th a t given the desired m agnetic field in Gauss and the appropriate current in Amperes to achieve the necessary 41

Uneailly T ests with z - Axis Input

o o o o o o o o o o o o o o o

-t

-O J

-0.S

-0 .4

-0 .2 0 02 Input C u rren t in

0.4

0.8

0.6

1

Figure 13: Relationship between Input Current Along Z-Axis and O utput Voltage of Mag netometer

field could be calculated.

ix iy iz

=
_

0.0330 -0.0356 0.8111 0 0

0.7562

0 0 0.7876

B d ts ,X B d e s ,Y _ B d e s ,Z --

0.0820 -0.1092 -0.3611 _

(67)

To check the validity of this driving matrix, it was implemented in the hardware in the loop simulation as an open loop controller. A step input was applied to each axis to view the response of all three axes, and through multiple tests, it was determined th a t though the axes appeared to be coupled, they behaved best when they were controlled independently, and thus the driving m atrix was reduced to a diagonal matrix. W ith such a controller all three axes responded with a maximum of 5% steady state error, and with a consistent 0.25 second delay. As the simulation was run at 4 Hz, which is the maximum capability of the hardware/software combination, it is valid to assume th a t this apparent delay is software based, rather than a limitation in the Helmholtz cage itself. Refer to Figure 14 to Figure 16 for the step response of each axis.

42

step Response

0.4

0.1

-

0.1 45

45.5

46

46.5

47

47.5

48

48.5

49

49.5

50

Time Is]

Figure 14: Response Along the X-Axis to a Step Input

Step R esponse

03

0.4

*X

0 .2

0.1

-

0.1 43

43.5

44.5

46.5

46

47

47.6

48

Time (s)

Figure 15: Response Along the Y-Axis to a Step Input

43

step Response
Actual Response Desire Response

O A

I
I s

S.

I

-

0.1 43

43.5

45

45.5

46

46.5

47

47.5

Time [s]

Figure 16: Response Along the Z-Axis to a Step Input

5.3

Transfer F u n ction

Determining the transfer function of the coils is im portant in order to be able to determine the proper parameters for the controller. Based on the results from Section 5.2 it was decided to apply a control law for each axis individually. Therefore, the transfer function was determined experimentally for each axis independently. Each axis of the Helmholtz cage obeys the following

V =L

di dt

(68)

where i is input current, V is output voltage and the coils themselves behave as the inductor, L. Given th a t this is a first order equation, the transfer function for this first-order system can be written as

G[ s ) =
44

s

a

(69)

where a is the inverse of the time constant, a =

To determine the tim e constant, which is

the tim e equivalent for the response to reach 67.3 % of its final value, the circuit in Figure 17 was constructed. A resistor of value 100 Q was added in series with the axis of the Helmholtz cage under consideration. A square waveform (equivalent to a step input) was introduced into th e system and the voltage measured across the coils was analyzed on an oscilloscope. T he tim e constants of each axis can be found in Table 6.

Figure 17: Circuit for determining the Time C onstant of the coils

Axis X - Axis Y - Axis Z - Axis

Time Constant \p,s] 0.1589 0.1572 0.1605

Table 6; Time Constants for the Coil System

45

6

QuickSat Hardware in the Loop Sim ulation

Two types of tests were carried out with the QuickSat system. There were those th a t were for testing the Helmholtz Cage itself, to verify its ability to test the magnetometer. The second type of hardware in the loop simulations was to test the flight qualified magnetometer.

6.1

H elm h o ltz C age C on troller Im p lem en ta tio n

Application of a robust controller to the Helmholtz cage was a straightforward process. Each axis was controlled separately and thus three controllers were designed, all having the same structure described in Section 4.1. It was determined in simulation th at each axis must be able to create a field th a t could change at a maximum of 6.3 °/s (= 0.1 rad/s) and so the frequency of the sine wave chosen for the reference signal was w = 0.1 rad/s. The gains of the controller were chosen initially using pole placement and were fine tuned in simulation. The gains were chosen in an effort to limit steady state error, as well as minimize the settling time. Table 7 shows the robust controller gains chosen for each axis. \ Ko Kl K2 X-Axis -1.7933 1.0313 0.4695 Y-Axis -1.7305 1.0416 0.4743 Z-Axis -1.7305 1.0416 0.4743

Table 7: Robust Controller Gains for Helmholtz Cage

Once the two magnetometers were in place, a hardware in the loop test was run to test the abilities of the system -- both the ability of the coils to create the desired field and the ability of the Billingsly magnetometer to follow the created field. 46

Refer to Figures 18 and 19 for the results of the Helmholtz Cage controller w ith the sine wave input.
Barington R esults to a Sine W ave Input
0.5 0.4 0.3 0.2

-

0.2

-

0.3 0.4 0.5

-

-

0

50

100

150

200

250

300

Tlme[s]

Figure 18: Response of the Coils to Sine Wave Input, Measured w ith the Barington Magne tom eter

All three axes responded well to the controller.

6 .1 .1

M isalign m en t o f M agn etom eters

As it can be noted from Figure 19, the results found from the Billingsly m agnetom eter were not identical to those found from the Barington Magnetometer. Initially it was assumed th a t the axes of the two magnetometers were not properly aligned. To minimize th e error

47

Barington Results to a Sine Wave Input

0.5 0.4 0.3

s "
13 0.1

.2

u.
.3

-

0.1
0.2

-

-

0.3 0.4 0.5

-

-

0

50

100

150

200

250

300

Time[s]

Figure 19: Response of the Coils to sine Wave Input, Measured with the Billingsly Magne tometer

48

caused by this perceived misalignment, the d ata was to be corrected once the sim ulation was completed by applying a rotation to the Billinglsy data. However, implementation of this rotation m atrix was only able to improve the results found on one axis at a time and any compromise of the three axes reduced the quality of results overall. T he m agnitude of the field was then calculated and plotted in Figure 20 whieh indicates th a t the difference between the two measurements was in fact not due to a misalignment, as the two systems would have shown the same magnitude if misalignment was the source of the error. The error was attributed to a combination of the noise in the system and the approxim ation of the previously determined gain for the Billingsly m agenetom eter, as it was a compromise between all three axes. Finally, no correction factors were applied to the results of either magnetometer for analysis.

6 .2

H ard w are in th e L oop w ith Q u ickS at S im u la tio n

As stated in Section 3.1, the greatest rate of change of magnetic field as felt by the magne tom eter will occur during the de-tumbling phase of the mission and hence the m ajority of th e testing was carried out during this phase alone.

6 .2 .1

O p en L oop Sim ulation

During the first phase of the Billingsly validation tests, the m agnetometer was merely reading values, b u t was not inputting them back into the QuickSat Simulation. For a first pass, initial conditions were arbitrarily chosen to have a roll, pitch and yaw velocity of 2.0,1.5, and 0.5 ° /a respectively. Figure 21 dem onstrates the ability of the Billingsly Magnetometer to determine the m agnetic field of a satellite in orbit. Furthermore, as the Helmholtz cage is capable of creating the anticipated magnetic field (refer to Figure 22), the assumption of using a sine wave to develop th e controller proves valid. 49

Error in Magnitude of Field with Sine input Along Each Axis
-- Billingsly Barington

c - 0.2

O )

-

0.3

-

0.4

-

0.5

100

120

140

160

180

200

Time[s]

Figure 20: Error in Magnitude of Field with sine Input Alone Each Axis

50

Error in Magnetic Field Produced by Coils

'ïii

150

300

Time[s]

Figure 21: Magnitude of Field

51

Difference in Magnitude Between Magnetometers
0.4

BiSngsly Barington

0.3a
0.36

0.34

"0 -3 2

O>0.28 0.26

0.22

02

100

150

200

250

300

Tlme[s]

Figure 22: Magnitude of Field

6.2.2

C losed Loop Sim ulation

After it was determined th at the Billingsly magnetometer was capable of following the mag netic field laid out by the flight simulation, the loop was closed and the magnetometer readings were fed into the control algorithm of the simulation. Performance was indistinguishable from the previous trial (Figure 23, leading to the conclu sion th at the control algorithm and incorporated filter were capable of dealing with the noise th at was being produced.

6.3

B -d o t C ontrol Law

It was already determined that a B-dot controller would be efficient to bring the satellite to a controllable state, so several different gains were tested on a trial and error basis. Refer to Table 8 for the list of gains, and their respective times to slow the satellite to 1 °/s on all axes (hence reaching Mode 20 of the QuickSat simulation).
52

R esponse of All Axes
0.35 0.3 0.25 Barington Billingsly Desired

I
-

0)

0.05

0.05 0.1

-

0

50

100

150

200

250

300

Time[s]

Figure 23: Response of Each Axis to Simulation Input W ith Billingsly M agnetometer D ata Driving Simulation

K,Gain Coefficient 1 |g| IBP IBP

Time to Reach Mode 20 [s] Trial 2 Trial 1 598 532 900 1018 520 517 460 520
-

w \b \

-

Table 8: B-Dot Controller Coefficients

53

A fixed set of arbitrarily chosen initial conditions was used to determine which control law slowed the satellite and moved it from the de-tumbling phase. The initial roll, pitch and yaw velocities were 1, 0.5, 0.5 ° /s respectively. While all the coefficients were able to stabilize the satellite, the one th a t achieved this task consistently with the minimum time required was chosen, and the resulting control became

m =

B |B|2

(70)

6.3.1

Stab ility of B -d ot C ontrol Law

To ensure th at the B-dot control law was capable of handling various initial conditions, the simulation was repeated with the above control law for a variety of initial tumbling rates. In Table 9, it should be noted th at even in the case of tumbling rates as high as 1 0 °/s on each axis, resulting in an overall rate of 31.63 °/s, the B-dot control law was able to stabilize the spacecraft and enter into Mode 20 within a reasonable time frame of 97 minutes, which is equivalent to a little more than one orbit. Roll [°/s] 0.1 1.0 2.0 3.0 5.0 10.0 Pitch [°/s] 0.1 1.0 2.0 3.0 5.0 10.0 Yaw [°/s] 1.0 1.0 2.0 3.0 5.0 10.0 Time s 292 376 850 952 2800 5830

Table 9: Various Initial Tumbling Rates and their Corresponding Time to Reach Mode 20

Finally, simulations were completed to demonstrate the magnetometers ability throughout all modes of the spacecrafts lifetime (Figure 24).

54

O.SS

Magnitude of Magnetic Field until Mode 70
BKingtty Barington

0.5

0.45

0.4

O 0.35

0.3

0.25

0.2

0.15

1000

2000

3000

4000

5000

6000

7000

Time[s]

Figure 24: Magnitude of the Magnetic Field with Simulation Running until Mode 70

55

7

Controller D esign for RACE project

RACE was controlled using a standard PID controller and the states were estim ated using a Kalman filter.

7.1

P ID C on troller

A proportional plus derivative controller was implemented to control the RACE platform. The feedback in terms of error in position, e = 6 -- Q à& sired-, follows the form

u = Kp e + Kd j ^ + K i j e d t

(71)

The proportional, Kp, derivative Kd, and integral A, gains were initially determined in simulation and fine tuned during hardware simulations.

7.2

K alm an F ilter

A Kalman filter is a common tool used on many spacecraft to estimate position and velocity when multiple and redundant sensors of varying degrees of accuracy and availability are being used for attitude and orbit determination. The following is a brief summary of the development of a standard Kalman filter with time invariant system matrices. A Kalman filter utilizes a linear combination of state estimation, x& and the weighted difference between the actual measurement, z, and the measurement prediction, H x .

xj = x,-+ K (z-H x j)

(72)

The notation, x ^ , signifies the state estimation directly after the measurement is taken and, indicates the estimation directly before. The residual is defined as (z - H x ^ ) , and it is desirable to have this value as close to zero as possible.
56

For a discreet system, the state at each time step, x t+ i, can be defined in term s of the value a t th e previous tim e step, x*., as

Xfc+i =

<f>k^k

+W fc

(73)

where, is the process noise vector, and (f> k the state transition m atrix th a t is defined later in this section. The process noise vector is assumed as white noise with the following mean and covariance,

E [wfc] - 0 E [wfc w f ] = Qkôkk
T he m easurement vector can be related to the state vector as

Zk

= Hfc x jfc + i/fc



(75)

where, v'k is the measurement noise vector and has mean and covariance values of

E[ uk] =0 E [uk uf] = Rfc^fcfc

(76)

T he covariance of the state estimate directly after the measurement, Pj^, is defined in term s of error, e as

=
Also it follows th a t the covariance directly before measurement, , is

(77)

57

where the error term is defined as

e j = xt - x j The error term can then be written as

(79)

= X fc --

--Kk Z fc + Kfc Hfc x^
(80 )

= (I --Kfc Hfc) (xfc --X fc ) --Kfcf/fc = (I - Kfc Hfc) - Kfc So expanding the covariance m atrix results in the following,

P t-E -E
( I - K f c Hfc) ( e ,- r .J ) K j ]

(81 )

- E Kfc (r/fco;^) ( I - K f c Hfc)' k i^fc K |'] +E Kfc U
To simplify the above equation, the definition of the covariances of U k and m ust be

applied. As well, the two middle terms go to zero, as white noise is independent of state values, in other words E (i^fc e&^) = 0. So when simplified, the covariance m atrix directly after measurement is

P + = (I - Kfc Hfc) P,- (I - Kfc Hfc)' + Kfc Rfc K l

(82 )

The Kalman filter gain, Kfc, must be chosen to minimize the errors in the system. The main term s of interest in the covariance m atrix are lined along the diagonal, and hence, the optimal Kalman filter gains are chosen to minimize the trace of P . Noting first the identity

58

rfA T he trace of P can be w ritten as

=

dA

=

(83)

= m
dTr

[ î ''- ( ( I - K , H O P ; ( I - K . H O ' ' + K » R t K l ) ] P '- ( P ^ - K . H , p ; - P ^ H r K l + K , [ % P ^ H I + R . ] ) ] K j (8 4 )

~~d^
dTr

= A

^ dKk

= - 2 ( H O ^ + 2 K t ( H i P i ^ 'H j + R i) = 0

Solving the above for K^, the desired Kalman filter gain is,

K i = P ï H Î ( H i P » m r + R i) `

(8 5 )

T he second p art of the Kalman filter consists of propagating the state estim ate through the tim e step. At the beginning of the time step, the state estim ate is

Xfc+i = 0 x + where 4 >is the state transition m atrix and is defined as

(86)

^ (t) =
T he error in this state estim ate can be defined by

- F ] - '}

(8 7 )

®fc+l -- ^ k + l ®fc+l ~

Xjfc+l + W fc -

(88)

®fc+l = <^ (Xfe - X fc) + Wfc
®fc+i
= <l> e t + ^ k

59

which leads to the following covariance matrix, P^+i

P&+1 -- ^ [®fc+i ®fc+i] Expanding gives

(89)

(90) The expectation of is zero and the expectation of is equivalent to the m atrix,

Qfc, therefore the recursive covariance m atrix can be calculated as follows.

(91) These are the standard equations needed for a Kalman filter, and can be summarized in Figure 25, however as noted previously, the error states are of interest in this study and hence these standard equations have been slightly altered to use the error states.

Kalman Gain

K k

M easurem ent

/

P k"

PropagaBon

x " w .P-k<-i

Figure 25: Summary of Kalman Filter

60

T he error vector after measurement based on the above definition

IS

= X fc - x+

= X fc - X fc + Kfc (zfc - Hfc X fc )
(Zfc --Hfc [xfc --Gfc]) G fc = G fc + Kfc (zfc - HfcXfc + HfcGfc) Defining a new measurement variable, z = Z fc --HfcXfc, as the error measurement, the error sta te estim ate becomes

ê+ = êfc + Kfc (zfc - Hfcêfc ) Before the measurement, the error was previously defined as

(93)

G fc+i =(^e+ + W fc
Therefore, the estim ate of the error state is

(94)

(95) T he covariance matrices as well as the gain m atrix, remain the same as previously stated.

8

R A C E Sim ulations

Before testing of the Kalman filter could begin, it was necessary to determine several of the characteristics of the system and determine confidently th a t the sensors used in RACE were functioning properly and were capable of the tests th a t were to be carried out. Once the system was characterized, simulations of the controller and Kalman filter were run to deter mine th e optim al coefficients needed for the system. The controller was then implemented 61

in the RACE software and hardware tests were carried out. Finally the Kalman filter was added to the system and was tested.

8.1

R a te S en sor B ia s

As the rate sensor had a strong dependence on the tem perature, several tests were carried out to determine the effects of the room tem perature and ambient tem perature drift on the sensor. Firstly, the system was powered up but held in place while the rate sensor took measurements, this test was carried out several times over for a variety of testing times, the longest occurring for 1 hour. Find below in Figure 26 the results of this testing th a t occurred over a 20 minute period.
3B
Rate S e n so r Readings

3.75

O )
®

· e ##m
3.65

m ··· ## #

«M B * # #«««* * ·«·· # *
3.6

#* * ··· * *«»i

··
3.55

· *

3.5

Time [min]

Figure 26: Rate Sensor Readings while RACE is fixed and actuators are powered off

62

The n atu ral uncalibrated bias of the rate sensor, as well as the discreet values through which the rate sensor fluctuates can be seen. It appeared th a t there was no room tem perature drift w ithin the test facility, or whatever small fluctuations in tem perature th a t occurred were negligible w ith regard to the sensitivity of the rate sensor. Am bient tem perature drift was also determined to be a factor th at might inhibit proper functioning of the rate sensor. Again, the platform was held in place, and the momentum wheel and the air thruster were turned on to create heat within the system, refer to Figure 27.
Rate S e n so r R eadings
4.2

4.15 4.1

3 , 4.05

·· #
® 3.95

3.8

· · ·

· ·

3.75

3.7

10

Time [min]

Figure 27: R ate Sensor Readings while RACE is fixed and actuators are powered.

T he h eat created by the momentum wheel and air thruster did not affect the rate sensor m easurements. As no effect was noticed in either of the previous tests, a qualitative test was done on the 63

rate sensor to determine if in fact the tem perature dépendance as stated by the m anufacture existed. Thus, a heater was used to heat the ambient air around RACE and while held static once more, a series of rate sensor measurements were taken. Figure 28 demonstrates the inverse relationship th at indeed exists between the tem perature and rate sensor measurements. Although the platform was fixed, the rate sensor readings showed a decreasing angular rate until a saturation point of approximately --0 .5 °/s when the ambient tem perature was increased.
Qualitative D em onstration of Tem perature Effects on Rate S e n so r Bias

3.5

2.5

Heater w as turned on

o >

0.5

-0 .5

20

40

60

Time [min]

Figure 28: Effects of Increased Temperature on Rate Sensor

Two points can be made from this result, the first is th at the rate sensor was susceptible to ambient tem perature changes. The second is th a t the heat created by the internal RACE computer and other components would not compromise the accuracy of the rate sensor 64

m easurements. Finally the output from the rate sensor was compared to the output from the base encoder, Figure 29. The momentum wheel was powered up to a rate of 3000 rpm and the RACE platform was left to spin freely. The measurement frequency for both sensors was 1 Hz, and th e tests were carried out for 5 minutes.
Com parison of B ase Encoder Data against R ate S en so r Data
" " Base Encoder Measurement Rate Sensor M easurement

-5

D )

m -1 0

-1 5

-2 0

-2 5

-3 0

-3 5

-4 0

-4 5

100

150

200

250

300

Time[s]

Figure 29: Angular Rates of a free spinning RACE platform

8 .2

C o n tro ller T estin g

The RACE platform FID controller was designed in simulation to minimize both percent overshoot and steady state error. Once param eters were chosen in simulation, they were fine 65

Kp
1.2 1.2 1.4 1.6 1.2 1.2 1.2 1.2

Ki
0 0 0 0 0 0.1 0.1 0.2

Kd
0.5 0.75 0.75 0.75 0.8 0.8 0.6 0.8

Percent Overshoot 76 40 52 56 53 50 85 80

G S 3 0.75 0.93 1.40 0.36 1.05 0.05 1.40 0.05

Table 10: Robust Controller Gains for Helmholtz Cage

tuned using hardware testing. Refer to Table 10 for a variety of the gains tested and the corresponding percent overshoot and steady state error (e^s) th at occurred. All tests were carried out for 100 seconds at a measurement frequency of 2 Hz with a step input of 15°. The final controller chosen had gains Kp = 1.2, Ki = 0.1 and Kd = 0.8. There was a 50% overshoot in the response with a steady state error of approximately 0.05°. The tim e to settle to its final value was approximately 15 seconds. Refer to Figure 30.

8.3

K alm an F ilter T estin g

The components of the Kalman filter that were adapted to the RACE system were the measurement noise matrix, R and the process noise matrix, Q. The measurement noise m atrix was a diagonal 2x2 matrix, as the noise levels in the two sensors on board RACE were uncorrelated. The noise level in the base encoder was chosen as the precision of the angular position measurement, determined by the size of each step, 0.0031 rad. The noise level in the output of the rate sensor was a manufacturer specified quantity.

R =

0.0031 0
66

0 4.36e

(96)

T he process noise m atrix was a 3x3 m atrix th a t contained only one non-zero value th a t was th e m anufacturer stated rate sensor bias.

Q=

0 0 0 0 0 0 0 0 1 .7 5 e - 6

(9 7 )

T he initial estim ates for the Kalman filter were chosen arbitrarily as
Step R epense of RACE Hardware
25

20

O )
05

-5

20

25

30

35

40

Time[s] Figure 30: Response of RACE to a Step Input

67

1.0 eo = 0.1 0.01  1.0 0.1
-

0.2 1.0

(98)

0.1

1.0 0.2

0.1 0.2

The RACE hardware tests were carried out for 225 second intervals, the sampling frequency of the rate sensor was constant at 1 Hz, while the sampling frequency of the base encoder was gradually decreased to assess the Kalman filter's ability to deal with missing data. During testing, the momentum wheel was spinning at approximately 3000 rpm and the platform W E L S free to rotate. No controller was implemented during these tests to m aintain the desired fixed state at zero degrees; therefore, the error vector th at was used to drive the Kalman filter was simply the state vector. Refer to Figure 31 for the results in position and Figure 32 for the results in angular velocity. The estimate of the position and velocity calculated using the Kalman filter converged to the values determined from the onboard sensors. However, the estim ate does not track the actual angular velocity exactly, therefore fine tuning of the Kalman filter param eters is needed to correct this anomaly.

68

Angular Position Measurement and Estimate
-- B ase Encoder M easurement ' Kalman Filter Estimation -5 0 0

^ -1000 S' a
c -1500

D . -2 0 0 0

CD -2500

It

^

-3000

-3 500

-4000

-4 500

50

100

150

200

Time[s]

Figure 31: Kalm an Filter Estim ates of Angular Position (Sampling Frequency of the encoder = 0.2 Hz), Angular Position Not Normalized to 27r

69

Angular Velocity Measurements and Estimate
-- Base Encoder Measurement --· Rate Sensor Measurement · "  Kalman Filter Estimation____

CD

-2 0

3

D >

-40

-80

0

50

100

150

200

Time[s]

Figure 32: Kalman Filter Estimates of Angular Velocity (Sampling Frequency of the encoder = 0.2 Hz)

70

9
9.1

C oncluding Remarks
Q u ick S a t

QuickSat, an engineering model designed as a precursor mission for the Canadian Space Agency's small satellite program will be equipped with a m agnetom eter as a position acqui sition instrum ent. The magnetometer th a t will be flown aboard QuickSat was tested using three pairs of Helmholtz coils th a t were erected in 1999 and positioned at 90° to each other. A satellite simulation, including a magnetic field model, generated the magnetic field values th e satellite would experience during orbit, which were in turn created in the test bed. A support stand was constructed to fix both the magnetometer th at was used to control the coils and the one th a t would be flown onboard QuickSat at the center of the coil configuration. C haracterization of the coils was carried out to determine the axis linearity and independence, as well as the transfer function, so th at accurate modeling could be conq)leted and proper param eters could be chosen for the robust control law. Once controllability of the Helmholtz coils was achieved, the flight-rated instrum ent was added to the test bed. Static measurements --the magnetic field was held constant-- were taken to calibrate the m agnetometer. Following determ ination of the proper gain, the magne tom eter was then integrated into the hardware in the loop simulation as well, first by reading only, and then fully integrated to drive the attitude control system within the QuickSat sim ulation. Several different free tumbling rates -- considered as the initial conditions of the sim ulation -- were tested. In each case, the m agnetom eter and control system was capable of stabilizing the spacecraft. Finally, the control law th a t was being used to control QuickSat was examined to determ ine if a more efficient or more powerful controller could be implemented, a b-dot control law was selected.

71

9.2

RACE

A simulation of the RACE test equipment was completed, and a Kalman filter was imple mented on the hardware. Initial hardware testing was carried out, including testing of the onboard sensors, testing of the controller and testing of the Kalman filter while RACE was free to spin.

9.3

R eco m m en d a tio n s for F u tu re W ork

The work that has thus far been completed should be continued to ensure further devel opments in this field. Improvements on the Helmholtz coil test bed should include the upgrading of the power sources to bi-polar sources, so th at the mechanical switch can be removed to simplify the system. Exhaustive testing should be done to ensure th at the magnetometer is indeed flight worthy. Hardware in the loop simulations with a variety of initial conditions should be carried out, ideally reaching the point when the magnetometer fails so th at proper and accurate bounds can be put on its abilities. Regarding RACE, a more complete characterization of the system should be done, including experimental determination of wheel friction coefficients and quantitative testing of the rate sensor tem perature bias. Testing of Kalman filter, in conjunction with the controller, needs to be completed to fully validate the Kalman filter.

72

R eferences
[1] (1998) Billingsley Magnetometers, TFM 100-G2 M iniature Triaxial Fluxgate Magne tom eter" Users Manual, Billingsley Magnetics. [2] (2003) "MR-3 Triaxial Magnetic Field Compensation System, Compensation Coil design and system guide" ; Stefan Mayer Instrum ents. [3] Davignon, Jean-Philippe (2000) "Status of the A ttitude Control System Sim ulator for Quicksat" ; Canadian Space Agency [4] Brown, R.G. and Hwang, P.Y.C {1997)Introduction to Random Signals and Applied Kalman Filtering, Third Edition; John Wiley and Sons, United States. [5] Bushenkov, Vladimir et al (2002) "A ttitude Stabilization of a Satellite By M agnetic Coils" ; A cta A stronantica Vol 50. No 12, pp. 721-728. [6] Comisel, H. et al (1997) "A ttitude Estim ation of a N ear-Earth Satellite Using Magne tom eter D ata" ; A cta Astronantica Vol 40. No 11, pp. 781-788. [7] Fortescne, Peter and Stark, John(1995) Spacecraft Systems Engineering Second Edition John Wiley and Sons Ltd. [8] Franklin, Gene and Powell, David and Emami-Naeini, Abbas {1994) Feedback Control for Dynamic Systems Third Edition; Addison-Wesley Publishing Company Inc, pp. 554-560. [9] Grass!, M (1997) "A ttitude Determination and Control for A Small Remote Sensing Satellite" ; A cta A stronantica Vol. 40 No. 9 pp. 675-681. [10] Grass!, M Vetrella, S Moccia, A (1995) "Prelim inary Design of the A ttitude Control System of a Microsatellite for E arth Observation" ;Space Technology Vol 15 No.4 pp. 223-230. [11] Griffin, Michael; French, James {1991)Space Vehicle Design; American In stitute of Aero nautics and Astronautics. 73

[12] Herron, Marissa; Goeree, Barry; Shucker, Brian (2000) "Detumbling of UASat" Techni cal Note University of Arizona. [13] Janschek, K and Krasilshikov, M (1998) "Minimum Hardware Navigation Concept for LEO Satellites Using Information Fusion"; 12th AIAA Conference on Small Satellites. [14] Jobanputra, Rishi (2000)"Report on Helmholtz Coils" ; Canadian Space Agency, Space Technologies Division, QuickSat Development Project. [15] Kalman, R.E.(1960)"A new Approach to Linear Filtering and Prediction Problems" ; ASME Journal of Basic Engineering 82(Series D)pp.35-45. [16] Laderman, M. (2002)"RACE Ryerson Satellite A ttitude Control Experiment" ; Ryerson University [17] Lefferts, E.J., Markley, F.L, Shuster, M.D. (1982) "Kalman Filtering for Spacecraft A ttitude Estimation" . Guidance Volume 5, No.5. [18] Marchetti, Stephen (1999) "Design and Development of the Tri-Axial Helmholtz Coil As sembly for the Quicksat HITL" ; Canadian Space Agency, Space Technologies Division, Quicksat Development Project, October. [19] McTavish (2003) "Ryerson Attitude Control Experiment, Software Design Specifica tion /Description, Draft" ; Internal Report. [20] McTavish (2003)"Ryerson A ttitude Control Experiment, System Modeling, Draft" ; In ternal Report. [21] Ng, Alfred (2003) "Future Generation of Nanosatellites" ; Presentation for Canadian Space Agency Technology Days. [22] Nise, Norman (2000) Control Systems Engineering, Third Edition-, John Wiley & Sons, Inc, New York, US. [23] Pastena, M and Grassi, M (2000) "Robust Control of the Smart Microsatellite A ttitude Dynamics" ; Acta Astronantica Vol 47, Nos 2-9, pp. 119-128.

74

[24] von Shéele, F (2003) "The Odin Project -- Lessons for a Follow-On E arth Observation Mission" ; A cta Astronautic Volume 53 pp. 739-747. [25] Sidi, Marcel (1997)Spacecraft Dynamics and Control A Practical Engineering Approach', Cambridge University Press. [26] (1999) Thomsen et al "Danish Orsted Mission In-Orbit Experiences and S tatus of The Danish Small Satellite Program me" ; Paper number SSC99-I-8, 13th Annual AIAA/USU Conference on Small Satellites. [27] W ertz, J.R. {1976)Spacecraft Attitude Dynamics and Control', Kluwer, pp. 820. [28] Wisniewski, Rafal and Blanke, Mogens (1999) "Fully magnetic attitu d e control for spacecaft subject to gravity gradient" ;Automatica 35, pp. 1201-1214.

75


