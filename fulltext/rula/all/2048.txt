AN INVESTIGATION OF BINARY CODED EXCITATION METHODS USING GOLAY CODE PAIRS FOR HIGH FREQUENCY ULTRASOUND IMAGING

By

Xuegang Su
Master of Applied Science, Beijing Institute of Technology, Beijing, 1997 Bachelor of Applied Science, Beijing Institute of Technology, Beijing, 1992

A Thesis Presented to Ryerson University In partial fulfillment of the requirements for the degree of Master of Applied Science In the Program of Electrical and Computer Engineering Department

Toronto, Ontario, Canada, 2004 Â© xuegang Su 2004

UMI N um ber: E C 5 2 9 8 0

All rights re serv e d INFORMATION TO USERS

The quality of this reproduction is dependent upon the quality of the copy submitted. Broken or indistinct print, colored or poor quality illustrations and photographs, print bleed-through, substandard margins, and improper alignment can adversely affect reproduction. In the unlikely event that the author did not send a complete manuscript and there are missing pages, these will be noted. Also, if unauthorized copyright material had to beTerhoved, a note will indicate the deletion.

UMI'
UMI Microform EC52980 Copyright 2009 by ProQ uest LLC All rights reserved. This microform edition is protected against unauthorized copying under Title 17, United States Code.

ProQ uest LLC 789 East Eisenhower Parkway P.O. Box 1346 Ann Arbor, Ml 48106-1346

Author's Declaration

I hereby declare that I am the sole author of this thesis.

I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research.

Signature:

________________ _

I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

Signature: - -,

,_

Borrower's Page

Ryerson University requires the signatures of all persons using or photocopying this thesis. Please sign below, and give address and date. Signature Address Date

IV

Abstract AN INVESTIGATION OF BINARY CODED EXCITATION METHODS USING GOLAY CODE PAIRS FOR HIGH FREQUENCY ULTRASOUND IMAGING Xuegang Su, Master of Applied Science Electrical and Computer Engineering Department, Ryerson University, Toronto, Ontario, Canada, 2004

We are investigating the feasibility of binaiy coded excitation methods using Golay code pairs for high frequency ultrasotmd imaging as a way to increase the signal to noise ratio. I present some theoretical models used to simulate the coded excitation method and results generated from the models. A new coded excitation high frequency ultrasound prototype system was built to verify the simulation results. Both the simulation and the experimental results show that binary coded excitation can improve the signal to noise ratio in high frequency ultrasotmd backscatter signals. These results are confirmed in phantoms and excised bovine liver. If just white noise is considered, the encoding gain is 15dB for a Golay pair of length 4. We find the system to be very sensitive to motion (i.e. phase shift) and frequency dependent (FD) attenuation, creating sidelobes and degrading axial resolution and encoding gain. Methods to address these issues are discussed.

Acknowledgements

I would like to thank my supervisor, Dr. Michael Kolios whose intellectual support and guidance were integral to the completion of this project.

I would like to thank the other researchers and students including Arthur Worthington and Xia Wu in the Princess Margaret Hospital, Yuexi Huang at the SuunyBrook Hospital and, Shuxue Quan at the SONY Corporation, Neeta Parmar who wrote some simulation software, Peter Chun, Noushin Famoud and in our lab. I appreciate greatly of all their help.

Finally, I would like to thank all my professors in the Electrical and Computer Department and the Physics Department for all their help and Ryerson University for providing the facilities and environment that makes research such a wonderful experience.

VI

Dedication

This thesis is dedicated to my parents, my wife, and my son for all their love and support.

Table of Contents Title Page....................................................................................................................... i Author's Declaration................................................. iii

Borrower's Page........................................................................................................... iv Abstract........................................................................................................................ v Acknowledgements...................................................................................................... vi Dedication................................................................................................................... vii Table of Contents....................................................................................................... viii List of Tables............................................................................................................. xiii List of Figures............................................................................................................ xiv Chapter 1 Introduction.............................................................................................1 1.1 Brief History.......................................................................................................1 1.2 Statement of Problem and Organization of Thesis............................................ 3 1.3 Nature of Ultrasound......................................................................................... 4 1.4 Wave Fundamentals........................................................................................... 6 1.4.1 The Wave Equation................................................................................ 6 1.4.2 The Acoustic Properties of M edia.......................................................... 7 1.4.3 Reflection and Refiaction.......................................................................8 1.4.4 Dif&action and Scattering............................................... 9

1.4.5 Intensity..................................................................................................10 1.5 Ultrasonic Transducers....................................................................................10 1.5.1 Parameters and Materials........................................................................11 1.5.2 Focusing field..........................................................................................12 1.6 Velocity, Attenuation and Absorption................................................. 1.6.1 Velocity of Soimd in a Medium............................. 14 14

1.6.2 Attenuation of Biological Medium..........................................................15 1.6.2.1 Attenuation.....................................................................................15 1.6.2.2 Frequency Dependent Attenuation.................................................17 1.6.3 Absorption of Medium ................................................................19

1.7 Scattering by Biological Materials.................................................................. 20
v iii

1.7.1 Introduction............................................................................................20 1.7.2 Scattering Strength....................... 22

1.7.3 Pulse Echo Response..............................................................................23 1.7.4 Single Particle Model.............................................................................24 1.7.5 One Dimensional Scattering...................................................................25 1.7.6 Our Research Interest.............................................................................27 1.8 Ultrasound System..........................................................................................29 1.8.1 The Structure of an Ultrasound System.................................................. 29 1.9 Coded Excitation...........................................................................................31 1.9.1 Introduction...........................................................................................31 1.9.2 The Theory of Coded Excitation..........................................................32 1.9.3 Two Coded Excitation Methods........................................................... 35 1.9.3.1 FM Chirp Coded Excitation........................................................35 1.9.3.2 Binary Coded Excitation............................................................. 39 1.9.4 Properties of Golay code and Golay code paris................................... 40 1.9.5 The Components of a Binary Coded Excitation System...................... 43

Chapter 2 Methodology...................................................................... 2.1 Introduction.....................

45 45

2.2 Simulation of Coded Excitation...................................................................... 45 2.2.1 Encoded Signal.......................................................................................46 2.2.1.1 Golay Codes.................................................................................. 46 2.2.1.2 Code Generation............................................................................ 47 2.2.1.3 Modulated Signal Type................................................................. 51 2.3 Backscatter Signal........................................................................................... 54 2.3.1 One Dimensional Scattering Model....................................................... 54 2.3.2 Attenuation............................................................................................. 55 2.3.2.1 Frequency Independent Attenuation............................................. 55 2.3.2.2 Frequency Dependent Attenuation................................................ 56 2.3.3 Spacing................................................................................................... 58
ix

2.3.4 Processing Coded Backscatter Signals................................................... 59 2.3.4.1 Reflection Reference Processing Method.................................. 59 2.3.4.2 Code Reference Processing Method........................................... 60 2.3.4.3 Code with Phase Reference Processing Method........................ 62 2.3.5 Simulations............................................................................................. 64 2.3.6 Evaluation Methods................................................................................ 65 2.3.6.1 Signal to Noise Ratio............... 66

2.3.7 Signal Distortion..................................................................................... 69 2.3.7.1 Signal Envelope............................................................................. 69 2.4 Experimental Prototype of Binary Coded Excitation System...................... 70 2.4.1 The Experimental System......................................................................71 2.4.2 Two Interesting Phenomena................................................................... 72 2.4.2.1 Transducer Focus.......................................................................... 72 2.4.2.2 Phase Shift..................................................................................... 75

Chapter 3 Results...................................................................................................... 77 3.1 Introduction..................................................................................................... 77 3.2 Theoretical Simulation Results for the Binary Coded Excitation.................. 77 3.2.1 Sparse Spacing Models.......................................................................... 77 3.2.1.1 Pulse Compression without Attenuation....................................... 78 3.2.1.2 Pulse Compression with Plain Attenuation................................... 80 3.2.1.3 Frequency Dependent Attenuation................................................ 83 3.2.1.4 Effect of Code Length using Sparse Spacing Models................... 85 3.2.1.5 Impulse Response for the Coded Excitation Method................... 86 3.2.2 Dense Spacing Models....................................................................... ....86 3.2.2.1 Without Attenuation...................................................................... 86 3.2.2.2 Plain Attenuation........................................................................... 89 3.2.2.3 Frequency Dependent (FD) Attenuation....................................... 90 3.2.2.4 Simulations with closely spaced scatterers................................... 92 3.3 Experimental Results for the Binary Coded Excitation System....................... 94
X

3.3.1 Three Processing Methods..................................................................... 95 3.3.2 Signal Encoding Gain............................................................................ 98 3.3.3 Impulse Response for Our Binaiy Coded Excitation System..............100 3.3.3.1 The Phase Shift Effect................................................................. 102 3.3.3.2 The Effect of Code Length..........................................................103 3.3.4 Results from Phantoms....................................................................... 105 3.3.4.1 The Effect of Code Length.........................................................106 3.3.4.2 The Effect of Depth..................................................................... 109 3.3.5 Critical Depth for our System............................................................. I ll 3.4 Backscatter Signal from Real Tissue.............................................................. 115 3.4.1 Different Processing Methods........................................................ 116 3.4.2 Phase Shift.......................................................................................117 3.4.3 Similarity of Signals........................................................................119 3.4.4 The Gain in Signal to Noise Ratio.................................................. 120

Chapter 4 Conclusions and Future Work.................................................................122 4.1 Conclusions.......................................................................................................122 4.1.1 Feasibility of Binary Coded Excitation Method..............................122 4.1.2 The Mechanism of the Binary CodedExcitation Method...............123 4.1.3 The Effect of Code Length..............................................................125 4.1.4 Phase Shift Sensitivity.....................................................................125 4.1.5 Impulse Response and Similarity of Signal....................................127 4.2 Future Work......................................................................................................127

Appendix A

System Design...............................................................................130

A 1.1 Arbitrary Waveform Generator..........................................................................130 A1.2 Power Amplifier................................................................................................136 A1.3 Signal Amplifier.........................................................................................137 A1.4 Oscilloscope...............................................................................................138 A1.5 Filter Design...............................................................................................139
xi

A l.6 Protection Circuit Design............................................................................... 143 A l.7 Transmission Line Impedance Matching.................................................145 A l.8 Platform................................................................................................... 147 Al .9 Connection Adapter and Cables..................................................................... 147 A l. 10 Two Challenges of the Lab System........................................................149 A l.10.1 Noise............................................................................................. 149 A l.10.2 Inertia of Transducer....................................................................150

Appendix B

Noise Reduction for the Power Amplifier................................. 152

Appendix C IVansducer Equivalent Circuit and Impedance matching........... 154 C l. 1 Equivalent Circuit............................................................................ 154 C l.2 Impedance Matching........................................................................156 C l.2.1 Electrical Impedance Matching................................................. 156 C l.2.2 Mechanical Impedance Matching................................................ 157 Appendix D Biological Effects.......................................................................158

1)1.1 Thermal Effect.................................................................................... 158 D1.2 Cavitation............................................................................................159

Reference list.......................................................................................................... 161 Important Glossary............................................................................................... 166 Abbreviations......................................................................................................... 167

Xll

List of Tables

1.1 Characteristic Acoustic Impedances of Selected Media........................................ 8 1.2 Approximate Attenuation Values for Human Tissue............................................. 16 1.3 Contributions of Scattering to the Attenuation Coefficient...................................22 2.1 Results of Element Pairing for Sequence 1 and Sequence 2.................................48 3.1. Encoding Gains for Different Depths with Plain Attenuation............................. 82 3.2 Encoding Gain for Different Depths with FD Attenuation................................... 84 3.3 The Relation between Code Length and Gain...................................................... 89 A l.l The Predefined Variables................................................................................. 133 A 1.2 Power Amplifier Specifications........................................................................ 136 A 1.3 Specifications of the Signal Amplifier............................................................. 138 A1.4 The Line Lengths for Maximum Pulse Echo Amplitude.................................. 144

xin

List of Figures

1.1 Acoustic Spectrum (in Hz)................................................................................... 6 1.2 Schematic of Transducer......................................................................................13 1.3 The Speed in Pure Water at 5MHz with Temperature 0-90.................................15 1.4 Tissues' Frequency Dependent Attenuation Coefficient.....................................18 1.5 Ultrasound Images o f IS"* Week Fetus................................................................ 21 1.6 Simplified Representation of the Echo Response................................................ 24 1.7 Single Particle Model of Scattering.....................................................................25 1.8 One Dimensional Scattering Model.................................................................... 27 1.9 Normal-Treated-Normal Pellet of Cells Using the 20MHz (A) and 40MHz (B) Transducers.................................................................................................................27 1.10 A Lymphoma Tumor in Mouse Leg imaged at 40MHz.....................................28 1.11 The Structure of Ultrasound System.................................................................. 29 1.12 Conventional Pulse and Coded Excitation......................................................... 32 1.13 Conventional Systems and Coded Excitation Systems...................................... 34 1.14 Encoded Method and Autocorrection.................................................................35 1.15 FM (Frequency Modulated) Chirp..................................................................... 36 1.16 Implementation of FM Chirp............................................................................. 37 1.17 FM Chirp.......................................................,.................................................... 38 1.18 The Compressed Signal......................................................................................39 1.19 Binary Coded Excitation.................................................................................... 39 1.20 Golay Code and Its Autocorrelation................................................................... 41 1.21 Golay Code Pairs................................................................................................41 1.22 Golay Coded Excitation Signal and Conventional Signal..................................42 1.23 Coded Excitation System................................................................................... 44 2.1 The Structure of Simulation................................................................................. 45 2.2 Golay Code Pairs..................................................................................................48 2.3 Long Coded Signals in Focused and Unfocused Transducer.............................. 50 2.4 (a) Emitted Signal from Transducer (b) Simulated Signal................................ 51
x iv

2.5 (a) The Second Modulated Signals (b) Reference Modulated Signal................... 52 2.6 Third type of Modulated Signals...........................................................................53 2.7 Attenuation in Frequency Domain........................................................................56 2.8 Implementation FD of Attenuation.......................................................................58 2.9 Simulation Results with Different Spacing........................................................... 59 2.10 Reflection Reference Processing Method........................................................... 60 2.11 Code Reference Processing Method....................................................................61 2.12 Results from One Cycle Code Reference and Reflection from One Pulse.... ......................................................................................................... 62

2.13 Code with Phase Reference for Cross Correlation.............................................. 63 2.14 Schematic diagram of the Program................................................... 65

2.15 Noise Type and Penetration Depth x Frequency................................................ 66 2.16 A Real Backscatter Signal from Liver................................................................. 68 2.17 Getting Envelop of Signal by Hilbert Transform................................................ 70 2.18 The Structure of Binary Coded Excitation.......................................................... 70 2.19 Prototype Binaiy Coded Excitation System........................................................ 72 2.20 Reflection Signal for Code Length 16................................................................. 74 2.21 Focus Point for Reflection Signal of Code Length 16........................................ 74 2.22 Phase Shift between Golay Pairs......................................................................... 75 2.23 No Phase Shift after Platform is Stabilized......................................................... 76 3.1 (a) One Cycle Code Referencefor Processing (b) Golay Coded Signal................ 78 3.2 Backscatter Signal from Sparse Spacing without Attenuation.............................. 79 3.3 Encoding results from Sparse Spacing with Attenuation (Code Length 8)......................................................................................................... 80 3.4 Backscatter Signal from Sparse Spacing with Plain Attenuation.................................................................................................................. 81 3.5 Encoding results for Sparse Spacing with Plain Attenuation (Code length 8)........................................................................................................... 82 3.6 Backscatter Signal from Sparse Spacing with Frequency Dependent Attenuation.................................................................................................................. 83
XV

3.7 Encoding results for Sparse Spacing with FD Attenuation (Code Length 8).......................................................................................................... 85 3.8 Backscatter Signal in Dense Spacing without Attenuation (Code Length 8)...........................................................................................................87 3.9 Encoding results of Dense Spacing without Attenuation (Code Length 8)........ 87

3.10 The STD for Four Code Lengths......................................................................... 88 3.11 Backscatter Signal in Dense Spacing with Plain Attenuation (Code Length 8)...........................................................................................................89 3.12 STD for Four Code Lengths. ............................................................................ 90 3.13 Backscatter Signal in Dense Spacing with FD Attenuation (Code Length 8)...................................................... 91

3.14 STD for Four Code Lengths............................................................................... 92 3.15 Average STD Ratio for Four Code Lengths....................................................... 93 3.16 The Ratio of STD for Four Code Lengths......................................................... 93 3.17 Signal and Encoding results in Autocorrelation Method................................... 96 3.18 Signal and Encoding results in Code Reference Method.......................... 96

3.19 Signal and Encoding results in Code Reference Method.................................. 97 3.20 Phase for Maximal Correlation of Two Processing Methods............................. 99 3.21 Signals and their Envelops........................................................... 3.22 Encoding results for Phase Shift Effect 101

................................................... 103

3.23 Encoding results for Different Code Lengths....................................................104 3.24 Encoding Gains for Four Code Lengths.............................................................105 3.25 One Reference from One Cycle Pulse and Envelope.........................................107 3.26 Encoding results for Four Code Lengths...........................................................108 3.27 Backscatter Signal and Encoding Results and Their Envelope at 0.3 mm depth...............................................................................110 3.28 Backscatter Signal and Encoding Results and Their Envelope at 0.5 mm depth...............................................................................110 3.29 Backscatter Signal and Encoding results and
XVI

Their Envelope at 0.7 mm depth.............................................................................. I l l 3.30 Reference Signal at Critical Depth.................................................................... 112 3.31 Backscatter Signal and Encoding results for Different Code Lengths...................................................................................................................... 113 3.32 The Code Length and Encoding Gain............................................................... 114 3.33 White Noise and Its Encoding results............................................................... 115 3.34 Backscatter Signals from Bovine Liver............................................................. 116 3.35 Different Methods (Code Length 2).................................................................. 117 3.36 Effect of Phase Shift......................................................................................... 119 3.37 Envelope Method to Evaluate Signal Similarity............................................. 120 A l.l The Interface of Arbitrary Signal Generator.................................................... 131 A 1.2 The Structure of Arbitrary Signal Generator.................................................... 131 A1.3 How to Generate the Encoded Signal............................................................... 135 A 1.4 Schematic of High Pass Filter.......................................................................... 141 A1.5 Schematic of High Pass Filter.......................................................................... 141 A1.6 Simulation Results of the Filters............................................. 142

A1.7 PCB Layout for Filters..................................................................................... 143 A 1.8 Protection Circuit............................................................................................. 144 A1.9 Schematic Picture of Expander.........................................................................145 Al.lO PCB Layout of Expander............................................................................... 145 A l.ll Transmission Line.......................................................................................... 146 A1.12 Lab Platform................................................................................................... 147 A1.13 System Cormection Diagram.......................................................................... 148 A1.14 Consecutive Pulses......................................................................................... 151 A1.15 New Puiser and Its Backscatter Signal............................................................151 B l.l The Noise Channel........................................................................................... 152 C l.l Equivalent Circuit of Transducer.....................................................................155 C l.2 Transformer for Impedance Matching....................................... 157

XVll

Chapter 1

Introduction

At the beginning of this chapter, the histoiy of ultrasound and nature of sound are briefly introduced. Then important concepts in ultrasound physics, which are essential for an ultrasound system, are discussed. The concepts include wave fundamentals and the ultrasonic transducer. In the "wave fimdamentals" section, the wave equation, acoustic properties of media, reflection and refraction, diffraction and scattering, and intensity are introduced. In the section "ultrasonic transducer", the ultrasonic transducer, equivalent circuit, impedance matching and focusing are discussed. Special emphasis is placed on features significant to medical ultrasound, such as velocity of medium, attenuation, absorption, scattering by biological materials, scattering strength, pulse echo response and single particle model, thermal effect, and cavitation. In the end, the knowledge of the transducer system and coded excitation ultrasound methods are discussed in detail. The components of an ultrasound system and a coded excitation system, two coded excitation methods and their properties are discussed. All of these contents constitute the fundamentals for the rest of the chapters in the thesis. And a lot of the material has been adapted from the following books: Cobbold's^^^ and
Wells't^ '* ^ .

1.1 Brief History

Ultrasonics is the smdy and application of high-frequency sound waves, usually in excess of 20 KHz. The roots of ultrasonic technology can be traced back to research on the piezoelectric effect conducted by Pieerre Curie around 1880. He found that asymmetrical crystals such as quartz and Rochelle salt generate an electric charge when mechanical pressure is applied. Conversely, mechanical vibrations are obtained by applying electrical oscillations to the same crystals. Sonar, the first application for ultrasound, was employed on a large scale by the
1

U.S. Navy during the World War II to detect enemy submarines.

The medical application of ultrasound dates back to the early 1950s. The development spans the first crude systems for acquiring single lines of data to today's imaging system. The evolution has passed through several intermediate steps. "A-scope ultrasound systems" were employed by several research groups (Wild 1950; Gordon 1950) to demonstrate that ultrasound could be used for detecting tissue layers, tumors, and heart structures. "B scope ultrasound systems" appeared to sweep a two-dimensional image of tissue structure in 1954 by groups such as Howry and Baum. Later, multi-element transducers (linear arrays and phase arrays) were used in modem scarmers (Macovski 1979). "Continuous wave Doppler system" was suggested by Satomura (1957) to use to study the blood flow or probe soft tissue. "Real time imaging systems" were developed by Hemy to quickly measure tissue (1967). "Computerized tomography system" created by Greenleaf was to observe the three-dimensional image of tissue stractures (1974)
|53||121|6I

Ultrasound applications in medicine are the most rapidly advanced areas. Ultrasound is used for imaging the human body, as a means to treat various tissue ailments and for sterilizing surgical instruments. Ultrasonic scanning has big advantage over X-ray in that there are apparently no adverse health effects. For this reason, it has come into widely spread use for monitoring the condition of the fetus as it grows in the womb. The increasingly high precision of such monitoring has made it possible to detect defects even at the very early stages of pregnancy. Ultrasonic scanning is also useful for obtaining information about the flow of blood through the carotids. Other important diagnostic applications are the detection of kidney stones, gallstones and tumors.

With further progress in materials (particularly piezoelectric materials for the transducers) in electronics and in computers, improvements in the performance of
2

ultrasound system will be accompanied by the reduction in cost. Therefore, the ultrasound technology is now employed in a wide range of applications in industries.

1.2 Statement of Problem and Organization of Thesis

The central interest is the high frequency ultrasound system (30-50MHz). The resolution of an ultrasound system increases with the frequency of the ultrasound. It is a powerful clinical tool that is often used in ophthalmology and dermatology. It has been used in the diagnoses of intra-ocular eye tumours such as choroidal melanoma and conditions such as acute angle glaucoma. It has been recently discovered that it can be used to detect the effects of cancer therapies induced by standard chemotherapeutic agents and radiotherapy. It also can be used to assess organ suitability for transplantation procedure. There are some problems in using high frequencies, one of them is limited penetration depth at these frequencies into tissue (about 1 cm or less) Therefore, the goal of my thesis is to investigate

the potential of using coded excitation for high frequency ultrasound to improve the Signal to Noise Ratio (SNR) from tissue backscatter.

To this end, I perform theoretical simulations to show the expected improvement using an encoding method with Golay Pairs, which included the effects of frequency dependent attenuation, the first such simulations performed. I demonstrate that even when frequency dependent attenuation is included, significant improvements in SNR could be realized. Furthermore, I built a prototype high frequency ultrasound system with coded excitation, to my knowledge to first one ever implemented, to experimentally demonstrate the predicted gains. I further analyzed different decoding reference schemes and found the optimal encoding gain and discussed the results, and some of the issues involved in implementing this clinically.

The thesis is organized as follows: first, the basics of ultrasound are introduced followed by an introduction to coded excitation. In Chapter 2, which discusses the methods used, I present the theoretical models used for the simulations in the first part and the construction of the experimental prototype in the second part. In Chapter 3 , 1 show the results of the theoretical simulations and then continue to present experimental results using the prototype ultrasound pulse-echo system we developed. Finally, in Chapter 4 I discuss some problems associated with the clinical implementation of the system and potential ways to address them. If you are familiar with physics of ultrasound, you can skip these sections and directly begin with section 1.9.

1.3 Nature of Ultrasound

Sound is the rapid oscillatory motion of molecules. It is produced while applying a time-varying stress to a medium. The propagation of sound waves requires physical elastic media, such as gas, liquid or solid. When the applied stress displaces a particle of the medium is displaced from its equilibrium position, internal forces tend to restore the particle back to its original position. Particles of the media are not propagating away from the medium. They only vibrate back and forth about their equilibrium positions. When many particles vibrate continuously along media, a wave forms. Wave is the disturbance whose position in space changes with time. Mechanical vibrations become vibrating pressure waves,

transferring energy to the medium and to objects that the wave contacts by the contact between masses of the medium. As a sound wave propagates in a medium, the mechanical energy moves progressively from particle to particle.

There are three major modes of acoustic wave propagation. They differ in terms of their particle motion in relation to the sound wave propagation direction. The
4

simplest forai is that a plane longitudinal (compressional) wave propagates in a homogeneous isotropic medium of semi-infinite extent. The particle motion is parallel to the wave propagation direction. The second simplest form is that in the solid medium the particle movement is at right angles to the direction of propagation. This wave is called a transverse (shear) wave. If the plane boundary of a semi-infinite solid separates the solid from a rarefied medium (e.g. gas), then wave propagation can occur close to the boundary through a coupling of longitudinal and transverse waves at the interface. Surface waves have an elliptical particle motion. These waves travel across the surface of the material with the major axis of the ellipse perpendicular to wave propagation direction. Rayleigh first described such waves in 1885. Therefore, they are often referred to as Rayleigh waves. Longimdinal waves may present in any elastic or compressible media such as solid, liquid and gas. However, the other forms of wave modes rarely propagate in liquid and gases.

Frequency is defined as the number of cycles per second of a harmonic vibrating disturbance. As shown in Figure 1.1, the acoustic spectrum breaks down sound into three ranges of frequencies: suhsoiric range, audible range, and ultrasonic range. Ultrasonic wave refers to the human-inaudible soimd wave whose frequency range is above 20 KHz, the upper frequency response limit of the human ear. The ultrasonic range is then further divided into three subsections. Ultrasound behaves in a similar manner to audible sound except that it has a much shorter wavelength. Generally the ultrasound frequency range employed in medicine is 100 KHz to 10 MHz. Now many research articles are published on higher frequency range (from 20 MHz to 100 MHz) that offer better resolution images. Generally, the high frequency ultrasound systems are used for medical

imaging. The lower frequencies, 1 MHz or less, have longer wavelengths and greater power at a given input energy. For signals at low frequency last longer time than those at high frequency, thus producing greater disruption of the medium and are used in therapeutic applications. In recent years, higher resolution,
5

real-time and color images and 3-D imaging are the trends for ultrasound image systems.

Subsonic Range

A /i`ki

Low frequency / : High power Okrasoupd high frequency/ ; :imaging Acoustic Microscopy Ultrasound Range

1

10

100

Ik

10k

100k

IM

lOM lOOM

IG

Figure 1.1

Acoustic Spectrum (in Hz)

1.4

Wave Fundamentals

Wave fundamentals include wave equation, acoustic properties of a media, reflection and refiaction, difi&action and scattering and intensity. All information will be helpful for us to imderstand the phenomena in our experiments.

1.4.1 The Wave Equation

As equation (1.1), the wave equation shows us how the wave travels along the media. M= Â«oSin((2;r/A)(ct-z)) = i/o exp(y(0t-Az)) (1.1)

The quantity 2ti/X is called the wave number; c is the velocity of wave travels along the z direction; the uo is the amplitude of the wave. Longitudinal waves travel in a medium at a velocity c= (K/p) , K is the bulk modulus of the liquid F

transverse and density p . Waves travel along a string at a velocity c= (F/q) is tension on the string and q is the linear mass density of the string.

In medical ultrasound systems, generally soft tissues are the media for ultrasound propagation. The force on particles can be expressed in equation 1.2.

p=
From c= (K/p) = And from equation (1.1), ^ = -- --v ; v is the particle velocity az c p = pcv we get K=pc^

( 1.2)

(1.3)

(1.4)

1.4.2 The Acoustic Properties of Media

Impedance is an important concept that characterizes wave propagation in the presence of boundaries between media with various acoustical properties. As applied in mechanics, the relationship between pressure, the velocity, and the quantity pc is analogous to that which exists in electricity between voltage and current and impedance (see Ohm's law). amplitude is referred to as impedance. Z = p !v (1.5) The ratio of force amplitude to velocity

Webster introduced impedance into acoustics in 1914. The specific acoustic impedance of an acoustic field is defined as the ratio of acoustic pressure to the associated particle speed on a medium. The simplest situation occurs with the propagation of a plane wave in an inviscid fluid mediiun. pressure-velocity relation (1.4) given by into (1.5) we obtain
Z = Zq=
pc

By substituting the

( 1.6)

where

is known as the characteristic (acoustic) impedance of the medium, p is

the mass density of the medium, c is the propagation speed of the sound wave.

Table 1.1

Characteristic Acoustic Impedances of Selected Media'Â® * * ^ ^ * Zo, MRayl 17. 44 38 Dry Air Water, Blood, Whole Human Bone, Fresh Bovine Phalanx Medium Zo, MRayl 0.0004 1.5 1.67 7.9

Medium Aluminum Steel (mild) Brass Mercury

20

The characteristic acoustic impedance of a medium is defined as the product of the mass density p and the speed of sound c of the medium. It has the S.I. unit of Rayl. The specific acoustic impedance for a plane wave equals the characteristic acoustic impedance of a medium. In Table 1.1 the impedances of various media are listed. We notice the impedance of air is so small that we need some water or other materials to match the impedance to the tissue be diagnosed. Otherwise all the energy is lost in reflection.

1.4.3 Reflection and Refraction

When an acoustic wave traveling in one medium encounters the boundary of a second medium, reflected and transmitted waves are generated. The following conditions must be satisfied at the interface: (i) the pressure is continuous; (ii) the particle velocity component normal to the interface is continuous. So pressure reflectivity and pressure transitivity of the interface at normal incidence are in equation (1.7) and (1.8) R=
Pi ^2

(1.7)

T = ^ =-- ^^2--
Pi
Â·^2

( 1.8)

R is reflectivity and T is transitivity;

incident pressure;

reflection pressure;

p, transmission pressure; Z2 and Z1 are impedances for two media.

1.4.4 Diffraction and Scattering 112116IIS3)

Two factors may cause the ultrasonic wave to spread or diverge in its propagation path in the medium: diffraction at the source and scattering by obstacles. Diffraction means the bending of waves around small obstacles and the spreading out of waves beyond small apertures. It always occurs at the edge of a finite source aperture. Since an aperture has to be finite, any practical sound wave that is radiated by a source will eventually diffract. Scattering can be defined as the change of amplitude, frequency, phase velocity, or direction of propagation of a wave as a result of spatial or temporal non-uniformities of the medium. The inhomogeneities arise due to variations in compressibility or acoustic impedance differences. As the scattering of the sound wave occurs, the secondary sound spreads out in different directions.

Scattering leads to spatial redistribution of acoustic energy, which in turn changes signal amplitude. The behavior of scattering depends on factors such as absorption, acoustic impedance mismatch, spatial distribution and scale of inhomogeneities, shape of scatterer, number of scatterers per unit volume and medium motion, etc. Absorption of ultrasound is the transformation of ultrasonic energy to heat by frictional forces. The energy loss mechanisms in absorption attenuation are both frictional force and relaxation in nature. In general, the degree of absorption is directly related to the fr-equency. Acoustic impedance mismatch occurs whenever there is a magnitude difference of soimd speed, mass density, or compressibility between the scatter inhomogeneity and its surrounding medium. The greater the mismatch, the more significant is the inhomogeneity and the stronger is the

scattering produced. The scale of inhomogeneities, including the size of scatters and the interspacing between them, is often used to categorize different scattering phenomena. Different sizes of scatterers follow different rules.

1.4.5 Intensity [171

The acoustic intensity of a wave is the average flow of energy through a unit area normal to the propagation direction per unit time. The intensity is the average of the rate of work done per unit area by one element of fluid on an adjacent element ^ = p v = --\p vd t And v = p /Z p = PQexp(jXaX-kz)) So that
2 2

(1.9)

pjo

--exp(2 exp(2y J(fi)t (6%-- kzy)dt Az))gft =-- -- z 2Z

(1-10)

From this equation, the intensity is the square of pressure p.

1.5 Ultrasonic IVansducers

The transducer is the heart of any medical ultrasound system. It converts the mechanical energy into electrical energy and vice versa. There has been a steady progression and refinement in transducer design over the past three decades. In the early days, people used single element, unfocused transducer. Based on the work of O'Neil'^ Â® ', the advantage of using gently focused transducers was apparent. The development of phased armular arrays provided a means of strongly focusing the received beam while maintaining a good depth of field. Around 1968, Somer
10

extended the phased array concept with a linear arrangement of transducers whose beam could be focused and steered across the body by the application of suitable delays to each element Afterwards, the real time pulse-echo systems based on

simple linear arrays began to proliferate.

1.5.1 Parameters and Materials

There are several parameters used to describe the piezoelectric properties. Transmitting constant is the strain produced in a piezoelectric material by application of a unit electric field. Receiving constant is the electric field

produced under open-circuit conditions per-unit applied stress. Coupling Factor describes the relation of output mechanical or electrical energy to the stored energy in a transducer. For a transmitter, a large transmitting constant is desirable; for a receiver, a large receiving constant is expected. If a transducer operates as a transmitter and a receiver, it is desirable for both the transmitting constant and the reeeiving constant to be large.

Several techniques, such as magnetostriction, electrostriection and thermally excited shock waves, have been used to generate ultrasound. The most practical

devices for medical purpose are based on the piezoelectric effect. Barium titanate, lead zirconate titanate (PZT) and Polyvinlidene difluoride (PVDF) possess strong piezoelectric properties. As a special class of piezoelectric ceramics, PZT is a successful material for medical transducers thanks to its strong piezoelectric properties and high Curie temperature. Furthermore, a lot of mixture can be added to PZT to change the composition a little, resulting in a wide range of materials optimized for different applications. But inherently high acoustical impedance of PZT greatly limits the application in construction of efficient, wideband transducers for medical scanning. Polyvinlidene difluoride (PVDF) is a type of

plastic that has a very strong piezoelectric property and relative low impedance.
11

The drawback of PVDF is its lower coupling factors and high dielectric losses. When we design an ultrasound system, the information on transducer equivalent circuit and impedance matching is important. It is discussed in Appendix C.

1.5.2 Focusing Field

An unfocused transducer emits an ultrasonic beam which spreads radially because of diffraction. The beam intensity falls off and the beam diameter is too large to obtain good lateral resolution when probing an object in the far field. Therefore, a focused acoustic beam is often used, as in optics, to obtain good lateral resolution and high acoustic intensity at a point of interest. The focused ultrasound pulse waves in a focal region are used so that the response of the microstructure in this focal region to the incident ultrasound wave could be probed with high sensitivity.

Focused ultrasound pulse waves can be generated by a single element transducer with concave surface such as spherical or cylindrical surface which functions similarly for a focusing optical lens. There are essentially three approaches to focus an ultrasound beam: shaping the actual transducer vibrating element, attaching a concave lens to the transducer face, and inserting a biconvex lens into the ultrasound energy path which is similar to focusing the light fi' om the sun using a magnifying glass.

The sound field of a transducer is a beam within which sound intensity varies. An unfocused beam can be divided into the near field and the far field. The near field is the region directly in front of the transducer where the echo amplitude goes through a series of maxima and minima and ends at the last axial maximum, at distance N=D^/4^ from the transducer, where D is the diameter of the transducer surface. The far field is the region at distances greater than N. Attenuation is effectively a gradual loss of energy. The ultrasound beam attenuates as it progress
12

through a medium. Attenuation in the near field is associated with edge diffraction, absorption and scattering. In far field, beam spread joins the three factors to attenuate sound intensity of the beam.

In Figure 1.2, A spherical focusing transducer has the following important characteristics: diameter D, focal length Fl which is the distance between the center point on transducer surface and the point of maximum echo from a point target, focal depth D % which is the pulse echo beam axial distance between two points whose echo amplitudes are -6 dB relative to the focal point amplitude, beam diameter (D J which is the -6 dB pulse echo beam lateral diameter at Fl the numerical aperture of a transducer is defined as the ratio of its focal length to its diameter(f#=Fi/D). The wave form of a transducer has the following parameters: center frequency

: dx

Figure 1.2 Focusing Transducer (fo), -3 dB frequency bandwidth ( A f(-3dB)), pulse duration which is the wave duration at the -20dB level or 10% amplitude per second. A transducer is often described by its center frequency fo, diameter D and numerical aperture f#.

The focal volume is roughly ellipsoidal, the intensity being reduced by 3 dB from the maximum value in x-y plane where the diameter is given by ( 1. 11)
13

where Kt is a dimensionless factor the value of which is dependent upon \|f, \|/<50Â°, Kt is taken to be equal to 1.0. The length of the focal volume in the central z-axis is given by D ,= K ,D ^ (1.12)

where Ka is a dimensionless factor, generally take it to be equal 15x(l-0.01 \)/), \|/ being expressed in degree. as G = ^-f Â·* 0 (1.13) The intensity "gain" of a focusing system is defined

If is the intensity at the focus, the Iqis the intensity at the surface of transducer.

1.6 Velocity, Attenuation and Absorption

1.6.1 Velocity of Sound in a Medium

The speed of sound and the mass density are essential acoustic properties of a medium. The propagation speed of a longitudinal sound wave in a fluid medium (c) is (K/p)'^. Generally sound propagates faster in solids than in liquids, and faster in Hquids than in gases. We employ a single velocity for one kind medium. This is true for most of the cases, but strictly the velocity will have a little dispersion in one kind of medium with many factors such as temperature, frequency and absorption characteristics.

In Figure 1.3, the accurate measurements on the propagation speed in pure water over the temperature range from 0 to 90" C are shown. For the temperature (10 to 40" C), the range of propagation speed is 1450 to 1530. In our simulation we use 1500m/s, corresponding to 27" C (room temperature).

14

1600
1550 Approx. Measured

M 1500 w 1450 1400 10 20 30 40 S O 60 70 80 90

T e m p e r a tu r e ,Â° C Figure 1.3 The Speed in Pure Water at 5MHz with Temperature 0-90

Since the speed of water is always used as the reference to measure the speed of the biological medium, the accurate measure of the speed of pure water is critical. Biological specimens are constantly far from being ideal in terms of their shape and achieving a good accuracy requires considerable care. One of the convenient methods is the substitution method based on observing the change in transit time of short ultrasound pulse when the specimen is removed from the propagation path and is replaced by a fluid whose speed is known.

1.6.2 Attenuation of Biological Medium 1.6.2.I Attenuation

When a wave travels through a real medium, its intensity is reduced as a fimction of distance. In practical, several factors contribute to this attenuation. These factors include: scattering by non-specular reflection, so that a propagation of the energy no longer moves in the original direction of propagation; and absorption, by which ultrasonic energy is converted into heat due to viscous loss.

Assume the amplitude of a plane wave propagates in the z-direction, so that the wave can be expressed in the form: 4= 4^""'
15

(1.14)

Where Ao is the peak value at z=0 of a wave variable such as particle velocity or the amplitude of the particle movement; Az is the peak value at z of the same variable; p. is the amplitude attenuation coefficient; z is the location in z-direction. It can be written in terms or either the intensity or pressure and is generally expressed in dB/cm (decibels/cm). =-- xl01og(-^) z 1, (1.15)

The presence of attenuation results in a phase difference between the pressure and the particle velocity, causing the specific acoustic impedance to contain both real and imaginary parts. Nonetheless, for attenuation coefficients that are not too large the pressure amplitude p Â«c I, so that IJ-dB = -- x201og(-- )
^
Pz

(1.16)

In the literature,

p is often quoted in units of nepers per centimeter, so that: (1.17)

Different tissues have different attenuation coefficients; the values for different tissues are listed in Table 1.2. Table 1.2 Approximate Attenuation Values for Human Tissue

Tissue Liver Kidney Spleen Fat Blood Plasma Bone

Attenuation dB/[MHz.cm] 0.6-0.9 0.8-1.0 0.5-1.0 1.0-2.0 0.17-0.24 0.01 16.0-23.0

16

For an attenuation of 0.7 dB/[MHz.cm], the sound be attenuated 2x1x40x0.7 = 56dB for a received signal from a 40MHz transducer investigating tissue 1 cm from the transducer, as the sound moves into the tissue twice.

1.6.2.2 Frequency Dependent Attenuation

The tissue attenuation is dependent on frequency with an increasing attenuation for increasing frequency. Since attenuation is a combination of the effects of absorption and scattering, its frequency dependence combines the frequency dependent attenuation of both factors. For pure fluids there will be no scattering and as a result the attenuation and absorption characteristics are identical. For tissues, absorption accounts for 75 to 95% of the total attenuation

Several experimental methods have been developed to determine the attenuation versus frequency characteristic of biological specimens. For most biological tissues the attenuation can be characterized by where Po denotes a

temperature dependent constant with units that can be expressed in Np/(cm.MHz^), / i s the frequency and expressed in MHz. n is generally around 1, but may lie in the range 1< Â« <2 (Figure 1.4). For pure fluids there will be no of scattering so all attenuation come from absorption. As illustrated in Figure 1.4, (n=2 for water and n=0.9 to 2.1 for bone), although the attenuation is generally much higher than soft tissue, it also exhibits a power law dependence over a more limited frequency range. A lot of methods have been made to use of the attenuation versus

frequency characteristics as a means of identifying abnormal tissue.

17

ioÃ»o ti.Ã®
100
,0.Â»

r lli

Â«04

o.oi

0.001 L
0.1

1 10 frequency (M H z )

100

1000

Figure 1.4 Tissues' Frequency Dependent Attenuation Coefficient

Due to the very complex composition of tissue, it has not been possible to derive a simple model that can describe the frequency dependence of the attenuation and most literature resorts to a simple phenomenological model. Frequency dependence attenuation into a frequency domain method of solution is straightforward. Expressed in the frequency domain, the amplitude attenuation transfer function for a plane wave propagating through tissue is: / f ( / ,z ) = exp(-(/Zo+/z,/)z) (1.18)

where z is the depth in tissue, f is frequency, P o is frequency independent attenuation coefficient, p i is frequency dependent term. So the wave can be expressed in frequency domain; P i f ) = P o { f,z)* H {f,z ) = (1.19)

This is an alternative approach to get frequency dependent attenuation signals. First Fourier transform the waveform, multiply by the transfer function and then perform an inverse Fourier transform to obtain the attenuated waveform. These
18

approaches will be used in Section 2.3.2.2 to model attenuation.

1.6.3 Absorption of Medium

Absorption accounts for 75 to 95% of the total attenuation

The classical

mechanism proposes that the absorption of ultrasound in fluid is due to the frictional force that acts to oppose the periodic motion of the particles in the medium. In addition to the classical theory of absorption due to viscosity, several other mechanisms may contribute to attenuation depending upon the properties of the propagating medium and the frequency of the wave, including relaxation processes, relative motion, bubble mechanisms and hysteresis.

Relaxation processes contributes to the ultrasonic absorption in biological materials. Energy in a system can exist in various forms, such as molecular vibration energy, lattice vibration energy. Energy increases in one or more of these forms when ultrasound wave passes through a medium. All the different forms in which the energy can be stored are coupled in various ways. Consider a small element of volume in a medium supporting an ultrasonic wave. A temperature rise causes an increase in the energy that the wave carries (due to the speed of sound increase with temperature). If none of this energy transformed into another form, the increased energy for temperature reason will return back to the vibration energy of the wave during the de-compressive part of the cycle, and no absorption will occur. In reality, however, this excess transmitted energy will change into another form during the compression cycle. During decompression, some of energy returns out of phase with the traveling wave, which causes absorption.

Relative motion is produced between biological cells and their surrounding medium by the ultrasonic field. It consumes some energy of the wave. The presence of gas bubble in the propagating medium will have a great influence on the biological materials. Almost all the energy will be sent back due to the
19

mismatch impedance. Hysteresis will occur, when the frequencies greater than the viscous relaxation frequencies. An excess energy will be consumed in a very viscous media.

Ultrasound diagnosis is less harmful than X-ray, but there are some side effects on biological tissue. Biological effects are discussed in Appendix D.

1.7

8) Scattering by Biological Materials |

1.7.1 Introduction

As we discussed in Section 1.4.4, scattering causes spatial redistribution of acoustic eneigy. Scattering behavior depends on several factors such as absorption, acoustic impedance mismatch, spatial distribution and scale of inhomogeneities, shape of scatterers, number of scatterers per unit volume and medium motion. If the scattered signals can be captured, it will contain a lot of information on the tissues, shape and angle of the boundaries between them, the structure and properties of tissues, and so on. In Figure 1.5, we can see the foot, mouth, spine and head of the fetus. There is a clear boundary between the fetus and the surrounding amniotic fluid. The skull boundary is not visible in the image, because there is the angle between the beam and the boundary and the sound back off in another direction. Still we can see the head of fetus due to the backscatter signal of ultrasound wave. Small changes in density, compressibility, and absorption give rise to a scattered wave radiating in all directions. And the backscatter signal is received by the transducer and displayed on the screen.

20

Boundary of p tac en ta Foot

Mouth

Figure 1.5 Ultrasound Images of IS *** Week Fetus

1171

As the scattered wave is formed from numerous contributors, it is appropriate to characterize it in statistical terms. The amplitude distribution can be characterized in a Gaussian distribution and fully characterized by its mean and variance. Generally the envelope of backscatter signal is considered more valuable information than backscatter signal itself.

Since the backscattered signal depends on the interference of waves from numerous small tissue structures, it is the deviations within the tissue and the composition of the tissue that determine the strength of the returned signal. The magnirnde of the returned signal is described in terms of the power of the scattered signal. Since the structures reradiate wave in all directions and the scattering structures might be ordered in some direction, the returned power will be dependent on the relative position between the ultrasound emitter and receiver.
21

1.7.2

Scattering Strength

Typically, only one transducer is used for transmission and reception in medical ultrasound. If only the backscattered signal is considered, the signal power generated by a single scatterer can be characterized by the scattering cross-section. If the scatterer is small so that the incident field has a uniform intensity, I;, then the scatter power is ( 1.20) where s$ denotes the scattering cross section in square meters. The scattering cross section is a measure of the scattering magnitude. It is the equivalent area of the scatterer that intersects a beam of intensity I, and reflects the power Ps. The backscattering cross section depends on the material and indicates the scattering strength of the material. Table 1.3 Contributions of Scattering to the Attenuation Coefficient Medium Fresh Human Liver Fresh Human Liver Fresh Skeletal Muscle Fresh Skeletal Muscle Human Blood, Hct=40% Human Blood, Hct=40%
2 0 s , cm"'

2a, cm'^ 0.72 1.4 0.94 1.8 0.17 0.37

Os la

Freq. 4MHz 7MHz 4MHz 7MHz 4MHz 7MHz

0.09 0.32 0.16 0.32 0.28x10'^ 1.8x10'^

12% 23% 17% 18% 0.1% 0.5%

Another useful measure of scattering is the backscattering coefiBcient which characterizes scattering from a volume of scatterers. It is defined as the average power received from a volume of scatterers per sterradian, the unit is l/[cm-sr]. As shown in Table 1.3, the backscatter coefficients correlate with frequency positively. At the same time, the scattering takes more part in absorbing the energy, which

22

means it is possible that strong backscatter signal can be obtained in high frequency. We notice that the attenuation coefficients also increase as frequencies increase. The penetration depth of high frequency ultrasound will be shallower than that of the lower frequency signal.

That is one of most important reasons why we are interested in backscatter signals in high frequency range. The backscatter signal takes more part of total attenuation eneigy with frequency. During the experiments we do find that the backscatter signal is stronger with higher frequency. So we hope these stronger high frequency backscatter signals can help us complete some new research. For example, this method might be used to classify different structures of tissue that are difficult to be classified by low frequency ultrasound signals.

1.7.3 Pulse Echo Response

In this section, some basic and simple models for ultrasound system will be provided as the basis of our simulation on the binary coded excitation method. For the effect of binary coded excitation is our aim, all the other factors such as backscattering model, attenuation model, coded methods and experimental system are chosen the simplest ones.

The simple ultrasound pulse echo system, such as that used in early diagnostic systems, is the system we developed and tested.

23

Transmitted Pulse Received Signal
Receive Gale

JZL
receive gate

Signal from Sample Volume
---------------- \ f ^--
I I

Figure 1.6 Simplified Representation of the Echo Response

As in Figure 1.6, a pulsed pressure is generated by a piezoelectric transducer and emitted into the tissue. The pressure propagates through the tissue and is partly reflected and scattered from changes in density and propagation velocity in the tissue. The backscatter signal is received by the same transducer crystal and amplified by the amplifier. The height of received signal indicates the strength of the signal. The horizontal axis represents time and is equivalent to the depth in the tissue. When assuming the speed is known, the relation of time and the depth of the tissue can be decided. If we send a standard pulse, a time gate can be used to filter the impulse response to a special point of scatter; this is very useful to judge the quality of the backscatter signals of binary coded excitation method.

In our experimental results section, the backscatter signals, when a one-cycle sine pulse is used as an excitated input into transducer, are always sampled and used as an evaluation reference for the results from binary coded excitation method. This backscatter signal from the one-cycle sine pulse input is called one cycle excitation backscatter signal or one cycle excitation.

1.7.4

Single Particle Model

As we have just started exploring binary coded excitation methods for high
24

frequency ultrasound we used a simple model to simulate the backscatter signal from tissue. Because the complex structure of most biological media, substantial approximations are required to be as tractable scattering models. For soft biological media one such model is based on the assumption that the media consists of a distribution of discrete scatterers imbedded in a background whose acoustic properties are constant. In this particle approach, the scatterers are assumed to be discrete entities with varying geometry and differing acoustic properties, and to have a certain spatial distribution. This is shown in Figirre 1.7.

transducer

A,

scatterer

ultrasound signal

backscatter signal

Figure 1.7 Single Particle Model of Scattering

= e,(0* wf

(0 Â·

(1.21)

W((t) and w^(i) are the electromechanical responses of the transmitter and receiver transducers and hs(t) is the pressirre impulse response of the scatterer. eoftj is backscatter signal and e,(7) is the signal sent out from transducer.

1.7.5

One Dimensional Scattering

We extend the single particle model to a one-dimensional scattering model. As Figure 1.8, one-dimensional scattering model is good to simulate one line of data acquisition system. The model is simple and effective and is explained in detail in
25

Chapter 2. The experimental prototype will make us focus on the coded excitation itself. Now the basic idea of the model will be discussed. For soft biological media, we can think the media consists of a distribution of small volume of scatterers. The small volume of scatterers can be regarded as points. As Figure 1.8(a), when only one line of backscatterers is considered, a distribution of a series of points forms the tissue.

All of ultrasound components are assumed as linear systems. As Figure 1.8 (b) demonstrates, all the points are divided into separate points. For each point, the backscatter signals will be calculated following the single particle model as in Section 1.7.4. When backscatter signals for each point are known separately and linear system properties are used at the same time, the superposition of backscatter signal for each point forms the total backscatter signal for all the points of line.
eoxit) = e , { t ) * w f { t ) * h ^ , { t ) * w f { t )

( 1.22)

^oN(0 = g, (0* Â«0 (0 = it) + e,,2 (0 + Â·Â·Â· +

(0* W

(0 * wf (0

(1.23)

=e, (0* (0* [K\ (0 + (0 + Â·Â·Â·+ Kn(01 * wf (0
where impulse response of each scatterer is given by

S^ft) is the backscatter strength; sound.

is the location of the scatterer; C o the speed of

26

transducer (a)

ouput scattering from transducer

Â·

(b)
Â·A

scattering from each scatterer

Figure 1.8

One-dimensional Scattering Model

1.7.6 Our Research Interest

Figure 1.9 Normal-Treated-Normal Pellet of Cells Using the 20MHz (A) and 40MHz (B) Transducers. The Treated Layer can Clearly be Differentiated due to the Backscatter Increase (-11 dB). H&E Stains of the Pellet from the Cisplatin Unexposed Top Layer

In some cases, the speckle of the ultrasound system is not noise. For example, we are interested in the scatterer patterns of different tissues. In this case the speckle is the signal we are working on. The cellular structure changes in tissues and cell
27

ensembles can be detected by high frequency ultrasound system. The following are some of the results.

A three-layer pellet (untreated tissues, treated tissues and untreated tissues) is created to better visualize the contrast anticipated. The first (bottom) layer of the pellet contains unexposed cells, the second (middle) layer 24h cisplatin exposed cells and the third (top) layer unexposed cells. Figure 1.9A and 1.9B show the images collected using the 20MHz and 40MHz transducers, respectively. It is easy to identify the treated layers from the untreated layers. At 20MHz (Figure 1.9A), all of the cell layers are visible, but at 40MHz (Figure 1.9 B), the bottom layer is not visible because the ultrasound has been attenuated at the higher level. The histology of the pellet corresponds well with the ultrasound images.

Figure 1.10 A Lymphoma Tiimor in Mouse Leg 40MHz Transducers.

In Figure 1.10, a lymphoma tumor is injected in the leg of a mouse, but the limit penetration depth prevents us from seeing the whole tumor. We hope to find a solution to increase signal-to-noise ratio to extend the penetration depth. The bright layer on the top is the skin.

28

1.8

Ultrasound System

Basic concepts of an ultrasound system will be presented here. It is our goal to devise methods to increase the signal-to-noise ratio in high frequency ultrasound applications. The coded excitation method is a possible solution to increase the penetration depth of high frequency ultrasound system and is helpful for us extend our study on the high frequency backscatter properties of tissues.

1.8.1 The Structure of an Ultrasound System

In order to determine the feasibility of using the binary coded excitation method, we constructed a new system based on what was used in our experiment.

tissue

impedance transducer matching

matching

power amplifier

puiser

matching

signal amplifier

filters

captureft display

Figure 1.11 The Structure of Ultrasound System

In Figure 1.11, the core of ultrasound system is the transducer. It can be used to generate ultrasound signal and receive the backscatter signal. There are two parts in the figure: the top part of the figure is used to generate the ultrasound signals; the lower part is used to receive the backscatter signal. First a puiser generates a small electrical signal and the signal is sent to a power ampUfier to amplify the
29

signal to be suitable to drive the transducer. A matching circuit between the amplifier and the transducer is used to match the input impedance of transducer with the output impedance of the power ampUfier and to cut the noise of the power amplifier firom the receiver circuit. Then the transducer sends out an ultrasound signal. The ultrasound signal needs some materials such as water to match the mechanical impedance between transducer and tissue. At the same time, the backscatter signal will trace back on the same path to the transducer. This time the transducer converts the mechanical energy to an electrical signal; the signal passes a matching circuit that matches the output impedance of transducer with the input impedance of the signal amplifier. After the signal amplifier amplifies the signal, the signal passes several filters to remove noise. In the end, the signal is captured and displayed after proper processing.

The most important thing of setting up an ultrasound system is selecting the proper transducer. The frequency, the material and the focus are considered carefully. After the transducer is decided, the proper power amplifier can be decided on considering the gain, the frequency, input and output characteristic. Then the matching circuit can be designed. The proper puiser is chosen. The design of signal generator of system is finished. For the receiver, the signal amplifier should be decided on considering the gain, the frequency, and input and output characteristic. After knowing the input impedance of signal amplifier and the output impedance of the transducer, we can complete the matching circuit design. The proper filters are used to remove the noise from the signal. Last thing to decide are the proper capture &display instruments, the sampling rate, the accuracy of the A/D, the store capability and sampling control.

30

1.9 Coded Excitation

1.9.1

Introduction

Coded excitation methods have been developed since the 1950% initially for use in radar to obtain improved range/resolution, and subsequently in communications systems. Later the application of coded excitation methods for improving the performance of ultrasound systems was initially explored for NDE

(non-destructive testing) applications and has recently been developed for medical diagnostic systems.

In pulse echo systems the signal-noise ratio can be improved by increasing the transmitter peak power and increasing the bandwidth can enhance the axial resolution. The limitations imposed by the transmitted peak power were first

addressed in radar and, stimulated in 1953 by Woodward, methods were developed for overcoming it. It was shown that by transmitting a suitably

encoded signal of over longer time duration and using a receiver that incorporated a matched filter (one whose response was the time reversed form of the transmitted signal), a time-compressed form of the transmitted signal could be produced. By spreading the transmitted signal over a longer duration a higher total energy can be transmitted without exceeding the peak power limitation and as a result, the depth of penetration and the signal-to-noise ratio can be increased. For ultrasound systems issues such as the permitted diagnostic levels and nonlinear effects limit the peak power that can be transmitted. Major signal-to-noise ratio improvements can be achieved by using coded excitation techniques and, some of which have been developed for low frequency medical ultrasound imaging.

31

1.9.2 The theory of coded excitation

Figure 1.12 compares a coded excitation system and a conventional pulse system. In a coded system, the excitation pulse extends over a period longer than the impulse response of the transducer. The excitation sequence includes all frequency components passed by the transducer. Because of this, the received signal can be correlated with a reference waveform to yield a compressed signal with impulse response closely approximating that of the normal pulsed system. The major advantage is that the SNR of the correlated pulse is improved over that of the normal pulse by a factor close to the time bandwidth product of the coded excitation sequence, while the instantaneous peak power keeps the same value.

a. Normal pulse excitation
j i n ^ .......

-- I
b. coded excitation

Figure 1.12 Conventional Pulse and Coded Excitation

Coded excitation is similar to sensitization in photography. The total energy of light exposure needed by the photographic film is in a certain dosage range. When the intensity of the light is high, exposure time is short. If the intensity of light is low, a longer time is required for the exposure. If the intensity of light is constant, the total energy of light on the photographic film is decided by the exposure time. The longer exposure time, more energy received; the shorter time, less energy collects on a film. The only different between coded excitation method and sensitization is how to "accumulate" the energy. The photons of hght are accumulated and collected by the photographic film directly; where coded
32

excitation completes this process by encoding and decoding the signal, the result of encoding and decoding the signal will compress the signal.

Now let us see how coded excitation methods are implemented. Generally cross-correlation methods are used in a coded excitation system. If two input signals Si(t) and tr(t) are cross correlated, the output of the cross-correlation So(t) is given: (t) = j Si(t + T)t^ ( r ) d r . Assume that the pulse echo impulse response

of a given transducer denoted by h(i). If the transducer is excited by a waveform et{t), then the received waveform eAf) is given by: ^r(0 = 4 (0 * W ) = If this is sent to a receiver system whose impulse (1.25) response is

h^(t) --e^(t) = ke,{-t), the output of such system is the autocorrelation of the transmitted signal. Where km is a matched filter constant, then, the output from the receiver will be given by (0 = Â£ , 4 (^ + (^) ^^

= J^4(^ + ^)*^m4(^)^^ =K (t)K (1.26)

eo(t) theoutput from encoded system; e,(t) waveformexcitation; e/t) received waveform;is the autocorrelation of the transmitted signal. In the frequency

domain, the relation between the receiver matched filter transfer function /f((D) and the input signal Â£^(Â©) is://(<Â») = Ã:Â£*(<y). E\cÃ¹) is the complex conjugate of the input signal.

A conventional ultrasound system and a coded excitation ultrasound system can be expressed as Figure 1.13(a) and 1.13(b). The difference between these two systems is that in coded excitation system a correlation operation of the received signal is required to compress the encoded signal. It is equivalent to a system
33

whose impulse response is received signal e^t).
System

= e^(t) )

(a)

e,(0 m

e,(t)

System Correlator

e j ( f )

Figure 1.13 Conventional Systems and Coded Excitation Systems

161

How does the autocorrelation operation work? For example, a.code sequence 11001110 is chosen to shown the output of autocorrelation of the sequence. As Figure 1.14 (a) and (al) shows, before the autocorrelation the amplitude of the signal is one (Figure 1.14 (a)), hut after correlation the peak amplitude is 5 (Figure 1.14 (al)). In Figure 1.14 (a) we used values of 0, 1 to express the code (code: 11001110) and in Figure 1.14 (b) the values of 1 and -1 are used to express the code (code: 11-1-1111-1), so its correlation peak amplitude is 9 (Figure 1.14 (hi)). The former is called uni-polar modulated method', the latter, called bipolar modulated method, has greater output than the first one. In communication theory, the bipolar method is more efficient encoded method than uni-polar or multi-phase methods. From the autocorrelation output, a series of sidelobes exist on the both side of the peak value. The values of sidelobes are different for different code sequences. If we choose a proper code, the sidelobes can be controlled.

34

I

(a) uni-polar code

(al) correlation of uni-polar code

W x < @ ^ : /3 W k Â« ^ Ã

(b) Bipolar code Figure 1.14

(bl) correlation of bipolar code

Encoded Method and Autocorrelation

1.9.3 Two Coded Excitation Methods

In high frequency ultrasound imaging tissue imaging, the presence of high attenuation and non-stationary targets reduces the possible types of encoding schemes that can be employed but some still retain the potential for achieving significant SNR improvements. Two different schemes that have been explored

for use in low frequency diagnostic ultrasound systems will be examined in details: the FM chirp and Golay binary codes. These two methods are classified by type of modulated signal. The modulated signals can be a pulse, a piece of continuous signal and a piece of frequency-modulated sweep. When the modulated signals are a piece of fi'equency-modulated sweeps, this method is called FM chirp. When the modulated signal is pulse or a piece of continuous signal, this method is generally Binary coded excitation method.

1.9.3.1 FM Chirp Coded Excitation

FM chirp coded excitation applications were first used in radar. This is a more popular coded excitation method than binary coded excitation. Articles have been published by Matthew O'Donnell's N. Rao's l^("IM 0||4i||42||43|^ Thanassis X

on this method. The main advantage of this method is that it can improve the
35

resolution and sensitivity. It is one reason why it is popular, another one is that it is used in radar systems and is easily implemented in ultrasound imaging system. The product o f time bandwidth is the theoretically attainable signal-to-noise (SNR) enhancement. For example lOps FM chirp with a center frequency lOMHz and a bandwidth of 5MHz. The time-bandwith is 50 times greater than a simple pulse echo system.

(a)

frefcjLiency "modulated sw eep (b) time  > (c)

end frpq." begin freq-

psÃ«Ã¼dochirp

(d) Figure 1.15 FM (Frequency Modulated) Chirp
161

Figure 1.15 (a) represents a series of frequency modulated sweep signals that are encoded by a special code. Figure 1.15 (b) denotes one region of the frequency modulated sweep signal. The frequency of signal changes with time; the range of change is shown in the third line. As Figure 1.15 (c) the frequency rises from the begin frequency to the end frequency during the duration time of signal. Generally a piece of frequency modulated signal is expressed as below:

t ( cx s(t) = rect(--)sQ cos a^t-V--t'^

(1.27)

where T is the duration time of FM chirp,

sq is

the attenuation factor, coo is the

angular frequency of the carrier, and a sweep rate is the slope of the linear chirp (Figurel.15(c)) a = fen d
fb e m

^

jg signal frequency at the end time of

36

signal duration T, and fbegin is the signal frequency at the beginning of the modulated signal. A coded excitation sometimes called pseudochirp is a close approximation to the ideal frequency modulated sweep signal as Figure 1.15 (d). generate in a digital system. This signal is easy to

Newjouse and Pedersen first suggested this implementing method of FM chirp used for medical purpose in 1973 (Figure 1.16) and Willy elm and Pedersen implemented such a scheme in 1993. First a code generator generates the code and the sweep generator generates the frequency-modulated chirp. The modulator modulates both of signals; the FM chirp signal looks like Figure 1.15 (a). The FM chirp is sent to transducer through a power amplifier. At the same time the signal is sent to a time delay device. The backscatter signals of FM chirp signal are returned from tissue and received by the receiver. An amplifier amplifies the signal. In the end, the delayed FM chirp signal subsequently cross-correlates with the received backscatter signal of FM chirp.

code generator

sweep generator

modulator

OAA

transducer

power am plifier

time delay cross co rrelatio n

receiver

am plifier

Figure 1.16 Implementation of FM Chirp From equation (1.27), the FM chirp signal can be expressed as / s(t) = rect(^^)sQ cos

(1.28)

To simplify the problem, assume attenuation factor 5'^ is 1, and that the matched
37

filter is h(f) = rect{--)sQ cos The output of the filter is m e^{t)= (1.29)

J recti--)cos{o)Qi:+ar^l2)cQs[(0a{t-t)-a{t-Tyl7\dT
^

(1.30)

-r /2

By using the trigonometric expression for the products of cosine terms, and ignore the fi-equency is 2(0o the result is: sin[ca(r-|f|)/2] gg(0 = rect[t/(2T)] cos(mot)at (1.31)

The duration time of output extends over twice the initial chirp duration.

A FM chirp, as shown Figure 1.17, is consisting of a 1Ops FM chirp with a center frequency of 5 MHz and a bandwidth of 2 MHz. Such a waveform has time-bandwidth product that is 20 times larger than a simple pulse echo system.

(a) FM Chirp Figure 1.17

(b) FM Chirp in Frequency Domain FM Chirp

The compressed signal is shown in Figure 1.18. It can be seen that the compressed form contains range sidelobes. Compare the amplitudes of sidelobe to that of the main lobe and the difference between them will decide how difficult it is to identify the presence of multiple scatterers. When a weakly scatterer is near a

38

strongly one, the main lobe of the weakly one is less than the sidelobe of the strong one. So that it may be diffÃ®cult to distinguish from the range sidelobes of the strongly scattering target. Much effort has been devoted to reduce sidelobes of compressed signal. A method that reduces the sidelobes is binary coded excitation.

CO

3 -1 0
15.

-20

Figure 1.18 The Compressed Signal 1341161

1.9.3.2 Binary Coded Excitation

(a)
-1
-1

-1

-1

-1

Figure 1.19

Binary Coded Excitation [61

As in Figure 1.19, a sequence of one cycle sine signal is coded by a binary code. When code is 1, one cycle of sine is used; when the code is -1, one cycle of
39

inverse sine is chosen. This bipolar method can maximize the energy of code. This method is chosen in my thesis, as few people have tested this method before. This method cannot improve the resolution, but it may be a solution to gain higher SNR than FM chirp methods.

In the FM chirp system, when we want to maximize the peak signal-to-noise ratio, the method called the matched filter is used. The transfer function of the matched filter is the complex conjugate of the signal spectrum. In a real system, especially in medical systems, the effect of frequency dependent attenuation caimot be ignored; the attenuation will increase greatly with higher frequency. Many experts believe that frequency dependent attenuation is the major reason why coded excitation application in the ultrasound field is fewer compared with that in radar
[34][6]

^

case, some mismatched filters will be introduced in signal processing, Both

for example Dolph Chebyshev window and Blackman Harris window of the filters can lower sidelobe levels.

1.9.4 Properties of Golay Code and Golay Code Pairs

Golay codes can be written as finite sequences of I 's and O's and they have the special property that their autocorrelation function can contain only three possible values: 0, 1 andiV, where is number of bits in the code. Figure 1.20 shows the

8-bit Golay code 1110010. If we assume that the transmitted signal is such that each bit has a duration of 1 second, it can be readily shown that the autocorrelation function consists of a central lobe of 2 seconds duration and a peak amplitude that is seven times larger than the side lobes. Compared to the other types of codes, the Golay code sidelobe energy is small.

40

(a)

Figure 1.20

Golay Code and Its Autocorrelation

A method can be used to eliminate the sidelobes using Golay code pairs. Figure 1.21 shows Golay code pairs of code length 8. The sidelobes of autocorrelation Golay code and its complementary Golay code have the same amplitude and inverse phase, so the sum of these two autocorrelations is delta function. This property is helpful in reducing the sidelobe of the system, so Golay codes are chosen for my thesis.

8

Figure 1.21

Golay Code Pairs |6|

41

All the signals are processed following the same procedures as described in Figure 1.21. The backscatter signals from the encoded Golay signal and its reference cross correlate, so as the backscatter signals from the encoded complimentary Golay signal and its reference. We add these two middle results together to obtain the final decoded signals. These results are called encoding results.

As in Figure 1.22, GE company manufactures a kind of digital coded excitation and compression ultrasound system (proprietaiy). This system has shown that significant improvements in penetration depth and SNR can be achieved clinically.
LHC u s e IHttl MEDICHL CENTER

MAR-29-00 11:24:20 20cm20cm BH7 c SU HBDMENl FROZEN 29G29 72DR72

TIS=2. 7 MI=0. 4 HO=100Si (a) co n ven tion al US signal, (b) Golay coded e x c ita tio n sign al

Figure 1.22

Golay Coded Excitation Signal and Conventional Signal

The Benefits of Coded Excitation are Clearly Demonstrated in this Side-by-side Liver Comparison. Note the 20-cm Penetration while Maintaining 7-MHz Resolution Sources* * httD://www.gemedicalsvstems.com/rad/us/Droducts/log TOOpro/msuS 85.html As marked in Figure 1.22, the high signal-to-noise ratio using the coded excitation method in Figure 1.22 (b) allows us to identify the rim of the liver tissue easily,
42

while the rim of the liver signal in conventional ultrasound system at same depth is not easy to distinguish in Figure 1.22 (a).

1.9.5 The Components of a Binary Coded Excitation System

The coded excitation ultrasound imaging system has several parts: signal generator, code generator, modulator, transducer, receiver and decoder (Figure 1.23). First the ultrasound signal and codes signal are generated, then a modulator modulates them, then coded signals are sent out by transducer into the tissue, and the backscatter signals are received by the receiver, in the end these received signals are decoded by the decoder. In our system, we use golay code and complimentary golay code to modulate the original ultrasound signals, because golay code is the most useful code for coded excitation by suppressing the sidelobes. We know that a code with a 6 -function autocorrelation is an ideal one for imaging. For any practical code, the duration is restricted so that a 6 -function autocorrelation function can never be obtained, but if we use golay code and complement golay code together, then the added autocorrelations of these two codes is very similar to a 6 -fimction (Figure 1.21). This will be usefiil to reduce the range side-lobes.

43

complement code code transducer

MUX

MUX

Figure 1.23

Coded Excitation System

In this chapter we introduce almost all the basic concepts in ultrasound system and coded excitation method. From now on we will discuss simulation and implementation of binary coded excitation method in high frequency ultrasound system. Some conclusions are made based on the results from our simulations and experiments.

44

Chapter 2 Methodology

2.1

Introduction

There are two parts in this chapter. In the first part backscatter simulations for high frequency ultrasound using a coded excitation system are presented. In second part we describe the experimental system built to implement the binary coded excitation method.

2.2

Simulation of Coded Excitation

The structure of a binary coded excitation system is introduced in Section 1.10.5. A binary coded excitation system includes: a code generator, a signal generator, a modulator, a transducer, a receiver and a decoder. The function of the code generator, signal generator and modulator is to generate binary coded excitation signals. The function of transducer and receiver is to generate a signal and receive the backscatter signal from the object we are interested in. The function of last part, decoder, is to process the received signal.

binary coded signai

backscatter signai

processing signal

Figure 2.1 The Structure of Simulation

Figure 2.1 demonstrates the three parts needed to simulate the binary coded
45

excitation method; these three parts correspond to the three different functions of the coded excitation system.

In the binary coded signal section, we will discuss how to generate a binary coded signal in detail. The questions such as the type of codes, how to get the codes, the signals we use to simulate and how to modulate them will be answered in this section.

In the backscatter signal section, we will discuss how to model the backscatter signal. The backscatter signals have direct relation to transducer, tissue and the medium that ultrasound signals travel into. The questions such as how to implement one-dimensional backscatter model, how to take into account tissue attenuation, how to simulate spacing of scatterers, will be addressed. In the signal processing section, we will discuss the different methods to process the received coded signals. In the last section we will present some basic concepts that will be used to evaluate our results and draw conclusions.

2.2.1

Encoded Signal

In order to generate binary coded excitation signal, four questions are required to be answered clearly: What kind of codes are selected? How is the code generated? What kinds of codes are used? What type of modulator is chosen? The modulator is discussed in Section 1.10.2.

2.2.1.1

Golay Codes

The Golay code pairs are discussed in Section 1.10.4. The autocorrelations of Golay pairs have sidelobes with the same amphtude and inverse phase, so that their sum has no sidelobes. The smaller the sidelobes, the better the system resolution is. In our system the Golay code pairs are chosen.
46

Marcel J. E. Golay first published the Golay code pairs in 1951. We will investigate the effects of different code length. How can we get the Golay code pairs? Let us see the definition and properties of Golay code pairs. ,

2.2.1.2

Code Generation

The definition of Golay code pairs:

a set of complementary series is defined as a

pair of equally long, finite sequence of two kinds of elements which have the property that the number of pairs of like elements with any given separation in one series is equal to the number of pairs of unlike elements with the same separation in the other series

Figure 2.2 illustrates a pair of complementary Golay sequences. We can demonstrate the symmetry of Golay code pairs' definition from this example. Sequence 1 has four pairs of like elements with separation of one; three pairs of unlike elements with separation one. Whereas Sequence 2 has 4 pairs of unlike elements with separation of one; and three pairs of like elements. Table 2.1 summarizes the results of the element pairing for separation 1, 2, and 3**.

From the analysis, we can see complementary codes possess symmetry. We can use this property to generate different Golay code pairs. Assume a and b are Golay code pairs. If we concatenate these two pairs as c= [a, b], d=[a, -b], the results of cascade operation c and d are still Golay complementary code pairs. In this case we can get different code length very easy. This symmetry makes code generation straightforward.

'Source: Com plem entary Code Keying M ade S im ple (Bob Pearson)

47

SEQUENCE 1
-1 1 1 1 1 L _ ^
x

1 - 1 L_,
M

1

L _ ^

T
LIKE ^

T
UNUKE \ LIKE

\ UNUKE UNUI

SEQUENCE 2
1 -1 -1 1 *1 - 1 1 -1

I

I

L
- J T y ^ l
U K E

r
/

7

-

^
\

1 UNUKE

U N U K E/

Figure 2.2 Golay Code Pairs
Source: Com plem entary Code K eying M ade S im p le (Bob Pearson)

Table 2.1

Results of Element Pairing for Sequence 1 and Sequence 2

SEQUENCE 1 PAIR SEPARATION 1 2 3 UKE 4 4 1 UNLIKE 3 3 5 (

SEQUENCE 2 LIKE 3 3 5
.

UNLIKE 4 4 1

Source: Com plem entary Code Keying M ade S im p le (Bob Pearson)

The code lengths are two, four, eight and sixteen respectively. The Golay complementary pairs for code length two are: {1, 1} and {1, -1} or {-1, -1} and {-1, 1}. Beginning with these two pairs we can construct two groups, the two
48

groups of Golay complementary pairs for code lengths two four, eight and sixteen are: First group of Golay code pairs Code length two Code length four: Code length eight: {1,1} and {1, -1} {1,1,1, -1} and {1,1, -1,1}; {1,1,1, -1,1,1, -1,1} and {1,1,1, -1, -1, -1,1, -l)Ã®

Code length sixteen: {1,1,1, -1,1,1, -1 ,1 ,1 ,1 ,1 , -1, -1, -1,1, -1} and { 1, 1, 1, - 1, 1, 1, - 1, 1, - 1, - 1, - 1, 1, 1, 1, - 1, 1}

Second group of Golay code pairs Code length two: Code length four: {-1, -1} and {-1,1} {-1, -1, -1,1) and { -1, -1,1, -1} {-1, -1, -1,1,1,1, -1,1}

Code length eight: {-1, -1, -1,1, -1, -1,1, -1} and Code length sixteen:

{-1, -1, -1,1, -1, -1, 1, -1,-1, -1, -1,1,1,1, -1,1} and {-1, - 1, - 1, 1, - 1, - 1, 1, - 1, 1, 1, 1, - 1, - 1, - 1, 1, - 1}

The length of the focal volume Dz of ultrasound field (Section 1.5.4) will limit the maximum code length. If the code length is longer than the time that signals pass focus depth, it means only part of code is in the focus region. The part out of focus region will be weak and have less contribution to the signal received (Figure 2.3). For the transducer used in the experiment, the diameter is 12mm; the center fi-equency is 40 MHz; the radius of the curvature is 10 mm, so the Dz is about 2mm. Assuming a sound speed of 1.5mm/ps, the backscatter signals pass such distance in 2xDz/l.5=2.7 ps. The center frequency of our signal is 40MHz, therefore the period of our signal is l/40M=0.025ps. Due to the transducer inertia, the signal cannot be sent out continuously. Some time is required to restore the transducer. The time for one pulse is 6 to 7 times of period. So the time for one pulse is 6x0.025=0.15ps. The maximal code length is the time passes the length of focal area over time needed for one pulse. This can be expressed as:

49

J __ focuselength ^ co d e ~ ~ ^percode

(2 . 1)

For our transducer, the maximal code length is 2.7/0.15=18. For a different transducer, the number is different. Only this limit needs to he considered in high frequency ultrasound system (30-50 MHz or more) in the choice of code length.

transducer

(a) focusing transducer

transducer

(b) unfocused transudcer

Figure 2.3 Long Coded Signals in Focusing and Unfocused Transducer

In Figure 2.3 (a), the black ellipse area represents the focus depth of a focused transducer. If the coded signal is longer than the depth of transducer, the pulses out of focus area are so weak that they have less contribution to the received energy by transducer. If the code is shorter than the focus area, it can be thought as an unfocused transducer. Therefore, all the coded pulses have the same contribution to the received energy by the transducer.

In our simulation we do not consider the focusing effect so that our simulation can be regarded as an unfocused system. We find the amphtude of backscatter signals increases with code length. In the experiments, code lengths of 2 and 4 show this trend. Code lengths of 8 and 16 show odd features as explained in Section 2.4.2.

50

2.2.1.3

Modulated Signal TÃ¿pe

Three different types of modulated signal are used in our simulations. Initially we just used one cycle of sine signal (as in Figurel.21). In our system, the center frequency of transducer is 40 MHz, so the period of one cycle sine signal is 25ns.

Experimentally, we measure the emitted pulse using a reflection of a quartz plate as in Figure 2.4(a). In the second type of signal used, we emulate the pulse emitted by a real pizeoeletric transducer. The equation used to simulate the real system is p{t) = - t exp(-4y9^t^ ) sin (2 ^ t) t> 0 (2.2) (3 is the -3dB

where fo is the center frequency of transducer 40 MHz,

bandwidth (different from attenuation). In the simulation, the signal lasts about 3 periods of center frequency ( Figure 2.4 (b) ).

3 periods of center frequency

the thrpc periods of cpntcr frecjuency

Q O tS 5 0 Ã

..

^

* .-- '

Figure 2.4 (a) Emitted Signal from Transducer (b) Simulation Signal

In both figures y axis is amplitude of signal and the x axis is the time in ns. Most of energy of emitted signal is in the three-cycle periods we annotate.

To better represent the experimental pulse, the second method to modulate the
51

signal is a series of sine of signal modulated by exp (-4 P^t^) alone.

If yg= 4, the

signal lasts three periods. We use the first three period of the signal as the pulse response of system. One bit of Golay code corresponds to such pulse response. One modulated signal is shown as Figure 2.5 (a). In Figure 2.5 (a) the modulated signal for each bit of code comes from the three periods in Figure 2.4(b). The modulated signal in Figure 2.4(b) is sine signal modulated by the factor exp (-4 P^t^). In order to see the effect of exp (-4 p Â¥ ), three continuous cycle sine signals are used as another modulated signal in Figure 2.5 (b) as reference. The encoding results from these two types of modulated signals will show how the factor exp (-4 P^f) works in the binary coded excitation method.

Ã 5
'200

6 0 0

8 0 0,

1000

1200

Figure 2.5 (a) The Second Modulated Signals (b) Reference Modulated Signal

Comparing the two signals, Figure (b) uses three-cycle sine per code pattern. In Figure (a) the three cycles are modulated by factor exp (-4 P^t^). As we expected, the encoding results of Figure (a) have more sidelobes** than Figure (b) due to the signal modulated by the factor exp (-4 P^f).

The third modulated signal is shown in Figure 2.6. The transducer requires several
In my thesis, the small reflection pulses due to transducer inertia and small signal from cross correlation are referred as sidelobes.

52

periods (time = 0.15ps) to restore. So we sent one cycle of sine signal, then a separation, and second pulse. The real backscatter signal from quartz plate is shown in Figure 2.6 (a). The real reflection signal in Figure 2.6(a) is compared

with the signal in Figure 2.4(b). The signal in Figure 2.6 (a) is regarded as three-cycle sine modulated by the factor exp (-4 P^t^) and some sidelobes mixed in the three-cycle separation between the pulsers. In second method, we also chose three cycles of sine signal and three-cycle separation as modulated signal (shown in Figure 2.6(b)). As we had discussed in the second method, by comparing the encoding results for the signals in Figure 2.6(a) and Figure 2.6(b), we can see how the factors exp (-4 pV) and sidelobes between pulses work in the binary coded excitation method.

i-1

.08

4 )2
4)4

Figure 2.6 Third I^pe of Modulated Signals

Comparing the two signals. Figure 2.6(b) uses (three-cycle sine and three-cycle separation) per code pattern. In Figure 2.6(a) the three cycle are extra modulated by the factor exp (-4 P^t^) and some sidelobes noise in the separation. So comparing their encoding results, we can see what the effect of both factor exp (-4 P^f) and sidelobes. As we expect, the sidelobes in the separation of pulse increase more sidelobes in encoding results. By comparing the encoding results in Figure 2.6 (a) and Figure 2.5(a), we can figure out how the sidelobes in the separation
53

work in the coded excitation method. By simulation of many cases of modulated signals we can see what the effect of special factors, such as sidelobes and exp (-4 P^t^), in the binary encoded excitation method.

2.3 Backscatter Signal

In this section, we simulate the backscatter signal from tissue. There are three subsections: one dimensional scattering model, attenuation and spacing.

2.3.1

One Dimensional Scattering Model

The basic idea of the one-dimensional scattering model has been discussed in Section 1.7.5. The backscatter signal will be calculated using a quasi-periodic one-dimensional model. Backscatter signals are dependent on the scatterer density and scatterer spacing. In order to simplify the backscatter signal calculation, the diffraction, attenuation beam width and focusing effects are ignored.

The quasi-periodic arrangement of scatterers was simulated by distributing scatterers with periodic locations; the spacing distances between scatterers was assumed to be a Gaussian random variable with certain mean and standard deviation. The mean, or the scatterer spacing between scatterers Az was choosen to be 7 to 10pm which is the distance between the normal cells in biological tissue. The membrane and nuclei of cells are believed to be the major contributions to backscatter signal for high frequency ultrasound in biological tissue. Since the scatterers in tissue rarely display perfect periodic arrangement, the standard deviation of spacing is O.OlxAz.

As shown Figure 1.8, the superposition of echoes from all the scatterers within the
54

scaterer region will give us the backscatter. The formulation can be expressed as KO = 2 jt= i --- ) c (2-3)

Zk is the location of the A * * * scatterer from the origin, O k is the backscattering coefficient of the scatterer , p(t) is the transmitted pulse, N is the number of

scatters present within the range cell, and c is the velocity of sound (assumed 1500 m/s) chosen to be within the range of values measured for soft tissue.

2.3.2 Attenuation

In medical ultrasound systems, attenuation reduces the signal amplitude and is frequency dependent The properties of attenuation are discussed in Section 1.6.2. We simulate three different cases of backscatter from tissue: without attenuation, with frequency independent attenuation and with frequency dependent attenuation.

2.3.2.1

Frequency Independent Attenuation

For the case of frequency independent attenuation, we calculate the backscatter using: p = Pa*e~^ (2.4)

where jj. is the attenuation coefficient. The approximate attenuation values for human tissue range between 0.5 to 1 dB/MHz cm (table 1.2). In our simulations we use 0.77dB/MHz cm.

We can convert this to Np/MHz.cm using M^p =0A\5\M jb (2-5)

so the attenuation in Np(Nepers) is O.OSSNp /MHz.cm. Therefore, at 40 MHz
55

|4,=3.5 Np/cm =0.35Np/mm,

2.3.2.2

Frequency dependent attenuation

The basic idea of frequency dependent attenuation is discussed in Section 1.6.2.2. For most biological tissues the attenuation can be characterized by an attenuation constant \i{J) = Po/">where po is a temperature dependent constant with units that can be expressed as Np/(cm.MHz^) a n d /is the frequency and expressed in MHz. n is generally around 1, but may lie in the range l<n<2. We assume n=l; the attenuation coefficient has a liner relation to the frequency of signal. Figure 1.6 demonstrates n for different tissues. The frequency dependent attenuation is = (2.6)

In this formulation attenuation is divided into two parts: frequency independent attenuation and frequency dependent attenuation, po determines the frequency independent attenuation; pi determines the frequency dependent attenuation.

Equation (2.4) looks like equation (2.6), however, one is expressed in time domain and the other in frequency domain. Figure 2.7 demonstrates the difference between them.

2 *153

F rÃ©u sn cy M H z

^

,1 .0 0 .

Figure 2.7 Attenuation in the Frequency Domain at 10mm

56

In Figure 2.7, the y-axis is attenuation in dB and the x axis is frequency in MHz. The plain attenuation in the frequency domain is flat. But in the FD attenuation model, the attenuation linearly increases with frequency. The penetration depths for both flgures are 10mm.

In order to calculate the backscatter signals with frequency dependent attenuation the Fourier transforms of the unattenuated backscatter was multiplied by the attenuation transfer function and then an inverse Foiuier transform was used to obtain the attenuated waveform. pU ') = Po i f , ^ ) * H{ f , z ) = p , { f , z ) * e (2.7)

The values for fjo and //i were: 0.35Np/mm and 0.0086Np/mm, respectively. The procedure is shown in Figure 2.8. For all scatterers, the attenuation factor was recalculated according to their location.

Figure 2.8 demonstrates the steps involved in the implementation of FD attenuation. Figure 2.8 (a) is a coded signal. The signal is expressed in frequency domain in (b). Then a series of FD attenuation coefficients versus frequency (similar to Figure 2.7) are calculated. We multiply the signals in frequency domain by their FD attenuation coefficients based on their corresponding frequency range. From Figure 2.8 (a) and (e), we can see the signal in high frequency attenuates more than the low frequency part.

57

transforms

FFT I ^

(b)

(a)

IFFT
X

Â» I 'Ã Â· u> Â· ' 1' i i ' 

P D
attenuation 4
:26

(d)

transform

;K I
>\

(c) 1 ,3 X

Â«Â«

J! 

' .. Ã
(e)

i
Figure 2.8 Implementation of FD Attenuation.

In the Figures (b), (c) and (d) the x-axis is the frequency in MHz; In Figure (b) and (d) y axis is the ampUtude of signal in frequency domain. In Figure (c) y-axis is the attenuation in dB. In both Figure (a) and (e) the x-axis is the time and y-axis is the amplitude of signal.

2.3.3

Spacing

In our simulations, we consider two different sets of spacing; sparse and dense spacing. In sparse spacing the distances between two adjacent scatterers are large enough to identify each backscatter. In dense spacing the distances between two adjacent scatterers are about the diameter of cells (7 to 10 pm).

The sparse spacing model was used to analyze if our implementations were correct or not and to examine the effect of FD attenuation on the incident pulse. In each simulation the sparse spacing was implemented first. Then, if the result was correct, we used dense spacing in the program to simulate tissue backscatter. For example, from Figure 2.9 (b) it not easy to verify if the signal is implemented
58

correctly, but in Figure 2.9 (a) we can identify the correct signal by zooming into the signal.
X
^

' " T

f'

GOIAY CODE LENGTH 8

'

*2

0 .5 '

1. ,

15' 2 25 3 3.5 ' 4 '' ' 'DISTANCÃmm* '

^45 ' \

S ' .5.5 x ' r '

:2

.'4 ' ' 6

1 0

(a) sparse spacing

(b) density spacing

Figure 2.9 Simulation Results with Different Spacing

In both figures y-axis is the amplitude of signals and the x-axis is the penetration depth in mm.

2.3.4

Processing Coded Backscatter Signals

In Section 1.10.2, a code sequence itself is chosen as a processing reference signal to cross correlate to the received signals for the coded excitation method. The next few sections deal with the proper choice of the cross-correlation reference. Three different reference signals are introduced to process the coded excited signals in this section. They are reflection reference processing method, code reference processing method and code with phase reference processing method.

2.3.4.1

Reflection Reference Processing Method

In the first method the reflected signal from a quartz plate is chosen as a reference signal. When studying the backscatter signal from a quartz reflection, the
59

processing reference signal is the same as the signal. In Figure 2.10 (a) one quartz reflection for code length 2 is shown and in (b) is the processing reference. When the signal in Figure 2.10(a) is truncated and then normalized its maximal amplitude to 1, we get its processing reference as Figure 2.10 (b). Before sampling real backscatter signals for a coded sequence, we should save the quartz reflection of this coded sequence to use as a cross correlation reference. This method is referred to as the reflection reference processing method and is equivalent to processing the signal as a matching filter.

/ ,1000

1200;

lÃ¼ClO ^ '1 6 0 0 ,

^

(a) Reflection signal for code length 2

(b) reflection reference signal

Figure 2.10 Reflection Reference Processing Method

2.3.4.2

Code Reference Processing Method

In most simulations we used the code reference processing method. The basic idea in this method is that Golay codes are used as processing reference. For example, when the code is 1 and -1, we use one cycle sine per code-modulation. The encoded signal sent to the transducer is shown in figure 2.11(a) (dot one). For the bit of 1 in code we use one cycle sine pulse; one cycle inverse sine is used to represent the bit o f -- 1 in code. The backscatter signal from quartz reflection is the solid line in Figure 2.11(a). We can consider as our cross-correlation reference, the thick dot dash line in figure 2.11(a). To be consistent with the excitation pulse, we extend the 1 bit Golay code to 25 ns (one period of 40MHz).

60

The backscatter signal from the quartz plate, however, has three cycles of signal. We can extend the length of code to 3 cycles to achieve higher gain. And generate a new processing reference. The reference is the thick dot dash line one in Figure 2.11(b). Since both references are directly derived from the code 1 and -- 1, both methods are called code reference processing methods. In order to identify these two methods, the first one in Figure 2.11(a) is called the one-cycle code reference and the second one in Figure 2.11(b) is called the three-cycle code reference.

The three-cycle code reference processing method produced the worst results compared with the others, because it mixes all signals together. The one-cycle code reference processing method has the interesting property that its encoding result has the same shape as the reflection from one pulse excitation as shown in Figure 2.12(b). Therefore the axial resolution will be similar to the conventional one pulse excitation. Later in chapter 3 we will see the encoding results from other processing methods consisting of 6 cycles instead of 3. So the axial resolution for all other processing methods degrades by half compared to the one-cycle code reference processing method, but these methods provide high encoding gain.

I e y e le t
03

.?3 cycles f.

Z D-

^ 60

AXi

:J Ã O

(a) one cycle code reference

(b) three-cycle code reference

Figure 2.11 Code Reference Processing Method

61

In Figure 2.11, the y-axis is the signal amplitude and the x-axis is sampling points. The sampling rate is 5 GHz so the period of each cycle is about 25ns.

(b) Encoding results form one-cycle (a) reflection from one pulse code reference processing method

Figure 2.12 Results from One Cycle Code Reference and Reflection from One Pulse

This Figure (a) is the quartz reflection of one puiser input, (b) is the encoding results from quartz reflection of code length 2 processing by one cycle code reference processing method. Both signals have the same number of large pulses.

2.3.4.S

Code with Phase Reference Processing Method

The third method is referred to as the code with phase reference processing method. This method also uses the code as the cross correlation reference as the second one does. The encoded signal is sent into transducer as dot line shown in Figure 2.13(a). For the bit 1 in code we use one cycle sine pulse; one cycle inverse sine is used to represent the bit of -1 in code. The backscatter signal from quartz reflection is blue solid one in Figure 2.13(a).

62

The only difFerence is that the signal phase is considered this time. The reference we still use is 1 and -1. But we divide one cycle input sine (25 ns) into two parts in Figure 2.13 (a). When the encode sine signal is half positive one, we use 1 for half cycle 12.5 ns and -1 for 12.5 ns for the negative half cycle of sine. The thick dot dash line is cross correlation reference in Figure 2.13 (a). In order to accumulate all the energy for the 3 cycles we extend the code with phase to 3 cycles as we did for the code reference method.

I-,

0 8
0 .5 c y c le

5 cycles

w .)

.0 6

(a)

One Period Reference

(b)

Three Periods Reference

Figure 2.13

Code with Phase Reference for Cross Correlation

In Figure 2.13, the y-axis represents the signals and the x-axis the sampling points, (the sampling rate is 5 GHz so the period of each cycle is about 25ns)

Both figures in Figure 2.13 demonstrate the code with phase reference processing methods. The method shown in Figure 2.13 (a) is the one-cycle code with phase reference method and that in Figure 2.13 (b) is the three-cycle code with phase reference method. This time the three-cycle code phase reference almost doubles the gain than the one cycle code phase reference.

63

2.3.5

Simulations

A schematic of how the computer program I developed in MATLAB is shown in Figure 2.14. Input parameters are the time interval, the number of scatterers, the center frequency, the attenuation coeflBcient and the spacing Az. Then Golay code and complimentaiy code are used to modulate the signal to calculate the signal to be sent out. The third step uses a random function generator to generate the deviation of the distance between scatterers. The fourth step is to calculate the time shift for different points. In the fifth step, the pulse signal is convolved with each scatterer (equation 2.3). In the models of without attenuation and with fi'equency independent attenuation, we just multiply the result with an attenuation factor; the procedure of frequency dependent model is discussed in section 2.S.2.2. We add all calculations for each scatterer to form the received signal. In order to find out encoding results for the coded sequence, we can cross correlate the backscatter signals from Golay code with its reference and complimentary code with its reference separately and finally add these two cross correlation results together to obtain the encoding results.

64

set time,

the spacing and scatterer num ber and all the i n i t i a l values

decide the modulated signal and reference signal

decide the p osition for a ll scaterers

Calculate the distance of each scaterer from original point and time shift

calculate backscatter signal for each scaterer

summation of a l l signals from each scatterer

correlate the processing reference and received signal

add the correaltion resu lts from G olajr coded sequence and complementary one

Figure 2.14

Schematic diagram of the Program

2.3.6

Evaluation Methods

As the purpose of this investigation is to evaluate methods that would increase the signal to noise ratio in high frequency ultrasound, signals with and without pulse encoding must be compared. Several methods that can be used are described as follows.

The simplest way to evaluate the signal gain is by comparing the signal amplitudes. The autocorrelation of codes can be used to analyze the results of a sparse spacing simulation and quartz reflection from our experiments. Another way is by exerting the Signal to noise ratio.

65

2.3.6.1

Signal to Noise Ratio

This method is veiy important to evaluate the coded excitation method. Only the increase in signal to noise ratio can deepen penetration depth. For our system, noise comes from multiple sources including the transducer and preamplifier. The received signal strength due to a scattererer at a given depth will depend on the incident signal strength, the attenuation, and the backscatter coefficient. For the signal will be weaker with depth, the signal to noise ratio is depth dependent and can be defined by: oj.jj^-the received signal power noise power n)

In ultrasound systems, generally two types of noise needed to be discussed. They are random noise and speckle noise. Random noises such as the receiver thermal noise and the amplifier thermal noise are white noise and the white noise is uncorrelated. But the speckle noise is not white noise. It comes from interference of waves backscattered from many closely spaced scatterers (spacing much smaller than the compressed pulse width). Speckle noise results from a convolution process and is uncorrelated.

Receiver SNR :kte

0

Penetration depth x frequency (cm MHz)

30

Figure 2.15 Noise Type and Penetration Depth x Frequency

66

How to consider the white noise or speckle noise in an ultrasound system?

As

Figure 2.15 shown, Hill give a relation on the noise type to penetration depth x frequency by studying the concept of contrast resolution. From this figure, at lower frequency and shallower depth, the speckle will make major contribution to total noise; at higher frequency and deeper depth, the receiver thermal and other white noise will be dominant in SNR.

But sometimes the speckle is not noise; we are interested in speckle pattern. The speckle signals have some information of the structure of tissue and it is this information that we are interested in for our application. For example, all of the signals in Figure 1.9 are speckle. From Section 1.7.2 we know that scattering contributes more in high frequency range to the attenuation coefficient, so speckle in high frequency is stronger than that in low frequency.

Since we study high frequency ultrasound system (40MHz), and we are mainly interested in the structure patterns, the speckle noise will be neglected. We assume the noise from transducer and preamplifier are white over the bandwidth of system If the noise power density is Nn, the total energy of noise is expressed as Nnx If the received signal is sinusoidal pulse of duration T and amplitude A is considered, the energy of received signal can be expressed as: (2. 12) So that:

If the optimum reception filter is used the bandwidth A f =1/T, the formulation can be change into: SNR=-- Nn (2.14)

From Equation (2.14) if we want to increase the SNR, we should increase the amplitude of signal and decrease the noise level. Increasing signal amplitude
67

directly is limited by the safety concerns and nonlinear propagation distortion. So in binary coded excitation method the diuntion of signal is increased to increase the total energy to be received.

Figure 2.16 A Real Backscatter Signal from Bovine Liver

How can we estimate the signal and noise power? If we can answer these two questions, then the SNR can be evaluated. The energy of signals can be expressed, as the mean of backscatter signal is almost zero, the STD (standard deviation) of the signal represents the power of the signal. For noise we can analyze Figure 2.16, a backscatter signal from bovine liver. From this figure we can see there are noises on both sides of backscatter signal. The STD of the noise amplitude can be used before cross correlation is used to estimate the power of noise.

How can we estimate the noise after the correlation operation? Assume the noise appears as independent random samples with variation o^. The resulting noise in the final estimation is likewise consists of independent samples (N the number of samples), with variation Nx cf. The reason is because the cross-correlation adds N independent samples for each output point. The amplitude of the noise in output is ^/n times that of the noise before cross correlation.

68

2.3.7

Signal Distortion

The ideal system is such a system that the output of system is the same as the input of system. There are some distortions in real system. A lot of factors cause the signal distortion. These factors include frequency dependent attenuation, inertia of transducer, accidental phase shifts during data acquisition, focus change and so on. We have to find a way to evaluate the signal distortion.

The correlation coefiicient can be used to evaluate the similarity of two signals. This method is often used in radar and sonar applications. The received signal reflected from the target is the delayed version of the transmitted signal, so the correlation can be used to evaluate the distortion of the signals.

2.3.7.1

Signal Envelope

When one cycle of sine signal is sent out from the signal generator, the received signal from the reflector is shown in Figure 2.4(a). It is difficult to compare this signal to the sine pulse.

The envelope of the signal from a point scatterer or reflector will be the same as the incident envelope provided there are no frequency dependent effects. It should provide an estimate of the envelope that closely matches the transmitted envelope. As presented in Figure 2.17, it is straightforward to determine the envelope. If

x(t) is a real received signal, then its Hilbert transform has a frequency spectrum identical to that of the input. Note that the phase components are all shifted by -90Â°, i.e., the Hilbert transform acts as an ideal -90Â° phase shifter. As shown

in (b), for a Gaussian received pulse, the envelope will be Gaussian and the Hilbert transformed output will be quasi-sinusoidal with a similar envelope.
69

0.3
0.2 0.1
Enveloi

0.3

0.2

Estimated Envel

Ã®lope^

Absolute Values

0.1 0.2

x(f) 0.1
Hilbert Transform

0.3 Tim e
(arbitrary sca le )

Tlme(arbltrary scale)

Figure 2.17

Getting Envelop of Signal by Hilbert Transform^^^

2.4 Experimental Prototype of Binary Coded Excitation System

In Section 1.9 and Section 1.10.5, the structure of ultrasound system and binary coded excitation system are discussed. Combining Figures 1.13 and 1.25, the structure of the binary coded excitation ultrasound system is shown in Figure 2.18.
code generator modulator modulated signal

tissu e

impedance matching

transducer

matching

power am plifier

encoded signal

matching

signal am plifier

f i lt e r s

capture^ display

correlation operation

Figure 2.18

The Structure of Binary Coded Excitation

In order to construct such a system, several questions such as how to choose the
70

signal generator, the code generator, the modulator, the power amplifier, the signal amplifier, how to design the filter, how to design matching circuit, how to sample the received signal and how to process the received signal, must be answered first.

In our project, a binary Golay coded excitation ultrasound system was successfully designed. I selected the first group of Golay code pairs fi' om Section 2.2.1.2. The modulated signal we used is a cycle of a sine signal. This one cycle sine signal was modulated with different Golay code pairs. An arbitrary waveform generator was used to complete this task. The functions of code generator, the modulated signal generator and modulator are implemented in the arbitrary waveform generator. The Golay code encoded signal is amplified and then sent to the transducer.

How are the received signals processed? In my experiment, we sampled transducer-received signal and saved them in files. Post-processing of the backscatter data were completed on PC. Therefore, no special hardware to implement the cross correlation operation was required.

2.4.1

The Experimental System

In Figure 2.19, the left blue instrument is the arbitrary signal generator; the middle white instrument is the power amplifier; the right one is the oscilloscope; there is a lab platform between the big amplifier and the oscilloscope; a transducer, signal amplifier and filters on the support of platform. Next we will discuss each part of the lab system.

71

Figure 2.19 Prototype Binary Coded Excitation System

I constructed the experimental system by myself. In the Appendix A, all the parameters of our instruments are listed. How to match electrical parameters of all the instruments of the system; how to generate coded signals by arbitrary waveform generator; how to design a low pass filter, a high pass filter and an expander are discussed in detail in this Appendix. The PCB layout and PSPICE simulation of our circuits are listed also.

After the lab system was set up, we took several months to adjust our experimental system. We successfully suppressed the noise problem as explained in Appendix B.

2.4.2 Two Interesting Phenomena 2.4.2.1 Transducer Focus

In common sense that the focus of a transducer is decided by the material, structure and shape of the transducer and varies with properties of surrounding
72

material in which the transducer is used. It is assumed that the focus of transducer has no relationship to the signal that is sent to the transducer and is primarily determined by the transducer geometry (Figure 1.4). However, we find that when we increased the code length from 1 to 16, the focus of the transducer changed, as measured by the location at which a quartz reflector was placed to receive the greatest backscatter signal.

In our experiment, the transducer focus, when the code length was 1, was measured and fixed. Then the input signal was changed to a Golay coded sequence, code length 16. The reflection signal is shown in Figure 2.20. The time in the figure is from reference index to time index. This time is the time between the excitation pulse and receipt of the signal from the transducer, so the time also represents the distance that the signal travels. The amplitude of the first

reflection is about 200mV. We kept the input signal unchanged and increased the distance (about Ips in time) from the transducer to the reflector. The amplitude of the quartz reflection increased (Figure 2.21). Specifically, the first several pulses decreased from 320mV (Figure 2.21) to 200mV (Figure 2.20). At the new position we get more energy than that at the old position, where is the transducer focus for one pulse. Therefore, we conclude that the transducer focus changes with code length. We are not sure why.

If you see the signal of reflection, we find it is cone shaped. When we use the encoded signals of code length 2 and code length 4, the reflection signals are uniform and the amplitude is near IV; while the maximal values in Figures 2.20 and 2.21 are just 550 mV. This extra attenuation means that the encoded gains for code length 8 and 16 are not as large as our simulation.

73

reference cursor time cursor

time I
ttfSfÃ® PÃ´

W

5f

f4 4:0jÃ®Ã®2Sa$^ A Chi / 3C4V

IT200^43*

Izi 0^*^ wS; ;

: r M - - # T '- r r r ''

i, r

^

I I



t - - ' - - ' - i i . . l . i , i i .' l i ;
-T-

J

 $

 jI time cursor

cone shaped

Figure 2.20 Reflection Signal for Code Length 16

preference cursor ptirae cursor
im , .-a ,:. .-A ', -  Â· : _;  > A
f>m 01 *337:07- %

tim e]
IggggÃ¿

:J
M 4,C w $2a3$A fT % X W X
A Chi / 3 WY

C W T & 2PÃ´$ n; 1 4mm 12: C O a : '14.S4#

j"

timeÂ«cursor

cone

Figure 2.21 Focus Point for Reflection Signal of Code Length 16

74

2A.2.2

Phase Shift

In the experimental prototype system, Golay code and complimentary Golay code pairs cannot be sent to the transducer at the same time. Both signals are sent in a certain sequence, as shown in Figure2.22, the received signals have a small moving phase shift. If the both Golay and complementary Golay are sent out simultaneously, the moving shift can be minimized and the moving phase shift has less blur effect on this binaiy coded excitation method. So it is not necessary to consider phase compensation. The solid and dot lines denote the quartz reflections of the Golay code and the complementary Golay code (code length 4). The moving distance between the two reflections is about 17 ns (20 to 30 pm).

I .

11000:: -, .i5oe-''vi2ooe4;).25por^;,i:>3ooev::>35oqK

;

Figure 2.22

Phase Shift Between Golay Pairs [1,1,1,-1] and [1,1, -1,1]

After we put some supporting materials to stabilize the platform, the moving phase shift between the Golay and complimentary Golay pairs disappears (as
75

shown in Figure 2.23). The solid and dot lines denote the quartz reflections of the Golay code and the complementary Golay code (code length 4). In this figure, both signals are not processed with manual compensation. Therefore, we assume the movement of the platform causes the phase shift. Since it is possible that our target tissues are movable, the phase shift has to be taken into account for binary coded excitation method. The phase shift from our platform can be solved by a careftil stabilization.

I l l i i M

U

i y

Figure 2.23

No Phase Shift after Platform is Stabilized

for Golay Pair [1,1], [-1,1] close to the backscatter signals from liver tissue

For the prior half bits in Golay code pairs we used (in Section 2.2.1.2) are the exact same. The beginning parts of the backscatter signals for Golay code pairs are the same also. This good property can be used to compensate the phase shift between the Golay code pairs. This compensation method is suitable to the reflection signals (Figure 2.22) and the signals from the real tissue(Figure 2.23). But it does not work for the signals from phantom that are too long and complex to compare.

76

Chapter 3 Results

3.1

Introduction

There are two parts in this chapter. In the first part I present simulation results for binary coded excitation methods. In the second part I will present some results from testing phantoms (materials used to emulate tissue backscatter) and real tissue using our binary coded high frequency ultrasound system. All my simulations and analysis of experimental results are implemented in MATLAB.

3.2

Theoretical Simulation Results for the Binary Coded Excitation

The models used in the simulations such as sparse spacing, dense spacing, with attenuation, with plain attenuation, with frequency dependent attenuation and different modulated signals are discussed in Chapter 2. We just present some important results. In all simulations the x-axis is the depth in millimeters (mm) and y-axis represents the amplitude of signals. In all the simulation results, the

amplitudes of signals have no physical unit and are relative values. We normalize the maximum amplitudes of input signal to unit 1 to compare our results.

3.2.1

Sparse spacing models

In the sparse spacing modle, the distances between two adjacent scatterers are long enough to identify each backscatter event. The sparse spacing makes it easy to analyze if the coded signal implementation is correct or not and help us understand how the different models work. In simulations we choose the code length of 8 as default length.

77

3.2.1.1

Pulse Compression without Attenuation

Both reference code and Golay coded signal are shown in Figure 3.1. The method to generate hoth signals is described as follows. First we choose the Golay code we want to use in simulation as discussed as Section 2.2.1.2. For example, {-1,-1,-1,1, 1,1,-1,1) is our choice. A sine signal is selected as the modulated signal and the bipolar method is used (Section 2.2.1.3). When the hit of code is -1, one cycle of inverse sine is generated and when the code is 1, one cycle of sine is generated; the Golay coded signal is shown in Figure 3.1(b). The reference code as shown in Figure 3.1(a) is the code itself but the number of sampling points for each bit of code is as same as the number of one cycles of the sine signal.

01

(b)

y v ;,

0.1

:0:15

0,2 ;

0 .3

Figure 3.1 (a) One Cycle Code Reference Processing Reference Signal (b) Golay Coded Signal. Code length 8 and code is [-1-1-1111-11]

Figure 3.1 (a) illustrates one cycle code processing reference. Compared with the examples in Section 2.3.4, this reference signal has zero separation between codes for there is no separation between neighbor pulses.

78

A one-dimensional scattering model is used to simulate backscatter signals (details in Sections 1.7.5 and 2.3.1). We set the scatterer spacing to 0.35 mm, as in Figure 3.1(b). The backscatter signal is shown in Figure 3.2. We notice the amplitude for all the backscatter signals is 1, which is the same value as the input signal in Figure 3.1 (b). When zooming in any portion of the backscatter signals, the decoded result is shown in Figure 3.2(b), which is the same signal as the original input signal as Figure 3.1 (b). The result is what we expect by one-dimensional scattering model.

t3 (X A Y C O D E L E N G T H 8,

G O L A Y C O D E L E N G T H 8

' \

DISTANCEmw" '

jr -

3 S' :;:

.3 .9 .:3 S 5 .,-'4

.v o ew joe m m

:,,4.05



4J;

4.25.

!Â·

'

(a) Simulated backscatter signal

(b) Closer examination about 4mm

Figure 3.2 Backscatter Signal from Sparse Spacing without Attenuation

In simulations, I just use code reference processing method (Section 2.3.4). In this method the extended codes (as Figure 3.1 (a)) are used as cross correlation reference to decode the backscatter signals (as Figure 3.2 (b)). The encoding results ' for Golay code are gotten. The same thing done for the complimentary Golay code (the complimentary Golay backscatter signal is cross correlated with its corresponding reference code) and the decoded result for complimentary Golay code is gained. When these two decoded signals are added together, the encoding result is formed (Figure 3.3).

Throughout my thesis, the encoding results are always described by the sum of Golay code backscatter cross correlating to its reference and its complimentary Golay code backscatter cross correlating to its reference.
79

Ã C G D :N G % SU LTF6R b0lAY CODE LENGTH'S' ' "

y"5 0 0 f4 0 0
=/'300

2 Ã U "Ã¼ .1 0 0

r , '5 0 0 r/;400 I tf ."

ENWDINS RESULT FOR GOUY CODE LENGTH 8

I ; ^^.1 0 0
-2 0 0
' -3 0 0 -4 0 0 -6 0 0
1/
'

I'2
,

'3

'

4. ,,

,5 / '

' '.9 0 0
, ' 3.8 38S 39 .395. 4 ' 4.0S 4.1 4.15 .4 .2

D'STANCEmm-

,, / %'

LÂ« y :.> < . / .o v v ,,',w

. ' .D IS lW x v E fo m,

,

....

(a)

Simulated backscattered signal (b)

Closer

to

examination

of

after decoding (encoding result)

encoding result (4mm)

Figure 3.3 Encoding results from Sparse Spacing without Attenuation (Code Length 8)

In Figure 3.3 we notice that the amplitude of the encoding results is a little more than 500. Pulse compression through the cross correlation operation accumulates the signal energy. The amplitude of reference signal is always 1 or -1, so the cross correlation is similar to calculating the sum of sine signals. In our simulation the sampling number for one sine cycle is 100. When we add half cycle of sine signal, the first 50 positive values, together, that is, ^ s i n (
n=i 100

n) ; the sum is 31.825. The

code length is 8, so Golay and complementary Golay codes contain 16 cycles of sine signals. The sum multiplies the number of sine cycles, 31.825x16; the result is 509.2. This value is the same as the amplitude in our result. The encoding result looks like a sine which is the same as the encoding bit.

3.2.1.2

Pulse Compression with Plain Attenuation

As discussed in Section 2.3.2.1, we multiply the signal with an attenuation factor in the case of plain attenuation. For different scatterer points, we calculate their corresponding depth and adjust the signal amplitude with the attenuation factor. The
80

backscatter signal using sparse spacing and plain attenuation is shown in Figure 3.4. The encoding results are shown in Figure 3.5.

G O tA Y C O D E L E N G T H 3,
. 0.1

< ^ IA Y :G 0 D EL E N G T H 8, 0 0 8 0 0 6 s O -0 4 r

b

Â·002

Â· 0 .D 4 Â·0 0 6

';0 0 8 Â·0 1
1 .2 3 X ' 5 ' 6 -7 D I S T A N C E r r .f n' 1 3' : J ',^ 1 6 5 . c3 .9 . 4- . 4 .0 5 -'14 .1 .; , 4 1 5 ^ : 42

oswee m m. r

r

'

(a) Simulated backscatter signal

(b) Closer examination about 4mm

Figure 3.4 Backscatter Signal from Sparse Spacing with Plain Attenuation

When we compare the backscatter signals with and without attenuation, the only difference is that the signal amplitude decreases with depth. Plain attenuation has no effect on the shape of signal (Figure 3.5). The result from plain attenuation is similar to that from without attenuation; the difference lies in the decreased signal strength with depth.

81

PSOPERTYOF fiYERSQN UAliVÃfiSlTy LIBRARY

ENCODING RESULT FOR GOLAT CODE LB^GTH 8 , -

ENCODING RESULT FOR GOIAY CODE LENGTH 8 ;

' 4 0 0

'3 0 0
>
[ .100

3 0

Ã

0

0

' .too
 .200

-S':, :io
.-2 3

'^ 3 0 0
.4 0 0

.3 3 Â® 0 1- 2/' 3 .: ^5 S , 'J. % 8
r:' , DISTANCE mm -, : "

y .Â» ./ ..

,3.85., ' 3 .8 , - ;,'3.K ,,

.^ .D I S T A N C E m m

4-

4 .0 5 ' '.

..

(a)

Simulated backscattered signal (b)

Closer to examination of

after decoding (encoding result)

encoding result (4mm)

Figure 3.5 The Encoding results for Sparse Spacing with Plain Attenuation (Code Length 8)

When comparing the amplitude gains for different depths, the gains for different depths are almost same (Table 3.1), the small differences are due to the precision of data. The first row represents the scatterer depth; the second row lists the maximum value from the encoded backscatter signal. If one accounts for the attenuation factor e'^, the values are the same as in figure 3.4. The third row lists the maximum after pulse compression, this value just read from Figure 3.5; the last row is the ratio of output maximal to original maximal, which is called encoding gain. It is used to evaluate the effect of pulse compression.

Table 3.1

Encoding Gains for Different Depths with Plain Attenuation 0.2mm 0.765 386 505 3.4mm 0.0107 5.5 510

Location depth (in mm) Input max. Output max. Encoding Gain

82

3.2.1.3

Frequency dependent attenuation

The methodology used to simulate frequency dependent (FD) attenuation is discussed in Section 2.3.2.2. The backscatter signal of code length 8 with FD attenuation is shown in Figure 3.6. The entire signal is shown in part (a) and close up regions are shown in part (b) and part (c).

simulated backscatter signal for FD attenuation

4 j) il'i n 1 j V 4::
-

l ii h

/ \

-- i | H | 1 1 i N i u ( i 1 # i ! 1

/
' C l

Ci Â·

\

n

V$

(b) Closer examination of backscatter signal at 0.6mm

(c) Closer examination of backscatter signal at 8 mm

Figure 3.6

Backscatter Signal from Sparse Spacing with Frequency Dependent Attenuation

In Figure 3.6 (b) and (c) the distances along x axis are almost the same so they show us an entire cycle of coded Golay signal. The distortions with depth are easily identified.

When the depth is about 0.6 mm (Figure 3.6(b)), at the locations of phase inversion
83

the valleys are reduced due to the loss of the high frequency signal components. When depth is about 8 mm (Figine 3.6(c)), the signal is distorted beyond recognition due to loss in high frequency components of signal.

The encoding results using FD attenuation are shown in Figure 3.7. There are sidelobes between every scattering event and the amplitude of the sidelobes become larger with depth. When depth is about 0.6 mm, as Figure 3.7 (b), the encoding result is similar to that of plain attenuation, but there are small sidelobes. Compared with the amplitude of signal about 400, the amplitude of sidelobe is 9 at this depth. When depth is about 8 mm, as in Figure 3.7 (c), the encoding result is not similar to the plain attenuation any more. Sidelobes (amplitude 11.2) cannot be ignored in this case. The time duration of sidelobes is even a little longer than the duration of the

signal. The gains become smaller with depth as sidelobes occupy more signal energ. Therefore, not only is the encoding gain much reduced due to frequency dependent attenuation, but also the resolution of the binaiy coded excitation system is degraded by the sidelobes between the backscatter.

Table 3.2

The Gain for Different Depths with FD Attenuation 0.2mm 0.894 464 520 3 mm 0.305 163.5 536 6mm 0.155 68.8 443 9mm 0.0859 33.4 388

Location depth (in mm) Input maximum Output maximum Encoding Gain

In Table 3.2 sometimes the maximal gain is more than 536, even greater than without attenuation. The reason is that the distorted signal energy in the FD dependent attenuation model happens to be in the same phase with the signal as the instantaneous signal amplitude value is used. The trend of encoding gain is to decrease with depth. While the signal amplitude is not a good method to evaluate encoding gain, it is helpful for us to analyze our sparse spacing model and the

84

quartz reflection in our experiment.
 e N c d b iN G GAINS Ã¨ o L Ã v Ã§ b Ã´ e u e N ÃªV H .s k q -M Ã Ã´ Ã© l"

.3 0 0

DISTANCE mm

(a) Simulated backscatter signal after decoding
. g

065

mm
Figure 3.7 Encoding resultss for Sparse Spacing with FD Attenuation (Code Length 8)

3.2.1.4

Effect of code length using sparse spacing models

Similar simulations for code length 2, 4 and 16 were also performed. Without attenuation and with plain attenuation, the results from simulation are almost the same. When two sequences of Golay code and complimentary Goaly code are used, the encoding results always looks like a sine signal. The only difference is the amplitude of the encoding results. The amplitude gains for different code lengths are found to be linearly proportional to the length of the code, as we expected.
85

3.2.1.5

Impulse Response for the Coded Excitation Method

The definition of impulse response is the mathematical fimction that describes the output waveform that results when the input is excited by a unit impulse. In the simulations we send pairs of unit signal (Golay code sequence and complimentary Golay sequence). After the binary decoding method (the sum of Golay code backscatter cross correlating to its reference and its comphmentary Golay code backscatter cross correlating to its reference), the encoding results are obtained. Therefore, the encoding results are regarded as the impulse response for the coded excitation method in difterent attenuation models.

In Figure 3.3(b) and 3.5(b), the encoding result is similar to a sine, the chosen unit in the Golay sequence (Figure 3.1). After pulse compression, a perfect sine pulse replaces a sequence of sine signals in our result. The impulse response of the system approaches a 5 function. For the plain attenuation or without attenuation models, the binary coded excitation method is very suitable as a method to increase the signal. The impulse response of binaiy coded excitation for these systems is a 6 function. For biological tissues, significant FD attenuation exists. As shown in Figure 3.7, the result is not a perfect sine any more. Significant sidelobes exist, reducing the encoding gain and degrading the system axial resolution. These sidelobes increase with depth.

3.2.2

Dense Spacing Models

3.2.2.1

Without Attenuation

When we change distance between scatterers from 0.35 mm to 7pm, the result for the same Golay coded signal is shown in Figure 3.8 (Golay code {-1,-1,-1,1, 1,1,-1,1}) . The amplitude of the input coded signal is in range -1 to 1 in Figure
86

3.1; the amplitude of backscatter signal is in the range of -2 to 2. With no attenuation, the statistical amplitude of signal is almost the same with depth.

Figure 3.8 Backscatter Signal for Dense Spacing without Attenuation Length 8)

(Code

The encoding results of the backscatter signal for dense spacing without attenuation model are shown in Figure 3.9. The values in the beginning and end are artifacts (above 500). In the middle of the signal the peak value is 320.

BOO
, 400

, S U M O F c r o s s C O R R E L Ã T lO N .G O LA Y ; C O D E ,L E N G T H 2

^

-4 0 0

-BOO ' ' DISTANCE.mm,^

10

X\

Figure 3.9

Encoding resultss of Dense Spacing without Attenuation (Code Length 8)

Standard deviations (STD) of the signals can be thought to represent the signal energy. In Figure 3.10 (a), the STDs of original backscatter signals for four different

87

code lengths are plotted: thin solid line is for code length 16; thick dot line is for code length 8 (signal in Figure 3.10); thick solid line is for code length 4; and thin dot line is for code length 2. As later we will study the similar properties for plain attenuation and FD attenuation models, we divide the signal into 32 segments, based on the length of the code. For code length 8, its duration is 0.2ps and length is 0.3mm, so the signal of 1cm depth is divided into 32 segments, and each segment have the same length as the length of encoded signal: 0.3 mm. In order to compare the results for different code lengths, the signal is always divided into 32 segments. In the model without attenuation we do the same thing by dividing whole signal into 32 segments. The x-axis represents the different segments according to depth, and y-axis denotes the STD values of the backscatter..In Figure 3.10 (b), we list the STD of encoding results for four different code lengths.

S T D c fB A C K S ,C A T rE H SISimht 4d O lÃ YC O D EL E N G T H S 2 5 0 -- le n g th1 6  le n g th s Â· -- Â»le n g th4 le n g th2

;S T D o fE N O O O L N G R E S U L T Shr4G O L A Y C O D EL E N G T H S -- le n g thIB Â·Â·Â· le n g th s -- le n g th4 .... le n g th2

.5 tic

Â·3 0 S E G M E N T SO FS IG N A L

(a) STD for 4 backscatter signals Figure 3.10

(b) STD for 4 Encoding results

The STD for Four Code Length. All Data Come from Dense Spacing without Attenuation.

The average STDs of original backscatter for codes length 16,8,4,2 are listed in Table 3.3. The Gains for code lengths 2 and 4 are linearly increase.

Table 3.3

The Relation of Code Length and Encoding Gain. All Data from

dense Spacing without Attenuation at 6mm Depth Code length Input STD Output STD Encoding Gain 16 1.03 178.80 172
8

0.67 87.67 131

0.52 47.70 92

0.34 20.93 61

3.2.1.2

Plain attenuation

The same simulation is implemented as described in Section 3.2.1.2 after the distance between the scatterers is changed from 0.35mm to 7pm. backscatter signal is shown in Figure 3.11 (a). The result of

After the same reference code is

used in the cross correlation operation, the encoding results are shown as Figure 3.11(b).

^ s'

backscatter sfgnal of golay coda

' ' . 6 0 0

;S U M O FC R O S SC O R R E L A T I O N O O lA Y C oe E OE N G T H B' . - '

'

X _ ,2 ^ 4 / ' 6 ' ; , 8 , : 10;:' ' 1 2 ; ' % ' d is ta n c em mV ' '

2.,. \ . 4 -'

6.

(a) Backscatter Signal from Golay (b) backscatter signal after decoding sequence Figure 3.11 Backscatter Signal in Dense Spacing Model with Plain Attenuation (Code Length 8)

In the beginning of the encoding results, there is an artificial large amplitude value.
89

This is similar to the case without attenuation. After we separate the signal into 33 segments, the STD for both signals are shown in same type lines in Figure 3.12. There is a large increase in the STD indicating a substantial encoding gain.

'S T D o fB A C K S C A T T E R S I G N A L Sf o r4G O L A Y C O D E L E N G T H S -- te n g tn1 6 Â·Â·Â· k n g ih S -- le n g th4 le n g th2

Â» Sroo fE N C O D I N G R E S U L T Sftl4G O L A Y C O D E L E N G T H S -- le n g th1 6 Â·Â·Â· le n g th s -- le n g th4 Â» Â·Â·Â· le n g th2

;

2 0 0

tu I S O

,5 /' ' 1 0 % -15

.sE O M E N T so F a o N A i:

' ;;

3 0 /":35 .

0

,6-

-15' 20

"-Ã5 Â·' '30... -35

(a) STD for backscatter signals Figure 3.12

(b) STD for Encoding results

STD for Four Code Length Dense Spacing with Plain Attenuation.

The results for the model with plain attenuation are almost the same as those from without attenuation; the only difference is that attenuation factor varied with depth exists in plain attenuation. This result is the same obtained for sparse spacing models.

3.2.2.3

Frequency dependent (FD) attenuation

With FD attenuation,

the results are shown in Figure 3.13 (for the backscatter

signals) and Figure 3.14 (for STD of these signals).

90

b a c k s c a tt e r sig n a i o f g o la y c o d e :

' BACKSCATTER.SiGliS. QF:.CÃÃ>eiÂ£N<Sm 8

r4 0 0

. DISTANCE m m : "

'

(a) Backscatter Signal from Golay sequence

(b) backscatter signal after decoding

Figure 3.13 Backscatter Signal for Dense Spacing with FD Attenuation (Code Length 8)

When the backsactter signals for the plain attenuation model are compared with the FD attenuation model backscatter (Figures 3.11 and 3.13), the amplitudes of signals in depth for FD attenuation are greater than these for plain attenuation. In the plain attenuation simulation results the signals from 6 to 10 mm are too small to identify (as Figure 3.11(a)), but the signals can be identified in the same depth for FD attenuation (as Figure 3.13(a)). The amplitudes for both signals from 1 to 6 mm are almost the same. The reason is that in FD attenuation model the signals lose less energy in the low frequency portion of the signal. For details see Section 2.3.2.2 and Figure 2.8.

When studying the STD for the four different code lengths in Figure 3.14, we find the trends of STD for different code length in two figures differ. The STD for code length 2 (thin dot line) sometimes is greater than that of the other codes for deep locations. The lower frequency signal contents for code length 2 are greater than these for code length 4, 8 and 16 so the code length 2 retains energy in depth better than the other three. But after the processing, as Figure 3.14 (b) illustrates, the STDs of encoding results for the four code lengths are in order of length (the longer the code is, the greater the STD). The longer code can accumulate more energy than
91

the shorter one and the "accumulation effect" is greater than the loss in high frequency.

ST D

L E N G T H S -- le n g th1 6 Â·Â·Â· le n g th8 -- Ien Ã¿ h 4 Â·Â·Â·Â· le n g th2

STDofEN C Q bltiGR ÃªSÃLTÃ^ 2 5 0

lEhGTHS: -- le n g th1 6 Â·Â·Â· len g th s -- le n g th4 " le n g th2

200

lioo

'./SE G M E N T S OF SIGNAL

; : _ .,//

. SEG M EN TSO FS IG N A L .

(a) STD for backscatter signals Figure 3.14

(b) STD for Encoding results

STD for Four Code Length (Dense Spacing with Plain Attenuation)

3.2.2.4

Simulations with closely spaced scatterers

As for the sparse models, the signal amplitudes for foiu different code lengths are compared. The closely spaced scatterers emulate the tissue backscatter. By comparing the STD ratio of the four different code lengths, we represent the gain accomplished with the coded methods. In Figure 3.15 the STD ratios are shown for both the without attenuation and plain attenuation models. The trend for the STD of the backscatter signals and encoding results for both the plain attenuation and without attenuation simulations are almost the same and the ratio for each segment is almost constant (Figures 3.10 and 3.12). We find the ratio increases linearly with code length, and the ratios for both models are almost the same.

92

180

160

120
100

Figure 3.15 Average STD Ratio for Four Code Lengths

600 length 16 length 8 length 4 length 2 .400

## * m Â»*

.100

>30
; > . S E G M E N T S :O F ;S IG N A U

Figure 3.16 The Ratio of STD of Four Code Length FD Attenuation )

(Dense Spacing with

For the FD attenuation model, the trend for four code lengths is different (Figure 3.16). The ratio for the different code lengths increases with code length, code
93

length 2 being the smallest one. But the ratio for the code length 8 sometimes is greater than code length 16. The reason for large STD ratio of code length 8 is that the STD value of backscatter is much less than the other three (Figure 3.14 (a)).

In this section, simulation results were discussed. All of the simulations show that the binary coded excitation method is capable of increasing the amplitude and STD of the high frequency ultrasound signal even in the case of frequency dependent attenuation. The encoding gains generally increase with code length. In the next section, I present some results from the binary coded excitation system.

3.3

Experimental results for the binary coded excitation system

From this section on experimental results are presented. The reflection signals from a quartz plate are acquired first. The quartz reflection backscatter signals are similar to the sparse spacing model in Section 3.2.1, as they are easily to analyze and helpful for us to try different processing methods. Then some results from phantoms are presented. Phantom is a good substitute for real tissue as it has stable properties. Tissue decays rapidly with time and will change the properties of ultrasound backscatter signal. Another advantage for phantoms is that they are easily to dimmobilize in water but the real tissue floats. Water is used for transducer impedance matching as discussed in Section 1.5.3.2. In the last section signals from liver tissue are presented.

In the simulations, length 8 was chosen as the default code length. In the experiments the binary coded excitation using a code length 8 was not optimal (details in Section 2.4.2.1.). Since the encoding results of short code lengths have smaller sidelobes than longer ones, code length 2 was chosen as the default code length. In all figures with experimental results, their x axis represents the sample
94

number. In all figures with experimental results, the x-axis represents the sample number. Since the sampling rate is 5GHz, the time between two points represents 0.2 ns.

3.3.1

Three Processing Methods

In Section 2.3.4, three different processing methods were defined. In the simulations we used the second method, the one cycle code reference processing method. One cycle of sine per code was used to obtain the coded signal and the processing reference was either 1 or -1 for each bit code. It is not clear, however, which method is best. Therefore, the three methods are compared.

The first method is the reflection reference processing method, in which the backscatter from a quartz plate is used as the cross correlation reference. The second method is the code reference processing method, in which the code is used as a cross correlation reference and the reference length for each bit of code is one cycle of the center frequency. The third method is the code with phase reference method, in which three cycles of the are used center frequency for each bit in the reference and the reference is 1 or -1 based on the phase of the signal.

In the first method, thÃ© signal and its reference happen to be the same so the auto correlation operation replaces the cross correlation. When the reflection is used as the reference, the reflection is truncated as shown in Figure 3.18 (a) (solid line). Noise and sidelobes are truncated from the reference which improves the quality of encoding results.

95

(a) quartz reflection for code len. 2 (b) Encoding results for reflection (a) Figure 3.17 Signal and Encoding resultss using the Auto Correlation Method

Figure 3.17 (a) shows the quartz reflection for code length 2. The y axis is the signal amplitude in voltage (which is proportional to pressure), and x is the sample number. In Figure 3.17 (b), the encoding results for the reflection reference processing method with code length 2 are shown.

refÂ«rencÂ«

_ _

1

.Q <* //2 0 0; ,

' 'G O O .: '/ B p Q . -, ,1 0 0 0y/;1 2 0 0

0

2000

4000

8000

10000

12000

14000

16000

(a) Back signal and its reference Figure 3.18

(b) Result in code reference method

Signal and Encoding results in Code Reference Method

Figure 3.18 (a) shows the quartz reflection for code length 2 and its reference for the one cycle code length. In Figure 3.18 (b), the encoding results for the one cycle code reference processing method code length 2 are shown. The processing
96

reference is shown in Figure 3.18(a), The solid signal is signal from reflector; the thick dot dash line is the reference from code (details in Section 2.3.4). We call this method as code reference method.

The code with phase reference method is shown in Figure .3.19 (a), the solid signal is also the quartz reflection and its reference (the thick dot dash line) also comes from code but the phase of signal itself is considered (details in Section 2.3.4).

0.8

f* t.

f Â·

0 .4
0.2

0

200 .

400

.

600

'

000 .

M0CX3

> 1200 - .

(a) Back signal

and its reference

(b) Code with phase as reference

Figure 3.19 Signal and Encoding results in Code with phase Reference Method When comparing the encoding results for these three methods (Figures 3.17(b), 3.18(b) and 3.19(b)), the maximal amplitudes of results are about 115 for the reflection reference, 63.3 for code reference and 214 for code with phase reference. The sidelobes for the code with phase method were the smallest. Therefore, we chose the code with phase reference method to analyze our results.

In Figures 3.17(b), 3.18(b) and 3.19(b), the amplitude of the beginning of these signals is zero. Before Matlab cross correlates two signals, it fills zeros into short signals to make them in the same length (zero padding). These zeros force the beginning of signals to be zero. In the following sections, we remove the padding from the encoding signals. The truncated signals are helpful for us to compare the different results.
97

3.3.2 Signal Encoding Gain

In the reflection reference method, the maximal value for the auto-correlation is at the position where the signal and the reference overlap and the signal and reference are in the same phase, so all the products for positive and negative values are positive. The sum of the square of all the sample points for one pulse reflection is 28.8. For Golay and complimentaiy for code length 2 there are four pulses, the total is 4x28.8=115.2, which is the same as the maximal value in Figure 3.17(b).

The signal phase is considered in the code with phase reference method.

When the

processing reference and the signal at the position where they are the same phase as shown in Figure 3.20 (b), the maximum of the cross correlation operation is reached. For the reference and signal have the same phase, when the signal is positive the reference is positive; when the signal is negative, the reference is. The absolute amplitude of reference is 1. The cross correlation is equal to the sum of the absolute value of all the amplitudes of all the signals. When we sum the absolute value of all the sample points for one pulse reflection, the result is 53.4. For Golay and complimentary Golay codes there are. four such cycles, so the total value is 53.5x4=214, which is the value of the maximum in Figure 3.19 (b).

In Section 3.2.1.1, the maximal amplitude is explained for our simulation results. During calculation we use the sum of just half cycle sine signal. The code reference method ignores the phase of sine signal; the maximal correlation value is at the position when half period phase shift exists between the sine signal and its reference in Figure 3.20 (a). If the reference moves to right continually, the half period of negative signal will add to the positive half period value and the reference is positive 1 so that the production of signal and reference is negative. The result become smaller with more negative signal added. When no phase shifts between the code reference and the signal, the sum is zero (the sum of half positive period with
98

the negative half). The maximal value happens when code with phase reference and its signal have the same phase as shown in Figure 3.20(b). So code with phase reference method improves the amplitude as twice as the code with phase reference.

h a l f p erio d

h a l f p erio d I h a l f p erio d if

h a l f p e rio d

Figure 3.20

Maximal Correlation Positions for Code Reference and Code with Phase Reference

In Figure 3.20 the dash line is the reference code and solid line is the signal. Figure 3.20 (a) represents the code reference method which can reach its correlation maximum when half period phase shift exists. In Figure 3.20(b) the maximum occurs when there is no phase shift between the code with phase reference and signal. The code with phase method uses the whole signal, but the code reference methodpxsi uses half.

In Figure 3.17 (a), for the backscatter signal, we can use STD of three-cycle large peaks as our signal power and the STD before the first peak as our noise. The signal and noise power are individually 0.1383 and 0.0063, so the signal to noise ratio is 22. When we do the same thing for the encoding results for three-cycle code with phase processing method (Figure 3.19 (b)), the signal and noise power are separately 116 and 0.36, so the signal to noise is 320. We choose the part of signal before the peak value as the noise for signal to noise ratio. This part has no sidelobes and is almost just white noise. So the gain of signal to noise ratio for
99

binaiy coded excitation code length 2 is 15 times (12dB); for code length 4 the gain is 15dB. This value can be regarded as the maximum realizable improvement. These values happen to be the theoretical gain in the FM coded excitation method^^^l

When we use the part of the signal behind three-cycle peaks as noise, the signal to noise is not so high any more due to the sidelobes (i.e., in this case,we consider the sidelobes part of the noise.) The signal to noise ratio for binary coded excitation code length 2 (Figure 3.19 (b)) is 115.9/12.3= 26; the signal to noise ratio for the backscatter signal (Figure 3.17 (a)) is 0.138/0.018=8. So the encoding gain for binary coded excitation code length 2 is 26/8= 3.3. Generally the sidelobes will degrade the axial resolution of ultrasound imaging. This however does not have a great impact in the analysis of speckle patterns as figure 1.11.

3.3.3

Impulse response for our binary coded excitation system

In Section 3.2.1.5, we discuss the impulse response for the coded excitation method. The impulse response for coded excitation method without attenuation and plain attenuation is a Ã´ function. The encoding results fi' om a quartz reflection are regarded as the combination of the coded excitation method and our experimental system. The coded excitation method without attenuation is a S function (Section 3.2.1.5). So the encoding results fi'om the quartz reflection will represent the impulse response of our experimental system.

100

'"''Ã§r.eÃ§ycle>iaÂ»
0 3 5

{

Eweiope Â«(one cycle excaition packscetter sigral ^

\ *0 2 5

'' 0 .1 5

: , 0 ai

Ã

0 .Z 03 \0 4 , OS 0 6 , a ? o o
' ' ' T im su Â« S' "

*; ' ' ' S' '

-0 .9 1

; .'005 ' % 0/ 01' 02 , 03 O i^ , 0 L 5 0 .6 07 0.3' 0 .9
'' '' :%:.Timaw s. \ -

1

(a.l) quartz reflection from one pulse
< ' 'EncodingVsiult lor Code leiiglh2 ^ ^ ' '> '.,2 5 0

(b.l) The envelope for signal (a.l)
\ S .V,,:' . ErwÂ« of encoding resÃ¼lt for Code (englhZ ,

' 1 5 0

!* , '-aj
0 0 1 0 .2 ; 03 0 .4 05, 0 .6 , 07 .0 .8 09",-r > ^
C O '

0.1

- 0.2

(a.2) Encoding results for code length 2
Encoding result for Code ier.gtfi 16 ' \

0 3 . - 0 1 = O S .-'-O B '.' ' ' '''T im e u e ,

or*

0.8

0.9 ,

,1, '

(b.2) The envelope for (a.2)
Envelope of encoding result for Cede lenglM.G

1500

Â«"'1 8 0 0

; 1 0 0 0

1 4 0 0
>1200

! > ,'8 0 0

,jT

;, ' 4 0 0 rÂ«'200
Â«Time U S ' .....................

 .':0 '.-'O S' 'l.',.tS .-.2.'.'-29. .,-3 '.35

<--'45.
' ' ' '

(a.3) Encoding results for code length 16 Figure 3.21

" T im eu s '

'

>

(b.3) The envelope for (a.3) Signals and their Envelopes

When only one pulse is sent to the transducer, the reflected signal from a reflector is

101

shown in Figure 3.21 (al). For a one cycle sine input signal, this output is not a sine. The envelope of one pulses' reflection looks like a Ã function as Figure 3.21 (bl). This output can be regarded as the impulse response for our system, although there are sidelobes and noise in the signal.

In Figures 3.21 (a2) and 3.21 (a3), the encoding results of code length 2 and code length 16 are shown; their corresponding envelopes are shown in Figures 3.21 (b2) and 3.21 (b3). These two envelopes represent the impulse response of the binary coded system for code length 2 and code length 16. In the prototype system we cannot get a perfect waveform mainly due to the inertia of transducer. So for different code lengths, the impulse response is different. From Figures 3.21 (b3) and 3.21 (b2) we find there are more sidelobes for the longer code.

3.3.3.1

The Phase Shift Effect

In Section 2.4.2.2, the problems associated with the phase shift from the movement of the platform were discussed. In this section, an example is given. Assume that there is a 80 sample-time shift between the Golay and comphmentaiy Golay code for the code length 2. The sample rate in this case is 5GHz, so 90 sample-time means 16 ns shift. The gap is small. In Figure 3.22(a) the encoding results without phase shifting compensation are shown and the encoding results with phase shifting compensation are in Figure 3.22(b). When these two graphs are compared, we find the maximal amplitude for Figure 3.22(b) is 214 and for Figure 3.22(a) is 185. When comparing the sidelobes, the sidelobes in Figure 2.22(a) are greater than these in Figure 2.22(b). Without phase shifting compensation there is more energy in the sidelobes so that the peak value of signal of is smaller than with phase shifting compensation.

102

'

,0

 02

'Â· 0 4 -

' 0 6 '

08,

,.1

- . 1 3 , 

0.1 ^ 0 2 '

0 .3 ,1 0 .4

'0 5

.0 6

07

08^

0,9

(a)

Encoding result for Quartz (b)

Encoding

result

for

Quartz

reflection without compensation Figure 3.22

reflection without compensation

Encoding Results for Phase Shift Effect

From these results, we concluded that the binary coded excitation method is very phase sensitive. In section 2.4.2.2 the platform shift problem was solved. If we

want to compensate for the phase shift during pulse sequences, the shift distance needs to be controlled. If the shift is more than a half cycle of the ultrasound pulse, it is difficult to compensate for the shift. Another bad effect from the shift compensation is it causes the signal bliu if the backscatter signals for Golay code and complimentary code come from different part tissue location and their sum will blur the signal.

3.3.3.2

The Effect of Code Length

In Figure 3.23 the encoding results of the backscatter signal from a quartz reflector using four code lengths are compared. The size and number of sidelobes increase with code length. The amplitude gain increases with code length but is not linearly proportional to code length.

103

(a) Encoding results for code length 2 (b) Encoding results for code length 4

* 10'

(c) Encoding results for code length 8 (d) Encoding results for code length 16 Figure 3.23 The Encoding resultss for Different Code Length

The encoding gains for code length 2 and 4 increase linearly with code length ( Figure 3.24). But for code length 8 and 16 the gains do not scale linearly. The main reason is mentioned in Section 2.4.2.1: when the code lengths increases, the amplitude of reflected signal decreases. The second reason is that the sidelobes increase with longer code length. Since more energy of the signal is transferred into the sidelobes, the amplitude is reduced. Compared with Figure 3.15, the encoding gains from experimental reflection attenuation is more than that of theoretical simulation, because experimental results are processed by 3-cycle code with phase reference method and the simulation results are processed by 1 cycle code reference method.

104

Figure 3.24

Encoding Gains for Four Code Length, X-axis Code Length

3.3.4

Results from Phantoms

In this section, binary coded excitation in situations with closely spaced non-resolvable collection of scatterers is examined. First the backscatter signal from a phantom are examined and then from excised liver tissue. The phantom is a good substitute for real tissue for they have stable properties to assess the ultrasound backscatter signal. The phantom in this experiment was made of 4% agar in water mixed in equal parts with tungsten particles, The tungsten particles are 1.00-1.39 micron in diameter. The speed of sound in tungsten is 5200 m/sec and the impedance of tungsten is 101. The agar is dissolved in boiling water and solidifies when it cools to 37 Â®C. The beads are in suspension ( 2,000,000 per ml) and are mixed with the agar when it cools to about 40 Â®C. The mixture is then poured into the mold to solidify.

The binary coded excitation method is used to increase the signal to noise ratio and thus the penetration depth of high frequency ultrasound. The STD (standard deviation) is used to monitor the signals. The trend of STD for different segments is related to signal distortion. To evaluate this distortion, the signal envelope is calculated.

105

3.3.4.1

The Effect of Code Length

Which signal should be used as the reference signal to evaluate the encoding results from binary coded excitation method in tissue? From the analysis of reflection signals and simulation results, we notice the impulse response for binary coded method is like a 5 function. So the output of 6 pulse input may be the answer. For each depth and tissue a cycle of sine signal as our 5 pulse input is sent to transducer and the output backscatter signal from the one cycle sine pulse is captured and stored as our reference to evaluate the encoding results from binary coded excitation method.

Figure 3.25 shows the backscatter signal from a phantom using one cycle sine input. For the same phantom location, Golay code pairs are went to the transducer and the backscatter is stored and analyzed. The results are shown in Figure 3.26. The signals are divided into the 100 segements, each about half encoded code length.

In Figure 3.25(a), the backscatter signal for one pulse, we can use the STD for the signal as our signal power and the STD from the beginning part as noise power. The signal to noise ratio is 10.5. For three-cycle code with phase processing method (Figure 3.26 (a)), the encoding gain is 52.8. So the encoding SNR gain for binaiy coded excitation code length 2 is approximately 5. Because the sidelobes effect does not taken into account, in this results, this result can only used to demonstrate how the binary code excitation improves signal to noise ratio for white noise. Since the sidelobes and the signal are mixed together, it is difficult to evaluate the power of sidelobes in the backscatter signal in Figure 3.25(a).

106

O f t *< y c Â» Â®

-

'" T T '" S T D o fb n *Ã§ Ã¿ c J #Â« x c ita iiQ a b a c k * c a tt* rlig n a i

A/

0 . t o \ - Z ) ' . 30 . 4 0 . . a a < .

70 s , 80

M

\100

(a) backscatter from phantom one cycle excitation Figure 3.25

w '.

V,

,* * g m e n t \

(b)

STD of (a) with segments

One Reference from One Cycle Pulse and Envelope

Comparing Figure 3.26(al-a4) to Figure 3.25 (a), we find the similarity of the encoding results to the backscatter signal decreases with increasing code length. In Figures 3.25(b), and 3.26(bl-b4), the y-axis is the amplitude of signals and x-axis signal segments. Each segment has 400 sample points. When comparing Figure 3.26(bl-b4) to Figure 3.25 (b), the magnitude of the STD of thebackscatter signal ranges from 0.2 to 0.6 xlO*^ and all magnitudes for STD for encoding results ranges from 0.1 to 0.6. The gain of STD for encoding results is about 1000. If the code length increases, the STD increases. Likely due to frequency dependent attenuation, the gain does not increase linearly with code length. Furthermore, as seen in the simulation, the sidelobes degrade the signal after the decoding compression.

107

'"Encoding aignif for code length 2

'

STD of encoding eingaUode length 2

0,
,' , ' Tim* us

IQ

Â· 20 , 30

40

5Q '

C O

70 ,

00

90

10Q %

'

-

:,,

(al) Encoding results code length 2
/, ' enccdihgSigiiÃ©tfdrcdÃ alength4"

(bl)

STD of (a) with segments
' ' ,  ' Â£Â»T0 ofencodina ftinaal code lenaih 4

r:fc '0 < 8 'w:

K /,a2
0 , /'10' -, 20 ,3 0 , ;40 , 60 ^ 60 : 70 , 80 _ 90 100

(a2) Encoding results code length 4
EniÃ¢sÃ¨iftg *!gnil frjr coÃ¼Ã« lehgtfi
-"

(b2)

STD of (a2) with segments
-VÂ» *ncod'ng'Â«in9*r<:ode lergih 8
-- ---------------------

s"

------------------------

-----------

:
iTo

ts.'*< (?;Â« I'/ 1 r>;.i
' 0 .5 . - /! 3; ; 1 " 2 ' 3, "* S ', 6 7 ; 3 , Ã : O' ,,1 0 ; '2 0 30 - ,4 0 . Â«0 , (50 70 80 90 , 100 .

/ -3

u ^ A

A L iA A
r i

'

(a3) Encoding results code length 8
C n c n d m ge ig W f o re n d #W n g th 'lG

(b3) STD of (a3) with segments
<STD: of Â«ntiÃ ditig s>hgÂ«f cod# lenglKiG

(a4) Encoding results code length 16 Figure 3.26

(b4) STD of (a4) with segments

Encoding results for Four Code Length (Refer to Figure 3.25) (Note Change in Scales)
108

Comparing Figure 3.26(al-a4) to Figure 3.25 (a), the similarity of encoding results to the original one cycle excitation hackscatter signal decreases with increasing code length. The gain of STD for encoding results is about 1000 times. length increases, the STD increases. If the code

When comparing Figures 3.26(bl-b4) to Figure 3.25 (b), the reason for the feature that the peaks of the hackscatter signal move to the left of the figure with increasing code length is unknown.

3.3.4.2

The Effect of Depth

In this section, the hackscatter signals from the phantom are compared with the transducer focused at different depths. The focus of transducer lies in three different depths 0.3mm, 0.5mm, and 0.7mm under the surface of phantom and the ultrasound hackscatter signals are shown in Figures 3.27, 3.28 and 3.29. In all these three figures, the reference hackscatter signal from one pulse input is shown in (a). STDs of these hackscatter signals for different segments are shown in (h). The encoding results using Golay code of length 2 and STD for encoding results are shown in (al) and (hi).

109

One cycU Â«xc<tÂ«lion bock$Ã§attÂ« *i5n*( /

S T D Ã Â» fO n e Â« Ã¯c le " e * c r tifi` Ã¼ ^ ^

T ''" '

e e g m e m

(a) one cycle excitation hackscatter
ELncodma Â«ignef for eod# length 2

(b) STD of (a) with segments Tr 3'"" ...

'' '

O

'

:0

20

y

30

40

Â·Â·g w * n l Â· ,

Â«lO

GO

' ^0

GO

GO

lOO

(al) Encoding results

(bl) STD of (al) with segments

Figure 3.27 Backscatter Signal and Encoding results and Their STD with segments and Focus at 0.3 mm below Surface
On# f fe l# *4ta#*Â»oAUÂ«<;k*c#tter #*gn*l STÃ o f One cycle excrfetion beckecartier iigne)

o '

1'y ,'3

^ ' 3' / 4

,6-5

; y 8

(a) one cycle excitation backscatter
Encoding ni'gnelfOr code length 3

(b) STD of (a) with segments
STu 01 encoding etngei code length 2

(al) Encoding results Figure 3.28

(bl) STD of (al) with segments

Backscatter Signal and Encoding results and Their STD with

segments and Transducer Focus at 0.5mm below Surface

110

> P.nÂ« Ã§yc)Â« Â·Â«TG rfartion b ick tc itiw Â«

:
1

r'

Â» - -....

I' t 0

Iv I'A /V \_v^
' V' '' M 9 m Â« n l 'v

3

1

2

3 .

4

'. 5

, ^ 6 -

7

8

(a) one cycle excitation backscatter
rocodinifignal tor.codi*

(b) STD of (a) with segments
STD ef Â«nsoiiiinij yingÂ»l c Â» le n g th 3 ' ' -' ,

i ' \ 0 .5

< ! o J O 2 0: (aI) Encoding results Figure 3.29

,< 0 . m m^ ;o w w

(bl) STD of (al) with segments

Backscatter Signal and Encoding resultss and Their STD with segments with Focus at 0.7 mm below Surface

The STD of the encoding results with segments for code length 2 (Figure 3.27(bl), Figure 3.28(bl) and Figure 3.29(bl)) and the STD of corresponding backscatter signal from one cycle excitation pulse (Figure 3.27(b), Figure 3.28(b) and Figure 3.29(b)) look similiar. The amplitude for the former ranges from 0.2 to 0.6x10'^ V and the amplitude for latter one range from 0.1 to 0.8 V. The gains of the STD for all three depths signal are 1000 times. Therefore, When code length 2 and when the backscatter signal is several times greater than noise, the binary coded excitation method is suitable for high frequency ultrasound for different depths.

3.3.5

Critical Depth for Our System

The critical depth can be defined as the depth at which the amplitude of the
111

backscatter signals is equal to noise. If the binary coded method can improve the signal at the critical depth, it means this method can improve the penetration depth.

In this experiment one cycle of sine signal is sent to the transducer and the backscatter signal is noted. Then the gain of the power amplifier is decreased so that the total energy sent into transducer decreases. When the signal is almost submersed into the noise (Figure 3.30), Then encoded signals are used to see if the SNR increases.
,O n e c y c le ,e x c ita tio n b a c k s c a lte r -s ig n a l -

vh

^'0.3 0.2

ic v

p.:v; 2 .5
,Â· ' T im e .lies' us '

, ' '

:;

:3
'

3 .5 : ;" s

Figure 3.30

Reference Signal at Critical Depth

In Figure 3.31 (al-a4) the backscatter signals for Golay codes with code length 2,4, 8 and 16 are shown at the critical depth for the same location and the same phantom. Comparing the signals in these four figures with the backscatter signal of one cycle pulse input in Figure 3.30, the ampUtude of backscatter signal for Golay codes increases slightly because more energy is sent into transducer with a longer code length. With longer code lengths, the maximal amplitude of the backscatter

signals moves to the right of the figure. This phenomenon is the same as that the focus of backscatter signals for longer Golay code changes deep as we had discussed in Section 2.4.2.1.
112

to rÃ©odi lÂ« n flthi

T-'T' ----- Â«

s ^ '

03'

's

1 s <1 ,< i :. V 2 . 26 Â» ' * s3, <36' ^4 ^46 TÃ®mÂ« ^ , ' <s * -

(bl) (al) backscatter from code length 2
B Â» c k * c Â« tl* rsig n a lfo rC o r f*te n w th4

Encoding results from code
K n c o r fin g* V g n Â« ifo ft* Â« d Â«)Â» n g th4 ~ '

length 2

Ã
'Â« a a
0 . ; 0 0.5'' 1 15 2 ' 25 . ;3 ' ^35 4 ^' 45 05 ,1 .15^ ''2'. 25, 3 35 '4 . '45

(b2) (a2) backscatter from code length 4
,

Encoding results from code
Ã r r Ã§ o d in gÂ« ig n a ifo rC o r f*to n g in1 6

length 4

Â·^~6a;SiÂ«TisSs't'T
,'> .0 0 5

(b3) (a3) backscatter from code length 8
, BÂ»CKÂ»cÂ»it4Â» *>gn4l.fof Codo tonntfvIS

Encoding results from code

length 8
Lncodm g (igoof toirCorfo ioogwi ÃG

>

ODS

(b4) Encoding results from code (a4) backscatter from code length 16 length 16

Figure 3.31 Backscatter Signal and Encoding results for Different Code length (Note the Difference in Scales)
113

In Figure 3.31(bl-b4) the encoding results for Golay codes in code length 2, 4, 8 and 16 are shown. The shapes of the four encoding results are similar to each other and all of them have two peak values as the single pulse backscatter in Figure 3.30. The amplitude increases with longer code lengths, but the amplitude decreases for the code length 16. Comparing Figures 3.24 and 3.32, the gains of amplitude at critical depth is almost the same as those from reflection except code length 16.

S C O

4 C 0

203,

Figure 3.32

The Code Length and Encoding Gain

In order to determine whether coded excitation increases signal from noise, a noise reference measurement was made. The noise reference means the noise from our coded excitation system is processed by three-cycle code with phase processing method as same as we process the encoded signal (first this noise cross-correlates separately with a Golay reference and its complimentary Golay reference, and then they are added) as in Figure 3.33(b). When we power on all the instruments in our system but do not send any signal into the transducer, the output from signal amplifier is just white noise as in Figure 3.33(a). The amplitude of noise is in 3mV.

When we compare Figure 3.33 (a) with Figure 3.30, the amplitude of Figure 3.33(a) ranges from -0.25 mVto -O.SxlOmVand the most of signal in Figure 3.30 ranges from 2.0 to 4 mV. So they are in almost same range. But when we compare Figure 3.33 (b) with Figure 3.31 (al-a4)(the encoding results), the amplitude in Figure
114

3.33(b) ranges between Â±0.02 and the signal is uniform; but in Figure 3.31(al-a4), the peak amplitude of signals ranges 0.15-0.4 V and the signal is not uniform. So the peak values in Figure 3.31 (al-a4) are signal increased by binary coded excitation method.

0' .

> V , ' ,.

03

04 .

OK

.T m * a*. ^ ' ' ' . - i X

OH:

1/

13

1.4

1.Q

.

, X Timo va

(a) white noise

(b) Encoding results for white

Figure 3.33

White Noise and Its Encoding resnltss

In Sections 3.3.4.1, 3.3.4.2, and 3.3.5, we discuss some results based on the backscatter signals from the phantom. From these results, the binary coded excitation still increases the signal energy, and the envelopes of encoding results of coded signal are similar to that from one pulse backscatter signal. Compared with the simulation results, at longer code lengths we carmot realize the anticipated gains. In the last chapter of our results, we will present one example from bovine liver.

3.4 Backscatter Signal from Real Tissue

In this section results from real tissue are analyzed. In Figure 3.34, the backscatter signal from bovine liver is shown. This signal is generated when one cycle sine pulse is sent into the transducer.. The backscatter signal from real tissue only appears aroimd the focal region of the transducer but the backscatter signals from the phantom are significant even outside the focal zone as in Figures 3.25(a),

115

3.27(a), 3.28(a), and 3.29(a)), because the phantoms have a stronger backscatter coefBcient than the tissues we used.

O n e ,c y c le

a x g ita tio n

b a c k s c a t t e r

s ig n a l

Figure 3.34

Backscatter Signal from Bovine Liver

3.4.1 Different processing methods

In Section 3.4.1, the three-cycle code with phase, reflection and one cycle code, and concluded were compared, and demonstrated three-cycle code with phase gives the largest gain. In Figure 3.35, the backscatter from liver using different encoding techniques is shown. The green color signal is the encoding results of three-cycle code with phase; the red signal in (a) is the encoding results from reflection reference; the red signal in (b) is the encoding results from 1 cycle code with phase. The gain in the three-cycle code with phase method is almost twice as the other two methods.

116

Encoding signal fbr coda length 2

Encoding signal for co d e length 2

1

2

3

4

5

6

0

1

2

3

4

5

6

^

8

(a) 3 cycle code with phase / reflection reference

(b)

3 cycle code with phase /Icycle

code with phase reference

Figure 3.35 Backscatter Signal from Liver Tissue Using Different Methods (Code Length 2)

3.4.2 Phase Shift

In Section 3.3.4.1, the effect of phase shift on the reflected signals is discussed. The phase shift between the backscatter signals of the Golay code and complimentary code will increase the sidelobes of the encoding results and lower the maximal amplitude. In Figure 3.36, backscatter signals for liver tissue with and without phase compensation are presented. In Figure 3.36(a), the signal is not like the backscatter signal in Figure 3.34 even though it was taken from the same location. But in Figure 3.36(b), in which a phase shift correction was applied, the encoding results look more similar to the signal in Figure 3.34. In summary the phase shift has an important effect on the encoding results of binary coded excitation method, even though the time shift is very small between the Golay and complimentary Golay code pairs. For example, in Figure 3.36 the signals are from code length 4 and the shift for Golay code and complimentary Golay code is 8 ns, or equivalently 12p.m.

117

118

Ã«ncoefng^ 'gnai for coda (angih 4

% ,

^

y

.'. Encoding signai ter coda tenglh

4

3

y:\3
: ^^ 1

1

i:
Â·2

^ ^-05

g

/ '9
C .5

(a) Figure 3.36

(b)

Backscatter from Bovina Liver using Coded Excitation (a)

Without Phase Compensation (b) With Compensation

3.4.3 Similarity of Signals

In Sections 3.3.4.1 and 3.3.4.2, we use trends in the STD of backscatter to represent the similarity of original backscatter signal and the results from binary coded excitation. A greater similarity of these two signals means the distortion of signals due to sidelobes is less. In this section an envelope method is used to evaluate the similarity between original backscatter signal and the encoding results from coded excitation. In this method we cross correlate both signal envelopes; if the cross correlation result is more similar to a Ã´ function, the similarity of these two signals is high. And the distortion of encoding results is smaller.

In Figure 3.37 (a) is the envelop for reference signal in Figure 3.34; the envelop of encoding results from code length 2 (as Figure 3.35 green color signal) is Figure 3.37 part (b); the envelope of encoding results from code length 4 is in Figure 3.37 part (c); in part (d) the dot line is the cross correlation of envelopes of reference and encoding results from code length 4, the solid line is the cross correlation of envelops of reference and encoding results from code length 2. After normalization to these two results, they are shown as Figure 3.37 (d).
119

Envelope of E ncoding *<gnÂ«! for c o d a le ngth 2 

>Ã 8

(a)
E^weiopaWEr^cWiMge^ length 4

(b)
^ ^ \CROSS PORREL^ION O f Je t:ODg jÃNGTh 2 and 4

Â· cod# langih 2 ' tod# length 4

i
(c)

0

..2 .

, ,G

'10

, 12

14

16

(d)

Figure 3.37 Envelope Method to Evaluate Signal Similarity of backscatter signals

From Figure 3.37(d) we find both cross correlation signals approach a 6 function. The similarity of the signal fi-om code length 2 to the original is a little higher than that from code length 4 as expected.

3.4.4

The Gain in Signal to Noise Ratio

The signal to noise ratio is the most important parameter to evaluate the quality of coded excitation method. Why we just discuss this important topic so late? From our simulations and experimental results we find the sidelobes increase with depth and longer code length. The sidelobes have a strong effect on the encoding results

120

of binary coded excitation methods. The noise in binary coded excitation includes two parts: normal noise and sidelobe noise. Unfortunately the sidelobes of encoding results are mixed with the signal. It is difficult to separate sidelobes from signal.

In this section A method to evaluate both parts of noise so that we obtain the gain of signal to noise ratio in binary coded excitation method. General noise of our system is regarded as white noise. As show in Figure 3.34 the begiiming part of backscatter signal before signal appears is regarded as noise of our system. So the STD of this part of signal is regarded as general noise for our lab system and the value is about 5.6x10'^ and STD for signal is about 7.4x10"^ So the signal to noise ratio is about 7.4xl0'^/5.6xl0*^=13; and corresponding part in Figure 3.35(a) is regard as general noise in encoding results and the value is about 0.0072 and STD of signal in encoding results is 0.663. So the signal to noise in encoding results is about 0.663/0.0072 =92. If we just consider general white noise, the signal to

noise ratio for encoding results in code length increases 92/13= 7 times about 8 dB.

A method is used to estimate the energy of sidelobes. Noise and signal are mixed together in encoding results. From the quartz reflector data as Figure 3.25, it is possible to evaluate the energy of signals and sidelobes. The ratio of energy of signals to the energy of sidelobes is regarded as another SNR ratio. The square of the area of huge impulse is over to the square of the area of sidelobes (as Figure 3.23 (b)) to evaluate the signal to sidelobes noise. The area of huge pulse is 1.6405x10' unit^xns and the area for sidelobes is 2.422x10^ unit'xns. So the signal to noise ratio is 67 for sidelobes noise.

In code length 2, sidelobes from reflection signal have a little effect in SNR. For the SNR for sidelobe noise is 67, which is greater than, the SNR gain for white noise 7 times.
121

Chapter 4 Conclusions and Future Work

4.1 Conclusions

4.1.1

Feasibility of Binary Coded Excitation Method

The general structure of the coded excitation system is developed for high frequency ultrasound imaging is based on the conventional ultrasound system. An arbitrary waveform generator was chosen to replace general puiser generator in a conventional ultrasound system. A wide band (1-500MHz) analog power amplifier was selected to amplify the signal sent to transducer and all the signal channels of conventional ultrasound system were redesigned. Two problems in our binary coded excitation system developed were discussed in Chapter 2. After several problems were solved, coded backscatter signals in phantoms and real tissue were collected. After analysis of these signals, some reasonable results are reached and gains of 12dB were achieved. Although a lot of work is required to improve the system, this system demonstrates the feasibility of binary coded excitation for high frequency ultrasound and provides unique insights to the friture.

The design of the system for binary coded excitation accumulates the energy of signals from different time slots together. After binary coded excitation method is used in our high frequency ultrasound systems, whether in simulation or experimental systems, we realized gains in amplitude, STD and signal to noise ratio of the signals. Furthermore, the backscatter signals from the puiser and the signals from coded excitation method were similar. So the binary coded excitation method is a way to improve the signal to noise ratio of high frequency ultrasound signal and increase the penetration depth.

The gain of signal amplitude is almost linearly proportional to sample rate (section
122

3.2.1.4 and section S.2.2.4). When the sample rate is high, the gain is high. Because it is equal to the sum of the amplitude for all sample points, when the number of sample points increases, the sum increases. So this method is not good to evaluate the effect of the binary coded excitation method. But this method is very useful in sparse spacing model in the simulations and the reflection signals in experiment to evaluate if their results are reasonable or not. When the sample rate is the same, the amplitude gain still reflects the gain in signal to noise ratio.

Gain in the STD of signals, similar to amplitude gain, is directly related to sampling rate. The STD if the signals is used because the amplitude gain is not good to evaluate the backscatter signal from tissue or theoretical models with closely spaced scatterers. The gain in STD is used to estimate the gain with and without coded excitation. This method mixes the power of signal and noise together. If the signal is much greater than the noise, this method is used to evaluate the power gain of signals. When the SNR is low, this method is not appropriate.

The gain in signal to noise is the best method to evaluate the binary coded excitation method. In my thesis we discuss the gain of signal to noise briefly, because coded excitation cause sidelobe noise and this sidelobe noise is mixed with signal. How to effectively estimate the sidelobe noise of coded excitation method is a prerequisite to calculate the signal to noise ratio correctly. It is difficult to evaluate sidelobe in backscatter signal of real tissue from coded excitation. However, sidelobe noise reduces the axial resolution of the system, but still produces useful signals for analysis on for the area of research in our lab is not detrimental.

4.1.2

The Mechanism of the Binary Coded Excitation Method

How does the binary coded excitation method work in improving the high
123

frequency ultrasound signal? Binary coded excitation extends the signal duration so that the total energy in the signals from coded excitation method is greater than that from a conventional puiser (as FM coded excitation does.). Using the sparse spacing model in the simulation or quartz reflection signals in the experiments, longer signals are reflected at the same scatterer or same reflection point, so that we can "accumulate" such a long signal together. This is the reason why we can "accumulate" all the signals for backscatter signal from tissue and closely space models. In tissue when the backscatter coefficient of a volume is huge, the sum of these signals with longer coded excitation is huge; when the backscatter coefficient of a scatter is small, the sum will be small. The sum of these longer signals denotes the backscatter property of a scatter as one puiser backscatter signal does. When comparing our encoding results from binary coded excitation with backscatter signal of one puiser input, the similarity of both signals verifies the conclusion that just made.

In Sections 3.3.3 and 3.4.4, I find that the binary coded excitation method can improve the signal to noise ratio. How does binary coded excitation method improve the signal to noise? First of all the sum of the longer signal alone indeed increases the amplitude of the signal. Thus the total energy in the signal is amplified. The second reason is that noise is averaged during the cross correlation operation. When signals are added together by the cross correlation operation, the noise mixed into signal is also added. But because noise is uncorrelated, the gain in noise is not as large as that for the signal. The third reason is due to effective suppression of sidelobe noise by Golay code pairs. Our results from shorter code length 2 and 4 the Golay code pairs can reduce almost all the sidelobe noise in plain attenuation model. In FD attenuation tissue this method still works, but it does not reduce all the sidelobes any more.

124

4.1.3

The Effect of Code Length

When the code length of the coded excitation is longer, more eneigy is contained in the signal. Therefore, one might expect that the gain of energy will increase linearly with code length. In the simulations, whether sparse or dense spacing and whether plain attenuation or FD attenuation, we find that the gain of the encoded signals from binary coded excitation method always increases with code length.

The theoretically predicted gain with increased code length was not achieved experimentally. Only when the code lengths are 2 and 4, does the gain increase linearly with code length. When code lengths are 8 or 16, the gain increase is much smaller than predicted. The reason for this is discussed in Section 2.4.2.1. The amplitudes of signals for code length 8 and 16 are attenuated. For code length 16, the amplitudes of the code sequence even look like a coned and maximal amplitude is only half of those of code length 2 or code length 4. Further more the focus of the transducer for code length 16 moves 1 ps deeper. It is not clear why this should be so. How the transducer behaves when excited by the long sequence is not understood, and there are no published data on this. However, it should be a topic of friture work.

4.1.4

Phase Shift Sensitivity

The phase sensitivity is used to denote the effect on the encoding gain for a phase shift between Golay and Complementary Golay code pairs due to sample motion. When a phase shift sensitivity is high, the same phase shift will have a larger effect on the results; when a phase shift sensitivity is low, the same phase will have a less effect. We find experimentally that the sensitivity of the technique to phase is large.. Even a 40 to 80ns time shift between the Golay code and complimentary Golay code has a significant effect on the encoding results (In Section 3.3.4.1) . For example, in Section 2.4.2.2, if there is ns-order time delay
125

between the Golay and complementary code sequences, the amplitude of encoding results is smaller and the sidelobes increases.

Because the binary coded excitation is so sensitive to the phase shift, this method is not suitable when there is considerable motion. 40 to 80 n s. second are equivalent to motions of 60 pm. The minimal time between Golay codes pairs sent is 1 to 2 minutes due to delays in the arbitrary waveform generator and time domain averaging used to increase the SNR. In the encoding results we can see the effect even the target moves 60 micrometer in 1 to 2 minutes. In the future if new binary coded excitation system can send and receive Golay codes pairs in a shorter time period, it is possible to use this method to slowly move targets.

The code with phase reference method is better than that of the code reference method. In Section 3.3.3, the encoding gain using code with phase reference is almost doubled than gain using the code reference method. Comparing all three processing methods of code with phase reference, code reference and reflection reference, the code with phase processing is the best one to decode the binary coded excitation.

In Section 4.2.2 during analysis of binary coded excitation method we assitmed that the encoding result signals are the sum of coded modulated signal form the same position or scatterer. This conclusion is correct for the signals fi'om reflection in experiment and sparse spacing model in simulation. For the backscatter signals from tissue and density spacing model in simulation, this conclusion does not work any more. Because the distances between scatterers are so small that all the backscatter signals are mixed together, it is impossible to add all the signals from the same scatterer to generate the encoding results. The backscatter signals from scatterers nearby will contribute to the encoding results. The binaiy coded excitation method sacrifices the resolution to get gain in eneigy.

12 6

4.1.5

Impulse Response and Similarity of Signals

In Section 3.3.3 we define the impulse response for coded excitation, for plain attenuation as a perfect 5 function. This is helpful to explain why binary coded excitation works. We use the envelopes of reflected signals for different code length to represent the impulse response of that Golay code pairs. These impulse responses are worse with increasing code length. In Section 3.4.3 the similarity of encoding resultss to the backscatter signal fi' om unit puiser is defined. It also shows that the similarity of signals worsens with code length. The impulse response of the binary coded excitation method is directly related to the similarity of signals. For this reason we can analyze the quality of different codes by just the analysis of impulse response of those codes in later sections.

In Section 3.3.4, we compare the impulse response for two different code lengths. The impulse responses worsen with code length, as more energy is shifted to the sidelobes. In the binary coded excitation system, only code length 2 and 4 works well; the encoding results for code length 8 and 16 do not work well. The reason for this is not clear, but is related to the time between pulses.

4.2

Future Work

This thesis has laid the groundwork for future work on coded excitation for high frequency ultrasound. Many aspects need to be more thoroughly investigated. The next paragraphs explain some of these.

In Section 2.4.2 some interesting phenomena are shown. When the code lengths are 8 and 16, there is attenuation in the reflected signals fiom a quartz plate. For code length 16, the amplitudes of the code sequence for different bits resemble a cone and the maximal amplitude is only half of those of code length 2 or 4. More experiments are required to figure out what is the exact reason. If we find the
127

interpretation for these phenomena, it is possible to use longer codes in our binary coded excitation system, as longer code sends more energy into the targets that should lead to greater improvement in the SNR.

In Section 3.4.4 calculations of the increase in SNR using binary coded excitation are made. How to evaluate the sidelobes noise for backscatter signals from tissues is not clear enough to reach a conclusion on gains in the SNR. How cross correlation operation works on FD attenuation of biomedical ultrasound signals, especially in high frequency band range, is worth more research. Only after further understanding of this topic, one may have the ability to take advantage of binary coded excitation method.

In a lot of work on the FM coded excitation such as Jian Shen's, Matthew O' Dormell's, Pai-Chi Li's and Thanassis X.Misaiidis' has been done, the optimal filters are discussed to process the FM coded excitation to reduce the sidelobes noise. In Section 3.3.3 I find the sidelobes still affect our results using the binary coded excitation method. Some further processing methods were implemented to suppress the sidelobe noise to improve the signal to noise ratio.

In our binary coded excitation method we changed the signal generator to arbitrary waveform generator. The power amplifier is changed into a linear wideband one. All the signal channels are redesigned to fit our new requirements. But the core of ultrasound system, or the transducer, is a conventional one. In Section 2.2.1.3 I find that, even if just one pulse is sent to this transducer, several cycles of signal are sent out due to the inertia of the transducer. These vibrations cause more sidelobe noise. For good binary coded excitation ultrasound systems, special transducer is required to have less inertia and capability to send a long code pairs with less distortion.

In Section 4.2.4 we discuss the problem of phase shift. A lot of work is required to
128

find how the resolution and phase shift compensation are effected by varied phase sensitivity. Some methods and parameters are required to evaluate the relations between phase sensitivity, resolution and phase shift compensation. In the end we can design our binary coded excitation system to meet our requirement on phase shift and correct for this.

129

Appendix A

System Design

In this section we discuss how to build up a binary coded excitation high frequency ultrasound system. First all the components we select for our system are listed. Then the methods to use these components and make them match are introduced. In the end the connection of all system is presented. I made several small circuits for om system. All these circuits are explained in this section in details.

A l.l

Arbitrary Waveform Generator**'

Arbitrary waveform generator is an important component in our binary coded excitation system. It is used to generate binary modulated Golay coded signals. The main features of the waveform generator are: Â· Â· Â· Â· Â· Â· Â· The maximal clock frequency: 2.6G D/A convert accuracy: 8 bit Waveform memory: 8.1 M-word Two arbitrary marker outputs Five waveform editors An Ethernet port for using NFS or FTP link GPIB interface for remotely controlling or transforming waveform from external source. Â· Â· A port for cormecting 101 or 106 type keyboard Inter clock for setting up the current date and time

The interface of arbitrary signal generator is shown in Figure A l.l.

^^^Sources

Tektronix Inc. "A W G 610 arbitrary waveform generator user m a n u a l"

130

f

A W O B oaftf

CM t Anaioo Output cm *^5>
Si

r
tM C lock

Marker f

Output

fT --

Tngge# Inpul

T ? T
OPiO C om m I at4 pirn O-Sum

IM o w n o fy |
Ftasti D * Â« K
to M O Mam O iaK

CPU B oarO

H
I

LANC om m i t o Base T |

Front Peme*
Monitor

Output ,_ _ _ _ _ _
f F art

2^1 C B ^ _____ I

--
TÂ« MB

--Flaem aÂ«k.

!

\

Figure A l.l

The Interface of Arbitrary Signal Generator

The analog circuit structure of arbitrary signal generator is shown in Figure A 1.2.

EXT
EVENT

EXT TA*0 5 3 CHI

Memory
Address Ccfrtroi

R eg tstsf

Shift

DAG

OAC ASiC

CLOCK OUT

DOS

VCO

Figure A1.2 The Structure of Arbitrary Signal Generator
131

This structure is important to the understanding of how the signal generator works. The clock oscillator can be set to either the internal or external reference clock source by using the SETUP menu. If the external clock source is selected, the reference signal connected to the lOMHz REF in connector on the rear panel will be used. The internal clock is connected to the reference clock oscillator, which uses the direct digital synthesis (DDS). The waveform memory has 8 bits for waveform data and 2 bits for per channel for markers, a total length of 8.1 M points. The length of the waveform data must be chosen from 512 to 8.1M points, and it must be a multiple of 8. There are three RUN modes including Triggered, Gated, and Enhanced for selection. The RUN mode represents the way to send the signal out. In our case, the signal needs to be sent out continuously and repeatedly. Thus, the Enhanced mode is selected.

Five editors may be used to draw the waveform in this instrument. These are the Graphical waveform editor, the pattern editor, the table editor, the equation editor, and the sequence editor. After the waveform is drawn, the waveform is loaded

into the memory. Through the RUN mode, the waveform is sent out as the signal. From these procedures we know editing waveform and generating the signal will be completed in separate time. In this machine there is a Quick Editor. We can edit the waveform in memory directly. It means we can send out our edit on line.

The Graphical editor, the Equation editor and the Sequence editor were used in this project. Implementation of these three editors is explained in the following:

1) The Graphical editor. First select the Graphical editor. Then set the clock frequency of the signal and the size of the waveform. As the blank window appears on the screen, move the cursor to the area to be edited. The OPERATION must be selected to finish the drawing. The OPERATION has three types; the drawing operation, editing operation and mathematical operation. In the drawing
132

operation, sine, triangle, square, ramp, or noise generators can be selected to generate the desired waveform. In the editing operation, replace, insert, copy, paste, cut, horizontal shift, horizontal rotate, vertical shift, expand, vertical scale, horizontal invert, or vertical invert option can be selected. In the mathematical operation, absolute, square, cube, square root, normalize, differential, integral, add, sub, multiply compare, convolution, correlation, or digital filter can be selected.

Table A l.l

The Predefined Variables

F unction Clock Fname.clock

D escription Set the clock frequency for signal Returns the clock frequency o f the special file name, this variable can not be used as variable in a waveform equation

Pi Point

The Ludolphian num ber 71=3.1415926 The current point num ber value, starting at 0, read only, only useable w ithin and equation.

Scale

The current scale value that increase 0 to 1, read only, only useable within and equation.

Size Fname.size

Set the current waveform record length Returns the waveform length o f the special file name. This variable can not be used as variable in a waveform equation

Time

The current scale value that increase 0 to 1, read only, only useable w ithin and equation.

2) The Equation editor. This editor can be used to transform an equation into the waveform signal. A text file describing the equation with certain format is first created. A compiler is then used to compile the text file into the corresponding waveform. Similar to the Graphical editor, the Equation editor has all the functions that the graphical editor supports. The difference is that in the Equation

133

editor the function is expressed in KEYWORDS. For example, conv() denotes the convolution operation. There are three types of KEYWORDS: the mathematical keywords, the command keywords and predefined variable. The command keywords include not only all the editing operations and drawing operations in the Graphical editor, such as sin(), sqrQ and eopyQ, but also several new features such as IF (control statement), FOR (loop control) and join(), which concatenates two files into one file. The predefined variables are summarized in the Table A l.l.

The sequence editor is used to create a sequence file. A sequence file is a list of waveform file names that the instrument will produce. Additional parameters, such as repeat count, event triggering, and conditional jumps allow to generate large and complex output waveform.

In this project, the waveform is generated as described in the following steps. A single cycle of sine waveform is first generated using the Graphical editor. The inverse sine signal is then obtained. The frequency of the waveform is required to be set for the sine wave. For example, if the clock chosen is 2.6Q the period of 40MHz signal is 0.025ps. The length of the signal is 2600x0.025=65. If the oscilloscope is used to measure the width of the signal at 65 points, the period of signal is 0.034ps.

Two modulated signals, a sine signal and an inverse sine signal are shown in Figure A 1.3. A gap between the two signals is used to restore the transducer. In the same figure we find the reflection signal of one cycle sine input fi*om a quartz plate lasts for a long time but the large amplitude lasts only three-period of center frequency. So the next pulse should send out some time delay to avoid these three-period of large signal. In experiment we use 5 periods of center fi' equency as a gap to restore the transducer and avoid the three large amplitude signals. The time for 45 points is 0.025ps. Therefore, the gap is 4 x 45 = 225 points. If the code sequence is 1 -1, the generated waveform is as shown in FigureAl.3.
134

-1

gap

gap

Figure A1.3 How to Generate the Encoded Signal

The equation editor was used to all the waveforms from various codes, in order to simplify the task. For example, the command join() was used to concatenate the shorter signals into a longer one. The rules used to generate the Golay code pairs are described in Section 2.2.1.2. The text file is then compiled into the waveform.

The signal is sent out based on the rules described as follows: 1) send out the signal; 2) wait for a time period of about 30-40 micro-second to collect the backscatter signal (a blank waveform is used and the size is (30 / 0.025) x 45 = 54000 points); 3) repeat this procedure, which is necessaiy for capturing and displaying the backscatter signal on screen of oscilloscope.

In the Sequence editor, we select the signal to be sent out and a time delay in the sequence list. And we also set an unconditional jump at the end of second waveform, which is then connected to the beginning of the first waveform. The Enhanced RUN mode is chosen to ensure the signal to be sent out in a continuous loop.

135

A1.2

Power amplifier'^ '

The main features of the power amplifier are listed below;

 Solid-state linear design " Instantaneous ultra broadband  Standard front panel manual gain adjust  Suitable for CW/FM/PM/AM/Pulse/Digital modulations  50 Ohm Input/Output impedance  High reliability and ruggedness Table A1.2
C h a ra cteristics Frequency Response Output Power CW O utput Power @ IdB G C .P Input Power for Rated Output Power Gain @ IdB G C .P Small Signal Gain Flatness Gain Adjustm ent Range Input/Output VSW R @ 50 ohm N oise Figure Harmonics @ IdB G C .P Third O rder Intercept Point Spurious Signals Supply Voltage (single phase) Power Consumption

Power amplifier SPECIFICATIONS
R atin g BW M in 0.01 250 150 300 200 0 54 Â±2.0 25 30 2.0:1 10 -20 +61 -70 100 1000 -60 240 1200

Typ

M ax 230

U nits MHz Watt Watt dBm dB dB dB dB dBc dBm dBc Volt Watt

Psat PldB Pin G ldB
AG FGA S11/S22 NF H IPS Spur VAC Pd

Sources

E m pow er R F system s, "Operating a n d service m a n u a l" 2003

136

The important parameters are bandwidth, gain and impedance. The bandwidth, ranging from 0.01 to 230 MHz, is sufiBciently wide to pass the center frequency 40MHz of the encoded signal. The gain is 54 dB, and the adjustment range ranges from 25 to 30 dB. The output of the arbitrary signal generator is IV and the transducer driver signal is about 160V. Therefore, the gain required is about 30 dB. The impedance is 50 Ohm and is the same as the transducer impedance. No matching circuit between the transducer and amplifier is needed, as discussed in Section 1.5.3.1.

A1.3

Signal Amplifier*^'

The gain, bandwidth, power supply and noise are important parameters for a signal amplifier. The type of amplifier we choose is integrated circuit RF amplifier. The advantages of this type of amplifier are listed as follows: Â· Â· High value of power gain are available, 40-70dB Internal feedback is minimized to the point where the circuits are usually unconditionally stable. Â· Â· Input impedance is not sensitive to load impedance. Internal limiter is optionally available.

The parameters of the signal amplifier are given in Table A1.3.

Sources

M iteq In c, "Operating m a n u a l" 2003

137

Table A1.3

Specifications of the Signal Amplifier
50 ohm 1-500 60dB Min, 61 dB Typ. Â±0.5 dB Max, Â±0.25 dB Typ. 1.3dB Max, 1.15dB Typ. 1.4dB Max, 1.25dB Typ. 1.5dB Max, 1.30dB Typ. 12-30 VDC@ 95 mA

Input/Output impedance Bandwidth (MHz) Gain Gain Flatness N oise Figure (10 MHz) N oise Figure (250 MHz) Noise Figure (500 MHz) DC Power

The bandwidth, gain and impedance are important parameters. The bandwidth, ranging from 1 to 500 MHz, is wide enough to pass the center frequency 40MHz of the encoded signal. The gain is 60 dB. The output of the transducer is from 10 to 100 micro V and the output of the backscatter signal ranges from 5 to 20 mV; Therefore, the gain required is about 40-60 dB. As can be seen, the gain of the chosen amplifier meets the requirement. The impedance is matched, as the amplifier is connected to the transducer directly.

A1.4

Oscilloscope'''*

The parameters of the Oscilloscope are listed below: 500 MHz Bandwidth Models 2 Channel Models 5 GS/s Maximum Real-time Sample Rate Up to 8 MB Record Length 100,000 wfins/s Maximum Waveform Capture Rate Intuitive User Interface for Easy Operation OpenChoiceTM with Windows 2000 Delivers Built-in Networking and
Sources Tektronix Inc. " T D S 5 0 0 0 series digital p h o sp h o r Oscilloscopes user m a n u a l"

138

Analysis Small Footprint 10.4 in. (264 nun) Bright Display Suite of Advanced Triggers CD-RW Drive Interoperability with Tektronix Logic Analyzers Two input impedance 50, IM Ohm. The important parameters are the bandwidth, sample rate and record length and impedance. The bandwidth, 500 MHz, is wide enough to pass the center frequency 40MHz of the encoded signal. The sampling rate is 5Q which is 100 times greater than the center frequency and is also greater than the signal generator output rate of 2.6GHz. The recording length is 8MB. If one sample needs 4 bytes to store, the number of total samples that the oscilloscope memory can save is 2M points. If the oscilloscope works at maximal sampling rate, the total time period it can store is 2M/5G (about 0.4 ms). This period is sufficient given our requirement. Backscatter signal is about 40-50 ps in length. Thus, the maximal length SMB is sufficient. 50 Ohm input impedance is ideal from impedance matching purpose

A1.5

Filter Design

Two filters, a high pass filter with lOMHz cutoff frequency and low pass filter with lOOMHz cutoff frequency, are used before the signal entered the oscilloscope. There are three types of filters: Chebychev filter, Butterworth filter and Butterworth-Thompason filter. Chebychev family of filters ranges from a medium Q to a high Q. Butterworth has only one design available and belongs to medium Q. Butterworth family of filters ranges from a lower Q to medium Q.

The load Q dictates a munber of filter properties.
139

1. Low-Q filters generally have a fiat, ripple-fi-ee passband, but their initial attenuation slope at the beginning of the stopband is low. Their phase response is close to linear with frequency, and therefore the delay is nearly constant across the passband. 2. High Q filters produce a faster initial slope in the stopband, and so have a greater attenuation at any stopband fi-equency than has a lower Q design with the same number of components. The penalty for this improvement is a passband attenuation ripple and poorer phase linearity. 3. The final attenuation slope and the final phase shift of any filter depend on the effective number of reactive components in the circuit. 4. The source and load resistances determine the overall Q of the filter and therefore the passband ripple, the phase linearity, and the exact cutoff fi-equency.

Since the fi-equency of our interest is around 40MHz, we decide to choose the Chebychev family of filters, considering that their attenuation slopes are high at the beginning of the stopband. In order to get high slope, we choose the 7-element filter. From manual^^\ for high pass filter, we get the schematic graph which is shown in Figure A 1.4. For the cutoff fi-equency 9.6MHz, the values for various components are listed below: Cl and C7 are 470pf, L2 and L 6 are 0.618uH, C3 and C5 are 200pF and L4 is 0.515pH.

Sources A R R L handbook f o r radio am ateurs

140

Cl

C3

h

05

07

,

470p

Figure A1.4

Schematic of High Pass Filter

The schematic of the low pass filter is shown in Figure A 1.5. Given that the bandpass ripple is 0.1, the load resistance is 1, and the source is 1, the cutoff frequency is 1 rad/s. The values for various components are listed below. Cl and C7 are 1.198, L2 and L 6 are 1.444, C3 and C5 are 2.128, and L4 is 1.596. These values are scaled up to the terminating resistances and cutoff frequencies for our application by using equations a l.l and a 1.2. C. C=Â· 2nF^R L= RL_

(al.l)

(al.2)

The values of Cn and Ln are obtained from the manual^^l R is the load resistance of the final design. Fc is the 3dB cutoff frequency.
In 

2 LI

^

i 2 1 ----- - ------ -- --................................. 0J254UH
m

,

i

13

I

.......

....................

0^3uH

0J23UH

M

1
CO =:

= C5
30p

==

07 67.7p

==

0$ 3$p

87.7p

Figure A1.5 Schematic of Low Pass Filter

Sources Sim plified design o f filter circuits

141

To match with the impedance of the cables and adapters, R is chosen to be 50 ohm and Fc is chosen to be 100 Mhz. Values for capacitors and inductors are listed below: C7 is 38pF, L2 and L 6 are 0.23uH, C3 and C5 are 67.7pF, and L4 is 0.254uH. The simulation results for these two filters are shown in Figure A1.6. The results demonstrate that the filter design is acceptable and the values of capacitors and inductors for these two filters are accurate.

(a) high pass filter

(b) low pass filterÂ»*

Figure A1.6

Simulation Results of the Filters

OrCAD is used to design the PCB layout for the two filters, which is shown in Figure A1.7. In the PCB layout, the transmission line impedance matching is important. The capacitors we choose have high quality, and stable operation for high fi-equency circuits. The temperature coefficients are low, which is good for EMC. We choose surface mount package for capacitors and conductors to reduce coupled capacitance and inductance from the output leads so that we could improve the performance of our design for the high fi-equency range. Both filters should be placed in die cast box.

142

Figure A1.7

PCB Layout for Filters

A1.6

Protection Circuit Design

During the transmitting stage of the pulse echo sequence, the receiver amplifiers must be protected from the high voltage source. Also, during the receiving stage of the sequence, it is desirable to remove the high voltage source from the circuit to eliminate noise from the pulse electronics. Common solution to this problem employs crossed diode bridges. The crossed diodes act like switches that are closed for large signals, but are open for small signals. Using two pairs of crossed diodes and suitable cable length, a simple protection circuit is possible. One pair of crossed diodes is placed in series with the output of the puiser, while the other pair is placed in parallel with the input of the amplifier.

As shown in Figure A l.8, the protection circuit consists of two parts: the expander and limiter. An internal limiter is available from the manufacture, whereas the expander is made in house. The type of the diode is MMBD7000LT1. The diode is a dual switching diode, where two ports of the expander are used as the input and output. When the high voltage pulses are sent out from the source, one diode of the expander will conduct so that the source voltage passes unchanged. This signal will be short at the limiter so that the amplifier will be safe. During the receiving stage, the expander blocks the signal, which is small in strength (less than 0.7v) and is directly connected with the amplifier.
143

xh expander

<1^^*

tr a n sd u c e r

L3 Figure A1.8 Protection Circuit [281

The length of transmission lines, LI, L2 and L3, has an important effect on the frequency, amplitude and bandwidth of the entire system (article reference). LI is the line from limiter to the T-junction. L2 is the line from transducer to T-jimction. L3 is the line from expander to T-junction. The theoretical lengths of LI, L2 and L3 for the maximum pulse amplitude are listed in Table A1.4.

Table A1.4

The Line Lengths for Maximum Pulse Echo Amplitude 128]

Frequency range (MHz) 30-35 35-40 40-45 45-50

Length o f L l(cm ) 80 160 140 120

Length o f L2(cm) 100 100 100 100

Length o f L3(cm) 100 80 60 160

The schematic picture and PCB layout of the expander are shown in Figures A1.9 and A 1.10. The transmission line is impedance matched. The expander is placed in a die cast box.

144

sianaÂ»

1

OUALDtODE

OUALDiODE

Figure A1.9

Schematic Picture of Expander

ff

Figure Al.lO

PCB Layout of Expander

A1.7

Transmission Line Impedance Matching

When operated at frequencies over 40 MHz, the traces on the printed circuit board are regarded as microstrip lines to use in impedance match. For our two-layer board as shown in Figure A L II, the typical transmission line consists of one wide conductor on one side of the board and a ground plane on the other side of the board.

145

FRr-4

Figure A l.ll

Transmission Line

(Indicate the Conductor and the Ground Plane)

Part of the electromagnetic wave travels in the air above the line, while the other part travels in the board material. Typical boards have a dielectric constant 2 to 10 times higher than that of the air, therefore the two parts of the wave travel at different speed along the line. Calculation of the exact impedance is difficult. The characteristic impedance of the line depends on the width of the upper conductor and the thickness and dielectric constant of the circuit board. The formula for estimating the impedance is listed below: (al.3)

VEr + 1.414

O .m + T

where Z is the characteristic impedance, W is the width of the trace (in inch), T is the thickness of the trace (in inch), H is the distance between the signal trace and the reference ground (in inch), and Er is the dielectric constant of the planer material.

For our application, to match the trace impedance of the PCB board to other components, Z should be tailored to 50 ohm. With H as 1.5mm (about 0.06 inches), T is 0.1mm (about 0.004 inches), and the dielectric constant of the material FR-4 is 4.7, the width of trace is optimized as 2.5mm.

146

A1.8

Platform

A platform is needed to support the tissue sample as well as the transducer. The platform should be able to move in three dimensions smoothly and accurately. A microscope was redesigned for this purpose. The light source of the microscope is replaced by a steel barwith a support frame clamped on it. The transducer, filters and the expander are fixed on the support to protect the cables from strong force. To study the depth properties of the binary-coded method, a vemier-scale label was added in the vertical direction as Figure A l.l2.
yTM .y - -- -----

Figure A1.12

Lab Platform

A1.9

Connection Adapter and Cables

In Figure A1.13, several frames are chosen to represent the instruments that we have selected. The numbers within circle denote different types of connectors and

147

adapters. In order to simplify the kinds of cables, only BNC-BNC (male to male) 50-ohm cables are used to connect all the instruments.

e
% filt e r 1Â» f ille r

Â·MC to K.C ciAle (Â«/Â»)
( T ) s m pltlR <Â«> (T )l5 rp Â« X phtÂ« {*) Jack

< llr e c i t i n w e c i l w ( i w tJ iM e )

( Â£ ) BNC p lu s (Â»> ( Â£ ) S\tt to I5SC(*/f) ( 7 ) USC to BSC<f/f)
K C Jack (f>

Jack < 0

(7 ^ SSU to nSC<f/*> ( ^ j nVE N lo B?X{Â«/'r)

Figure A1.13

System Connection Diagram

Here is the list of all the adapters we need to use. (all made by Pomona )

O

SMA (male) to BNC (female) (m/f): Three. We have 2 already. Need to buy

one more. Cat. Number: 4290; Number: 1 ^ ' SMA (female) to BNC (male) (fi'm): one

Â© BNC (female) to BNC (female) (Ff): Three. We have one and need to buy
, two more. Cat. Number: 3283; Number: 3 (H) TYPE N (male) to BNC (female) (m/f): we need to buy two. Cat. Number: 3288; Number: 2

148

6 pieces of cables are required. Considering the connectors of the boxes for the expander and the high-pass filter may need to be changed, we need to buy 9 pieces in total.

Al.lO

Two challenges of the lab system

There are three challenges to be solved for our experiment system: the noise, the transducer inertia and the phase shift.

Al.10.1 Noise

This is the first problem we encounter and the most difiBcidt problem to be solved. Noise is defined as any electrical signal presents in a circuit other than the desired signal. When we first tried to get the hackscattered signal from the lab system, we can only see a lot of noise on the oscilloscope. The amplitude of noise is about 7V from peak to peak.

Generally noise sources can be grouped into three major categories. The first is the so-called intrinsic noise, such as the thermal and shot noise in resistors and transistors that arises from random fluctuations. The second is the man-made noise, such as the noise generated by motors and switches. The third is due to natural disturbances, such as lightening and sun-spots.

The power consumption of the power amplifier is 1000-1200 Watt. If the voltage is llOV, the current is about 11A. Such a heavy load sometimes makes the oil switch automatically switch off to avoid overheating. An exclusive power receptacle is later applied for the power amplifier. This method reduces the output noise from TV to 2V peak-to-peak. However, 2V peak-to-peak noise is still too
149

large to identify the hackscattered signals. Generally the hackscattered signals from a tissue are only 5-20 milli-volt. Where does the noise come from?

Intuitively the noise should come from the power amplifier. We took a lot of time in doing experiment and discussing this problem with some experts. Another ultrasound system was borrowed from the Princess Margaret Hospital and compared to our system. There was no difference between the results generated through these two systems. We tried to use oscillating transformer to isolate the power supplies to the signal generator, the power amplifier, the signal amplifier and the oscilloscope. But there was no improvement for our results. We also added by-pass capacitors for the power supply of the signal amplifier. Some filters were put into the signal channel to filter the signal. When some metal boards and boxes were used to shield the components, there was still no improvement.

Finally, we find by increasing the number of serial connected diodes in the expander. The noise is dramatically reduced. This is due to the higher cutoff voltage from more diodes prevent the noise from the signal amplifier. More details are discussed in Appendix B.

Al.10.2 Inertia of Transducer

After the noise problems were solved, we got very good signals from real tissues when separate pulses were applied to the transducer. However, when we tried to send consecutive pulses to the transducer (as shown in Figure A1.14), no hackscattered signals were observed.

150

0.8
0.6

0.4

0 .8

50

10Q ,

,1 5 0

200

250

300

350

400

450

Figure A1.14

Consecutive Pulses

We suspected it was due to the inertia of the transducer, if the transducer needs some time to response to each pulse. We put some time gap between each pulse (as shown in Figure Al.15(a)). After this type of signal is sent to the transducer, very strong hackscattered signals are received (Figure Al.l5(b)).

r.y
03

.a 0 * b
:0 ,4
Â·0,8

3

^

,

600

.

>000

' .

(a) Input puiser

(b)

Corresponding received

reflection Figure A1.15 New Puiser and Its Backscatter Signal

Another bad effect caused by the inertia of transducer is that several consecutive damping pulses are received even if only one pulse is sent to the transducer. As shown in Figure 1.15, each input pulse corresponds to several consecutive signals in the received signals. Furthermore, the shape of the output signal is changed due to the slow response. The inert properties of the transducer need to be improved.

151

Appendix B

Noise reduction for the power amplifier

In Section Al.10.1, we discuss the noise of our binary-coded excitation system. After serial connecting more diodes, the noise is successfully cut oft" from the power amplifier. In this section we optimize the number of diodes in the expander to keep the noise fi*om the power amplifier in an acceptable range.

The diagram of the noise channel is shown in Figure B l.l. The noise from the power amplifier is shown as a signal source and its peak-to-peak amplitude is VI. The noise passes n serial connected diodes. If we assume a 0.7V potential of the PN junction in each diode, the total potential for these n diodes is n x 0.7.
D<

02
DIODE

03

04

On

-wOlODE

-K
DIODE

-w -Â«
DIODE DIODE

VI

Vin

noise

signal amplifiÃ©e

output Vo

Figure B l.l

The Noise Channel

If the noise is large enough to pass these n diodes, Vin is the remainder noise sent into the signal amplifier and Vo corresponds to the noise output from the signal amplifier. Vin = V l - n x 0 . 7 (bl.l)

The hackscattered signal is about 20mv after the signal amplifier. However, the noise output after the signal amplifier is 2V. Therefore, the noise has to be significantly reduced before the signal amplifier. If the gain of the signal amplifier is 45dB, the noise before the signal amplifier has to be significantly less than 20 x = 0.1125 mV. 10,-45/20 _

From the electrical specification of the power amplifier, the maximal harmonics
152

noise figure is -20dB. The output fi-om power amplifier is about lOOV. Therefore, the amplitude of the noise is about 100 x = lOV. So the number of diode

should be 10 / 0.7 = 15. In our expander we serially connect 12 diodes, which means the noise remains as 2.1 V.

153

Appendix C

Transducer Equivalent Circuit and Impedance matching

C l.l Equivalent Circuit

Numerous equivalent electrical circuits such as Mason's Equivalent Circuit, Simplified Equivalent Circuit and KLM Equivalent circuit^'have been proposed to model the electrical and mechanical characteristics of ultrasound transducers. In order to derive such a circuit, it is necessary to consider all the factors that exist in the practical situation. A thorough treatment of the problem is very complicated. Generally the radiation only takes place the surface of transducer. In Figure 1.2

(a), a four-terminal network with two electrical input terminals and two mechanical output terminals can be used to represent the transducer. At the output terminals a mechanical force F applied over the transducer face of area A produces particle motion of velocity v. For plane waves their ratio is the mechanical radiation resistance Zr given by = p A lv = pcA (C l.l)

particle velocity
Zr

is a pure resistance. If the transducer is timed to resonance, the mechanical

radiation resistance appears at the electrical terminals as a resistance Re given by

R^=ZJAN^

(C1.2)

where N is the amplitude transformation ratio; the factor 4 fi"om the doubling of velocity at the radiating face due to the low impedance at the opposite end. The equivalent circuit is shown in Figurel.2 (b), the simplification of the complete equivalent circuit is valid only at frequencies near resonance.

154

Electrical

Mechanical

(a) Ze Zm

(b)

Figure C l.l

Equivalent Circuit of Transducer (b) Equivalent Electrical Near Resonance

(a) Four Terminal Network

where c^=Ay.Eld

A is the area of the transducer, s

is the dielectric constant

of transducer, d is the distance between the two electrodes. -f^)l where c^ is the capacitance of resonance, fp is the parallel

or anti-resonant frequency, fr is the series or resonant frequency. Â£, = \ ! w h e r e resonance frequency. = l/(2;zfoC,g^)^ where Rs is the resistant load, mechanical quality factor'*^'. fp is parallel or anti-resonance frequency at which the impedance is a maximum, fs is the series or resonance frequency at which the impedance reaches a minimum. They are practical parameters that can be determined by measuring impedance = l / ( 2 ^ R J Q m is the L| is the resonance inductance of transducer, fo is the

When a sinusoidal electrical driving signal is sent to a transducer, a corresponding variation in the thickness of the transducer is generated. The characteristic impedance at the boundary between the transducer and the medium determines the energy radiated at the face of the transducer. Some of the energy will be reflected back into the other face of transducer. The energy reflected at each face of the
155

transducer travels back across the transducer towards the opposite face. Due to the electromechanical coupling, a new stress exists. The total stress is equal to the sum of all instantaneous values. Stresses at the same phases reinforce each other, which is known as resonance. The transducer also resonates when it is driven at frequencies at which the thickness of the transducer is equal to the odd integral number of half wavelengths.

C1.2

Impedance Matching

There are two separate problems in impedance matching: electrical impedance matching and mechanical impedance.

Cl.2.1

Electrical Impedance Matching

In order to maximize the efficiency the electrical impedance of the transducer need to be matched to that of the receiver and driver circuits. This can be achieved by ensuring that the capacitance and inductance of the transducer form part of the tuned circuit of the associated electrical system. If the transducer is decided by application, the broad-hand transformer can be used to match the impedance of the transducer to that of the driver circuit.

As Figure 1.3 illustrates, a transformer consists of two separate windings on some type of magnetic core. The core provides a path for the magnetic field that couples the two windings and also increases the winding inductance, which, along with the source and load resistances, determines the lower cutoff frequency. The impedance ratio will depend on the square of the turns ratio if the core can couple one winding to the other as equation (1.13).

156

Rin = I -- nlj

X Rload

(C1.3)

Rs

core

R in

ni primary

secondary

Rload

Figure C1.2

Transformers for Impedance Matching

|14|

Cl.2.2 Mechanical Impedance Matching

The effects of matching the characteristic impedance of the backing and loading media are important to ultrasound system. An impedance matching layers with appropriate thickness and characteristic impedance is often used between the surface of the transducer and the load. And the matching layer is generally chosen to be of quarter wavelength thickness, and of characteristic impedance equal to the geometric mean of those the transducer and of the loading medium. In biomedical application, water or other matching materials are usually used to match the mechanical impedance of transducer with the impedance of biological tissue. If the impedances of transducer and tissue do not match, most of the energy of ultrasound signal will be lost in the reflection

157

Appendix D

Biological Effects

1)1.1 Biological Effects

Compared to X-ray, it is thought that ultrasound diagnosis is less harmful. But there are some side effects on biological tissue, even dangerous. In 1927, Wood and Loomis first did some experiments and described how small fish and frogs were killed during exposures of a few minutes to ultrasound at other frequency of 300 KHz at an intensity of about lOW/cm'^ (much higher than that used for ultrasound imaging) Later people found other biological effects of ultrasound systems. A brief introduction follows.

In considering the biological effects of ultrasound, it is necessary to know the following physical parameters:

(a) The frequency of the wave; (b) The total energy flux across the region of interest; (c) The spatial distribution of the energy; (d) The time distribution of the energy.

1)1.1.1 Thermal Effect

Ultrasoimd is attenuated as it passes through tissues. The absorption mechanisms are discussed in section 1.6.3. The rate of absorption increases with frequency. Most of absorbed energy is converted into heat. These effects are dependent on the acoustic parameters of the incident beam and the biological target. A lot of experiments of exposure using different doses of energy, frequencies of ultrasound on different types of tissues are implemented to show different biological effects. For example, in studying frog skin, a well-known biological
158

model for ion transport was used to investigate the biophysical effects of (0.8,1.1 and 3.3 MHz) ultrasound. It was found, as expected, that ultrasound induces both thermal and non-thermal effects. The non-thermal effect causes an increase in total ion conductance across the skin at (0.8 and 1.1 MHz) and a decrease at (3.3 MHz). Furthermore, it was found that these effects are dependent on the pulse repetition rate and the duty cycle of the beam. Generally the effects will follow the laws as listed:

(1) Increasing time (contact time) will increase the probability of biologically significant thermal and cavitational effects. (2) Increasing output power will increase the probability of biologically significant thermal and cavitational effects. (3) Increasing transducer frequency increases thermal effects but decreases the probability of cavitational effects

Dl.1.2 Cavitation

The term of cavitation is used to describe the behavior of gas bubbles in ultrasonic field. Acoustic cavitation is an effective mechanism for concentrating energy. It transforms the relatively low energy density of an ultrasonic field into the high energy density characteristic of the neighborhood and interior of a collapsing or vibrating bubble. There are two types of cavitations: transient and stable. Transient cavitation is the phenomenon in which voids suddenly grow from cavitation nuclei in the supporting liquid, and then collapse, under the influence of the changing pressure in an ultrasonic field: stable cavitation refers to the behavior of a gas filled bubble existing in an ultrasonic field of intensity below that necessary to cause transient cavitation.

159

One of most important concepts in the cavitation research is cavitation threshold. The intensity of a given ultrasound signal is below a certain level, which is called cavitation threshold, cavitation does not occur. The numerical values of cavitation threshold depend on many variables such as the type of liquid, the size of distribution of nuclei, equilibrium pressure, temperature, vapor pressure, surface tension, the frequency and the duration of ultrasound signals.

It seems that ultrasound can cause the some damage. In order to avoid the damage happen, the intensity and time of ultrasound signals are limited by regulations. And the initial FDA (U. S. Food and Drug Administration) regulations on ultrasound output were published in 1976. These imposed appUcation-specific limits, based on existing output levels that had demonstrated no adverse effects. Limits were divided into:

(1) Ophthalmic apphcations; (2) Fetal and other (including abdominal, pediatric, small parts); (3) Cardiac; (4) Peripheral vessels.

160

Reference List

[1] B raun, V. (1998) D ipulse-response M easurem ent o f a M agnetic R ecording C hannel U sing G olay C om plem entary Sequences, IEEE Transaction on Magnetics, Vol.34, N o .l [2] B row n, A. J. and L ockw ood, R. G. (2002) C orrespondence-- A L ow -cost,

H igh-perform ance P ulse G enerator for U ltrasound Im aging, IE E E T ransactions o n U ltrasonics, F erroelectrics, and Frequency C ontrol, Vol.49, N o.6 [3] C hiao, Y. R. and H ao, X. (2003) C oded E xcitation fo r D iagnostic U ltrasound: A System D ev e lo p er's P erspective, P reprint for 2003 IE E E U ltrasonics Sym posium [4] C hiao, Y. R. and Lew is, J. T. (2000) Synthetic T ransm it A perture Im aging U sing O rthogonal G olay C oded E xcitation, IEEE Ultrasonics Symposium, pp.1677-1680 [5] Chiao, Y R ., M o, Y. L., H all, L. A ., and M iller, C. S. (2000) B -M ode B lo o d F lo w (B -Flow ) Im aging, IEEE Ultrasonics Symposium, pp. 1469-1472 [6] C obbold, S. C. R. (2003) Foundations o f Biomedical Ultrasound, Institute o f biom aterials & B iom edical E ngineering, W orking Paper, U niversity o f Toronto [7] D ing, X . Z. and Payne, A . P. (1990) A N ew G olay C ode System fo r U ltrasonic P ulse-echo M easurem ents, Meas. ScL Technol, V o l.l, pp.158-165 [8] D uck, A . F., B aker, C. A. and Strritt, H . C. {1998} Ultrasound in Medicine, Institute o f P hysics P ublishing B ristol and Philadelphia [9] E bbini, S. E. and Shen, J. P. (1993) A N ew S V D -B ased O ptim al Inverse F ilter D esig n fo r U ltrasonic A pplications, Ultrasonics Symposium, pp. 1187-1190 [10] E bbini, S. E. and Shen, J. P. (1997) F undam ental R esolution L im its o f a C oded-excitation S ystem fo r R eal-tim e P ulse-echo Im aging, IEEE Ultrasonic Symposium, pp.1539-1542 [11] Foster, S. (1986) Im pulse R esponse M easurem ent U sing G olay C odes, IEEE ICASSP 86, T okyo, pp.929-932 [12] Fry, J. F. (1978) Methods and Phenomena-ultrasound: Its Application in Medicine And

Biology, E lsevier scientific publishing com pany, A m sterdam . O xford. N ew Y ork
[13] Golay, J. E. M . (1961) C om plem entary Series, IRE Transactions of Information Theory

161

Vol.7,pp.82-87
[14] H ardy, J. (1979) High Frequency Circuit Design, P reston P ublishing C o, R esto n V irginia [15] H unt, W. J., A rdit, M ., and Foster, F. S. (1983) U ltrasound T ransducers fo r Pulse-echo M edical Im aging, IEEE Transactions on Biomedical Engineering, Vol. B M E -30, N o . 8 [16] Jain, K . A . (1989) Fundamental o f Digital Imaging Processing, P rentice H all, Inc. E nglew ood C liffs, N e w Jersey [17] Jensen, A . J. (1996) Estimation o f Blood Velocities Using Ultrasound: A Signal

Processing Approach, C am bridge U niversity Press
[18] Jensen, A . J. (1997) A N ew A pproach to C alculating Spatial Im pulse R esponses, IEEE

Ultrasonics Symposium, pp.1755-1759
[19] Jensen, A . J., H olm , O ., Jensen, J. L., B endsen, H ., and P edersen, M . H . (1999) E xperim ental U ltrasound S ystem fo r R eal T im e Synthetic Im aging, IEEE Ultrasonic

Symposium, Vol.2, pp. 1595-1599
[20] Jeong, K . M . and E bbini, S. E. (2000) O ptim al T ransm it/receive B eam Synthesis fo r C oded E xcitation P ulse-echo Im aging, IEEE Ultrasonics Symposium, pp.1219-1222 [21] K olios, M . (2001) H ig h F requency U ltrasound Im aging and S pectroscopy fo r M onitoring A poptosis, B iom edical E ngineering R esearch G rant [22] K olios, C. M ., Taggart, L., B addour, E. R ., Foster, S. F., H unt, W. J., and C zam otal, J. G. (2003) A n Investigation o f B ackscatter P o w er S pectra from C ells, C ell P ellets and M icrospheres, IEEE Ultrasonics Symposium

proceedings, pp.752-757

[23] Kossofif, G. (1979) A nalysis o f Focusing A ctio n o f S pherically C u rv ed T ransduce,

Ultrasound Med. Biol., Vbl.5, pp.359-369
[24] K udo, N ., K am ataki, T., Y am am ot, K ., O nozuka, H ., and M ikam i, T. (1997) U ltrasound A ttenuation M easurem ent o f T issue in F requency R an g e 2.5- 4 0 M H z U sin g a M ulti-resource T ransducer, IEEE Ultrasonic Symposium, pp.1181-1184 [25] L ee B. B . and F urgason, E. S. (1981) A N e w D ig ital C orrelation F law D etection System " ,

J. Non Destructive Testing, Vol.2, pp.57-63
[26] L i, P. (1999) P ulse C om pression fo r Finite A m plitude D isto rtio n B ased H arm onic Im aging C oded W aveform s, Ultrasonic Imaging, Vol.21, pp. 1-16 [27] L i, P., E bbini, E., and O 'D onnell, M . (1992) A N ew F ilter D esig n T echnique fo r C oded

162

E xcitation System s, IEEE Transactions on Ultrasonics, Ferroelectrics, and Frequency

Control, V ol.39, N o.6
[28] L ockw ood, R. G , H unt, W. J., and Foster, F. S. (1991) T he D esig n o f P ro tectio n C ircuitry fo r H ig h F requency U ltrasound Im aging System s, IEEE Transactions on Ultrasonics,

Ferroelectrics, and Frequency Control, Vol.38, N o .l
[29] M isaridis, X . T., G am m elm ark, K ., and Jorgensen, H . C. (2000) P otential o f C oded E xcitation in M edical U ltrasound Im aging, Ultrasonics, V ol.38, pp.183-189 [30] M isaridis, X . T. and Jensen, A. J. (1999) A n E ffective C oded E xcitation Schem e B ased o n a P redistorted FM Signal and an O ptim ized D igital Filter, IEEE Ultrasonics Symposium, pp.1589-1593 [31] M isaridis, X . T. and P edersen, H . M . (2000) C linical U se and E v alu atio n o f C oded E xcitation in B M ode Im ages, IEEE Ultrasonics Symposium, pp.1689-1693 [32] M ontrose, I. M . (1996) Printed Circuit Board Design Techniques for EMC Compliance, IE E E P ress. N ew Y ork [33] N arayanan, V. M ., M olthen, C. R ., and Shankar, M . P. (1997) Studies on U ltrasonic S cattering from Q uasi-periodic Structures, IEEE Transactions on Ultrasonics, Ferroelectrics,

and Frequency Control, V ol.44, N o .l
[34] O ' D onnell, M . (1992) C oded E xcitation System s for Im proving the P en etratio n o f R eal-tim e P hased-array Im aging System s, IEEE Transactions on Ultrasonics, Ferroelectrics,

and Frequency Control, Vol. 39, N o. 3
[35] O 'N eil, T. H . (1949) T heory o f F ocusing R adiators, J. Acoust, Soc. Amer,, Vbl.21, pp. 126-516 [36] O ppenheim , V. A ., W illsky, S. A ., and H aw ab, S. H . (1997) Signals & Systems, P rentice-hall [37] Parker, K .J. (1983) U ltrasonic A ttenuation and A bsorption in L iv er Tissue, Ultrasound

Med, Bio,, Vbl.9, pp. 363-369
[38] R aju, I. B. and Srinivasan, A . M . (2002) Statistics o f E nvelope o f H ig h-frequency U ltrasonic B ackscatter from H um an Skin in V ivo, IEEE Transaction on Ultrasonics,

Ferroelectrics, and Frequency Control, Vol.49, N o.7
[39] R ao, N . (1990) F requency M odulated P ulse fo r U ltrasonic Im aging in an A ttenuating

163

M edium , IEEE Symposium on Computer Based Medical Systems [40] R ao, N . (1994) Investigation o f a P uise C om pression T echnique fo r M edical U ltrasound: a Sim ulation study. Medical & Biological Engineering & Computing [41] R ao, N . and A ubry, M . (1994) E valuation o f a P uise C om pression T echnique for U ltrasound S peckle R eduction, IEEE Trans, Ultrason, Feerroelec, Freq, Control, Vol.41, pp.660-663 [42] R ao, N . and M ehra, S. (1993) M edical U ltrasound Im aging U sing P u lse C om pression,

Electronics Letters, V ol.29, pp.6 4 9 -6 5 1
[43] R ao, N ., M ehra, S., B ridge, J., and V enkatram an, S. (1995) E xperim ental P o in t S pread F unction o f F M P ulse Im aging Schem e, Ultrasound Imaging, Vol. 17, p p .l 14-141 [44] Schroeder, R. M . (1979) Integrated Im pulse M ethod M easuring S ound D ecay w ith o u t U sing Im pulse, J, Acoust, Soc, Am, Vol.66, pp.497-500 [45] Shen, J. and E bbini, S. E. (1996) A N ew C oded E xcitation U ltrasound Im aging System s,

IEEE Transactions on Ultrasonics, Ferroelectrics, and Frequency Control, Vol. 43, N o .l
[46] Shen, J. and Sim on, C. (1996) A N ew P ulse-echo System fo r R eal T im e 3D U ltrasonic Im aging-phantom Tests, IEEE Ultrasonics Symposium, pp.1387-1390 [47] Shen, J. and E bbini, S. E. (1996) O n the D esign o f a T ransversal F ilter B an k fo r P arallel P rocessing M ultiple Im aging Lines in R eal-tim e A coustic Im aging, IEEE, p p .3 109-3112 [48] Shen, J. and E bbini, S. E. (1998) Filter-based C oded-excitation System fo r H igh-speed U ltrasonic Im aging, IE E E T ransactions o n M edical Im aging, Vol. 17, N o.6, pp.923-934 [49] Shen, J., E rdogan, H ., and E bbini, S. E. (1994) A n O ptim al Im aging O perator D esig n T echnique fo r C oded E xcitation U ltrasound Im aging System , IEEE Ultrasonics Symposium, pp.1777-1781 [50] Shung, K . K . and T hiem e, A . G. (1993) U ltrasonic Scattering in Biological Tissues, C R C P ress, B o ca R aton. A n n A rbor. London. Tokyo [51] Sklar, B . (2001) Digital Communications Fundamentals and Application, second edition, P rentice-hall [52] Takeuchi, Y. (1979) A n Investigation o f a Spread E nergy M ethod fo r M edical U ltrasound System , Ultrason,, Vol. 17, pp. 175 [53] W ells, P. N . T. (1977) Biomedical Ulrtrasonics, A cadem ic P ress, London. N ew York. San

164

Francisco [54] W ilson, S. G. (2001) Digital Modulation and Coding, P rentice-hall International [55] Y okosaw a, K . and Shinom ura, R. (1996) A 120-M H z U ltrasound P ro b e for T issue Im aging, Ultrasonic Imaging, Vol. 18, p p .2 3 1-239 [56] Z hou, B. and G reen, M . D . (1992) C haracterization o f E xternal E ar Im pulse R esponse U sing G olay Code, J, Acoust, Soc, Am, Vbl.92, p p .l 169-1171

165

Important Glossary Impedance.......................................i.......................................................................7 Intensity.............................................................................................................. ...10 One cycle excitation backscatter signal or one cycle excitation........................... 24 uni-polar modulated method..................................................................................34 bipolar modulated method.....................................................................................34 Binary coded excitation method............................................................................ 35 encoding results..................................................................................................... 42 reflection reference processing method................................................................. 60 code reference processing method......................................................................... 61 one-cycle code reference........................................................................................ 61 three-cycle code reference......................................................................................61 code with phase reference processing method.......................................................62 one-cycle code with phase reference method.........................................................63 three-cycle code with phase reference method.................................................63

166

Abbreviations FM SNR US PZT PVDF A/D NDE FD Frequency Modulated Signal to Noise Ratio Ultrasound lead zirconate titanate Polyvinlidene difluoride Anolog to Digital converter non-destructive testing Frequency Dependent

167

