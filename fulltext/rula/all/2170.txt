Subthreshold Frequency Synthesis for Implantable Medical Devices

by

Tarek Khan Bachelor of Engineering, Ryerson, 2007

A thesis presented to Ryerson University

in partial fulfillment of the requirements for the degree of Master of Applied Science in the Program of Electrical and Computer Engineering

Toronto, Ontario, Canada, 2010

©Tarek Khan 2010

I hereby declare that I am the sole author of this thesis. I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research.

I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

iii

Subthreshold Frequency Synthesis for Implantable Medical Devices Master of Applied Science 2010 Tarek Khan Electrical and Computer Engineering Ryerson University

In this thesis, several novel circuits for use in an ultra-low power integer-n frequency synthesizer operating in the 402 MHz to 405 MHz Medical Implant Communication Service spectrum have been proposed. The proposed designs include a current-reuse quadrature voltage-controlled oscillator, a novel subthreshold source-coupled logic D-latch with clear and preset functionality, a programmable frequency divider and phase/frequency detector based on the aforementioned D-latch, and a modified current-steering charge pump. A design methodology for low-power CMOS oscillators was proposed based on the MOS EKV model and gm /id design methodology. The proposed designs were implemented using IBM CMRF8SF 130 nm CMOS technology and simulated using Cadence Spectre. Simulation results for the proposed current-reuse quadrature voltage-controlled oscillator and programmable frequency divider consume 420 µW and 200 µW respectively from a 0.7 V supply, a significant improvement compared to existing designs. The simulated phase noise of the proposed oscillator is -127.2 dBc/Hz at a 1 MHz offset. Measurement results from a fabricated prototype of the current-reuse quadrature verify the simulation results and serve as a proof-of-concept for the proposed design. The proposed designs were used to implement an integer-n frequency synthesizer and were submitted for fabrication. Simulation results show that the synthesizer consumes 635 µW from a 0.7 V supply and has a locking time of 250 µs.

v

Acknowledgements
Although the research performed in this thesis was an individual effort on my part, there were many people who contributed in different ways to its completion. First and foremost, I would like to thank my thesis supervisor Dr. Kaamran Raahemifar. Without providing me the opportunity to pursue graduate studies under his supervision, this thesis would not exist. The support, advice, and insight he provided was an instrumental part in the completion of this research. I am eternally grateful to my parents, brother, grandmothers, aunts, uncles, cousins and all of my extended family who provided invaluable words of encouragement, unconditional support and faith in me and all of my endeavours, academic and otherwise. My family has always been understanding of my hectic workload and subsequent absence from many family gatherings during both my undergraduate and graduate studies. My time in grad school was made much more memorable because of my friends Farnoos, Umair, Nima, Amin, and Dominic, as well as all the other grad students from ENG313. Even though we had many conversations about how agonizing and miserable life as a grad student is, it was those very conversations that made grad studies so enjoyable and entertaining. The support engineers in the Electrical & Computer Engineering Department ­ Jason, Dan, Bruce and Luis ­ allowed me to have nearly free rein over the integrated circuits CAD tools and design kits. I never would have learned so much about how all the tools and kits come together had it not been for all the time I spent in ENG439. I hope that all the shell scripts and user guides I wrote have made the integrated circuit CAD tool environment in our department more user friendly for undergraduate students, graduate researchers, and faculty members. As well, the support engineers from The MOSIS Service, namely Zach and Glenn, and those at Cadence Design Systems, provided crucial help and support for troubleshooting and resolving issues with the IBM CMRF8SF design kit and Cadence EDA tools. Finally the committee members for my thesis defence, Dr. James Smith, Dr. Vadim Geurkov and Dr. Farah Mohammadi for taking the time to read my thesis and provide comments from their unique perspectives.

vii

Dedication
To my late grandmother, Qamar Jabbar, who passed away in March 2010.

ix

Contents
1 Introduction 1.1 1.2 Motivation 1.2.1 1.2.2 1.2.3 1.3 1.4 1.5 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Medical Implant Communication Service . . . . . . . . . . . . . . . . . . . . . . . . . . . . Overview . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Technical specifications . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Existing work . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 1 3 3 4 6 9 9

Project objective and target applications . . . . . . . . . . . . . . . . . . . . . . . . . . . . Contributions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

Organization of report . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10 11

2 Oscillators and frequency synthesis 2.1 2.2

Overview . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11 CMOS Oscillators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11 2.2.1 2.2.2 2.2.3 2.2.4 2.2.5 General considerations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11 Negative-gm LC -tank oscillators . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13 Voltage-controlled oscillators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19 Phase noise in oscillators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21 Quadrature oscillators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 24 Simple phase-locked loop . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26 Charge-pump phase-locked loop . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29 Integer-N frequency synthesizer . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31

2.3

PLLs and synthesizers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26 2.3.1 2.3.2 2.3.3

2.4

Summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34 37

3 Proposed work 3.1 3.2 3.3

Design specifications . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 37 Proposed CR-QVCO . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 39 3.2.1 3.3.1 Proposed low power VCO design methodology . . . . . . . . . . . . . . . . . . . . 43 Proposed D-latch with clear and preset functionality . . . . . . . . . . . . . . . . . 51 xi A ST-SCL programmable divider . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45

3.4 3.5

A ST-SCL PFD, current-steering CP, and LF . . . . . . . . . . . . . . . . . . . . . . . . . 52 Summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 53

4 Results 55 4.1 IBM CMRF8SF 130 nm CMOS Technology . . . . . . . . . . . . . . . . . . . . . . . . . . 55 4.2 Current reuse quadrature VCO . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 55 4.2.1 Simulation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57 4.2.2 Measurement . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59 4.2.3 Fabrication challenges . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 60 ST-SCL programmable divider . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 61 4.3.1 4.3.2 4.3.3 4.4 4.5 Clear/preset D-latch simulation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 61 Dual-modulus prescaler simulation . . . . . . . . . . . . . . . . . . . . . . . . . . . 62 Programmable down counter simulation . . . . . . . . . . . . . . . . . . . . . . . . 62

4.3

4.3.4 Programmable divider simulation . . . . . . . . . . . . . . . . . . . . . . . . . . . . 63 PFD, CP, and LF . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 65 402 MHz to 405 MHz integer-n frequency synthesizer . . . . . . . . . . . . . . . . . . . . . 67 4.5.1 Simulation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 67 4.5.2 Fabrication challenges . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 67 Summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 68 69

4.6

5 Conclusion and future work 5.1 5.2

Thesis summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69 Future work . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 70 86

References

xii

List of Tables
1.1 2.1 3.1 3.2 3.3 4.1 4.2 4.3 4.4 MedRadio operating specifications . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6

Loop filter topologies. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31 Division ratios for integer-n frequency synthesizer with 300 kHz reference frequency. . . . 46 Division ratios for integer-n frequency synthesizer with new division ratios. . . . . . . . . 47 Control bits for the swallow counter. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 48

Low power VCO design methodology input parameters. . . . . . . . . . . . . . . . . . . . 56 Comparision of existing MICS VCOs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 58 Comparison of low power programmable dividers . . . . . . . . . . . . . . . . . . . . . . . 65 Power consumption of programmable divider components. . . . . . . . . . . . . . . . . . . 65

A.1 Approximation of normalized intrinsic capacitances in strong and weak inversion. . . . . . 74 A.2 Parameters describing MOSFET transistor geometry. . . . . . . . . . . . . . . . . . . . . . 74 A.3 Voltages. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75 A.4 Currents. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75 A.5 Conductances. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75 A.6 Capacitances. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75 A.7 Other parameters. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 76 A.8 Normalizing parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 76 A.9 Normalizing parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 76

xiii

List of Figures
1.1 1.2 1.3 1.4 1.5 2.1 2.2 2.3 2.4 2.5 2.6 2.7 2.8 2.9 Examples of patient health monitoring using implantable devices . . . . . . . . . . . . . . General block diagram for an implantable medical device . . . . . . . . . . . . . . . . . . Allocated frequency spectrum for Medical Implant Communication Service. . . . . . . . . Allocated frequency spectrum for Medical Device Radiocommunication Service. . . . . . . MICS implant torso simulator. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Oscillator models. 2 3 5 7 8

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 14 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16

LC resonator with loss compensation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13 Negative-gm LC -tank oscillator. Metal-insulator-metal capacitor.

Octagonal spiral inductor. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16 Symmetric spiral inductor. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17 Negative-gm LC -tank oscillator with merged tanks. . . . . . . . . . . . . . . . . . . . . . . 17 Drain current for switching transistor. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18 Variations of the negative-gm topology. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18

2.10 Simple transceiver. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19 2.11 Arbitrary spectrum for example transceiver. . . . . . . . . . . . . . . . . . . . . . . . . . . 19 2.12 Voltage-controlled oscillator. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 20 2.13 Cross-section of MOS varactor. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21 2.14 Voltage-controlled oscillator output spectrum. . . . . . . . . . . . . . . . . . . . . . . . . . 21 2.15 Predicted phase noise spectrum. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22 2.16 Waveforms and ISFs for (a) a typical LC oscillator and (b) a typical ring oscillator. . . . . 24 2.17 Original quadrature LC oscillator (omitting bias). . . . . . . . . . . . . . . . . . . . . . . 24 2.18 Simple phase-locked loop. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27 2.19 Phase/frequency detector. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29 2.20 Charge-pump phase-locked loop. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 30 2.21 Integer-n frequency synthesizer block diagram. . . . . . . . . . . . . . . . . . . . . . . . . 32 2.22 Types of frequency dividers. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32 2.23 Block diagram of programmable frequency divider. . . . . . . . . . . . . . . . . . . . . . . 33 2.24 Master-slave d-flip flop. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34 xv

2.25 Types of d-latches. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34 3.1 3.2 3.3 3.4 3.5 3.6 3.7 3.8 3.9 Current reuse between two stacked circuits. . . . . . . . . . . . . . . . . . . . . . . . . . . 38 Quadrature VCO block diagram. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 39 Possible topologies for the proposed CR-QVCO. . . . . . . . . . . . . . . . . . . . . . . . 40 Modified oscillator core. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41 Varactor frequency tuning circuit. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41 Necessary graphs for proposed design methodology. . . . . . . . . . . . . . . . . . . . . . . 43 Proposed VCO design methodology. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 44 Block diagram of pulse counter. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 48 Block diagram of swallow counter. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49

3.10 Block diagram of dual modulus prescaler. . . . . . . . . . . . . . . . . . . . . . . . . . . . 49 3.11 General topology of an SCL gate. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 50 3.12 SCL 2-input universal gate. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 50 3.13 Proposed D-latch with clear and preset. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51 3.14 Representations of proposed D-latch. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51 3.15 Phase/frequency detector using proposed clear/preset D flip-flop. . . . . . . . . . . . . . . 52 3.16 Current-steering charge pump. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 53 4.1 4.2 4.3 4.4 4.5 4.6 4.7 4.8 Synthesized spiral inductor for current-reuse quadrature VCO. . . . . . . . . . . . . . . . 56 CR-QVCO simulated over process variations. . . . . . . . . . . . . . . . . . . . . . . . . . 57 CR-QVCO simulated over ± 10% supply voltage variations. . . . . . . . . . . . . . . . . . 57 CR-QVCO simulated over temperature variations. . . . . . . . . . . . . . . . . . . . . . . 58 Wafer probe station . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59 Probe configurations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59 Physical implementation of current-reuse quadrature VCO. . . . . . . . . . . . . . . . . . 60 Measurement results of CR-QVCO. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 61

4.9 Transient simulation of proposed D-latch and ideal D-latch. . . . . . . . . . . . . . . . . . 61 4.10 Simulation of D-flip flop with clear and preset. . . . . . . . . . . . . . . . . . . . . . . . . 62 4.11 Transient simulation of dual-modulus prescaler. . . . . . . . . . . . . . . . . . . . . . . . . 63 4.12 Transient simulation of 6-bit down counter. . . . . . . . . . . . . . . . . . . . . . . . . . . 63 4.13 Transient simulation of 7-bit down counter. . . . . . . . . . . . . . . . . . . . . . . . . . . 63 4.14 Programmable divider output when fin = 402.15 MHz . . . . . . . . . . . . . . . . . . . . 64 4.15 Programmable divider output when fin = 404.85 MHz . . . . . . . . . . . . . . . . . . . . 64 4.16 Programmable frequency divider layout. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 65 4.17 Transient simulation of PFD/CP/LF. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 66 4.18 Phase/frequency detector, charge pump and loop filter layouts. . . . . . . . . . . . . . . . 66 4.19 Frequency synthesizer control voltage. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 67 4.20 Frequency synthesizer layout. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 67 A.1 Cross-section of MOS transistor. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72 xvi

A.2 Transconductance efficiency versus inversion coefficient. . . . . . . . . . . . . . . . . . . . 77 A.3 Simulation testbench for obtaining transconductance efficiency versus inversion coefficient graph. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 78

xvii

List of Appendices
A A brief introduction to the MOS EKV model and the gm /id design methodology 71 A.1 MOS EKV model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 71 A.2 gm /id design methodology . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75 B Publications 79

B.1 Peer reviewed conference papers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79 B.2 Book chapters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79

xix

Chapter 1

Introduction
1.1 Motivation

Over the last decade in Canada, the medical devices industry has received a significant amount of attention. The Auditor General's 2004 Report to Parliament noted that "medical devices play an important role in all stages of delivery of health care [1]," and the National Research Council has "identified Canadas medical devices industry as one of the key sectors in which its expertise, multi-disciplinary competencies and infrastructure can make significant scientific and technological contributions to help industry respond to the considerable global medical device market expansion that is expected in the coming years [2]." According to Industry Canada's Medical Device Industry Profile the Canadian medical devices market was valued at $7.5 billion in 2008, up from $5 billion in 2000, and employment rose from 22,000 in 2000 to 26,000 in 2005 [3]. The diverse range of medical devices for diagnosis, prevention and treatment of diseases, disabilities and other ailments which Canadians and those abroad rely on could not have been possible without the scientific and technological advancements of recent years. Design and development of medical devices is a multidisciplinary research area involving many scientific and engineering disciplines. Advancements in the fields of biotechnology, advanced materials, telecommunications, software and informatics, and microelectronics have all contributed to the exponential increase in the number of new devices being developed. In recent years, the aggressive scaling of Complementary Metal-Oxide Semiconductor (CMOS) technology has allowed for not only the reduction in the physical size on an integrated circuit (IC), but also the ability to include many more components onto a single die. These devices, known as System-on-Chip (SoC), can hold a combination of analog (i.e. filters, signal conditioning, ADC), digital (memory, DSP, DAC), and RF (transmitter, receiver, antenna) components. These advances have allowed for the development of new devices such as handheld devices. In cell phones and PDAs, increasing capabilities are not accompanied by increasing sizes. Using high density solid state memory instead of miniature hard drives has allowed for increased storage in MP3 players. Similarly in medical electronics the miniaturization of devices for patient monitoring and treatment has created a new class of electronics: implantable medical 1

CHAPTER 1. INTRODUCTION devices (IMDs). This thesis will focus on the latter, specifically wireless IMDs for biotelemetry, which is defined as the measurement and transmission of physiological signals. Implantable medical devices have evolved greatly since the first pacemaker was designed in the 1950s. The current generation of IMDs are capable of replacing damaged or malfunctioning organs, and are designed for long-term patient care. Cochlear implants, which differ greatly from hearing aids, convert received audio signals to electrical impulses and are capable of bypassing damaged parts of the ear and interfacing directly with auditory nerves [4]. Microstimulators for neuromuscular stimulation can restore functionality to paralysed limbs. Implantable drug administration devices can deliver precise amounts of a drug, such as insulin for diabetics, at particular intervals, replacing the need for regular injections. Wireless IMDs designed for biotelemetry applications include implantable ECG and EEG recording, intra-ocular pressure sensing and wireless endoscopy capsules. More examples of IMDs are shown in Fig. 1.1.

Figure 1.1: Examples of patient health monitoring using implantable devices [5]. There are numerous benefits of these IMDs in the health care industry. Since the devices can provide real-time, continuous monitoring of physiological parameters, patient mobility increases since they no longer need to be tied to the monitoring equipment. For example, when a heart patient requires constant, long term monitoring of the ECG signal, the data can be transmitted wirelessly rather than the patient having to wear ECG measurement leads and having some external device to monitor and collect data. As well, they can save the patient from undergoing an uncomfortable and invasive procedure. The wireless endoscopy capsule is an ingestible pill camera which wirelessly transmits the observed data to an external receiver, a welcomed alternative to traditional endoscopy which involves the insertion of a long tube down the throat of a patient. Since all the data can be transmitted wirelessly to a central 2

CHAPTER 1. INTRODUCTION monitoring station such as a nurses station in a hospital, monitoring of patient vitals can be performed less frequently since all the data is being collected in real-time providing easy access for doctors and nurses. Implantable medical devices can be split into two categories: passive and active. Passive devices are designed with the sole purpose of monitoring a particular physiological parameter, while active devices are able to perform some action in response to a change in the physiological parameter being measured. For example, visual and hearing aids are considered as passive devices and drug pumps for insulin delivery and cardiac rhythmic management systems are active devices [6].

Figure 1.2: General block diagram for an implantable medical device [7]. Figure 1.2 shows the block diagram for an arbitrary wireless IMD. Inside the triangle are the core components of the IMD, namely the power supply, processor, interface and transceiver.

1.2
1.2.1

Medical Implant Communication Service
Overview

The Medical Implant Communication Service (MICS) was established in 1999 (Proposed Feb 12; Adopted November 19) to provide a dedicated frequency spectrum for ultra-low power (ULP) implantable medical devices (IMDs) that would overcome the shortcomings of existing spectra available for these devices. Existing IMDs were typically magnetically coupled to the external control devices, which required very close spacing between the implant and external device to allow for reliable operation. Additionally, the magnetically-coupled devices suffered from low data transmission rates. The proposed MICS spectrum would allow for devices to enjoy the benefits of the advances in wireless technology and communications. RF transmission would afford the patient increased mobility since they no longer need to sit in uncomfortable positions to achieve optimal magnetic coupling to the reader, and increased data rates would reduce the data collection time and give physicians quicker access to physiological data for faster diagnosis. 3

CHAPTER 1. INTRODUCTION The MICS band was proposed to operate in the 402 MHz to 405 MHz UHF spectrum for several reasons. Firstly, the spectrum exhibits favourable propagation characteristics through the human body compared to other spectra that have been allocated for use by physicians and health care providers. These bands are also at risk for interference from high power carriers operating in the same spectrum. Secondly, the spectrum is available worldwide, unlike the ISM UHF bands which require dual band operation to satisfy international regulations, complicating the design of the device. Finally, the operating frequency allows for the device to use an integrated antenna whose dimensions are suitable for implantable devices. The MICS band shares its spectrum with METAIDS meteorological devices operating in the 401 MHz to 406 MHz band, and therefore has been designated to operate on a secondary, shared basis. Since the radiated power from the IMD is small and confined to small distances, the probability that an MICS device will interfere with a METAIDS device is very low. However MICS devices must accept interference from METAIDS devices, therefore designers must be careful to make IMDs robust to noise. The types of devices which are permitted to operate in the MICS band are those which are used for therapeutic and diagnostic purposes, and they can only be used to transmit non-voice data. These devices include implantable cardiac defibrillators (ICDs), pace makers, blood glucose monitors, implantable vagus nerve stimulators and deep brain stimulators. Operating guidelines for the MICS standard have been established by several international regulatory authorities such as the United States FCC [8], Industry Canada Spectrum Management and Telecommunications [9], the Australian Communications and Media Authority [10], and the European Telecommunications Standards Institute [11], and an overview of these regulations is provided in the next section.

1.2.2

Technical specifications

As mentioned previously, favourable propagation characteristics, international availability and low probability of interference are the reasons for choosing the 402 MHz to 405 MHz spectrum for the MICS band. Although there is no fixed channel arrangement for the MICS band, an MICS channel is permitted to have an emission bandwidth between 25 kHz and 300 kHz. An example channel arrangement with ten 300 kHz channels is shown in Fig. 1.3. The maximum equivalent isotropically radiated power (EIRP) for each channel is limited to 25 µW (-16 dBm), and the power at the band edges should be attenuated by 20 dB from the carrier signal. The typical transmission range for IMDs is approximately 2 m. The transmitter data is collected by a medical implant programmer/controller which is operated by a "duly authorized health care professional" such as a physician. The US FCC has specified the following operating guidelines for MICS transmitters:
 Frequency agility: Before transmission takes place, the transceiver should perform Clear-Channel Assessment (CCA) to determine which available channel has the lowest ambient noise, and begin

transmission once the best channel is found.
 A MICS communication session must be initiated by an external medical implant programmer/controller transmitter or in response to a medical implant event. During a medical implant event, the

4

CHAPTER 1. INTRODUCTION transceiver may begin transmission on the first available channel regardless of its noise characteristics. To satisfy regulatory and power saving requirements, MICS transmitters are not intended to be used for continuous data transmission. In order to extend the battery life of the IMD, circuitry should be powered down when not transmitting. A low power wake-up receiver such as the one used in [12] is needed to detect when a communication session is being requested. Regulations state that an MICS transmitter is permitted to transmit only at the request of an external programmer/controller operated by a duly authorized health care processional or in response to a "medical implant event" ­ that is, an unwanted change in the physiological parameter being observed which requires immediate transmission of data to protect the safety and well being of the patient, detected either by a duly authorized health care provider or by the implant itself. Before the MICS transmitter begins to transmit, it must scan all available channels to find the unused channel with the lowest ambient noise. This type of frequency monitoring is called Adaptive Frequency Agility/Listen Before Talk (AFA/LBT). In order for a channel to be usable for transmission, the ambient noise should not exceed the monitoring threshold given by 10log10 B (Hz) - 150 (dBm/Hz) + G (dBi), (1.1)

where B is the bandwidth and G is the MICS programmer/controller antenna gain relative to an isotropic antenna.

25

Pout (mW)

Spectrum

1 2
402.6

3 4
402.9 403.2 402.3

5 6
403.5 403.8

7 8
404.1 404.4

9 10
404.7

Channel
405

Figure 1.3: Allocated frequency spectrum for Medical Implant Communication Service. In 2009, the 402 MHz to 405 MHz MICS band was expanded to accommodate new types of implantable and external medical devices. The two "wing" bands, 401 MHz to 402 MHz and 405 MHz to 406 MHz were added to the spectrum, and the band was renamed to the Medical Device Radiocommunication Service (MedRadio) [13], [14]. While the "core" 402 MHz to 405 MHz spectrum retains its original purpose (AFA/LBT IMDs for time-sensitive, life critical applications), the wing bands may be used for body worn devices which were not previously allowed to operate in the core band. Specifically, the devices can employ Low Power, Low Duty Cycle (LP-LDC) spectrum access with a reduced carrier power of 250 nW EIRP and occupy a maximum bandwidth of 100 kHz per channel. This allows for an additional 20 devices to operate in the new spectrum. The wing bands have been deemed more suitable for devices that might not have the same quality of service demands as those life critical im5

402

Frequency (MHz)

CHAPTER 1. INTRODUCTION plants operating in the core band. These external devices, which do not have stringent requirements on power consumption, can use a narrower bandwidth and more transmissions of greater duration with the possibility of retransmits without significantly compromising patient care or safety. The existing core band is more suitable for short-duration, high speed, data-intensive transmission, which conforms with the battery saving measures used for implanted devices. A summary of the operating specifications for the new MedRadio frequency band is given in Table 1.1. Frequency Band 401 MHz to 402 MHz 402 MHz to 405 MHz 405 MHz to 406 MHz Minimum Bandwidth 25 kHz 25 kHz 25 kHz Maximum Bandwidth 100 kHz 100 kHz 100 kHz Maximum Transmit Power 250 nW1 25 µW 250 nW Spectrum Access Method LP-LDC AFA/LBT2 LP-LDC Type of Device External Implantable External

Table 1.1: MedRadio operating specifications As with the original MICS specifications, the MedRadio band does not have a fixed channel arrangement. An example of a fully occupied spectrum is shown in Fig. 1.4. In order to ensure that the MICS transmitter satisfies all regulatory requirements in regards to emission limits, the IMD is tested inside a test fixture modelling the human torso. The test fixture, shown in Fig. 1.5, is made from a plexiglass cylinder measuring 30 cm by 76 cm, and a sidewall thickness of 0.635 cm. The test fixture is filled with a fluid whose permittivity and conductivity match those of human muscle tissue at 403.5 MHz. The implant is centred vertically and placed 6 cm from the sidewall of the container, and is 1.5 m from the ground level.

1.2.3

Existing work

Although it was officially established in 1999, the MICS band did not receive significant attention from the academic and research communities until almost 2006. Taking into consideration the main design constraints of IMDs, namely ultra-low power consumption to increase battery life and maintaining acceptable RF performance (phase noise, spurious tones, bandwidth and transmit power), several designs for transmitters, receivers, antennas [16], [17], low-noise amplifiers [18], [19], voltage-controlled oscillators and PLL frequency synthesizers have been proposed which attempt to address these criterion. The scope of this work is limited to the voltage-controlled oscillator and PLL frequency synthesizer, and an overview of recent publications in this area will be discussed. However, the reader is encouraged to refer to the above-mentioned references in order to obtain a more complete picture of the state of the art research in MICS transceivers.
1A 2A

150 kHz channel occupying 401.85 MHz to 402 MHz can have an output power of 25 µW. 300 kHz channel centred at 403.65 MHz can use LP-LDC spectrum access at a reduced output power of 100 nW.

6

CHAPTER 1. INTRODUCTION

10

2

10

1

Output power (µW)

10

0

10

-1

Figure 1.4: Allocated frequency spectrum for Medical Device Radiocommunication Service.

The LC VCO presented in Chapter 2 has been used in several previously published works. In [20], the authors proposed an MICS transceiver front-end whose LO is produced using an integer-n frequency synthesizer with quadrature outputs. Implemented in a 130nm CMOS process, the entire PLL consumes 1.2 mW from a 1.2 V power supply. The authors of [21] studied three different MICS VCO architectures designed in a 180 nm CMOS process, two of which used LC VCOs. The first operated in the MICS frequency band and used a polyphase filter to produce quadrature outputs, the second operated at twice the MICS frequency and used a master-slave divide-by-2 to produce quadrature outputs. Results showed that the first method consumed 1.2 mW from a 1.5 V supply, while the second consumed 3.3 mW from a 1.5 V supply. The authors of [21] used a dual band VCO in proposed transceiver, operating at 1 GHz and 400 MHz for the transmitter and receiver respectively, but did not reveal specific performance details. A modification to the LC VCO used in several proposed designs is called a digitally controlled oscillator (DCO) [22]. In this topology the LC tank is modified to include an array of binary-weighted capacitors which can be enabled or disabled by a control bit. Rather than use an analog control voltage as an LC VCO does, the DCO uses an n-bit control word and by changing the control word the resonant frequency of the tank will change. The authors of [23], [24] and [25] used DCOs in their MICS designs, consuming 600 µW, 500 µW and 300 µW, respectively. Ring oscillators are part of another family of oscillators called phase-shift oscillators. Although they 7

401 401.1 401.2 401.3 401.4 401.5 401.6 401.7 401.8 401.9 402 402.1 402.2 402.3 402.4 402.5 402.6 402.7 402.8 402.9 403 403.1 403.2 403.3 403.4 403.5 403.6 403.7 403.8 403.9 404 404.1 404.2 404.3 404.4 404.5 404.6 404.7 404.8 404.9 405 405.1 405.2 405.3 405.4 405.5 405.6 405.7 405.8 405.9 406

10

-2

Frequency (MHz)

CHAPTER 1. INTRODUCTION

Figure 1.5: Medical Implant Communication Service implant torso simulator [15].

consume a small fraction of the area compared to resonator oscillators, such as the LC VCO, they demonstrate poor phase noise performance because of the number of active devices used to implement the oscillator. Nevertheless, the authors of [26] used a four stage differential ring oscillator. Despite citing power saving as the reason for choosing this topology, the ring oscillator consumed 1.1 mW from a 1.5 V supply, more than the previously presented LC VCOs and DCOs. As part of their investigation, the authors of [21] implemented a similar four stage ring oscillator. Although in this case it did consume less power than the two LC VCOs in the same study, it showed significantly worse phase noise performance in comparison. A fairly unknown modification to the traditional LC VCO is the single-ended cross-coupled oscillator, which uses the half-circuit of a complementary LC VCO (which consists of both NMOS and PMOS negative resistance pairs). By virtue of requiring half the bias current, the implementation proposed in [27] consumes less power than those oscillators presented previously (230 µW from 1.5 V supply) but it lacks differential signals which are crucial for common mode noise rejection. This idea was extended by the authors of [28], who proposed an injection-locked single-ended cross-coupled oscillator. The design demonstrates very good phase noise performance, but at the expense of high power consumption (1.2 mW from a 1.2 V power supply). A full summary of the performance of the designs presented in this section will be given in Chapter 4 when comparing the existing works with the design proposed in this thesis. 8

CHAPTER 1. INTRODUCTION

1.3

Project objective and target applications

The objective is to design an ultra-low power CMOS integer-n frequency synthesizer for use in a wireless implantable medical device operating the the 402 MHz to 405 MHz Medical Implant Communication Service spectrum. The synthesizer must have the following characteristics:

 Integrability: The synthesizer should utilize as few off chip components as possible (ideally none)

to achieve the required specifications and functionality, and to decrease its physical size and cost.
 Flexibility: It should be possible to implement the frequency synthesizer in various wireless im-

plantable medical devices which include sensors and transducers to transmit and receive physiological information, provided that the appropriate signal conditioning is included.
 Reliability: Since the device is to be implanted into a human body, manual adjustments to compo-

nents cannot be made (i.e. potentiometers, biasing). Thus the synthesizer should be as insensitive as possible to process variations and temperature in order to provide accurate and stable carrier frequencies for data transmission under all conditions. Additionally, a stable power supply and biasing source is necessary. However the design of such circuitry is beyond the scope of this paper.
 Ultra-low power consumption: In order to achieve long battery life, measures should be taken to

ensure that power consumption is minimized resulting in maximum lifetime of the device.

1.4

Contributions

In this thesis, several novel circuits for a 402 MHz to 405 MHz integer-n frequency synthesizer are proposed, implemented and tested to ensure they conform to the design objectives stated above. The major contributions of this work are:
 A current reuse quadrature voltage controlled oscillator. The proposed topology consumes half the power of conventional quadrature oscillators while improving phase noise performance and is

compatible with low supply voltage operation.
 A design methodology for low power voltage controlled oscillators. By exploiting the MOS EKV model and the gm /iD methodology, the proposed design methodology provides a systematic proce-

dure for various oscillator topologies and is suitable for hand analysis. The methodology is applied to the proposed current reuse quadrature voltage controlled oscillator, however it can be used for most CMOS LC oscillator topologies.
 An ultra-low power programmable frequency divider using subthreshold source-coupled logic. The power consumption has been reduced significantly compared to existing programmable dividers. A

novel D-latch with clear and preset functionality is proposed as existing designs either don't perform clear and preset functions simultaneously or they are not conducive to low voltage applications. 9

CHAPTER 1. INTRODUCTION
 Based on the novel clear/preset D-latch, a subthreshold source-coupled logic phase/frequency detector is implemented.

1.5

Organization of report

This thesis focuses on the topic of ultra-low power frequency synthesis for use in Medical Implant Communication service transceivers. Chapter 2 (Oscillators and Frequency Synthesis): provides a summary of CMOS oscillators and phase-locked loop frequency synthesizer fundamentals. LC VCO fundamentals are introduced, covering LC tanks, start-up conditions, steady-state operation, and phase noise. Spectral purity is explored in terms of phase noise, where two popular models for phase noise analysis are presented. Quadrature signal generation for image-reject transceiver architecture is presented, followed by similar analysis provided for the LC VCO. To support our discussion, the main building blocks are briefly described. Chapter 3 (Medical Implant Communication Service): provides an introduction to the frequency band of interest, the 402 MHz to 405 MHz Medical Implant Communication Service. A brief history of the frequency band is given, followed by the regulatory requirements for implantable medical devices including their operation and testing. A brief literature survey summarizing state-of-the-art designs for Medical Implant Communication Service concludes the chapter. Chapter 4 (The Proposed Subthreshold 402 MHz to 405 MHz Integer-N Frequency Synthesizer): introduces the proposed design of an integer-n frequency synthesizer, with particular attention to the current-reuse quadrature voltage-controlled oscillator and subthreshold source-coupled logic programmable frequency divider. A design methodology for low power oscillators based on the MOS EKV model and the gm /id design methodology is presented. A novel D-latch is proposed to address the need for clear and preset functionality in the programmable divider and phase/frequency detector. Chapter 5 (Results): presents the simulation results for each of the designed circuits using Cadence Spectre circuit simulator, as well as some measurement results from fabricated prototypes. A comparison between existing designs and the proposed design is provided. Chapter 6 (Conclusion): summarizes the contributions of this research and suggests future directions.

10

Chapter 2

Oscillators and frequency synthesis
2.1 Overview

Due to their importance in transmitter and receiver architectures for wired and wireless applications, oscillators and phase-locked loops have received extensive attention in literature and academic research. The depth and breadth of this discussion is limited to those topics and topologies that provide a fundamental understanding of the work proposed in this thesis. References to material on topics outside those covered in this chapter will be given when necessary, and the reader is encouraged to review those references to obtain a thorough understanding of oscillators and phase-locked loops in RF systems.

2.2
2.2.1

CMOS Oscillators
General considerations

Oscillators are autonomous circuits which produce a periodic output signal from a DC power supply. They are an essential component of many electronic communication systems. There are a wide variety of oscillator topologies, each suitable for different applications. Example of oscillator applications include carrier signal generation for wireless RF transmitters, and clock generation for microprocessors. The forthcoming discussion will focus on topics related to the former, and the implementation of interest will be the LC -tank oscillator. As shown in Fig. 2.1, oscillators can be represented as either a one-port network, known as the negative resistance model, or a two-port network, known as the feedback model. The conditions for oscillation can be determined by analysing either of these models. First consider the positive feedback model in Fig. 2.1a, which has a forward gain a(s) and feedback factor f (s). The output signal of the summing block, denoted e(s), is given by e(s) = X (s) + f (s)·Y (s). 11 (2.1)

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS

R1

R2

X(s)

+

a(s) f(s)
(a) Feedback model.

Y(s)

Active Circuit R1 = ­R2

Resonator

(b) Negative resistance model.

Figure 2.1: Oscillator models.

The output signal Y (s) is given by Y (s) = a(s)·e(s). From (2.1) and (2.2) the transfer function of the two-port network can be obtained: a(s) Y (s) = . X (s) 1 - a(s)·f (s) (2.3) (2.2)

In order for this system to oscillate at a frequency 0 , it must satisfy the Barkhausen criterion [29]. The conditions that must be met are that the loop gain at frequency 0 must be unity and the total phase shift around the loop must be an integer multiple of 2 .
 |H (j0 )| = 1.  H (j0 ) = 2n, n  N.

Note that if the network employs negative feedback, the second condition of the Barkhausen criterion changes such that the total phase shift around the loop must be an odd multiple of  .
 H (j0 ) = (2n + 1), n  N.

The one-port oscillator model of Fig. 2.1b consists of two circuits ­ a frequency selective network such as a resonator that exhibits some loss and an active circuit which compensates for the loss in the resonator. The quality factor, Q, of a resonant circuit is defined as the ratio of the energy stored per cycle to the energy dissipated per cycle. Q = 2 energy stored . energy dissipated (2.4)

Ideal resonators have infinite Q and resonate forever, however passive devices implemented in integrated circuit resonators have finite values of Q and can not sustain oscillations (as a rough approximation, the resonator will only oscillate at frequency 0 for Q cycles). In order to produce sustained oscillations a "negative resistor," which has an energy restoring mechanism, can be added to the tank. 12

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS

Active Circuit

Resonator

-Rp

Rp

L

C

Figure 2.2: LC resonator with loss compensation.

This is illustrated in Fig. 2.2, where Rp is a lumped element consisting of the series losses of the inductor and capacitor defined as Rp = 0 LQ. (2.5)

It can be shown that at resonance, the input impedance of the tank at resonance is Rp . Since the tank components are in parallel, one can also consider the admittance of the tank and take the inverse to obtain the impedance. Knowing that the capacitor has a quality factor equal to 0 Rp C and the inductor has a quality factor equal to Rp /(0 L), the admittance can be written as

Ytank (j ) =

1 1 + jC + Rp jL Q j 0 1 + + = Rp Rp 0 j 1  0 = 1 + jQ - Rp 0 

(2.6) (2.7) . (2.8)

This yields an input impedance of Ztank (j ) = Rp  0 1 + jQ - 0  . (2.9)

It can be seen from (2.9) that when  = 0 , the tank impedance consists only of the loss component Rp . This conclusion will help develop the oscillator circuit that will be discussed in the following section.

2.2.2

Negative-gm LC -tank oscillators

Basic topology and analysis The LC -tank oscillator is the most popular circuit in RF applications because of its superior phase noise performance and the ability to be fully integrated on chip (no external components). Referring to the one-port oscillator model, the LC -tank serves as the resonator. The active circuit which compensates for the parasitic losses at resonance is implemented using the cross-coupled differential pair shown in 13

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS Fig. 2.3a. It can be shown that this configuration presents a negative input resistance, which when the transistors are properly sized, can cancel out the losses of the LC -tank.

VDD

Rin
C L Rp

Rp

L

C

ix iD1

vx +M2

iD2

M1

M2

M1

(a) Conventional topology with losses.

(b) Negative impedence measurement.

Figure 2.3: Negative-gm LC -tank oscillator. The test circuit for calculating the input impedance is shown in Fig. 2.3b. The input impedance is obtained by applying a test voltage, vx , across the two terminals of the differential pair and calculating the current, ix , flowing through the circuit. By recognizing that vx = vgs2 - vgs1 and ix = id2 = -id1 , small signal analysis shows that vx -2 = , ix gm and it can be concluded that for the circuit in Fig. 2.3a, oscillations are sustained when Rp = 1 . gm (2.11) (2.10)

The devices in CMOS processes are subjected to variations due to process, supply voltage and temperature (PVT) which may cause the device transconductance to be less than required to guarantee oscillator startup. To combat these variations, the device transconductance is usually designed to be a factor of  greater than what is required by (2.11), where   2. Rp =  . gm (2.12)

The circuit can also be analysed using the feedback model. The transfer function of the circuit in Fig. 2.3a is H (s) = (-gm Ztank (s)) · (-gm Ztank (s)). As shown by (2.9), at resonance Ztank (j0 ) = Rp and the transfer function becomes 14 (2.13)

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS

H (j0 ) = (gm Rp )2 . The total phase shift around the loop should be 0° and to obtain a loop gain of unity Rp = Passive devices in CMOS processes 1 . gm

(2.14)

(2.15)

In previous generations of integrated circuits, passive devices (inductors, capacitors, resistors) were implemented off-chip and connected to the circuit using bond wires. In modern CMOS processes, passive devices can be integrated on the same die as the active circuitry. This is a major benefit in modern CMOS processes because it decreases the total cost of the design. The drawback is that inductance, capacitance and quality factors of on-chip passive devices is much less than their off-chip counterparts. However, the values obtained on-chip are usually sufficient for most applications. Passive devices are used extensively in analog and radio frequency integrated circuits for applications such as filtering, impedance matching, AC coupling, and as the tuned resonator in LC oscillators. Integrated capacitors are typically implemented using the metal-insulator-metal (MIM) topology. The MIM capacitor is a parallel plate capacitor formed using two of the upper metal layers and a thin oxide layer with a high dielectric constant. The capacitance density of a MIM cap is defined in the same
ox way as a transistor ­ Cox = tox ­ where ox is the dielectric constant of the oxide and tox is the oxide thickness. Standard metal layers used for signal routing can be spaced far apart (a few micrometers)

which results in a large oxide thickness and therefore low capacitance density. To remedy this, additional layers specifically for MIM capacitors exist in between the standard metal layers which are closely spaced to reduce the oxide thickness. An example of a MIM capacitor is shown in Fig. 2.4a. MIM capacitors suffer from parasitic losses as with all integrated devices. The top and bottom metal plates have both inductive (Ltop , Lbot ) and resistive (Rtop , Rbot ) losses, and the bottom plate of the MIM capacitor has a parasitic capacitance (Cox ) that exists between itself and the substrate which has a thick dielectric in between. The substrate layer iself exhibits resistive (Rsub ) and capacitive (Csub ) losses, which decrease the quality factor of the MIM capacitor. The equivalent circuit for a MIM capacitor used for circuit simulation is shown in Fig. 2.4b. Square spiral inductors are the most popular planar inductor geometries, but many recent processes allow more optimal geometries such as octagonal and circular inductors. Spiral inductors are wound on the top metal layer and a second layer is used to connect the innermost winding to the outside. As shown in Fig. 2.5a, planar spiral inductors are wound on the top metal layer to increase their selfresonant frequency by decreasing the capacitance to the substrate and a second layer is used to connect the innermost winding to the outside. Spiral inductors get their name because they spiral inward by adding loops inside each successive loop, forming a spiral. The important geometric parameters of a spiral inductor are the number of turns, trace width, trace spacing, trace length, inner diameter and outer diameter. The equivalent circuit of the planar spiral inductor is shown in Fig. 2.5b, where L is the inductance of the spiral, R is the winding loss, Cox is the capacitance existing between the spiral 15

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS

Ltop Rtop Cmim Cox Csub
(a) Three dimensional view.

Rbot Lbot

Rsub

(b) Equivalent circuit.

Figure 2.4: Metal-insulator-metal capacitor.

and the oxide layer, and Csub and Rsub are substrate loss components.

L Cox Csub
(a) Three dimensional view.

R

Rsub
(b) Equivalent circuit.

Figure 2.5: Octagonal spiral inductor.

The planar spiral inductor in Fig. 2.5a has several drawbacks. The inductor is not suitable for differential excitation in applications such as the LC oscillator because the electrical center of the structure is not well defined. As a result, applying a bias potential (i.e. VDD for an LC oscillator) cannot be made with certainty. One way to resolve this is to connect two spiral inductors in series, using the outer ports for differential excitation and the inner ports as the electrical center. Although the electrical center is now well defined (same as the geometric center), the use of two spirals consumes twice as much silicon area. A better approach is to use a symmetric inductor layout, such as the one in Fig. 2.6a, consisting of two interwound coils. In addition to having a clearly defined electrical center and occupying less area, the symmetric inductor benefits from the mutual coupling between the two coils. If the two inductors are identical with inductance L and mutual inductance M , and the coupling factor that exists between them is k , the total differential inductance of the symmetric inductor is 16

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS

Ldif f = L + L + 2M,  = 2L + 2k L × L, = 2L(1 + k ).

(2.16) (2.17) (2.18)

The equivalent circuit of the symmetric inductor is shown in Fig. 2.6b, where the dashed lines indicate coupling between two inductors [30].

Rct Cw Ls/2 Rs/2 L/2 Cox Csub Rsub R/2

Lct

(a) Three dimensional view.

(b) Equivalent circuit.

Figure 2.6: Symmetric spiral inductor. Since the two resonators in Fig. 2.3a are connected in series, they can be merged into a single tank as shown in Fig. 2.7. The inductor is replaced with a differential symmetric inductor with its center-tap connected to VDD .
VDD

2L C/2 2Rp M1
M2

Figure 2.7: Negative-gm LC -tank oscillator with merged tanks.

Transient behaviour Once the oscillator has reached steady state oscillations, the switching transistors M1 and M2 in Fig. 2.3a behave as ideal current sources. The drain current waveforms can be approximated as square waves, since the entire bias current flows through each transistor for half a cycle. The Fourier series of the drain current waveform is 17

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS

IDS =

1 4 4 Ibias 1 + sin 0 t + sin 30 t + . . . . 2  3

(2.19)

IDS Ibias t T
Figure 2.8: Drain current for switching transistor. Assuming the tank quality factor is high enough to attenuate the higher order harmonics, the oscillation amplitude can be approximated as ^0 = 2 Ibias Rp , V  where Ibias is the bias current and Rp is impedance of the parallel LC tank at resonance. The negative-gm oscillator can be modified to use PMOS transistors (Fig. 2.9a) or both NMOS and PMOS transistors (Fig. 2.9b) to generate the negative resistance required to sustain oscillations. The latter is commonly referred to as the CMOS oscillator since it uses both NMOS and PMOS cross-coupled transistors. The behaviour of the CMOS oscillator is different than the NMOS-only and PMOS-only oscillators ­ the total negative conductance and output oscillation amplitude are twice that of NMOSonly and PMOS-only oscillators.
VDD

(2.20)

VDD

M1P 2Rp

M2P

M1 2Rp C/2 2L

M2

C/2 2L

M1N

M2N

(a) PMOS oscillator.

(b) CMOS oscillator.

Figure 2.9: Variations of the negative-gm topology.

18

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS

2.2.3

Voltage-controlled oscillators

TX IF Modulator

PA
Transmitter

TX/RX Switch

LO IF Filter LNA

Receiver

Figure 2.10: Simple transceiver. Consider the simple transceiver architecture of Fig. 2.10. The transmitter consists of a baseband modulator, a frequency mixer which up-converts the baseband data to the carrier frequency, and a power amplifier. The receiver consists of a low-noise amplifier, a frequency mixer to down-convert the RF signal to an intermediate frequency (IF), and a filter. The mixer produces tones at (fin1 + fin2 ) and (fin1 - fin2 ), where one of the frequencies is produced by the local oscillator (LO). The transceiver must be able to operate on one of many channels available in the allocated frequency band since each channel can only be occupied by one user. When operating in transmit mode, the modulated data would be transmitted on a channel which is not in use and has acceptable noise characteristics.

w
1 2 3 B 4 N Channel

Figure 2.11: Arbitrary spectrum for example transceiver. If the transceiver can operate on the arbitrary spectrum of Fig. 2.11 which contains N channels spaced B Hz, the transmitter should be capable of operating on any of those frequencies. In order to achieve this behaviour, the LO must be tunable so that the up-converted frequency (fBB + fLO ) is equal to the desired carrier frequency. For the receiver, in order to use a fixed IF filter the incoming RF signal must be downconverted to the IF. This means that the LO must be tuned so that the down-converted frequency (fRF - fLO ) is equal to the IF frequency. The tunable LO is implemented using a voltagecontrolled oscillator (VCO). A VCO is an oscillator whose output frequency is directly proportional to an input voltage, known as the "control voltage" Vcont . The relationship between a VCO's control voltage and output frequency, out , is 19

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS

out = 0 + KV CO Vcont ,

(2.21)

where 0 is the free-running VCO frequency when no control voltage is applied and KV CO is the VCO gain. The conceptual VCO block diagram and its tuning characteristics are shown in Fig. 2.12b.
Ideal Actual

wout w2 w1 w0
V1
KVCO

Vcont

Voltage-Controlled Oscillator
(a) Block diagram.

wout

V2

Vcontrol

(b) Tuning characteristics.

Figure 2.12: Voltage-controlled oscillator. The amount of frequency variation is known as the tuning range, and is typically determined by the requirements of the desired application. The gain of the VCO is the ratio of the tuning range to the usable control voltage (i.e. the slope of the tuning curve), KV CO = 2 -  1 . V2 - V 1 (2.22)

Ideally the tuning characteristics shown in Fig. 2.12b are linear, but since there are no ideal elements in CMOS processes there is always some nonlinearity as demonstrated by the dashed line in the figure. In addition to nonidealities in the VCO components that contribute to the nonlinearity of the tuning characteristics, the VCO is susceptible to noise on the control voltage. When this noise is added to the control voltage the noise is amplified by KV CO , causing random variations to the VCO frequency. In order to reduce the effect of noise the VCO gain should be minimized, ensuring that the tuning range requirements are still satisfied. By maximizing the amplitude of oscillations, the sensitivity to noise is decreased but at the expense of increased power consumption, VDD × Ibias . This is an important consideration for ultra-low power oscillators where minimization of power consumption is an important design criterion. The VCO topologies shown in Fig. 2.3 are capable of tuning since the resonator uses passive components with fixed values. In order to implement a VCO in a CMOS process, the negative-gm oscillator is modified by adding a tunable element to the resonator which changes the resonant frequency of the tank in response to a control voltage. The most popular tuning element is the MOS varactor. The structure of the MOS varactor shown in Fig. 2.13 is known as an "NMOS-in-nwell" varactor. By shorting the drain and source terminals together, a capacitor is formed between the gate and drain/source terminals 20

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS whose value is controlled by the voltage Vg-sd . Although other MOS varactor topologies are available, it has been shown the NMOS-in-nwell exhibits the lowest phase-noise and power consumption [31].
Vg Vs/d

n+

n+
n-well p-sub

Figure 2.13: Cross-section of MOS varactor.

2.2.4

Phase noise in oscillators

^0 cos(0 t + ), where V ^0 is the VCO An ideal oscillator produces a signal which is described by x(t) = V amplitude, 0 is resonant frequency, and  is a fixed excess phase. The output spectrum of an ideal oscillator is a delta function at frequency 0 , as shown in Fig. 2.14a. Real oscillators are subjected to phase noise, which is a random variation in the excess phase, as well as amplitude noise. Taking these ^0 (t) cos(0 t + (t)). nonidealities into account, the output waveform can then be described by x(t) = V The amplitude noise is typically disregarded because of the amplitude limiting mechanism provided by the fixed bias current in the oscillator, therefore the noise at the output is dominated by phase noise. The frequency domain representation of the waveform is no longer an impulse, rather the spectrum has a finite width centered at 0 as shown in Fig. 2.14b.

w0
(a) Ideal.

w

w0
(b) Actual.

w

Figure 2.14: Voltage-controlled oscillator output spectrum. Phase noise is measured in units of dBc/Hz, which is how much power the signal contains at an offset frequency relative to the carrier within a 1 Hz measurement bandwidth. The negative effects of phase noise can be seen in both the transmitter and receiver. Consider again the abitrary spectrum presented previously, but this time in the presence of phase noise. If the LO of the transmitter is noisy the noise 21

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS spectrum can leak into adjacent channels, corrupting that channel's carrier signal. If the receiver's LO is noisy, any signal which is at a small offset from the incoming carrier will also get downconverted and corrupts the IF band because of the finite width of the LO spectrum which provides "parasitic LO's" to adjacent signals. Phase noise is quantified by the ratio of the single-side band power at an offset  from the carrier within a measurement bandwidth of 1 Hz to the power of the carrier signal, L { } = 10 log Psideband (0 +  , 1 Hz) . Pcarrier (2.23)

One of the most famous phase noise models, which has been the driving force behind modern phase noise analysis, is the Leeson-Cutler model [32]. This semi-empirical model is based on linear, timeinvariant (LTI) analysis of the oscillator and predicts the phase noise as L { } = 10 log 2F kT 1+ Pcarrier 0 2Q
2

 1+

1 f3

|  |
1 f3

,

(2.24)

where F is called the noise factor, k is the Boltzmann constant, and  device
1 f

is approximated as the

noise corner. Graphically the Leeson model is illustrated in Fig. 2.15.

Figure 2.15: Predicted phase noise spectrum. Several important qualities can be observed from this model [33]:
 L { } always has a  L { } has a  L { } has a

1 region. f3

1 0 0 region from  13 to , but only if  13 < . f f f2 2Q 2Q 1 0 0 region from to  13 , but only if <  13 . f f f 2Q 2Q

0 .  L { } has a white noise region at starting at the larger of  =  1 or  = 2Q 3 f There are several shortcomings in the predictive power of this model [34]. Firstly the noise factor F was added as a fitting parameter to account for the excess noise contribution of the energy restoring 22

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS 1 f3

mechanism and can only be determined through measurement. Secondly the transition from the region to the

1 1 region does not occur at the device noise corner, and must also be considered as an 2 f f 0 empirical fitting parameter. Lastly, L { } does not always flatten out at  =  13 or  = . Despite f 2Q these shortcomings, an important conclusion that can be drawn from this model is that phase noise can be minimized by maximizing the tank quality factor and the carrier signal power. The drawback of the latter is the increase in oscillator power consumption. In order to address the flaws in the Leeson model, a new linear, time-varying (LVT) phase noise model was proposed by Hajimiri and Lee [35], [36]. The authors sought to investigate how noise injected into an LC tank affects the phase and amplitude of oscillation. The important conclusion describes how

the time at which the charge is injected changes the oscillation amplitude and phase. If the charge is injected at a peak of oscillation, the amplitude will increase in response to the energy added to the tank, however the phase does not change. On the other hand if the disturbance occurs at a zero crossing, both the amplitude and phase of oscillation changes. In order to describe this behaviour, the authors proposed the following unit impulse response for excess phase, (0 t) u(t -  ), qmax

h (t,  ) =

(2.25)

where qmax is the maximum charge displacement across the capacitor, u(t -  ) is the unit step function occurring at t =  , and (0 t) is a periodic function called the Impulse Sensitivity Function (ISF) describing how much phase shift results by applying a unit impulse at t =  . Examples of the ISF for common oscillator output waveforms is shown in Fig. 2.16 [35]. The phase offset caused by an impulse current can be calculated using the superposition integral



(t) =
-

h (t)i(t -  )d,
t -

(2.26) (2.27)

=

1 qmax

(0 t)i( )d.

A full derivation of the integral and assumptions made therein is given in [34], [35], [36]. From the result of the expression, the authors further explore how this excess phase affects the output voltage, and it was found that noise components near integer multiples of the carrier frequency all fold in to the noise near the carrier itself. Minimization of the ISF is instrumental in reducing phase noise. This model is a significant step in understanding the mechanisms of phase noise, as the authors have described many important aspects such as the conversion of current noise into excess phase, excess phase into output voltage, sideband noise power, as well as equations describing the phase noise spectrum in 1 1 the 3 and 2 regions, and the corner frequency between those regions. f f 23

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS

Figure 2.16: Waveforms and ISFs for (a) a typical LC oscillator and (b) a typical ring oscillator.

2.2.5

Quadrature oscillators

The LC VCO produces differential outputs, that is the outputs are 180°out of phase. Modern transceiver architectures that use image rejection to remove undesired tones whose distance from the LO is equal to the intermediate frequency of the transceiver employ complex mixers which are driven by a quadrature local oscillator, which produces four output signals whose phases are 90°apart. One of the most popular methods for quadrature signal generation was proposed in [37]. The authors observed that by cross coupling two LC oscillators that operate at a common frequency, the output phases are in precise quadrature. The quadrature LC tank oscillator is shown in Fig. 2.17.

A lator Oscil
M2A M1A M3A M4A

Oscil

lator

B

Cros s Con Direct Connection

necti

on

Figure 2.17: Original quadrature LC oscillator (omitting bias). In the design proposed in [37], the LC tank is modified by adding coupling transistors (M3A, M4A) in parallel with the switching transistors (M1A, M2A). The outputs of Oscillator A are directly coupled to Oscillator B's coupling transistors, and the outputs of Oscillator B are cross-coupled to Oscillator A's coupling transistors. As in the previous discussion about LC oscillators, adding a frequency tuning element such as a varactor will produce a quadrature LC VCO (QVCO). In [38], the authors used symmetry to conclude that the two oscillators will have identical oscillation frequency and amplitude if 24

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS their output voltages are in quadrature. They further demonstrate that the oscillators will synchronize at a frequency greater than the tank resonant frequency. Using a linearized model of the QVCO, the authors of [39] showed that the transfer function of the loop that exists between the positive output nodes of Oscillators A and B is given by
 + - 0 C  VB 0 = - j + GMc VA 0 

,

(2.28)

where GMc is the effective large signal transconductance of the coupling transistors. This equation verifies that the two tanks can not synchronize at the resonant frequency since when  = 0 , the tank voltage becomes zero. In the original QVCO topology, commonly referred to as the parallel QVCO (PQVCO) because of the location of the coupling transistors, the switching and coupling transistors were sized equally. In more general cases, the transistors are not all sized the same. The ratio of the width of the coupling transistor to the width of the switching transistor is called the coupling factor, and denoted as . = Wcpl . Wsw (2.29)

This parameter has an important role in the QVCO performance. In [40] the authors showed that for the PQVCO a coupling factor of unity provides the best phase error, and reducing the coupling between the two oscillators (by decreasing ) increases the phase error. However, phase noise improves as  decreases. A trade-off exists between phase noise and phase error, and the selection of  is important for optimizing both of these parameters. Further analysis by the authors showed that by varying the coupling factor the amount of bias current flowing through the switching and coupling transistors changes. When steered entirely into one branch (M1A, M3A or M2A, M4A), the bias current Ibias has two components: Isw flowing through the switching transistor and Icpl flowing through the coupling transistor,

Isw = (1 -  )Ibias , Icpl = Ibias , where  is defined for compactness, = Wcpl  = . Wsw + Wcpl 1+

(2.30) (2.31)

(2.32)

By analysing the drain current waveforms during a cycle of oscillations, the oscillation amplitude is given by ^0 = 2 (1 -  )Ibias Rp , V  (2.33)

which shows that only the current flowing through the switching transistors contributes to the oscillation amplitude. A weaker coupling factor gives rise to a larger oscillation amplitude, which improves the phase 25

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS noise at the expense of phase error. Another way to increase the oscillation amplitude is to increase the bias current, however this also increases the power consumption of the oscillator and the increase is compounded by the fact the there are now two oscillation cores each drawing their own bias current. The work presented in [37] has motivated a significant amount of research into the design of QVCOs and analysis of their behaviour and phase noise performance, as well as modifications to the original topology to improve phase noise, power consumption and quadrature accuracy. Some notable modifications include
 The disconnected-source QVCO (DS-QVCO) [41], where the switching and coupling transistors or the PQVCO are biased independently,  The series QVCO (SQVCO) [39], where the coupling transistors are placed in series with the

switching transistors.
 The phase-tunable QVCO (PT-QVCO) [42], which is capable of correcting phase errors in the quadrature outputs,  The transformer-coupled QVCO (TC-QVCO) [43], in which two LC -VCOs are cross-coupled passively by on-chip transformers instead of actively by coupling transistors as in conventional LC QVCOs to generate quadrature signals.

However, the most common QVCO implementations in recent literature are the PQVCO and the SQVCO. Like the LC VCO, the QVCO can be implemented as NMOS-only, PMOS-only, or complementary oscillators.

2.3

Phase locked loops and frequency synthesizers

In order to generate the tunable LO signal for a transmitter or receiver chain, the LC VCO is not sufficient because oscillators, like all other circuits implemented in a CMOS process, are subjected to variations due to process, supply voltage and temperature (PVT). This means that if an entire wafer of the same VCO was fabricated and tested, one would observe variations in the criteria which describe ^0 , power consumption, tuning range, phase noise). If the tuning characteristics of an oscillator (0 , V a VCO were predictable and constant across all dies, the voltages to tune to a particular frequency could be stored in a ROM on chip for fast frequency tuning. Referring to Fig. 2.12b, the tuning curve may shift vertically or horizontally, or the slope may become steeper or shallower, therefore the tuning characteristics would no longer be predictable. To produce a stable LO signal, the oscillator is placed in a closed-loop feedback system called a phase-locked loop (PLL). The function of a PLL is to align the output phase of the VCO with the phase of a stable reference clock, such as a crystal oscillator.

2.3.1

Simple phase-locked loop

The simple PLL consists of a VCO and a phase detector in a closed loop as shown in Fig. 2.18a. The phase detector compares the phase of the VCO output signal with that of an input reference, and 26

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS
Phase Detector VIN,øIN
REF OUT FB

Loop Filter VPD VLF

VCO

Phase Detector

Loop Filter VPD VCONT

VCO

VOUT,øOUT

VIN,øIN

+ +­

VOUT,øOUT

(a) Block diagram.

(b) Linear model.

REF FB VPD Dø

(c) Phase detector waveforms.

Figure 2.18: Simple phase-locked loop.

produces an output whose average value is proportional to the phase difference, , V pd = Kpd . (2.34)

The slope of the V pd ­ curve is called the phase detector gain and is denoted Kpd . Consider the waveform in Fig. 2.18c where the input reference leads the output. The phase detector produces an output from when the input signal is high to when the output signal is high. Recalling that the phase is the integral of frequency, in order for the phases to be aligned the output signal must accumulate phase faster, which necessitates a temporary increase in frequency until the phases are aligned. This process is known as phase-locking. The phase detector output can not be connected directly to the VCO because the control voltage should be the average value of the phase detector output. In order to extract the DC component from the phase detector output, a low pass filter, commonly referred to as the loop filter, is placed between the phase detector and the VCO. To simplify the analysis, the loop filter is assumed to be a first order RC filter. Ideally in locked condition the phase error is zero, but in practical situations the PLL reaches the locked condition when the phase error is a constant, small value. That is, din dout - = 0. dt dt Again recalling that the frequency is the derivative of phase, we have in = out , (2.36) (2.35)

implying that in the locked state, the input and output signals have the same phase and frequency. The PLL can be analysed using the linear model of Fig. 2.18b [29]. The phase detector is modelled as 27

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS a subtractor whose output, the phase difference between the input and output waveforms, is "amplified" by Kpd . The first order lowpass filter has a transfer function 1+ 1 s . The output waveform of a VCO
LP F

^0 cos(out t) and out = 0 + KV CO Vcont . Since frequency is the derivative can be described by x(t) = V of phase, the phase of a sinusoid can be expressed as = dt + 0 , (2.37)

where 0 is the initial phase and usually assumed to be zero [29]. Substituting this result into x(t) yields

^0 cos x(t) = V

out dt . Vcont dt .

(2.38) (2.39)

^0 cos out t + KV CO =V

For the purpose of phaselocking, only the excess phase of the cosine argument is important. We use this term to obtain the transfer function of the VCO.

ex = KV CO KV CO ex (s) = Vcont s

Vcont dt.

(2.40) (2.41)

From (2.41) it is clear that the VCO operates as an ideal integrator. The open-loop and closed loop transfer functions for the simple PLL can be computed as:

Hol (s) =

out 1 KV CO = Kpd · · , s in 1 + LP s F Kpd KV CO . + s + Kpd KV CO

(2.42)

Hcl (s) =

s2 LP F

(2.43)

Further analysis of the simple PLL given in [29] shows that it suffers from two main drawbacks: (1) narrow lock acquisition range (2) tradeoffs between the settling time, control voltage ripple, phase error and stability. The range of frequencies over which the PLL can achieve phase lock is called the acquisition range, and is approximately limited to the bandwidth of the loop filter. In order to overcome this problem, the simple PLL must be modified. Specifically, the phase detector must be replaced with a block which can pull the output frequency within the acquisition range of the PLL, then perform phase locking as usual. This block is known as the phase/frequency detector, and will be discussed in the context of charge-pump phase lock loops described in the next section. 28

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS

2.3.2

Charge-pump phase-locked loop
VDD D REF Q Q UP UP

REF FB QA QB

REF FB QA QB

FB VDD D

Q Q

DN DN

(a) REF > F B .

(b) REF < F B .

(c) Implementation.

Figure 2.19: Phase/frequency detector. Before introducing the entire charge-pump phase-locked loop (CP-PLL), an overview of the new components will be given. As mentioned previously the phase detector is replaced with a circuit which can detect both phase and frequency differences of its input signals. The phase/frequency detector (PFD) has two inputs: REF and FB, and two outputs: UP and DN. The UP signal is high when the REF signal leads the FB signal in either phase or frequency. Likewise, the DN signal is high when the FB signals leads the REF signal in either phase or frequency. When a frequency error exists, such as in Fig. 2.19a, the UP signal is high between the rising edge of the REF signal to the rising edge of the FB signal. Similarly when a phase error exists, such as in Fig. 2.19b, the DN signal is high between the rising edge of the FB signal to the rising edge of the REF signal. In both cases, the output is proportional to either the phase or frequency difference between the inputs. The conventional implementation of the PFD consisting of two D-flip flops and an AND gate is shown in Fig. 2.19c. Unlike the simple PLL, the PFD output does not get filtered by the loop filter directly. Instead, the UP and DN outputs are used to drive a charge pump (CP), which consists of two switched current sources that add or subtract charge from the loop filter. A capacitor can be used as the loop filter since the purpose is for storing charge. The conceptual CP-PLL and its linear model are shown in Fig. 2.20. In Fig. 2.20c the behaviour of the PFD/CP is shown. When UP is high, the top current source is enabled and dumps charge onto the loop filter capacitor until it goes low. The average value of the charge pump output, I CP , is proportional to the phase difference between REF and FB. Assuming that IU P =IDN =I , the average output current can be written as I CP = I  . 2 (2.44)

The gain of the PFD/CP combination, Kpd , is defined as the average charge pump output current for a given phase difference at the input of the PFD, and can be expressed as Kpd = I I CP = .  2 29 (2.45)

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS
Charge Pump IUP ICP Loop Filter VCONT
VCO

Phase/Frequency Detector

VIN

REF FB

UP DN

UP

VOUT

DN IDN

PFD/CP VIN,øIN

Loop Filter VPD VLF

VCO

+ +­

VOUT,øOUT

(a) Block diagram.

(b) Linear model.

REF FB UP VCONT

(c) Waveforms.

Figure 2.20: Charge-pump phase-locked loop.

Following the previous assumption that the loop filter is a single capacitor the loop filter transfer function, G(s), is G(s) = 1 . sC1 (2.46)

The open-loop and closed loop transfer functions for the CP-PLL can be computed,

Hol (s) =

out , in I 1 KV CO = · · . 2 sC1 s
KV CO I 2C1 V CO I 2 s +K 2C1

(2.47) (2.48)

Hcl (s) =

.

(2.49)

Since the loop gain has two poles at the origin, each contributing 90° phase shift, the loop is unstable. Stabilization is realized by adding a resistor, R1 in series with the capacitor, thus adding a zero to the loop gain. This resistor causes voltage drops on the control voltage whenever the charge pump injects/draws current to/from the loop filter, leading to frequency instability of the VCO. To resolve this a second 30

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS capacitor, C2 is placed in parallel with R1 and C1 , whose value is approximately stability problems. Configuration Transfer Function
1 10 C1

as to not create

C1
(a)

R1 C1
(b)
R1 C1 C2

(c) Table 2.1: Loop filter topologies. So far we have seen why VCOs are needed in transmitters and receivers, and why the nonidealities caused by PVT variations in CMOS processes require placing the VCO in a PLL configuration to generate a stable output frequency. The question now arises: knowing that the output frequency is equal to the input frequency in the locked condition, how can the PLL produce a multitude of output frequencies to operate within the desired spectrum? Recall Fig. 2.11 and assume the frequency at the lower end of the spectrum is f0 . To operate on the ith channel of the spectrum, the PLL output frequency must be f0 +(i-1)B. In accordance with (2.37), one might think that in order to change the output frequency, the input frequency must be changed. This is not a practical solution for integrated circuit transmitters and receivers because the input frequency is generated by a highly stable crystal oscillator, and putting multiple crystals on chip corresponding to each output frequency is even less practical. Instead, a new block is inserted in the feedback path which allows a programmable constant of proportionality between the input and output frequencies. Producing multiple output tones from a single fixed reference frequency is called frequency synthesis. Although there are several frequency synthesizer architectures, the one which will be the focus of the following section is the integer-n architecture.

2.3.3

Integer-N frequency synthesizer

As shown in Fig. 2.21 an integer-n frequency synthesizer consists of a single high spectral purity quartz crystal oscillator as the reference for a PLL, and a frequency divider in the feedback path. The output frequency of the voltage-controlled oscillator (fOU T ) is an integer multiple of the reference frequency 31

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS
Charge Pump IUP ICP Loop Filter VCONT
VCO

VIN,fIN

Phase/Frequency Detector
REF FB UP DN

UP

VOUT,fOUT

DN IDN
Channel Select

¸D
Programmable Divider

Figure 2.21: Integer-n frequency synthesizer block diagram. (fIN ), yielding the relationship fOU T = D × fIN . To generate frequencies given by fOU T =f0 +(i-1)B, a frequency divider with variable modulus can be used. This can be achieved by using a programmable frequency divider whose modulus can be varied between DL and DH . By changing the division ratio of the divider, the RF carrier frequency will increase or decrease so that the relationship between fREF and fIN is satisfied. If D × fIN has to equal f0 +(i-1)B, for the first channel (i=1) we have DL × fIN =f0 , which implies that B=fIN . For integer-n synthesizers, fIN must be equal to the required channel spacing [44]. The three types of frequency dividers shown in Fig. 2.22 are used to design the programmable divider.
D fIN D Q Clk Q D Q Clk Q Q Q
fIN

fOUT=fIN/2
D Q Q MC D Q Q fOUT

Positive edge-trigged D-Flip Flop

(a) Divide by 2.
Reload Circuit SR SR SR SR SR

(b) Divide by 2/3.
SR

D fIN

Q Q Q1

D

Q Q Q2

D

Q Q Q3

D

Q Q Q4

D

Q Q Q5

D

Q Q Q6 fOUT

End-of-Count Detector

(c) Programmable counter.

Figure 2.22: Types of frequency dividers. As given by its name, static modulus dividers are only capable of dividing by a fixed value, the simplest being divide-by-2 (Fig. 2.22a). Typically these dividers operate at high speeds and are useful for reducing the frequency so that subsequent logic which operates at lower frequencies can be used. When cascaded, these dividers can achieve a division ratio of 2k , where k is the number of divide-by-two 32

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS cells in cascade. By combining the divide-by-two circuit with some additional logic, a dual-modulus prescaler (DMP) with division ratio of M or M + 1 is formed (Fig. 2.22b). The modulus control signal (M C ) determines what value the divider divides by. Typical values of dual modulus dividers are 2/3, 4/5, 8/9, 15/16 and 32/33. A programmable divide-by-N counter (Fig. 2.22c) is a down counter consisting of cascaded asynchronous divide-by-2 stages, an end-of-counter (EOC) detector and a reload circuit. The value of N is determined by a control word which presets or clears each stage accordingly. Once the counter reaches the null state, a reload signal is produced and the countdown begins again. Since the reload signal is produced every N cycles, its frequency is fin /N, where N can be programmed between 2 and 2k -1 and k is the number of divide-by-2 stages in the counter. The conventional programmable frequency divider is shown in Fig. 2.23. It consists of a dual-modulus prescaler and two programmable counters, referred to as the Pulse counter and Swallow counter. The programmable divider operates as follows: When a CLKOU T pulse is generated by the Pulse counter, both counters reload to their initial states and the M C signal goes high. The initial states are determined by the S and P control words. The DMP divides CLKIN by (M + 1) until the swallow counter has counted down to 0. The Swallow counter generates a CLKOU T pulse which changes the MC to low and the DMP divides CLKIN by M until the Pulse counter has counted down to 0. The Pulse counter generates a CLKOU T pulse and the process repeats. Since the DMP divides by (M + 1) S times and by M (P - S ) times, the division ratio, D, of the programmable divider is given by

D = (M + 1)S + (P - S )M, = M P + S.

(2.50) (2.51)

P[0:N]

CLKIN

CLKIN

¸M/M+1
MC

PULSE COUNTER
CLKIN RELOAD CLKOUT

CLKOUT

CLKOUT

RELOAD CLKIN CLKOUT

SWALLOW COUNTER

S[0:N]

Figure 2.23: Block diagram of programmable frequency divider. Channel selection can be performed by changing either the S or P control words. Typically the P counter is fixed and S is varied to allow selection of successive values. It is evident from Fig. 2.22 that the D-flip flop (DFF) is a fundamental component in the presented types of frequency dividers. A popular implementation of the DFF is the master-slave D-latch configuration shown in Fig. 2.24. D-latches can be implemented using many logic families as shown in Fig. 2.25, however the most common logic families are true single-phase clocked (TSPC) [45] and source-coupled logic (SCL) [46]. 33

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS
Master Slave

D Clock

D Q Clk Q

D Q Clk Q

Q Q

Positive edge-trigged D-Flip Flop
Figure 2.24: Master-slave d-flip flop.

D Q
CLK

Q
(a) CMOS.

VDD

Q-

Q+

RL

RL

VDD

D+

D-

D

CLK

CLK

CLK+
Q

CLK- Ibias

(b) TSPC.

(c) SCL.

Figure 2.25: Types of d-latches.

2.4

Summary

In this chapter, we have examined oscillators at the system and circuit level. Two approaches for oscillator analysis, the feedback model and the negative resistance model, were used to establish the conditions for oscillation. Using the conventional LC -tank oscillator as a starting point, we provided analysis and design criterion for the voltage-controlled oscillator and quadrature voltage-controlled oscillator. An important design metric, phase noise, was discussed and two important models for phase noise analysis, the Leeson model and Hajimiri-Lee model, were presented. Noting that an integrated circuit oscillator alone cannot produce a stable frequency due to process, supply voltage, and temperature variations, the phase-locked loop was introduced and system level analysis of a simple phase-locked loop and the charge-pump phase-locked loop were provided. To address the need for producing multiple tones from 34

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS the phase-locked loop, the integer-n frequency synthesizer was introduced. The concepts presented in this chapter are fundamental to the understanding of the work proposed in this thesis.

35

CHAPTER 2. OSCILLATORS AND FREQUENCY SYNTHESIS

36

Chapter 3

The Proposed Subthreshold 402 MHz to 405 MHz Integer-N Frequency Synthesizer
In this chapter, several novel circuits are proposed for use in an ultra-low power integer-n frequency synthesizer (Fig. 2.21) operating in the 402 MHz to 405 MHz MICS frequency band. Namely, a currentreuse quadrature voltage controlled oscillator, subthreshold source-coupled logic programmable divider with clear/preset d-latch, and subthreshold source-coupled logic phase/frequency detector are proposed. The evolution of each circuit from the conventional implementation to the proposed design is discussed.

3.1

Design specifications

Implantable medical devices are typically powered by batteries, which inherently have finite lifetimes. In order to maximize the lifetime of the implantable battery, IMDs must be designed to consume as little power as possible, since it is impractical to subject the patient to a medical procedure, such as surgery, to replace the battery. Measures must be taken at both the system level, such as power-off/wake-up circuitry for when the device is not transmitting or receiving data, and at the circuit level, by using novel circuits which reduce static power consumption of conventional designs. By recognizing that the fundamental definition of power consumption is P = V ×I , the power consumption can be reduced by minimizing the supply voltage, the bias current, or both simultaneously. The principal design approaches used to develop the proposed circuits are summarized as follows. Current reuse: This can be achieved when two circuits consume the same bias current. Rather than biasing two circuits independently, the circuits are connected in a stacked topology between the supply rails and have a single bias current flowing through them. Conceptually this is illustrated in Fig. 3.1. This technique has been used successfully in [47] where the authors implemented a 37

CHAPTER 3. PROPOSED WORK stacked quadrature Gilbert cell downconversion mixer and cascode low-noise amplifier, consuming 11.3 mW from a 2.5 V supply. Although this particular design does not provide ultra-low power consumption, it demonstrates the viability of this concept. In order to effectively employ this power saving technique, the supply voltage must be sufficient to keep all transistors in their desired region of operation.

VDD
CIRCUIT A

ibias

CGND

CIRCUIT B

Figure 3.1: Current reuse between two stacked circuits.

Supply voltage scaling: The scaling of CMOS transistor minimum feature size (device length) has typically been accompanied with lower supply voltages (for example, 3.3 V for 350 nm, 2.5 V for 250 nm, 1.8 V for 180 nm, 1.2 V for 130 nm). However, as minimum feature sizes are scaled further into the tens of nanometers the supply voltage no longer scales at the same rate. This is caused in part by the reverse short channel effect, which is a separate discussion beyond the scope of this work. In order to provide sufficient voltage headroom to keep the devices in the strong inversion region, nanoscale processes do not scale the supply voltage at the same rate (for example, 1 V for 65 nm and 45 nm). If the supply voltage is scaled to the point where the device operates in the moderate or weak inversion regions, there are benefits from a power consumption point of view. The rationale for doing so will be discussed in the following section. Weak inversion operation: It is well known that when the gate voltage of a device drops below its threshold voltage, current does not immediately stop flowing through the device. Rather, the device enters the weak inversion region, where the current-voltage relationship is exponential as opposed to the square-law relationship in strong inversion. Weak inversion operation bears a strong resemblance to bipolar transistor operation. It has been shown that the weak inversion region provides the highest "transconductance efficiency", gm /id , which is the capability to translate current into transconductance [48]. By exploiting this property, a device operating in the weak inversion region is capable of producing the same transconductance as a device operating in strong inversion while consuming significantly less current, provided the transistor is sized correctly. Using a combination of these power-saving techniques, novel circuits for an ultra-low power integer-n frequency synthesizer operating in the 402 MHz to 405 MHz MICS frequency band will be presented. 38

CHAPTER 3. PROPOSED WORK Development of these circuits, methods for achieving ultra-low power consumption, and design methodologies will be discussed. The synthesizer will satisfy the channel selection requirements of the MICS band, that is, it can tune to one of the ten channels which are spaced 300 kHz apart. Operation in the 401 MHz to 402 MHz and 405 MHz to 406 MHz wing bands designated in the MedRadio specifications will not be covered, the proposed design will operate only in the core MICS band. Since there are no set requirements for power consumption, the objective will be to provide lower power consumption and comparable or better performance than previously proposed designs.

3.2

Proposed current-reused quadrature voltage-controlled oscillator

Existing QVCO topologies consume significant amounts of power, making them unsuitable for ultra-low power applications such as IMDs. Increasing the quality factor of the tank to achieve high oscillation amplitude for small bias currents has its limits, since the quality factor of inductors in CMOS processes is typically between 10 to 20. Therefore, it is necessary to explore other means to reduce power consumption of the QVCO. One of the salient properties of the QVCO is that its power consumption is double that of the standard LC VCO, as shown in Fig. 3.2a. When stacking two different circuits, the performance of one circuit may be compromised because it may have better performance when biased independently. However in the QVCO both oscillator cores are ideally identical, thus current reuse is viable and will provide a 50% improvement in power consumption. The conceptual QVCO with current-reuse (CRQVCO) is shown in Fig. 3.2b, where two coupled LC tank oscillators are stacked between the supply rails.

VDD
90°

VDD
ibias

VDD
90°

VCO A
180° 0°

ibias
180° 0°

VCO A

ibias
270°

VCO B

270°
(b) Proposed current-reuse.

VCO B
QVCO with

(a) Conventional QVCO.

Figure 3.2: Quadrature VCO block diagram. Going back to the types of LC VCOs and QVCOs discussed in Chapter 2, the choice of oscillator topology for the CR-QVCO cannot be made arbitrarily. The ideal oscillator core is conducive to low voltage operation and provide minimum "challenges" for the designer. Firstly, the choice of coupling topology should be made. Since low voltage operation is one of the design criterion, the number of transistors which can be stacked between the supply rails must be kept to a minimum. For this reason, 39

CHAPTER 3. PROPOSED WORK the SQVCO is not a suitable option because there would be five transistors connected between the supply rails ­ two from each oscillator core and one to provide the bias current. Both the PQVCO and the DS-QVCO would only have three transistors between the supply rails since the switching and coupling transistors are connected in parallel in both topologies. However, the authors of [41] showed that the PQVCO is a more robust topology than the DS-QVCO since it is less sensitive to mismatch in the tank components which lead to amplitude and phase errors. Now that the QVCO topology has been selected, the implementation of each oscillator core must be determined. The complementary LC VCO can immediately be ruled out for the same reason as the SQVCO, leaving only three options:
 VCOs A and B are both NMOS or both PMOS (Fig. 3.3a).  VCO A is NMOS, VCO B is PMOS (Fig. 3.3b).  VCO A is PMOS, VCO B is NMOS (Fig. 3.3c).

VDD Ibias L I+ Cv Vctrl Cv Cf Q+ MCN MSN MSN MCN Q- Q+ MCN MSN I- I+ Cv

VDD Ibias L Vctrl Cv Cf MSN MCN Q- I- I+ Cv Q+

VDD Ibias MCP MSP Cf Vctrl L Cv MSP MCP Q-

I-

Cgnd L Q+ Cv Vctrl Cv Cf I- MCN MSN MSN MCN I+ Q- Q+ Cv I- MCP MSP

Cgnd MSP MCP Cf Vctrl L Cv I- MCN MSN I+ Q+ Q- Cv

Cgnd L Vctrl Cv Cf MSN MCN I+ Q-

(a) NMOS top and bottom.

(b) NMOS top, PMOS bottom.

(c) PMOS top, NMOS bottom.

Figure 3.3: Possible topologies for the proposed CR-QVCO. By examining the potential CR-QVCO topologies shown in Fig. 3.3, the implementation which best suits the design specifications can be determined. We can observe some design challenges which complicate the circuit design in Fig. 3.3a and Fig. 3.3b. Firstly, the oscillator nodes (I+, I-, Q+, Q-) are at different potentials, therefore the coupling transistors of one oscillator can not be directly connected to the oscillator nodes of the other oscillator since they are biased at different voltages. A circuit to provide the correct bias voltages for the coupling transistors for each oscillator core is needed. One possibility is using a source follower amplifier which provides a level shift but has a gain of less than unity. Another option is to use a bias network such as the one shown in Fig. 3.4, where the capacitor 40

CHAPTER 3. PROPOSED WORK

RB CB I-

Q+

Q-

RB CB I+

MCN MSN

MSN MCN

Figure 3.4: Modified oscillator core.

Cb blocks the DC of the signal applied to the coupling transistor, and the resistor Rb sets the DC bias of the coupling transistor to the same level as the oscillator node. Furthermore, one or both cores will experience body effect, which occurs when |VSB | = 0 and the threshold voltage of the transistor changed from its nominal value according to Vth = Vth0 +  VSB + 2F - 2F , (3.1)

where Vth0 is the nominal threshold voltage,  is the body effect parameter, and F is the Fermi potential. Again the biasing problem arises since the switching transistors will be on and off during different parts of the oscillation period. As mentioned above the oscillator nodes are at different potentials, therefore the control voltage can not be applied to the varactors directly. This is because the voltage across the varactor in each core will be different, and each core's tank will have a different resonant frequency. A "frequency tuning circuit" can be added to each tank to ensure the varactors have the same voltage across them. However the frequency tuning circuit also degrades the phase noise due to the thermal noise generated by biasing resistors.

VCONT1 RTUNE RTUNE CBLK I+ CV CV VCONT2
Figure 3.5: Varactor frequency tuning circuit. This leaves the circuit in Fig. 3.3c, with PMOS transistors in the top oscillator core and NMOS transistors in the bottom oscillator core. In this topology, the oscillator nodes for both cores are at the same DC level (ignoring the losses across the inductors), eliminating the need for DC level shifting of the coupling transistor inputs and the use of a frequency tuning circuit for the varactors. For these reasons, this topology will be used for implementing the proposed CR-QVCO. The capacitor, CGN D , at the intermediate node provides AC ground for both oscillators, and allows 41

CBLK I-

CHAPTER 3. PROPOSED WORK the cores to be decoupled for analytical purposes. The analysis is similar to the previously discussed PQVCO, however modifications must be made to the oscillation amplitude equation as it did not account for two important properties of the CR-QVCO. Firstly, the startup conditions for the CR-QVCO are not what was given in (2.11). In their analysis of the PQVCO, the authors of [38] noted that by adding the coupling transistors to the oscillator core, the loading effect decreases the input impedance of the cross-coupled transistors by a factor of 1 as well, decreases by a factor of  2
1  . 2

Thus for the same bias current, the oscillation amplitude

^0 = 2 (1 -  )Ibias Rp . V 2

(3.2)

In order to achieve the same oscillation amplitude as predicted by (2.33), the bias current must be  increased by a factor of 2. Furthermore, the equations describing oscillator amplitude all referred to oscillators using the topology of Fig. 2.3a, which uses two planar spiral inductors as shown in Fig. 2.5a. However, the design proposed uses a differential spiral inductor of Fig. 2.6a to improve symmetry in the 1 tank. Although the tank resonant frequency is defined as  , the bias current is injected through LC L the center tap and during each half-cycle flows through . As a result, the bias path for the transistor 2 includes only half the total inductance, and the equivalent parallel resistance that the bias current flows through becomes L Rp = 0 Q, 2 (3.3)

which is half of the expected tank parallel resistance, which further reduces the oscillation amplitude to ^0 = 2 (1 -  )Ibias Rp . V 2 2 (3.4)

Taking these two modifications into consideration, the oscillation amplitude of the CR-QVCO using a differential, center-tapped inductor is ^0 = 1 (1 -  )Ibias Rp . V 2 (3.5)

With respect to supply voltage scaling, if the CR-QVCO is to be designed for weak inversion (subthreshold) operation the supply voltage can be approximated as VDD = Vthn + |Vthp | + VDSAT , (3.6)

where Vthn and Vthp are the threshold voltages of the NMOS and PMOS transistors respectively, and VDSAT is the saturation voltage of the current source transistor. Since the transistors are biased in the subthreshold region, the supply voltage can be lower than this value because the DC bias points of the switching transistors will be less than Vthn,p . 42

CHAPTER 3. PROPOSED WORK

3.2.1

Proposed low power VCO design methodology

Now that we have developed equations describing various LC VCO topologies, we present a design methodology for sizing the switching transistors (and coupling transistors for QVCOs) based on the MOS EKV Model, a charge based model that accurately describes transistor behaviour in all three levels of inversion, and the gm /id design methodology, which has previously been used in the design of output transconductance amplifiers (OTAs). For this methodology, the gm /id design methodology is modified to consider the important criteria of LC VCOs rather than OTAs. The reader should first refer to Appendix A for an overview of the MOS EKV Model and gm /id design methodology if they are not already familiar with these concepts. First some information needs to be obtained about the devices used in the design which are used as inputs in the proposed methodology. It is assumed that the inductor has been selected to provide the maximum inductance and quality factor, and therefore maximum equivalent parallel resistance, at the frequency of interest. This data can be obtained from the documentation of the semiconductor foundry's process design kit, or by electromagnetic simulation using a tool such as ASITIC or Cadence Virtuoso Passive Component Designer. An example of the inductance and quality factor vs. frequency graph is shown in Fig. 3.6a. The graph of transconductance efficiency vs. inversion coefficient (gm /id vs. IC) can be obtained from measurement of a fabricated device or by simulation provided that the MOS model provides a continuous representation of the transistor current and small signal parameters in all regions of operation. The inversion coefficient is defined by parameters in the MOS EKV model, and is used to W obtain the required transistor aspect ratio ( ) to satisfy the oscillator design criteria. An example of L the transconductance efficiency vs. inversion coefficient graph extracted from 130 nm NMOS and PMOS transistors using the BSIM4 transistor model is shown in Fig. 3.6b.

(a) Inductance and quality factor vs. frequency.

(b) Transconductance efficiency vs. inversion coefficient.

Figure 3.6: Necessary graphs for proposed design methodology. The flow chart of the proposed design methodology is shown in Fig. 3.7. The methodology starts with the desired specifications of the VCO as inputs, namely the inductance (L) and quality factor (Q) ^0 ), the free running frequency (0 ), the tuning range (TR), of the inductor, oscillation amplitude (V 43

CHAPTER 3. PROPOSED WORK the startup factor ( ), and in the case of quadrature oscillators the coupling factor (). Using these parameters the intermediate parameters are calculated and from Fig. 3.6b the transistor aspect ratios can be obtained.

L, Q, V 0, w0, TR, b, a Calculate ibias Calculate gm Use gm/id to find IC Find W/L from IC=id/ispec Calculate capacitances No Cpar < 0.1C? Yes Done

^

Figure 3.7: Proposed VCO design methodology.

The first step is to calculate the total bias current for the VCO. The relationship between bias current for the VCO topologies discussed so far and the input parameters of the design methodology are summarized below:      
2  Ibias Rp 1  Ibias Rp

^0 = V

Fig. 2.3a, Fig. 2.9b Fig. 2.7
P

2    (1 -  )Ibias Rp    1 (1 -  )I R 2 bias

Fig. 2.17 Fig. 3.3c

(3.7)

To ensure oscillator startup, the transconductance can be calculated using (2.12) taking into account the startup factor  . With the transconductance and bias current at hand, the transconductance efficiency for the switching transistors (and coupling transistors for a QVCO) can be calculated. It is important to note that since the transconductance efficiency is a parameter for a single device, the drain current to be used is the amount of DC current flowing through each device. Looking back to (2.19), the 1 DC component of the drain current is equal to Ibias and therefore the transconductance efficiency for 2 1 each transistor is gm / 2 Ibias . For a PQVCO, the bias current has to be scaled further since each half of the current is shared by the switching and coupling transistors as per (2.31). Once the transconductance efficiency has been computed, the corresponding inversion coefficient can be obtained from Fig. 3.6b. Finally the definition of the inversion coefficient is rearranged to solve for the transistor aspect ratio, 44

CHAPTER 3. PROPOSED WORK

W L

=

id , ` U 2 IC 2nµ0 Cox t

(3.8)

where n is the subthreshold slope parameter of the device, µ0 is the carrier mobility, C` ox is the gate oxide capacitance density, Ut is the thermal voltage and IC is the inversion coefficient. These parameters are described in Appendix A. The device aspect ratio varies significantly depending on the region of inversion that the transistor operates in. As the device goes from strong inversion to weak inversion, the aspect ratio increases, which gives rise to increases in the gate capacitance of the device. This poses a problem since the gate capacitance is inversely proportional to the device unity gain frequency, T , which is defined by t = gm gm gm = = . CG CGi + CGo CGSi + CGDi + CGBi + 2W Lov Cox
CGi CGo

(3.9)

All of the device capacitances are summarized in Appendix A. In weak inversion the intrinsic gate capacitance is dominated by the gate-to-bulk capacitor, and the unity gain frequency can be approximated as t = gm = CGBi + 2W Lov Cox gm . n-1 + 2Lov n (3.10)

W Cox

In order to ensure the oscillator exhibits the desired behaviour the unity gain frequency must be greater than oscillation frequency, otherwise the circuit will not oscillate. The large capacitances also have another negative effect on the oscillator. The large, nonlinear capacitors of the device are added to the capacitance of the LC tank, which affects both the free-running frequency and the tuning range of the oscillator. The total tank capacitance is now comprised of the fixed capacitor, the varactor, and the device capacitances. In order to limit the effects of these unwanted capacitances, they must account for less than 10% of the total tank capacitance. If these criteria are satisfied, the design methodology is complete. As illustrated in Chapter 2, phase noise expressions are very complicated and depend on parameters which can only be obtained through measurement. Therefore it cannot be used as part of the handanalysis portion of the design methodology and must be obtained through simulation. If the simulated phase noise does not meet the desired specifications, the input parameters of the methodology must be adjusted accordingly.

3.3

A subthreshold source-coupled logic programmable divider

The pulse-swallow frequency division architecture described in Section 2.3.3 is used in the proposed design. The synthesizer must be able to operate on one of the 10 channels in the 402 MHz to 405 MHz spectrum, with each channel spaced 300 kHz apart. Intuitively one would design the divider so that the 45

CHAPTER 3. PROPOSED WORK output frequency of the ith channel is

fOU T = 402 MHz + (i-1)300 kHz,

(3.11)

but referring to Fig. 1.3 this would lead to the frequency synthesizer tuning to the channel edges rather than the center frequency of the channel (and there are 11 values of i which satisfy (3.11), not 10). The channel selection scheme must therefore be modified so that the center frequency of the channel is selected. If we continue to use 300 kHz as the reference frequency, we will have the division ratios in Table 3.1.

Channel # 1 2 3 4 5 6 7 8 9 10

fout 402.15 MHz 402.45 MHz 402.75 MHz 403.05 MHz 403.35 MHz 403.65 MHz 403.95 MHz 404.25 MHz 404.55 MHz 404.85 MHz

D 1340.5 1341.5 1342.5 1343.5 1344.5 1345.5 1346.5 1347.5 1348.5 1349.5

Table 3.1: Division ratios for integer-n frequency synthesizer with 300 kHz reference frequency.

However these values of D listed in Table 3.1 cannot be used because they are not integers. Reorganizing the relationship between the input and output frequencies of the frequency synthesizer, we have fOU T , fIN

D=

(3.12)

which means we can obtain an integer value of the division ratio by either doubling the output frequency, which means running the VCO at twice the desired output frequency, or using half the value of the reference frequency. In the former, a divide-by-two block would be added outside the frequency synthesizer loop to achieve the desired output frequency. In the latter, the reference frequency changes from 300 kHz to 150 kHz. In either case the same division ratios will apply, as shown in Table 3.2. Now that an integer value of D has been obtained, the dual-modulus divider, pulse counter and swallow counter values must be obtained to satisfy (2.51). By using a divide-by-32/33 dual-modulus divider (M =32), the values of the pulse (P ) and swallow (S ) counters can be obtained by assuming a value for P and solving for the range of values for S . For P =82, 46

CHAPTER 3. PROPOSED WORK Channel # 1 2 3 4 5 6 7 8 9 10 fOU T 804.3 MHz 804.9 MHz 805.5 MHz 806.1 MHz 806.7 MHz 807.3 MHz 807.9 MHz 808.5 MHz 809.1 MHz 809.7 MHz D 2681 2683 2685 2687 2689 2691 2693 2695 2697 2699 Channel # 1 2 3 4 5 6 7 8 9 10 fOU T 402.15 MHz 402.45 MHz 402.75 MHz 403.05 MHz 403.35 MHz 403.65 MHz 403.95 MHz 404.25 MHz 404.55 MHz 404.85 MHz D 2681 2683 2685 2687 2689 2691 2693 2695 2697 2699

(a) Doubling VCO frequency.

(b) Halving reference frequency.

Table 3.2: Division ratios for integer-n frequency synthesizer with new division ratios.

S = D - MP = 2681 - (32)(82) = 2681 - 2624 = 57,

(3.13) (3.14) (3.15) (3.16)

and so on for other values of D. Using these values, the range of S is [57, 59, ... 75], therefore both the P and S counters must be 7-bit down counters. If we assume P =83,

S = D - MP = 2699 - (32)(83) = 2699 - 2656 = 43,

(3.17) (3.18) (3.19) (3.20)

and so on for other values of D. Using these values, the range of S is [25, 27, ... 43], therefore only the P counter must be 7-bits and the S counter can be a 6-bit counter. As specified previously, the pulse counter has a fixed modulus and its control bits can be set on-chip, but the swallow counter must be programmable ­ either off-chip or by separate control logic. Consider the control word S [5 : 0] = S5 S4 S3 S2 S1 S0 , the control bits are assigned as shown in Table 3.3. If the swallow counter is programmed off-chip, six additional inputs would be required for the test fixture. By analysing the truth table of Fig. 3.3 we can observe that S5 = S4 and S0 = 1. The number of inputs can therefore be reduced to four by inverting S5 to obtain S4 and forcing the state of S0 to a logic 1. The gate-level diagrams of the 7-bit pulse counter, the 6-bit swallow counter and divide-by-32/33 DMP are shown below. The DMP divides by 32 when M C is logic 0 and by 33 when M C is logic 1. 47

CHAPTER 3. PROPOSED WORK Decimal 25 27 29 31 33 35 37 39 41 43 S5 0 0 0 0 1 1 1 1 1 1 S4 1 1 1 1 0 0 0 0 0 0 S3 1 1 1 1 0 0 0 0 1 1 S2 0 0 1 1 0 0 1 1 0 0 S1 0 1 0 1 0 1 0 1 0 1 S0 1 1 1 1 1 1 1 1 1 1 Division Ratio 2681 2683 2685 2687 2689 2691 2693 2695 2697 2699

Table 3.3: Control bits for the swallow counter.
RELOAD B0 B1 B2 B3 B4 B5 B6

Q2 D S Q CLKIN R Q D S Q R Q D S Q R Q

Q3 D S Q R Q

Q4 D S Q R Q

Q5 D S Q R Q

Q6 D S Q R Q Q7

Q1

B0

B1

B2

B3

B4

B5

B6

RELOAD Q1 Q2 Q3 Q4 Q5 Q6 Q7 CLKIN

D Q Q

CLKOUT

Figure 3.8: Block diagram of pulse counter.

Previously proposed low power programmable frequency dividers were implemented using true singlephase clocked (TSPC) logic [49], [50], [51]. Although TSPC logic occupies small silicon area, it suffers from drawbacks such as generation of switching noise, charge leakage at low frequencies, and requires rail-to-rail input signal swing [52]. These drawbacks can be avoided by using source-coupled logic (SCL) at the expense of increased silicon area. Additionally these implementations were designed for saturation region operation and therefore their power consumption is high relatively compared to ultra-low power requirements. The general circuit implementation of an SCL gate is shown in Fig. 3.11. SCL gates are implemented by properly stacking NMOS differential pairs to achieve a particular logic function. The bias current, Ibias , is steered to one of the two load resistors, RL , by the NMOS 48

CHAPTER 3. PROPOSED WORK
RELOAD B0 B1 B2 B3 B4 B5

Q2 D S Q CLKIN R Q D S Q R Q D S Q R Q

Q3 D S Q R Q

Q4 D S Q R Q

Q5 D S Q R Q Q6

Q1

B0

B1

B2

B3

B4

B5

RELOAD Q1 Q2 Q3 Q4 Q5 Q6 CLKIN

D Q Q

CLKOUT

Figure 3.9: Block diagram of swallow counter.

D CLKIN Q

D Q

D Q

MC

D Q Q

D Q Q

D Q Q

CLKOUT

Figure 3.10: Block diagram of dual modulus prescaler.

differential pair network according to its input signal values. SCL has several advantages when compared to static CMOS logic. Firstly, CMOS gates consume dynamic power but no static power, and SCL gates consume static power but no dynamic power. This feature means that SCL gates do not generate switching noise like static CMOS gates do. Static CMOS logic conventionally uses negative logic, but SCL gates have complementary outputs, eliminating the need for extra inverters to produce positive logic gates. Additionally, by virtue of De Morgan's Law, 2-input AND/NAND and OR/NOR functions can be implemented using a single gate simply by swapping the positive and negative inputs and outputs of the 2-input gate [53]. The "universal gate" which implements both the AND/NAND and OR/NOR 49

CHAPTER 3. PROPOSED WORK

VDD RL V Vi,1 Vi,2
+ + + o

RL Vo
-

Vi,1 Vi,2

-

Vi,n

+

NMOS Network Ibias

Vi,n

-

Figure 3.11: General topology of an SCL gate.

functions is shown in Fig. 3.14.

VDD
VDD

RL
NAND A+ A-

RL
AND

RL
OR B- B+

RL
NOR

B+ Ibias
(a) AND/NAND.

B-

A- Ibias
(b) OR/NOR.

A+

Figure 3.12: SCL 2-input universal gate.

As mentioned previously, the D-latch is an integral component in the programmable divider. The SCL D-latch shown in Fig. 2.25c replaces the load resistances with PMOS devices operating in the triode region. This implementation of the D-latch is not suitable for use in the programmable counter for two reasons. Referring to Fig. 3.8 and Fig. 3.9 the D-flip flop, which is implemented using the master-slave topology of Fig. 2.24, requires clear and preset capability in order to initialize the counter values when a reset occurs. As well, the PMOS load device cannot achieve a high resistance value, thus if the device is biased in the subthreshold region and consumes only a few microamps a load resistance on the order of tens to hundreds of kilo-ohms would be needed to generate a usable output voltage swing. In the following section, a novel D-latch which addresses both these design issues is proposed. 50

CHAPTER 3. PROPOSED WORK

3.3.1

Proposed D-latch with clear and preset functionality

Previously proposed latches presented in literature are not suitable for low power, low voltage applications such as implantable medical devices because they required too many stacked transistors [54], [55] or do not perform both clear and preset functions [56], [57]. In order to correctly implement the programmable counters, the clear and preset functions are required for the D-latches to build master/slave D-flip flops with clear and preset functions. To this end, a novel D-latch with clear and preset is proposed. The power consumption of the proposed design is reduced by using the load device presented in [58]. The authors demonstrated that a high resistance load device can be obtained by shorting the bulk of a minimum sized PMOS transistor to its drain (rather than its source), reducing the amount of bias current required to achieve an output voltage sufficient to drive subsequent gates. The proposed design is shown in Fig. 3.13.
VDD

PMOS load device
X X Q

VDD

Q M6 MEN Ibias M7 MEN M8

D CLK

M1

M2 MCLK

D

M3 MCLK Ibias

M4 CLK EN

M5

CLR

PRE EN

Conventional SCL D-Latch with high resistance PMOS load devices

Proposed circuit for clear and preset functionality

Figure 3.13: Proposed D-latch with clear and preset.

D X Q X Q Clk

X Q X Q PRE CLR

PRE Q D Q D Clk Clk EN EN CLR
(b) Symbol of proposed D-latch.

(a) Proposed D-latch (conceptual).

Figure 3.14: Representations of proposed D-latch. 51

CHAPTER 3. PROPOSED WORK The proposed D-latch consists of two stages and requires an additional input to enable the clear and preset circuit. The first stage is a D-latch where the sensing pair (M 1, M 2) is active while CLK is high and the latching pair (M 3, M 4) is active while CLK is low. Instead of cross coupling the outputs of the sensing pair via the latching pair as in a conventional SCL D-latch, the intermediate outputs (X, X ) are routed to the second stage. Devices M 5, M 6 act as a buffer when EN is low, and the outputs are fed back to the latching pair. When EN is high, the Set/Reset latch (M 7, M 8) is active and the latch is initialized according to the state of CLR and P RE . The complementary enable signals can be generated by EN = CLRP RE, EN = CLRP RE. (3.21a) (3.21b)

This comes at the cost of an additional XOR/XNOR gate, since SCL gates produce complementary outputs. However in this application EN can be obtained from the RELOAD signal generated by the pulse counter, eliminating the need for the additional logic gate.

3.4

A subthreshold source-coupled logic phase/frequency detector, modified current-steering charge pump and loop filter

The phase/frequency detector (PFD) uses the architecture of Fig. 2.19c. The proposed D-latch with clear preset are is to implement the master-slave D-flip flops in the PFD. The outputs of the 2-input SCL AND/NAND gate drives the EN and EN signals in the proposed D-latch. In order to perform the required function, the CLR signal is tied to the positive supply and the P RE signal is tied to the negative supply. The block diagram of the PDF is shown in Fig. 3.15
VDD PRE Q D Q D CLK CLK EN EN CLR
A A B B UP UP

REF REF

AND NAND VDD
CLR EN EN CLK CLK Q D Q D PRE

FB FB

DN DN

VDD

Figure 3.15: Phase/frequency detector using proposed clear/preset D flip-flop. 52

CHAPTER 3. PROPOSED WORK The charge-pump used in this work is a modification of the low voltage charge pump circuit proposed in [59]. The circuit consists of a wide-swing current mirror and symmetric charge pumps to provide IU P and IDN . Each charge pump is controlled by a differential input pair biased with a tail current source, a current mirror load and a diode connected load. In the "pump up" circuit, when U P is high the bias current flows through M1 and is mirrored to the output through the current mirror M5,16 . A pull-up transistor M9 is added to immediately bring the gate of the current mirror transistors to VDD when U P is low in order to shut off the current mirror and prevent any current from leaking into the output. The "pump down" circuit can be analysed in the same fashion. The wide-swing current mirror M11-14 mirrors the pump down current to the output of the charge pump. The loop filter is a 3rd order passive filter as shown in Table 2.1c.

VDD

DN M7 M8

M10 M16 M15
ICP

M9

UP M5 M6

M14 M13 VB2 DN
VB

M3

M4 MB

DN

M12 M11

UP

M1 MB

M2
VB

UP

Figure 3.16: Current-steering charge pump.

3.5

Summary

In this chapter, we proposed a current reuse QVCO, a design methodology for low-power VCOs, a subthreshold source-coupled logic pulse/swallow counter using a novel D-latch with clear and preset functionality, and a modified current-steering charge pump. Current reuse, supply voltage scaling and subthreshold operation were introduced as means to reduce the power consumption of the QVCO. The clear/preset D-latch was designed to be conducive to low voltage operation, which was not possible with previously published designs. The proposed circuit designs will be used to implement an integer-n frequency synthesizer that operates in the 402 MHz to 405 MHz Medical Implant Communication Service frequency spectrum. The block diagram of the proposed frequency synthesizer is shown in Fig. ??. In the following chapter, the simulation and measurement results of the proposed designs are presented, 53

CHAPTER 3. PROPOSED WORK along with comparisons to existing designs.

54

Chapter 4

Results
4.1 IBM CMRF8SF 130 nm CMOS Technology

The proposed designs are implemented using the IBM CMRF8SF 130 nm CMOS process design kit (PDK). This PDK is provided through MOSIS Integrated Circuit Fabrication Service and access to fabrication is provided through Canadian Microelectronics Corporation (CMC). Although this technology offers several metallization options, the option which is available for integrated circuit fabrication through MOSIS/CMC is: DM-topmetal: M1/V1/M2/V2/M3/VL/MQ/VQ/MG/FY/LY/FT/E1/F1/MA/DV This is the so-called "3-thin, 2-thick, 3-RF" wirebond variant. The kit includes thin and thick oxide NMOS and PMOS transistors with nominal, high and low threshold voltages, and several inductor, resistor and capacitor topologies. Schematic entry, simulation, analysis, layout and verification are performed using the Custom Integrated Circuit Design suite of tools from Cadence Design Systems.

4.2

Current reuse quadrature VCO

The CR-QVCO was designed according to the methodology proposed in Section 3.2.1. To reduce the current drawn by the CR-QVCO, an inductor with high inductance and quality factor should be used. The inductors provided with the PDK did not provide high quality factors at low frequencies (> 1 GHz), which required the use of a custom spiral inductor. Cadence Virtuoso Passive Component Designer was used to synthesize a symmetrical octagonal inductor with high inductance and quality factor at the center frequency of the MICS band. The inductor was formed over an M1 groundplane to decrease substrate coupling and raise the quality factor [60]. The layout of the synthesized inductor and its simulated inductance and quality factor are shown in Fig. 4.1. The inputs for the proposed low power VCO design methodology are summarized in Table 4.1. 55

CHAPTER 4. RESULTS

(a) Three dimensional view.

(b) Simulated inductance and quality factor

Figure 4.1: Synthesized spiral inductor for current-reuse quadrature VCO. Parameter Inductance Quality Factor Oscillation Amplitude Resonant Frequency Tuning Range Oscillator Startup Factor Quadrature Coupling Factor Symbol L Q ^0 V 0 TR   Value 24.61 nH 10.23 100 mV 403.5 MHz 398 MHz to 410 MHz 3 0.5

Table 4.1: Low power VCO design methodology input parameters.

As mentioned in Section 3.2, the CR-QVCO in Fig. 3.3c does not suffer from body effect. This is because the NMOS transistors can have their bulk and source terminals at the same potential, and all the PMOS transistors exist in their own n-wells which can be connected to the same potential as their respective sources. For both oscillator cores, the source terminals are not oscillator nodes so the threshold voltage stays constant during oscillation. The bias current was provided using the PMOS transistor. The upconversion of flicker noise generated by the current source transistor is a known contributor to the phase noise of the oscillator. To combat this effect, the bias transistor was sized to have long channel length and width as flicker noise is inversely proportional to the area of the active device. NMOS varactors were used as the frequency tuning element in the tank, and a fixed metal-insulator-metal (MIM) capacitor was used to set the tuning range around the frequency band of interest. Existing CR-QVCOs require the use of a frequency tuning circuit that accounted for the different DC voltages between the differential output nodes, which resulted in different voltage drops across the varactors in each tank. By designing the CR-QVCO such that the top tank is PMOS only and the bottom tank is NMOS only, a frequency tuning circuit was not necessary as the DC voltage of the quadrature outputs was almost the same (within a few mV). The small DC offset can be attributed to series resistance of the inductors. Omitting the frequency tuning circuit also improves the phase noise as the thermal noise generated by biasing resistors is not present. 56

CHAPTER 4. RESULTS

4.2.1

Simulation

As mentioned in Section 2.3, VCOs are subjected to variations due to process, supply voltage and temperature which cause the oscillation frequency to drift from the nominal value. In order to ensure the CR-QVCO can operate on across the MICS frequency band, simulations were performed to predict its oscillation frequency. The results of corner analysis and supply voltage sensitivity are shown in Fig. 4.2 and Fig. 4.3 respectively (biasing adjusted for each simulation to achieve same oscillation amplitude).

(a) Tuning range.

(b) Phase noise.

Figure 4.2: CR-QVCO simulated over process variations.

(a) Free-running frequency.

(b) Phase noise.

Figure 4.3: CR-QVCO simulated over ± 10% supply voltage variations. As per the requirements of the MICS frequency band, the IMD must be tested over temperature variations from 0 C to 55 C. Although the proposed work is not a complete IMD, the CR-QVCO performance at different temperatures in the required range was simulated to predict that the operating frequency and phase noise do not degrade significantly. The graphs in Fig. 4.4 show the tuning curves and phase noise plots for simulations at 0 C, 10 C, 20 C, 37 C, 45 C and 55 C. The simulated CR-QVCO consumed 600 µW from a 0.7 V supply, and the phase noise was -127.2 dBc/Hz. The simulation results of the proposed CR-QVCO were compared with the existing designs 57

CHAPTER 4. RESULTS

(a) Tuning range.

(b) Phase noise.

Figure 4.4: CR-QVCO simulated over temperature variations.

discussed in Section 1.2.3, and are summarized in Table 4.2. Reference (Technology) This work (0.13 µm) [20] (0.13 µm) [26] (TSMC 0.18 µm) [23] (TSMC 0.18 µm) [25] (0.18 µm) [24] (0.09 µm) [61] (TSMC 0.18 µm) [21] (TSMC 0.18 µm) [28] (0.13 µm) [27] (0.18 µm) Tuning Range [MHz] 398 to 410 401 to 406 ---- 402 398 to 408 391 to 415 ---- ---- 380 to 440 440 VDD [V] 0.7 1.2 1.5 1.3 0.7 0.7 1.5 1.5 1.2 1.5 Power [mW] 0.42 0.72 1.11 0.78 0.21 0.46 ---- 1.2 1.2 0.231 Phase Noise [dBc/Hz] -127.2 @ 1 MHz -96 @ 1 MHz ---- ---- -118 @ 1 MHz -108 @ 100 kHz ---- -98 @ 160 kHz -107 @ 100 kHz -103 @ 100 kHz Topology Current-reuse quadrature oscillator LC tank VCO Differential ring VCO 6-bit digitally controlled oscillator 7-bit digitally controlled oscillator Digitally controlled oscillator Dual band LC tank VCO LC tank VCO Injection-locked oscillator Single-ended crosscoupled oscillator

Table 4.2: Comparision of existing MICS VCOs As shown in the comparison results, the simulated CR-QVCO predicts improved power consumption and phase noise performance. Although both [25] and [27] have lower power consumption, it is important to note that these designs do not produce quadrature signals. If the VCOs in these works were used to implement a PQVCO to produce quadrature signals, the power consumption would at least double. 58

CHAPTER 4. RESULTS Furthermore the VCOs use off-chip inductors with high Q values. Although off-chip inductors are a valid method of reducing power consumption, their use violates one of the objectives of this work in this thesis which is to eliminate the need for off-chip components to lower the size and cost of the frequency synthesizer.

4.2.2

Measurement

The proposed CR-QVCO was fabricated using a 130 nm CMOS process from IBM through MOSIS Integrated Fabrication Service to provide validation of the design's simulation results. Testing of the integrated circuit was performed in the Ryerson Integrated Circuits and Systems laboratory using wafer probing on a Cascade Microtech IC probe station. Each of the four positioners on the probe station is capable of holding a different set of probes for applying and measuring signals to and from the device under test. The available probe configurations were
 3 × Ground-Signal-Ground (GSG) operating at up to 40 GHz,  2 × Signal-Ground-Signal-Signal-Ground-Signal (SGSSGS) "wedge" operating up to 100 MHz,  2 × DC needle.

The wafer probe station and probe pad configuration diagrams are shown in Fig. 4.5 and Fig. 4.6 respectively. The square probe pads have side lengths of 100 µm and a pitch of 150 µm.

150 µm

100 µm

S G S
100 µm

S G S

(a) SGSSGS.
150 µm

100 µm

100 µm

DC
100 µm

G S G
100 µm

(b) DC needle.

(c) GSG.

Figure 4.5: Wafer probe station

Figure 4.6: Probe configurations

The CR-QVCO had four RF outputs (I +, I -, Q+, Q-) and four DC bias voltages (core VDD , Vcont , Vbias , and buffer VDD ). To implement the required input and output configuration four sets of probe pads for the GSG probes were used (only two could be probed at a time), a DC needle was used for the output buffer supply voltage and the SGSSGS wedge was used for the remaining DC signals. The layout and die photo of the CR-QVCO are shown in Fig. 4.7. The total silicon area occupied by the CR-QVCO including bond pads was 2 mm × 1 mm. 59

CHAPTER 4. RESULTS

(a) CR-QVCO layout.

(b) CR-QVCO die photo.

Figure 4.7: Physical implementation of current-reuse quadrature VCO.

Measurement results for the CR-QVCO output spectrum and tuning range were obtained using an Agilent 4407B spectrum analyser, and power and bias voltages were provided using two high precision DC sources. The measured output spectrum and control voltage are shown in Fig. 4.8. The tuning curve was obtained by adjusting the control voltage across the desired range and observing the change in the output spectrum. Although the frequency range of the MICS is covered, the total tuning range is narrower than the desired range and is likely due to parasitics and other variations in the fabrication process such as increased capacitance density of the MIM capacitors or reduced tuning range of the varactors.

4.2.3

Fabrication challenges

Several challenges arose during the layout and fabrication process. Firstly, this was the first fabrication using the IBM 130 nm CMOS design kit since it became available to the Ryerson Electrical & Computer Engineering department. The support engineers from MOSIS were instrumental in overcoming many of the software-related issues to ensure the submitted designs satisfied all manufacturability checks. Additionally the spectrum analyser provided by Canadian Microelectronics Corporation was not capable of measuring phase noise it did not contain the additional firmware needed to perform these measure60

CHAPTER 4. RESULTS

(a) Output spectrum.

(b) Tuning range.

Figure 4.8: Measurement results of CR-QVCO.

ments. At the time measurements were performed, transient waveforms could not be obtained as an oscilloscope which operated in the UHF frequency range was not available. However the results serve as proof-of-concept for both the functionality of the proposed CR-QVCO and the proposed low-power VCO design methodology.

4.3
4.3.1

Subthreshold source-coupled logic programmable divider
Clear/preset D-latch simulation

The proposed D-latch was simulated along with an ideal D-latch written in Verilog-A to predict that the proposed design produces the correct output. The latch was simulated for two cases to predict that it can operate over the required frequency range. In Fig. 4.9a, the frequency of the data and clock inputs are 250 kHz and 120 kHz respectively, and in Fig. 4.9b they are 20 MHz and 15 MHz respectively.

(a) D=250 kHz, CLK=120 kHz.

(b) D=20 MHz, CLK=15 MHz.

Figure 4.9: Transient simulation of proposed D-latch and ideal D-latch. 61

CHAPTER 4. RESULTS To demonstrate the clear and preset functionality, the proposed D-latch was connected in a masterslave D-flip flop divide-by-two configuration and alternating P RE and CLR signals were applied every 20 ns. As shown in Fig. 4.10 the output signal (VCLKOU T ) is pulled high when VP RE is applied, and pulled low when VCLR is applied.

Figure 4.10: Simulation of D-flip flop with clear and preset.

4.3.2

Dual-modulus prescaler simulation

The divide-by-32/33 dual modulus prescaler in Fig. 3.10 was implemented using subthreshold sourcecoupled logic gates. The resistors in the SCL universal 2-input gate in Fig. 3.14 were replaced with the PMOS load device proposed in [58]. Since clear and preset functionality were not needed for the DMP the D-latch in Fig. 2.25c was used, and the load resistors were replaced with the PMOS load device. The divide-by-32 and divide-by-33 operations were simulated using a 990 MHz input signal, and the results are shown in Fig. 4.11. As shown in the figure the divider output frequency is 30.9375 MHz when dividing by 32, and 30 MHz when dividing by 33.

4.3.3

Programmable down counter simulation

Transient simulations of the 6-bit and 7-bit programmable counters were performed to verify the desired behaviour of the down counters. The control word for the 6-bit counter was set to S [5 : 0] = S5 S4 S3 S2 S1 S0 = 011001 and for the 7-bit counter it was P [6 : 0] = P6 P5 P4 P3 P2 P1 P0 = 1010011. The simulation results in Fig. 4.12 show that the 6-bit down counter starts from 25 and counts down as expected. Likewise for the 7-bit counter, the results in Fig. 4.13 show that the count down starts from 83, as expected. 62

CHAPTER 4. RESULTS

(a) Divide by 32.

(b) Divide by 33.

Figure 4.11: Transient simulation of dual-modulus prescaler.

(a) Input and output waveforms.

(a) Input and output waveforms.

(b) Programmable counter outputs.

(b) Programmable counter outputs.

Figure 4.12: Transient simulation of 6-bit down counter.

Figure 4.13: Transient simulation of 7-bit down counter.

4.3.4

Programmable divider simulation

Once the major blocks of the proposed programmable divider were analysed in simulation, the divider itself was implemented and simulated to predict it could produce the correct output frequency which would server as the FB input for the phase/frequency detector. The frequency for each MICS channel was used as the input for the divider, and the control word of the Swallow Counter was adjusted so that the corresponding division ratio was used. Simulation results showed that for each channel, the corresponding division ratio produced an output frequency of 150 kHz. The simulation waveforms in Fig. 63

CHAPTER 4. RESULTS 4.14 and Fig. 4.15 show the input waveform, output waveform and output frequency of the programmable divider when the input frequency is 402.15 MHz (channel 1) and 404.85 MHz (channel 10) respectively.

(a) Input voltage waveform

(a) Input voltage waveform

(b) Output voltage waveform

(b) Output voltage waveform

(c) Output frequency

(c) Output frequency

Figure 4.14: Programmable divider output when fin = 402.15 MHz

Figure 4.15: Programmable divider output when fin = 404.85 MHz

A comparison between the proposed subthreshold programmable divider and recently published programmable dividers is given in Table 4.3. The figure of merit used to compare the results is the power consumption at the operating frequency, given in µW/MHz. The programmable divider was submitted for fabrication as part of an MICS band frequency synthesizer. The layout of the programmable divider is shown in Fig. 4.16. Measurement results were not available at the time of writing as the design was still being fabricated. The total simulated power consumption of the proposed programmable divider was 200 µW. A summary of the simulated power consumption for each of the major blocks is given in Table 4.4. 64

CHAPTER 4. RESULTS Reference (Technology) This Work (0.13µm) [49] (0.18µm) [50] (0.18µm) [51] (0.18µm) [62] (0.18µm) [63] (0.18µm) [64] (0.18µm) [65] (0.18µm) Frequency [MHz] 200 to 1000 2400 and 5000 5141 to 5860 500 to 3500 1600 3000 1700 440 VDD [V] 0.7 1.8 1.5 1.8 1.2 1.5 1.5 1.8 Power [mW] 0.21 2.6 4.8 3.01 0.475 3.58 3.2 0.54 FOM [µW/MHz] 0.247 1.08 0.934 0.86 0.296 1.19 1.88 1.23

Table 4.3: Comparison of low power programmable dividers

Figure 4.16: Programmable frequency divider layout. Block Dual modulus prescaler 6-bit programmable counter 7-bit programmable counter Pulse-swallow programmable divider Power consumption [µW] 30 76 89 200

Table 4.4: Power consumption of programmable divider components.

4.4

Phase/frequency detector, charge pump and loop filter

The simulation results of the proposed subthreshold source-coupled logic phase/frequency detector, current-steering charge pump and loop filter are presented in Fig. 4.17. In Fig. 4.17a, the reference signal phase leads the feedback signal phase and the control voltage increases as expected. Similarly in 65

CHAPTER 4. RESULTS Fig. 4.17b, the reference signal phase lags the feedback signal phase and the control voltage decreases. It should be noted that an initial voltage was placed on the loop filter capacitor for the simulation in Fig. 4.17b because when the simulator starts the initial control voltage would be zero and the charge pump cannot remove any more charge from the capacitor.

(a) Reference leads feedback.

(b) Reference lags feedback.

Figure 4.17: Transient simulation of PFD/CP/LF.

The PFD/CP/LF was submitted for fabrication as part of the previously mentioned MICS band frequency synthesizer, and measurement results are not currently available. The layout of the PFD/CP/LF is shown in Fig. 4.18. The CP was designed to have IU P =IDN =1 µA. The entire PFD/CP/LF consumes under 20 µW of power, most of which is consumed by the PFD.

(a) Phase/frequency charge pump.

detector

and

(b) Loop filter.

Figure 4.18: Phase/frequency detector, charge pump and loop filter layouts.

66

CHAPTER 4. RESULTS

4.5
4.5.1

402 MHz to 405 MHz integer-n frequency synthesizer
Simulation

The frequency synthesizer in Fig. ?? was simulated to verify the locking behaviour. Simulation results predict that the synthesizer reaches the lock stated in 250 µs, and the total power consumption is 700 µW. The chip layout of the entire subthreshold integer-n frequency divider is shown in Fig. 4.20.

Figure 4.19: Frequency synthesizer control voltage.

Figure 4.20: Frequency synthesizer layout.

4.5.2

Fabrication challenges

Many of the challenges faced in this fabrication were previously resolved during the first fabrication, but new issues came up at both the simulation and physical implementation levels. Phase-locked loop frequency synthesizers require a significant amount of time and computing power to simulate, with each simulation lasting anywhere from one to three days. It may take hours before it is apparent that the 67

CHAPTER 4. RESULTS frequency synthesizer will not reach the locked state, at which point modifications must be made to different parts of the circuit to resolve the locking issue. With regards to the physical implementation, the amount of silicon area was not sufficient to implement the proposed frequency synthesizer. With only 2 mm × 1.5 mm available for the entire synthesizer including bondpads, changes needed to be made to accommodate the entire design. It was mentioned in Section 3.3 that in order to tune to the correct channel, the VCO frequency could be doubled while using a 300 kHz reference frequency and adding a divide-by-2 circuit outside the loop. By adopting this approach, a higher resonant frequency was achieved by using smaller inductance and capacitance values, and consequently smaller inductors and capacitors, which occupy less silicon area. Compromises had to be made for the inputs and outputs due to the available probe configurations. The frequency synthesizer required four inputs for the control word of the programmable divider, which uses up an entire SGSSGS wedge. The remaining DC wedge was used for DC biasing, however there were more bias voltages than there were signal pads available. The CR-QVCO, output buffer, charge pump, and all of the logic circuits that make up the phase/frequency detector and programmable divider needed bias voltages. This required designing all of the logic circuits to be biased by the same voltage. In practice bias voltages may be generated on chip using bandgap voltage references, but the design of such circuits was beyond the scope of this research and biasing voltages had to be applied off chip. Another way to allow for more inputs and outputs was to use ceramic flat packaging (CFP), however the cost for packaging makes prototyping prohibitively expensive.

4.6

Summary

In this chapter, the CR-QVCO, ST-SCL programmable divider and phase detector which were proposed in Chapter 3, and a modified current-steering charge pump were implemented using the IBM CMRF8SF 130 nm CMOS process. Simulation were performed using Cadence Spectre circuit simulator, which showed that both the CR-QVCO and ST-SCL programmable divider demonstrate improved performance compared to existing designs. Measurement results from a fabricated CR-QVCO designed according to the proposed low power VCO design methodology were in agreement with simulation results, however the tuning range was slightly narrower. A second fabrication for the subthreshold integer-n frequency synthesizer operating in the MICS frequency band has been submitted, pending measurement results. Simulations show that the frequency synthesizer reaches the locked state after 250 µs.

68

Chapter 5

Conclusion and future work
5.1 Thesis summary

In this research, novel circuits and design methodologies were presented for the design and implementation of an ultra-low power integer-n frequency synthesizer operating in the 402 MHz to 405 MHz Medical Implant Communication Service band of frequencies. Prior to introducing the proposed circuit designs, an overview of the theory and design metrics of oscillators and frequency synthesizers was given to provide readers with a sufficient understanding of these topics. The regulatory and design aspects of the Medical Implant Communication Service were discussed as well as a survey of previously published work in this field. The principal design concepts to achieve ultra-low power operation were introduced, namely current reuse, supply voltage scaling and subthreshold operation. Using these techniques, several novel circuits for use in the ultra-low power integer-n frequency synthesizer were proposed, namely:
 A current reuse quadrature voltage-controlled oscillator.  A design methodology for the design of low power CMOS VCOs using the MOS EKV model and gm /id methodology.  A novel clear/preset SCL D-latch.  A subthreshold SCL programmable divider and phase/frequency detector based on the proposed clear/preset SCL D-latch.

Using IBM CMRF8SF 130 nm CMOS technology, the proposed circuits were used to implement an integer-n frequency synthesizer. Simulations predict that the proposed CR-QVCO, ST-SCL programmable divider and ultra-low power frequency synthesizer achieve better performance than existing designs. The CR-QVCO was submitted for fabrication and measurement results of the fabricated prototype verified proposed design as well as the proposed low-power VCO design methodology. 69

CHAPTER 5. CONCLUSION AND FUTURE WORK

5.2

Future work

As mentioned Chapter 4, the ultra-low power interger-n frequency synthesizer was being fabricated at the time of writing and measurement results were not available. Once the fabricated chip is returned, testing will be performed to verify the design. By continuing research in wireless IMDs, the work proposed in this thesis could be implemented in a complete implantable medical device operating in the Medical Implant Communication Service. As shown in Fig. 1.2, the wireless IMD consists of the power supply, processor, interface and transceiver. The work proposed in this thesis is only one block of the transceiver shown in Fig. 2.10. Each of the wireless IMDs shown in Fig. 1.1 have a unique set of requirements, particularly for the processor and interface blocks. Possible applications of such a device include passive devices for measuring physiologic signals such as ECG or EKV, or active devices insulin pumps for people with diabetes. Ideally the wireless IMD would receive power through RF wireless power harvesting rather than an implantable battery to eliminate the need for medical procedures to extend the lifetime of the IMD. Design of wireless IMDs requires specialized knowledge of many disciplines including, but not limited to, radio wave propagation, signal processing, circuit design, and biology. With a growing amount of research into the design and development of wireless IMDs, and designers continuously pushing the boundaries of existing technology, both patients and medical professionals will continue to benefit from wireless IMDs.

70

Appendix A

A brief introduction to the MOS EKV model and the gm/id design methodology
A.1 MOS EKV model

The traditional square law MOS transistor model, which is a threshold based, source referenced model, is not suitable for hand analysis as it fails to caputure the short channel effects in modern deep submicron CMOS processes. The EKV MOS model is a bulk referenced, charge based transistor model suitable for the design and simulation of low voltage, low current, analog, digital and mixed-signal circuits in deep submicron CMOS technologies. The model describes MOSFET behaviour using a single continuous equation valid in all levels of inversion. The model develops continuous equations using nine physical parameters and the charge-sheet approximation, and allows for symmetrical analysis by referring all voltages to the bulk terminal. In this section, the important parameters and equations of the EKV model that are used in the design methodology proposed in Section 3.2.1 are presented. A full derivation of the model can be found in [66], [67]. The cross section of a MOS transistor is shown in Fig. A.1. All potentials are referenced to the bulk of the transistor. The basic assumption of the EKV model is that the entire mobile inversion charge, Qi , is at the surface potential s . This is known as the charge sheet aprroximation, and is assumed to be valid since 95% of the inversion charge is at a potential within 3 to 6 times the thermal voltage, UT below the surface potential. Electron flow occurs when the source and drain voltages are different, and is composed of both drift and diffusion components. 71

APPENDIX A. A BRIEF INTRODUCTION TO THE MOS EKV MODEL AND THE GM /ID DESIGN METHODOLOGY
B VG VS S VD G L D

p+

n+

Leff

n+
p-sub

Figure A.1: Cross-section of MOS transistor.



 (A.1)

 ds dQi   ID = µW  -Qi dx + UT dx  . drift diffusion

Integrating the current along the channel and making substitutions for some parameters yields
VD

ID = 
VS

-Qi dV, Cox

(A.2)

where  is the transfer parameter of the transistor depending on the transistor aspect ratio,  µCox W . L (A.3)

The drain current equation can be rewritten by normalizing the currents and voltages,
vd

ID = Ispec
vs

qi dv,

(A.4)

where Ispec is the specific current of the transistor defined by
2 Ispec = 2nUT .

(A.5)

where n is the subthreshold slope parameter and UT is the thermal voltage. Solving this equation provides an expression relating the drain current components with the bias voltages, vp - vs,d = 1 + 4if,r + ln( 1 + 4if,r - 1) - (1 + ln 2), (A.6)

where if and ir are the forward and reverse components of the drain current respectively, 72

APPENDIX A. A BRIEF INTRODUCTION TO THE MOS EKV MODEL AND THE GM /ID DESIGN METHODOLOGY



if =
vs 

qi dv. qi dv.
vd

(A.7) (A.8) (A.9)

ir =

id = if - ir .

An alternate continuous expression relating the drain current components to the bias voltages is vp - vs,d . 2  = 2 ln exp if,r -1 .

if,r = ln2 1 + exp vp - vs,d

(A.10) (A.11)

The drain current can be simplified when the device operates in strong and weak inversion,  n  linear    (VD - VS )[VG - VT 0 - 2 (VD + VS )],  2 forward saturation = 2n (VG - V T 0 - nVS ) ,   Ispec exp VG -VT 0 exp -VS - exp -VD , weak inversion. nUT UT UT

ID

(A.12)

The level of inversion of the device is characterized by the Inversion Coefficient (IC ), which is a ratio of the device's drain current to its specific current, IC = ID . Ispec (A.13)

The values of IC corresponding to the levels of inversion are summarized below. It should be noted that moderate inversion is not a precisely defined region. This region exists when the approximations for strong or weak inversion are not sufficient to describe the drain current behaviour. IC 1 weak inversion.  IC = 1 moderate inversion. IC 1 strong inversion. Changes in the drain current occur in response to changes in the gate voltage. The parameter relating these changes is called the transconductance, Gm , which is defined in each region of operation as follows,   linear.   ( VD - VS ) =  (VP - VS ) forward saturation.   ID weak inversion. nUT

Gm

(A.14)

An important figure of merit for a transistor is its transconductance to current ratio, also knows as the transconductance efficiency. This parameter is independent of any process parameters, and is a measure of how much transconductance can be obtained for a given current. A continuous expression 73

APPENDIX A. A BRIEF INTRODUCTION TO THE MOS EKV MODEL AND THE GM /ID DESIGN METHODOLOGY over all inversion regions is given by  Gm 1 - exp(- IC )  = . ID nUT IC (A.15)

The transconductance efficiency varies over the levels of inversion, and tends to the following asymptotes in strong and weak inversion,  Gm = nUT ( 4if +1+1) 1  ID
2 nUT

 

strong inversion. (A.16) weak inversion.

Approximate equations for the intrinsic device capacitances are summarized in Table A.1, and are normalized according to Table A.6. Capacitor cGSi cGDi cGBi cBSi cBDi Strong inversion
2 3 n-1 3n

0

Weak inversion qs qd
n-1 n

2 3 (n-1)

0

(n-1)qs (n-1)qd

Table A.1: Approximation of normalized intrinsic capacitances in strong and weak inversion. Together with the transconductance, the device capacitances determine the unity gain frequency of the device. This frequency, denoted fT , is the point where the device current gain falls to unity, and is defined by the ratio of the transconductance to the gate capacitance. The transit frequency is given by t = where Gm Gm = , CG CGi + CGo (A.17)

CGi

COX (cGSi + cGDi + cGBi )  = CGo

Cox (n - 1 + cGSi + cGDi ). n COX (cGSo + cGDo + cGBo )  = 2W Lov Cox .

(A.18) (A.19)

Parameter W L Lef f tox

Description Channel width Channel length Effective channel length Oxide thickness

Table A.2: Parameters describing MOSFET transistor geometry.

74

APPENDIX A. A BRIEF INTRODUCTION TO THE MOS EKV MODEL AND THE GM /ID DESIGN METHODOLOGY Parameter UT VT 0 VG VD VS VP Description Thermodynamic voltage Threshold voltage DC gate-to-bulk voltage DC gate-to-drain voltage DC gate-to-source voltage Pinch-off voltage

Table A.3: Voltages. Parameter ID IS Ispec Description Drain current Source current Specific current

Table A.4: Currents. Parameter Gm Gspec Description Gate transconductance Specific conductance

Table A.5: Conductances. Parameter Cox COX CGSi CGDi CGBi CGGi CGSo CGDo CGBo CGGi CG Description Oxide capacitance per unit area Total oxide capacitance Intrinsic gate-to-source capacitance Intrinsic gate-to-drain capacitance Intrinsic gate-to-bulk capacitance Total gate intrinsic capacitance Gate-to-source overlap capacitance Gate-to-drain overlap capacitance Gate-to-bulk overlap capacitance Total gate overlap capacitance Total gate capacitance Table A.6: Capacitances.

A.2

gm /id design methodology

In modern deep submicron processes, the validity and predictive power of the square law, threshold based transistor model has diminished. A typical design process may include arbitrary selection of transistor bias currents and obtaining the transistor aspect ratio based on the square law model, the evaluating the remaining parameters such as transconductance, bandwdith, etc. An iterative process may take 75

APPENDIX A. A BRIEF INTRODUCTION TO THE MOS EKV MODEL AND THE GM /ID DESIGN METHODOLOGY Parameter t n  Description Unity gain frequency Slope factor Transconductance factor

Table A.7: Other parameters. Parameter UT Ispec Qspec COX Gspec Description Thermodynamic voltage for normalizing voltages Specific current for normalizing currents Specific charge density for normalizing charges Total oxide capacitance for normalizing capacitances Specific conductance for normalizing conductances Definition 2n U2 T -2nCox UT WLCox Ispec UT
kT q

Table A.8: Normalizing parameters Parameter vx VX /UT ix IX /Ispec IC qx QX /Qspec cX Y i CX Y i/COX cX Y o CX Y o/COX cJ CJ /COX gx GX /Gspec Description Normalized voltages Normalized currents Inversion coefficient Normalized charges Normalized intrinsic capacitance between terminals X and Y Normalized extrinsic capacitance between terminals X and Y Normalized total capacitance Normalized conductance Table A.9: Normalizing parameters

place until an aspect ratio is obtained which satisfies the design specifications. Clearly a brute-force trial-and-error approach is not an ideal way to design circuits. An alternate design approach was proposed in [48] where the authors exploit the transconductance efficiency versus inversion coefficient graph as a means of sizing low-power analog circuits. As identified by the authors, the methodology was developed using the transconductance efficiency for three reasons, 1. It is strongly related to the performance of analog circuits. 2. It gives an indication of the device operating region. 3. It provides a tool for calculating the transistor dimensions. By providing insight into the transistor level of inversion, the methodology allows the designer to evaluate tradeoffs among gain, transistor size, bandwidth, matching, and any other parameters relevant to the design [68]. The transconductance efficiency is independent the device geometry as shown in (A.16), 76

APPENDIX A. A BRIEF INTRODUCTION TO THE MOS EKV MODEL AND THE GM /ID DESIGN METHODOLOGY and the relationship between transconductance efficiency is a unique characteristic of all transistors of the same type in a given process. Recall that the inversion coefficient is defined as 2nµCID W U 2 . If the ox L T designer knows any two of the desired transconductance, drain current, or transconductance efficiency, the transistor aspect ratio can immediately be obtained from the corresponding inversion coefficient. The graph of transconductance efficiency versus inversion coefficient is shown in Fig. A.2. As seen from the graph weak inversion offers the highest transconductance efficiency, and in strong inversion the transconductance efficiency decreases proportionately with 1/ if .

Figure A.2: Transconductance efficiency versus inversion coefficient. The regions of inversion can be deduced using the relationships specified in (A.1). In weak inversion, the transconductance efficiency is maximized over a few decades of the inversion coefficient. However in order to achieve such small values of the inversion coefficient, the device must be significantly oversized. The penalty for designing in the weak inversion region is increased area and as a consequence, decreased unity gain frequency since the intrinsic capacitances are proportional to transistor width. The transconductance efficiency decreases as the device is pushed further into strong inversion. Although device aspect ratio decreases in this region, more current is required to achieve the same transconductance as when the device is operated in weak inversion. This results in greater power consumption. The moderate inversion region provides a compromise between device size and power consumption, however it is not well modeled which renders hand analysis difficult. Although simulation is not the ideal way to characterize transistors from a given process, it provides quick, reasonably accurate information about the device's characteristics. Moreover, the EKV model is not yet popular with semiconductor foundries for use in their process design kits (PDKs). This means parameters such as n, Ispec , and IC are not calculated in the BSIM4 transistor models that are currently 77

APPENDIX A. A BRIEF INTRODUCTION TO THE MOS EKV MODEL AND THE GM /ID DESIGN METHODOLOGY used in PDKs. In order to obtain the waveform of Fig. A.2, these parameters must be derived using the process data from the foundry. If subthreshold slope parameter, n, is not provided the subthreshold slope, S , can be used to derive it. The relationship between these two parameters is 1 = ln 10 × n × UT . S (A.20)

The subthreshold slope may be provided by the foundry, or it can be obtained by simulating the IDS -VGS characteristics of a transistor, plotting the current on a logarithmic scale and observing how much change in VGS produces a one decade change in IDS . Ispec can be obtained by combining n with  , UT and W L , and IC is the ratio of the drain current to Ispec . One possible testbench for obtaining the waveform of Fig. A.2 is to use a diode-connected transistor and sweep its drain current over several decades (for example, from 10 pA to 10 mA) as shown in Fig. A.3a and Fig. A.3b. The transconductance efficiency is a parameter calculated by BSIM4 models (gmoverid), and it can be plotted against IC to obtain Fig. A.2.

ID

± VDD
ID
(a) NMOS testbench. (b) PMOS testbench.

Figure A.3: Simulation testbench for obtaining transconductance efficiency versus inversion coefficient graph.

78

Appendix B

Publications
B.1 Peer reviewed conference papers

T. Khan and K. Raahemifar, "An Ultra-Low Power 200 MHz-1 GHz Programmable Frequency Divider with Novel Clear/Preset D-Latch," 2010 IEEE Mid-West Symp. on Circuits Syst., accepted for publication in May 2010. T. Khan and K. Raahemifar, "A low power current reused quadrature VCO for biomedical applications," Proc. IEEE Int'l Symp. on Circuits and Systems, pp.669­672, Taipei, May 2009.

B.2

Book chapters

T. Khan and K. Raahemifar, "Subthreshold frequency synthesis for medical implantable transceivers" in Biomedical Engineering, Trends, Researches and Technologies, Submitted Sept. 2010.

79

References
[1] Health Canada, "Medical Devices Program: Strategic Plan 2007-2012: Building for the Future," Health Canada, Tech. Rep., June 2007. [Online]. Available: http://www.hc-sc.gc.ca/ [2] National Research Council Canada, "Medical Devices," National Research Council Canada, Tech. Rep., March 2009. [Online]. Available: http://www.nrc-cnrc.gc.ca/ [3] Industry Canada, "Canada Your Innovation Partner ­ Medical Devices Industry Profile," Industry Canada, Tech. Rep. [Online]. Available: http://www.hc-sc.gc.ca/ [4] National Institute on Deafness and Other Communication Disorders, "Cochlear Implants," National Institutes of Health, Tech. Rep. 09-4798, August 2009. [Online]. Available: http://www.nidcd.nih.gov/ [5] A. Sivard, P. Bradley, P. Chadwick, and H. Higgins, "The chal-

lenge of designing in-body communications," October 2004. [Online]. http://www.embedded.com/columns/technicalinsights/51200651?printable=true

Available:

[6] P. J. Groen, M. Wine, and D. Goldstein, "Implantable medical devices and ehr systems," http://www.hoise.com/vmw/07/articles/vmw/LV-VM-06-07-5.html. [7] K. Townsend, J. Haslett, T. Tsang, M. El-Gamal, and K. Iniewski, "Recent advances and future trends in low power wireless systems for medical applications," in System-on-Chip for Real-Time Applications, 2005. Proceedings. Fifth International Workshop on, July 2005, pp. 476­481. [8] Federal Communications Commission, "Amendment of Parts 2 and 95 of the Commission's Rules to Establish a Medical Implant Communication Service in the 402-405 MHz Band," Federal Communications Commission, Tech. Rep. FCC 99-363, November 1999. [Online]. Available: http://www.fcc.gov/ [9] Spectrum Management and Telecommunications, "Active Medical Implants Operating in the 402-405 MHz Band," Industry Canada, Tech. Rep. RSS-243, November 2005. [Online]. Available: http://www.ic.gc.ca/ 81

REFERENCES [10] Spectrum Planning Team, "Planning for Medical Implant Communications Systems (MICS) & Related Devices," Australian Communications Authority, Tech. Rep. SPP 6/03, October 2003. [Online]. Available: http://www.acma.gov.au/ [11] European Telecommunications Standards Institute, "Electromagnetic compatibility and Radio Spectrum Matters (ERM); Short Range Devices (SRD); Ultra Low Power Active Medical Implants (ULP-AMI) and Peripherals (ULP-AMI-P) operating in the frequency range 402 MHz to 405 MHz; Part 1: Technical characteristics and test methods," European Telecommunications Standards Institute, Tech. Rep. ETSI EN 301 839-1, June 2002. [Online]. Available: http://www.etsi.org/ [12] Zarlink Semiconductor Inc., "Medical Implantable RF Transceiver ZL70101 Product Preview," Zarlink Semiconductor Inc., Tech. Rep. 7ZS132, March 2007. [Online]. Available: http://www.zarlink.com/ [13] Federal Communications Commission, "Amendment of Parts 2 and 95 of the Commission's Rules to Establish a Medical Device Radiocommunication Service at 401-402 and 405-406 MHz," Federal Communications Commission, Tech. Rep. FCC 09-23, March 2009. [Online]. Available: http://www.fcc.gov/ [14] Spectrum Management and Telecommunications, "Active Medical Implants Operating in the 401-406 MHz Band," Industry Canada, Tech. Rep. RSS-243, February 2010. [Online]. Available: http://www.ic.gc.ca/ [15] R. Gubisch, "Electromagnetic Compatibility (EMC) for Active Implantable Medical Devices," White paper, available online (25 pages). [Online]. Available: http://www.intertek-etlsemko.com/ [16] J. Kim and Y. Rahmat-Samii, "Implanted antennas inside a human body: simulations, designs, and characterizations," IEEE Transactions on Microwave Theory and Techniques, vol. 52, no. 8, pp. 1934­1943, August 2004. [17] P. Soontornpipit, C. M. Furse, and Y. C. Chung, "Design of implantable microstrip antenna for communication with medical implants," IEEE Transactions on Microwave Theory and Techniques, vol. 52, no. 8, pp. 1944­1951, August 2004. [18] H. S. Savci, Z. Wang, A. Sula, N. S. Dogan, and E. Arvas, "A 1-v UHF low noise amplifier for ultralow-power applications," in 2006 IEEE International Symposium on Circuits and Systems, Island of Kos, May 2006, pp. 4495­4498. [19] C.-M. Hsu, C.-M. Lee, T.-C. Yo, and C. H. Luo, "The low power MICS band biotelemetry architecture and its LNA design for implantable applications," in 2006 IEEE Asian Solid-State Circuits Conference, Hangzhou, November 2006, pp. 435­438. [20] F. Carrara, A. Italia, G. Palmisano, and R. Guerra, "A 400-MHz CMOS radio front-end for ultra low-power medical implantable applications," in 2009 European Solid-State Circuits Conference, September 2009, pp. 232­235. 82

REFERENCES [21] A. Tekin, M. Yuce, and W. Liu, "Integrated VCO Design for MICS Transceivers," in 2006 IEEE Custom Integrated Circuits Conference, September 2006, pp. 765­768. [22] R. Staszewski, D. Leipold, C.-M. Hung, and P. Balsara, "A first digitally-controlled oscillator in a deep-submicron CMOS process for multi-GHz wireless applications," in 2003 IEEE Radio Frequency Integrated Circuits (RFIC) Symposium, 8-10 2003, pp. 81­84. [23] Y.-H. Liu, H.-H. Liu, and T.-H. Lin, "A super-regenerative ASK receiver with  pulse-width digitizer and SAR-based fast frequency calibration for MICS applications," in 2009 Symposium on VLSI Circuits, June 2009, pp. 38­39. [24] J. Bohorquez, A. Chandrakasan, and J. Dawson, "A 350 µW CMOS MSK Transmitter and 400 µW OOK Super-Regenerative Receiver for Medical Implant Communications," IEEE Journal of Solid-State Circuits, vol. 44, no. 4, pp. 1248­1259, April 2009. [25] J. Bae, N. Cho, and H.-J. Yoo, "A 490uW fully MICS compatible FSK transceiver for implantable devices," in 2009 Symposium on VLSI Circuits, June 2009, pp. 36­37. [26] A. Tekin, M. Yuce, J. Shabani, and W. Liu, "A low-power FSK modulator/demodulator for an MICS band transceiver," in 2006 IEEE Radio and Wireless Symposium, January 2006, pp. 159­162. [27] J. Ryu, M. Kim, J. Lee, B.-S. Kim, M.-Q. Lee, and S. Nam, "Low Power OOK Transmitter for Wireless Capsule Endoscope," in 2007 IEEE/MTT-S International Microwave Symposium, June 2007, pp. 855­858. [28] K. W. Li, L. Leung, and K. N. Leung, "Low power injection locked oscillators for MICS standard," in 2009 IEEE Biomedical Circuits and Systems Conference, November 2009, pp. 1­4. [29] B. Razavi, Design of analog CMOS integrated circuits. Boston, MA: McGraw-Hill, 2001. [30] A. M. Niknejad, Electromagnetics for high-speed analog and digital communication circuits. York: Cambridge University Press, 2007. New

[31] P. Andreani and S. Mattisson, "On the use of MOS varactors in RF VCOs," IEEE Journal of Solid-State Circuits, vol. 35, pp. 905­910, June 2000. [32] D. Leeson, "A simple model of feedback oscillator noise spectrum," Proceedings of the IEEE, vol. 54, no. 2, pp. 329­330, February 1966. [33] F. M. Gardner, Phaselock techniques. Hoboken, N.J.: Wiley-Interscience, 2005. [34] T. H. Lee, The design of CMOS radio-frequency integrated circuits. versity Press, 2004. [35] A. Hajimiri and T. H. Lee, "A general theory of phase noise in electrical oscillators," IEEE Journal of Solid-State Circuits, vol. 33, no. 2, pp. 179­194, February 1998. 83 New York: Cambridge Uni-

REFERENCES [36] T. H. Lee and A. Hajimiri, "Oscillator phase noise: a tutorial," IEEE Journal of Solid-State Circuits, vol. 35, pp. 326­336, March 2000. [37] A. Rofougaran, J. Rael, M. Rofougaran, and A. Abidi, "A 900 MHz CMOS LC-oscillator with quadrature outputs," in 1996 IEEE International Solid-State Circuits Conference, San Francisco, CA, February 1996, pp. 392­393. [38] A. Rofougaran, G. Chang, J. J. Rael, J. Y. C. Chang, M. Rofougaran, P. J. Chang, M. Djafari, M. K. Ku, E. W. Roth, A. A. Abidi, and H. Samueli, "A single-chip 900-MHz spread-spectrum wireless transceiver in 1-µm CMOS. I. Architecture and transmitter design," IEEE Journal of Solid-State Circuits, vol. 33, pp. 515­534, April 1998. [39] I. R. Chamas and S. Raman, "A Comprehensive Analysis of Quadrature Signal Synthesis in Crosscoupled RF VCOs," IEEE Transactions on Circuits and Systems I: Regular Papers, vol. 54, no. 4, pp. 689­704, April 2007. [40] P. Andreani, A. Bonfanti, L. Romano, and C. Samori, "Analysis and design of a 1.8-GHz CMOS LC quadrature VCO," IEEE Journal of Solid-State Circuits, vol. 37, no. 12, pp. 1737­1747, December 2002. [41] A. Mazzanti, F. Svelto, and P. Andreani, "On the amplitude and phase errors of quadrature LCtank CMOS oscillators," IEEE Journal of Solid-State Circuits, vol. 41, no. 6, pp. 1305­1313, June 2006. [42] I. R. Chamas and S. Raman, "A 5 GHz I/Q Phase-tunable CMOS LC Quadrature VCO (PTQVCO) for Analog Phase Calibrated Receiver Architectures," in 2007 Topical Meeting on Silicon Monolithic Integrated Circuits in RF Systems, Long Beach, CA, January 2007, pp. 269­272. [43] A. W. L. Ng and H. C. Luong, "A 1-V 17-GHz 5-mW CMOS Quadrature VCO Based on Transformer Coupling," in IEEE Journal of Solid-State Circuits, vol. 42, no. 9, September 2007, pp. 1933­1941. [44] B. Razavi, RF microelectronics. Upper Saddle River, NJ: Prentice Hall, 1998.

[45] J. Yuan and C. Svensson, "High-speed CMOS circuit technique," IEEE Journal of Solid-State Circuits, vol. 24, no. 1, pp. 62­70, February 1989. [46] M. Alioto, Model and design of bipolar and MOS current-mode logic : CML, ECL and SCL digital circuits. Norwell, MA: Springer, 2005. [47] S.-S. Yoo and H.-J. Yoo, "A Low Power Current-reused CMOS RF Front-end with Stacked LNA and Mixer," in 2007 Topical Meeting on Silicon Monolithic Integrated Circuits in RF Systems, Long Beach, CA, January 2007, pp. 103­106. 84

REFERENCES [48] F. Silveira, D. Flandre, and P. G. A. Jespers, "A gm /ID based methodology for the design of CMOS analog circuits and its application to the synthesis of a silicon-on-insulator micropower OTA," IEEE Journal of Solid-State Circuits, vol. 31, no. 9, pp. 1314­1319, September 1996. [49] K.-C. Kuo and F.-J. Wu, "A 2.4-GHz/5-GHz Low Power Pulse Swallow Counter in 0.18-µm CMOS Technology," in 2006 IEEE Asia Pacific Conference on Circuits and Systems, Singapore, December 2006, pp. 214­217. [50] Y. F. Kuo and R. M. Weng, "5 GHz low power frequency synthesiser with dual-modulus counter," IET Circuits, Devices & Systems, vol. 3, no. 6, pp. 365­375, December 2009. [51] X. Lei, Z. Wang, K. Wang, and X. Wang, "A high speed low power pulse swallow frequency divider for DRM/DAB frequency synthesizer," in 2009 International Conference on Wireless Communications & Signal Processing, Nanjing, November 2009, pp. 1­4. [52] H. C. Luong, Low-voltage CMOS RF frequency synthesizers. New York, NY: Cambridge University Press, 2004. [53] M. Alioto, Model and design of bipolar and MOS current-mode logic: CML, ECL and SCL digital circuits, G. Palumbo and I. ebrary, Eds. Norwell, MA: Springer, 2005. [54] H.-I. Cong, S. M. Logan, M. J. Loinaz, K. J. O'Brien, E. E. Perry, G. D. Polhemus, J. E. Scoggins, K. P. Snowdon, and M. G. Ward, "A 10-Gb/s 16:1 multiplexer and 10-GHz clock synthesizer in 0.25µm Sige BiCMOS," IEEE Journal of Solid-State Circuits, vol. 36, no. 12, pp. 1946­1953, December 2001. [55] R. Desikachari, M. Steeds, J. Huard, and U. Moon, "An Efficient Design Procedure for Highspeed Low-power Dual-modulus CMOS Prescalers," in 2007 IEEE International Conference on Electronics, Circuits and Systems, Marrakech, December 2007, pp. 645­648. [56] S. Cheng and J. Silva-Martinez, "6.8 mW 2.5 Gb/s and 42.5 mW 5 Gb/s 1:8 CMOS demultiplexers," in 2004 IEEE International Symposium on Circuits and Systems, vol. 4, May 2004, pp. IV ­ 209­12 Vol.4. [57] F. F. Dai, L. S. J. Chimakurthy, D. Yang, J. Huang, and R. C. Jaeger, "A low power 5 GHz direct digital synthesizer designed in Sige technology," in 2004 Topical Meeting on Silicon Monolithic Integrated Circuits in RF Systems, September 2004, pp. 21­24. [58] A. Tajalli, E. J. Brauer, Y. Leblebici, and E. Vittoz, "Subthreshold Source-coupled Logic Circuits for Ultra-low-power Applications," IEEE Journal of Solid-State Circuits, vol. 43, no. 7, pp. 1699­1710, July 2008. [59] R. C. Chang and L.-C. Kuo, "A new low-voltage charge pump circuit for PLL," in 2000 IEEE International Symposium on Circuits and Systems, vol. 5, Geneva, May 2000, pp. 701­704 vol.5. 85

REFERENCES [60] C. P. Yue and S. S. Wong, "On-chip spiral inductors with patterned ground shields for Si-based RF ICs," IEEE Journal of Solid-State Circuits, vol. 33, no. 5, pp. 743­752, May 1998. [61] Y.-H. Liu, C.-J. Tung, and T.-H. Lin, "A low-power asymmetrical MICS wireless interface and transceiver design for medical imaging," in 2006 IEEE Biomedical Circuits and Systems Conference, November 2006, pp. 162­165. [62] J. Pan, H. Yang, and L. wu Yang, "A high-speed low-power pulse-swallow divider with robustness consideration," in 9th International Conference on Solid-State and Integrated-Circuit Technology, October 2008, pp. 2168­2171. [63] K.-Y. Kim, W.-K. Lee, H. Kim, and S.-W. Kim, "Low-power programmable divider for multistandard frequency synthesizers using reset and modulus signal generator," in IEEE Asian SolidState Circuits Conference, November 2008, pp. 77­80. [64] H. Zhang, H. gang Yang, J. Zhang, and F. Liu, "High-speed programmable counter design for PLL based on a delay partition technique," in IEEE International Symposium on Radio-Frequency Integration Technology, December 2009, pp. 100­103. [65] L. Zhang, B. Chi, Z. Wang, H. Chen, and E. Wu, "A Low Power 440-MHz Pulse-Swallow-Divider Combination Synchronization-Asynchronism-Hybrid Frequency Divider," in IEEE International Midwest Symposium on Circuits and Systems, vol. 2, August 2006, pp. 566­568. [66] C. C. Enz, F. Krummenacher, and E. A. Vittoz, "An analytical MOS transistor model valid in all regions of operation and dedicated to low-voltage and low-current applications," Analog Integrated Circuits and Signal Processing, vol. 8, no. 1, pp. 83­114, July 1995. [Online]. Available: http://www.springerlink.com/content/l577l1457j02224j/ [67] C. C. Enz and E. A. Vittoz, Charge-Based MOS Transistor Modeling - The EKV Model for LowPower and RF IC Design. John Wiley, 2006. [68] D. Foty, D. Binkley, and M. Bucher, "Starting Over: gm/Id-Based MOSFET Modeling as a Basis for Modernized Analog Design Methodologies," in 2002 International Conference on Modeling and Simulation of Microsystems, April 2002, pp. 682­685.

86


