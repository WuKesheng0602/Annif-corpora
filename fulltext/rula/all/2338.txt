ADAPTIVE MEASUREMENT CONTROL OF A THERMAL FLOW SENSOR

by

FIONA YUK-FUN YIU, B. Eng. (ELECTRICAL) UNIVERSITY OF VICTORIA, 1991

A thesis presented to Ryerson University in partial fulfillment of the requirement for the degree of Master of Applied Science in the Program of Mechanical Engineering

Toronto, Ontario, Canada, 2004 ©Fiona Yuk-Fun Yiu, 2004

PROPERTY OF

UMI N um ber: E C 5 3 4 2 3

INFORMATION TO USERS

The quality of this reproduction is dependent upon the quality of the copy submitted. Broken or indistinct print, colored or poor quality illustrations and photographs, print bleed-through, substandard margins, and improper alignment can adversely affect reproduction. In the unlikely event that the author did not send a complete manuscript and there are missing pages, th ese will be noted. Also, if unauthorized copyright material had to be removed, a note will indicate the deletion.

UMI*
UMI Microform E C 5 3 4 2 3 Copyright2009 by ProQ uest LLC All rights reserved. This microform edition is protected against unauthorized copying under Title 17, United States Code.

ProQ uest LLC 789 East Eisenhower Parkway P.O. Box 1346 Ann Arbor, Ml 48106-1346

AUTHOR'S DECLARATION
I hereby deelare that I am the sole author of this thesis.

I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research.

I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

BORROWER'S PAGE
Ryerson University requires the signatures of all persons using or photocopying this thesis. Please sign below, and give address and date. Date Signature

Name

Address

Ill

ABSTRACT
Adaptive Measurement Control O f A Thermal Flow Sensor © Fiona Ynk-Fun Yiu, 2004 Master of Applied Science in the Program of Mechanical Engineering Ryerson University
In the present work, an adaptive gain switching control strategy and a digital temperature compensation technique are integrated with a hot-thermistor anemometer to achieve sensor speed and accuracy improvement. The limitation of the Wheatstone bridge technique for temperature compensation is remedied with a digital solution such that the effect of non-linear characteristics of thermistors is compensated to achieve accuracy improvement. The feedback control gains are adapted to the particular range of airflow rates to achieve faster response. Simulation results have confirmed the response speed and accuracy improvement with the proposed digital sensor system. The proposed design has been implemented, and experiments have been conducted. Compared to an original thermal flow sensor with analog circuit, the measurement speed is significantly improved at low airflow rates with adaptive feedback control gains implemented in the prototype digital sensor system. The developed digital sensor system possesses desirable features such as a direct interface to the computer through a serial port, easy change of operational parameters and sensor configurations, and energy conservation, as well as simpler control design with the use of Pulse Width Modulation (PWM) to control the probe heater power.

IV

ACKNOWLEDGMENTS
The author would like to express her gratitude to her supervisor, Dr. Guangjun Liu for his guidance in the process of this work, and to the program director. Dr. Greg Kawall for his encouragement in her pursue for graduate studies. The author's gratitude also goes to Dr. Chun Ho Lam who provided valuable suggestions in the theoretical and experimental work of the bleed flow sharing control system. Dr. Sri Krishnan for his valuable advice on signal processing. Dr. Borys Shchokin for his advice on prediction, and Ms. Frances Stewart for her instructions on classical control theory. Special thanks are given to technical officers of Ryerson University, Mr. Devin Ostrom, Mr. Reg Michie, and Mr. Jim Koch for their unfailing software and hardware support and advices on operation of technical devices. Many thanks are given to the author's colleagues at the Systems and Control Laboratory of Ryerson University: Che-Hang Cliff Chan, Guozhong Gerry Bao, and Dejun Wang for their beneficial discussions on control theories and contributions in the apparatus. Thanks are also granted to Kris Bates for his valuable discussions in the field of signal prediction, Ankit Aurora, Matthew Kyan, and Syed Quadri, for their software recommendations.

TABLE OF CONTENTS
ABSTRACT ......................................................................................................... IV

ACKNOWLEDGMENTS............................................................................................... V TABLE OF CONTENTS................................................................................................ VI LIST OF FIGURES...................................................................................................... VIII LIST OF TABLES........................................................................................ X

NOMENCLATURE......................................................................................................... XI CHAPTER 1
1.1 1.2 1.3 1.4

INTRODUCTION.................................................................................. 1

M o t iv a t io n s .............................................................................................................................1 B a c k g r o u n d o n S e n s o r s ...................................................................................................1 C o n t r ib u t io n s ........................................................................................................................7 O r g a niza tio n of T h e s is ..................................................................................................... 7

CHAPTER 2
2.1

MODELLING OF THE SENSOR.......................................................9
of the

S tructure

S e n s o r ..................................................................................................9

2.1.1 2.1.2
2.2

Components o f the Sensor System Under Study ...................................... 9 Thermistor Temperature-Resistance Equations.................................... 11
T herm al D y n a m ic M odel
of the

S e n s o r ............................................................... 12

2.2.1 2.2.2
2.3

Sensor M odel ......................................................................................... 13 Thermal Dynamic Airflow Equation ...................................................... 15
S peed a n d A c c u r a c y A n a l y s is .................................................................................... 17

2.3.1 2.3.2 CHAPTER 3
3.1

Speed ...................................................................................................... 17 Accuracy ................................................................................................ 18 CONTROL DESIGN AND IMPLEMENTATION......................... 22 Self-Tuning Controller........................................................................... 22 Controller Design .................................................................................. 24 Estimator Design ................................................................................... 28 Adaptively Controlled Sensor ............................................................... 31
D igital S enso r S y s t e m ........................................................................ 32

A d a pt iv e G a in S w itching C o ntro l S t r a t e g y ..................................................... 22

3.1.1 3.1.2 3.1.3 3.1.4
3.2

3.2.1 3.2.2 CHAPTER 4

System Requirements and Processor Selection......................................32 System Configuration and Functions.....................................................33 SIMULATIONS................................................................................... 39

VI

4.1

S im ulatio n

of the

S enso r C o n t r o l ......................................................................... 39

4.1.1 4.1.2 4.1.3
4.2

39 Simulation o f the Sensor Probe.................................. Simulation o f the Closed-loop P I Controlled Sensor.......................... 44 Simulation o f the Adaptively PI Controlled Sensor............................ 48
S im ulation T em perature C o m p e n sa t io n ........................................................ 56 Temperature Compensation Error in the Analog Sensor Circuit....... 5 7
of

4.2.1 4.2.2 CHAPTERS
5.1 T ests

Temperature Compensation Error in the Digital Sensor System ....... 58 EXPERIMENTS............................................................................... 61
of the

P rototype D igital S enso r S y s t e m ................................................61

5.1.1 5.1.2
5.2

Preliminary Test Set Up With Primitive Sensor ................................. 61 63 Preliminary Tests and Results .....................................................
E x p e r im e n t s .........................................................................................................................65

5.2.1 5.2.2 CHAPTER 6
6.1 6.2

Experimental Set Up With Aircraft Sensor......................................... 65 Experiments and Results..................................................................... 68 CONCLUSIONS AND FUTURE WORK...................................... 77

C o n c l u sio n s .........................................................................................................................77 77 F u tu re W o r k ..............................................................................................

APPENDIX A: APPENDIX B:

THERMISTORS............................................................................... 79 SENSOR MODEL WITH CONSIDERATION OF FORCED CONVECTION AND CONDUCTION HEAT LOSS....................80

APPENDIX C: APPENDIX D; APPENDIX E:

DETERMINATION OF ADC RESOLUTION..............................82 SIMULATION PROGRAM............................................................ 83 SCHEMATIC DIAGRAM OF THE PROTOTYPE DIGITAL SENSOR INTERFACE..................................................................... 90

APPENDIX F:

C PROGRAMS FOR THE PROTOTYPE DIGITAL SENSOR INTERFACE...................................................................................... 91

APPENDIX G: APPENDIX H:

MATLAB PROGRAM FOR SENSOR EXPERIMENT..............96 PERFORMANCE OF ADCS IN THE DIGITAL SENSOR INTERFACE.................................................................................... 102

REFERENCES............................................................................................................... 103

Vll

LIST OF FIGURES
Fig. 1.1; Types of flow sensors....................................................................................................................................... 2 Fig. 1.2: Block diagram of the flow sensor system .................................................................................................... 5 Fig. 2.1: Sensor head inserted in a p ip e............................................................................................................. Fig. 2.2: Heated probe of the flow sensor under study................................................................................ 10 10

Fig. 2.3: A Wheatstone bridge..................................................................................................................................... 19 Fig. 2.4: Signal conditioners of the digital sensor interface................................................................................... 19 Fig. 3.1: Block diagram of a self-tuning controller................................................................................................. 23 Fig. 3.2: Block diagram of a PI closed-loop controlled sensor system................................................................ 24 Fig. 3.3: Root locus plot of the sensor system with K[/Kp < 1/ t ............................................................................ 26 Fig. 3.4: Root locus plot of the sensor system with Kj/Kp > 1/ t ............................................................................ 27 Fig. 3.5: Block diagram of a linear predictor...........................................................................................................28 Fig. 3.6: Block diagram of an adaptively controlled sensor system.....................................................................31 Fig. 3.7: Block diagram of a digital sensor interface..............................................................................................34 Fig. 3.8: Pseudo 13-bit ADC interface........................................................................................................................35 Fig. 4.1: Time constants of the sensor probe at various flow rates......................................................................42 Fig. 4.2: SIMULINK model of the open loop sensor probe...................................................................................43 Fig. 4.3: SIMULINK model of the closed-loop controlled sensor system........................................................... 45 Fig. 4.4: Sensor responses at 12 flow steps................................................................................................................ 49 Fig. 4.5: Sensor responses at flow rate = 0.0039 Ib/s...............................................................................................49 Fig. 4.6: Sensor responses at flow rate = 0.01 Ib/s................................................................................................... 50 Fig. 4.7: Sensor responses at flow rate = 0.02 Ib/s................................................................................................... 51 Fig. 4.8: Sensor responses at flow rate = 0.05 Ib/s................................................................................................... 51 Fig. 4.9: Sensor responses at flow rate = 0.1 Ib/s................................. 52

Fig. 4.10: Sensor responses at flow rate = 0.5 Ib/s..................................................................................'................52 Fig. 4.11: Sensor responses at flow rate = 0.9 Ib/s................................................................................................... 53 Fig. 4.12: Sensor responses at flow rate = 0.7 Ib/s................................................................................................... 53 Fig. 4.13: Sensor responses at flow rate = 0 3 Ib/s................................................................................................... 54 Fig. 4.14: Sensor responses at flow rate = 0.05 Ib/s................................................................................................. 54 Fig. 4.15: Sensor responses at flow rate = 0.01 Ib/s................................................................................................. 55 Fig. 4.16: Sensor responses at flow rate = 0.0039 Ib/s.............................................................................................55 Fig. 4.17: Temperature compensation error of the Wheatstone bridge............................................................ 58 Fig. 4.18: Temperature compensation error of the digital sensor system.......................................................... 59 Fig. 4.19: Comparison of temperature compensation errors................................................................................60 Fig. 5.1: Preliminary test set up with the primitive sensor.................................................................................... 62 Fig. 5.2: Test results of the adaptively controlled sensor.............................. 64

V lll

Fig. 5.3: Engine bleed flow sharing control test rig conflguratlon......................................................................65 Fig. 5.4: A photograph of the engine bleed flow sharing control test rig................ 66

Fig. 5.5: Upstream pressures during sensor experiments.....................................................................................70 Fig. 5.6: Enlarged diagram of air supply pressures for.the 1*` flow step ............................................ 70

Fig. 5.7: Enlarged diagram of air supply pressures for.the 2"* *flow step ........................................................ 71 Fig. 5.8: Enlarged diagram of air supply pressures for.the 3 '^ '* flow step......................................................... 71 Fig. 5.9: Enlarged diagram of air supply pressures for.the 4"' flow s te p ........................................................ 72 Flg.5.10: Power measurement for the four flow steps during experiments.......................................................72 Fig. 5.11: Enlarged diagram of power measurement for the 1*` flow step...................................................... 73

Fig. 5.12: Enlarged diagram of power measurement for the 2 "^ flow step...................................................... 73 Fig. 5.13: Enlarged diagram of power measurement for the 3 " ^ * *flow step ...................................................... 74 Fig. 5.14: Enlarged diagram of power measurement for the 4"" flow step...................................................... 74

IX

LIST OF TABLES
Table 4.1: Physical parameters of the sensor probe...............................................................................................40 Table 4.2: Calculated parameters of the sensor probe...........................................................................................40 Table 4.3: Constants for calculating convective heat transfer coefficient.......................................................... 41 Table 4.4: Hilpert's empirical correlation table.......................................................................................................41 Table 4.5: Computation results and constants at different flow rates............................................................... 42 Table 4.6: Constants of the sensor in SIMULINK.................................................................................... 42

Table 4.7: Responses of the sensor probe at various airfiow rates......................................................................43 Table 4.8: Simulation results with PI gains suitable for lower flow rates..........................................................45 Table 4.9: Simulation results with PI gains suitable for higher fiow rates........................................................46 Table 4.10: Simulation results with selected Kp and Ki at various fiow rate................................................... 47 Table 4.11: Selected KpS for adaptive gain switching control strategy..................... 48

Table 4.12: PI control gains for various fiow ranges..............................................................................................48 Table 4.13: Summarized simulation results of the sensor systems...................................................................... 56 Table 5.1: Linear relationship between ADC values and input voltages........................................................... 63 Table 5.2: Specifications of the prototype digital sensor system.......................................................................... 67 Table 5.3: Scaled PI control gains for different fiow ranges.................................................................................67 Table 5.4: Experimental PI control gains for different fiow ranges....................................................................68 Table 5.5: Settings of the valves during experiments..............................................................................................69 Table 5.6: Currents to the main control valve..........................................................................................................69 Table H .l: Test results of ADC accuracy............................................................................................................... 102

NOMENCLATURE
Roman a â c C 2 C ai C ep C gi d e(i) tap-weight vector of the forward linear predictor of order m estimated plant parameters of a self-tuning controller average specific heat capacity of the sensor probe body specific heat capacity of the sensor case specific heat capacity of Aluminium in the sensor probe body specific heat capacity of epoxy in the sensor probe body specific heat capacity of glass in the sensor probe body diameter of the sensor probe body differential temperature difference fi*om its reference in the sensor control system at time i e(i-l) differential temperature difference fi*om its reference in the sensor control system at time i-1 e(n) h hoo k kf ki kp m error of the predictor at instant n convective heat transfer coefficient of fi*ee stream air in SIMULINK model convective heat transfer coefficient of fi-ee stream air proportional constant related to the thermal dynamic airflow equation thermal conductivity of the flowing fluid (air in this thesis) integral feedback control gain in experiment proportional feedback control gain in experiment average mass of the sensor probe body; exponential value in the thermal dynamic airflow equation; filter order m2 mAi mep mgi n r mass of the sensor case mass of Aluminium in the sensor probe body mass of epoxy in the sensor probe body mass of glass in the sensor probe body a constant from Hilpert's empirical correlation table; number of bits of the ADC radius of the sensor probe body; reference input of the self-tuning controller; duty cycle

XI

T xx s t u u(i) u(i-l)
V

autocorrelation of the input signal, x, to a signal predictor Laplace Transform operator time estimated plant parameters of a self-tuning controller PI control at time i PI control at time i-1 flow velocity flow density desired response of the predictor at instant n input signal to the predictor at instant n plant output of a self-tuning controller predictor output at instant n surface area of the sensor probe body unique constant for the temperature-to-resistance Steinhart-Hart Equation unique constant for the temperature-to-resistance Steinhart-Hart Equation unique constant for the temperature-to-resistance Steinhart-Hart Equation unique constant for the temperature-to-resistance Steinhart-Hart Equation effective cross-sectional area inside the 2 -inch diameter pipe =Ap-Ao area obstructed by the sensor body, about 5xl0*^m^ or 0.775 in^ cross-sectional area of the 2 -inch pipe in the experimental setup Analog-to-Digital Converter
ADC value corresponding to the voltage representing ambient temperature Ta ADC value corresponding to the voltage representing heater temperature Th autoregressive

w x(n) x(n-l) y y(n) A Ao Ai Az A3 Aeff Ao Ap ADC
ADC vta ADC vth AR

B Bo Bi Bz C CCS DAQ

proportional constant of the thermal dynamic airflow equation unique constant for the resistance-to-temperature Steinhart-Hart Equation unique constant for the resistance-to-temperature Steinhart-Hart Equation unique constant for the resistance-to-temperature Steinhart-Hart Equation a constant from Hilpert's empirical correlation table custom computer services data acquisition

XU

DC E Emin

direct current mean or total squared error; error of the sensor control system minimum total squared error

EPROM erasable programmable read only memory G Gs I IDE I/O ISPI Ki K2 Ki K ih K il K im Kol Kp KpH KpL KpM Ks L LSB LQR MCU MRAC NASA Nud O.S. open loop transfer function of the sensor cascaded with a PI controller open loop transfer function of the sensor current passing through the heater coil integrated development environment input/output in-circuit serial programming interface thermal conductance from the heated probe to the sensor case thermal conductance from the sensor case to the surrounding air inside the pipe integral feedback control gain integral feedback control gain chosen for high flow range integral feedback control gain chosen for low flow range integral feedback control gain chosen for medium flow range open loop gain of the sensor system with a PI controller proportional feedback control gain proportional feedback control gain chosen for high flow range proportional feedback control gain chosen for low flow range proportional feedback control gain chosen for medium flow range gain of the sensor probe length of the sensor probe body least significant bit linear quadratic control micro-controller unit model-reference adaptive control National Aeronautics and Space Administration Nusselt number overshoot expressed in percentage

xm

P

autocorrelation function of the input process to the forward linear predietor for lag i

PC PI PIC PID Pr PWM
Q Qi

personal computer proportional-integral peripheral interface controller proportional-integral-differential Prantl number pulse width modulation electrical power input to the sensor electrical power input to the sensor at time i maximum electrical power input to the sensor estimated electrical power of the adaptively controlled sensor fixed value resistors in a Wheatstone bridge; fixed value (3000 ohms) resistors in the signal conditioners of the prototype digital sensor interface; autocorrelation function of the input process to the forward linear predictor

Qmax Qy R

Red Rh Rt
R ta

Reynolds number heater coil in the sensor thermistor and its resistance at temperature T in Kelvin (K) thermistor for sensing the ambient temperature of the air flowing inside the pipe and its corresponding resistance

R th

thermistor for sensing the temperature of the heater coil wrapping around it and its corresponding resistance

RISC RTDs RU SCL STC T Tc Ta Taî

reduced-instruction-set-computer resistive temperature devices Ryerson University Systems and Control Laboratory self-tuning control temperature in degree Kelvin of a thermistor R j lumped temperature on the sensor case due to conduction heat transfer ambient temperature of the flowing air inside the pipe ambient temperature of the flowing air inside the pipe at time i

XIV

Th Tni Tsam Ts Too USART USB V VI V2 Vai VCFG Vdd

temperature of the sensor heated probe temperature of the sensor heated probe at time i sampling time of the digital sensor system settling time of the sensor system; thermal response time of the sensor probe temperature of free stream air inside the pipe universal synchronous asynchronous receiver transmitter universal serial bus average volume of the sensor probe body voltage band #1 for constructing the pseudo 13-bit ADC voltage band #2 for constructing the pseudo 13-bit ADC volume of Aluminium in the sensor probe body voltage configuration gate voltage supply to the Wheatstone bridge; voltage supply to the signal conditioners of the digital sensor system

Vep Vgi Vh Vo Vref
V ta V th

volume of epoxy in the sensor probe body volume of glass in the sensor probe body voltage across the heater coil sensor output voltage across a 15-ohm power resistor in the analog sensor circuit reference voltage in the ADC of the digital sensor system voltage corresponding to R ta voltage corresponding to R th mass fiow rate

W

Greek /À p
P ai

viscosity of the fiowing fluid (air in this thesis) density of the fiowing fluid (air in this thesis) density of Aluminium in the sensor probe body density of epoxy in the sensor probe body density of glass in the sensor probe body thermal time constant of the sensor probes natural frequency of a second order system response

Pep Pgi X ©n

XV

damping ratio AT differential temperature between the heated probe and the free stream air inside the pipe of the sensor system ATi differential temperature between the heated probe and the free stream air inside the pipe of the sensor system at time i ATset reference differential temperature between the heated probe and the free stream air inside the pipe of the sensor system AVout output voltage of the Wheatstone bridge

Diacritic Symbol dT^ rate of change in ambient temperature with respect to time

(jj.
dlH

rate of change in temperature on the sensor case with respect to time

dt

rate of change in heater temperature with respect to time

XVI

CHAPTER 1

INTRODUCTION

The objective of this thesis is to improve the speed and accuracy of a thermal mass flow sensor. This chapter provides an overall fl-amework of the thesis in achieving the objective. Section 1.1 presents the motivation of the research on sensor improvement. Section 1.2 reviews the background on sensors. Section 1.3 summarizes the contributions of the thesis. Section 1.4 outlines the organization of the thesis.

1.1

Motivations
To achieve fast response speed of airflow sensors with adaptation to time varying

flows in general has remained a challenge for sensor designers for decades using analog control techniques. Micro-machined sensors came on the market in 1995 [1]; sensor designers have been developing smaller and faster sensors in the form of silicon-chips [2 -6]. Although the size and response time of some thermal flow sensors have been reduced significantly in their silicon-chip or micro-machined versions [7- 11], these currently available smaller and faster sensors still cannot withstand the demanding environmental conditions for aerospace applications or meet hi^i reliability requirements in some industrial applications. In an experimental set-up that resembles an aircraft engine bleed flow sharing control system recently developed in the Systems and Control Laboratory (SCL) at Ryerson University (RU), flow sensors are the key components, and their response speed and accuracy are crucial for achieving high overall system performance. The analog flow sensor for air mass flow measurement has limited response speed that limits the bleed flow sharing control performance and motivated the sensor improvement presented in this thesis.

1.2

Background on Sensors
In order to achieve the objective of sensor improvement, research on sensors to

identify the type of sensor that is in the SCL, review what has been achieved on this particular types of sensors, understand the techniques used in the sensor that is in the SCL, and present strategies to improve the speed and accuracy of the sensor in the SCL.

Types o f flow sensors
According to [12], the use of flowmeters can be traced back to the Romans who attached bronze adjutages to their cisterns to measure water consumption. Among numerous (over 50) types of flowmeters currently available, five are generally categorized as mass fiow sensors that measure the mass of the fluid flowing past or through them while other flowmeters (Rotameters) use the volumetric method that senses the volume or velocity of the flow. The five generally used mass flow sensors are namely Coriolis, thermal, angular momentum, hydraulic Wheatstone bridge, and gyroscopic mass sensors. Among these mass flow sensors, the Coriolis and thermal types are leading and finding new applications in the semiconductor, chemical, petroleum, food and paper industries. The three basic forms of thermal flow sensors, which are based on the principle of heat transfer by fluid flow and generally find their application in the measurement of gas flow, include hot wire anemometers or insertion meters, thermal profile or bypass meters, and clamp-on thermal meters as classified in [12]. Fig. 1.1 categorizes various types of mass flow sensors.

Flow Sensors

Mass flow sensors

Volumetric flow sensors

Coriolis

Thermal

Angular momentum

Hydraulic Wheatstone bridge

Gyroscopic mass sensors

Hot wire anemometers (insertion meters)

Thermal profile (bypass) meters

Clamp-on thermal meters

Constant-current

Constant-temperature

Fig. 1.1: Types of flow sensors

Hot-thermistor anemometer
Referring to Fig. 1.1, the sensor in the SCL is a thermal flow sensor in the form of a hot-thermistor anemometer measuring the mass flow rate of flowing air. According to [13], a hot-thermistor anemometer works on the same principle as a hot wire or film except the temperature coefficient of resistance of the sensing element is negative. Reference to [12], hot-wire anemometers were originally used to measure flow velocity and was the forerunner of the thermal mass flow sensor. Based on the ideal gas law, when the pressure and temperature of a gas are held constant, the mass flow rate of the gas is proportional to its volumetric flow rate. Since the pressure and temperature of a gas in a closed pipe are held constant, a device that measures the volumetric flow rate of the gas actually measures the mass flow rate of that gas. Hence, the insertion thermal mass flow sensors in use today are not much different fi'om those original hot-wire anemometers that measure the volumetric velocity. They basically consist of two or more resistive temperature devices (RTDs) inserted into a pipe at the critical or centreline position where the velocity of the fluid flow approximates the mean velocity of the flow at the downstream end of a long straight pipe. The RTDs are usually part of an electronic bridge circuit.

Constant-temperature hot-thermistor anemometer
Hot-thermistor anemometers usually operate in two basic modes: namely constant current and constant temperature. Referring to Fig. 1.1, the sensor in the SCL is a constanttemperature hot-thermistor anemometer. A constant-temperature anemometer has its sensor resistance kept constant with the advantage of large bandwidth. Its feedback control circuit also allows for temperature compensation. According to [14], a constant-temperature hot wire anemometer has the disadvantages of oscillations in the bridge circuit and breakage of wire. A constant-temperature hot-thermistor anemometer can tolerate wider range of temperature and airflow rate changes but has a slower response time than a hot-wire anemometer. Most constant-temperature anemometers use the idea of temperature compensation as presented in [15-18] to overcome temperature changes in their surroundings. With temperature compensation, the feedback control circuit of the anemometer maintains a constant differential temperature between a heated probe and a reference probe. This design has the advantage of automatic compensation for changes in the

fluid flow ambient temperature. The sensor in the SCL also uses the technique of temperature compensation in a Wheatstone bridge.

Constant-temperature hot-wire anemometer review
According to [19], the development of a constant-temperature hot-wire thermal mass flow meter can be dated back to 1911 when Thomas reported the first commercial heated grid mass flow meter and the patent rights were assigned to him in 1917. For the commercial instrument developed in 1911, Thomas "kept the sensor temperature difference AT constant in order to get the desired linear dependence between the power input and the gas flow" [19]. Various improvements of the Thomas mass flow meter were reported over the years yet the basic principles of this type of thermal mass flow meter remain the same. The basic principles assume that heat losses by conduction and radiation are assumed to be negligible compared to the heat transported by the gas through forced convection [19,20]. Hence the mass flow of the gas is proportional to the electrical power needed to hold a constant differential temperature between a heated probe and a reference probe [15-20]. Reference to [12], hot-wire anemometers or insertion sensors are becoming increasingly popular for measuring fast gas flows in large pipes. Numerous companies have incorporated insertion sensors into a silicon-chip. Thermal sensor manufacturers keep improving their products to run at higher temperature ratings in semiconductor-industry applications. Manufacturers try to expand the applicability and acceptability of their sensors in other fields such as health care, industrial automation, and many consumer products [21 23].

Recent technologies on flow meters
Conventional hot-wire anemometers are usually built with analog circuits. As stated in the November 1989 issue of the Process Industries Canada [24], the trend of flow metering is going digital. Examples of academic papers on digital flow meters are [17] in 1986 and [16] in 1994. Many companies also advertise performance of their digital flow meters yet details of their instruments are kept as trade secrets. One of the attempts to speed up the response time of conventional flow meters is by electronic prediction as described in [25] published in 1975. There are academic papers on predictive control throughout the 1980s and 1990s. Adaptive predictive control techniques are in use in the new millennium.

Examples of academic papers on adaptive predictive control published in year 2002 are: neural-network-based adaptive predictive control for vibration suppression described in [26], a predictive rollover sensor presented in [27], and adaptive predictive control with controllers of restricted structure in [28]. As much as digital flow meter designs are kept as trade secrets, adaptive predictive algorithms are declared proprietary. Recently, National Aeronautics and Space Administration (NASA) advertise in Sensor Technology offering companies the opportunity to license their innovative algorithm for electronic thermometers. They state, "This advanced adaptive predictive algorithm reduces the time required to determine final steady state temperature".

The analog sensor system under study
Tremendous improvements have been achieved on micro-machined sensors. Although micro-machined sensors have the advantages of small size and fast response, they are not yet robust enough to be used in aircraft systems. This makes necessary the

improvements of a conventional hot-thermistor anemometer in terms of its slow response at low flow rates and its inaccuracy due to the non-linearity characteristics of the thermistors.
Airflow Sensor

Signal Conditioner Controller
Tir=f(RTH)
T a- î(R ta )

Fig. 1.2: Block diagram of the flow sensor system

The thermal airflow sensor in the SCL and has been studied in this thesis is in the form of a conventional constant-temperature hot-thermistor anemometer measuring the mass flow rate of airflow. Fig. 1.2 shows the block diagram of the thermal flow sensor system in the SCL.

The analog constant-temperature hot-thermistor anemometer used in the SCL mainly consists of two thermistor-based sensor probes, a heater coil, a Wheatstone bridge, an amplifier, a feedback control circuit, and a personal computer (PC) with a data acquisition (DAQ) device. The two thermistor-based sensor probes are part of the Wheatstone bridge that functions also as a signal conditioner. One probe is for sensing the ambient temperature and is referred to as the sensor reference probe. The other is for sensing the heated temperature fi'om the heater coil and is referred to as the sensor heated probe. The feedback control circuit, using analog components to implement a proportional-integral-differential (PID) controller, works to maintain the differential temperature between the two sensor probes constant at thermal steady state by passing more or less current through the heater coil. The sensor output is sent to the PC through the DAQ device for data recording, data post-processing, and measurement display. The principle of this type of sensor is to have the mass flow rate of the air in a closed pipe proportional to the electrical heat dissipated by the cooling effect of forced convective heat transfer as the flowing air passes around the immersion sensor.

Proposed strategiesfor sensor improvement
This thesis has proposed to improve the speed of sensor response at low airflows with an adaptive gain switching control strategy implemented in software. In the current analog sensor system, the feedback control circuit is implemented with analog components that give a fixed set of feedback control gains. This fixed set of control gains while avoids large overshoot throughout a wide range of airflow rates comes at a cost of response speed at low airflows. An adaptive gain switching control strategy implements the feedback control gains in software so that the gains can be adapted to the change of airfiow rates by predicting the change of airflow rates ahead of time with a forward linear predictor. This thesis has also proposed to improve the accuracy of the sensor by replacing the current analog sensor system with a digital one. A digital sensor system replaces the traditional usage of the Wheatstone bridge by measuring the heater temperature and the ambient temperature in the sensor system with two analog-to-digital channels. When the resistances of the two temperature sensing thermistors and their subsequent conversion into temperature are isolated, the differential temperature calculated in the computer of the digital sensor system compensates for the non-linearity characteristics of the thermistors.

1.3

Contributions
Conventional hot-thermistor anemometers mostly use analog circuits. The sensor in

the SCL has the problem of being slow in reaching its steady state at low airflow rates due to the fixed feedback control gains suitable for one flow rate and implemented by analog components in the original sensor circuit. In achieving the objective of sensor speed and accuracy improvement, the thesis has presented the following contributions: 1. A thermal dynamic model for the sensor under study is derived. 2. After control analysis on the sensor system under study, an adaptive gain switching control strategy and a digital temperature compensation technique are integrated with a hot-thermistor anemometer to achieve sensor speed and accuracy improvement. The feedback control gains are adapted to the particular range of airflow rates to achieve faster sensor response. The limitation of the Wheatstone bridge technique for temperature compensation is remedied with a digital solution such that the effect of non-linear characteristics of thermistors is compensated to achieve sensor accuracy improvement. 3. Simple control design and energy conservation are achieved with the use of Pulse Width Modulation (PWM) to control the probe heater power. 4. Sensor speed and accuracy improvement are demonstrated through simulations and experiments with a prototype digital sensor.

1.4

Organization of Thesis
The objective of this thesis is to improve the speed and accuracy of a thermal mass

flow sensor that is a key component of an aircraft engine bleed flow sharing control system. To achieve the objective, work is done and presented in the following chapters: Chapter 2: A thermal dynamic model and hence the thermal dynamic airfiow equation of the sensor are derived. Chapter 3: After control analysis on the thermal dynamic model of the sensor, an adaptive gain switching control strategy is designed and implemented in a prototype digital sensor system for speed improvement.

Chapter 4:

Based on the thermal dynamic model derived, the digital sensor system and control strategy are simulated to demonstrate speed improvement. The temperature compensation error in the analog and digital sensor systems are simulated to demonstrate accuracy improvement.

Chapter 5: Chapter 6 :

Experiments are carried out to verify the sensor speed improvement. Conclusions are drawn and future work is presented.

CHAPTER 2

MODELLING OF THE SENSOR

The major problem of the current flow sensor is its slow settling time at low airflows. This thesis investigates methods to improve the response at low flow rates and reduce the inaccuracy of the current flow sensor. In order to improve the settling time of the flow sensor response and find out causes of its inaccuracy, the sensor structure and dynamics have to be studied. Section 2.1 introduces the structure of the sensor. Section 2.2 derives the thermal dynamic model and thermal dynamic airflow equation for the sensor. Section 2.3 analyzes the response speed of the sensor probe based on its model derived and causes of inaccuracy of the sensor system based on the thermal dynamic airflow equation derived.

2.1

Structure of the Sensor
Subsection 2.1.1 describes the components of the sensor system in the SCL.

Subsection 2.1.2 verifies the equations that govern the relationship between temperature and resistance of the thermistor. Detailed structure of thermistors is shown in Appendix A.

2.1.1 Components o f the Sensor System Under Study
The analog sensor system being studied is composed of a sensor and a PC with a DAQ device. The sensor consists of a sensor head and a sensor circuit. The sensor head includes two thermistor-based sensor probes, namely Rta and Rth, and a heater coil, Rh, all secured to a stainless steel case as shown in Fig. 2.1. Sensor reference probe Rta is for sensing the ambient temperature of the air flowing inside the pipe. Sensor heated probe Rth is for sensing the temperature of the heater coil R h wrapping around it. Enlarged diagram of the heated probe Rth with the heater coil R h wrapping around it is shown in Fig. 2.2. The sensor head is designed to well insulate the end of the heated probe that attached to the sensor case so that no heat (or minimal heat) is lost to the sensor case firom the heater coil. On the contrary, the other end of the heated probe is poorly insulated so that heat firom the heater coil can be efficiently removed by the flowing air around it through forced convection.

Pin e l e c t o r s to sensor circuit

Sensor case

Air Flow Window on sensor case

T o o
^ R th

Fig. 2.1: Sensor head inserted in a pipe (Drawing not to scale)

Thermister wire leads

m
Insulation

Heater coil

Epoxy

Glass shell Thermister bead Aluminum sheath

Fig. 2.2: Heated probe of the flow sensor under study (Drawing not to scale)

The analog sensor circuit under study is mainly composed of a Wheatstone bridge, an amplifier, and a feedback control circuit. The two thermistor-based sensor probes are a part of the Wheatstone bridge that also functions as a signal conditioner. The Wheatstone bridge

10

and the heater coil form a part of the feedback control circuit. The other part of the control circuit uses analog components to implement a proportional-integral-differential (PID) controller. Altogether this feedback control circuit balances the Wheatstone bridge by controlling the current through the heater coil in order to drive the differential temperature between the two thermistor-based sensor probes to its set point. The sensor head is inserted in a two-inch diameter plastic pipe as shown in Fig. 2.1 while the sensor circuit is external to the pipe and connected to the sensor head through connectors and an unshielded cable. The current passing through the heater coil is proportional to the mass airflow rate inside the pipe. The output voltage of the analog sensor circuit is in turn proportional to the current passing through the heater coil and is used as a measurement of the mass airflow rate after calibration of the system. This output voltage is sent to the PC through the DAQ device for data recording, data post-processing, and flow measurement display.

2.1.2 Thermistor Temperature-Resistance Equations
The thermistors of the sensor under study have temperature-sensing characteristics that are given in a temperature-resistance table provided by the sensor manufacturer. However, the temperature-resistance table from the sensor manufacturer is reserved for proprietary reason. Based on this table, calibration points are taken to verify that the Steinhart-Hart Equations [29] as shown in Eq. (2.1) and Eq. (2.2) describe the characteristics of the thermistors used in this particular sensor under study. R j - exp(Ao + (2-1)

Bq + B, ·InR.p + Bg '(InR j)^ where R t is the resistance of the thermistor at a given temperature T in Kelvin (K), Aq, Ai, Aa, and A3 are unique constants for Eq. (2.1) and Bo, Bi, and B2 are unique constants for Eq. (2.2). Substituting four calibration points for T and R t from the sensor manufacturer's table into Eq. (2.1), four equations are formed with four unknowns, namely A q , A i, A2, and A 3. Using MATLAB, the four unknowns are found to be:

11

A, A,

-4.98212687 + 4481.85315466 -159896.96926269 +1198669.84474087

Then substituting these four unique constants determined above and any given temperature T into Eq. (2.1), a temperature-resistance table is generated. The percentage difference of the resistance calculated with Eq. (2.1) is within 0.22% from that of the table provided by the sensor manufacturer except at the extreme end when the temperature is at 110 ® C. Hence it is verified that Eq. (2.1) describes the temperature sensing characteristics of the thermistors under study. Similarly, three points from the sensor manufacturer's table that is reserved for proprietary reason are taken and substituted into Eq. (2.2) to form three equations with three unknowns, namely Bo, Bi, and B2. The three unknowns are found to be:

Bo' "0.00111464560924" B, = 0.00026009820241 0.00000014291453 B 2. The percentage difference of the temperatures calculated with Eq. (2.2) is within 0.01% from that of the table provided by the sensor manufacturer except at the extreme end when the temperature is equal to or greater than 110 °C. Hence it is verified that Eq. (2.2) describes the temperature sensing characteristics of the thermistors under study.

2.2

Thermal Dynamic Model of the Sensor
The thermal dynamic model of the sensor is dominated by the behaviour of the

thermistor-based sensor probe responding to the airflow passing around it. Since this type of sensor is designed to work in its normal operation range based on the principle of forced convection, it is assumed that heat transfers on the sensor system through radiation, free convection and conduction are negligibly small when compared to forced convection. When the airflow is very low (below a fiow density of 0.1 Ib/min/in^), conduction heat loss through the sensor case may have some impact so a sensor model with conduction and forced
12

convection heat loss may be considered as derived in Appendix B. Subsection 2.2.1 shows a model that only includes forced convection as generally the case for this type of sensor. Subsection 2.2.2 derives the thermal dynamic airflow equation that governs the relationship between the mass flow rate (W) of the flowing air and the electrical power (Q) input to the sensor system.

2.2.1 Sensor Model
For the sensor under study, the sensor manufacturer design that the sensor heated probe and the sensor reference probe are identical so that both probes have the same mass (m), specific heat capacity (c), and surface area (A). This subsection models the sensor probes based on the assumption that forced convection is the dominant heat transfer and heat loss through conduction, free convection, and radiation are negligible. The sensor heated probe is constructed to have the heater coil wrap around the probe for measuring heated temperature of the heater coil. This design ensures that heat from the heater coil is evenly distributed on the probe body and there is no temperature gradient on the probe body during the transient process. This enables one temperature node heated probe. To model the sensor heated probe, the only heat generated from the system is through the heater coil around the heated probe. This heat is mainly dissipated by forced convection and can be formulated as: Q -A -h,,-[T ,,-T J = m - c - ^
at dT (T h)

on the

(2.3)

where Q s electrical power input to the heater coil around the sensor probe, A = surface area of the heated probe body exposed to airflow, hoo = convective heat transfer coefficient of the free stream air, T h = temperature of the heated probe. Too = temperature of the free stream air, m 5 equivalent mass of the composite material in the probe body, c s equivalent specific heat capacity of the composite material in the probe body. dt s rate of change in heater temperature with respect to time.

13

To model the sensor reference probe with the assumption that this probe is identical to the heated probe so that both probes have the same mass, specific heat capacity, and surface area, there is no heat generated from the system and no heat loss other than forced convection, then Q = 0 and Eq. (2.3) becomes: -A -h ,,-[T ,-T .] = m - c - ^ dt where T a = temperature of the sensor reference probe, -- --= rate of change in ambient temperature with respect to time, dt Eq. (2.3) and Eq. (2.4) are rearranged to form the thermal dynamic model of the sensor for control design to improve the sensor response. Assuming zero initial conditions, Laplace transform of Eq. (2.3) is: Q - Ah,,Tn + Ah^T,, = mcsT» Rearrange Eq. (2.5) becomes: + Th = -----mcs + Ah,, mcs + Ah,, Similarly, the Laplace Transform of Eq. (2.4) with zero initial conditions is: ^00T oo ~ AhooTy^ = m csTy^^ Rearrange Eq. (2.7) becomes:
A ti T

(2.4)

(2.5)

(2.6)

(2.7)

Ta =

mes + Ahoo

(2.8)

The thermal dynamic model of the sensor in Laplace Transform can be formed based on Eq. (2.6) and Eq. (2.8). In this model, the electrical power Q = I^R h (where I is the current passing through the heater coil with resistance Rh) from the heater coil is the control input to the sensorheated probe, Ah^T^ is the disturbancefrom the system, andAT zT g -T ^ is the output of the sensorsystem. airflow tothe sensor

Bydefining the electrical

power Q as the control input in the digital sensor system, the sensor model is then a linear system that simplifies the control design. Having electrical power Q as the control input can be achieved by using the pulse-width-modulated power generator technique described in [31, 32]. Subtracting Eq. (2.8) from Eq. (2.6), the control output is:

14

AT = -------mes + Ah,,

(2.9)

00

According to Eq. (2.9), the control output (AT) is not affected by change in ambient temperature that is compensated by using the sensor reference probe to measure the ambient temperature around the sensor. Eq. (2.9) is then the thermal dynamic model of the sensor for control analysis and design. From Eq. (2.6) and Eq. (2.8), the time constant for both sensor probes of the sensor under study is:
T = 

me Ah,,

(2 . 10)

2,2.2 Thermal Dynamic Airflow Equation
dT At thermal steady state, -- --= 0, Eq. (2.3) becomes: dt Q - A .h ,, .[ T H - T J = 0 . Let (2.11)

AT = T j,-T ,, in degree Kelvin (or Celsius) be the referencedifferential free streamair insidethe pipe of thesensor

temperature between the heated probe and the system. Re-arranging Eq. (2.11) yields: ^·^^00=-^

(2.12)

According to [30], the convective heat transfer coefficient (hoe) can be related to the Nusselt number (Nud), the Reynolds number (Red), and the Prantl number (Pr) by Hilpert's empirical correlaition as follows: NUj = ^ ^ = C R e /.P r ''^ kf where d = diameter of the probe body, kf = thermal conductivity of the flowing air, C = a constant for a given Red range from Hilpert's empirical correlation table, n s a constant for a given Red range from Hilpert's empirical correlation table, Pr = Prantl number,, Red = Reynolds number. (2.13)

15

According to [33], if the airflow temperature is within 600 degree Kelvin, Pr can be assumed constant at 0.71. Reynolds number can be written as: Re ^ P l ü d where p = density of the flowing air,
V=

(2.14)

velocity of the flowing air,

p = viscosity of the flowing air. Airflow velocity (v) can be written as: W v=- 4 P-Aeff where W = the mass airflow rate in kg/s, Aeff = effective cross-sectional area of the pipe in m^, = cross-sectional area of the pipe (Ap) - area (A q) obstructed by sensor body. Substituting Eq. (2.15) into Eq. (2.14), Reynolds number can be expressed as: RCj =_^L É _ (2.16) (2.15)

or Rej = -- P

(2 . 17)

where w = airflow density in kg/s/ m^. Substituting Eq. (2.17) into Eq. (2.13) and re-arranging yields: d Let A,g. p (2.18)

k = (-^ :^ )-(-- ^ )" -P r* ^ " d A ,ff-p

(2.19)

then Eq. (2.18) becomes: b ,, = k -W " Substitute Eq. (2.20) into Eq. (2.12) gives: A -k -W "= -^ AT Re-arrange Eq. (2.21) yields: (2.21) (2.20)

16

W=( ^ r AT " " " 4 -

(2.22)

Thus, Eq. (2.22) governs the relationship between the mass flow rate measured by the sensor and the electrical power input to the heater coil in the sensor. The values of B and m can be determined by calibration of the sensor system.

2,3

Speed and Accuracy Analysis
This section points out factors that affect the speed of the sensor in Subsection 2.3.1,

and discusses the causes of inaccuracy of the sensor system and its remedy in Subsection 2.3.2.

2.3.1 Speed
According to Eq. (2.10) - %= Ah,, , the time constant of the sensor probes is

proportional to the mass and specific heat capacity of the probe body but inversely proportional to its surface area and convective heat transfer coefficient of the free stream air. On the other hand, the convective heat transfer coefficient of the free stream air is proportional to the rate of airflow. In other words, the lighter the probe body, smaller its specific heat capacity, larger its surface area, and the higher the airflow rate are, the faster the sensor responds. Since the mass, specific heat capacity, and surface area of the sensor probe do not change unless there is dirt accumulation on the probe; the speed of the sensor probe is mainly affected by the convective heat transfer coefficient that is in turn proportional to the rate of airflow. Even if there is dirt accumulation on the sensor probe, the increase in its mass and specific heat capacity may somewhat be cancelled out by the increase in its surface area and the overall change is insignificant when compared to the changes in airflow rates. Therefore dirt accumulation does not affect the speed of the sensor as much as its flow measurement accuracy.

17

2,3.2 Accuracy
Some general causes of inaccuracy in flow sensors are noise, dirt accumulation, and temperature compensation errors in analog sensor circuits. Noise is particularly an issue at low airflows because of the small signal-to-noise ratio. Noises of the sensor system can be from background electromagnetic interference, power supply, and unshielded cable connecting the sensor head to the sensor circuit. Noise filtering and proper shielding are general solutions to these noise problems so this thesis does not elaborate on the topic of noise. Dirt accumulation is a complex issue that is a project by itself and is not discussed here. This section focuses on improving the accuracy of the sensor by reducing the temperature compensation errors commonly occurring in analog sensor circuits that use a Wheatstone bridge circuit.

Temperature Compensation Error
According to Equation (2.22) - W = ( B -0 )*">the reference differential temperature

(AT) of the sensor system affects the accuracy of the airflow measurement. Constanttemperature anemometer with temperature compensation is based upon the idea that by measuring the difference of the heater temperature (Th) and the ambient temperature (Ta) of the flowing fluid (air in this thesis), calculations of the net heat flow from the heating element can be compensated and a more accurate flow rate of the fluid can be determined. Most hot-wire anemometers utilize a Wheatstone bridge for measuring this differential temperature by measuring the differential voltage. Fig. 2.3 shows the configuration of a typical Wheatstone bridge that consists of two thermistors and two resistors (R) of fixed values. One thermistor with resistance (Rth) measures the surface temperature of the heater and the other thermistor with resistance (Rta) measures the ambient temperature of the flowing fluid. Based on Fig. 2.3, the voltage (AVout) at two points of the bridge is shown in Eq. (2.23): Vdd`R
` TH

Vdd-R
^T A

where Vdd
R Rth

= the bridge supply voltage,
s a constant resistance, s the resistance of the thermistor representing heater temperature, Th,
18

Rta

= the resistance o f the thermistor representing ambient temperature, Ta,

AVout = the output voltage at the two points o f the bridge.
V*,

R ta

AV<

Fig. 2.3: A Wheatstone bridge

By keeping AVout constant, it is assumed that AT = Th - Ta is also constant. However, the resistance-to-temperature relationship of thermistors is non-linear. As Ta

changes, AT also changes. This non-linear characteristic of the thermistor can be eliminated with a digital sensor interface by separately converting the thermistor resistances into voltages and reading the voltages corresponding to Rth and Rta respectively with two channels of an Analog-to-Digital Converter (ADC) as shown in Fig. 2.4.

V th

V ta

Fig. 2.4: Signal conditioners of the digital sensor interface

19

Referring to Fig. 2.4, the voltage (Vra) corresponding to the resistance of the thermistor Rth is:

Similarly, the voltage (Vta) corresponding to the resistance of the thermistor Rta is:

These analog voltages (Vth and Vta) are converted to binary words in the ADC of the digital sensor interface as follows: A D C v ,, = ^ -(2 * -l) ^dd where ADCy^ = binary word representation of the thermistor voltage Vth. n = number of bits of the ADC. ADCv,, = ^ - ( 2 " - l )
*dd

(2.26)

(2.27)

where ADCy^^ = binary word representation of the thermistor voltage VtaThe values of Rth and Rta can then be calculated from the ADCbinary words by substituting Eq. (2.24) into Eq. (2.26) and Eq. (2.25) into Eq.(2.27) respectively. Substituting Eq. (2.24) into Eq. (2.26) becomes:

Re-arranging Eq. (2.28) yields: R TM = R -(-^ ^ -l) Similarly, RTA =R-(TT^7r-- 1) (2.30) (2-29)

Eq. (2.29) and Eq. (2.30) are applied to computing the resistances, Rth and Rta, of the two thermistors from their corresponding binary word readings. The temperatures, T h and T a, corresponding to Rth and Rta respectively can then be calculated with the Steinhart-Hart

20

Equation, T = Bo+B,-InRT+Bj-OnRT)^

^ ·Sincethe

resistances of the two temperature-

sensing thermistors and their subsequent conversion into temperatures are isolated, the differential temperature calculated in the computer of the digital sensor circuit is:
AT = Th - T
a

(2.31)

Consequently the non-linearity of the thermistors is compensated. Since it is difBcult to set up an experimental system to resemble the change of ambient temperature over a wide range, temperature compensation errors in the analog and digital sensor systems are demonstrated by replacing the two thermistors in the sensor systems with two precision potentiometers to simulate the changes in ambient and heater temperatures.

21

CHAPTER 3

CONTROL DESIGN AND IMPLEMENTATION

The sensor under study has the problem of being slow in reaching its steady state at low airflow rates due to the fixed feedback control gains set for one flow rate and the analog implementation of the original sensor circuit. This motivates the use of an adaptive gain switching control strategy described in Section 3.1 such that the feedback control gains are adapted to the range of the mass flow rates being measured. Drawbacks of the analog sensor circuit include temperature compensation error due to thermistor non-linearity, difficulty in adjusting operational parameters, and incompatibility with PC for measurement display without external data acquisition devices. Section 3.2 describes the conversion of the original analog sensor circuit to its digital form so as to implement the adaptive gain switching control strategy and eliminate the drawbacks associated with the analog sensor circuit.

3.1

Adaptive Gain Switching Control Strategy
The adaptive gain switching control strategy presented in this thesis borrows the idea

similar to adaptive control. It is well known that the two main approaches for constructing adaptive controllers are the model-reference adaptive control (MRAC) method and the self tuning control (STC) method [34]. In this work, the idea of a self-tuning adaptive control approach is considered. Subsection 3.1.1 introduces the concept of a self-tuning controller. Subsection 3.1.2 describes the design of a PI controller. Subsection 3.1.3 presents an estimator based on the idea similar to the self-tuning controller. Subsection 3.1.4 shows an adaptively controlled sensor by combining the controller and estimator designed previously.

3.1.1 Self-Tuning Controller
An adaptive controller differs from an ordinary controller in that the controller parameters are variable, and there is a mechanism for adjusting these parameters on-line based on the signals in the system. A self-tuning controller is obtained by coupling a controller with an on-line (recursive) parameter estimator that performs simultaneous identification of the unknown model parameters of the plant. Fig. 3.1 illustrates the schematic structure of a self-tuning controller presented in [34].

22

Control techniques for linear plants are pole-placement, Proportional-IntegralDifferential (PID), Linear Quadratic Control (LQR), etc. The most popular technique to estimate the unknown parameters of linear plants is the least-squares method and its extensions. A variety of self-tuning regulators can be obtained by coupling different control and estimation schemes. Self-tuning control method can also be applied to some nonlinear systems without any conceptual difference.

controller

plant

estimator

à = Estimated parameters
Fig. 3.1: Block diagram of a self-tuning controller

Referring to Fig. 3.1 and according to [34], at each time instant, the estimator sends to the controller a set of estimated plant parameters (â ), that is computed based on the past plant input (u) and output (y). The computer finds the corresponding controller parameters, and then computes a control input u based on the controller parameters and measured signals. This control input u causes a new plant output to be generated, and the whole cycle of parameter and input updates is repeated. Thus the "certainty equivalence" principle is used because the controller parameters are computed from the estimates of the plant parameters as if they were the true plant parameters. Based on Eq. (2.10), the time constant of the sensor probe is proportional to the mass and specific heat capacity of the probe body but inversely proportional to its surface area and the convective heat transfer coefficient of free stream air. Physical properties of the sensor probe such as its mass, specific heat capacity, and surface area do not change dramatically. Even if they change slowly due to dirt accumulation, their impact on the time constant of the sensor probe somewhat counteracts each other and is negligibly small when compared to the impact due to the convective heat transfer coefficient that is in turn proportional to the rate of airflow. Therefore the meaningful plant parameter to be estimated is the convective heat
23

pnoPBïïyoF

transfer coefficient of free stream air or the rate of airflow. According to the thermal dynamic airflow equation shown in Eq. (2.22), the rate of airflow is in turn proportional to the electrical power Q that counterbalances the cooling effects from the airflow. Hence estimating the electrical power can lead to an estimation of the airflow rate. The adaptive gain switching control strategy used in this thesis is to estimate the electrical power input to the sensor to counterbalance the airflow and then switch the control gains accordingly in order to achieve a faster response. PI control technique is used in the controller and forward linear predictor is employed in the estimator to predict the approximate electrical power corresponding to the airflow rate passing around the sensor.

3.1.2 Controller Design
A classical Proportional-Integral-Differential (PID) control scheme is used in the original analog sensor circuit. In the digital sensor system, PI control is used, with Kp being the proportional control gain and K; being the integral control gain. The block diagram of a closed-loop control for the sensor according to Eq. (2.9) is shown in Fig. 3.2.

Error

Power

Sensor probe AT mes + Ah

A T s

Fig. 3.2: Block diagram of a PI closed-loop controlled sensor system

Referring to Fig. 3.2, the closed-loop transfer function of the sensor system with a PI controller is: KpS+ Kj AT
c

1
m o c - i - AV»

KpS + K; A h,,+ K ,, K, s2 + - - ? .:.-r P s + ^ me me (3.1)

s

_A mcs + Ah,,

where AT is the output of the closed-loop controlled sensor and ATset is the differential temperature set point.

24

Compare Eq. (3.1) to the characteristic equation of a second order system, s^ + 2^(o,,s + , where Ç is the damping ration and cO n is the natural frequency of system

response, the damping ratio of the closed-loop controlled sensor system is: h^A + Kp 2.y/mcKi and its settling time is: (3.2)

Eq. (3.2) and Eq. (3.3) are true to a second order system with two poles and no zeros. Referring to Eq. (3.1), the closed-loop sensor system with a PI controller has a zero introduced by the PI controller. According to [35], the additional zero of a response affects the residue, or amplitude of the response component. The closer the zero is to the dominant poles, the greater is its effect on the transient response. This zero usually causes overshoot in the system response. If the zero is far away from the dominant poles, the response resembles that of the two-pole system. To eliminate the effect of this additional zero, either the dominant poles is chosen to be far away from the zero or pole-zero cancellation is used. Referring to Fig. 3.2, the transfer function ------ ------- of the sensor probe can be mcs+Ah,, rewritten in its normalized form as:

From Eq. (3.4), the gain (Kg) of the sensor probe is: Ah,, (3.5)

From Eq. (3.5), it is apparent that the gain of the sensor probe is inversely proportional to the convective heat transfer coefficient of free stream air that is in turn proportional to the rate of airflow. That means the sensor probe has larger gains at low flow rates but smaller gains at high flow rates. Applying a PI controller to the sensor probe, the open loop transfer function of the sensor system is:

25

(Kp/Kj)-s + l 1 1 G=·K; Ah,, x-s + 1 s

K;

(Kp/Kj)-s + l
s -( t - s +1)

Ah,,

(3.6)

Eq. (3.6) indicates that the open loop gain (Kql) of the sensor system with a PI controller is:
K;

Ah,,

(3.7)

For the sensor system described by Eq. (3.6), there are two poles and a zero. One pole introduced by the PI controller is at the origin and the other pole from the sensor probe is at 1/t. The zero introduced also by the PI controller is at Ki/Kp. The time constant (x) of the sensor probe, the proportional and integral control gains are all positive numbers, therefore the pole and zero of this sensor system are located in the Right Hand Plane of the s-domain and implies a stable system. K- 1 Referring to the sensor system described by Eq. (3.6), if -- - < -- then the root locus Kp T plot [36] of the sensor system is shown in Fig. 3.3.
Im s-plane

.Re

Fig. 3.3: Root locus plot of the sensor system with K;/Kp < 1/x

This design gives slow response as shown in Fig. 3.3 that the roots are close to the K- 1 origin of the s-plane. A more desirable control design would have -- - > -- and give a root Kp X locus plot [36] of the system as shown in Fig. 3.4.

26

Im
s-plane

Re

Fig. 3 .4 : Root locus plot of the sensor system with Kj/Kp > 1/ t

To have a reasonably fast response and an overshoot within 5%, the damping ratio (Q is usually chosen to be 0.707. However, if Ç , is 0.707 and the dominant poles at the operating point are so close to the additional zero that overshoot is much more than acceptable, an alternate solution to eliminate the overshoot caused by this additional zero is by pole-zero cancellation. That means if -- - = --, then system pole at --cancels the additional zero at
Kp
T

K-

1

1

T

K---and the overall closed-loop sensor system will resemble a first order system with no overshoot. Since the time constant (x) of the sensor changes according to changes in airflow rate, adaptively switching of the control gains is necessary. The choice of Kp is a trade off between speed and stability. Too large a Kp causes oscillation in the control loop and overshoot in the system response, yet too small a Kp results in slow response of the sensor. Kp is also limited by the maximum power from the electrical power generator in the sensor circuit. This maximum power is in turn limited by the maximum current that can pass through the sensor probe without probe burnout. Due to the overshoot introduced by the PI controller, KpS at different airflow rates can be selected by trial and error in order to choose a balanced trade off between speed and smooth response. Once Kp is selected, K; can be calculated by:
K ,= K ,.i
T

(3.8)
(K o l)

Substituting Eq. (3.8) and Eq. (2.10) into Eq. (3.7), the open loop gain sensor system with a PI controller becomes:

of the

27

K ql =

me

(3.9)

Eq. (3.9) shows that the larger Kp is, the larger the open loop gain of the sensor system. With an integrator in the controller of the sensor system, the system can achieve zero steady-state error with respect to a step input. However, possible integrator wind-up can occur due to saturation in the actuator that in the case of this thesis is the pulse width modulated electrical power generator in the digital sensor interface. This problem can be solved with an integrator anti-windup mechanism to counteract the saturation nonlinearity. According to [37], an integrator anti-windup scheme can be implemented in the PC that is part of the digital sensor system by setting the integral control gain (K;) to zero when the actuator saturates.

3.1.3 Estimator Design
The estimator used in the control scheme of this thesis borrows the idea of signal extrapolation to predict the steady state value of the sensor power measurement based on a fraction of data samples from the sensor control input to a simple forward linear predictor as shown in Fig. 3.5 presented in [38].
Desired response x(n)

x(n)

Input signal x(n-m) Delay

Adaptive filter

Estimate

y(n)

w

n

Prediction error e(n)

Fig. 3.5: Block diagram of a linear predictor

Fig. 3.5 shows the block diagram of an m-th order forward linear predictor. For a onestep forward linear prediction, the predictor output y(n) is a convolution of the tap weights, a = [ai a2 a3 ... am] \ of a transversal filter (or called tapped delay line predictor) and the tapinput vector, X (n-1) = [x(n-l) x(n-2)... x(n-m)]^, in order to estimate the input sample x(n). According to [39], linear prediction is based on the assumption that the input sequence, x(n).

28

is a stationary stochastic process and the predictor tap weights are optimized with the meansquare error criterion commonly used in the Wiener filter theory. According to [38, 39, 40] and referring to Fig. 3.5, mathematical derivation of the predictor is shown as follows. m y(n) = ^ a ^ x (n - k )
k=l

(3.10) (3.11)

e(n) = x(n)- y(n) = x ( n ) - ^ a ^ x ( n - k )
k=l

The mean or total squared error (E) is: m E = ^ e^ (n) = 5 ] (x(n) - ^ a^ · x(n - k ))'
k=l

(3.12)

The predictor coefficients (ak) are optimized by minimization of the squared error (E) with respect to each of the coefficients, i.e . ÔE
da I.

= 0, fori < k < m . As a result,

^ a ^ · ^ x ( n - k ) - x ( n - i ) = ^ x ( n ) - x ( n - i) ,f o r l < k < m
k=I n n

(3.13)

The autocorrelation function of the input process x(n) to the forward linear predictor for lag i is r,g ^(i) = ^ x ( n ) - x ( n - i ) . The range of summation in Equation (3.13) is assumed to be
n=-- 00

-00 < n < 00. Then Eq. (3.13) becomes:

m ^xx(i-k) = r,^(i),fbrl < i < m
k=l

(3.14)

Eq. (3.14) in matrix form is:
rxx(0) Txx(l) rx x (m -l)'

'a i'

Txx(l)

fxx(2)

... r^ (m -2 ) .. r^(0)

rxx(l)' = :xx(2) Jx x N

(3.15)

Txx(m-1) r^ (m -2 )

or R . a = P Eq. (3.16) is known as the Wiener-Hopf Equation, also called the Normal Equation, where

(3.16)

29

îxx(0) R= rxxd)

r^xd) i-xx(2) .. rxx(O)

(3.16a)

r^ (m -l) r^ (m -2 ) ai a.

a=

(3.16b)

P=

rxx(l) rxx(2) _r^(m)_

(3.16c)

Given previous samples of an input process and provided that inverse of the autocorrelation of the input process is non-singular, tap weights of the predictor can be obtained by solving the Normal Equation directly as follows: a = R -'.P (3.17)

More efficient ways to calculate the optimal tap-weight vector are search techniques and exact (orthogonal) techniques. For simplicity in coding, this thesis uses the direct method shown in Eq. (3.17). When the predictor tap weights are obtained according to Eq. (3.17), the mean squared error (E) in Eq. (3.12) is minimized. The minimum mean squared error (Emin) is: P
n

(3.18)

The extrapolated signals can be obtained by time-series modeling. Based on the theory of autoregressive (AR) model of the time-series modeling [39, 40], the AR coefficients are nothing but the predictor coefficients. Therefore after the predictor tapweights are calculated, future values of the input signal to the predictor can be extrapolated with the predictor coefficients and the estimated output y(n) assuming that the error e(n) is negligibly small. That is, for the one-step forward prediction, the predicted value is: x(n) = ]^ak y (n -k ) + e(n) « ^ a ^ y (n -k )
k=l k=l

(3.19)

30

How far ahead the predictor can predict and how accurate the predicted values should be depend on individual application.

3.1.4 Adaptively Controlled Sensor
An adaptively controlled sensor system as shown in Fig. 3.6 is obtained by combining the controller and estimator designed above.

Error

PI controller

Power

Sensor probe

A T
mes + Ah

^
Delay Adaptive filter

Estimated power

Desired response

On

Prediction error

Fig. 3.6: Block diagram of an adaptively controlled sensor system

Referring to Fig. 3.6, the control input, which is the electrical power Q, is fed into the forward linear predictor. Output of the predictor is the estimated electrical power that will counterbalance the cooling effect of the airflow around the sensor. Once the estimated electrical power Qy is calculated, it is used to determine the set of feedback control gains that gives better performance for a particular flow range. The feedback control gains Kp and K; are then switched to adapt to the estimated flow rate in terms of Qy so as to achieve smaller settling time in the control loop. The feedback control gains of the sensor system is moderately sensitive to the change in airflows, therefore airflow range of the sensor is roughly divided into three categories, namely low, medium, and high. In order to select a set of feedback control gains that is

31

suitable for a particular flow range, the conventional gain scheduling approach presented in [41-42] is considered. Within each flow range, a set of feedback control gains is selected by trial and error at different flow rates. This set of feedback control gains selected is supposed to give the best performance at most of the operating points within that flow range. In order to switch the feedback control gains from one flow range to another, the electrical power estimated needs only to fall within a flow range, therefore the adaptively controlled sensor does not require a very accurate estimator. In the analog sensor circuit, the feedback control gains are set to values that are suitable for high flow rates for a safeguard of stability and no overshoot with a trade off of slow response at low flow rates. Based on the same reason, the default feedback control gains of the adaptively controlled sensor system are also set to that corresponds to high flow rates. In case of estimator malfunction, the adaptively controlled sensor system still operates in its default control gains. This adaptively controlled sensor is implemented with a digital sensor system presented in the next section.

3.2

Digital Sensor System
By using an adaptive gain switching control strategy implemented with a digital

sensor system, the sensor response can be speeded up. This section focuses on replacing the analog sensor system with a digital one that allows proper signal conditioning, sensor control, and pre-processing of the sensor information. Subsection 3.2.1 pinpoints the system requirements and the selection of a suitable micro-controller unit. Subsection 3.2.2 describes the digital sensor system configuration and functions.

3.2.1 System Requirements and Processor Selection
To ease program development, the digital sensor system was designed to use a PC for program execution, and a micro-controller unit as an input/output (I/O) device and sensor interface. According to [43], a Reduced-Instruction-Set-Computer (RlSC)-based micro controller unit (MCU) can be utilized as an I/O device and sensor interface. The single chip micro-controller needs to possess the following features and capabilities:

32

Measure 2 analog signals over temperature range from -20 to 100°C with +/-0.01 °C accuracy that requires a 13 bit ADC, details of resolution requirement is described in Appendix C. Convert nonlinear thermistor values to temperature with +/-0.02 °C accuracy Easy reprogramming: Flash MCU or EPROM Communicate with Host PC: Use RS-232, RS-485, USB Program alteration or calibration at site: In-circuit Serial Program Interface Control heater power: PWM technique Low to Medium memory size (4K-8K) Speed trivial because the sensor response time is in seconds Compatible with facilities available: PicStart Pro. Integrated Development Environment (IDE) programmer, C or MicroEngineering Lab Pbasic Pro. compiler Easy to program (high level language) Inexpensive and readily available

Based upon the aforementioned specifications, PIC16C774 is selected among the Microchip Peripheral Interface Controller (PIC) family of RISC MCUs. According to [44], the PIC16C774 micro-controller has features that meet all the specifications mentioned above but the ADC resolution. It has 5 channels of 12 bit analog-to-digital converter, 3 timers and 2 hardware pulse-width-modulation generator modules, a universal synchronous asynchronous receiver transmitter (USART), an in-circuit serial programming interface (ISPI), EPROM 4K X 14 words of program memory and 256 x
8

bytes of data memory, and a

20MHz clock. It can be programmed with the readily available programmer and compiler software. It is relatively inexpensive.

3.2.2 System Configuration and Functions
The configuration of the RISC-based sensor system is shown in Fig. 3.7. Functions of the micro-controller based I/O device include analog to digital conversion, pulse-widthmodulated (PWM) signal generation, and data communication. The host PC communicates with the micro-controller based I/O device and executes the control loop in software.

33

Airflow

Signal Conditioner

PIC16C774

In Circuit Serial +V 12 bit ADC
R ta

Program Interface RISC MCU

Rth +V

RS-232

lObitPWM Module Heater Power Amplifier USART [ost PC

Fig. 3.7: Block diagram of a digital sensor interface

Analog-to-Digital Conversion (ADC)
Referring to Fig. 3.7, the analog voltage signals from Ae two thermistors are fed to the ADC of the RISC MCU through signal conditioners such as voltage dividers and voltage followers. The ADC converts these analog voltage signals from the thermistors to binary words and then sends to the PC these voltages in digital form. There is, currently, a limitation on the ADC resolution available on the PIC line of micro-controllers. The highest resolution for internal ADCs is 12 bits. External ADCs are available but the majority of them, while offering higher resolution, utilize successive approximation techniques that significantly increase conversion time. To simplify the

system, a PIC micro-controller is chosen that has a 12-bit internal ADC. The internal ADCs of this line of PIC allow configuration/control over the ADC reference voltages. The ADC span is scaled between a -- Vref and a + Vref (within the limits of the PIC power supply). The 12-bit ADC can be expanded by accessing these VrefS and repeatedly spanning the ADC range across a series of voltage bands. A pseudo 13-bit ADC is made by having the ADC read over two voltage spans as shown in Fig. 3.8 and hence doubling the 12-bit ADC resolution to 13 bits.

34

analog signals from signal conditioner

V d d
12 Bit ADC VCFG

C hi

V d d
ChO V2

Fig. 3.8: Pseudo 13-bit ADC interface

Referring to Fig. 3.8, the ADC reference voltages are accessed through the PIC's internal voltage configuration gate (VCFG) module and connected to two separate external adjustable voltage divider networks so as to minimize the transition errors when switching between the two bands. The micro-controller is programmed to configure the ADC

references so that the ADC range can be switched between the two voltage bands with the following pseudo codes.

If (0 < input voltage <= Vdd/2), then (choose Band #1) by setting - Vref = GND, + Vref= VI (VI = + Vdd/2) else if (Vdd/2 < input voltage <= Vdd), then (choose Band #2) by setting - Vref = V2 (V2 = + Vdd /2), + Vref = + Vdd end With this configuration and algorithm, each band uses the full 12-bit ADC resolution to cover approximate half of the existing temperature range (0 - 2.5 volt DC). This configuration can then give a pseudo 13-bit ADC resolution over the full temperature range ( 0 - 5 volt DC).

35

PWMHeater Driver
The PWM modules of the PIC16C774 are internal peripheral devices that run independently of the main program in the MCU. Their independency simplifies program development because no interrupt or real time system is needed to generate the PWM signals. That means once the appropriate register is loaded, the PWM runs independently in the background of the main program. This PWM signal turns ON or OFF according to the duty cycle a power amplifier that drives the heater of the sensor. The maximum power to the heater is: Qmax = Vh^/ R h where V h is the voltage across the heater with resistance R r. The average power (Q) to the heater is: Q = r* Qmax where r is the duty cycle. In other words, the average power to the heater is directly proportional to the duty cycle of the PWM driver. On the other hand, the airflow rate (W) = {B*Q/AT}^^ in Ibs/s where B and m are constants determined with calibration of the system. Consequently, the flow rate is exponentially (to the power m) proportional to the duty cycle of the PWM driver.

Data Communication
The USART of the PIC16C774 is an internal hardware that supports communication schemes such as RS-232, RS-485, or Universal Serial Bus (USB version 1.0). It allows communications to and from the MCU to run independently (e.g. the PWM generator) in the background of the main program. This may not be a desirable feature for aircraft sensors that are installed in places not accessible for normal test, but may be useful for a prototype digital sensor system or for other applications. The prototype digital sensor interface of this thesis uses RS-232 for its simplicity and availability. The internal signal levels of the PIC16C774 USART are different fi-om those of the RS-232 from the serial communication (com) port of the PC. Therefore an RS-232 level converter chip (Maxim chip MAX232A) is used based on information firom [44] to interface the serial communication pins of the PIC to the serial communication port of the PC. With this interface, a communication link is set up between the micro-controller based I/O device and the PC. The I/O device can then receive PWM signals fi*om the PC and transmit temperature readings in binary words to the PC.

36

The control scheme for the sensor system is implemented in software with the PC that enables easy program development. The adaptive gain switching control strategy is coded with the following algorithm.

Control Algorithm
The control loop starts when the PC sends to the I/O device a PWM signal and the I/O device responds by sending back to the PC two temperature-readings in binary words corresponding to the voltages representing the resistances of the two thermistors. The thermistor resistances
(R th

or R ta) are calculated in the PC from these binary words with Eq.

(2.29) and Eq. (2.30), where R = 3KO is the fixed value resistor of the voltage divider in the prototype I/O device (or called digital sensor interface). The temperatures of the thermistors are then calculated from these thermistor resistances according to the Steinhart-Hart Equation shown in Eq. (2.2). The thermistor temperatures (Thi and Taî) in digital form represent the heater temperature and ambient temperature, respectively, at time i. Symbols with subscript i indicate values at time i. Airflow rates are categorized to be in low, medium and high range with corresponding feedback control gains
K pl, K jl, K pm, K im, K ph, K jh

respectively. An

adaptive gain switching Proportional-Integral (PI) control algorithm is programmed in the computer according to the following procedures.
1) Set-point: the reference differential temperature (AT) = (T h - T a) = 40 °C

2) Default feedback control gains are set for the range of high flow rates: Kph and Km 3) ATi = (Thi - T ai) where Thi & Tai are resistance-to-temperature converted by the Steinhart-Hart Equation and ATi is the differential temperature at time i 4) Error, e(i) = AT; - AT is the differential temperature difference at time i 5) PI control at time i, u(i) = u(i-l) + (Kp + K; * T s a m ) e ( i) - Kp * e(i-l) where Kp, K; are the feedback control gains at time i, Tsam is the sampling time and 0<u(i)<100 (0-100 corresponds to the limits of the PWM generator that is programmed at 0.1% resolution).
6) This PI control, u(i), is used to program the PWM generator that drives the heater to

output electrical power Q; at time i.

37

7) Data of Q; are input to the predictor to estimate the final electrical power Qy that will counterbalance the cooling effect of the airflow.
8) The feedback control gains are then switched according to the estimated electrical

power Qy that corresponds to a particular flow range.

38

CHAPTER 4

SIMULATIONS

Computer simulation results of the digital sensor are presented in this chapter. Section 4.1 simulates the sensor model derived in Chapter 2 and the sensor control strategy designed in Chapter 3 to demonstrate speed improvement. Section 4.2 presents the temperature compensation error in both the analog and digital sensor systems to demonstrate accuracy improvement.

4.1

Simulation of the Sensor Control
The sensor response speed depends on two key factors: the thermal response speed of

the sensor probe and the transient response speed of the sensor control system. Subsection 4.1.1 demonstrates the thermal response speed of the sensor probe by simulating in SIMULINK the model of the sensor probe derived in Chapter 2 without the feedback control mechanism. Subsection 4.1.2 selects suitable feedback control gains by trial and error with the simulation in SIMULINK of the closed-loop PI controlled sensor. Subsection 4.1.3 simulates with a MATLAB program the adaptively PI controlled sensor designed in Chapter 3 to demonstrate speed improvement over a fixed PI controlled sensor.

4.1.1 Sim ulation o f the Sensor Probe
The model of the sensor probes is built based on Eq. (2.3) and Eq. (2.4). From Eq. (2.3), the temperature on the heated probe can be written as: T,, = f-- ( Q - A - h ,, - [ T ,, - T J ) - d t ·' me Similarly fi*om Eq. (2.4), the ambient temperature can be written as: T * = | -- ·(A -h,,-[T .-T J)-dt ·' me (4.2) (4.1)

Due to proprietary reasons, the sensor manufacturer withholds information about the sensor parameters. Physical parameters of the sensor probe (shown in Fig. 2.2) under study are estimated and listed in Table 4.1 as follows:

39

Radius of the sensor probe, r Length of the sensor probe, L Ratio of glass by volume in the probe, Vgi Ratio of epoxy by volume in the probe. Yep Ratio of aluminium by volume in the probe, V ai Density of glass, Pgi Density of epoxy, pep Density of aluminium, Pai Specific heat capacity of glass, Cgi Specific heat capacity of epoxy, Cep Specific heat capacity of aluminium, C a i

0.0015m 0.01m 0.1 0.7 0.2 2225 kg/w? 1400 kg/m^ 2702 kg/m^ 835 J/(kgK) 13 J/(kgK) 903 J/(kgK)

Table 4.1: Physical parameters of the sensor probe

Based on the sensor probe data listed in Table 4.1, the following constants of the sensor probes are calculated as shown in Table 4.2.
Sensor probe parameters Diameter Surface Area Volume Mass of glass Mass of epoxy Mass of aluminium Average mass Average specific heat capacity V= 7 1r^L Formula d = 2r Results 0.003m 1.01316x10-^ 7.0686x10'* l.S728xlO-*kg 6.9272xl0~*kg 3.8199x10-* kg 1.2320x10-* kg ep m me = m Xc

mgi=PeiVgiV
m ep = P ep V e n V

m A 1 =pA lV A |V
m --nigi+mep+mAi

tP al
m

393.8887kg-K 0.0485 J/K

Table 4.2: Calculated parameters of the sensor probe

Referring to Fig. 2.1, the sensor head of the sensor under study is inserted into a 2inch diameter plastic pipe in the experimental set up that simulates the engine bleed airflow system. The minimum mass airflow density (Wm) valid for forced convection is about 0.1 Ib/min/in^. This flow density can be converted to metric unit as 1.1742 kg/s/m^ or to a flow rate of 0.0039 Ib/s in the 2-inch diameter pipe with an area of 5 x l 0 "^m^ (0.775 in^) obstructed by the sensor body. According to the sensor manufacturer's data, the sensor under study can easily handle a flow rate of 200 Ib/min in a 3-inch diameter duct. This datum can be converted to a flow density of 0.47 Ib/s/in^ or 332 kg/s/m^. The current working flow rate per channel in the experimental set up ranges firom 0.01 Ib/s to 0.051b/s for the 2-inch diameter pipe with an area of 5 x 10"^m^ (0.775 in^) obstructed by the sensor body. Since the

40

convective heat transfer coefficient (ha>) of free stream air changes as the airflow rate changes, different values of the convective heat transfer coefficient (hoo) are calculated based on Eq. (2.18). The airflow rates are input fi*om 0.0039 Ib/s to 1.1 Ib/s as a step function in the SIMULINK model to simulate changes in airflow. The properties of the temperature dependent parameters and some constants to calculate the effective cross-sectional area of the pipe in Equation (2.18) are listed in Table 4.3 as follows.
thermal conductivity of air (kf) at 300K density of air (p) viscosity of air (p) Cross-sectional area of 2-in dia. pipe (Ao) Area of obstruction by sensor body (Ao) 26.3x10"^W/m.K 1.1614 kg/m^ 184.6xlO-'N.s/m^ 0.002 5x10"^

Table 4.3: Constants for calculating convective heat transfer coefficient

With the aforementioned flow rates or flow densities provided, the Reynolds number can be calculated according to Eq. (2.16) or (2.17). Once the Reynolds numbers are calculated, constants C and n in Eq. (2.18) can be determined fi"om Hilpert's empirical correlation table [30].
Rcd 0 .4 -4 4 -4 0 40-4000 4000-40000 40000-400000

c
0.989 0.911 0.683 0.193 0.0266

n 0.330 0.385 0.466 0.618 0.805

Table 4.4: Hiipert's empirical correlation table

A range of convective heat transfer coefficients (h») and time constants of the sensor are calculated corresponding to the range of airflow rates. Computation results and constants are listed in Table 4.5.
Flow rates (Ib/s) 0.0039 0.01 0.02 0.03 0.04 0.05 Flow densities (kg/s/m^) 1.1742 2.9771 5.9541 8.9312 11.9082 14.8853 Reynolds numbers 191 484 968 1451 1935 2419 0.683 0.683 0.683 0.683 0.683 0.683 0.466 0.466 0.466 0.466 0.466 0.466 C n h (W/JK) 61 95 131 158 181 201 Time constants m e, . T= -- (sec.) 7.8 5.1 3.7 3.0 2.6 2.4

41

0.1 0.3 0.5 0.7 0.9 1.1

29.7705 89.3116 148.8527 208.3938 267.9348 327.4759

4838 14514 24191 33867 43543 53219

0.193 0.193 0.193 0.193 0.0266 0.0266

0.618 0.618 0.618 0.618 0.805 0.805

284 561 769 947 1123 1320

1.7 0.85 0.62 0.51 0.43 0.36

Table 4.5: Computation results and constants at different flow rates

Time constants of the sensor probe are plotted in Fig. 4.1 at different flow rates. It shows both from Table 4.5 and Fig. 4.1 that the time constants of the sensor probe decrease with increase in flow rates.
8 7
6

I c ®
I 4 8 3
2 1 0

0

0.2

0.4

0.6
Flow r a te s In Ib/s

0.8

1

1. 2

Fig. 4.1: Time constants of the sensor probe at various flow rates

Fig. 4.2 shows a model of the sensor probe as an open loop plant in SIMULINK. Constants of the sensor model in SIMULINK are listed in Table 4.6.

Differential temp set point, ATset Resistance of the heater coil, Rh Maximum allowable current, Lax Maximum allowable power, Q m ax
me

40 K 48.8 0 1/3 A 5.4 Watt 0.0485 J/K 1.01316x10-^ m^ 0.01 s 300 K 300 K 300 K

Surface area of the sensor probe body, A Integration step size Initial valve of ambient temp. Ta Initial valve of temp of free stream air in pipe, Tinf Initial valve of temp at heated probe, Th

Table 4.6: Constants of the sensor in SIMULINK

42

6.4

SoopeBrcr

300 Tinf Ftecfn
(3*10^3y(184.6*1(A7).

X
hA(rinf-Ta) 1/mc1

c H i
0.805 natFtec>40000 0.618

0.0266 0.193

0.466

0.683

Fig. 4.2: SIMULINK model of the open loop sensor probe

Referring to Fig. 4.2, the mass airflow rates (W) from 0.0039 Ib/s to 1.1 Ib/s are treated as step inputs. Based on these step inputs, the convective heat transfer coefficients, h, are calculated according to Eq. (2.18) and form the sensor model according to Eq. (4.1) and Eq. (4.2). Maximum power ( *R jj = (1)^ * 48.8 = 5.4 watts) of the analog sensor

circuit is applied in this simulation model to check the thermal response of the sensor. Thermal response of the sensor (Ts) is defined here as the time to bring about the differential temperature error observed from the "Scope Error" in Fig. 4.2 from 40 to 0.8 (i.e. 2% of 40). Simulation results are recorded in Table 4.7.

W(lb/s) T,(s)

0.0039 0.4

0.01 0.4

0.02 0.4

0.03 0.4

0.04 0.4

0.05 0.4

0.1 0.4

0.3 0.5

0.5 0.55

0.7 0.6

0.9 0.75

1.1 1.6

Table 4.7: Responses of the sensor probe at various airflow rates

43

Table 4.7 indicates that the fastest response of the sensor probe under study with the existing constraints such as 5.4 watts maximum power and 40 °K reference differential temperature is 0.4 second. It is observed that when the airflow rates are 0.1 Ib/s or less, the response of the sensor probe remains at 0.4 second regardless of the magnitude of the airflow rates. This happens because maximum current is input and the sensor probe is over-energized to respond in its fastest speed. When the airflow rates are 0.1 Ib/s or less the sensor probe responds as if there were an adiabatic boundary. When the airflow rates exceed 0.1 Ib/s, this pseudo adiabatic boundary is no longer valid and the cooling effect from the airflow slows down the sensor probe response and results in slower response at higher flow rates.

4.1,2 Simulation o f the Closed-loop P I Controlled Sensor
Referring to Fig. 4.3 with sensor parameters as listed in Table 4.6, and electrical power from the actuator is from 0 Watt to 5.4 Watt, various airflow rates as listed in Table 4.5 are simulated as step input to the closed-loop PI controlled sensor.

Choice o f P I Control Gains
Initially, the proportional gain (Kp) is tuned to values that are suitable for lower flow rates and kept at the same value at other higher flow rates. The integral gain (K,) can be calculated based on Eq. (3.8)- K; = Kp ·--. Electrical powers (Q in watts), settling times (Ts at ±2% of AT) and percentage overshoot (%0.S.) of the sensor response at particular flow rates are recorded in Table 4.8. As shown in Table 4.8, when Kp is kept at higher flow rates the same value that is suitable for lower flow rates, high percentage overshoots occur at higher flow rates.

44

Bicr

1/nr Q4

V m 2
Fëd 300

Tirf

X__

aao5
S/vtchnI

nst40G0O>fteMXX)

Cat40GGOf^cMX]0 0683.

Fig. 4.3: SIMULINK model of the closed-loop controlled sensor system

Flow rates (Ib/s) 0.0039 0.01 0.02 0.03 0.04 0.05 0.1 0.3 0.5 0.7 0.9 1.1

h o O

Sensor gain - J -- (JK/Wm^) Ahoo 160.6635 104.1454 75.3980 62.4168 54.5859 49.1949 34.7082 17.6024 12.8372 10.4271 8.7884 7.4774

1/x

Kp

Ki =
Kp*(l/x)

Ts

Q
(Watt)

%0.S. (%) 0 0 0 0 0 0 2.5 5.25 7.25 11 13.35 0

(W/JK) 61 95 131 158 181 201 284 561 769 947 1123 1320

(s')
0.1283 0.1979 0.2733 0.3302 0.3775 0.4189 0.5937 1.1707 1.6053 1.9763 2.3448 2.7559 0.4 0.4 0.4 0.275 0.275 0.275 0.275 0.275 0.275 0.275 0.275 0.275

(s)
0.55 0.50 0.5 0.6 0.6 0.6 1.7 1.8 1.8 1.85 2.2 1.2

0.051 0.079 0.109 0.091 0.10 0.115 0.16 0.32 0.44 0.54 0.64 0.76

0.25 0.38 0.53 0.64 0.73 0.81 1.15 2.27 3.12 3.84 4.55 5.4

Table 4.8: Simulation results with PI gains suitable for lower flow rates

45

Subsequently, the proportional gain (Kp) is switched to a value suitable for higher flow range and kept at the same value at other lower flow rates. The integral gain (K;) can be calculated based on Eq. (3,8)- K; = Kp ·--, Electrical powers (Q in watts), settling times (Ts at ±2% o f AT) and percentage overshoot (%0,S,) of the sensor response at particular flow rates are recorded in Table 4,9, As shown in Table 4,9, when Kp is kept throughout the entire range of airflow rates the same value that is suitable for h i^ e r flow rates, there is no overshoot in the sensor response yet settling times of the sensor system at lower flow rates are larger than those recorded in Table 4,8, These simulation results confirm that the feedback control gains implemented in the analog sensor circuit are chosen for higher flow rates with no overshoot. As a trade off, the sensor response is slow at lower flow rates.

Flow rates (Ib/s) 0.0039 0.01 0.02 0.03 0.04 0.05 0.1 0.3 0.5 0.7 0.9 1.1

hoo

Sensor gain - i -- (JKAVm^) Ahoo 160.6635 104.1454 75.3980 62.4168 54.5859 49.1949 34.7082 17.6024 12.8372 10.4271 8.7884 7.4774

1 /t

Kp

Ki Kp*(l/x)

Ts

(W/JK) 61 95 131 158 181 201 284 561 769 947 1123 1320

(s')
0.1283 0.1979 0.2733 0.3302 0.3775 0.4189 0.5937 1.1707 1.6053 1.9763 2.3448 2.7559 0.175 0.175 0.175 0.175 0.175 0.175 0.175 0.175 0.175 0.175 0.175 0.175

(s)
1 1 0.95 0.95 0.95 1.0 1.0 0.9 0.9 0.85 0.8 1.2

Q (Watt)

%0.S. (%) 0 0 0 0 0 0 0 0 0 0 0 0

0.022 0.035 0.048 0.058 0.066 0.073 0.104 0.205 0.281 0.410 0.482 0.410

0.25 0.38 0.53 0.64 0.73 0.81 1.15 2.27 3.12 3.84 4.55 5.4

Table 4,9: Simulation resuits with PI gains suitable for higher flow rates

The next simulation step is to select KpS that are suitable for different flow rates. As shown in Table 4,10, Kp needs to be switched accordingly at various flow ranges so as to achieve no overshoot and a faster response.

46

Flow rates (Ib/s)

K

Sensor gain ---- (JK/Wm^) Ah,, 160.6635 104.1454 75.3980 62.4168 54.5859 49.1949 34.7082 17.6024 12.8372 10.4271 8.7884 7.4774

1 /t

K p

Ki =
Kp*(l/x)

Ts

Q
(Watt)

%0.S. (%) 0 0 0 0 0 0 0 0 0 0 0 0

(W/JK)

(s')
0.1283 0.1979 0.2733 0.3302 0.3775 0.4189 0.5937 1.1707 1.6053 1.9763 2.3448 2.7559 0.4 0.4 0.4 0.275 0.275 0.275 0.225 0.2 0.2 0.175 0.175 0.175

(s)
0.5 0.5 0.5 0.6 0.6 0.6 0.7 0.7 0.7 0.8 0.8 1.2

61 0.01 0.02 0.03 0.04 0.05 0.1 0.3 0.5 0.7 0.9 1.1 95 131 158 181 201 284 561 769 947 1123 1320

0.051 0.079 0.109 0.091 0.10 0.115 0.134 0.234 0.321 0.346 0.410 0.482

0.25 0.38 0.53 0.64 0.73 0.81 1.15 2.27 3.12 3.84 4.55 5.4

Table 4.10: Simulation results with selected Kp and Ki at various flow rates

From Tables 4.8, 4.9, and 4.10, the following points are observed. (1) At the highest flow rate ( 1.1 Ib/s), the electrical power generator from the sensor circuit is saturated and hence the settling time remains the same regardless of the changes in the feedback control gains. This may due to the fact that such high flow rate is rarely encountered and the sensor is designed to measure flow rates lower than that. (2) From Table 4.8, it is apparent that when the same proportional gain (Kp=0.275) is applied to other higher flow rates, the settling times for lower flow rates are smaller than those for higher flow rates. This confirms that the gain (l/Ahoo) of the sensor probe is higher at lower flow rates than at higher flow rates and results in smaller settling time at lower flow rates than at higher flow rates. (3) The simulation results listed in Table 4.10 also indicate that airflow rates can be approximately categorized to four flow ranges as listed in Table 4.11. Airflow range 1 is when the electrical power Q consumption being less than 0.55 watt, and proportional gain, Kp =0.4, can be selected. Airflow range 2 is when Q being between 0.55 and 1 watt, and Kp can be chosen to be 0.275 in order to avoid overshoot. Similarly, airflow range 3 is when Q being between 1 and 3.5 watt, and Kp can be adjusted to be 0.2. Airflow range 4 is when the electrical power Q consumption beings larger than 3.50 watt, Kp can be chosen to be 0.175 to achieve zero overshoot yet reasonable settling time.

47

Flow rates (Ib/s) 0.0039 0.01 0.02 0.03 0.04 0.05 0.1 0.3 0.5 0.7 0.9 1.1

hoo

Sensor gain -i-(J K /W m b
Ahoo

1 /t

Kp

Ki = Kp*(l/x)

Ts

Q
(Watt)

%0.S. (%)

(W/JK)

(s-1)

(s)

61 95 131 158 181 201 284 561 769 947 1123 1320

160.6635 104.1454 75.3980 62.4168 54.5859 49.1949 34.7082 17.6024 12.8372 10.4271 8.7884 7.4774

0.1283 0.1979 0.2733 0.3302 0.3775 0.4189 0.5937 1.1707 1.6053 1.9763 2.3448 2.7559

0.4 0.4 0.4 0.275 0.275 0.275 0.2 0.2 0.2 0.175 0.175 0.175

0.051 0.079 0.109 0.091 0.10 0.115 0.119 0.234 0.321 0.346 0.410 0.482

0.5 0.5 0.5 0.6 0.6 0.6 0.7 0.7 0.7 0.8 0.8 1.2

0.25 0.385 0.53 0.64 0.73 0.81 1.15 2.27 3.12 3.84 4.55 5.4

0 0 0 0 0 0 0 0 0 0 0 0

Table 4.11: Selected KpS for adaptive gain switching control strategy

4.13 Simulation o f the Adaptively P I Controlled Sensor
A program is written in MATLAB code as shown in Appendix D to simulate and compare the speed of response of the fixed PI controlled sensor according to Fig. 3.2 and the adaptively PI controlled sensor according to Fig. 3.6. Simulation parameters are listed as follows: · Flow rates = [0.0039; 0.01; 0.02; 0.05; 0.1; 0.5; 0.9; 0.7; 0.3; 0.05; 0.01;0.0039] Ibs/s. · · · Simulation duration is 5 seconds per flow rate Power saturation is at 0 watt and 5.4 watt. Operating flow rates of the sensor are roughlycategorized intofour flow ranges according to previous simulation results listed in Table 4.11. The highest K; in a particular flow range is chosen for that flow range as shown in Table 4.12. in

Flow Range 1 2 3 4

Power (Q) watt 0<O <=0.55 0 .5 5 < O < = l 1 < 0 < = 3 .5 3.5 < 0 < = 5 .4

Kp 0.4 0.275 0.2 0.175

Ki 0.11 0.12 0.32 0.41

Table 4.12: PI control gains for various flow ranges

48

Fig. 4.4 compares sensor responses with adaptively switched PI control gains to those with fixed PI control gains that are set for high airflows. Enlargements of Fig. 4.4 at each flow step are shown in Figures 4.5-4.16.
Adaptive vs. fixed PI controlled sensors
· Adap t i ve g a i n s Fixed gai ns

5:

§
CL

20

30
T i me in s e c o n d

40

50

60

Fig. 4.4: Sensor responses at 12 flow steps

Referring to Fig. 4.4, both sensors start at maximum power to warm up and then output powers correspond to different flow rates. At the beginning the adaptively PI controlled sensor has a default PI gains the same as the fixed PI controlled sensor and then switches to the PI gains that corresponds to flow range 1 according to Table 4.12.
Adaptive vs. fixed PI controlled sensors
0.3 0.25
0. 2 · Adapt i ve g a i n s ''  F i x e d g a i n s

-

i

c
CL

0.05

0.5

1

1.5

2

2.5

3

3.5

4

4.5

Ti me in s e c o n d

Fig. 4.5: Sensor responses at flow rate = 0.0039 Ib/s

49

Referring to Fig. 4.5, power saturates at 0 watt, that is why there is a plateau at 0 watt in the responses and the gain switching portion of the adaptive sensor response (happened in the negative quadrant) is not shown. Fig. 4.5 shows that the adaptive gain switching sensor responds much faster than the sensor with fixed control gains. Adaptive gain switching sensor responds in 0.4s while the fixed gain sensor responds in 2.4s.
Adaptive vs. fixed PI controlled sensors
* -- Adapt i v e g a i n s Fi xe d g a i n s

0.4

I

0.35

o_

0.3

0.25

5

5.5

6

6.5

7

7.5

8

T i me in s e c o n d

Fig. 4.6: Sensor responses at flow rate = 0.01 Ib/s

Referring to Fig. 4.6, since 0.01 Ib/s remains in the low flow range, the PI control gains remain the same as the previous flow rate and there is no gain switching. With the PI gains suitable for low flow range, the adaptive gain switching sensor has a better performance (no overshoot) than the one with fixed gains that are suitable for high flow range. Similarly, Fig. 4.7 shows that the adaptive gain switching sensor has a better performance than the one with fixed gains. Referring to Fig. 4.8, flow rate at 0.05 Ib/s belongs to flow range 2 and the PI gains are switched firom those for flow range 1 to those for flow range 2 at where the discontinuity of the sensor response is. The control input (i.e. the power Q that the sensor measures) is a product of the control error (i.e. difference between the differential temperature and its set point) and the control gains, therefore switching control gains results in a sudden change of the control input that manifests as a discontinuity in the power measurement.

50

Adaptive vs. fixed PI controlled sensors
· Adap t i ve g a i n s Fi xed g a i n s

0.55

Î5
.C

0.5

£

0.45

0.4

9.5

10

10.5

11

11.5

12

12.5

13

T i me in s e c o n d

Fig. 4.7: Sensor responses at flow rate = 0.02 Ib/s

Adaptive vs. fixed PI controlled sensors
0.9 0.85 0.8 0.75
· Adapt i ve g a i n s Fi xed g a i n s

i

0.7 0.65

CL

0.6 0.55 0.5 0.45 14.5 15 15.5 16 16.5 17 17.5 18

T i me In s e c o n d

Fig. 4.8: Sensor responses at flow rate = 0.05 Ib/s

Referring to Fig. 4.9, flow rate 0.1 Ib/s belongs to flow range 3 and the PI gains are switched from that for flow range 2 to flow range 3 at where the discontinuity of the adaptively controlled sensor response is. Fig. 4.9 also shows that higher the flow rate, less speed improvement is indicated because the flxed PI gains are set for h i ^ flow rates. It is

51

observed that each time when the gains are switched, the sensor takes time to readjust to the new set of gains and hence responds slower than when there is no gain switching.
Adaptive vs, fixed PI controlled sensors
1.25
 Ad a pt i ve g a i n s Fixed gai ns

»

i

1.05

i

0.95 0.9 0.85 0.8 0.75 19.5 20 20.5 21 21.5 22 22.5 23
Ti me In s e c o n d

Fig. 4.9: Sensor responses at flow rate = 0.1 Ib/s

Referring to Fig. 4.10, flow rate 0.5 Ib/s also belongs to flow range 3 and there is no gain switching.
Adaptive vs. fixed PI controlled sensors
· Ada pt i ve g a i ns Fi x e d g a i n s

3.5

2.5

S.

24

25

26
T i me In s e c o n d

27

28

29

Fig. 4.10: Sensor responses at flow rate = 0.5 Ib/s

52

Referring to Fig. 4.11, flow rate 0.9 Ib/s belongs to flow range 4 and there is a gain switching fi*om flow range 3 to flow rang 4 at where the discontinuity is. From Fig. 4.11, it is observed that even at the highest flow range and with gain switching takes place, the adaptively controlled sensor maintains the same performance as the fixed gain sensor with its gains suitable for high flow rates.
Adaptive vs. fixed PI controlled sensors
·

4.8 4.6 4.4 4.2

Ada pt i ve g a i ns Fi xed g a i n s

.5
3.8
CL

i

3.6 3.4 3.2

29.5

30

30.5

31

31.5

32

32.5

33

33.5

34

34.5

Ti me in s e c o n d

Fig. 4.11; Sensor responses at flow rate = 0.9 Ib/s

Adaptive vs. fixed PI controlled sensors
· Ad a p t i v e g a i n s F i x e d g a i ns

4.8

4.6

.5
4.2
CL

I

4.4

3.8

3.6 34.5 35 35.5 36 36.5 37 37.5 38
T i m e In s e c o n d

Fig. 4.12: Sensor responses at flow rate = 0.7 Ib/s

53

Referring to Fig. 4.12, since flow rate 0.7 Ib/s is in the same flow range as flow rate
0.9 Ib/s, therefore there is no gain switching and the response of the adaptively controlled

sensor is more or less the same as that of the sensor with fixed control gains.
Adaptive vs. fixed PI controlled sensors
4.2
· Ad a p t i v e g a i n s ' " Fixed gains

3.8 3.6 3.4

: 3-2
0.

2.8 2.6 2.4 2.2 39.5 40 40.5; 41 41.5 42 42.5

Ti me in s e c o n d

Fig. 4.13; Sensor responses at flow rate = 0.3 Ib/s

Referring to Fig. 4.13, flow rate 0.3 Ib/s belongs to flow range 3 and there is a gain switching from flow range 4 to flow rang 3 at where the discontinuity is. Fig. 4.13 shows that at higher flow range and with gain switching takes place, the adaptively controlled sensor maintains the same performance as the fixed PI controlled sensor with its gains suitable for high flow rates.
Adaptive vs. fixed PI controlled sensors
2.4 2.2
· Ad a p t i ve g a i n s F i xe d g a i n s

I b I
0.8 0.6 0.4 44.5 45 45.5 46 46.5 47 47.5 48
T i me in s e c o n d

Fig. 4.14: Sensor responses at flow rate = 0.05 Ib/s

54

Referring to Fig. 4.14, flow rate 0.05 Ib/s belongs to flow range 2 so there is a gain switching fi'om flow range 3 to flow range 2. It is observed that in lower flow ranges (ranges 1 and 2), the adaptive PI controlled sensor responds faster than the flxed PI controlled sensor even when there is gain switching that the sensor takes time to readjust to the new gains.
Adaptive vs. fixed PI controlled sensors
· Ada pt i ve g a i n s Fi xe d g a i n s

0.9 0.8 I 0.7

" E 0.6 Q. 0.5 0.4 0.3 0.2 49.5 50 50.5 51 51.5 52 52.5 53 53.5

Ti me in s e c o n d

Fig. 4.15: Sensor responses at flow rate = 0.01 ib/s

Similarly when the flow rate changes firom 0.05 Ib/s (flow range 2) to 0.01 Ib/s (flow range 1) there is gain switching as well as speed improvement as shown in Fig. 4.15.
Adaptive vs. fixed PI controlled sensors
0.5 0.45
· Ada pt i ve g a i ns Fi xe d g a i n s

0.4

i
S

£

I

0.35

0.3

0.25 0.2 55 55.5 56 56.5 57 57.5

Ti me in s e c o n d

Fig. 4.16: Sensor responses at flow rate = 0.0039 Ib/s

55

As shown in Fig. 4.16, there is no gain switching when the flow rate changes within flow range 1 from 0.01 Ib/s to 0.0039 Ib/s and speed improvement is observed. Table 4.13 summarizes the simulation results observed from the figures shown above.
Flow rate W(lb/s) 0.0039 0.01 0.02 0.05
0.1

Power Q (watt) 0.25 0.38 0.53 0.81 1.15 3.12 4.55 3.84 2.27 0.81 0.38 0.25

Settling time for fixed PI sensor 2.4
1.8

Settling time for adaptive PI sensor 0.4 0.4 0.75 1.2 3.6 2.5 2.5 2.5 3.8 1.25 0.4

Gain switching (V) or not (x)

2.5 2.85 3.6 2.5 2.5 2.5 3.8 3.3 3.55 3.6

0.5 0.9 0.7 0.3 0.05 0.01 0.0039

Table 4.13: Summarized simulation results of the sensor systems

Simulation results show that the estimator of the adaptive gain switching controlled sensor system is able to predict steady state values of power corresponding to step input airflows and switch the PI control gains accordingly so as to achieve faster response at low airflow range than the original sensor with fixed control gains. The adaptively controlled sensor also maintains the speed of the original sensor at high flow ranges.

4.2

Simulation of Temperature Compensation
Temperature compensation error refers to the discrepancy of the expected constant

differential temperature between the sensor heated probe and the sensor reference probe as the ambient temperature changes. Typically, in the analog sensor circuits examined, the thermistors are incorporated into a Wheatstone bridge and the technique is assumed to compensate for changes in ambient temperature. This Wheatstone bridge technique works reasonably well for small changes in ambient temperatures. For large changes in ambient temperature this compensation technique is inadequate and large temperature compensation errors occur. For the sensor with the original analog circuit, inaccuracy due to temperature compensation error is common because the ambient temperature may change considerably in

56

an aerospace application. Since it is difficult to set up an experimental system to resemble the change of ambient temperature over a wide range, precision potentiometers are used to simulate the changes in ambient and heater temperatures. The subsequent two subsections simulate the temperature compensation error in the analog sensor circuit and the prototype digital sensor system. 4.2.1 Temperature Compensation Error in the Analog Sensor Circuit Simulation of the temperature compensation error of the Wheatstone bridge in the original analog sensor circuit is performed with the following procedures: 1. Replace the two sensor probes in the Wheatstone bridge of the analog sensor circuit with two precision potentiometers. 2. With a range of ambient temperature from -25 °C to 43.3 °C, dial in the resistance
(Rta)

corresponding to its temperature (T a) according to the sensor

manufacturer's data. 3. Tune the potentiometer that represents the sensor heated probe until the bridge is balanced and record the resistance value (Rth) of the potentiometer. 4. Convert the resistance value (Rth) of the potentiometer obtained in step 3 to temperature according to Eq. (2.2) - T,, =

Bo+B,-lnRTM+Bj-(InRTM)=

r·

5. Calculate the differential temperature (AT) by subtracting the ambient temperature (Ta) in step 1 from the heater temperature obtained in step 4.
6 . Compare the differential temperature obtained in step 5 to the expected

differential temperature set point ( 39.59 °C) in the original analog sensor circuit.

Simulation results show that the original analog circuit has a temperature compensation error o f-1.83 °C (-4.6%) and 5.07 "C (12.8%) when the ambient temperature is at 43.3 °C and -25 °C respectively. Instead of 39.59, AT changes from a low of 37.76 °C (39.59 °C -1.83 °C) to a high of 44.66 °C (39.59 °C + 5.07 °C) within the range of ambient temperature change from 43.3 °C to -25 °C.

57

The discrepancy of temperature compensation in the original analog sensor circuit is significantly large. This error is visualized in Fig. 4.17 by plotting the errors in differential temperature against the changes in ambient temperature.

6 5 4 3 2 1 0 -1

I

1

I

-20

-10

0

10

20

30

40

50

A m b i e n t t e m p e r a t u r e ( deg. C e l s i u s )

Fig. 4.17; Temperature compensation error of the Wheatstone bridge

4.2,2 Temperature Compensation Error in the Digital Sensor System
The prototype digital sensor system is tested for temperature compensation error with the following procedures: 1. Replace the two sensor probes in the signal conditioners of the prototype digital sensor interface with two precision potentiometers. 2. With a range of ambient temperature fi'om -25 °C to 43.3 °C, dial in the resistance
(R ta)

corresponding to its temperature

(T a )

according to the sensor

manufacturer's data to represent the sensor reference probe. 3. With a differential temperature (AT) of 39.59 °C, find the corresponding range of heated temperature (T h) firom 14.59 °C to 82.89 °C.
4 . Dial in the resistance (R th) corresponding to its temperature (T h) obtained in step

3 to represent the sensor heated probe. 5. With two analog channels, the 12-bit ADC of the prototype digital sensor interface reads the voltages corresponding to the two resistances, and sends them to the PC of the digital sensor system.
R ja

and

R th,

58

6 . The PC of the digital sensor system converts the received voltages in binary word

forms, A D C vta and ADCvTM, to their corresponding resistance values based on Eq. (2.29) ^TA - R `(
2" - l ·-- 1) ADC,V T A

and

Eq.

(2.30)

R th -- R · (

2 " -1 -- 1) respectively. R is a BKH resistor in the signal ADC,

conditioners and n = 12 for the 12-bit ADC of the prototype digital sensor interface. 7. The PC of the digital sensor system converts the resistance values,
R ta

and

R th,

obtained in step 6 to temperatures. T a and T h, according to Eq. (2 .2).
8 . The PC of the digital sensor system calculates the differential temperature (AT) by

subtracting the ambient temperature obtained in step 7.

(T a )

from the heater temperature

(T h)

9. Compare the differential temperature obtained in step 8 to its expected value, i.e. 39.59 °C.
0.35

Î 8
di

0.3

.9

Î

I I I

0.25

0.2

-30

-20

)

0

10

20

30

40

50

Am b i e n t t e m p e rature (d eg . C e l s i u s )

Fig. 4.18: Temperature compensation error of the digital sensor system

Fig. 4.18 is a plot of the simulation results for the temperature compensation error of the prototype digital sensor system. It shows that the differential temperature error is less than 0.35 "C and the differential temperature remains close to the set point 39.59 °C in a

59

range of ambient temperatures changing from -25 °C to 43.3 °C. Deviation is about 0.34 °C at the extreme end when the ambient temperature is at -25 °C.
· Digital AnsloQ

t

I
? 2
1 4;
· · ·

I

0

-1
-2

4 w
+ .....
-20 -10 0 10 20 30 Ambient temperature (deg. Celsius) 40 50

-30

Fig. 4.19: Comparison of temperature compensation errors

Fig. 4.19 compares the temperature compensation error occurred in the analog sensor circuit and that in the prototype digital sensor system by plotting Fig. 4.17 and Fig.4.18 in the same graph. These simulation results indicate that temperature compensation error occurred in the analog sensor circuit can be significantly reduced with the use of a digital system.

60

CHAPTER 5

EXPERIMENTS

Simulation results presented in Chapter 4 have demonstrated sensor speed improvement at low airflow rates and accuracy improvement in reducing the temperature compensation error in the analog sensor circuit. This chapter presents tests on a prototype digital sensor system and experiments to verify speed improvement of the adaptively controlled sensor over the sensor with its original analog circuit. Section 5.1 describes tests of the prototype digital sensor system. Section 5.2 presents the experimental set up, experiments and their results to verify the sensor speed improvement.

5.1

Tests of the Prototype Digital Sensor System
To ease program development, the prototype digital sensor system is composed of a

PC for program execution and a micro-controller based input/output (I/O) device that functions as an interface between the sensor head and the PC. Functions of the PC (Dell Platinum IV) include data communication and program execution. The micro-controller I/O device (or digital sensor interface) is to substitute the expensive data acquisition device used in the analog sensor system in the SCL. Its functions include analog-to-digital conversion, data communication, and pulse-width-modulated power generation. This digital sensor interface is fabricated according to the schematics shown in Appendix E. Based on examples and instructions from [46], programming of the PIC16C774 is done using the C language and the programs are documented in Appendix F. The program is compiled with the Custom Computer Services (CCS) Inc. C compiler and loaded into the PIC using the PicStart Pro. Integrated Development Environment (IDE) programmer. Subsection 5.1.1 describes the preliminary test set up with a primitive sensor for testing the prototype digital sensor system. Subsection 5.1.2 presents the preliminary tests and their results.

5.1.1 Preliminary Test Set Up With Primitive Sensor
Fig. 5.1 shows the preliminary test set up of airflow from an electric fan through a metal tubing and the primitive sensor that is made of two thermistors for temperature sensing and power resistors in series as a heater. The preliminary test set up, 5 inch long and 3 inch

61

wide, consists of a small electric fan mounted onto one end of the metal-tube to generate airflows. Change of airflow rates is obtained by changing the voltage supply to the electric fan. This set up provides a more steady airflow over a set up of airflow supply through an air compressor that subjects to pressure drop after air is discharged for a length of time.

Fig. 5.1: P relim inary test set up w ith the prim itive sensor

The primitive sensor is composed of two thermistors and three power resistors in series. One thermistor is glued to one of the power resistors with epoxy to measure the heater temperature. Another thermistor is closer to the airflow to measure the ambient temperature of the flowing air. The three power resistors in series are used as a heater. The two thermistors and the heater are connected to the digital sensor interface through a ribbon cable and a cormector. Communications between the digital sensor interface and the PC are executed in MATLAB code through the RS232 communication port with a baud rate of 9600. The adaptive gain switching control strategy is programmed in MATLAB code as shown in Appendix G.

62

5.1.2 Preliminary Tests and Results
In this subsection, accuracy of the internal ADCs of the micro-controller in the prototype digital sensor interface and the adaptive gain switching control algorithm are tested with the preliminary test set up and the primitive sensor described previously.

ADC accuracy test
To see the performance of ADCs with different resolutions, a 10-bit ADC of PIC16F876 presented in [47], 12-bit ADC of PIC16C774, and pseudol3-bit ADC of PIC16C774 in the prototype digital sensor interface are tested to compare their accuracy by injecting precision voltages into the ADC input and recording their resultant ADC values. The standard linear equation, y = mx + b, is applied to the test results to obtain a linear relationship between the ADC values and the input voltages where y represents the ADC values (ADCio for the 10-bit ADC values, ADC 12 for the 12-bit ADC values, and ADC 1 3 for the pseudo 13-bit ADC values), m the ratio of ADC value to input voltage, x the input voltage (V i,, ), and b the offset ADC value. Table 5.1 shows the equations governing the linear relationship of ADC values and input voltages for the 10-bit ADC, 12-bit ADC, and pseudo 13-bit ADC of the prototype digital sensor interface.
ADC resolution 10-bit 12-bit pseudo 13-bit Linear equation ADCio =198.76*Vin +1.4453 ADC12 =794.50*Vin - 3.4619 ADC13 =1588.10*Vin - 0.6178

Table 5.1: Linear relationship between ADC values and input voltages

From the test results, standard deviations from linear and their corresponding accuracy of the 10-bit ADC, 12-bit ADC and the pseudo 13-bit ADC are computed and shown in Table H.l in Appendix H where details of the ADC performance are recorded. Table H.l shows that the pseudo 13-bit ADC has the most resolution but the least accuracy. These test results indicate that the technique of band switching while increasing the resolution of the ADC comes at a cost of accuracy. Absolute accuracy of the ADC is crucial for the measurement of absolute temperature for the airflow sensor as the sensor depends upon maintaining a constant temperature differential over its operation range. According to Table H.l, the 12-bit ADC has higher resolution and accuracy among the three ADCs and is

63

more suitable for measuring temperature. Therefore the prototype digital sensor interface with the 12-bit ADC is chosen for experiments in this thesis. Adaptive gain switching control algorithm test The adaptive gain switching control algorithm is tested with the prototype digital sensor system using the preliminary test set up and the primitive sensor described above. Voltage supply to the electric fan to simulate airflow is fixed at 6.25 volts during the 5 trials of tests for each of the three ADCs mentioned above. Fig. 5.2 is a plot of the typical performance from the 5 sets of test results for the 10bit ADC, 12-bit ADC, and pseudo 13-bit ADC of the prototype digital sensor system. The test results are not averaged because of noise fluctuation. Test results of the adaptively controlled sensor system show that the adaptive gain switching control algorithm is able to switch the feedback control gains from the default ones that are suitable for high flow rates to those for low flow rates. It is noticed that discontinuity of the sensor output occurs (at about time = 30 seconds) when the gains are switched as shown in Fig. 5.2.
2 1.8
1. 6

13-bit ADC · 12-bit ADC - 4 -- 10-bit ADC

1.4
1.2

I

1 0. 8 0. 6 0. 4 20 30 40 60 50 Time in s e c o n d s 70 80 90

Fig. 5.2: T est results o f the adaptively controlled sensor

As indicated in Fig. 5.2, the sensor power measurement with the pseudo 13-bit ADC interface reflects the variations in the noise level. However, the power measurement with the 10-bit ADC sensor and that with the 12-bit ADC sensor are much smoother as compared to

64

the power measurement with the pseudo 13-bit ADC sensor. This lack of reflecting the detail in their measurement is due to the lower resolution of the 10-bit and 12-bit ADCs than the pseudo 13-bit ADC.

5.2

Experiments
The objective of this section is to verify with experiments that the prototype digital

sensor system responds faster than the original analog sensor system in the SCL. Subsection 5.2.1 presents the experimental set up. Subsection 5.2.2 verifies the sensor speed improvement with experiments and their results. 5.2.1 Experimental Set Up With A ircraft Sensor The sensor response is slow at low flow rates, the SCL set up for the aircraft engine bleed flow sharing control system is designed for experiments in the low flow range. The experimental set up consists of aircraft flow sensors mounted in a four-channel plastic test rig that simulates the bleed air sharing control system in aircraft. Fig. 5.3 shows a drawing of the experimental set up (171 inches by 30 inches) in the SCL. Fig. 5.4 is a photograph of the set up. The four two-inch diameter plastic pipes of the test rig represent the four bleed-air channels in aircraft.
171" Air Exit

Main Control Valve

30"

Main Manual Valve

/

g Air
<3>

Flow Sensor Proportional Control Valves

ED Pressure Transducer
0

Manual Control Valves

Fig. 5.3: Engine bleed flow sharing control test rig conflguration (Drawing not to scale)

65

Referring to Fig. 5.3, airflow enters the test-rig from a pressure tank through a main manual valve and a main control valve with a maximum pressure of 100 psig. This pressurized air is fed into the four pipes through control valves, passes through the pressure transducers and then the flow sensors, and exits through the other end of the test rig. Airflow rate is controlled by proportionally opening of the main manual valve and the main proportional control valve to allow various airflows pass through two flexible plastic airlines prior to entering the test rig. The four channels of the test rig can be operated individually, in any combinations of them, or all four of them by opening and/or closing the manual valves and control valves installed on the four channels. The flow rate can vary from 0.01 Ib/s to 0.05 Ib/s per channel.

Fig. 5.4: A photograph o f the en gin e bleed flow sharing control test rig

The aircraft flow sensors are installed into the test rig and tightly sealed to avoid air leakage. They are connected to the sensor circuits through unshielded cables and connectors. Signals extracted from the analog sensor circuits and the pressure transducers are sent to a

66

PC with a DAQ device. Current signals (4mA --20mA) to control the proportional control valves are sent from the DAQ device to open or close the control valves to their desired positions. The pressure transducers are used as an approximate frame of reference for flow measurement during experiments. Scaled P I control gains The PI control gains for different flow ranges shown in Table 4.14 need to be scaled to values according to the specifications of the prototype digital sensor system. Table 5.5 lists specifications of the prototype digital sensor system for scaling the PI control gains.

PWM resolution 10 bit

Max. power (Qmax) 3.68 watt

Sampling time (Tsam ) 0.125 second

Table 5.2: Specifications of the prototype digital sensor system

Maximum power of the prototype digital sensor system is designed to be much lower than that in the original analog sensor circuit because the sensor system in the SCL works on improvements in the low flow range. A lower maximum power in the prototype digital sensor system can also serve the purpose of reducing the risk of sensor probe bum out. Based on Table 5.2, proportional control gain (kp) and integral control gain (k;) for experiments can be scaled from those (Kp and K;) obtained in simulations with Eq. (5.1) and Eq. (5.2) respectively. (5.1)
^m ax

2 `° - l
k j -- K .J X

(5.2)

Table 4.14 is then scaled to be:

Flow Range 1 2 3 4

Approx. flow rates W(lb/s) W<=0.02 0.02<W<=0.05 0.05<W<=0.5 0.5<W<=0.9

Power (Q) watt 0<O <=0.55 0.55< 0< = 1 K O <=3.5 3 .5< 0< = 5.4

kp 111 76 56 49

ki 3.8 4.2 11 14

Table 5.3: Scaled PI control gains for different flow ranges

67

5.2.2 Experiments and Results
Initially, with the PI control gains scaled from the simulation results as a guide, experiments are conducted to determine by trial and error the appropriate PI control gains for the aircraft sensor that is used in the experiment. Subsequently, based on the experimental PI control gains found for different flow ranges for the aircraft sensor and applied to the adaptive gain switching control algorithm, experiments are conducted to demonstrate speed improvement.

Experimental P I control gains
The experimental set up in the SCL is for experiments at low flow range, therefore airflows can only be roughly categorized into three ranges in experiments instead of four ranges in simulations. By trial and error in numerous experiments carried out with channel #1 that has aircraft sensor #1, PI control gains for the low and medium flow range for the aircraft sensor used in the experiment are selected as shown in Table 5.4, Since the air supply of the experimental set up cannot reach a high flow rate, the PI control gains for the high flow range is estimated.
Flow Range low medium high approx. flow rates W(lb/s) W<=0.02 0.02<W<=0.05 0.05<W Power (Q) watt 0< = 1.3 1 .3 < 0 < = 2 2<0 100 80 50 4 5 6 kp ki

Table 5.4: Experimental PI control gains for different flow ranges

Compare Table 5.4 to Table 5.3, it is observed that the sensor power output that corresponds to a particular flow rate is much higher in experiments than in simulations. This implies that the numerical values of the sensor model must differ from those of the aircraft sensor used in the experiments. Due to proprietary reason, detail specifications of the aircraft sensor in the SCL is not provided and it is reasonable that the numerical values of the sensor model according to the author's judgment are somewhat different from that of the actual sensor.

Experiment specifications
Experiments are carried out with channel #1 that has aircraft sensor #1 connected to analog sensor circuit #1 compared to the prototype digital sensor system that uses the 12-bit
68

ADC. Change of airflows is achieved by sending electrical currents to open or close the main control valve and the control valve of channel #1 to different extents so as to let various airflows from the pressure tank to channel #1 of the test rig. The electrical current signal is from 4mA to 20mA to control a proportional control ball valve from fully close to fully open respectively. Throughout the subsequent 10 experiments (5 each for the analog and digital sensors) for this thesis work, the experimental settings are specified in Tables 5.5 and 5.6.

Main Manual valve Control valve Half open Vaiy from 6.5 to 9 mA

Channel #1 Fully open Half open (9.0mA)

Channel #2 Fully close Fully close (4mA)

Channel #3 Fully close Fully close (4mA)

Channel #4 Fully close Fully close (4mA)

Table 5.5: Settings of the valves during experiments

Time (t) in sec. I (mA) to main control valve

0<t<40 7.9

40<=t<80 8.3

80<=t<120 9.0

120<t<=160 6.5

160<t 4.0

Table 5.6: Currents to the main control valve

Experimental results Speed comparison between the analog and the digital sensors are carried out by conducting five trials of the same experiment each for the analog and the 12-bit ADC digital sensors. The control valves for supplying airflow are set to supply two airflows in low range, then one medium flow and terminates in a much lower flow according to the control currents listed in Table 5.6. A pressure sensor recording the upstream pressure of the flowing air is used as an approximate frame of reference throughout the experiments. Experimental results are shown below. Frame o f reference: air pressure Fig. 5.5 shows air supply pressures for the five trials of the same experiment for each of the analog and digital sensors. The control valves in the experimental set-up remains at the same setting throughout the experiments in order to supply the same airflow, but the pressures from the 10 trials of the same experiment still shows discrepancies among each other. This indicates that the

69

experimental set-up does not allow absolute accuracy comparison between the analog and digital sensors. It only provides an approximate reference of the airflow.
40 35 30 o) 25
Digital + - Analog

a.
S g) 20

£

I

15

20

40

60

80

100

120

140

160

T i m e in s e c o n d s

Fig. 5.5: Upstream pressures during sensor experiments

Enlargements of Fig. 5.5 at each flow step displaying the air pressures for the analog and digital sensor experiments are shown in Figures 5.6-5.9.
· Digital . Anal og

3.5

.Ç

I
2 1 2
2.5

·············* * « # # # *<

Q .

1.5

20

25

40

T i m e in s e c o n d s

Fig. 5.6: Enlarged diagram of air supply pressures for the 1*` flow step

70

13

12.5 12 11.5

· Digital f" -- Analog

O )

j?

11

I
10
9.5 9 8.5

rrr--

40

45

50

55

60

65

70

75

80

Time in seconds

Fig. 5.7: Enlarged diagram of air supply pressures for the 2" ** flow step

Digital Analog

w 32

75

80

85

90

95 100 105 Time In seconds

110

115

120

125

Fig. 5.8: Enlarged diagram of air supply pressures for the 3 * ^ * * flow step

71

0.35

·

Digital Analog

0.3

»
0.25

0.2

125

130

135

140 145 Time in seconds

150

155

160

Fig. 5.9: Enlarged diagram of air supply pressures for the 4"*flow step

Comparison o f sensor power measurement Fig. 5.10 shows the power measurement from the five trials of the same experiment for each of the analog and digital sensors.
Digital -- Anal og

4.5

3.5 i

r:
0.5 60
T i m e in s e c o n d s

100

120

140

160

Fig.5.10: Power measurement for the four flow steps during experiments

72

Enlargements of Fig. 5.10 at each flow step displaying the power measurement of the analog and digital sensors are shown in Figures 5.11-5.14.

2.4

·

Digital Anaiog

2.2 2

I
1.8 1.6

I

1.4
1.2

S.

1 0.8 0.6
_L _

10

15 20 25 Time in seconds

30

35

Fig. 5.11: Enlarged diagram of power measurement for the 1*` flow step

Digitai + - Analog

g 1.1

-1 - - - - - - - - - - - - - - - - - - - 1_ _ _ _ _ _ _ _ _ _ _ _ I_ _ _ _ _ _ _ _ _ _ _ _ 1_ _ _ _ _ _ _ _ _ _ _ I_ _ _ _ _ _ _ _ _ _ _ _ I_ _ _ _ _ _ _ _ _ _ _ _ I_ _ _ _ _ _ _ _ _ _ _ I_ _ _ _ _ _ _ _ _ _ _ _ L _

35

40

45

50

55 60 65 Time in seconds

70

75

80

Fig. 5.12: Enlarged diagram of power measurement for the 2" ** flow step

73

· Digital ---j-- ' Analog

·

75

80

85

90

95 100 105 Time in seconds

110

115

120

125

Fig. 5.13: Enlarged diagram of power measurement for the 3 * ^ * * flow step

1.6 1.4

I c

1.2

I
0.8

##
0.6
0.4 115 120 125 130 135 140 Time in seconds 145 150 155 160

Fig. 5.14: Enlarged diagram of power measurement for the

flow step

74

Digital sensor -- respondsfaster
From Fig. 5.10, it is obvious that the slope of response for the digital sensor is much steeper than that for the analog sensor and implies speed improvement. Control gain switching is observed at where the sensor power output signal is disturbed, namely at time approximately equals to 8 seconds, 87 seconds, and 125 seconds. This adaptively controlled strategy is particularly beneficial when the airflow remains in the same flow range after gain switching as indicated at time equals 40 seconds, the digital sensor takes about 3 seconds to reach its steady state while the analog sensor responds in about 15 seconds.

Gain switching -- slows down response
Switching gains somewhat slows down the sensor response as shown at time equals 80s when the control gains are switched from kp = 100, k; = 4, to kp = 80, k; = 5. The experimental set-up is designed for low airflow range; even the medium flow rate classified in the experiments for this thesis belongs to the low flow range. The digital sensor could have responded faster with the control gains for low flow range. However, the purpose of classifying this flow rate as medium is to demonstrate that the estimator of the adaptively controlled sensor is able to predict the steady state values of the airflow ahead of time and switch the control gains accordingly. As indicated in Fig. 5.8, airflow of 30-35 psig pressure experiences substantial pressure decline in a 40 second duration. increase of airflow to a h i^ e r range. This discourages the

Lower ADC resolution insensitive to pressure drop
--

Fig. 5.12 and Fig. 5.13 show that the analog sensor is able to capture the pressure drop in the air supply while the digital sensor is insensitive to its presence. This may be caused by the lower resolution (12-bit ADC resolution) of the digital sensor interface compared to the 16-bit ADC resolution of the data acquisition device that the analog circuit used to record data. Lower ADC resolution causing insensitivity to changes in noise level or disturbances is also seen in Fig. 5.2 during the preliminary tests of the prototype digital sensor system.

75

Differences in sensor power measurement Referring to Fig. 5.10, the power measurements by the digital sensor system are slightly higher than those of the analog one in all five trials. When the experimental results of the five trials are averaged, the air supply pressures for the four flow steps during digital s sensor experiments are 2.9% to 5.9% higher than those during the analog sensor experiments. The averaged power measurements of the digital sensor for the four flow steps are 5.1% to 7.8% higher than those of the analog one. The discrepancies in power measurement between the analog and digital sensors may have several causes: ( 1) the comparatively lower resolution of the 12-bit ADC digital sensor, (2) a smaller final steady state error (less than 1.3%) of the digital sensor system than that of the analog sensor system, and (3) the higher average airflow during experiments for the digital sensor. Each sensor circuit or interface has its own power offset. The power measurement difference between the two sensor systems can be eliminated after proper calibration of the sensor systems. Airflow measurement can be then obtained based on the calibrated sensor power measurement. Concluding remarks The experimental results shown above verify that the adaptive gain switching control strategy speeds up the sensor response by five times in a low flow range when there is no gain switching within the range. The differences in power measurement between the analog and the digital sensors may be caused by differences in: ADC resolution, final steady state error, and airflow.

76

CHAPTER 6 CONCLUSIONS AND FUTURE WORK 6.1 Conclusions
After a thorou^ control analysis is performed on the sensor system in the SCL based on the derived thermal dynamic model of the sensor, an adaptive gain switching control strategy is designed for sensor speed improvement. A digital sensor system is designed to implement the adaptive gain switching control strategy and to reduce the temperature compensation error that occurred in the Wheatstone bridge of the analog sensor circuit for accuracy improvement. By replacing the analog sensor circuit with a digital sensor interface and with the use of adaptive gain switching control algorithm, the speed of the sensor is improved about five times at low flow range as verified in the experiments, somewhat improved at medium flow range and maintains the same speed at high flow range as demonstrated in the simulation results. Simulation results also demonstrate that the temperature compensation error occurring in traditional flow meters that use a Wheatstone bridge can be significantly reduced with the use of a digital sensor system.

6.2

Future Work
The estimator of the adaptively controlled sensor designed in this thesis uses the

direct method for solving the normal equation. According to [48], this method is rarely used in practice due to the following reasons: (a) this matrix (R) may be singular and not invertible; (b) even if R is invertible, the input signal to the predictor varies, the entries of the autocorrelation matrix (R) of the input process then change fi'om time to time, the numerical precision for its inversion makes the filter implementation difficult both in hardware and software. More efficient ways such as the search techniques or the exact techniques to calculate the optimal tap-weight vector can be investigated. More work can be done to develop a predictor that can handle non-stationary signals with considerable speed and robustness. Further work is required to find the best model of different predictors for handling different types of signals based on derivation of mathematical models of signal and predictor.

77

With the digital sensor system, accuracy of the sensor can be further improved by having self-recalibration routines programmed in the computer to account for dirtaccumulation. Digital signal filter routines can be included to stabilize the system response.

78

APPENDIX A:

THERMISTORS

Thermistors are temperature-to-resistance transducing elements. They have the advantages of being inexpensive, small in size and providing a high output signal. Among the four basic shapes: rod, disc, flake, and bead, the thermistors used in the sensor probes being studied are fabricated in bead shape. According to [29], thermistor beads can vary with a wide range of bead-body (from 0.13 to 1.4 mm) and lead-diameter (from 0.018 to 0.1 mm) sizes. Their typical configuration is small, olive-like, and hermetically sealed in a glass body with two leads at one side or at the opposite sides of the body. Characteristics of the lead material are ( 1) having a high melting point to withstand sintering temperature, (2 ) having a coefficient of thermal expansion equal or close to that of the thermistor material, and (3) being chemically resistive, especially to oxidation during sintering. These characteristics require the use of noble elements or one of their alloys. When the beads are being fabricated, a slurry made of powdered oxides mixed with a dilute organic binder is applied to lead wires held in parallel, forming drops of the material resting on string. After the bead is dried and sintered, it is encapsulated in glass shell, and the string is cut to form individual elements. Beads without glass coating have limited application due to their unstable characteristics. When a thermistor is used as a special-purpose sensor, it is placed inside a housing such as a hypodermic needle, catheter, or sheath. The sensor under study has probes that are made of approximately 10% glass, 70% epoxy, and 20% aluminium by volume as shown in Fig. 2.2 and housed in a stainless steel sheath as shown in Fig. 2.1.

79

APPENDIX B:

SENSOR MODEL WITH CONSIDERATION OF FORCED CONVECTION AND CONDUCTION HEAT LOSS

According to [22,23], the dominant heat transfer from the heated probe to its surroundings is by forced convection. Conduction heat transfer (if it is significant enough to be considered) from the probe body to the sensor case is small when comparing to that by convection. Since heat loss by convection is much larger than heat loss by conduction, this enables the use of the lumped capacitance method. "The essence of the lumped capacitance method is the assumption that the temperature of the solid is spatially uniform at any instant during the transient process. This assumption implies that temperature gradients within the solid are negligible" [30]. Therefore it can be assumed that there is one lumped temperature
(Tc)

on the sensor case due to conduction heat transfer from the probe body to the sensor

case. To model the sensor heated probe, the only heat (Q) generated from the system is through the heater coil around the sensor heated probe, and Q = . Also assuming that

the heat loss through conduction to the sensor case is evenly distributed on the sensor case and is approximated by one temperature node, then the sensor heated probe model can be formulated as: Q - A h . .(T h - T J - K , .(T h - T J = m . c . - ^ K, *(Th - T , ) - K , ( T , - T J = m^ .c , dT
dT

where Q s electrical power input to the heater coil around the sensor probe, boo = convective heat transfer coefficient of the free stream air, Th = temperature of the heated probe, Tc = temperature on the sensor case, Tm = temperature of the free stream air, Ki = thermal conductance from the heated probe to the sensor case, K2 = thermal conductance (convection and conduction) from the sensor case to the surrounding air inside the pipe, A = surface area of the heated probe body exposed to airfiow.
80

m = equivalent mass of the composite material in the probe body,
0 = equivalent specific heat capacity of the composite material in the probe body,

m2 = mass of the sensor case, C 2 = specific heat capacity of the sensor case.

Eq. (B.l) can be rewritten in Laplace Transform with zero initial conditions as:
Q - A - h ,, . ( T H - T ,, ) - K , . ( T ,, - T , ) = m.c-s.TH

(B.2)

K, -(T,, - T J - K 2 ( T , - T J = m^ -C2 -s-T, where s = Laplace Transform operator.

Rearranging terms and putting in matrix form, the sensor equations become: K, Th" _ 1 IH2 *^2 *S+ Kj + K 2 K, m-C'S + A ' h ^ +Kj Jo. ~ a ' where A= m*C`S+ A * h ^ + K j -- Kj
2 2

"Q + A b . T / _ K 2 -T,, .

-- K .; m ·C ·s + Kj + K
2

A = [m-c-s + A ' h ,, +Ki ]- [m 2 -02 -s + K, + K 2] - K , A= me -s + l j - f £ ^ - s + l ) - ( A - h . + K , ) - ( K , + K , ) - K , ' \.A*h,, +K,

r
--K,

me ·s + 1 .s + 1 ( A- h ,, + K. ) . ( K, + K2 ) A ' h ,, +K, I k , +K2

/

me s +1 A*h,, +Kj
T, =

f K,+K2 me A.h,,+K, m 2 -C2 K, + K2 ·s+1 (A-h.+K,)-(K,+K,)

'

(B.3)

=

(B.4)

Characteristics such as peak time, rise time, settling time, and overshoot of a second order system can be found in the time domain of the function.

81

APPENDIX C:

DETERMINATION OF ADC RESOLUTION

The DAQ device used in the analog sensor system for reading temperatures of the sensor contains a multi channel 16-bit ADC with the following characteristics: According to [49], absolute Accuracy as % of reading = 0.0188 (over 1 year) and 0.0146 (over 24 hours). This means that a reading from the ADC of the DAQ device has an absolute accuracy over 1 year as follows:

Accuracy =

2'®-1 x 0.0188 = 12.32 100

(C.l)

An accuracy of 12.3 converts to an ADC reading of +/- 12 LSB. This +/- 12 LSB is approximately equal to 3.5-bit (2 = 11.3) +/- 1 LSB. That means the ADC with 16-bit

resolution actually has accuracy of 12.5-bit +/- 1 LSB (16-3.5=12.5). The DAQ device used in the analog sensor system has only, at the best, a 13-bit absolutely accurate ADC. Therefore an equivalent 13-bit ADC is needed in the ADC of the digital sensor system.

82

APPENDIX D:

SIMULATION PROGRAM

yo~/ovovo~/o~/ovovovo7o'7o~/ovovovo-/ovo-/o-/ovovovo~/ovovovovo~/ovovo-/ovovo/o/o/o/o/o /o /o /o /o /o /o /o /o /o /o /o /o /

% %This MATLAB program simulates and compares a sensor controlled by a PI control loop % %with and without the signal prediction algorithm to switch the PI control gains % %according to the predicted power required to coimterbalance the airflow rates
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

close all; clear all;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% %Define constants for the estimated physical properties of the sensor %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% r = 0.0015; Ls = 0.01; D = 0.0508; Vgl = 0.1; Vep = 0.7; Val = 0.2; pgl = 2225; pep = 1400; pal = 2702; cgl = 835; cep = 13; cal = 903; Pr = 0.71; pair =1.1614; Kf = 26.3*(10M); W/(m.K) u= 184.6*(10^-7); Rl=48.8; DTset = 39.59; sensor 1 Ao = 5*10^-4; Imax=l/3;
% area inside the pipe obstructed by the sensor body in m^2 % maximum current through the heater coil in the analog sensor circuit % viscosity of the flowing air in (N.s)/m^2 % resistance o f the heater coil in sensor 1 in ohms % differential temp set point between the heated probe and the reference probe for % radius o f the sensor probe in meter % length o f the sensor probe in meter % diameter o f the pipe in meter % ratio o f glass by volume in the sensor probe % ratio o f epoxy by volume in the sensor probe % ratio o f aluminium by volume in the sensor probe % density o f glass in kg/(m''3) % density of epoxy in kg/(m^3) % density o f aluminium in kg/(m^3) % specific heat capacity of glass in J/(kg.K) % specific heat capacity o f epoxys in J/(kg.K) % specific heat capacity of aluminium in J/(kg.K) % Prantl number % density o f the flowing air in kg/m'^3 % average thermal conductivity o f the flowing air @ cylinder temp and @ Tinf in

83

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Calculated constants from the estimated physical properties o f the sensor %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% d = 2*r; A = pi*d*Ls+pi*r^2; V = pi*(r^2)*Ls ; Ap = pi*(D/2)^2; A ef = Ap-Ao; mgl = pgl*Vgl*V; mep = pep*Vep*V; mal = pal*Val*V; m = mgl+mep+mal; c = cgl*(mgl/m)+cep*(mep/m)+cal*(mal/m); me = m*c; Qmax=Rl *Imax^2; % diameter o f the sensor probe in meter % surface area o f the sensor probe in (m^2) % volume o f the sensor probe in (m^3) % cross-sectional area o f the pipe % effective cross-sectional area o f the pipe % mass o f glass in the sensor probe (kg) % mass o f epoxy in the sensor probe (kg) % mass o f aluminium in the sensor probe (kg) % average mass o f the sensor probe % average specific heat capacity o f the sensor probe

% product o f mass and specific heat capacity o f sensor probe % maximum power o f the sensor circuit

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%Initialization

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
winsize=20; window = zeros(winsize-l,l); 11=0; 1=0; Tinf = 300; Thl=300; Th=300; Ql=Qmax; Q=Qmax; dth=0.01; Kpl=0.175; Kal=0.0; Kil=0.42; Kp=0.175; Ka=0.0; Ki=0.42; % window size for the predictor % initialization o f data i/p for time < 1

% initial integral control error for the sensor without predictor % initial integral control error for the sensor with predictor % initial temperature of the free stream air in degree Kelvin % initial heated temperature in degree Kelvin for sensor without predictor % initial heated temperature in degree Kelvin for sensor with predictor % initial power in watt for sensor without predictor % initial power in watt for sensor with predictor % integration step size % fixed proportional control gain for the sensor without predictor % initial anti-integral windup control gain for the sensor without predictor % fixed integral control gain for the sensor without predictor % initial proportional control gain for the sensor with predictor % initial anti-integral windup control gain for the sensor with predictor % initial integral control gain for the sensor with predictor

84

%% Generate flow rates
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

flow=[0.0039; 0.01; 0.02; 0.05; 0.1; 0.5; 0.9; 0.7; 0.3; 0.05; 0.01; 0.0039]; len=length(flow); data=1000; flow rate powerl= zeros(data*len,l); power= zeros(data*len,l); for g=l:len W=flow(g); kgw = W/2.2/Aef; Red = kgw*d/u;

% Flow rates in Ib/s % Length o f flow rates % Number o f iteration for each

% Initialize ou^ut array for the sensor without predictor % Initialize output array for the sensor with predictor % For loop to generate different flow rates % At each flow rate % Convert flow rates fl-om Ib/s to flow density in kg/s/sq m % Calculate Reynolds number

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %% Start Hilpert's Empirical Correlation Table to choose %% C and n based on the range o f Reynolds numbers %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% if(R ed > 0.4& R ed < 4) C=0.989; n=0.330; end if (Red>=4 & Red<40) C=0.911; n=0.385; end if (Red>=40 & Red<4000) C=0.683; n=0.466; end if (Red>=4000 & Red<40000) C=0.193; n=0.618; end if (Red>=40000 & Red<400000) C=0.0266; n=0.805; end

85

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %% End Hilpert's Empirical Correlation Table
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

h=(C*KC'd)*(Red^)*Pr^(l/3); tou=mc/(A*h);

% Calculate convective heat transfer coefficient % Calculate sensor time constant

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %% Start the For loop to simulate each iteration o f the PI control loop %% for the sensor without predictor %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% forjl=l:data dThl=(l/mc)*(Ql-A*h*(Thl-Tinf))*dth; Thl=Thl+dThl ; % integrating the heated temperature % update the heated temperature

DTl=Thl-Tinf; DTerrorl=DTset-DTl ; P l=DTerrorl *Kpl ; Il=Il+DTerrorl *Kal *dth; totalerrorl=P l+ Il ; Kal=Kil;

% differential temperature between heated probe and free stream air % difference in differential temperature and its set point % proportional control % integral control % total control % assign integral control gain

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %% Anti-windup control scheme: turn off integral control gain at power saturation %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% if (totalerrorl >=Qmax) Kal=0; totalerrorl=Qmax; end if (totalerrorl <=0) Kal=0; totalerrorl=0; end %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %% End o f Anti-windup control scheme %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% % lower bound on power saturation % turn off integral control gain % total control equals to lower bound % upper bound on power saturation % turn off integral control gain % total control equals to upper bound

86

Q l=totalerror 1; powerl((g-l)*data+jl)=totaIerrorl; errorl((g-l)*data+jl)=DTerrorl; end

% update power % data recording: record power % data recording: record diff in differential temp and its setpt

%end o f the for loop for each flow rate o f the sensor without predictor

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Start the For loop to simulate each iteration o f the PI control loop %% for the sensor with predictor %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% forj=l:data dTh=(l/mc)*(Q-A*h*(Th-Tinf))*dth; Th=Th+dTh; DT=Th-Tinf; DTerrot=DTset-DT ; P=DTerror*Kp; I=I+DTerror*Ka*dth; totalerror=P+I; Ka=Ki; % integrating the heated temperature % update the heated temperature % differential temperature between heated probe and free stream air % difference in differential temperature and its set point % proportional control % integral control % total control % assign integral control gain

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %% Anti-windup control scheme: turn off integral control gain at power saturation %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% if (totalerror >=Qmax) Ka=0; totalerror=Qmax; end if (totalerror <=0) Ka=0; totalerror=0; end %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %% End o f Anti-windup control scheme %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Q=totalerror; power((g-l)*data+j)=totalerror; error((g-1)*data+j)=DTerror; % update power % data recording: record power % data recording: record diff in differential temp and its set pt % lower bound on power saturation % turn off integral control gain % total control equals to lower bound % upper bound on power saturation % turn off integral control gain % total control equals to upper bound

87

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Predictor starts here %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% x=[window;Q]; window=x(2;winsize); for N=7 % assign input process to the predictor % define window size for the predictor % filter order = 7

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Obtain the autocorrelation (X) for lag 1 and autocorrelation (v) o f the input process x %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% L=length(x); X=convmtx(x,N); n=N+l:L-l; X=X(n,:); v=x(n+l); a=X\v; % autocorrelation o f input process for lag 1 % autocorrelation o f input process % calculated tap weight % length o f the input process x

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %% Calculate the predicted values, 50 samples ahead o f the input process x %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% y=x; for kr=l:50 new_x=a'*y(L:-l :L-N+1); y=[y;new_x]; L=L+1; end %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %% Use slope o f the predicted values approaching zero as a criterion for the sensor %% reaching steady state, and switch control gains according to the predicted power %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% slope=(y(L)-y(L-2))/2; if (abs(slope) < 0.001) Qy((g-l)*data+j)=y(L); % record predicted power data

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %% Switch PI control gains according to the predicted values o f the electrical power %% that counterbalances the airflow passing around the sensor %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

88

if (y(L) >0) & (y(L) <= 0.55) Kp=0.4; Ki=0.1; end if (y(L) >0.55) & (y(L) <= I) Kp=0.275; Ki=0.12; end if (y(L) >1) & (y(L) <= 3.5) Kp=0.2; Ki=0.32; end

% Flow range 1: lowest flow % higher Kp % lower Ki

% Flow range 2: medium flow 1

% Flow range 3: medium flow 2

if (y(L) > 3.5)& (y(L) <= Qmax) % Flow range 4: high flow Kp=0.175; Ki=0.42; end end %end of the if loop for checking steady state condition % lower Kp % higher Ki

end end end

%end o f the for loop for the predictor %end o f the for loop for each flow rate of the sensor with predictor %end of the for loop for different flow rates

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%% Plotting simulation results in graphs %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% figure plot (power,'r.') hold on plot (powerl,`b-') title (`Adaptive vs. fixed PI controlled sensors') xlabel(`Time in seconds') ylabel('Power Q in watt') legend (`Adaptive gains', `Fixed gains')

89

APPENDIX E:

SCHEMATIC DIAGRAM OF THE PROTOTYPE DIGITAL SENSOR INTERFACE
ru

tit
8 0

fO u

93

L3

023

20

DOS

S«

E3 -- |I'

nj

90

APPENDIX F:

C PROGRAMS FOR THE PROTOTYPE DIGITAL SENSOR INTERFACE

iiiilliilliiiiiililiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiliiiiiiiiiliiiiiiiiiiiiiiiiiiiiiiliiiiiiiiiiiiiiiiliiilliiiiiiiliiiiiiilliiiiiiiiiiiiiii HU Digital I/O Interface for Airflow Sensor: IIII Upon receiving a RS-232 value for a 10 bit PWM, the PIC reads two analog channels IIII and send these data back to the host PC. The process then repeats

////
//// *** The ADC is 12 bits ***

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////Define device (chip) specification//// #ifdefined(_PC M _J #include <16c774.h> #DEVICE picl6c774 ADC=12 #fuses HS,NOWDT,NOPROTECT,NOBROWNOUT #use delay(clocl^20000000) #use rs232(baud=9600, xmit=PIN_C6, rcv=PIN_C7, BRGHIOK) #endif

////Include other necessary header files//// #include <stdlib.h> #include <ctype.h> #include <stdio.h>

////The main program starts here//// mainO {

////Declaration o f variables//// long int duty; long vO,vl,temp; char s[8]; v0 = 0; v l = 0;

////Configure PWM, timer, analog ports, and adc//// setup ccp 1(CCP_PWM); // Configure CCPl as a PWM

91

setup_timer_2(T2_DIV_BY_16,2 5 4 ,1); setup_adc_ports(ALL_ANALOG); setup_adc(ADC_CLOCK_DIV_32);

// Configure timer // Configure analog ports // Configure ADC

set_pwml_duty(0); while(TRUE) {

// Initially no power to heater coil // The while loop starts

// Wait for PWM value and program PWM gets(s); temp=atof(s); Duty = (long int)temp; set_pwml_duty(Duty); // Read PWM value from com port o f PC // Store the PWM value (floating point) in temp // Convert the floating pt value to integer // Assign this integer value to PWM

// Read analog channels 0 & 1 set_adc_channel( 0 ); delay_us(200); vO=read_adcO; delay_us(100); // Set channel 0 for analog signal // Delay 200 us // Read analog voltage to channel 0 // Delay 100 us

set_adc_channel( 1 ); delay_us(200); vl=read_adcO; delayus(lOO);

// Set channel 1 for analog signal // Delay 200 us // Read analog voltage to channel 1 // Delay 100 us

delay ms(lO);

// Delay for 10 ms

printf("%041u,%041u\r",v0,vl); // Send the voltage signals in unsigned long integers to com port o f PC

}

// End o f the while loop // End o f main program

92

Illlllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll
//// Digital I/O Interface for Airflow Sensor: //// Upon recieving a RS-232 value for a 10 bit PWM, the PIC reads two analog channels //// and send these data back to the host PC. The process then repeats

////
//// The ADC is 12 bits but the Vref for the ADC is split over the full Vss and Vdd supply //// to give a pseudo 13 bit ADC.

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////Define device (chip) specification//// #ifdefinedC_PCM _) #include <16c774.h> #DEVICE picl6c774 ADC=12 #fuses HS,NOWDT,NOPROTECT,NOBROWNOUT #use delay(clock=20000000) #use rs232(baud=9600, xmit=PIN_C6, rcv=PIN_C7, BRGHIOK) #endif

////Include other necessary header files//// //#include <float.h> //#include <math.h> #include <stdlib.h> #include <ctype.h> #include <stdio.h>

////The main program starts here//// mainO {

////Declaration o f variables//// long int duty; long vO,vl,vh,va,temp; char s[8]; vO = 0; v l = 0;

////Configure PWM, timer, and adc////

93

setupccp 1(CCP_PWM) ; setupJimer_2(T2_DIV_BY_16,254,1); setup_adc(ADC_CLOCK_DIV_32);

// Configure CCPl as a PWM // Configure timer // Configure ADC

set_pwml_duty(0); while(TRUE) {

// Initially no power to heater coil // The while loop starts

// Wait for PWM value and program PWM

gets(s); temp=atof(s); Duty = (long int)temp; set_pwml_duty(Duty);

// Read PWM value from com port o f PC // Store the PWM value (floating point) in temp // Convert the floating point value to integer // Assign this integer value to PWM

// Read analog channel 0 setup_adc_ports(ALL_ANALOG); set_adc_channel( 0 ); delay_us(200); vO=read_adcO; // Configure analog ports // Set channel 0 for analog signal // Delay 200 us // Read analog voltage to channel 0

// Decide which band the input is if (vO <=2047) { // Switch Vref to lower band and take new ADC reading // Set Vref for lower band

setup_adc_ports(ALL_ANALOG | VSS_VREF); delayus(lOO); set_adc_channel( 0 ); delay_us(200); vh=read_adcO; }

// Delay 100 us // Set channel 0 for analog signal // Delay 200 us // Read analog voltage to channel 0 // End o f if-loop for lower band

if (vO > 2047) {

// Switch Vref to upper band and take new ADC reading // Set Vref for upper band

setup_adc_ports(ALL_ANALOG | VREF VDD); delay_us(l 00); set_adc_channel( 0 ); delay_us(200); vh=read_adcO; vh = vh + 4096;

// Delay 100 us // Set channel 0 for analog signal // Delay 200 us // Read analog voltage to channel 0 // Adjust ADC values in upper band

94

}
// Read analog channel 1 setup_adc_ports(ALL_ANALOG); set_adc_channel( 1 ); delay_us(200); vl=read_adcO;

// End of if-loop for upper band

// Configme analog ports // Set channel 1 for analog signal // Delay 200 us // Read analog voltage to channel 1

// Decide which band the input is if (vl <=2047) { // Switch Vref to lower band and take new ADC reading // Set Vref for lower band

setup_adc_ports(ALL_ANALOG | VSSVREF); delay_us(100); set_adc_channel( 1 ); delay_us(200); va=read_adcO; }

//D elay 100 us // Set channel 1 for analog signal // Delay 200 us // Read analog voltage to channel 1 // End o f if-loop for lower band

if (vl > 2047) {

// Switch Vref to upper band and take new ADC reading // Set Vref for upper band

setup_adc__ports(ALL_ANALOG | VREF_VDD); delay_us(100); set_adc_channel( 1 ); delay_us(200); va=read_adcO; va = va + 4096;

// Delay 100 us // Set channel 1 for analog signal // Delay 200 us // Read analog voltage to channel 1 // Adjust ADC values in upper band // End o f if-loop for upper band

}
delay_ms(5); printf("%041u,%041u\r",vh,va); PC

// Delay for 5 ms // Send the voltage signals in unsigned long integers to com port of

// End o f the while loop

// End o f main program

95

APPENDIX G:

MATLAB PROGRAM FOR SENSOR EXPERIMENT

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%% Experiment MATLAB program for adaptively controlled sensor
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

close all; clear all;

%%% Define Constants and Initialization Qmax = (13.4^2)/48.8; PWMmax = (2''10)-1; ADC13 = 2^13-1; ADC13offset = 0.6178; ADC12 = 2^12-1;; ADC12ofrset = 3.4619; ADC10 = 2^10-1;; ADC10offset= 1.4453; BO = 0.00111464560924 31 = 0.00026009820241 B2 = 0.00000014291453 %B0 = 0.00128442622958 %B1 = 0.00023629604076 %B2 = 0.00000009246480 DTset = 39.59; Kp = 50; Ki = 6; 1 = 0; Ka = 0; dth = 0; % Maximum power = (V across Rh)'^2 / Rh % Maximum duty cycle o f a 10-bit PWM heater driver % 13-bit ADC % 13-bit ADC correction % 12-bit ADC % 12-bit ADC correction % 10-bit ADC % 10-bit ADC correction % SH coef. o f aircraft sensor % SH coef. o f aircraft sensor

% SH coef. of aircraft sensor
% SH coef. of primitive sensor % SH coef. o f primitive sensor % SH coef. o f primitive sensor % Differential temperature set point in degree Kelvin % Initial Proportional feedback control gain % Initial Integral feedback control gain % Initial Integral value % Initial Integral windup control gain % Integral step size

m = 1400; Q = zeros(l,m); err = zeros(l,m); DTerrorold = 0.0; winsize = 20;

% # o f iterations % Initialize power output storage % Initialize DT error storage % Initialize DT error for trapezoidal rule % Define window size for predictor

96

window = zeros(winsize-l,l);

%Initialization of data i/p for time < 1

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Communication with serial port in PC

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% s = serial('comr)
fopen(s) % Configure the serial port % Open the configured port for use

PWM = 0; t = 0;

% Assign initial PWM duty cycle % Initialize timing counter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% For-loop to execute sensor control %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% fo r i= l:m tic; t = t+dth; if(t>160) PWM = 0; end % Start counting program execution time % Accumulate program execution time % When time >160 second, airflow stops % So stop heating the sensor by sending 0 PWM

^rintf(s,'%4.2f\r',PWM) pause(0.01) Hascii = fi"ead(s,5,'uchar'); Aascii = firead(s,5,'uchar'); H = zeros(5,l); A = zeros(5,l);

% send out PWM value tosensor interface % wait for 0.01s % receive voltage signal representing heater temperature fi-om interface % receive voltage signal representing ambient temperature fi-om interface % clear storage for voltage signal representing heater temperature % clear storage for voltage signal representing ambient temperature

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%% % Convert both voltage signals representing temperatures firom ASCII to numbers %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% forj = 1:5 H 0,l) = Hasciia,l)-48; A0M) = AasciiG,l)-48; end VTh = 1000*H(l,l)+100*H(2,l)+10*H(3,l)+H(4,l)+ADC12ofiset; VTa = 1000*A(l,l)+100*A(2,l)+10*A(3,l)+A(4,l)+ADC12ofiset;

97

%%%% Convert voltage signals in binary words to resistances
RTh = (ADC12Arrh-l)*3000;
RTa = (ADC12/VTa-l)*3000;

%%%% Convert resistances to temperatures Th = l/(B0+Bl*log(RTh)+B2*(log(RTh))^3); Ta = l/(B0+Bl*log(RTa)+B2*(log(RTa))^3);

%%%% Check synchronization o f transmits and receive if (Th < 263) I (Th > 433) |(Ta < 223) | (Ta > 393) Q)rintf('Waming: Lost Synchronization! Close port, delete and clear Buffer!'); fclose(s) delete(s) clears end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% %% PI control loop starts here

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
DT = Th-Ta; ; DTerror = DTset-DT; DTerrorave = (DTerrorfDTerrorold)/2; % Differential temperature between heated probe and reference probe % Difference in differential temperature and its set point % Apply trapezoidal rule for integral control

%%%% Set upper and lower bound error limits for integral control if (abs(DTerrorave) <= 0.0001) DTerrorave = 0.0; end if (DTerrorave > 0.0001) DTerrorave = DTerrorave-0.0001; end if (DTerrorave < -0.0001) DTerrorave = DTerrorave+0.0001; end

P = DTerror*Kp;

% Proportional control

98

I = I+DTerrorave*Ka*dth;

% Integral control

totalerror = P+I;

% Total control

Ka = Ki;

% Assign integral control gain

%% Integral anti-windup control scheme: turn off integral control gain at power saturation %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%% if (totalerror >= PWMmax) Ka = 0; totalerror = PWMmax; end if (totalerror <= 0) Ka = 0; totalerror = 0; end % lower bound on power saturation % turn off integral control gain % total control equals to lower bound % upper bound on power saturation % turn off integral control gain % total control equals to upper bound

DTerrorold = DTerror; PWM = totalerror;

% Update difference in differential temperature for integral control % PWM duty cycle equals to total control % Compute sensor output in electrical power % Record sensor output in power % Record difference in differential temperature

power = (totalerror*Qmax)/PWMmax; Q(i) = power; err(i) = DTerror;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Predictor starts here %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% x=[window;power]; window=x(2:winsize); for N=7 % assign input process to the predictor % define window size for the predictor % filter order = 7

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Obtain the autocorrelation (X) for lag 1 and autocorrelation (v) o f the input process x

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
L = length(x); X = convmtx(x,N); n = N+l:L-l; X = X(n,:); % autocorrelation o f input process for lag 1 % length o f the input process x

99

V=

x(n+1) ;

% autocorrelation o f input process % calculated tap weight

a = X\v;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Calculate the predicted values, 50 samples ahead o f the input process x %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% y = x; for k = 1:50 new_x = a'*y(L:-l:L-N+l); y = [y;new_x]; L = L+1; end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Use slope o f the predicted values approaching zero as a criterion for the sensor %% reaching steady state, and switch control gains according to the predicted power %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% slope = (y(L)-y(L-2))/2; if (abs(slope) < 0.001) Qy(i) = y(L); % record predicted power data

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Switch PI control gains according to the predicted values o f the electrical power %% that counterbalances the airflow passing around the sensor %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% if (y(L) >0) & (y(L) <= 1.3) Kp = 100 Ki = 4; end if (y(L) >1.3) & (y(L) <= 2.0) Kp = 80 Ki = 5; end if (y(L) > 2.0) Kp=50 Ki = 6; end %Control gains for high flow range %Control gains for medium flow range %Control gains for low flow range

100

end end

% End of the if loop for checking steady state condition % End of the for loop for the predictor

dth=toc;

% Program execution time for 1 iteration stops here

end

% End of for i=l :m loop

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Save data in data files
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% save('fancyl2Q5VQ',-ASCII') save('fancyl2Qy5','Qy','-ASCII') save('fancyl2err5','err','-ASCII') %Save control power data % Save predicted power data % Save differential temperature difference data

fclose(s)

% Close the port after each exp.

101

APPENDIX H:

PERFORMANCE OF ADCS IN THE DIGITAL SENSOR INTERFACE

The performance of a measuring instrument depends on three factors: namely its repeatability, resolution, and accuracy. Repeatability of a measuring instrument tells how well the instrument can measure the same quantity with the same setting at different times. Resolution of a measuring instrument governs how fine a quantity the instrument can measure. Accuracy of a measuring instrument governs how close the measured value is to the actual value. The accuracy of a measuring instrument is usually seen as to how much the instrument value deviates firom the measurand. For repeatability, both the 10-bit ADC and 12-bit ADC can measure the same voltage within 0 to 5 volts under the same conditions of measurement and in successive measurements to +/- 1 LSB while the pseudo 13-bit ADC can measure to +/- 2 LSB. The supply voltage for the ADC of the digital sensor interface is 5V. Regarding resolution, a 10-bit ADC can read to 5 mV (i.e. 5V/1023=0.00489V), a 12-bit ADC to 1 mV (i.e. 5V/4095=0.00122 V), and a 13-bit ADC to 0.6 mV (i.e. 5V/8191=0.00061V). Accuracy of the ADCs is calculated based on the test results of how much each ADC deviates fi-om the linear relationship it is expected to measure. Regarding accuracy, the 10-bit ADC can read to +/- 1.4 mV (i.e. +!- 0.29 *0.00489V = 0.00142 V), the 12-bit ADC to +!ImV (i.e. +/- 0.78 * 0.00122 V = 0.000952 V), the 13-bit ADC to 2.3 mV (i.e. +/- 3.78 * 0.00061 V = 0.0023 V). Test results of accuracy of the three ADCs are summarized in Table H.l.

ADC resolution 10-bit 12-bit Pseudo 13-bit

Standard deviation 0.29 0.78 3.78

Accuracy (+/- LSB) OLSB ILSB 4 LSB

Accuracy (+/- mV) 1.4 1 2.3

Table H.1: Test results of ADC accuracy

102

REFERENCES
[1] J. Marek and M. Illing, "Microsystems for the Automotive Industry," International Electron Devices Meeting (lEDM) Technical Digest, pp. 3-8,2000. [2] J. Gallant, "Thermal Mass-flow Transducers: Sensors Offer Fast Response Times," EDN, pp. 55-68, May 25,1989. [3] C. Lyons, A. Friedberger, W. Welser, G. Muller, G. Krotz, and R. Kassing, "A High speed Mass Flow Sensor with Heated Silicon Carbide Bridges," The Eleventh Annual International Workshop on Micro Electro Mechanical Systems (MEMS) 98. Proceedings, pç. 356-360,199%. [4] H.J. Verhoeven and J.H. Huijsing, "An Integrated Gas Flow Sensor With High Sensitivity, Low Response Time and a Pulse Rate Output," Sensors and Actuators, A41&42, pp. 217-220. [5] F. Mayer, O. Paul, and H. Baltes, "Influence of Design Geometry and Packaging on ' the Response of Thermal CMOS Flow Sensors," Tech. Digest o f Transducers '95, Euro-sensors IX, Stockholm, VI, pp.528-531, 1995. [6] B.W. van Odheusden, "Silicon Thermal Flow Sensors," Sensors and Actuators, A 30, pp. 5-26,1992. [7] M. Esashi, "Micro Flow Sensor and Integrated Magnetic Oxygen Sensor Using It," Solid-State Sensors and Actuators, pp. 34-37, 1991. [8] M. Esashi, S. Eoh, T. Matsuo, and S. Choi, "The Fabrication of Integrated Mass Flow Controller," Tech. Digest o f Transducers '87, pp.830-833,1987. [9] K. Kawahata, A. Nakano, and M. Esashi, "Integrated Thermal Mass Flow Controller Using Normally Close Microvalves," Tech. Digest o f the 141-144,1989. [10] R.G. Johnson and R.E. Higashi, "A Highly Sensitive Silicon Chip Microtransducer for Air Flow and Differential Pressure Sensing Applications," Sensors and Actuators, vol. 11, pp. 63-72, 1987. [11] K. Petersen, J. Brown and W. Renken, "High-Precision, High-Performance MassFlow Sensor with Integrated Laminar Flow Micro-Channels," Tech. Digest o f Transducers '85, pp. 361-363, 1985. Sensor Symposium, pp.

103

[12]

K.S. Betts, "Mass Flow Sensors: Measuring up to New Applications," Mechanical Engineering, vol. 112, pp. 72-75, May 1990.

[13]

P. Bradshaw, "Thermal methods of flow measurement," J. Phys. E: Set Instrum., series 2 vol. 1, pp. 504-5099,1968.

[14]

I.S. Miller, D.A. Shah, and R.A. Antonia, "A constant temperature hot-wire anemometer," /. Phys. E: Sci. Instrum. Vol. 20, pp. 311-314,1987.

[15]

A. Abel-Rahman, C. Tropea, P. Slawson, and A. Strong, "On Temperature Compensation in Hot-wire Anemometry," J. Phys. E: Sci. Instrum., vol. 20, pp. 315319, 1987.

[16]

K. Okamoto, T. Ohhashi, M. Asakura, and K. Watanabe, "A Digital Anemometer," IEEE Transactions on Instrumentation and Measurement, vol. 43, pp. 116-120, April 1994.

[17]

I.M. Katz, and E.J. Shaughnessy, "Digital Temperature Compensation of a Thermistor Flowmeter," /. Phys. E: Sci. Instrum. Vol. 20, pp. 561-564, 1987.

[18]

F.J. Bartos, "Tame Flow Disturbances with This Thermal Mass Flowmeter," Control Engineering,^^. 142-143, September 1995.

[19]

A.E. Widmer, R. Fehlmann, and W. Rehwald, "A Calibration System for Calorimetric Mass Flow Devices," J. Phys. E: Sci. Instrum. Vol. 15, pp. 213-220, 1982.

[20]

G.F.A. Hoffinann de Visme and H. Singh, "Analysis of the Thermal Flowmeter Operating from a Pulsed-heat Injection Source," J. Phys. E: Sci. Instrum., vol. 5, pp. 885-888, 1972.

[21]

E. Yoon and K.D. Wise, "An integrated Mass Flow Sensor with On-chip CMOS Interface Circuitry," IEEE Transactions on Electron Devices, Vol. 39, No. 6, pp. 1376-1386, June 1992.

[22]

K.D. Wise, "Integrated Sensors: Key to future VLSI systems" (invited), Proc. 6`^ Sensor Symp. (Japan), pp. 1-9, 1986.

[23]

K.D. Wise, "AVLSI Circuit Challenges for Integrated Sensing Systems" (invited). Dig. 1990 IEEE Symp. On VLSI Circuits (Honolulu), pp. 19-22, June 1990.

[24]

C. Perreault, "Going With the Flow," Process Industries Canada, pp. 30-34, Nov. 1989.

104

[25]

P. Lilley, D.H. Wame, B.A. Mordecai, and A.J. Spencer, "The Use of Electronic Prediction to Achieve Fast Response From a Simple Thermal Mass Flow Meter," J. Phys. E: Sci. Instrum., vol. 8, pp. 3-5,1975.

[26]

R. Jha and C. He, "Neural-Network-Based Adaptive Predictive Control for Vibration Suppression of Smart Structures," Smart Materials and Structures Vol. 11, pp.909916, 2002.

[27]

M.E. Greene and V.S. Trent, "A Predictive Rollover Sensor," Society o f Automotive Engineers (SAE ) 2002 Automotive Dynamics & Stability Conference and Exhibition, May 2002.

[28]

M.J. Grimble and P. Martin, "Adaptive Predictive Control With Controllers of restricted Structure," Fifteenth International Symposium on Mathematical Theory o f Networks and Systems, August 2002.

[29]

A.D. Khazan, Transducers and Their Elements. Prentice Hall, Inc. Englewood Cliffs, NJ, 1994.

[30] ' F.P. Incropera and D.P. DeWitt, Introduction to Heat Transfer John Wiley & Sons, 1996. [31]

ED.). New York:

F.R. Sousa, R.C.S. Freire, G.S. Deep, E.K. Melcher, and I.S.S. Silva, "Response Time Evaluation of Constant Temperature Circuits," IEEE Instrumentation and Measurement Technology Conference, Anchorage, AK, EUA, May 2002.

[32]

A. Oliveira, R.C.S. Freire, G.S. Deep, and P.C. Lobo, "An Anemometer with PWM Excitation," in Proceedings o f the International Conference o f Industrial Electronics, Control andInstrumentation-IECON'95, pp. 893-897, October 1998.

[33]

J.D. Jr. Anderson, Fundamentals o f Aerodynamics (2"^ Ed.). New York: McGraw Hill, 1991.

[34]

J.E. Slotine and W. Li, Applied Nonlinear Control. New Jersey: Pearson Education, 1991.

[35] [36] [37]

N.S. Nise, Control Systems Engineering (3*^ ED.). New York: Wiley, 2000. M.R. Driel, Linear Control Systems Engineering. McGraw Hill, 1996. "Lab #2: PI Controller Design with Integral Anti-Windup Scheme," EE462 Control Systems for Computer Engineers, Department of Electrical and Computer Engineering, The University of Alberta.

105

[38]

D.G. Manolakis, V.K. Ingle, S. Kogan, and S.M. Kogan, Statistical and Adaptive Signal Processing: Spectral Estimation, Signal Modeling, Adaptive Filtering and Array Processing. McGraw Hill Science/Engineering/Math, 1999.

[39]

B. Farhang-Boroujeny, Adaptive Filters: Theory and Applications. New York: John Wiley & Sons, 1998.

[40]

J. G. Proakis and D. G. Manolakis, Digital Signal Processing (3''^ ED.). New Jersey: Prentice Hall, 1996.

[41]

N. Halyo, D.D. Moerder, J.R. Broussard, and D.B. Taylor, "A Variable-Gain Output Feedback Control Design Methodology," National Aeronautics and Space Administration Contractor Report 4226, 1989.

[42]

Z. Zhao, M. Tomizuka, and S. Isaka, "Fuzzy Gain Scheduling of PID Controllers," IEEE Transactions on Systems, Man, and Cybernetics, Vol. 23 No. 5, pp.1392-1398, Sep./Oct. 1993.

[43]

M. Predko, Programming and Customizing the PIC Microcontroller. McGraw Hill, 1998.

[44]

"PIC16C77X."

MICROCHIP.

1999.

Microchip

Technology

Inc.

<www.microchip.com>. [45] "+5V-Powered, Multichannel RS-232 Drivers/Receivers." MAXIM. Rev.l0;8/01. Maxim Integrated Products, <www.maxim-ic.com>. [46] [47] J. lovine, PIC Microcontroller Project Book. New York: McGraw Hill, 2000. F. Yiu and G. Liu, "Intelligent Digital Thermal Flow Sensor," IEEE Sensors, Toronto, pp. 1225-1230, Oct. 2003. [48] S. Krishnan, "Adaptive Signal Processing Lecture Notes," Ryerson University, Feb. 2003. [49] National Instruments, DAQ 6034E/6035E User Manual (July 1999 Edition). National Instruments Corporation, 1999.

106

