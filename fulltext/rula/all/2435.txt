NOTE TO USERS

This reproduction is the best copy available.

®

UMI
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

MOBILITY MANAGEMENT ERAMEWORK EOF LOCAL MOBILITY
by

BRYAN HARTWELL
Bachelor of Engineering, Ryerson University Toronto, 2004

A thesis presented to Ryerson University in partial fulfillment of the . requirement for the degree of M asters o f Applied Science in the Program o f Computer Networks

Toronto, Ontario, Canada 2004 © Bryan Hartwell, 2004

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

UMI Number: EC52956

INFORMATION TO USERS

The quality of this reproduction is dependent upon the quality of the copy submitted. Broken or indistinct print, colored or poor quality illustrations and photographs, print bleed-through, substandard margins, and improper alignm ent can adversely affect reproduction. In the unlikely event that the author did not send a complete manuscript and there are missing pages, these v\/ili be noted. Also, if unauthorized copyright material had to be removed, a note will indicate the deletion.

UMI
UMI Microform EC52956 C opyright 2008 by ProQuest LLG. All rights reserved. This microform edition is protected against unauthorized copying under Title 17, United States Code. ProQuest LLC 789 E. Eisenhower Parkway PC Box 1346 Ann Arbor, Ml 48106-1346

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Borrower's Page
Ryerson University requires the signatures of all persons using or photocopying this thesis. Please sign below, and give address and date. > r

m

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Abstract
M obility M anagem ent Framework for Local Mobility, Bryan Hartwell, M .A.Sc, C om puter N etw orks, Ryerson University, Toronto 2004. IP mobility solutions allow mobile nodes to roam whUe retaining connectivity to the internet. However, as these solutions evolve, mobile node implementations continue to undergo modification. Since mobile nodes represent hundreds o f thousands of hosts worldwide, deploying new mobility protocols will become expensive. The main objective o f this project was to design a framework that decouples the mobile node from route repair, which reduces the implementation and deployment time o f new solutions. The proposed framework reengineers existing IP mobility protocols in order to facilitate the transition for network administrators. The second objective o f the project was to provide a prototype o f the framework to gain acceptance for our design within the Internet community. The result o f this work is a mobility management framework that not only reduces the effects of deployment, but also provides a standard interface to the mobile node.

IV

Reproduced with permission of the oopyright owner. Further reproduction prohibited without permission.

Acknowledgements
I would acknowledge Dr. Jaseemuddin and Dr. M a for introducing and guiding me through the world of com puter networks and mobility. I also acknowledge the Go-Core project team for maintaining, and continuing to develop, the publicly available Mobile IP fo r Lim a.

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Contents
Chapter 1 Introduction ................................................................................................................................... I 1.1 M obility S olutions............................................................................................................................2 1.2 IP M obility Protocols.......................... 3 1.3 M otivation and Overview the Fram ew ork D esig n ....................................................................4 1.4 C ontributions......................................................................................................................................6 1.5 S um m ary.............................................................................................................................................7 Chapter 2 M obility S o lu tio n s...................................................................................................................... 9 2.1 Tunnels and C are-of A ddresses................................................................................................... 10 2.2 Mobile I P .......................................................................................................................................... 11 2.3 Hierarchical M obile I P .................................................................................................................. 14 2.4 M ulticast-based M o b ility .............................................................................................................. 16 2.5 Fast M obile I P ................................................................................................................................. 18 2.6 H A W A H ...........................................................................................................................................20 2.7 C eU ularlP........................................................................................................................................ 21 2.8 Sum m ary...........................................................................................................................................22 Chapter 3 M obility M anagem ent Fram ew ork........................................................................................23 3.1 Fram ew ork D esig n ......................................................................................................................... 24 3.2 Location M anagem ent...................................................................................................................25 3.3 M ovement Detection - Domain A dvertisem ents.................................................................... 26 3.4 H andover...........................................................................................................................................27 3.5 Domain F la g s .................................................................................................................................. 29 3.6 R egistration...................................................................................................................................... 31 3.7 Route Repair-.....................................................................................................................................31 3.8 M obile Node O peration................................................................................................................ 33 3.9 Foreign Agent O peration.............................................................................................................. 36 3.10 Fast H andovers................................................................................................................................ 38 3.11 S ecu rity ............................................................................................................................................. 40 3.12 Reference Design: Route Repair for H M IP v 6......................................................................... 40 3.13 Reference Design: Route Repair for M ulticast-based M obility........................................... 43 3.14 S um m ary...........................................................................................................................................45 C hapter 4 The Im plem entation..................................................................................................................47 4.1 N eighbour D iscovery..................................................................................................................... 48 4.2 M obile IPv6 for L in u x ...................................................................................................................49 4.3 The M obile N ode...................................................................................................................... 56 4 .4 The Foreign A gent.......................................................................................................................... 60 4.5 Fast H andovers................................................................................................................................ 63 4.6 Test C ase...........................................................................................................................................64 4.7 S um m ary........................................................................................................................................... 65

vr

Reproduced with permission o f the copyright owner. Further reproduction prohibited without permission.

Chapter 5 Concluding Remarks ...................................................................................................... 67 Appendix A ...................................................................................................................................................... 69 B ibliography..................................................................................................................................................... 97

vu

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

List of Figures
Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure Figure 1-1: Routes to the M obile N o d e ........................................................................................................ 2 1-2: M obility P rocesses........................................................................................................................ 6 2-1: Tunnels and C are-of A d d ress................................................................................................... 11 2-2: Correspondent N o d es................................................................................................................. 14 2-3: Hierarchical M obile IP ...............................................................................................................15 2-4: A Simple M ulticast N etw ork.................................................................................................... 17 2-5: M ulticast-based M o b ility .......................................................................................................... 18 2-6: Fast M obile I P ............................................................................................................................. 19 3-1: Elem ents o f R egistration .................................................................................... 24 3-2: The Fram ew ork M o d e l............................................................................................................. 28 3-3: Types o f C are-of A d d re ss........................................................................................................ 30 3-4: Registration State D iag ram ...................................................................................................... 33 3-5: FM IP Control F lo w .................................................................................................................... 39 3-6: PIMIP Control F lo w ................................................................................................................... 42 3-7: M &M C ontrol F lo w ................................................................................................................... 44 4-1: Configuration for r a d v d ............................................................................................................49 4-2: Enabling M ovem ent D etection................................................................................................ 50 4-3: M ovem ent D etection.................................................................................................................. 50 4-4: M obile N ode Binding E n try .....................................................................................................51 4-5: H andoff Process.......................................................................................................................... 53 4-6: Registering M obility P ro to co l................................................................................................. 55 4-7: Binding Liaison Process........................................... 56 4-8: M odular D ecom position o f M obility A g en ts.......................................................................57 4-9: M odified R outer S tra c tu re ....................................................................................................... 58 4-10: Local R egistration Binding E n try....................................................................................... 61 4-11: Local R egistration.................................................................................................................... 62 4-12: Test C a se .................................................................................................................................... 64

viii

i

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Chapter 1

Introduction

IP mobility solutions hide the mobility o f a host from upper layer applications. H osts that experience mobility are referred to as mobile nodes, and are tightly coupled to the IP mobility solution. There are currently several alternative mobihty solutions within the IP suite though a mobile node will be associated with only one. The purpose o f this thesis is to design and implement a Mobility M anagem ent Fram ew ork that hides the operation o f the local IP mobility solution from that o f the mobile node. This report describes the purpose and operation o f that Framework. To achieve this, this docum ent is structured as follows: Chapter 1 provides an overview o f why a fram ework m ust be developed, as well as an overview o f the actual mobility management fram ew ork proposed by the author. C hapter 2 is a literature review o f existing mobility solutions, including proposed standards as well as works in progress (i.e. internet drafts). It provides a technical explanation o f existing mobility solutions. Chapter 3 describes the design o f our proposed Fram ew ork in detail.. C hapter 4 explains our implementation o f the Fram ew ork by describing some key software modules, and also discusses the test case. W e also included the handover protocol as an internet draft in Appendix A, which we intend to submit for standardization. Section 1.1 provides an explanation o f what a Mobility Solution is. An overview o f how IP Mobility Solutions w ork is given in Section 1.2, and an explanation also is given for why a fram ework needs to be developed for these protocols. Section 1.3 gives a simple overview o f the Mobility M anagem ent Framework.

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

1.1 Mobility Solutions
In IP, every host is uniquely identified by (at least) one unicast IP address that is used as a node ID and locati' c. ID. H osts are connected to, as well as located by, routers. As such the router m ust know o f all the hosts that are directly connected to it. If a ro u ter receives an IP datagram w hose destination is not on one o f its interfaces, then the router m ust know o f the next immediate ro u ter along the best path to that host. The ro u te r learns o f this p ath through IP routing protocols, such as O SPF [2]. Yet this would requhe every ro u ter know ing the p ath to every unicast address; the address space o f IPv4 is 2'^", w hile IPv6 is significantly bigger. Instead h o st' form subnets that share a com m on address prefix. T hus routers need only know the prefix o f a subnet, rather than the address o f every host within th at subnet. Figure 1-1 (a) illustrates the path a packet follows from a correspondent node to the host using the m ethod described above.

Host

Router

10.0.10.0/24

10.0.20.0/24

10.0.10.0/24

10.0.20.0/24

.50
0.0.10.50

a) IP S u b n e t Routing
Figure 1-1: Routes to the M obile Node

b) Mobile IP

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

H ow ever, consider a host that can move to new subnets while in use. Using prefix-based routing this "mobile node" faces one o f two problems; 1. Change its IP address to reflect the current subnet's prefix, which terminates all o f its existing connections. Furtherm ore, other hosts will be unable to initiate contact with the mobile node w ithout being informed o f its new address. 2. Keep its current IP address. Packets bound for the mobile node will be delivered to the w rong subnet, and dropped upon arrival. A mobility solution is a means o f directing packets to the mobile node's current point o f connection. While mobility solutions occur in a wide variety o f designs, the Internet Engineering Task Force (IETF) has adopted IP mobility solutions. These mobility protocols are similar to routing protocols by allowing specific routers to know where the mobile node is using IP addresses. They are the foundation for the M obility M anagem ent Fram ew ork, and in the remainder o f this docum ent the term "mobility solution" refers to these protocols.

1.2 IP Mobility Protocols
While a number o f protocols are currently under development within the IP mobility suite, the current defacto standard is M obile IP (M IP) [3] [4]. The basic premise o f M obile IP is that a mobile node maintains two IP addresses: a home address and a care-of address. Mapping one address to the other is referred to as Route Repair.

1,2.1 Route Repair
The mobile node uses its home address as a source address in all o f its correspondence. This is a normal unicast address, such that when the mobile node is "hom e" packets can be delivered to it without the need o f a mobility protocol. N ote that correspondent nodes sending packets to the mobile node will direct them to the home address, whether or not the mobile node is physically there to receive them. W hen the mobile node moves it acquires a care-of address. This is an IP address that allows the mobile node to be located in its current subnet. The mobile node sends this address to a router on its home subnet, called a home agent. While the mobile node is roaming, the hom e agent will encapsulate all IP datagram s bound to the mobile node and send it to the care-of address. This form o f IP-in-IP is referred to as tunneling; the encapsulated IP datagram allows the mobile node to preserve its higher-layer connections. The path this tunnel enables is displayed in Figure l- l( b ). Every time the mobile node moves it registers a new care-of address with the hom e agent, who repairs the route to the mobile node by mapping the care-of address to the home address.

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

1.2.2 Transient Route Repair
It is also w o rth noting that when a mobile node moves, which is called a handover, there is a period during which it is unreachable. This is due to two reasons, the first being that it takes a certain am ount o f time to establish a physical association at the new link, how ever during this tim e the m obile node is com pletely unreachaLe. The second reason is that packets wiU continue to be delivered to the mobile n o d e's previous point o f connection until it successfully registers w ith the hom e agent. This registration initiates a primitive form o f route repair as discussed above; the p ath to the mobile node is updated to reflect its new point o f connection. Due to th e handover latency the mobile node is unable to receive or send packets. H ow ever there is a sub-category o f mobility solutions called Fast H andovers that attem pt to reduce this latency. They do this by providing transient routes local to the mobile node until it has com pleted registering its new care-o f address. These routes are called transient because they have very short lifetimes and cannot be refreshed.

1.2.3 The Mobile Node
A n im portant distinction betw een routing and mobility protocols is that only the form er is transparent to the end node. T hat is, the host (fixed or mobile) is unaw are o f w hether the local netw ork uses OSPF, EIG R P, or some other protocol for route distribution. H ow ever mobile nodes must be involved in the mobility solution. Furtherm ore, if the mobile node does not support the same mobility protocol as its current point o f attachm ent, it is the same as having no mobility solution at all. It is the mobile node's responsibility to detect when it has moved. As such it also the mobile n o d e's responsibility to register its care-o f address(es) to instigate route repair. Thus with each new m ethod o f mobihty, it is the mobile node's responsibility to initiate dialogue w ith any new node-types defined therein. The significance o f this is that deploying a new (mobility) protocol, or simply changing any .part o f that process, w ould involve upgrading not only routers but also all o f the dependent hosts. This would be costly, as well as deny service to end users until they can upgrade. Som e vendors may even implement mobility in hardw are, and these nodes would becom e obsolete. This results in the need for a process that minimizes changes to the mobile node.

1.3 Motivation and Overview the Framework Design
In the previous section we have introduced three actions that must occur to achieve mobihty; handover, registration and route repah. H owever, current mobihty protocols make little to no distinction betw een these processes. As a consequence mobile nodes are tightly coupled with the

Reproduced with permission o f the copyright owner. Further reproduction prohibited without permission.

netw ork to an extent that it is involved in the route rep ah process, which is exclusively a netw ork activity controlled, optim ized and deployed at the discretion o f the wireless operators. T he above processes and their roles in IP mobility can be illustrated through an IP mobihty m odel as shown in Figure 1.2. If w e w ere to limit ourselves to current practice, this m odel w ould appear as a single block as show n in Figure 1.2(a). To achieve flexibihty o f deploying and developing route repair process independent to mobile nodes we need to design a fram ework that decouples the mobile node from the rest o f the system. We can achieve this by providing the mobile node with a standard interface. Thus the operation o f the processes on either side o f the interface remains transparent to the other. This allows the mobile node to participate on the control path w ithout having to be cognizant o f how the forwarding path is established. Som e m obility so lutions create hierarchies of reg istratio n to reduce the overall reg istratio n latency. H ow ever the m obile n o d e is aw are of the entfre hierarchy. T hus th e process of reg istratio n rem ains w ith in a single "layer", along wdth the obstacle of dep lo y in g n ew solutions. Figure 1.2(b) shows the proposed Framework. It structures M obile IP into three major processes: · · · H andover Registration R o u te Repair.

M obile IP may refer to the entire process as a handover. H ow ever it may also strictly refer to the handover event, i.e. when the mobile node changes its point o f connection to a new access router and perform s auto-configuration to establish connectivity on that link. This requires the mobile node to acquire a new care-of address which it must register with the appropriate mobihty agents. In M IPv6, to register w ith th e hom e ag en t th e m obile n o d e m u s t sen d a Binding U pdate. T hus n o d es th a t participate in the registration process w ith in the fram ew ork are referred to as b ind in g agents. This distinction is necessary because th e fram ew o rk 's access ro u ter is a b in d in g ag en t in b o th IPv4 an d IPv6, b u t it is a h m n el-en d p o in t only in IPv4. T he R egistration mechanism processes this request from the mobile node. W e further refine registration into H om e and Local Registration, as well as Fast Handovers. The significance of

Reproduced with permission of the copyright owner, fu rth e r reproduction prohibited without permission.

Handover

Registration

Home Registration Macro Route Repair

Local Registration Local Route Repair

Fast Handover

a)

U n s tr u c tu r e d M ob ile IP

b) Mobility M a n a g e m e n t Framework

Figure 1-2: M obility Processes

these individual processes wiU becom e apparent in the following chapters. Registration typically results in the act o f route repah. R oute repair is the establishment o f a forw arding path to the mobile node. Im provem ents upon M obile IP typically revolve around refining the route repair process. Thus relegating route repair to a separate activity eliminates the need to update the mobile node every time a new m ethod o f route repah is devised. As such, rather than dictate the design o f this process, the fram ework reserves a place for route repair within the model but leaves its operation open to the requhem ents o f the netw ork administrator. From Figure 1.2(b) w e can see that R oute Repair can be modified w ithout affecting the H andover. This decoupling is deshable since R oute Repair roughly corresponds to a few routers, while H andover may represent many mobile nodes. This segregation o f processes achieves the objective of the framework.

1.4 Contributions
The problem statem ent was identified and the outline o f the fram ework is provided by [1]. In this thesis w e present the detail design o f the M obility M anagem ent Fram ew ork to address this problem , which the Fram ew ork accomplishes by decoupling the mobile node from route repair. As such the mobile node would receive upkeep only directly necessary to its function. This design includes mobile node and foreign agent operation. In this fram ew ork w e focus on local mobility management and use M obile IP for global mobility across multiple domains. W e also produced two reference designs by modifying existing IP mobility solutions to operate within the Framework. The second im portant contribution made in this thesis is a prototype implementation o f the Fram ew ork in order to verify the success o f the design. This would allow other researchers to

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

test the properties o f the Framework. Tow ards this end the author has produced code for the mobile node, as well as the Local Registration protocol supported by the Foreign Agent. Using a simulation of the R oute Repair API, the Framework operation was verified.

1.5 Summary
After each handoff a mobile node must register a care-of address with its home agent in order to continue receiving packets. The home agent intercepts packets bound for the home address and tunnel's the packet to the care-of address. In current mobility solutions, the mobile node is tightly coupled with the domain solution. If they are not compatible, the mobile node will not be able to receive packets while away from its home subnet. Since the mobile node must also be modified to implement a new protocol, deploying more efficient solutions is time consuming and costly, if not altogether impossible. The framework serves to make the domain solution transparent to the mobile node by separating the mobile node from the route repair process. This approach allows new domain solutions to be easily deployed.

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Chapter 2

Mobility Solutions

This chapter provides a conceptual understanding of existing mobility solutions. The purpose of this is two-fold; · · To understand the need for a management framework The framework must be able to support the needs o f existing and future solutions.

Every mobility solution uses a care-of address to "tunnel" the IP packet to the mobile node. Section 2.1 explains what these two terms mean, while the following sections focus on how individual mobility solutions register the care-of address with the home agent. Section 2.2 starts with basic Mobile IP. This section describes both MIPv4 and MIPv6 since concepts are drawn from both proposed standards. However we are only interested in a Mobility M anagement Framework for IPv6, therefore the rest of this document focuses on concepts and terminology used in IPv6. Sections 2.3 to 2.5 refer to works in progress; these are solutions that are meant to either w ork with, or replace, Mobile IP. Hierarchical Mobile IP and M ulticast-based Mobility both use Local Registration, but in very different manners. Fast Mobile IP works with Layer 2 to hide handover latency. The remaining two sections discuss IP mobility based solutions that are not currently 'supported by the Internet Engineering Task Force (IETF). Though the type o f services they provide are not distinct from those described in the preceding sections, they dem onstrate the diversity of mobility solutions.' Since this chapter is a literature review o f IP mobihty protocols, readers who are familiar with this subject may wish to proceed to Chapter 3.

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

2.1 Tunnels and Care-of Addresses
Every host has a regular IP (home) address that is globally rentable and to which all its correspondents direct their packets, including mobile nodes. The problem occurs when a mobile node connects to a new subnet that uses a different network prefix from that o f its home subnet. To get aiound this the mobile node acqukes a care-of address (CoA) that has a netw ork prefix appropriate for that subnet. This address is then stored on a router, known as the home agent, that is located on the mobile node's home network. The home agent will intercept any packets destined for the mobile node's home address and forward them to the mobile node's care-of address. This process is known as tunneling; the IP packet from the home agent to the mobile node's care-of address contains the original unaltered IP packet as data, complete with the original header. This is the basic premise behind all mobility solutions. While there are several different "types" of care-of addresses, the & st two were introduced by MIPv4: « Co-located C are-of Address: A unique, globally routable, address assigned to the mobile node. · Care-of Address: A globally routable address assigned to one o f the Foreign A gent's interfaces. Figure 2 - 1 depicts tunnels for their respective care-of addresses. Recall that the IP packet for the mobile node is carried within the IP packet to the care-of address. When the mobile node uses a co-located care-of address the tunnel exits directly at the mobile node. If a care-of address is used, the tunnel exits at the foreign agent; the foreign agent must then deliver the packet to the mobile node. The foreign agent is a n o d e found only in IPv4 m obility solutions. It is an access ro u ter located on the su b n et th at the mobile node is visiting. It participates in registration an d m ay serve as a tunnel end-point. MIPv6 does n o t use foreign agents, although they are reintroduced by the fram ew ork for IPv6. The different types o f care-of addresses (CoA) may be referred to simply as a care-of address, such as in M IPv6 which uses only co-located care-of addresses. Readers must remain aware of the context in which they view the term, least they misunderstand how the address is being used.

10

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Home Agent

Home Agent

Foreign Agent

Foreign Agent

Mobile Node
n) Care-of Address

Mobile Node
b) Co-located Care-of Address

Figure 2-1: Tunnels and Care-of Address

The only significant difference between mobility solutions is how the care-of address is registered with the home agent, and the type o f address that is registered. The remaining sections discuss various mobility protocols.

2.2 Mobile IP
The first proposed standtu'd to address mobility was Mobile IPv4 [3]. The current standard is in ·fact the fourth RFC for that protocol; the first having been proposed almost 10 years ago, and with yet another revision being developed. A standard for IPv6 [4] is also currently in progress, and was recently accepted for the experimental phase.

2.2.1 MIPv4
Recall that a co-located care-of address is a unique address assigned to the mobile node, and packets are delivered directly to the mobile node via that care-of address. H owever in IPv4 the address space is hmited; a wireless access network which may expect a high volume of visiting nodes may not be able to provide a unique, globally routable, address to every mobile node. If a single node could intercept packets for several local mobile nodes, then the address space could be preserved. Tlris node is called the foreign agent. The Foreign Agent is a router on the subnet that the mobile node is visiting. It will serve as a tunnel end-point for all mobile nodes on that subnet. That is, the mobile node wiU use an IP address o f the foreign agent itself as its CoA. Any packets destined for the mobile node will be

11

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

delivered to the Foreign Agent, who inspects the internal IP header and delivers it directly to the M obile Node. A co-located CoA is acquired through statefuU address configuration, such as DHCP [5]. T he CoA is acquired from the Router Advertisement [6]. R outer Advertisements are ICM P messages that are periodically broadcast over the subnet; they contain extra information about which node is the acting router on that subnet. In M IPv4 these messages are caUed Agent Advertisements because the ICM P message also contains a Mobility Agent Advertisement optif n This option defines whether the agent is a home or foreign agent, the maximum lifetime a requested registration could be valid for, whether registration is required, and some other useful values. This option will also contain one, or more, (care-of) addresses supported by the router. The mobile node also uses these advertisements to detect the fact that it has moved. If it receives an Agent Advertisement from a new router, then the mobile node must register a new CoA with the home agent. Since the foreign agent may detunnel packets for a CoA, the mobile node wiU first send its Registration Request to the foreign agent. If there is anything wrong with the request, the foreign agent will immediately deny the request; otherwise the foreign agent appends some additional information and passes the request to the home agent. The home agent also determines whether the request is acceptable and returns a reply to the foreign agent. The foreign agent will also examine the response from the home agent, and if it does not satisfy the foreign agent's requii'ements, it will send a negative Registration Reply to the mobile node. The mobile node can only resume communication using its new CoA after it has received a positive registration reply. If the mobile node uses its previous CoA then replies will be delivered to its old point o f connection, and not to the mobile node. If the new CoA was rejected then replies would reach a similar dead-end. Recall that a co-located CoA terminates directly at the mobile node. Thus the registration request for this address can be sent straight to the home agent, bypassing the foreign agent. However the foreign agent can dems^.d that the mobile node "register" with the foreign agent. This allows the foreign agent to exercise security and flow control on the subnet.

2.2.2 l\AIPv6
The primary difference between M IPv4 and MIPv6 is that the latter eliminates foreign agents. This is because in IPv6 the address space is virtually boundless, every mobile node can have one or more co-located Co As without affecting the available address space. In fact the mobile node can automatically create a CoA based upon the netw ork prefix and its L2 address with a neghgible chance of address collision. This method o f address configuration is known as "stateful address autoconfiguration". Typically a CoA is formed based upon a 64-bit netw ork prefix and a hash of the mobile node's MAC address. Since there is some possibility of address

12

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

collision, the mobile node must perform Duplicate Address D etection (DAD) to confirm that it's chosen CoA is valid. The mobile node acquires this prefix during Neighbour Discovery [7], This is the IPv6 version o f R outer Advertisements (RA). Routers broadcast these for movement detection and address autoconfiguration. The router advertisements are slightly modified to include a few extra flags, such as whether the advertised node can act as a home agent. Otherwise the "foreign agent" is not involved in the M IPv6 registration process, and as such these nodes are referred to as access routers because they have no explicit mobility functionality. The mobile node simply creates a Binding Update and sends it directly to the home agent. Recall that in M IPv6, every CoA is a co-located CoA.

2.2.3 Correspondent Nodes
Correspondent nodes are provided for in IPv4 in a separate draft, while the M IPv6 draft discusses them directly. A correspondent node is precisely that; a node that corresponds with the mobile node. H owever in Mobile IP a correspondent node refers to a node that is mobile-aware. Using framework terminology, the correspondent node is a binding agent. The advantage o f including the correspondent node on the control path is the reduction o f the hop count in the reverse path. Though many implementations often use "reverse tunneling", this is due to the fact that the packet must fii'st travel to the home subnet, and only then towards the mobile node. If the correspondent node could receive binding updates from the mobile node then it could deliver packets directly to the mobile node. Figure 2-2 depicts both correspondence with a non-mobile-aware correspondent node (triangle tunneling), and with a mobile-aware correspondent node. However, before a mobile node may bind with a correspondent node it must complete a process called Return Routability. This procedure reduces the security risk o f a thnd party pretending to be either the mobile or correspondent node, as well as assuring the correspondent node that mobile node can actually be contacted at both its home and care-of addresses. This is accomplished through the exchange o f four packets between the two nodes. The mobile node will start the process by sending a Home Init Test and C are-of Init Test message. The former is reversed-tunneled from the mobile node's home address via the home agent, while the later is sent directly to the correspondent node from the mobile node's care-of address.

13

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Correspondent Node

Home Agent

\ 'N

A"T
Mobile juiie No d .

n .
« I /-

;
j

'vr'f
Figure 2-2: Correspondent Nodes

r

Each message initially sent by the mobile node wiU contain a unique random number called a cookie. The correspondent node will respond to each message individually, which must contain the appropriate cookie as well as a keygen token. The cookies are to confirm to the mobile node that the replies came from the correspondent node, while the tokens are used in authenticating the binding updated. Once this exchange o f messages is complete the mobile node may then send a binding update to the correspondent node. Only when the correspondent node has received this binding update may it create a relationship with the mobile node. The purpose o f the return routability procedure is twofold. The first is to ensure that the correspondent node has a path to the mobile node through either the home agent o r directly to its care-of address. The second is to restrict potential sources attacks to nodes that are on the path between the mobile and correspondent node.

2.3 Hierarchical Mobile IP
Quite often the home agent will be geographically distant from the mobile node. The longer the distance, the longer it takes to register a new care-of address. This can have a significant effect on the mobile node, particularly when Quality o f Service is o f importance. In addition to the registration latency there is also the consumption o f bandwidth. Every time a mobile node moves it m ust update its home agent as well as all o f its correspondent nodes. There are also proposals to provide multiple home agents and care-of addresses. This high volume o f bursty traffic is not ideal for a wireless medium or the internet in general. Local mobility management (LMM) [8] is a category o f mobility solutions that attem pt to both reduce registration latency and overall signaling. These protocols provide local route repair in addition to that provided by the hom e agent. This means overall shorter registration periods and may also result in a reduced number o f registration messages.

14

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Correspondent Node MAP

Home Agent Mobile Node Access Router

Figure 2-3: Hierarchical M obile IP

Consider a situation where, despite movement of the mobile node, there was a care-of address that corresponding nodes could always deliver packets to. They w ould (almost) never need to be updated. Naturally, if interpreted literally, if this was possible then we w ould not need M obile IP. Y et what if there was a mobility agent that provided services similar to that o f a hom e agent, and was local to the mobile node? The effects o f triangle routing would be minimized, and registration latency would be decreased. Also, since a binding update is sent only to the "local mobility agent", overall signaling and consumption o f wireless-bandwidth is reduced. Hierarchical M obile IP (HM IP) [9] is a protocol which allows for local registration. It defines a Mobile Anchor Point (M AP) which binds a mobile node's regional care-of address to its on-link care-of address. Correspondents tunnel packets to the regional care-o f address, which is located at the MAP. The M AP intercepts these packets and tunnels them to the mobile node's on-link care-of address. Figure 2-3 depicts the path a packet takes when a mobile node is registered with a MAP.

I-nVIIP is ju st one possible m e th o d of local m obility m an ag em en t (LMM). There is a set of guidelines for LM M [8], b u t th ey are geared to w ard s IPv6. There w as an IPv4 proposal, called R egional Registration; how ever it h as fallen by th e w ayside as the focus shifted to w ard s IPv6. In fact, even LMM im p lem en tatio n s in IPv4 have been referred to as Flierarchical M obile IP.
T he M AP is a router, and as such advertises itself with router advertisem ents. It includes a M A P option which primarily indicates the prefix o f a netw ork adjacent to the M A P. A M A P may be positioned anywhere in the netw ork; routers which receive the M AP option include it into its

15

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

ow n RAs, w hich eventually reach the mobile node. A M A P dom ain is the "area" , I.E. a group o f routers and mobile nodes, w hich will receive the M A P option. M A P dom ains may overlap, such that some access routers may forw ard multiple M A P options in their ro u ter advertisement. Thus the mobile node wiU receive a ro u ter advertisem ent from the access ro u ter w hich contains the standard options o f M obile IP, along w ith one or m ore M A P options. Using the access ro u te r's netw ork prefix, the mobile node creates a on-link care-of address as described in M IPv6. In the sam e m anner the mobile node wiU also create a regional caie-o f address using a netw ork prefix contained in the M A P option. The m obile node sends a binding update to the M A P to register bo th addresses. Any packets arriving at the M AP for the regional care-o f address wiU be intercepted by the M A P and sent to mobile n o d e's on-link care-of address. A fterw ards th e mobile node sends a binding update to the hom e agent and correspondent nodes about its regional care-o f address. From then on, w henever the mobile node m oves all it needs to do is send a binding update to the MAP to register a new on-link care-o f address. The M A P is closer so the registration latency is reduced, and the m obile node deals w ith a single binding agent w hich reduces signaling. Y et if the mobile node m ust acquire a new M A P then it m ust register the new regional care-of address w ith its hom e agent. One final thing to consider is that since the on-link care-o f address is "hidden" fro m the mobile n o d e's correspondents, this address could reside within private space. This property was o f particular im portance to IPv4 because address space was limited, but it can also provide some flexibility to IPv6 netw orks.

|;
' t

! ;

t ;;
a

i | j L * |

2.4 Multicast-based Mobility
W e have seen solutions that provide the mobile node w ith a care-o f address, based upon its current point o f connection. H ow ever a different approach is host-based routing. That is, rather than routing based upon netw ork prefixes, routing is based upon hosts. Thus each router would require an entry for every host; a packet arriving for the mobile node at the hom e netw ork would b e directed to an adjacent router, and that ro u ter w ould direct the packet to another adjacent router and so on to the mobile node. There are two m ajor problem s with this approach. The first is that a ro u ter might be required to contain ro u tes fo r thousands o f hosts, rather than ju st a few netw orks. Second, potentially many routers would need to be updated when the mobile node moves. The only benefit is that the m obile's nodes address w ould n o t change; there w ould be no need fo r a hom e agent or to update correspondent nodes. Since this m ethod o f routing is som ew hat similar to multicasting the next sub-section gives a brief overview o f this topic, follow ed by a description o f how it can be applied to mobility. ;; , i '' :

16

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

2.4.1 Multicasting
M ulticasting is like subscribing to a newspaper. M any people in a given neighbourhood may want to receive the newspaper, but not everyone. Only people that have subscribed to the new spaper will get it. A multicast address is an IP address, with each unique address representing a different "new spaper" . Each multicast address is supported by a server, packets sent to the multicast address first go to the server. The server then forw ards the packet to adjacent routers that have joined the multicast address. H osts subscribe to a specific address by sending a "jo in " request to a router. R outers propagate the join request tow ards the multicast server. If a join request arrives at a router that has already subscribed then the join request does not need to propagate any further. Hosts unsubscribe in a similar fashion by sending a prune request to its router. Figure 2-4 best dem onstrates how packets are broadcasted on the multicast address in a netw ork which has both subscribed and unsubscribed hosts. The shaded-shapes are nodes that have joined the multicast address, such that packets sent to this address are only broadcasted to these nodes. N odes that have not joined the multicast address will not receive these packets.

M ulticast Path

e- S ubscnhed Host

U nsubscribed Host
Figure 2-4: A Simple M ulticast Network

2.4.2 Multicasting and Mobility
So how does a broadcasting protocol apply to mobility? Consider the m ethod by which new hosts join the multicast address, and then take a look at Figure 2-5. This diagram shows a host subscribed to a multicast address that is moving between routers. To stay subscribed the mobile node must send a join m essage at the new router, except that this m essage does not need to

17

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

propagate all the w ay to the *'-erver. N ow consider that the mobile node is the only subscriber to this m ulticast address; the m ukicast address is in effect a co-located care-o f address [10]. "Binding updates" are quick because they typically do not need to travel m ore than a few hops from th e mobile node. Also, since the address does not change, the hom e agent and correspondent nodes do not require binding updates. The mobile node cleans up after itself by sending a prune m essage to the previous access router, so that packets are delivered only to the mobile node. Since IPv6 has a large address space, the care-o f address can be globally routable. Y et it is also possible that care-of address may reside witlrin private space. The latter can be accomplished by configuring the multicast server to act as a local mobility agent. The mobile node w ould configure a regional care-of address at the local mobility agent, and use the multicast address as a on-hnk care-of address. This w ould preserve the global availability o f multicast addresses. The mobile node m ust still initially register the care-o f address with each hom e agent and correspondent node. A fterw ards the mobile node simply initiates route repan; it does not require ftirther registration with any binding agents. R oute repaii' in this case is achieved through prune m essages betw een routers.

Â
(
T

Join

i Y, ; I

)

Figure 2-5: M ulticast-based M obility

2.5 Fast Mobile IP
Previous sections discussed mobility solutions that hide the movem ent o f a mobile node from correspondent nodes, with respect to the exchange o f data. Also discussed previously was the registration process. A fter a handover the mobile node m ust register its new care-o f addiess, and during this period packets may arrive at the previous access router. Thus during the registration

18

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

process the mobile node can not receive, or send, packets. There is also the physical handoff itself, which can som etim es take Ion reduce o r eliminate this latency. .an registration. Fast M obile IP (FM IP) [12] attem pts to

2,5.1 Fast Handovers
To accomplish this reduced latency the previous access router wiU intercept packets bound for the mobile node and deliver them to its link on the new access router. T he path these packets follow is dem onstrated in Figure 2-6. Recall that this path is tem porary. This is because sending packets directly to the new care-of address utilizes a shorter path. Secondly, using this m ethod for mobility w ould likely mean multiple tunnels for every mobile node, consum ing unnecessary bandw idth. Thus the fast handover must be independent o f the regular binding process, and is referred to as transient route repair. W hen the mobile node detects a handover it will send a Fast Binding U pdate (FBU) to the ro u ter it currently connected to. The previous and next access routers will exchange HI and H A CK m essages which establish the tunnel between. Success is indicated to the mobile node through a Fast Binding A cknow ledgem ent (FBACK) message. If the mobile node detects the handoff after the fact, then the time to establish a tunnel between access routers must be shorter than the tim e it takes to register a new care-of address. Furtherm ore, the latency introduced by the handoff itself is not diminished in any way.

C orrespondent Node

Horne
·Agent

V ,

M H

Mobile Node

.Acce R outer

Figure 2-6: Fast M obile IP

19

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

A handover can be predicted, or necessitated, by weakening or growing signal level, or the need to m anage bandwidth. Thus a handover can be predicted by the mobile node, previous access router or the new access router. In fact, in cellular networks the handoff is always initiated by a router. Before the mobile node can send a FB U to the "previous" access router, it must receive a Proxy R outer Advertisem ent. This contains information about the next access router that the mobile node uses to construct the fast binding update and new care-of address. It is im portant to understand that in order to determ ine when to send or solicit for a proxy ro u ter advertisement, I.E. handover prediction, relies upon Layer 2. The Link Layer must provide triggers to Layer 3 indicating that handoff is about to, or has, occurred. Otherwise M obile IP m ust rely on the R outer Advertisem ent to detect movement, and this is not sufficient for handover prediction.

2.5.2 Local Handovers
Fast M obile IP can w ork w ith any mobility solution as it does not interact with the registration process. H ow ever, some solutions can benefit from working directly with the fast handover solution. Fast H ierarchical M obile IP [13] is such a proposal; it specifies that rather than establish a tunnel betw een the two routers, the mobile node should send the fast binding update to the M AP. The M AP then directs traffic to the new link, bypassing the old access router. U nfortunately this requnes the mobile node to engage in additional registration with the domain solution, which contradicts the purpose o f the framework. Since a local handover is more efficient than a fast handover, the fram ew ork must consider providing an interface for this operation (see Figure 1.2).

2.6 HAWAII
Like HM IP and M ulticast-based M obility (M &M ), Handover-A ware Wireless Access Internet Infrastructure (HAW AII) [14] provides local mobility management. H ow ever M &M and HAW AII, as weU as Cellular IP discussed in the following section, all have a common property that sets them apart from H M IP. They are all routing-based solutions; that is, within the access netw ork they propagate host specific routes rather than tunnel packets. In HAW AII, wireless access netw orks are referred as domains. The hom e domain is where the mobile node's hom e agent is located, while all other networks are foreign domains. Every domain is connected to the Internet core by a domain ro o t router. U pon pow ering up the mobile node establishes a route within the dom ain by sending a path setup message to the domain root router. Each router betw een the mobile node and the domain root router inspects this message and creates a host-based route for the mobile node.

20

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

: j I

When the mobile node undergoes a handover it transmits a path update message to the previous access router. All of the routers in between create a host-based entry for the mobile node. Effectively packets get diverted to the mobile node at the cross-over router. This is the closest common router to the mobile node shared by the previous and next access routers. This method is used whether the mobile node is located in its home domain or in a foreign domain. The only difference between the two is that in the latter a care-of address is assigned to the mobile node. This care-of address allows packets to be located in the foreign domain via the domain root router. HAW AII appears to be very similar to Multicast-based Mobility. In fact the only significant difference is that HAW AII defines its own path setup messages, while M&M uses general purpose join and prune messages.

I
j ' I Î I

2.7 CelJular IP
This protocol focuses on mobility within the wireless access network. Home agents and foreign agents are simply the gateway routers to each access network. Thus, similar to HAWAII, locating the mobile node within a network is the same regardless o f whether the mobile node is in the home access network or a foreign access network. The fust notable difference is that in Cellular IP the care-of address is not co-located. Packets are tunneled to the gateway router using the care-of address. The gateway router detunnels these packets, and within the access network the mobile node is identified by its home address. This is similar to the plain care-of address described in Mobile IPv4, and that is why the gateway router is sometimes also referred to as the foreign agent. Foreign dom ains su p p o rtin g PIAWAII wiU create host-based entries using the mobile n o d e's care-of address. The gateway router locates the mobile node by what is called Paging. Each router within the access network maintains a Paging Cache. This cache is populated with the source address of every packet it receives and the interface it was received on. These packets may be genuine traffic from mobile nodes, or the mobile node may periodically send empty packets towards the gateway router simply to advertise its presence as the cache entries have a limited lifetime. When a packet arrives for the mobile node the gateway router may have a host-based entry for it. If this is the case, the packets are simply forwarded through the network to the mobile node. However if no entry exists the mobile node is paged via a paging packet. This packet is broadcast on the interface identified for the mobile node in the Paging Cache. This process is continued throughout the netw ork until the mobile node itself receives the paging packet. When this happens the mobile node transmits a route-update packet to its access router. This packet

21

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

travels hop-by-hop tow ards the gateway router, with each router along the way creating a hostbased entry for the mobile node. Paging Cache entries have a longer lifetime than Routing Cache entries. This allows paging-update packets to be transmitted less frequently such that idle nodes do not flood the netw ork with control messages.

2.8 Summary
Mobility is acliieved when a mobile node acquires a care-of address and registers this value with the home agent. This is the basic concept o f Mobile IP. However this arrangement has problems o f its own, such as the latency caused by the registration period, and by the handoff itself. Furthermore, maintaining bindings with several home agents and correspondent nodes can consume limited wireless bandwidth. Thus other mobility solutions have been proposed such as Hierarchical Mobile IP, which is a type o f local mobility management. Using care-of addresses, home agents and correspondent nodes dkect traffic to a MAP, that in turn tunnels these packets to the mobile node. This reduces the registration period and consumption o f bandwidth. However it does not reduce the latency caused by the handover. M ulticast-based Mobility is another proposal which provides the mobile node with a non changing co-located care-of address. Thus the mobile node only needs to initiate route repair in the form o f join and prune messages. While this greatly reduces the registration latency, like H M IP it does not eliminate the latency introduced by the handover. There is a solution which can reduce, or eliminate, the handover latency. Since it also does not directly participate in registration, it can work concurrently with any o f the mobility solutions discussed above. This protocol is called Fast Mobile IP. The other mobility solutions have obvious advantages over Mobile IP; however there is little compatibility between them. While HMIP allows a mobile node that operates only MIP to function normally, if the local netw ork resides within private space then the mobile node can't be reached. Though this is not likely, these nodes will not receive the benefits o f HMIP or FHMIP without being reconfigured. There are other mobility solutions with which a M IP-based mobile node would not be compatible at all, such as M ulticast-based Mobility, unless the mobile node was re-configured. Thus the only way to obtain the benefits o f a new mobility solution would be to modify aU routers and mobile nodes. As discussed in Chapter 1, at best this process would be costly and time consuming. At w orst, every node would have to be replaced.

22

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Chapter 3 Mobility Management Framework
This chapter describes the design o f the Framework, while the resulting Framework draft is contained in Appendix A. An (Internet) Draft is typically a specification for the operation o f a protocol that provides a certain service, which in this case is mobility for a mobile node. Thus the Framework draft is the principal result o f this project, since a specification may have several diverse implementations. Section 3.1 begins with an overview o f the Framework design. Sections 3.2 through 3.7 discuss the major processes that comprise the Framework. Sections 3.2 and 3.3 are a prelude to the Handover process, which is discussed in Section 3.4. Section 3.5 describes the interface between Handover and Registration. Sections 3.6 and 3.7 explain Registration and Route Repair respectively. Section 3.8 explains the operation of the mobile node, while Section 3.9 details the operation o f the Foreign Agent. An analysis of Fast Handovers within the Framework is given in Section 3.10, while an example o f route repair design is provided in Section 3.11.

23

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

3.1 Framework Design
The objective of the Fram ew ork is to facilitate the deployment o f (mobility) protocols in the wireless netw ork by eliminating the need to configure the mobile node. This requires disengaging the mobile node from the route repak process within the access network. However this does not necessarily mean that the mobile node remains ignorant o f that process. For instance the mobile node should know whether local mobility management is available on its current link; it is the details o f how that service is provided that are hidden from the mobile node. To acliieve this transparency we propose in the Framework a standard signaling between the mobile node and the access router, which is based on MIPv6. To design a fram ework we need to perform the functional decomposition o f the system. The Mobility M anagem ent System involves home agents, access routers and mobile nodes. Figure 3-1 shows the interaction o f the above nodes. The function of the home agent is to track the domain hosting the mobile node and redirect packets destined for the mobile node's home address to its current location in the hosting domain. The fiinction o f the access router is to provide link connectivity to the mobile node. The access router also performs mobility related functions, which are described below.
Local
Mobility'

Mobile Node

Access Router

Domain

Home Agent

Handove

Mo'v'ernent Detection

Local Registration

Local R oute Repair

Home Registration

G lobal R oute R epair

Figure 3-1: Elements of Registration

24

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

The mobility management system basically performs three functions to provide network connectivity to a mobile node when it moves from one access router to another. The three basic fiinctions are; Handover Registration Route Repair Handover is a process o f detecting when a mobile node moves from the coverage area of one access router to another. It involves both link and network layer methods as well as their co ordination for performance improvement. Wlien this condition is satisfied the mobile node initiates a layer 3 handover, which is a process o f reestablishing network connectivity at the new access router. The mobile node will then initiate the Registration process, which in turn instigates Route Repair. Registration informs the access network and home agent that the mobile node has moved, while R oute repair performs change in the forwarding path to ensure packet delivery to the new access router.

3.2 Location Management
A domain is usually the network administered and managed by a single wireless operator. We call this an administrative domain. We define the mobility domain to be the network that employs a single mobility solution. Thus an operator can employ different solutions in different networks that it administers. The solution controls the forwarding path to the mobile node. The location o f a node in an IP network is identified by the IP address. Mobile IP defines two IP addresses for mobile nodes that are visiting foreign domains. The home address identifies the mobile node's location in the home domain, which is known to all correspondent nodes in the Internet. A care-of address (Co A) is used to identity' the mobile node's current location (i.e. subnet). This address may also be referred to as the on-link care-of address (LCoA). H istorically the LMM R equirem ents draft u sed tire term "local care-of address", hence the abbreviation "LCoA". H ow ever this draft no longer directly m entions care-of addresses as it m ay favour one protocol design over another. We additionally define the regional care-of address (rCoA) as the address that the home agent forwards packets to. It does not directly specify the exact location o f the mobile node in the domain. Rather it is used by the home agent to forward the packet to the correct hosting netv/ork.

25

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

The LMM solution employed in that network is responsible for delivering the packet to the mobile node's (on-link) care-of address.

3.3 Movement Detection - Domain Advertisements
In a cellular netw ork both base stations and mobile nodes assess the handover condition based on continuous monitoring o f the channel condition. In some situations, e.g. IEEE 802.11, the mobile node scans the channel frequency and latch on to the strongest channel signed it receives through a process know n as Scanning. Since M obile IP resides on layer 3 it implements a mechanism to detect the physical handover using R outer Advertisements (RA) that are periodically broadcast by every access router. A handover condition is satisfied when either the mobile node does not receive an advertisement from its current router within a specified period, or the mobile node receives an advertisement from a different access router. To expedite layer 3 movement detection layer 2 triggers may initiate an early layer 3 handover process. A discussion on layer 2 handover and triggers is beyond the scope o f this thesis. . An access router periodically broadcasts router advertisements on the link, which is part of IPv4 R outer Discovery and IPv6 Neighbour Discovery [6] [7]. Mobile IP modifies the router advertisement header and implements some additional options. The header contains additional flags that specify whether that access router also acts as a home agent, or whether it supports fast handovers. The options convey additional information, such as the Advertisement. This option advertises the frequency at which R outer Advertisements are sent; this can be used to detect the absence of the access router. W e augment the same basic movement detection mechanism based on Router Advertisements as implemented in Mobile IP. For the Framework we decided to use a modified router advertisement because it involves a small change to a protocol that will already be in use by the router. Defining an additional protocol would consume bandwidth. Also, defining a new method of "mobility discovery" would also increase the complexity o f the framework,, where netw ork administrators would be more inclined to use something they already understand. The R outer Advertisement header was modified to declare the services provided by the mobility domain that the access router belongs to. Hence we have we refer to this message as the Domain Advertisement. Tliis is achieved by defining additional flags, which is discussed in the following section. W e also define the Local Coverage Area (LCA) option. The LCA is a generic option that contains domain specific information. This prevents domain specific options from being advertised to the mobile node, as this would create an implementation dependency to the solution deployed in that domain.

26

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

The LCA option is used to indicate the area over which a regional care-of address is valid. The option simply contains a binary identifier to define a coverage area; access routers that advertise the same identifier belong to the same coverage area. Thus a regional care-of address that is acquired in one LCA should not be used when the mobile node traverses to a different LCA. When this traversal occurs the mobile node must acquire a new regional care-of address. The LCA identifier should be unique within a single administrative domain; hence it is locally defined and managed by a single operator. N ote that the mobile node is only interested in the regional care-of address. The mobility domain may use any means to provide this address, such that the domain may not even have local mobility agents, and thus have a single coverage area (though it is uncertain how this could be accomplished). How this transparency is handled is described further on in this chapter. The movement detection algorithm is based on straightforward com parison o f information carried in the current domain advertisement with the previously received domain advertisement. If the router address in the new advertisement is different than o f the address contained in the previous advertisement, then the mobile node has moved between access routers. Furthermore, if the new LCA identifier is different from the previous one then the mobile node has entered a new mobility domain. This involves inter-domain registration through Mobile IP.

3,4 Handover
The movement detection identifies the handover condition and initiates he handover process. Handover is a process that involves both the mobile node to establish netw ork connectivity and resume packet delivery to the mobile node at the new link. It includes exchange of signaling between the mobile and access router, and configuration o f the mobile with the new requked addresses. It is followed by registration and route repair. Figure 3-2 shows the above Framework model. As a result o f a handover the mobile node acqukes a new care-of address. The router advertisement instructs the mobile node to use either stateful autoconfiguration, such as DHCP, or standard IPv6 stateless auto configuration. Currently we requke the mobile node to acquke a regional care-of address stateftiHy during registration. H owever it is possible to define a Regional Prefix option to allow the mobile node to configure this, address itself. Careful readers may have observed that the terra "handover" has been used in different contexts. Mobility terminology [ I I ] has a very detailed section on the use o f this term. The base definition is "when an active M N ... changes its point o f attachment to the network . .. " . We have used this term to refer strictly to the act o f transferring between two access routers, as described above. W e have also used this term to refer the process reestablishing the mobile connectivity to the Internet; that is, registration and route repak. It is up to the reader to determine which definition applies based upon the context within which the term is used.

27

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

H andover (M o v em en t D e te c tio n ) H om e R e g is tra tio n G lobal R o u te R e p a ir L ocal R e g is tra tio n L ocal R o u te R e p a ir F ast H andoff T ra n s ie n t R o u te R e p a ir

Figure 3-2: The Framework M odel

The next step in the handover is to register the care-of address with the relevant mobility agents to resum e packet delivery to the mobile node. There are three different types o f registration: · · » Home Registration Local Registration Fast Handovers

The mobile node perform s Hom e Registration with the home agent to bind the regional careof address to its home address. The home registration process also includes dynamic home agent discovery and prefix solicitation. T o avoid middle man attack and other security fallouts the hom e registration must be initiated by the mobile node and must be accomplished using M N-HA security association. Local Registration attem pts to bind an on-link carc-of address with to a regional care-of address. This allows packets tunneled by the home agent to rCoA to be delivered to ICoA. It has only local significance within the mobility domain. Further, since the local registration initiates local route repah, its detail should remain transparent from the mobile node. Therefore in the Fram ew ork w e allow the new access router to perform the local registration. Since the access router serves a significant role within the Fram ew ork we reintroduce the concept of a foreign agent. H ow ever we make a distinction between binding and tunneling agents. The form er is active on the control path, while the later plays a part o f the forwarding path. Unlike M IPv4, the foreign agent within the Fram ew ork is a binding agent only. If the handover can be anticipated then a short-term route may be established between the old and new access routers. This w ould hide the latency introduced by both the layer 2 and layer 3 handover. Either the mobile node or access router may initiate the registration o f this route using the process know n as Fast Handovers. However, whether Fast H andovers are used the mobile node must still initiate either / both home and local registration at the new access router.

28

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

r
Following registration is ro u te repaii'. W e do not specify a single m ethod o f ro u te repair, as that would defeat the purpose o f the Fram ework. While the mobile node does not need to know the details o f how route repair is accomplished within a mobility domain, it must know w hat types o f sei-vices are provided by that domain. These properties are conveyed to the mobile node via a set of flags contained in the D om ain Advertisement; this informs the mobile node on what course o f action to take after a handover occurs.

3.5 Domain Flags
To provide a generic advertisem ent o f available route repair services requires support for all existing types o f care-of addresses. Preferably, the fram ework should also provide for future mobility requirements to minimize c' .anges to the mobile node. In this regard, C hapter 2 was more than a literature review o f previous mobility protocols. Each protocol discussed was selected because it introduces a different type of care-of address, w hose operation m ust be included into the framework. W e previously mentioned that each type o f service is advertised as a flag in the domain advertisement. The num ber o f flags should be minimal to retain bits to allow for future definition o f new services, and to reduce com plexity for the protocol. Yet they should also provide for every possible type o f care-o f address. Figure displays all the possible types o f care-of addresses discussed in C hapter 2. The first column provides a visual representation o f the type o f address(s) displayed in colum n tw o. Each block represents a tunnel terminal. Column three provides one possible example o f a protocol that matches the displayed topology, though more may exist. Lastly, column four displays how the fram ework categorizes this care-o f address. Each row is referred to as a "scenario" , and the letter in column 4 uniquely identifies each row . Consider cases B and D, w here a foreign agent is present. Since this thesis is directed tow ards IPv6, and foreign agents are not used as tunnel terminals by M IPv6, these two cases can be ignored. Recall that even the though the Fram ew ork reintroduces the foreign agent, it sits on the control p ath only and does n o t affect forwarding. O f the remaining four cases, A and E visually appear the same, while C and F look the same. That is because the second pair explicitly provides local mobihty management, whereas the first pair does not. This is the first distinguishing feature, which we symbolize as the flag "I" . The second feature is that scenarios A and C have a changing co-located care-of address, while for E and F the care-o f address is fixed. This is identified by the flag "C" . Thus four possible domains are represented by only two flags. Figure 3-3 shows the value each flag should take for the given scenario. These flags determ ine the action a mobile node must take in response to a new domain advertisement. In some cases local registration is not required, is other cases it is always required, etc.

29

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Home Agent

Mobile Node

changing co-localed rCoA

A. C = 0 ,1=0

Home Agent

Foreign Agent

Mobile Node

changing rCoA

MIPv4

Home Agent

LMM Domain

Mobile Node

rCoA + changing co-located ICoA

HMIPvS

Home Agent

LMM Domain

Foreign A gent

Mobile Node

rCoA + changing iCoA

Regional Registration

Home Agent

Mobile Node

non-changing co-located rCoA

M ulticast-based tulobility

Home Agent

LMM Domain

Mobile Node

rCoA + non-changing co -lo cated iCoA

F .C = 1 ,I= 1

Figure 3-3: Types of Care-of Address

W hen set, this flag instructs the mobile node to acquire a new co-located care-of address, and that this address m ust be registered w ith the appropriate mobility agents. N ote that this is the address that term inates at the m obile node. If the C flag is not set then the mobile node may keep its current (co-located) care-o f address. This care-o f address must be initially acquired via local registration, which will also require hom e registration so that the hom e agent may know this address. Thereafter the mobile node only needs to perform local registration to allow for route repair. N ote that a non-changing care-o f address is implicitly a form o f local mobility m anagem ent, such as that provided by M ulticast-based M obility (M & M ). H ow ever M&M allows the mobile node to auto-configure its ow n care-o f address while the Fram ew ork requires the mobile node to request fo r one.

The I Flag This flag, w hen set, indicates the presence o f a local mobility m anagem ent protocol. This means that the mobile node may acquire a regional care-o f address, via local registration, and

30
I

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

register this address with the hom e agent. Thereafter, while the mobile node remains within the same local coverage area, all it needs to do is perform local registration. An unset I flag advertises the absence o f local mobility management. The mobile node acquires a single care-of address and registers it with the hom e agent. Recall that H M IPv6 allows the mobile node to form its ow n regional care-of address; in the Fram ew ork we currently require the mobile node to request the assigmoient o f a regional care-of address during local registration to simplify the abstraction o f domain operation.

3.6 Registration
MIPv6 specifies a Binding U pdate m essage which the mobile node uses to inform binding agents of its new care-of address. The equivalent message in M IPv4 is referred to as the Registration Request. While in the Fram ew ork we adopt the format of the Binding U pdate, we call the processing o f this message Registration. T he binding update header, as defined by M obile IP, contains some flags which act as instructions for th e destination. Tw o o f these flags are w orth mentioning; the mobile node may specify whether o r not it requires an acknowledgement (A), and it may also specify w hether the destination should act as the mobile node's hom e agent (H). The Fram ew ork defines some additional flags fo r local registration, which M IPv6 does not take into account. They are as follows:

· ·

Local R o u te Repair (R): Regional CO A R equest (D):

R equests that the domain update its point o f connection for the given care-of address(s). W hen the mobile node encounters a new local coverage area it must request a new regional care-of address from the domain.

·

Local C O A Request (C):

Some domains may require the mobile node to acquire a local care-of address statefuUy. The mobile node uses this flag when it requires a new address.

These flags are used to request services o f route repair based upon the needs o f the mobile node. The detailed operation o f these flags is discussed in m ore detail in the following sections.

3.7 Route Repair
Route repair is a process o f setting up new a forwarding path as a result o f node mobility. We identified three main types o f route repair that occur during handover: global, local and transient.

31

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

The first tw o are handled by hom e and local registration respectively. The last is processed by fast handovers, which is discussed in another section. M acro mobility causes route repair on a global level where the routing o f packets happen betw een netw orks. W e utilize the basic concepts o f M obile IP , which implements a packet redirection mechanism at the hom e subnet. In M obile IP packets are direct to the home subnet and from th ere they are tunneled to the access netw ork that the mobile node is currently connected to. Redirection through tunneling is a kind o f global route repair. Its primary fimction is to establish the global forw arding path in the home agent's routing table. H om e registration controls this process and it also allows the mobile node to dynamically acquire a hom e agent, and a home address. Home registration is also responsible for Route Optim ization as defined by M IPv6. R oute O ptim ization entails informing correspondent nodes o f the mobile node's care-of address. This allows correspondent nodes to send packets directly to the mobile node. H ow ever such optim ization is not m andatory to provide mobility. Thus the operation o f R oute Optimization within the Fram ew ork is deferred to future projects. Micro mobility (also called Local Mobility) causes local route repair within the access netw ork. L ocal registration controls this process and relies upon the mobile node's regional and on-link care-o f address. In our fram ew ork the foreign agent performs local registration, whose details remain transparent to the mobile node. This is the key idea that allows the operator to employ any local mobility management solution o f its own choice. Since the mobile node doesn't need to know how the forw arding path is setup inside the access network, the local route repair can be perform ed solely in assistance with the foreign agents. The local route repaii' is analogous to the intra-domain routing (IG F) in IP networks, hence it does not need security association betw een the mobile node and any mobility agents used by local mobility management (e.g. M AP in HM IP). Local registration is initiated by the mobile node because the mobile node performs the movem ent detection betw een the mobility domains and controls the handover. Fast handover is designed to lay dow n tunnels between old and new access routers for the packets in transit along the old forw arding path during the handover. W e call this transient route rep ak as it attem pts to establish short-term paths within the local domain. This requkes the mobile node to send a (fast) binding update to either o f the access routers, who then cooperate to create a bi-dkectional tunnel. These short-terni paths are used to reduce the handover latency while the forw arding path inside the netw ork is established. i |

32

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

3.8 Mobile Node Operation
Figure 3-3 shows dom ain abstraction through the use o f the C /I flag pair. This section describes how the mobile node uses these flags, as while as the local coverage area identifier, during the handover process. The following subsections refer to the scenarios defined within Figure 3-3. W ithin this section, unless stated otherwise, when a binding update is required to be transm itted we assum e that all flags are not set except for the A cknow ledgem ent flag (A). W hen a sending a binding update to the home agent the source address is its rCoA, while the home address is contained in an option within the mobility header. W hen the mobile node sends a binding u pdate to the foreign agent it must use its link local address. The care-of addresses are stored as options.

3.8.1 Mobility States
Figure 3-4 is a state diagram o f the mobile node based upon the design o f the Fram ew ork discussed in the previous sections. Each state represents one o f the four scenarios possible within IPv6, as defined in Section 3.5. State transitions are triggered by inbound R outer Advertisements that contain the C /I flag pair and LCA I option. During the state transition the mobile node will engage one or b o th o f local and home registration. It is im portant to understand that there is no relationship betw een each state (i.e. scenario), when a mobile node transfers between any two different states it is essentially restarting the mobility process.

0 /l/n L C A (LR,HR)

0 / 1 / d LCA

(LR)
\  s

F

0 /l(L R ,H R )

1 /0 (HR)

r""'-f
1 /0 (HR)

A

J

C /I nLCA - new LCA oLCA - old LCA LR - Local Reg. HR - Home Reg.

0/0(L R ,H R )

0 /0 (LR)

1/1(L R ,H R )

A
1 /1 /n L C A (LR;HR) 1/1/oL C A (LR)

Figure 3-4: Registration State Diagram

33

Reoroduced with Dermission of the coDvriaht owner. Further reproduction prohibited without permission.

3.8.2 Scenario A
Every time the mobile node receives this advertisement from a new router it must acquire a new care-of address. The mobile node may auto-configure an address based upon the advertisem ent or, where appropriate, it may instead pursue stateful address allocation such as DHCP. Once the mobile node acquires a care-of address it will send a binding update to its hom e agent with the H bit set, and an option containing its new care-of address. If the home agent rejects the binding update there is little that the mobile node can do, other than create bindings with individual correspondent nodes. H ow ever the mobile node can attem pt to correct the error and try again. N ote that this case is identical to M IPv6 and the foreign binding agent does need not to be part o f the control path.

I I \
| | | |

I
\

3.8.3 Scenario C
This scenario instructs the mobile node that it must change its care-of address, and that a regional care-of address (rCoA) can be acquhed. T he specific action taken depends upon the local coverage area identifier.

New LCA Identifier Recall that the mobile node must acquire a new rCoA whenever it observes a local coverage area (LCA) identifier that is different from the one advertised by the previous router. Technically, receiving this DA for the first time is like receiving a new LCA Identifier, thus
necessary actions for the tw o events are the same. The mobile node must send a binding update to the foreign binding agent (PBA). This node should not act as a hom e agent, so H is not set. The domain will assign a rC oA to the mobile node, thus the D flag must be set. Since the mobile node can create its ow n local care-of address (ICoA) it does not need request one from the domain, as such the C flag must not be set. Finally the mobile node will w ant the domain to bind its ICoA to its rCoA (even though it doesn't have it yet). To request route repair the R flag m ust be set. Local registration is com plete when the mobile node receives a binding acknowledgement from the foreign agent. I f it indicates success then the node registers its rCoA with the home agent. If the registration failed then the mobile node may auto-configure a care-of address and attem pt to register this w ith the hom e agent, foregoing the benefit o f local mobility management. If home registration fads, since the mobile node has a valid regional care-of address, it can still com m unicate within the local domain. The mobile node can also bind with correspondent nodes.

Old LCA Identifier
The mobile node only needs to change its local care-of address, and to register this address with the (local) domain. This means sending a binding update to the FBA with the R flag set.

34

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

The binding update must contain the ICoA, along with its rCoA as context. The mobile node does not need to initiate home registration as its regional caie-of address has not changed.

3.8.4 Scenario E
Receiving this advertisement informs the mobile node that it can keep its current care-of address, and that it can use this address globaUy. Since a unicast IP address can not easily transfer between subnets the mobile node can not form its care-of address statelessly. Thus the fiist time the mobile node enters this domain the mobile node must acquire its care-of address from the I domain statefuUy. This requires a local binding update with the C flag set. Furthermore, since this address can not be used in standard network-based routing, some form o f local route repair is required. As such the mobile node must also set the R flag in the initial binding update. Local registration is complete when the mobile node has received care-of address from the domain. The mobile node must then send a binding update to its home agent using its new careI o f address. The H flag must be set. Note that in subsequent handoffs the mobile node does not need to update the home agent as its care-of address is not changing. However, as noted above, the mobile node must inform the domain so that it may properly route packets to the new point of connection. This requires a local binding update to the foreign binding agent with the R flag set, with the care-of address is contained as an option for context

3.8.5 Scenario F
The scenario advertised by this DA allows the mobile node to keep its local care-of address as well as acquire a regional care-of address (rCoA). Note that this is essentially a union of the previous two states. W ith each new LCA identifier the mobile node must acquire a new rCoA and ICoA. The mobile node wiU also want the two associated. This requires a local binding update to the FBA with the R, D and C flags set. Local registration is complete when the mobile node has received a binding acknowledgement containing both its rCoA and ICoA. The mobile node must then send a binding update to its home agent using the rCoA, and the H flag must be set. If the current LCA Identifier matches the previous one, then the mobile node only needs to send a local binding update containing its ICoA with the R flag set to the foreign binding agent. It does not need to send its rCoA as additional data since its ICoA is not changing.

3.8.6 M iscellaneous Operations
If local registration fails the mobile node can attempt to register with its home agent using a statelessly configured care-of address instead. Flowever the mobile node must include a Type 0 Routing H eader in its IP header, with the target as the Foreign Binding Agent. This will allow the FBA to inspect the binding update and make sure it does not violate any o f the domain's requirements, such as attempting to register a site local address outside o f the domain.

35

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

If registration with the home agent fails, the mobile node can still attempt to update its bindings with correspondent nodes. There little else that the mobile node can do if the home agent rejects the binding update other than to keep sending the same update in the hope that it w in be eventually accepted. MIPv6 defines additional actions such as dynamic home agent address discovery, as well as acquking a hom e address. The fram ework allows for these actions, but does not modify them. F or details readers must examine the MIPv6 document.

3.8.7 Example
A C/I pair o f 1/1 is advertised. This indicates Scenario C, where a regional care-of address is provided and the local care-of address must be changed. The fii'st time the mobile node sees this pair it must activate local and home registration. In consecutive advertisements with the same LCA the mobile node only activates local registration. If the advertised LCA identifier is different from the previous one (not necessarily an undiscovered identifier) then the mobile node must also activate home registration. If a different C/I pair is discovered then the mobile node will adhere to the new scenario's initial conditions. Subsequent advertisements of that pair will cause the mobile node to remain in that state while pursuing the necessary actions indicated in Figure 3-4.

3.9 Foreign Agent Operation
The Foreign Binding A gent is the sole node responsible for Local Registration. It also supports some functions related to the deployed Route Repair solution. Though it is beyond the scope of this document to discuss the implementation o f every potential route repair protocol, we must define a standard interface between Local Registration and its neighbouring "layers" . After we identify these services we specify the operation of Local Registration.

3.9.1 Local Registration Interfaces
W e have already discussed the simple handoff and local registration interface in detail. The mobile node requests registration via a binding update while local registration responds tlirough the binding acknowledgement. There is a separate set of primitives defined for the (local) registration to route repak interface. This is because the interface resides within the foreign agent and as such a binding update is not entkely appropriate. Typically all messages specified within a single document are defined within a single section. H owever this report follows the path of the framework design such that these primitives are best discussed here.

36
L

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Local registration has three outbound request primitives: Initiate R oute RepaL, Request Regional C are-of Address and Request Local Care-of Address. There ar e also three corresponding inbound confirm primitives. They are effectively data structures that are passed between the two processes. The use o f these primitives in Local Registration is described below. Note that fast handoff is also implemented on the foreign agent, and that it also has an interface with route repair. However a discussion on this interface is deferred to the following section.

3.9.2 The Registration Process
The foreign agent wül receive binding updates which is a request for services from a mobile node. The foreign agent maintains a temporary binding entry for this update until the all of the items in the request have been met, for wliich it processes each item individually by issuing requests to route repair. Wlren all o f the items have been dealt with a binding acknowledgement is delivered to the mobile node. The services are requested by flags contained withm the binding update. These are Local Route Repair (R), Regional COA Request (D) and Local COA Request (C). Additional data wiU be contained within the binding update depending upon which flags have been set, namely the addresses that require binding. Each flag dhectly corresponds to one of registration's request primitives; the C flag creates the Request ICoA primitive, the D flag creates the Request rCoA primitive and the R flag creates the Initiate Route Repair primitive. The flags are processed sequentially in the following order: C, D and R. Any flags that were not set are skipped. The purpose for this order is that the ICoA may be useiul in forming the rCoA. As such it is acquhed first and passed as an argument for the Request rCoA primitive. Finally, route repair binds the local care-of address to the regional care-of address. Thus these two values must be acquired before route repah can be initiated. Local registration was introduced to act as a buffer between the (Simple) Handoff and Route Repair processes. This arrangement provides route repaii' protocols an interface that can be changed, whether for operational or experimental purposes, without requiring a corresponding change in the mobile node. The registration request is broken into individual actions to prom ote this level o f flexibihty. Furthermore, route repair will typically involve multiple nodes. Since aU o f the items in the binding update must be processed sequentially, by breaking the update into individual requests the foreign agent can process multiple binding entries instead o f waiting for an entire binding entry to be concluded before moving on to the next.

37

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

3.10 Fast Handovers
We have previously discussed the four scenarios o f the framework. Fast handovers as described by "Fast Handovers for Mobile IP" [12] may operate safely in all four cases even though Fast Handovers was designed specifically for Scenario A. This means that this protocol may run unmodified within the framework. However, when local registration is present within the fi-amework it may be more efficient to combine the two protocols [13]. This introduces the need to make the operation o f the fast handover protocol transparent to the mobile node, which requires the design o f a standard interface between the two. To do this we must assess each scenario, using unmodified Fast Mobile IP as a reference point.

E

^

[ | [ [ f f

Scenario A · Fast M obile IP was designed for this scenario, thus no special modifications are necessary. Scenario C
Fast Flierarchical Mobile IP [13] is example o f a fast handoff protocol for this type of scenario. H owever it specifies that the mobile node send the fast binding update directly to the M AP. This is unacceptable to the framework. Therefore the mobile node must operate as specified with one exception, it may include its rCoA in the FBU as context. The foreign agent may be configured to either operate "normally" , or it may direct the tunnel agent sponsoring rCoA to bicast packets to the mobile node's previous and new care-of addresses.

[

I

)

Scenario E Since this protocol employs host based routing or multicasting, there must be a common
node located between NAR and PAR. Using the same principles as in the previous scenario, the foreign agent may instruct the access network at this location to bicast packets to the mobile node. Since the source address o f the fast binding update is the previous care-of address (PCoA), there is no need to include extra data in the FBU. However, if the domain will be bicasting packets to PCoA then the mobile node must prepared to accept packets bound for this address, even on the new link, until indicated otherwise during local registration at the next access router.

Scenario F This is simply a combination of the previous two scenarios. Wliile it would be up to the protocol to determine the best method to bicasting, the mobile node should employ both
modifications specified by the previous scenarios.

38

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

m

Based upon this analysis we determine that the mobile should operate as specified by Fast Mobile IP with the following modifications: · If the mobile node has a regional and local care-of address, the mobile node should be allowed to include its regional care-of address in the fast binding update. · The mobile node should retain "PCoA", as well as continue to receive packets destined for this address until indicated otherwise during local registration at NAR. · The foreign agent determines whether to transmit the Handover Initiate (HI) message to the next access router, or to a mobility agent within the local mobility domain. We demonstrate the control flow described here in Figure 3-5. Readers should be aware that this diagram is an overview only; it represents the predictive case only, and does not display detailed messages such as the R outer Solicitation for Proxy Advertisement message.

M obile N o de

P revious A c ce ss R o u te r

Neirt Access
R o ute r

Local Mobilit)-' D om ain

PrRtAdv
FBI HI
.J
.

HACK
FBA

Figure 3-5: FMIP Control Flow

39

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

3.11 Security
Disengaging the mobile node from the route repair process witlrin the local mobihty domain in our fram ework does not create an additional security risk. IP mobihty solutions use IPsec and authentication options between the mobile node and related binding agents. For either method to work requires an association between both nodes. For example, nodes in Figure 3-1 require the following associations: · · · mobile node - home agent mobile node - foreign agent foreign agent - local mobility (agent) domain

The last association between the foreign agent and the local mobihty agent is required for safe route repak. Thus while the foreign agent introduces an additional node in the overall control path we do not experience an increase o f security associations in the Fram ew ork at the mobile node or home agent compared to protocols such as Hierarchical Mobile IP. The number o f associations under conditions identicalto M obile IPv6 is also the same as the foreign agent is not engaged on the control path within that scenario. Furthermore when the foreign agent is a participant on the control path within the local mobihty domain the network administrator can establish in advance additional security measures, while with a mobile node they must do this during the handover process and have no control over the security method selected.

3.12 Reference Design: Route Repair for HMIPv6
The detailed design o f local route repair depends upon the local mobility management solution used in the network, which is beyond the scope o f this thesis. However, we provide a case study to show how a route, repak protocol would operate within the Framework. We discuss below the adaptation o f HM IPv6 as a route repair solution.

3.12.1

Overview of HMIPv6

HMIPv6 is a local mobihty management solution that requkes the mobile node to acquke a regional and local care-of address. It employs a Mobility Anchor Point (MAP) to tunnel the packets that it receives from the home agent at the regional care-of address to the mobile node at the on-link care-of address. The M AP inserts the M AP option in its router advertisement that is propagated, at the network administrator's discretion, to certain access routers. These routers wih include the M AP options in thek own router advertisements to the mobile node. The mobile node uses this advertisement to auto-configure both the regional mtd local care-of address. It sends a binding update to the MAP to register these addresses in the M A P's routing table.

40

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Wlien the mobile node receives a binding acknowledgment indicating success it then sends a binding update to the home agent to associate its home address to its regional care-of address. Thereatter the mobile node only updates the M AP with new ICoAs so long as the mobile node continues to receive advertisements from that M AP. Since in this situation the regional care-of address doe not change, there is no need for the mobile node to update the home agent. HM IPv6 allows overlapping M AP domains. In that case the mobile node receives multiple M AP options, one from each MAP. The M AP option contains a preference value that can be administratively configured. The mobile node registers with the M AP that has the lowest distance value and lowest preference (excluding 0).

3.12.2

Domain Abstraction

The C and I flags should be set in the Domain Advertisements o f all foreign agents within HMIPv6 mobility domains to allow proper configuration o f addresses at the mobile node. Furthermore, the Domain Advertisement should also include a LCA Identifier corresponding to the HM IPv6 MAP domain w here the mobile node has acquired its regional care-of address. The LCA Identifier is not the M AP option; hence in the Framework M AP advertisements are intercepted and processed by the foreign agent. The mobile node remains unaware o f the existence o f the MAP. In case o f overlapping M AP domains the foreign agent receives multiple MAP advertisements and it will select the most suitable MAP for the mobile node. It then includes a LCA option corresponding to that M AP domain in its Domain Advertisement to the mobile node. Thus, in the case o f FIMIPvô, the Framework shifts the responsibility o f MAP selection from the mobile node to the foreign agent. We argue that the foreign agent should be the one that selects the best MAP because it is a network com ponent that can maintain more elaborate knowledge o f MAPs and use a corresponding set o f criterion, e.g. reliability, performance, scalability, etc. to make the MAP selection. Furtherm ore, since the M AP option m ust not propagate to the mobile node, the MAP selection must remain with the foreign agent. N ote that overlapping mobihty domains can only be supported if the Domain Advertisements can be dynamically configured. If they are statically configured then there may be no domain overlap. This is because the region care-of address must be valid wherever the corresponding LCA Identifier is advertised. An overlap will invalidate the regional care-of addresses beyond the union o f the two local coverage areas, Plowever, advertising multiple LCA options would alleviate this problem at the cost o f bandwidth, as well as to shift the decision point back to the mobile node.

41

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Foreign Agent

M obile Node

Local Registration

Route Repair

MAP

Home Agent

RA

BU & Confitm i------------Request Request

BU
BA

Confirm BA
BU BA

Figure 3-6: HM IP Control Flow

Figure 3-6 displays the flow o f control o f a local mobility domain that deploys HM IP. The mobile node does not need to know how the MAP operates, or whether one is even present. This abstraction is made possible by the R oute Repair API hosted on the foreign agent. W hen local registration is complete the mobile node may then also engage home registration.

3.12.3

Local Registration

The access router is delegated the responsibility o f performing local registration o f the mobile node's local care-of address with the MAP. It starts local registration after receiving a binding update as a part o f the M N -A R standard handover signaling. The binding update wiU either have the D and R flags toggled, or just the R flag depending u p o n w hether the mobile node is new to the local coverage area. Since the mobile node can auto-configure its ICoA the C flag never needs to be set. Local registration creates an entry for the update which stores requested actions, and the results of actions already processed. If the entry shows D=1 the foreign agent wiU issue a

42

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Request rC oA primitive to ro u te repair (i.e. HM IP). W hen local registration recives a Configure rCoA primitive it wiU store rC oA in the entry. The entry should also have R=1 which requires an Initiate R oute Repair primitive sent to HMIP. Local registration will receive a Repair Acknowledgem ent in response which contains the status o f the binding. W hen no fiirther actions are required local registration wiU then create a binding acknowledgement for the mobile node. Once the binding acknow ledgm ent is transm itted local registration can delete the binding entry.

3.12.4

Route Repair

HM IPv6 route repair must be able to handle the R equest Regional C are-of A ddress and Initiate Route R epair requests. It confiims these actions using the Configure Regional C are-of Address and Repair Acknowledgm ent primitives respectively. HM IPv6 caches M AP options at the foreign agent as discussed above. Thus when route repair receives the R equest rC oA primitive it can directly inspect that cache and pick the M AP with the best characteristics. It will use this to form a rCoA for the mobile node, which it passes to local registration using the Configure rCoA prmiitive. The control path never leaves the foreign agent during this exchange. W lien route repair receives the Initiate R oute R epak primitive the foreign agent must be able to identify the M AP using rC oA as context.

3.13 Reference Design: Route Repair for Multicast-based Mobility
We provide an additional reference design for M ulticast-based Mobility (M &M ) to dem onstrate that the Fram ew ork is applicable to multiple m ethods o f route repak.

3.13.1

Overview of Multicast-based Mobility

M&M provides local mobility management by allowing the mobile node to retain its care-of address after a handover. It achieves this by dedicating a multicast address to mobile node for use as a care-o f address. The mobile node sends a binding update to the home agent only when it Ikst receives this care-o f address. Thereafter, when the mobile node moves, it simply needs to join at the new access router and to prune at the previous.

3.13.2

Domain Abstraction

M &M allows the mobile node to retain its caie-of address but does not provide "explicit" local mobility management, i.e. it does not supply a regional care-of address to the mobile node. As such the C and I flags should both be set to 0.

43

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Ne>rt F o re ig n A g e n t

MobHe Node

Local Registration

Route Repair

Previous Foreign Agent

Router

Home Agent

RA BU Request Confirm Request Join Prune
C o n f it m

BA

BU
BA

Figure 3-7: M & M Control Flow

Currently the F ram ew ork requires a LCA I to be advertised only when 1=1. H ow ever this causes a problem when the mobile node crosses mobility dom ains that allow the mobile node to retain its care-o f address (C = l). U nder these conditions the m obile node is unable to determine w hether it has entered a new mobility domain w ith the flags alone; as such must it will retain its current care-o f address instead o f acquiring a new one appropriate for the new domain. Thus the foreign agent m ust include the LC A I option in all router advertisem ents, and the mobile node m ust use this inform ation in determining when to acquire a new care-o f address as well as when to initiate hom e registration. This flow o f control is displayed in Figure 3-7.

3,13,3

Local Registration

W hile M & M should not alter the operation o f local registration, w e discuss here the control o f local registration wltile operating in conjunction w ith M & M . L ocal registration is activated by a

44

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

binding update from the mobile node. Tliis request wül have the R bit set, and may optionally
le

nt

have the C flag set. Local registration creates an entry for the update which stores requested actions, and the results o f actions already processed. If the entry shows C=1 then this process wiU issue a Request Co A primitive to route repair (I.e. M &M ). W hen local registration receives a Configure COA primitive it wiU store Co A in the appropriate entry. The entry should have R = l, which requnes an Initiate Route Repair primitive sent t to route repair. Local registration wUl receive a Repair Acknowledgement in response which contains the status o f the binding. W hen no fiirther actions are required local registration wiU then create a binding acknowledgement for the mobile node. Once the binding acknowledgement is transmitted local registration can delete the binding entry.

3.13.4

Route Repair

M & M route repair must be able to process the Request CoA and Initiate R epah primitives. To achieve the first request there is an algorithm that M &M uses to auto-configure a care-of address; this algorithm is executed by the mobile node, as such this function must be relocated to the route repair process within the foreign agent for reasons discussed in the previous section. To perform route repair the access router simply needs to subscribe to the multicast address. H ow ever M &M will require a mechanism to determine the correct path to prune as the mobile node will not convey the identity o f its previous access router as part o f the binding update.

3.14 Summary
The fram ework is separated into processes, where each process roughly corresponds to the functions supported by a specific node-type. Defining a standard A PI between these processes allows the foreign agent to conceal the details o f the local domain from the mobile node. In turn, the mobile node conceals its mobility through the use o f care-of addresses. The goal of the mobile node then is to have a valid care-of address. It was shown that the IP mobility protocol the local netw ork operates can be abstracted into types o f care-of address, and that these types can be reduced into tw o categories: the provision o f local mobility management, and the provision o f non-changing care-of addresses. R outer Advertisements are used by existing IP mobility protocols as a means o f movement detection, as well as to advertise properties associated with that link. Thus it is natural to adopt and modify this advertisem ent to contain an additional two flags representing the care-of address properties. The mobile node determines that a handoff has occurred tlirough the advertisement o f a new foreign agent. This indicates that its current care-of addresses (CoA) are no longer valid. It is the

45

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

m obile node's job to acquke the appropriate Co As and register them with the p roper m obility agents. T he mobile node uses local registration to initiate route repair within the access netw ork. L ocal registration also assigns IP addresses appropriate for the netw ork to the mobile node. Since these addresses wiU be registered with the hom e agent, local registration m ust precede hom e registration. Local registration does not guarantee successful route repair, o r that IF addresses will be available. O nce local registration is com plete, the mobile node may need to initiate hom e registration. H om e registration handles "global" registration; it attem pts to bind the mobile n ode's hom e address to its newly configured regional care-of address, and may also provide hom e agent and hom e address discovery. The third registration protocol is fast handoff. It provides transient route repair, such that the mobile node may continue to exchange packets despite the latencies introduced by a handoff. A fter the handoff the mobile node must still initiate local and hom e registration where apphcable. Like the other two protocols, the details o f the transient route are transparent to the mobile node. R oute Repair is the actual act o f establishing a route to the mobile node, w hether that means binding addresses together within a single node o r setting up the path node by node. This process also provides stateful address assignment. While the fram ew ork specifies the interface betw een this route repair and registration, it can be changed w ithout also requiring a change in the mobile node. Providing this transparency to the mobile node is the goal o f the fram ework. O therw ise effecting those changes would be difficult to accomplish in netw orks with a large user base. The fram ew ork is also designed to adopt many o f the characteristics o f existing IP mobility protocols w ithout com prom ising its main objective. This allows for an easy conceptual transfer from a non-structured mobility architecture to the Fram ew ork. It also provides for code re-use, which reduces developm ent time.

46

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Chapter 4

The Implementation

A nother objective o f this thesis is to design and implement a simple prototype that dem onstrates the properties o f a M obihty M anagem ent Fram ework. To achieve this goal the prototype m ust have the simple handoff, hom e and local registration protocols. F or im plem entation purposes this requires producing softw are for a mobile node, hom e agent and foreign agent respectively. Since the remaining protocols are either optional or not critical to operating the Fram ew ork, they were relegated to future projects. The M obihty M anagem ent Fram ew ork was designed for IPv6. There is pubhcly licensed code available for M obile IPv6, which rehes upon independent softw are for neighbour discovery. Since the Fram ew ork reengineered M obile IPv6 it was logical to reuse code developed for this protocol. Section 4.1 discusses the neighbour discovery software. Section 4.2 provides an overview o f the unmodified M obile IPv6 software. The Fram ew ork's im plem entation o f the mobile node is explained in Section 4.3. The foreign agent is described in Section 4.4. Since the fram ework does not specify any operational changes for the home agent, this node is not discussed. The chapter concludes with a brief discussion o f fast handovers. The fram ework, and related projects, can be obtained at http://w w w .ee.rverson.ca/~iaseem /. W e use the following convention to describe the source code w herever it is referred to in this chapter. The name in italics is the file in which the code can be located. The number prefixing the code is the line within that file that the code may be found on. The entire project was w ritten in C.

ndisc.c
631 change_rtr = ndisc_mipv6_ra_rcv(skb);

ndisc.c
H ow ever in some circumstances the indentation o f the original M IPL code is not printer friendly; it has been reform atted to keep commands and their docum entation on a single line.

47

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4.1 Neighbour Discovery
M obile IP uses neighbour discovery for: · · M ovem ent detection. Creating new care-of addresses.

To do this a node requnes information about the link it's connected to, such as the netw ork prefix, who the routers are, etc. Mobility agents periodically broadcast R outer Advertisem ents to carry the above information.

4.1.1 radvd
The R outer A dvertisem ent Daemon, or radvd [16], was first w ritten in 1996. Since then it has been modified to m atch modern discovery RFCs, as well as to provide support for mobility. M any researchers and developers use this apphcation in theh work, including the mobility softw are adopted by the framework. While the router advertisement is only one aspect o f neighbour discovery, it is the m ost crucial element with respect to mobility. In term s o f the fram ew ork, and its implementation, this is also the only area o f change within neighbour discovery. Each router is configured via a static text file, as shown in Figure 4-1. A scanner parses the values in the file into variables. A structure is defined that mirrors the message format; the variables are simply assigned to the appropriate field. Additional structures exist for Options, ami if configured they are appended to the message buffer. Once the message buffer is finalized it k w ritten to a raw IP socket.

4.1.2 Domain Advertisement
W e have introduced domain advertisements in the fram ework to broadcast the mobility services supported by the access network. In our implementation we modified radvd by: · · · Adding the C flag Adding th e I flag Adding the Local Coverage Area Identifier

The first tw o additions are easy; in each case it is simply a m atter o f toggling a single bit. This change entails adding an extra field to the RA structure. It also requires modifying radvd's. lexer to identify administratively defined values in a configuration file.

48

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

radvd.conf
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 } }; p r e f i x f e d O :10 :0 :2 : :/64 { AdvOnLink on; AdvAutonomous on; AdvRouterAddr on; MaxRtrAdvInterval 4 ; AdvHomeAgentFlag off; AdvSupportLMMFlag off; A dvChangeCOAFlag on; interface ethO { AdvSendAdvert on; A d v i n t ervalOpt on;

radvd.conf
Figure 4-1: Configuration for radvd

Adding the LCA identifier requires defining a new option and its associated data structure. W hen present it must be appended to the message buffer, and the length o f the message properly calculated and stored in the length field. In addition to recognizing this configuration, the grammar must check for the status o f the I flag. If it is on, this value must be configured. If it is off then this value must be ignored.

4.2 Mobile IPv6 for Linux
Mobile IPv6 for Linux (MIPL) was first developed in 2000 and continues to be maintained to this day. This project uses M IPL version 0.9.5.1 [17], which is a 20,000 line patch to the Linux kernel. Since this docum ent's 3,000-f- lines comes close to 100 pages, the author decided not to include the Framework in its entirety. Instead it has been made available at the following website: http://www.ee.ryerson.ca/~iaseem/. This section discusses the key aspects of the mobile node before the Framework, while Section 4.3 discusses the changes required to make the mobile node framework-ready. Though not originally part o f MIPL, Section 4.4 describes the implementation of the Foreign Agent.

49

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4.2.1 Movement Detection
Neighbour discovery is an independent process from movement detection. The kernel already has RFC 246T s [7] host specification embedded in its code; this code was produced by the same authors o f radvd. M IPL incorporâtes two changes in the implementation o f neighbour discovery to make movement detection available within the kernel. First it allows neighbour discovery to initiate a movement detection process whenever a router is "discovered", as shown in Figure 4-2. Secondly it registers its own process with the kernel.
----------------------------------------------------------------------------------------------------------------------------------------------------

ndisc.c ndisc. c

632

change_rtr = nd.isc_mipvS_ra_rcv (skb) ;
--------------------------------------------

module_mn.c
321 M I P V6_SETCALL (mipv6_i'a_rcv, mipv6_mn_ra_rcv) ;

module m n .c
Figure 4-2: Enabling Movement Detection

Figure 4-3 shows the entire movement detection process. The fii'st function parses the router advertisement into a router structure usable by the rest o f the mobility software. The second function, using the newly parsed router, determines if a handoff is necessary. This is ascertained by comparing the network prefix o f the newly advertised router to that o f the previously advertised router, whose data is contained in a record called "curr_router" . If they are the same then the return value is set to " 1" to indicate that a handover has occurred, otherwise the value "0" is returned. Another aspect o f movement detection is the advertisement interval. If the mobile node has not received a router advertisement from its current router within a specified interval it may be because the mobile node has moved. There are additional functions located in mdetect.c that handle this aspect of movement detection. However, since these functions are not changed by the framework, there is no further need to discuss them.

2îiod!.!ie_B!n.

c

tn lp v6 _m n _ ra_ rc v()

nidetect. c

m !p v 6 _ ro u t6 r_ e v e n t()

Figure 4-3: Movement Detection

50

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4.2.2 The Binding Update List
Before proceeding with the H andoff discussion it is essential to understand the Binding Update List. Recall that the home agent binds the mobile node's home address to its care-of address. Thus when a packet when arrives at the home agent bound for the home address, the mobile node win intercept and tunnel that packet to the care-of address. The Binding U pdate is implemented as a mobility header that instructs binding agents of the mobile node's home and care-of addresses. W henever either changes it must update each and every binding agent which maintained that binding; for Mobüe IPv6 this means home agents and correspondent nodes. The Binding Update List does not only contain binding updates, but also bindings actively maintained by binding agents on behalf of the mobile node. The definition of a binding entry is shown in Figure 4-4.

bul.h
43 44 45 46 47 48 49 50 51 52 unsigned long expire; u32 lifetime; u32 lastsend; u32 consecutive_send; u8 flags; uB sag; uS prefix; /* Session Key*/ struct tnipv6_mh_opt *ops ; /* retransmission info*/ u8 state; u32 initdelay; u32 delay; u32 maxdelay; struct mipvS_rr_info *rr; unsig n e d long c a l l b a c k _ t i m e ; int (*callback)(struct mipv6 _ b u l _ e n t r y *e n t r y ) ; /* saved option values */ /* expiration time of this entry */ /* lifetime sent in this BU */
/*

struct mipv6_bul_entry { struct hashlist_entry e; struct in6_addr cn_addr; struct in6_addr h o m e _ a d d r ; struct in6_addr coa; /* CN to w h i c h B U was sent */ /* home address of this binding */ /* care-of address of the sent BU */

last time w h e n B U was sent */

/* Numb e r of consecutive BU's sent */ /* B U send flags */ /* sequence n u mber of the latest BU */ /* Prefix length */

53
54 55 56 57 58 59 60 61 62 63 64 65 66 67

68

};

bul . h
Figure 4-4: M obile Node Binding Entry

51

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

The first item is an entry's location within the binding update list; all actions related to locating the correct binding are based upon the correspondent/home address tuple. The remaining lines are the addresses associated with the binding. There is the address o f the binding agent, while the other two addresses are the home address and care-of address used in this binding.

The lifetime is the duration for the binding requested by the mobile node, while the expiration indicates when the binding will terminate as assigned by the correspondent node. The other tw o values deal with retransmission while the mobile node is waiting for a response.

These values are preserved in case the binding update needs to be retransmitted. The first three are found within the standard header. N ote that o f aU four, only the sequence field will change after the initial binding update. T he last one points to the list o f options, such as the Alternate C are-of Address option, that are to be contained in the binding update message. Though M IPL provides support for these options, it does not actually use them in the binding update.

60-68
T he remaining fields arc additional retransmission data. The state indicates the status o f the binding: accepted, waiting or rejected. "Accepted" indicates an active binding, and "waiting" means a binding update has been sent and the mobile node is waiting for an acknowledgement. "Rejected" means that the binding agent does not understand the registration request and future updates should be avoided. Lines 62-64 control how long the binding update may be delayed before (re)transmission. We ignore line 65 because it deals with return routability, or binding with correspondent nodes. The last two items reflect the "lifetime" o f the binding, and what should be done when this time runs out. T he binding update list is managed through three essential functions: m i p v 6 _ b u l _ a d d , r n i p v 6 _ b u l _ d e l e t e and m i p v 6 _ b u l _ g e t . In addition to these functions, we will observe auxiliary functions associated to each entry through their- callback fields.

52

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4,2.3 Handover Processing
If the movement detection process returns true then the kernel wiU initiate handoff processing. To make tliis possible within the kernel requires modifications similar to those discussed in Section 4.2.1. When a handoff occurs the mobile node must update every node that currently maintains a binding on its behalf. M IPL breaks this into two tasks: updating home agents, and updating correspondent nodes. The handoif process is shown in Figure 4-5. The left branch shows home agent processing, while the right shows correspondent node processing. Since the framework does not currently deal with correspondent nodes, further discussion about these types o f binding agents will be kept to a minimum. The kernel c a l l s m i p v 6 _ c h a n g e _ r o u t e r ( ) to prepare the handoff structure, which contains data related to the previous and next access routers. The router structure was previously initiated during movement detection. However it also stores the care-of address used by the mobile node at that router. Thus, to complete the handoff structure, a new care-of address is formed here. Finally, since the previous router is no longer accessible, the curr_router value receives he new router and all paths to the old router are deleted. The handover structure is used by subsequent functions to build a binding update entry.

i n c i G t e c t .c

mipv6_change_routerO

2u n .

c

mipv6__mobile_node_moved()

mn_ha_handoff()

/

bu Lite rate 0 hashlistJterateO mn_cn liandoffQ /
'

211o

h h d 22 2 Î 2 2 7 .c

./ mipv6_send_bu()

\ /

send_bu_m sg()

mipv6_rr_start()

T
laobhdx- comnion. c send_mh()
Figure 4-5: Handoff Process

V

j Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

T he next function in the list, m i p v 6 _ m o b il e _ n o d e _ m o v e d ( ) , is essentially a w rapper function to the following two functions, m n _ h a _ h a n d o f f ( ) and m n _ c n _ h a n d o f f ( ) . Since the mobile node may haive more than one home agent, handover processing must loop through each node. However, a mobile node can maintain only one home address per home agent and one care-of address per router. Therefore each home agent maintains only one binding on behalf o f the mobile node. This relationship affects how the handover is processed. F or each home agent the function mn_ha_handoff() determines whether the advertised router is in fact that home agent. N ote that when a mobile node returns hom e it still issues a binding update with the corresponding home agent. If the advertised router is not the home agent, and this is the mobile node's "first time" away from home, then i n i t _ h o m e _ I ' e g i s t r a t i o n ( ) is called to prepare data for a new binding. If a binding already exists then it is fetched from the list. M ost o f the values remain constant with a few exceptions, most notably the care-of address. T he lu notions previously described within this section essentially assembled the data necessary to build a binding entry. This data is passed to the function mipv6_send_bu(), which either creates or updates an existing binding entry, and then determines the actions necessary to register that binding. If an existing binding has been rejected, no further updates for this particular binding should be sent. On the other hand, if too many updates have been sent within a given time frame then the mobile node should wait before sending another. If the binding is for a correspondent node, then the mobile node must initiate return routability. Return routability is not essential to the mobility of the mobile node, and thus analysis o f this process is deferred to lliture projects. .lust prior to the sending o f the binding update is the retransmission configuration. This is the first time we see the callback fields o f the binding entry put into use. The callback_timc registers when the callback function will be executed. The binding entry will point to one o f the following functions based upon its status as described in Section 4.2.2: · · · A handler to retransmit a request that has not yet been acknowledged. A handler to refresh a binding that is about to expire. A handler to remove an expired binding.

Since these functions basically influence communication with other nodes, we defer a more detailed description to the following section. The function se n d _ b u _ _ m sg ( ) builds the binding update message based upon an existing binding. A structure resembling the format o f the binding update header allows this function to easily build the mobility header. This header, along with the destination and source addresses are passed to s e n d _ m h ( ). Wilde the latter function also accepts options, we mentioned previously that M IPL does not actuady generate any.

54

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

The final function, s e n d _ m h ( ) , is a general function that transmits mobility headers. Since we are only interested in the processing o f binding entries, further discussion beyond this point is not necessary.

4.2.4 Binding Liaison
This module supervises correspondence with binding agents. Like any other protocol dependent upon IP, the mobility header must be encapsulated within an IP header. When demultiplexing, the IP layer must know to whom to pass each type o f header. As such the mobility software must register itself with the kernel as shown in Figure 4-6.
---------------------------------------------------------------------------------------------------------------------------------

mobhdr__common.c
< 0) {

1351 1352 1353 1354 1355 13 56 1357 1358 1359 1360

#if L i m JX_VERSION_CODE >= 0x2052a if (inetS add p r o t o c o l (&mipv6 m h protocol, sock_release(mipv6_mh_socket); mipvS_mh_socket = N U L L ) ; return -EAGAIN; } #else inetS add p r o t o c o l (&mipv6 mh p r o t o c o l ) ; #endif IPPROTO__MOBILITY) p r i n t k (KERlSr_ERR "Failed to r e gister MO B I L I T Y protocol\n" ) ;

---------------------------------------------------------------------------------------------------------------------------------

mobhdr_common.c

Figure 4-6: Registering Mobility Protocol

As shown in Figure 4-7, mobility headers are passed to the function m ip v 6 _ m h _ r c v ( ). Note that in the mobile node the primary responsibility o f the Binding Liaison module is the handling o f binding acknowledgements. There are additional mobility header types that the mobile node may encounter, such as the binding refresh request, however their function is not essential to the mobility of the mobile node and thus further discussion on these functions is not provided. W hen a binding acknowledgement is received control is passed to the function m i p v 6 _ h a n d le _ m h _ b a ( ). This function verities that the binding acknowledgement is valid. If the authentication fails, or there are any undefined values, then the packet is dropped. Once the binding acknowledgement has passed basic inspection, it is forwarded to the function m i p v d _ b a _ r G v d ( ) . If the status indicates an error the binding is deleted. Otherwise the binding is set to active status, and the lifetime is set to the value assigned by the binding agent. Once the callback function is configured the registration process is complete.

55

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

jnoijiidx c 0X1313017. c

mipv6_mh_rcv{)

xiojbhâx 71377. c

mipv6_handle_mh_ba{)

mipv6_ba_rcvd{)
Figure 4-7: Binding Liaison Process

The callback function is set to bul_refresh() and the callback time is set lo 4/5 o f the lifetime. This gives the mobile node a small window before the binding expires to tell the binding agent that it is still using the same care-of address, and as such the current binding should be maintained. In M obile IPv6 each binding update entry has only one possible destination, which is the binding agent that registers the care-of address. H owever, due to the advent o f local registration, the mobile node may correspond with two o r more binding agents for a single forw arding path. Therefore the mobile node must be able to determine which o f these nodes to send a binding update at each step during the handover process.

4.3 The Mobile Node
The model shown in Figure 4-8 visually depicts the com ponents in each o f the mobility agents. Readers will observe that certain modules exist on one or more agents. This does not necessarily mean that this module operates identically on each and every agent. Instead it may indicate that each mobility agent participates in the overall activity. For excmiple, both the home agent and foreign transmit domain advertisements as part o f movement detection. However, only the mobile node is responsible for processing these messages to detect a handover event. On the other hand, each process maintains its own binding update list which does not directly interact with the equivalent list o f any other process. This section describes the changes necessary to make the mobile node fram ework compliant. Each subsection wiU discuss one o f the modules required to operate this node.

56

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Hom e A gent
Movement Detection Binding Update List
F e tc h

Binding Liaison
U pdate

$
(rr?) F oreign A g e n t Binding Update List Binding Update List
Fetch

BU

BACK

"I'-

Route Repair
U pdate

Binding Liaison

/
Fetch

Movement Detection

Local Reg.
U pdate HI HACK BACK FBACK HI BU HA CK FBU BA CK FBACK

$ $
Movement Detection
C'A BU FBU

I
T
F e t' :h

BU Fetch

Handoff
P rRtAd V U pdate

Binding Update List

Binding Liaison
U pdate

M obile N o d e
Figure 4-8: M odular Decomposition of M obility Agents

4.3.1 Movement Detection
There are no significant changes to the processing o f router advertisem ents as the domain properties do not directly affect movement detection. H ow ever the advertisem ent is parsed into the router structure, which is later used for handover processing. Thus we must make two small modifications to the movement detection process to correspond with the changes w c had made to the router advertisem ent (radvd). The first is a change to the router structure to store the domain specific attributes. The second change is to the function mipv6_mn_ra_rcv() to parse these additional attributes into the new structure. The modified router structure is show n in Figure 4-9.

57

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

m d e t e c t .h
52 53 54 55
56

struct router { s truct l i s t _ h e a d list ; s truct i n 6 _ a d d r ll_addr; s truct i n 6 _ a d d r raddr; u8 l i n k _addr_len; u8 state; u8 i s _ c u r r e n t ; int i f i n d e x ; int p f i x _len; /* L e n g t h of the n e t w o r k p r e f i x * / u n s i g n e d long lifetime; __ u32 last_ns__sent ; u32 l a s t _ra_rcvd; /*W h e t h e r r a d d r c o n t a i n s a l s o r o u t e r s g l obal address*/ for e x a m p l e h a */ __ u32 interval; int glob_addr; ___u8 flags; /* R A flags, /*f r o m ra */ /* A l s o contains p r e f i x */ */ u8 l i n k _ a d d r [ M A X _ A D D R _ L E W ] ; /* l i n k l a y e r a d d r e s s

57 58 59 60 61 62 63 64 65 66 57 68 69 70 71 72 73

struct i n 6 _ a d d r CoA; int e x t r a _ a d d r _ r o u t e ; __ u3 2 l c a _ i d e n t i f i e r ; //for f r a m e w o r k a nd L M A s e l e c t i o n char scene; / / s c e n a r i o a d v e r t i s e d b y router, q u i c k r e f erence struct r o u t e r *next;

};

-----------------------------------------------------------------------------------------------------------------------------------------------------

mdetect.h

Figure 4-9; M odified Router Structure

4.3.2

The Binding Update list

Since the remaining m odules operate upon the binding update list the first priority is to make the binding entry and related adm inistrative functions fram ew ork-ready. H ow ever the only changes required are due to the need to support local mobility management. If each binding was to represent a single care-o f address w e w ould require some mechanism to indicate the relationship betw een the local and regional care-o f address. It would be much simpler to contain both addresses within a single binding. The range o f the state field is expanded to include the status o f bo th regional and local registration. Finally, the binding should also contain the foreign ag en t's link local address so that the mobile node will know w here to direct binding updates for this entry. Since only tw o fields are added to the binding entry structure there is little need to review the code here. Furtherm ore, only a small change is required to m i p v 6 _ b u l _ a d d to com pensate for the extra fields.

58

Reproduced with permission of the copyright owner. Further reproduction prohibited w ithout permission.

4.3.3 Handover P rocessing
There are two fundamental differences in handover processing betw een M obile IPv6 and the Fram ew ork for IPv6. The first difference is the mobile node's ability to handle different registration requkem ents. Secondly, as a result o f this ability, is the mobüe node's dependence upon the previous foreign agent. We have observed in the function m i p v 6 _ c h a n g e _ r o u t e r ( ) that the handoff structure akeady contains information about the previous router. This is a fortunate coincidence because M IPL never actually uses this information. Also in this function is the creation o f a care-of address fo r the new router. W e let the mobile node form the care-o f address and defer to subsequent functions to decide w hether or not to actually use this value. Once the handoff structure is completed control is passed to m i p v 6 _ m o b i l e _ n o d e _ m o v e d ( ) . Recall that this function is merely a w rapper function fo r m n _ h a _ h .a n d o f f ( ) and m n _ c n _ lia n d o f f ( ) , and that the latter is a process that we are not currently interested in. Therefore we move our attention to m n _ h a _ h a n d o f f ( ) . This function checks if the mobile node is either at hom e or returning home, o r w hether the mobile node is away. If the mobile node is at home it either deregisters or does nothing. If the latter is true, then the mobile node assembles the data necessary to make a binding entry. Regardless o f the mobihty protocol deployed in the access netw ork the process o f returning home remains constant. Thus no modification is requked with respect to deregistration, i.e. Plome Registration. H owe , er the process o f Local Registration is heavily dependent upon the hosting foreign agent. It is this portion o f m n _ h a _ h a n d o f f {) that calculates the values that are assigned to the binding update. Recall that Scenario A corresponds to M obile IPv6, and as such no modifications are necessary to support the mobile node in this state. To preserve this code we detour the remaining scenarios to m n _ c e f _ h a n d o f f {) , which dkectly calls s e n d _ b u _ m s g ( ) once it has assigned the appropriate values to the binding entry. Note that the function s e n d _ b u _ m s g {) constructs and transmits a binding update mobility header based upon the contents o f a binding entry. As such it is called from many places within the mobility software. It may be called here during handover processing, it can be called during retransmission or it may even be called upon the reception o f the binding acknowledgement to retransm it the update due to an error. W e m entioned previously that individual binding entries in M IPv6 correspond to a single binding agent, which basically requkes s e n d _ b u _ m s g {) to be a "copy and paste" function. The framework introduces an additional caie-of address and binding agent to the entry. Thus we modify this function to assess w here the binding update should be sent, and w hat values should be put into it. To achieve this it inspects the state o f the binding entry to determine w hether to send the binding update to the foreign agent to initiate local registration, o r the home agent for home registration. This in turn determines the values assigned to the binding update. 59

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4.3.4 Binding Liaison
W hen the mobile node receives a binding acknow ledgem ent it sets the appropriate binding entry to active and the registration process is com plete. This does n o t hold true fo r the Fram ew ork. In the Fram ew ork the binding acknow ledgem ent might only indicate the com pletion o f the first step in a two step process, as under certain conditions the mobile node may require both local and hom e registration. Thus, when m i p v 6 _ b a _ r c v d ( ) updates the binding entry's status, it must check the state for w hether further action is necessary. If registration is not com plete then s e n d _ b u _ m s g ( ) m ust be called to generate a new binding update based upon the en try 's new status.

4.4 The Foreign Agent
Figure 4-8 depicts a simplistic m odel o f the foreign agent. H ow ever, to achieve our objective, we are only interested in the com ponents that support local registration. This is due to the fact that route repair may be any one member o f an indeterminate set o f f votocols. This is in fact the second major benefit o f the fram ework. On the other hand w e must be aw are o f route repaii" in the m anner o f how it interfaces with local registration. There w ould be little transparency between processes if we needed to redefine the interface for every new protocol. This narrowing o f focus resolves to the following modules; binding liaison, local registration, the binding update list for local registration and movem ent detection. H ow ever we have already covered the topic o f movement detection in Section 4.1, such that no further discussion is required here.

4.4.1 Binding Liaison
The binding liaison on the foreign agent is merely the demultiplexing process described in Section 4.2.4. The IP layer passes the mobility header to this module, and from there it is determ ined w hether the m essage should be forw arded to either local registration or route repair. This requires code within the kernel, otherw ise the mobility softw are on the foreign agent w ould have to snoop every IP datagram for those containing mobility headers. This process is similar to that described in Section 4.2.4, while the dem ultiplexed functions specific to the foreign agent are shown in Figure 4-11.

60

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4.4.2 The Binding Update List
Each process has its ow n binding list that maintains information pertinent to that process's needs. In previous sections w e have discussed the binding update list supported by the mobile.node. It is a record o f the care-o f addresses it used and which binding agents supported them.

f a .h
23 24 25 26 27 28 29 30 31 32 33 34 35 }; Struct f a _ e n t r y i n 6 _ a d d r mn; __ ul6 sequence; int f_repair; int f _ r c o a ; int f _ c o a ; i n 6 _ a d d r status; __ ul6 mn_seg; __ u32 lifetime; struct in6_addr coa; struct i n 6 _addr I c o a ; struct bul e n t r y * n e x t ; { // a d dress of mn / / s e q u e n c e u s e d in this e n t r y / / r e p a i r request status / / rcoa req u e s t status //coa req u e s t status // r e s u l t of route r e p a i r //sequence used b y m n //lif e t i m e for b i n d i n g

fa. h
Figure 4-10: Local Registration Binding Entry

Local registration requires its own binding update list to keep track o f the progress o f all current registration requests. The fram ew ork provides a conceptual structure o f an entry in this list; this structure is shown in Figure 4-10. The draft also explains how it is to be used by local registration, which is discussed in the following section. Administrative functions associated with the binding list do not change with the nature of the list. There is still the need for adding, deleting and fetching entries, which are already available in M IP L that w e can reuse.

4.4.3 Local Registration
The operation o f local registration is relatively simple com pared to handover process maintained by the mobile node. This simplicity is due to the fact that Local Registration behaves the same regardless o f the scenario deployed at that foreign agent. The control flow o f this process is shown in Figure 4-11. L ocal Registration can receive input as either a request from Simple Handoff, or as a response from R oute Repair. M essages arriving from outside o f the foreign agent wiU always be dem ultiplexed from IPv6 to the function m i p v 6 _ m h _ r c v ( ) . This function inspects the mobility header fo r further demultiplexing; for our purposes we are only interested in the functions m i p v 6 _ h a n d l e _ m h _ b u ( ) and m i p v 6 _ f a _ h a n d l e _ b a ( ) .

61

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

The form er processes binding updates, which should be a registration request from a mobile node. O nce the mobility header has been parsed into a structure it is passed to another demultiplexing function: m i p v 6 _ b u _ a d d ( ). This function checks the type o f registration that has been requested and calls the appropriate function. D epending upon the configuration this allows a hom e agent to also act as a correspondent node, or it ahow s correspondent nodes to transmit binding acknowledgements indicating that hom e registration is not supported. W e add a third fimction for local registration: m i p v 6 _ b u _ a d d _ f a () . T he third function creates a binding entry for the request, ignoring any binding updates from mobile nodes for which the foreign agent is already processing a request; once this is done registration is handled by the function m i p v 6 _ f a _ h a n d l e _ r e g { ). The entry is inspected for each request that has not yet been processed and polls m i p v 6 _ f a _ _ h a n d l e _ r e p a i r ( ) for

mipv6_mh_rcvO

m ipv6_fa_handl6_ba()

mipv6_handle_mh_bu(}

mipv6_bu_add()

/
(repair)

m ip v6_b u_a d d_f a {)

\/
mipv6_fa_handl6_reg()

Finished
yes
\

no

m ipv6_send_b a()

mi p v6_f a_h a n d 1 e._r e p ai r{}

I I

Figure 4-11: Local Registration

62

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

answers. If there is a reply it is stored in the entry and the next request is processed. However, the lack o f a response from route repair indicates that the service was not available within the foreign agent and that action was required externally. At this point control leaves the mobility module and registration is resumed when Route Repair calls m i p v 6 _ f a _ h a n d l e _ r e g ( ). Route Repair is activated by an inbound mobility header, which can be any header defined by the Route Repair protocol but would most likely be a binding acknowledgement. Once aU of the individual requests within the entry have been processed a binding acknowledgment is created for the mobile node. The entry is deleted from the binding list and Local Registration is complete.

4.4.4 The Route Repair Interface
W e have observed that the interface between Local Registration and Simple Handoff requires the exchange o f messages external to the node that supports them, while the interface between Local Registration ind Route Repair is internal to the foreign agent. There is no need to construct a mobility header to be sent across the network. Instead we define the Route R epak API, which currently contains a pair o f well-known functions to handle the exchange o f messages; these functions are called m i p v 6 _ f a _ h .a n d .le _ r e g ( ) and m i p v 6 _ f a _ h a n d l e _ r e p a i r ( ). The former is called by Route Repair by passing a single structure containing the results o f a requested action. The latter is called by Local Registration by passing two arguments. The first argument contains the request, while the second will point to the response.

4.5 Fast Handovers
W e have previously discussed the operation o f Fast Handovers in Section 2.5. That section describes the additional messages required to support fast handovers. We have also discussed the changes necessary to support fast handovers within the Framework in Section 3.10. It would not be too difficult to implement this functionality into the mobile node and foreign agent. What has not been explained is the nature of how Mobile IP anticipates a handoff. Mobility Headers are a subset o flP , thus they operate on Layer 3. H owever a handoff is a change between physical links, a process that is controlled by Layer 2 (L2). Thus there must be a means of indicating anticipation, i.e. a trigger, from Layer 2 to Layer 3. Currently there is no support in Linux device drivers for anticipating a handoff; developing these triggers is a project unto themselves. On the other hand M IPL uses syscti to pass relevant arguments to the mobility module, such as a statefuUy configured caie-of address provided by DHCP. This system can be used to pass simulated L2 triggers to the module.

63

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4.6 Test Case
Our test case comprised o f a mobile node and foreign agent. We did not need to test the relationship between the home agent and the mobile node as this operation was not altered by our implementation; it is simply required to prove that this operation is initiated as described below. Test results were recorded using Ethereal and the Linux kernel logs. Running Ethereal on each node dem onstrates the control flow entering and leaving that node. Kernel logs record messages printed by the application which, while primarily used for debugging, indicate the occurrence of key events within a specific node. Using these tools we demonstrate the behaviour shown in Figure 4-12; note that this is only one mode of operation within the Framework and we do not reproduce all o f them in this report. Steps [1,2,7] were captured using Ethereal which verify the relationship between the mobile node and foreign agent. Steps [3-6] were recorded within the kernel logs verifying the Route Repair API. Finally Step 8, recorded using Ethereal, demonstrates that the mobile node initiates home registration after local registration is complete. Foreign Agent

Mobile
Node

Local Registration

Route Repair

Horne Agent

RA

BU

R e q ueri ,, Confirm

Request Confirm
BA

BU

Figure 4-12; Test Case

64

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4.7 Summary
The second objective o f the thesis was to create a prototype of the framework designed in Chapter 3. This prototype was to contain the basic elements required in the framework to provide mobility to the mobile node. These elements consisted o f home registration, local registration and simple handoff. Common themes in Mobile IP that were not included are fast handovers and route optimization via correspondent nodes. The selected components require support from the home agent, foreign agent and mobile node. Fortunately there is mobility software available under a pubhc license that can be reused to build the Framework. This software is known as M IPL and it provides the Mobile IPv6 protocol. This means that it has implemented the home agent and mobile node. Since the framework does not require changes to the operation o f the home agent no work was necessary on this node. H owever the mobile node required modification to all areas o f its operation to make it framework-ready. While the foreign agent is not provided for in Mobile IPv6 there is Neighbour Discovery software also available under a public hcense. The application is called radvd and, with some minor changes, provides domain advertisements for both the home and foreign agent. However the binding agent portion o f the Foreign Agent had to be developed from scratch.

65

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Chapter 5

Concluding Remarks

Mobile IP is a proposed standard that allows mobile nodes to retain IP connectivity while roaming between subnets. In M obile IP the mobile nodes retain their home addresses but change theii' care-of addresses while roaming from one subnet to another. The home agent intercepts packets destined to a mobile's home address and redkects them to its care-of address. Due to high registration latency o f care-of address with the home agent Mobile IP is used for inter domain mobility. Additional protocols are defined to manage mobility within a local mobility domain. Also enhancements to Mobile IP are defined to achieve seamless handover. These additional protocols serve either as alternatives or as enhancements to Mobile IP. Unfortunately these improvements cause their own problems with respect to deployment. Currently, if a mobile node is not upgraded to match the protocol supported by the access network then it cannot communicate with that network. This is a problem because the number o f mobile nodes can number in the hundreds for private networks. For service providers they could number in the hundreds o f thousands. It becomes especially problematic when the networking stack is implemented in hardware, such as for cell phones. In this thesis wc designed a Mobility M anagement Framework that solves the above problem by decoupling the mobile node from the route repair within the access network. This is primarily achieved by re-introducing the concept o f a Foreign Agent to serve as an interface between the mobile node and the access network. The framework is based on the model analogous to Internet routing system. In Internet hosts interact with the network through DFICP and DNS and do not interfere with the routing infrastructure such as OSPF and BGP. In our framework, we defined a standard handover signaling based on Mobile IP and Fast Handover. W e defined some extensions for Local Mobility Management. Tliis interface makes the method of mobility within the access network transparent to the mobile node. Thus new protocols may be implemented and deployed with no impact upon the mobile node. The framework allows any mobility management solution to perform route repair within the access network. The framework provides wireless ISPs great flexibility in deploying mobility management solution that is optimal for their network without engaging mobile users. It also provides flexibility to the vendors o f mobility management solution for they are not required to engage terminal vendors in the development and deployment of their solutions. It also saves terminal vendors from

67

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

customizing their terminal software and hardware for each mobility solutions. In summary, it facilitates all parties involved in the development and deployment o f mobility solutions. In our framework we introduced the abstraction o f mobility domain to define the scope o f a mobility solution. W e modified the router advertisement (or mobility agent advertisement) to include Local Coverage A rea Identifier (LCA) extension. The LCA I identifies a mobility domain. Our framework supports both tunneling-based and routing-based mobility solutions within a mobility domain, hence it allows a mobile node to either change or retain its care-of address within the mobility domain depending upon the solution employed within the domain. Wc also presented an example design of inter-working o f the fram ework with HMIPv6. W e dem onstrated the feasibility o f our framework by implementing a prototype o f the framework. To achieve this we reengineered a commonly used Mobile IPv6 software that is available as a freeware. The prototype contains the basic elements requked to support mobility, and as such does not support optional behaviour such as route optimization o r fast handovers. A nother significant outcome o f this w ork is the creation o f an Internet Draft (ID) to specify the operation o f a Mobility M anagement Framework. This ID is used to develop an implementation o f that Framework to demonstrate its properties. The implementation o f route repair within the framework is an ongoing activity in the Mo W IN lab. And in future when at least tw o route repair processes are implemented, then we can submit the ID to the relevant IETF working group for discussion and possible standardization.

68

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Appendix A
This document is based upon an internet di'alt titled "Mobility M anagement Fram ew ork" . This draft is a w ork in progress; the version which existed at the time this document was written is contained on the foUowing pages.

69

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Mobile IP Internet Draft

B. Hartwell Ryerson M. Jaseemuddin Ryerson February 2 004

Mobility Management Framework for IPv6 draft-hartwell-framework-00.txt

Status of this Memo This document is an Internet-Draft and is NOT offered in accordance with Section 10 of RFC2026, and the author does not provide the IETF with any rights other than to publish as an Internet-Draft. Internet-Drafts are draft documents valid for a maximum ofsixmonths and may be updated, replaced, or obsoleted by other documents at any time. It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress." The list of current Internet-Drafts can be accessed at http ://w w w .ietf.org/ietf/lid-abstracts .txt The list of Internet-Draft Shadow Directories can be accessed at http ://www.ietf.org/shadow.h t m l .

Abstract This document describes a mobility management framework which defines a "layer architecture" for mobility solutions. This primarily serves to make domain solutions transparent to the mobile node. To achieve this, the framework proxies registration on behalf of the mobile node. Domain transparency enables different protocols to be deployed within a network with no impact upon the mobile node. This is desirable to network administrators since domain infrastructure is minimal and accessible, while mobile nodes are numerous and have limited accessibility.

Hartwell, Jaseemuddin

[Page 1]

70

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

Table of Contents 1. Introduction................................... 2 1.1 Problem Statement........................ 2 1.2 Layered Registration..................... 3 Terminology.................................... 5 Domain Discovery.............................. 6 3.1 Domain Advertisement Message Format 6 3.2 Local Coverage Area Option Format....... 7 3.3 Additional Options....................... 8 Generic Registration.......................... 8 4.1 Domain Transparency...................... 8 4.2 Initiating Registration.................10 Framework Message Types...................... 12 5.1 Mobility Head e r......................... 12 5 .2 Framework Options....................... 13 Mobile Node Operation........................ 14 6.1 The Binding Upda t e ..................... 14 6.2 The Careof-Address..................... 16 Foreign Agent Operation...................... 17 7.1 Layer Issues........................... 17 7.2 L2-Local Request Primitives........... 18 7.3 L3-Repair Confirm Primitives.......... 18 7.4 Binding Update Li s t .................... 19 7.5 Processing Bindings.................... 2 0 7.5 Example: Processing aBinding Update...21 Fast Registration............................ 22 8.1 Nieghbour Discovery..................... 22 8.2 Mobile Node Operation................... 22 8.3 Foreign Agent Operation.................22 Security Considerations...................... 24 Acknowledgements............................. 24 Author's Addresses.......................... 25 Future Ob jectives/lssues..................... 25

2. 3.

4.

5.

6.

7.

8.

9. 10. A.

1. Introduction Several protocols exist, either as proposed standards or works in progress, that "allows nodes to remain reachable while moving around in the IPv6 Internet." [2] This document identifies a common problem among these protocols, and proposes a new protocol to overcome this obstacle. 1.1 Problem Statement One constant between each IP mobility protocol is the concept of the card-of address, and that these care-of addresses must be registered with a mobility agent. Each protocol differs in the nature of the care-of address and how it is registered, but every protocol treats registration as a single process. In effect, registration is non-layered.

Hartwell, Jaseemuddin

[Page 2]

71

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

This means that a new protocol will have an impact upon every mobility agent. Even if the protocol had minimal changes in terms of code, it would need to be distributed to every node involved in the registration. This includes mobile nodes that, in a worst case scenario, could be cell phones that can not be upgraded. At best it would be many laptops that have limited accessibility compared to the router infrastructure. 1.2 Layered Registration This document proposes a framework which layers the registration process. This is similar to the TCP/IP stack where similar functions are grouped into a single layer. When better code for those functions are available, only they need to be upgraded. When a new protocol is designed, only those functions need to be replaced. Note that the framework manages IP mobility protocols, and thus it operates solely within the IP layer. It does not dictate routing procedures, and as such does not require changes to IP. In terms of mobility the framework only directs the registration of care-of addresses; how each protocol uses that care-of address for routing is of no concern to the framework. It is a binding process only. A mobility layer architecture must be designed such that at least the mobile node remains isolated. The details of how the layers inter-operate is defined in later sections. This section is dedicated to discussing the design of the layer stack, as shown in the following diagram.

+ + -h 4 *+ + -I- + +

* !· + 1 - -h + + + + -I- {- + + + + + + -!· + + + * t*+ + 4- + * }- + + + + + 'H* -I*

Home Registration

Route I Repair | ++++++++++++++++++++++++++++ | Local | Fast | I Registration | Handovers | simple Handoff

I I

+ 4- + -4 - + 4 -f- 4- 4- + + 4- -f- 4- 4*+ + 4* + -f- + + + + 4- 4* + + 4-+ 4- + 4*+ + + + + + + + -t- -f*+

I I

I I

4-4-4"f'4'4*4-4*4-4*4' + 4'*t-4-4'4` 4*4"4*4*4*4'4-4*4-*l*4-4'4-4-H-4*4-4*4-4'4*4*4-4*4*4-4-4-

Figure 1

Before proceeding the authors wish to point out that 1,3-Repair (Route Repair) should extend across the stack but, due to implementation reasons. Home Registration is simplified into a single layer. Perhaps future versions of the framework will provide for a division in functionality (and at no cost to the mobile n o d e ) .

Hartwell, Jaseemuddin

[Page 3]

72

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2 0 04

Careful readers may observe that the upper layers directly correspond, to routers. Based upon this observation the reader may determine that Simple Handoff layer reflects the mobile node. As an example, Simple Handoff exchanges messages (BU/BACK) with the Registration layer. How Registration processes these messages is specific to that layer only, and a change in implementation has no deployment issues with respect to other layers/protocols. Yet why bother to make a distinction since in un-layered registration this functionality already resides in separate nodes? Obviously the internal workings of the home agent has no impact upon that of the mobile node, such that a layer for route repair here would be purely abstract. The advantage becomes apparent when one considers how registration is handled within the Access Network. If an AN was upgraded from MIPv6 to HMIPvS, to gain the benefits mobile nodes would need to understand the MAP option [12]. This requires a corresponding upgrade in mobile nodes. Though MIPv6 mobile nodes would not gain any benefits, these two protocols may inter-operate. However, other upgrades may prevent route establishment altogether. The goal then is provide a constant interface to the mobile node, making the inner workings of the AN transparent. The natural interface is the Access Router. Home Registration is primarily hosted by the home agent, while Local Registration and Fast Handoff are primarily hosted by access routers. Due to this relationship these protocols reside within a single layer in parallel. This is for security reasons; if control had to pass through an access router to a home agent then a security relationship must exist between these two nodes. Providing this security takes a long time to establish, and would likely exist for a short period of time. To avoid this registration begins with one protocol and finishes with the other, requiring only security relationships between the mobile node and its correspondents. Finally, the .reader should consider that this is a work in progress in its early stages. There are many issues that remain to be addressed; the current goal of this draft is to establish a conceptual foundation towards a new approach to IP mobility through the design of a basic framework. This framework is meant to replace MIPvG, least its design becomes flawed by inter-operability issues. However this document attempts to reuse as many terms, concepts and message formats as possible to facilitate a conceptual transfer between protocols. It also helps for code reuse. If some compatibility for MlPv6 mobile nodes is possible, all the better, but this is not a design objective.

Hartwell, Jaseemuddin

[Page 4]

73

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internat Draft

Mobility Management Framework

February 2 004

2. Terminology The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC-2119. This document defers to the Mobility Related Terminology draft for definitions. Further terminology is referred to in MIPv6 [2], LMM[4] , and FMIPv6 [6] documents, with exceptions as noted. rCoA - Regional Care-of Address A care-of address that is globally routable. This address may reside directly with the mobile node, or may be used in some intermediary manner to reduce the effects of micro-mobility. ICoA - Local Care-of Address An address assigned to the mobile node used by the local domain to direct packets within the access network. mCoA - Mobile Care-of Address A generic term for the care-of address that terminates at the mobile node itself. Thus it can be either regional or local. DA - Domain Advertisement A modified router advertisement specifying the mobility properties of the access network. FA - Foreign Agent An access router that participates in route establishment on behalf of the mobile node. The access router is mobile aware. TA - Tunneling Agent A forwarding node that can (de)tunnel packets bound for the mobile node. This acronym may be prefixed by the type of router: F (foreign), H (home) or L (local). BA - Binding Agent A node that participates in route establishment for mobile nodes. This could a Home Agent (HBA), Foreign Agent (FBA), etc. The BA may also be a TA. LI-Reg This layer processes Domain Advertisements and manages the Binding Update List.

Hartwell,

Jaseemuddin

[Page 5]

74

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

November 2 0

L2-Reg This layer acquires and registers care-of addresses upon request. It does not activate registration, nor does it garuantee successful registration. L3-Repair This layer maintains routes for care-of addresses. While it does not initiate repair, it may monitor status and issue warnings. It does not garuantee the existence of a route. MMF - Mobility Management Framework A layered process of registering care-of addresses. The framework DOES NOT dictate how those addresses are to be used. Base Handover Used in context of, and refers to. Fast Handovers Local Handover A fast handover that provides transient route repair [7]. [6].

3.

Domain Discovery This section introduces the concept of a Mobility Domain Advertisement (DA), which is simply a modified version of the Router Advertisement described in [2][9]. Each FA must periodically transmit domain advertisements.

3.1

Domain Advertisement Message Format The DA is a Router Advertisement [2] [9], with an additional two bits defined. A third bit for fast handovers is also provided. 0 1 2 3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 G 7 8 9 0 1
+ -- +"+ --H -- -f --4-- 4 -- + --I -- 4-- 4-- 4-- 4-- 4-- 4*`"4*" 4* --I --4 h --f'" 4*" 4*~4*~4''" 4-

I

Type

I

Code

|

Checksum
h~4- --I H--4

|
- 4-

-f- -- - 4" - 4

i-- 4-- 4- --1*" 4

1 -- 4*'"*l* --h " 4*'*4* --h ~ 4--4* --I -- 4* --l-*"4*" 'f- --1*" 4-- 4 -

I Cur Hop Limit

|M|0 |H|C|I|F |Res| Reachable Retrans

Router Lifetime Time Timer

| |

4*" 4-- 4*"'4*" 4- -- h*"4* --h --H- 4- --I -- 4-" 4-~4*" 4-- 4---- + -------- -----h " 4-- 4-- 4*" 4**'

- 4-- 4- - 4- - 4- - 4- --I *--h h " 4 '~ 4 -" 4-" 4*--I *

I
4-- 4'" 4*~4*" 4* --i-- 4*" 4-" 4-~4-- 4- - 4

i-- 4-- 4-~4-- 4- - 4- --4-- 4 '" 4'-4*~ 4*" 4-- 4---- 1 --4

I

|

4-- 4" --4- - 4-- 4* --4*" 4* --I -- 4*" 4* --4---- 1***4-" 4' --h*" *h --f*-4'~ + ~4*"'4-" " + --I -- 4-" 4**" 4-" 4---- f*~4*~4-- 4*" 4* --4-

I

Options

Hartwell,

Jaseemuddin

[Page 6l

75

Reproduced with perm ission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

Care-of Address

(C)

This domain requires the MN to change its GOA. Local Registration (I)

This domain supports local mobility management. Fast Handover (?)

This router supports fast handovers as described in this document. Reserved (Res) Reduced from a 5 -bit filed to a 2 bit field to account for the additional bits. In IPv6 care-of addresses are co-located. Thus the FA does not need to act as a TA, and in turn does not need to advertise a care-of address. Furthermore the DA does not contain rCoA information, for example the MAP option. Currently this is considered protocol dependent - the mobile node acquires a rCoA through registration. Future work may consider how to propagate rCoA prefix for autoconfiguation. 3.2 Local Coverage Area Option Format This extension helps the MN identify when to register a new rCoA with the HA. If the domain supports local registration it MUST include the LCA extension in its DA.
4" --+ --+ -- 4- -- I-- -- + -- I-- H -- + -- *î*"H-- +

I
+ --H -- + --+ " + + --f* --I + +

Type

I

Length
+"+"+ "+-- +

|
--h

--I'* +  " + --t* -- -f---+ " + " + " + 4-- H -4 -- + - 4 - - 4 - --4 --4 H -- -

I
4- - 4-- + " + " H

Local Coverage Area Identifier
+ " +"* i-- + ~ + " + ~ + 1 --4 '" 4-"` 4` '' + --k - 4- --
h

|

Type Length

· 10 The length of this extension in bytes, which is always 6. A semi-unique binary identifier that indicates which registration LCA this FA belongs to.

Identifier

The 32-bit identifier provides a unique identity within a geographical area., with values being recycled between areas. Note that this document does not require each FA to be uniquely identified, only the LCA that they belong to. The use of the identifier is described in detail in Section 6. Hartwell, Jaseemuddin [Page 7]

76

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

3.3 Additional Options Other options, as specified in Section 7 of M I P v S [2], MAY be included in the DA as appropriate*.

4.

Generic Registration: An Overview of the Framework Domain solutions are not entirely compatible with each other. Some support LMM, others allow a non-changing co-located COA [13]. A MN aware of only one domain-type will typically not be able to register when roaming to a different domain-type. How a particular protocol in the framework delivers packets to the mobile node is irrelevant. What is important is that the mobile node configures the appropriate types of care-of addresses sponsored by the access network and registers them. The framework is a binding process only. Thus the Domain Advertisement is more than a means of movement detection. It also states the properties of the access network in the form of the C, I and F flags. Generic Registration uses this to determine which one, some or all, of the upper layer protocols to activate: home, local or fast registration.

4.1 Domain Transparency The mobile node doesn't need to understand what a MAP is, only that a regional care-of address and local care-of address needs to be configured. This way another protocol can provide the same service without requiring upgrades to the mobile node. 4.1.1 Registration Scenarios To accomplish this all of the various "services" must be categorized. The following figure shows a list of possible topologies, along with the care-of addresses used to provide mobility.

++ + + ++ + ++ + + + + * [ *+  } ; +++++ ++ ++++++++ ++++++++ + } ++++++++ + ·+ + + + + + + + + + + + + + + + + + + +

A. B. C. D. E. F.

MN-HA MN-FTA-HA MN-(LMM)-HA MN-FTA-(LMM)-HA MN-HA MN-(LMM)-HA

changing co-located rCoA rCoA + changing co-located iCoA non-changing co-located rCoA rCoA + non-changing co-located ICoA

C=l,1=0 0=1,1=0 0=1,1=1 0=1,1=1 0=0,1=0 0=0,1=1

l*+ + + + + + + + + + + + + '+ '} ' *r + + +-4* + *f*l' + + + + + + + + + + + * 1 -- {' + + + + + + + + + + + + + -T + + + + + +

Figure 2

Hartwell, Jaseemuddin

[Page 8]

77

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

Every scenario has a mobile node, home agent and foreign binding agent (the last of which is now shown for simplicity). More advanced protocols may introduce intermediary steps, such as local mobility management (LMM). Note that FTAs do not exist in IPv6; scenarios B and D are shown here only for design issues and are not further discussed in following sections. The middle column indicates the types of care-of addresses made available by that scenario. Careful readers will observe similarities between these addresses, which are translated into the C and I flags shown in the third column of Figure 2. 4.1.1 The C Flag When the MN receives a DA with the C bit set it MUST change its mCoA. This would occur when the access network uses prefix-based routing as part of the mobility solution. Otherwise, if the protocol allows the mobile node to keep its current care-of address, then the C bit MOST be set to 0. The significance of C=1 is that the mobile node must register its care-of address with either a home agent or 1mm domain after every L3 handover. This may be either, or both, home and local registration depending upon the I flag. Aside from initial setup, 0=0 never needs to update its home agent after each L3 handover. However route repair is still required, and this is considered a form of local registration. 4.1.2 The I Flag The I bit indicates the presence of local mobility management. When the flag is set LMM is active, and when 'O' LMM is absent. "LMM schemes allow the Mobile Node to continue receiving traffic on the new subnet without any change in the Home Agent or Correspondent Node binding." [4] When absent registration is fairly straight forward, simply update your correspondents when your rCoA changés. However things change when the rCoA remains relatively constant. For LMM domains the framework mandates the existence of a rCoA and ICoA. The mobile node always registers the rCoA with its correspondents, but in the case of LMM the rCoA directs traffic to the Access Network instead of the mobile node. The AN then uses the ICoA to direct traffic to mobile node within its domain.

Hartwell, Jaseemuddin

[Page 9]

78

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

4.2 Initiating Registration 4.2.1 Registration Events Ll-Reg can be described as a state machine, though it need not necessarily be implemented that way. Visualize four states with each representing one of the topology scenarios described above. Technically other states are possible but they do not need to be discussed at this time. Figure 3 shows the proposed state machine. A transition occurs when a Domain Advertisement arrives at the mobile node, and this produces a Registration Event. Note that the MN can start in any state, as well as directly transfer to any other possible state. The event for "initial state" and any outside transition to that state are identical.

0/0 (LR)

V

------------ iE I <--- 0/0 (LR, HR)
- +

4----------------- +------------ + -----------------+

1/0

(HR) ---> I

A

I

I

F

J < -

0/1 (LR, HR)

0/1

(HR)
+ ---------

0/1/pLCA (LR)

O/l/nLCA (LR,HR)

1/1

(LR, HR)

---> I

C

1/1/nLCA (LR,HR)

l/l/pLCA (LR) Figure 3

Hartwell, Jaseemuddin

[Page 10]

79

^produced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

The legend associated with this table is as follows: #/# C/I pair input pLCA I nLCA previous | new LCA input LR Local Registration (output) HR Horae Registration (output) As an example we'll consider the most complex transition. The mobile node rests in State (scenario) A. It receives a DA with the C/I pair of O/l. The DA must also advertise a LCA Identifier, that in this case is new since the previous state had none. As a result the mobile node transfers to State F and as it does so it initiates Local Registration (L2-Local), followed by Home Registration (L2-Home).

+--

^

--+* "+ --f*--I --4

-- 4- --I

1 -- 4*" 4*" 4*" + **4

1 -- 4*~4-- 4

h

I I

I C

I I I

I I scenario E F A C I I I I

|

local I home | registration | registration j
4 *

4 .-- 4"-- 4""4- --4"--4"'"4' -- 4" --h --H-- 4-- 4* --(-- 4* --1*" 4* --H--4- -- 4- --I -- 4* --k -- 4- -- 4-i- --h --h --I --

.I 0 I 0 I I 0I 1 I

every time every time never every time

| first time only |
1 -------------------------- 1

4-------- 1 -------- 1 ------------------------------ 4---------------------------

! | |

new LCA every time new LCA

|
h

4"-----4---------H -

----------------------- 1 ------------------------------------------- 4----------------

I 1 I 0 I
+ -------- 1 - ------- +

| |

+ ---------------------------------------------------- + ---------------------------------------------------- +

I

1I 1 I

4-- 4- --f-" 4*~4-" 4` " 4'" 4-- 4-~4---- 1-~4-" 4-- 4-~4-" 4-" 4- --I -- 4 -- 4 .~ 4 --- f.~ 4 -- 4 -- + - 4- - 4-- -h" 4-

Figure 4

Figure 4 shows an alternative way of viewing registration events. Note that L2-Home refers to consecutive advertisings of the same C/I pair. If 0/0 was advertised followed by 1/0, returning to 0/0 would again require L2-Home for the "first time". Conversely, a "new LCA" does not mean a never previously discovered LCA, but rather a LCA that is different from the one advertised by the previous Foreign Agent. It is a (n-1) relationship only. 4.2.2 Flow of Control When the state machine "outputs" only one of the L2-Reg protocols, flow of control is simple. The mobile node directs a Binding update to that protocol and waits for a reply. If it was a success then the process is complete. Yet when both L2-Local and L2-Home is required to maintain a valid binding, then the mobile node MUST first initiate L2-Local. Only after this process has been completely determined as either a success or failure may the MN initiate L2-Home.

Hartwell, Jaseemuddin

[Page 11]

80

: Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

The purpose of this arrangement is as follows: a) In L2-Horae the MN registers rCoA, which it acquires during local registration (L2-Local). b) If the HA registration fails, the M l . ' can still converse with correspondent nodes (via rCoA). The MN may also converse within the domain using ICoA. c) It is a "two-shot" process since a single pass would require additional security resources. 1 L2-Local fails then the MN can still attempt the "default registration", where the mobile node partially pretends that it is in Scenario A. The difference is that the BU must contain a Type 0 Routing Header for a stopover at the foreign agent. This allows the foreign agent to inspect the BO to make sure it does not violate any properties of the domain, such as private space.

5. Framework Message Types The framework uses message formats defined in MIPv6 [2] for reasons described above. Some have been modified to adapt to the needs of the framework, while in other cases new options are defined. This section describes the message formats used by the framework. ' 5.1 Mobility Header The Mobility Header is an extension header used by all nodes which support mobility to create and manage bindings. All frar.ework options are contained within this header. The basic format of the header is unchanged from M I P v S [2]. 5.1.1 Unmodified Mobility Headers This version of the framework does not discuss, in detail, binding management with correspondent nodes. Thus the following message types are not mentioned: HoTI, CoTI, HoT, CoT, the Binding Refresh Request or the Binding Error. There is no change required for the Binding Acknowledgement message within the framework. 5.1.2 Binding Update Message The mobile node uses this message to notify other nodes of a new rCoA. Three bits have been added to this message to support binding proxy by the foreign agent. How this message is used is described in Section 6.1.

Hartwell, Jaseemuddin

[Page 12]

81

Reproduced with permission of the copyright ovi/ner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

4

H- 4---- h " 4---- 1 ---- 1

h" + ~ 4 -" + " 'l---- 1 ---- 1 ---- \

i

^

I
^ --4- -- -- +-- +-- -- -- " 4*" --

Sequence # Lifetime

| |

" 4-" 'I'" 4'" *4*~4*" + "'4* " + " 4"" + ~*l'""4"" 4* " "4"~'+

| a | h |L|k |R|d | c 1
--+ --^ -- -J. -- ^ --

Reserved

|

-- 4 * -- 4 " " 4 ' -- *l*" 4 ' " *i"' " 4 * * * 4 - ' " 4 ` ~ 4 ' ~ 4 " ~ 4 ' ~ 4 " " *J*" 4 * ~ 4 * " - J - ~ * h " 4 * " 4 ' " 4 * ~ 4 * ' " 4 * ~ 4 '

I
+

Framework Options ....

Local Route Repair

(R)

The mobile node requests route repair within the domain by setting this bit. Regional Care-of Address Request (D) This bit must be set to request a new rCoA within Otherwise it must be 0. Care-of Address Request (C) a LMM domain.

Used to request an acceptable CoA from a domain which allows the CN to retain its CoA between handoffs. Reserved Adjusted to an eight-bit field from a 12-bit field to account for the four flags defined above. These bits are set by the mobile node to direct on the type of action to take on its behalf. 5.2 Framework Options No new options are defined, but a new option may be specified i n subsequent documents. theforeign agent

Hartwell, Jaseemuddin

[Page 13]

82

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

6. Mobile Node Operation The framework describes the process of registration between the MN and AR. Section 4 described when to perform home or local registration. This section describes what the MN should do when the required registration type has been determined. 6.1 The Binding Update The MN must add the BU mobility header immediately after the IP header. The values set in the BU and extensions added vary between scenarios, so each will be discussed separately. In each case, the MN requires an acknowledgement and assuch MUST set the A bit. Unless stated otherwise, each flag in the BU must be set to 0 . 5.1.1 Scenario.A After receiving the DA, the MM MUST acquire a new CoA. This scenario does not require local registration, thus the MN sends a BU only to the HA (dst. address). The source address is the MN's home address. The H bit MUST be set to 1. The BU must contain an Alternate-CoA option holding the MN's new CoA. Note that this basic case is MIPv6 6.1.2 Scenario.C After receiving the DA, the MN MUST acquire a new CoA, which it can do using stateless autoconfiguration. Ensuing registration is determined fay the DA identifier. Home Registration; Each time the MN encounters a new identifier it must record the identifier and create a BU for the foreign agent. The source address is the mobile node's home address. The BU must include an Alternate-CoA option containing its (new) iCoA. The R and D bits MUST be 1. This .requests that the FA dynamically acquires a new rCoA from the domain, and bind the ICoA to this address. The MN will receive an acknowledgement from the FA with an option containing the rCoA. The mobile node must cache this address, but the MN does not use it for routing. The MN then sends a BU to the HA, with the home address as source. The BU must set the H bit to 1, and it must contain an Alternate-CoA option holding the mobile n o d e 's rCoA. [2].

Hartwell, Jaseemuddin

[Page 14]

83

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

In the packet the mobile node MUST include a type 0 Routing Header (next header=43). This header must contain one segment representing the foreign agent. This allows the foreign agent to inspect the BU and verify that the rCoA is not site-local. If the BACK from the FA was negative, the mobile node may replace rCoA in the binding update with its stateless-configured CoA. In this case the mobile node must delete the current LCA identifier and consider itself as existing in scenario.A. Local Registration: When the MN encounters the same LCA identifier, it must perform local registration with the foreign agent. The source address is the mobile node's home address. The binding update MUST contain an Alternate-CoA option holding the MN's rCoA. The mobile node must also include a second Alternate-CoA option containing its stateless-configured iCoA. This option MUST appear after the option containing the rCoA. To signal the FA, the BU must set the R bit to 1. The mobile node SHOULD receive one acknowledgement from the FA with no options included. 6.1.3 Scenario.E After receiving the DA, the MN MUST keep its current CoA. If this is the first time in the domain then the MN must statefully acquire its CoA via local registration. The mobile node constructs a binding update for the foreign agent, with the source address the MN's home address. The R and Cbits must be set to 1, and no options are required. The mobile node should receive an acknowledgement from the foreign agent, with an option containing its rCoA. The mobile must configure it's interface to this CoA, and then construct a binding update for the home agent. The source is the mobile node's home address, and the H bit must be set. Thereafter, the mobile node only needs to initiate route repair. To do this the'MN builds a binding update for the foreign agent. The source address should be the mobile node's careof-address. The R bit MUST be set. No options are required. The mobile node may instead use it's home address as source, in which case it must include an Alternate-CoA option containing it's CoA. 6.1.4 Scenario.F This scenario combines the actions of the previous two scenarios, as the domain supports 1mm and also allows the mobile node to
r e t a i n its I C o A w i t h i n the LCA.

Hartwell, Jaseemuddin

[Page 15]

84

Reproduced with permission of the copyright owner. Further reproduction prohibited w ithout permission.

Internet Draft

Mobility Management Framework

February 2004

Home Registration; Each time the MN encounters a new identifier it must record the identifier and create a BU for the foreign agent. The source address is the mobile node's home address. The R, D and C bits MUST be 1. This requests that the FA dynamically acquires a new rCoA from the domain, as well as statefully acquire its ICoA. L3-Repair will also bind these two addresses together. The MN will receive an acknowledgement from the FA containing two options. The first option has the mobile node's rCoA, which it must record, but MUST not use it for routing (i.e. tunneling) purposes. The second option contains the mobile node's ICoA, with it must configure its interface. Then MN then sends a binding update to the home agent, with the home address as source. The BU must set the H bit to 1, and it must contain an Alternate-CoA option holding the mobile node's rCoA. In the packet, the mobile node MUST include a type 0 Routing Header (next header=43). This header must contain one segment representing the foreign agent. This allows the foreign agent to inspect the BU and verify that the rCoA is globally routable. If the BACK from the FA was negative, the mobile node may perform stateless-autoconfiguration to acquire a rCoA. The MN sends a binding update to the home agent, with source as its home address. The BU must contain an Alternate-CoA option with its new rCoA. In this case the mobile node must delete the current LCA identifier and consider itself as existing in scenario.A. Local Registration: When the MW encounters initiate route repair. for the foreign agent. node's careof-address. required. the same LCA identifier, it only needs to To do this the MN builds a binding update The source address should be the mobile The R bit MUST be set. No options are

The mobile node may instead use it's home address as source, in which case it must include an Alternate-CoA option containing it's C o A . 6.2 The Careof-Address The following table shows what CoA value to register when building the BU. Note that except in scenario.A, the FBA will most likely populate the rCoA in the BU while proxying to the HA.

Hartwell, Jaseemuddin

[Page 16]

85

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

^-- + ~ - h -- I-- H --

--

^

M

- -f --+ - 4-- + " + -- l "~H-- 4* --+ " + " + " + " + -- 1*" 4*" 4*

I

C 1I

1 scenario E F A C

|
i 1 i

home

|

local current ICoA current ICoA N/A

4-------K - 4-h " 4 " * 4 * -4 -" 4------ \-----1 -- \

i*~4------ \---- 1 -~ 4 -~ 4 '" 4--*4---- h -- h - 4 ---- H- 4---- h'

I 0 I 0 I I 0 1 1 I I 1 I 0 I I 1 I 1 I

1 co-located rCoA | I LMA rCoA | |

+ ---------- 4--------+ -------------------------- + --------------------------------------------- + -----------------------------

+ ---- + ----+ ------------- + ----------------------- + ---------------

I co-located rCoA 1 LMA rCoA

+ ---- + ----+ ------------- + ----------------------- + ---------------

I co-located ICoA

+ --«f- --H -- + --+ -- --f- --h~4* -- --4- --^ -- --

--h " 4-- 4*" + *"4* --I ------ k --4--h " 4*~4* --f-

Figure 5 (Outdated)

7.

Foreign Agent Operation

7.1 Layer Issues The FBA is the primary host of L2-Reg. The FA is the topological interface to the access network, and thus in direct contact with the mobile node through router advertisements. That is why FAs are also referred to as Access Routers. Chosing a single node within the AW to host L2-Local creates a single point of failure. Increasing this number means an increase in bandwidth due to server discovery. However the FA is already active in neighbour discovery via D A s , and if the FA has outage then the mobile node can not link to the access network period. Some functions related to L3-Repair may also be located on the Foreign Agent to reduce response time. While the operation of L2-Repair is beyond the scope of this document (See Appendix C ) , the exchange of messages between layers must be defined. Since the layer interface resides within a "single" node, these primitives take the form of data structures. This is signifcant because all other service primitives, including those of peer layers and even operations within a layer, are transferred as IP datagrams. Appendix B defines service access points used in the experimental prototype. However, since this is system dependent, it is expected that this section will be moved to another draft in the f u t u r e .

Hartwell,

Jaseemuddin

[Page 17]

86

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

7.2 L 2 - L o c a l R e q u e s t P r i m i t i v e s

7.2.1

Initiate Route Repair

local_request_repair { 8 bits type 16 bits sequence 128 bits ICoA 128 bits rCoA

type sequence ICoA rCoA 7.2.2

'0' used to match request with confirm. address to be updated. address to bind with (may be null).

Request rCoA

local_request_rcoa { 8 bits type 16 bits sequence 128 bits iCoA

type sequence ICoA 7.2.3

'1' used data

to match request with confirm. for autoconfiguring rCoA (may be null)

Request ICoA

local_request_lcoa { 8 bits type 16 bits sequence

type sequence 7.3

'2' used to match request with confirm.

L3-Repair Confirm Primitives Repair Acknowledgement

7.3.1

local_confirm_repair { 8 bits type 16 bits sequence 8 bits code
}

type sequence code

'1' used to match request with status of repair action.

confirm,

Hartwell, Jaseemuddin

[Page 18]

87

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2 004

7.3.2

Configure rCoA

local_confirm_rcoa { 8 bits type 16 bits sequence 12 8 bits rCoA 8 bits prefix
}

type sequence rCoA prefix 7.3.3

used to match request with confirm. unique rCoA. prefix length of rCoA.

Configure ICoA

local_confirm_lcoa { 8 bits type 16 bits sequence 128 bits iCoA 8 bits prefix
}

type sequence ICoA prefix 7.4

used to match request with confirm, unique ICoA within the access network, prefix length of ICoA.

Binding Update List The FBA maintins a binding update list which contains an entry for every active request. Once the FBA has created a Binding Acknowledgement for a mobile node, it's corresponding entry is removed from the list. Each entry on the list contains the following fields: * The link local address of a mobile node from which a binding update was received. * The flags remaining Co be processed from the original BU. * The sequence number expected by the mobile node in the Binding Acknowledgement when its BU has been confirmed. * The sequence number used in the last request sent to L3-Repair. Each request must use a new sequence, equal to the maximum sequence number plus one (modulo 2**16) . * The regional care-of address provided by, or supplied to, the mobile node.

Hartwell, Jaseemuddin

[Page 19]

88

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2 004

* The local care-of address provided by, or supplied to, the mobile node. * Prefix lengths fields for both addresses. * An integer value representing the success or failure of route repair within the access network. 7.5 Processing Bindings The foreign binding agent will receive a binding update request from a mobile node. When this happens the FBA immediately creates a binding update list (BOX) entry for that mobile node. The entry will contain the mobile node's link local address and the sequence number provided in the BU. The entry MAY also contain either or both a rCoA and ICoA depending upon the nature of the request. These addresses will be contained in Alternate CoA Options. If more than one is present, then the first is the rCoA and the second is the ICoA. The entry will also initially contain the flags transmitted in the BU. If the flags H, X or K are toggled then the FBA must abort the creation of a BUL entry by sending a Binding Acknowledgment to the mobile node indicating that it does not understand the request. Furthermore, if the F bit is toggled it MUST be the only bit toggled. Further discussion of this type of request is de]ayed to later sections. That leaves the A, D, C and R bits. The acknowledgement is mandatory, its presence is assumed and need not be stored. It is the remaining bits that drives the operation of L2-Local. The following figure illustrates the order each bit must be processed in (if present), the L2-Local request primitive that must be sent to L3-Repair and the data this primitive must contain.

I Flag I Type I I I C D R I 1 I 2 1 0

| ICoA I NO

|rCoA | I NO I NO I |

+ --------+ ---------+ ----------- + ---+ + --------------- 4----------------- + -------------------- + ----- 4-

1SHOULD I MUST

4--------------- H-----------------4--------------------- 4--------------4-

IMUST |

4--------------- 4----------------- 4--------------------- 4--------------4-

Figure 6

Hartwell, Jaseemuddin

[Page 20]

89

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

When a confirm primitive arrives, the FBA identifies the BUL entry with the matching sequence number and populates the appropriate entry field. It then sets the flag for that request/ confirm pair to 0, checking afterwards if any remaining flags need to be processed. Once all flags are equal to 0, a binding acknowledgement is sent to the mobile node. 7.6 Example: Processing a Binding Update To demonstrate, consider a BU arriving at the FBA from mobile node A, and that it contains an alternate CoA option with A's autoconfigured ICoA. The flags D and R have been set. The FBA creates an entry for A with a confirm sequence equal to N, acquired from the BU. The flags D and R in the BUL entry are set to 1 and the ICoA field is populated with the value in the Alternate CoA Option. The FBA notices the first toggled flag by creating L2-Local request field is set to M, and this value sequence entry. The ICoA field is flag is D. It processes this primitive Type 1. The sequence is stored in the BUL's request equal to that of the BUL entry.

How L3-Repair processes this request is beyond the scope of this draft; however the ICoA value was provided to assist in forming a unique rCoA iff this method is applicable to the protocol currently deployed in the access network. L3-Repair creates a confirm primitive of Type '2' with a rCoA and matching prefix length provided by the domain. The primitive contains the sequence value M; the FBA finds the matching BUL entry and updates the rCoA and prefix fields. If the rCoA was null then the FBA MUST create binding acknowledgment for the mobile node indicating failure and then delete the BUL entry. The FBA sets the D bit to 0 and inspects the BUL entry for any further flags with a value of 1. It discovers the R flag and creates a request primtive Type 0. This primitive has the sequence M+1, which replaces the value stored in the request sequence field. The rCoA and ICoA primitive values are equal to those found in the BUL entry. How L3-Repair directs packets from rCoA to ICoA is beyond the scope of this draft. However the Type 0 request primitive informs the protocol that it must bind rCoA v;ith the new iCoA. When this is complete it generates the confirm primite Type 1 with a code indicating the success or failure. The FBA and set need to for the binding populates the BUL entry with the matching sequence number, its flag R to 0. The FBA discovers that no further flags be processed; it generates a binding acknowledgement mobile node (based upon the populated fields of the acknowledgement) and then deletes the BUL entry. [Page 21]

Hartwell, Jaseemuddin

90

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

B . Fast Registration A handoff solution refers to a process which reduces or hides the latency introduced by a handoff. In this case, latency is the period during which the HA/LMA delivers packets to the old CoA. In base handoff solutions, such as F M I P [5][6], control signals are restricted to foreign agents and mobile nodes. However some solutions, such as F-HMIP[7], extend into the access network. This section describes the interface between simple handoff and fast handover. An overview is also provided regarding how fast handoff protocols may operate within the framework. Specific operation is not provided because, like route repair, multiple protocols may be available for deployment. It is up to the network adminstrator to determine which one to use. Unless stated otherwise, message formats r^.or to those defined in Fast Mobile IP [6] . 8.1 Neighbour Discovery Neighbour Discovery operates precisely as specified by Fast Mobile IP. There is no requirement to advertise the C and I flags associated with MAR, nor does it need to advertise the local coverage area identifier. 8.2 Mobile Node Operation There are only two changes to the operation of the mobile node as specified by Fast Mobile IP: 1) The mobile node should be allowed to include its regional care-of address in the fast binding update. If present, this address must be contained in alternate care-of address option which must follow the PCoA's home address option. 2) The mobile node should retain "PCoA", as well as continue to receive packets destined for this address until indicated otherwise during local registration at NAR. 3.3 Foreign Agent Operation Since the fast handoff has a close association to local route repair, it also may have a wide varieity of operations. Thus it is impossible to provide a single specification on how to operate the foreign agent. The framework defines a layer boundary between the mobile node and the foreign. This is an innate interface in Fast Mobile IP, whose primitives are the fast binding update, fast binding acknowledgement and fast neighbour acvertisement.

Hartwell, Jaseerauddin

[Page 22]

91

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2 004

The remainder of this section is a set of suggestions on how to design fast handoff protocol to operate within the framework. 8.3.1 Scenario A Fast Mobile IP was designed for this precise scenario. Thus fast handoff SHOULD operate as specified by Fast Mobile IP without any modifications. 8.3.2 Scenario C Fast handoff MAY operate as specified by Fast Mobile IP. However, as discussed in [7], it may be more efficient to configure a transient tunnel located at the node that sponsors the mobile node's regional care-of address. The foreign next access agent's own established agent should inspect the local coverage area of the router. If this value differs from the foreign identifier then the transient tunnel SHOULD be as specified by Fast Mobile IP.

Otherwise the foreign MAY forward the FBU to the node sponsoring rCoA. This node will then exchange HI/HAck with NAR, after which it will send FBack to the foreign agent. The foreign agent will send a new FBack message to the mobile node whose source is its own. 8.3.3 Scenario E Fast handoff MAY operate as specified by Fast Mobile IP. However, since the mobile node's care-of address is not changing, it may be more efficient to bicast packets at the nearest common router. 0.3.4 Scenario F This scenario is a combination of the previous two. Thus, so long as PAR and NAR reside within the same local coverage area then the foreign agent may initiate bicasting. Otherwise fast handoff SHOULD operate as specified by Fast Mobile IP.

Hartwell, Jaseemuddin

[Page 23]

92

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

9.

Security Considerations The framework will utilize many of the security procedures discussed in M I P v 6 [2]. With the process of binding proxy, the framework creates additional security risk by reintroducing the foreign agent. Thus extra measures must be made to authenticate actions such as local registration. The foreign may also drop binding updates whose source address is not link local. However, since home and local registration are separate activities, the home agent does not need to be aware of security associations with foreign agents. Future versions of this document will include more security issues in detail.

10. Acknowledgements [1] C. Perkins. "IP Mobility Support for IPv4". Request for Comments (Proposed Standard) 3344. August 2002. [2] D. Johnson, et al. "Mobility Support for IPv6" (work in progress), draft-ietf-mobileip-ipv6-24.txt, June 2003. [3] E. Gustafsson, et al. "Mobile IPv4 Regional Registration" (work in progress). draft-ietf-mobileip-reg-tunnel-G7.txt, October 2002. [4] C. Williams, editor. "Localized Mobility Management Requirements" (work in progress), draft-ietf-mipshop-1mmequirements-OO.txt.txt, October 2003. [5] K. El-Maki, editor. "Low-Latency Handoffs in Mobile IPv4" (work in progress). draft-ietf-mobileip-lowlatency-handoffs4-07.txt, October 2003. [6] R. Koodli, editor. "Fast Handovers for Mobile IPv6" (work in progress), draft-ietf-mipshop-fast-mipv6-00.txt, March 2003. [7] H. Y. Jung, et al. "Fast Handover for Hierarchical MIPv6" (work in progress), draft-jung-mobileip-fastho-hmipv6-02.txt, August 2003 . [8] S. Deering, R. Hinden. "Internet Protocol, Version 6 (IPv6)". Request for Comments (Proposed Standard) 2460. December 1998.

Hartwell, Jaseemuddin

[Page 24]

93

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2004

[9] T. Narten,. et al. "Neighbor Discovery for IP Version 6 (IPv6". Reqeust for Comments (Proposed Standard) 2461. December 1998. [10] S. Thomson, T. Narten. "IPv6 Stateless Address Autoconfiguration". Request for Comments (Proposed Standard) 2462. December 1998. [11] J. Manner, M. Kojo, ed. "Mobility Related Terminology" (work in progress), draft-ietf-seamoby-mobility-terminology-04.txt, April 2003. [12] S. Heshara, et al. "Hierarchical Mobile IPv6 mobility management (HMIPv6)" (work in progress), draft-ietf-mipshophmipv6-00.txt, June 2 003. [13] A. Helmy, M. Jaseemuddin, and G. Bhaskera, "Efficient MicroMobility using Intra-domain Multicast-based Mechanisms (M&M)", 2002, ACM SIGCOMM Computer Communications Review , Vol. 32, No. 5, pp. 61-72, November 2 002.

Author's Addresses Bryan Hartwell Ryerson University Email: bhartwel@ee.ryerson.ca Mohammad Jaseemuddin Ryerson University Email: jaseem@ee.ryerson.ca

Hartwell, Jaseemuddin

[Page 25]

94

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Internet Draft

Mobility Management Framework

February 2 004

Appendix A - Future Objectives/Issues Topics are listed in order of importance. *Review Section 6 (some misplaced terminology, hard to read, etc.) Remove terminology describing framework layers as L I ,L2 & L 3 . * Add Appendix B : Service Access Points * Add Appendix C; Hierarchical Route Repair, A Brief Example (1 pg) Move all primitives to section 5 (i.e. those in section 7). Rewrite section 5. add correspondent nodes tackle security in detail; security as discussed in MIPv6 issues caused by reintroducing FA. Maybe something like Coti/Cot for FA? Consider applicability of summary-appendix, which reduces document to key actions (MUST, SHOULD, etc.) Why not send RtSolPr message as FBU ? Saves waiting on PrRtAdv.. . I think there is a reason, need to look it up, but it would reduce a lot of signaling in framework.

Hartwell, Jaseemuddin

[Page 26]

95

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Bibliography
[1] [2] [3] [4] [5] [6] [7] Jassemuddin, M. Private Communication, M ay 2003. M oy, J., "OSPF Version 2", RFC 2178, AprU 1998. Perkins, C. "IP Mobility Support for IPv4", RFC 3344, A ugust 2002. Johnson, D., Perkins, C., Arkko, J. "Mobility Support in IPv6", RFC 3775, June 2004. D rom s, R., et al. "Dynamic H ost Configuration Protocol for IPv6" , RFC 3315, July 2003 Deering, S. "ICM P R outer Discovery M essages" , RFC 1256, September 1991. N arten, T., Nordmark, E, Simpson, W. "Neighbor Discovery for IP version 6 (IPv6)" , RFC 2461, Decem ber 1998. [8] Williams, C., editor "Local Mobility M anagement Requiiem ents", draft-ietf-mipshoplmm-requii-ements-03.txt (w ork in progress), July 2004. [9] Hesham, S., et al. "Hierarchical Mobile IPv6 mobility management (HM IPv6)", draftietf-mipshop-hmipv6-02.txt (work in progress), June 2004. [10] A. Helmy, M. Jaseemuddin, and G. Bhaskera, "Efficient Micro-M obility using Intra domain M ulticast-based Mechanisms (M &M )" , 2002, ACM SIGCOM M Computer Communications Review, Vol 32, No. 5, pp. 61-72, November 2002. [11] [12] M anner, J., Kojo, M., editor "Mobility Related Terminology", RFC 3753, June 2004. Koodli, R., editor "Fast Handovers for Mobile IPv6" , draft-ieft-mipshop-fast-mipv602.txt (work in progress), July 2004. [13] H. Y. Jung, et al. "Fast Handover for Hierarchical MIPv6" (w ork in progress), draftjung-m obileip-fastho-hmipv6-03.txt, February 2004. [14] Ramjee, R., et al "HAW AII; A Domain-based Approach for Supporting Mobility in Wide Area Wireless N etw orks.", http://www.bell-labs.com/usr/ramiee/Dapers/hawaii.ps [15] A. V alko, "Cellular IP - A New A pproach to Internet H ost Mobility," ACM Computer Communication Review, Vol. 29, No. 1, Januai-y 1999, pp. 50-65.

97

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

[16] [17]

RADVD, http://v6w eb.litech.org/radvd, radvd-0.7.2.tar.gz M obile IPv6 for Linux, http://ww w .m obiIe-ipv6.org/softw are/. m ipv6-0.9.5.1v2.4.20.tar.gz

[18]

M cCann, P. "M obile IPv6 Fast H andovers for 802.11 N etw orks" (w ork in progress). draft-ietf-mipshop-8021 i fh-OG.txt, February 2004.

[19]

M anner, J., Kojo, R. "M obility Related Term inology" , draft-ietf-seamoby-mobilityterm inology-04.txt (w ork in progress), April 2003.

98

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

