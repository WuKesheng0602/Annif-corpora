A DOSE BASED METRIC TO ASSESS THE ACCURACY OF IMAGE REGISTRATION

by Stacy-Lee Annis B.Sc. University of Toronto, 2011

A thesis presented to Ryerson University in partial fulfillment of the requirements for the degree of Master of Science in the Program of Biomedical Physics

Toronto, Ontario, Canada, 2015 c Stacy-Lee Annis 2015

Author's Declaration

I hereby declare that I am the sole author of this thesis. This is a true copy of the thesis, including any required final revisions, as accepted by my examiners. I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research. I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research. I understand that my thesis may be made electronically available to the public for the purpose of scholarly research only.

ii

Abstract

A dose based metric to assess the accuracy of image registration
Stacy-Lee Annis Master of Science, Biomedical Physics Ryerson University, 2015

The relationship between dose mapped using two mapping methods (energy mapping method and voxel warping method) and registration error was examined. The correlation between the difference in doses mapped using these methods, defined as dose mapping difference (DMD), and landmark distance to agreement for a realistic lung patient plan using registrations of varying accuracy was examined. Results showed no correlation between DMD and landmark error. Further investigation on simple dose mapping geometries revealed a correlation of DMD with fractional volume (FVC) change induced by registration errors. A formula for DMD as a function of FVC was derived. Results of this formula agreed with simulated values of DMD with percentage differences less than 3.5% in regions of uniform dose. However, no agreement was found in regions containing a dose gradient. Further work is required in order to extend this formula to regions of dose gradients and scenarios that emulate realistic deformations.

iii

Acknowledgements

I'd like to acknowledge my supervisor Dr. Emily Heath, for the time and work she has put into this project, and my committee members, Dr. Carl Kumaradas, Dr. Lee Chin, and Dr. Catherine Beauchemin.

iv

To This thesis is dedicated to my mother and all my friends who helped keep me relatively sane during this process

v

Table of Contents
Author's declaration . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Abstract . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Acknowledements . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Dedication . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . List of tables . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . List of figures . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 Introduction 1.1 1.2 Lung cancer statistics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Introduction to radiation therapy . . . . . . . . . . . . . . . . . . . . . . . 1.2.1 1.2.2 1.2.3 1.2.4 1.3 The biological effects of radiation . . . . . . . . . . . . . . . . . . . Physics of dose deposition by external photon beams . . . . . . . . Types of radiation therapy . . . . . . . . . . . . . . . . . . . . . . External beam radiation therapy process . . . . . . . . . . . . . . ii iii iv v x xi 1 1 2 2 3 4 6 8 8 9

Motion in radiation therapy . . . . . . . . . . . . . . . . . . . . . . . . . . 1.3.1 1.3.2 1.3.3 1.3.4 Respiratory motion characteristics . . . . . . . . . . . . . . . . . . Measurement of respiratory motion . . . . . . . . . . . . . . . . . .

Effect of respiratory motion on delivered dose . . . . . . . . . . . . 10 Respiratory motion management . . . . . . . . . . . . . . . . . . . 13

1.4

Calculating dose in moving anatomy . . . . . . . . . . . . . . . . . . . . . 14 vi

1.4.1 1.4.2 1.5

Convolution . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15 Dose accumulation . . . . . . . . . . . . . . . . . . . . . . . . . . . 15

Deformable image registration . . . . . . . . . . . . . . . . . . . . . . . . . 17 1.5.1 1.5.2 DIR algorithms . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19 Methods to determine accuracy of DIR . . . . . . . . . . . . . . . 19 . . . . . . . . . . . . . . . 22

1.6 1.7

Impact of DIR accuracy on dose accumulation

Hypothesis and objective . . . . . . . . . . . . . . . . . . . . . . . . . . . 24 1.7.1 Organization of thesis . . . . . . . . . . . . . . . . . . . . . . . . . 24 27

2 Materials and Methods 2.1 2.2 2.3

Patient data . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27 Image registration software . . . . . . . . . . . . . . . . . . . . . . . . . . 28 EGSnrc Monte Carlo Code . . . . . . . . . . . . . . . . . . . . . . . . . . 29 2.3.1 2.3.2 2.3.3 2.3.4 BEAMnrc . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29 DOSXYZnrc . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31 defDOSXYZnrc . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31 Statdose . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32

2.4 2.5 2.6

Energy mapping code . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32 MMCTP . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33 Methods - Part 1: examination of correlation of dose mapping difference and landmark error . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 35 2.6.1 2.6.2 2.6.3 2.6.4 2.6.5 2.6.6 Image registration and evaluation . . . . . . . . . . . . . . . . . . . 35 Creation of input files using MMCTP . . . . . . . . . . . . . . . . 37 Simulations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 38 Calibration factor . . . . . . . . . . . . . . . . . . . . . . . . . . . 39 Calculation and analysis of dose mapping difference . . . . . . . . 39 Examination of correlation of landmark error and DMD using single beam plan . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 40 vii

2.7

Methods - Part 2: Investigation of factors that affect dose mapping difference (DMD) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 40 2.7.1 2.7.2 2.7.3 2.7.4 2.7.5 2.7.6 Simple dose mapping scenarios . . . . . . . . . . . . . . . . . . . . 40 Calculation of dose mapping difference . . . . . . . . . . . . . . . . 42 Development and testing of a formula for dose mapping difference 46

Investigation of correction factors for density changes . . . . . . . 47 Extending the DMD formula to account for dose gradients . . . . . 49 A high resolution dose profile . . . . . . . . . . . . . . . . . . . . . 51 55

3 Results 3.1

Examination of correlations of DMD and landmark error . . . . . . . . . . 55 3.1.1 3.1.2 3.1.3 3.1.4 3.1.5 3.1.6 Image registration and accuracy . . . . . . . . . . . . . . . . . . . 55 DMD-landmark error correlation . . . . . . . . . . . . . . . . . . . 55 Influence of dose gradient . . . . . . . . . . . . . . . . . . . . . . . 58 Investigation of trends for individual landmarks . . . . . . . . . . . 58 Influence of voxel size . . . . . . . . . . . . . . . . . . . . . . . . . 63 Correlation of landmark error and DMD using single beam plan . 64

3.2

Part 2: Investigation of factors that affect DMD . . . . . . . . . . . . . . 64 3.2.1 3.2.2 3.2.3 Dose mapping difference for simple dose mapping scenarios . . . . 64 Assessment of DMD formula: uniform dose scenario . . . . . . . . 66 Assessment of DMDnmm formula: non-uniform dose scenario . . . 71 77

4 Discussion and conclusions 4.1

Discussion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 77 4.1.1 4.1.2 Correlation of DMD with landmark 3D DTA . . . . . . . . . . . . 77 Investigation of impact of registration error in simple dose mapping scenarios . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 78 viii

4.1.3

Development and evaluation of formula for DMDnmm in a uniform dose distribution . . . . . . . . . . . . . . . . . . . . . . . . . . . . 78

4.1.4 4.2

Discussion of results of formula on dose gradient region . . . . . . 79

Limitations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79 4.2.1 Limitations of formula . . . . . . . . . . . . . . . . . . . . . . . . . 79

4.3 4.4 4.5

Conclusions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79 Future work . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 80 Outlook . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 80 81

Bibliography

Glossary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 87

ix

List of Tables
2.1 2.2 2.3 3.1 Image registration parameters used for Exhale to Inhale registration . . . 37 CT Ramp Data . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 38 Simulated Registration Errors . . . . . . . . . . . . . . . . . . . . . . . . . 54

Image registration accuracy evaluated using landmark DTA between landmarks on inhale and deformed exhale . . . . . . . . . . . . . . . . . . . . . 3.2 Average dose mapping differences across all landmarks for each registration 3.3 Landmark #68 analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3.4 Landmark #184 analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3.5 Comparison of simulated and calculated DMDnmm in uniform dose scenario 3.6 Evaluation of Batho and empirical density correction factors . . . . . . . . 3.7 Agreement of simulated and calculated DMDnmm with and without empirical correction factor . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3.8 Evaluation of DMDnmm formula for the 1 and 2 mm compressions and expansions on voxels on a region with a dose gradient . . . . . . . . . . . 3.9 Agreement of calculated and simulated DMDnmm using linear dose profile model (Equations 2.24 and 2.27) . . . . . . . . . . . . . . . . . . . . . . . 3.10 Agreement of simulated and calculated DMDnmm using sigmoidal dose profile model (Equations 2.29 and 2.30) . . . . . . . . . . . . . . . . . . . 3.11 Agreement of simulated and calculated DMDnmm using high resolution dose profile . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

57 58 63 64 66 71 72 72 74 74 75

x

List of Figures
1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 1.10 1.11 1.12 1.13 1.14 2.1 2.2 2.3 2.4 2.5 2.6 2.7 2.8 2.10 2.11 2.12 2.13 2.14 2.15 3.1 3.2 3.3 Dose depth curve for water . . . . . . . . . . . . . . Linear accelerator components . . . . . . . . . . . . Multi-leaf collimators . . . . . . . . . . . . . . . . . . Treatment planning volumes . . . . . . . . . . . . . . The steps of 4D-CT . . . . . . . . . . . . . . . . . . A comparison of a static dose and a convoluted dose The effects of dose deformation . . . . . . . . . . . . A depiction of the interplay effect . . . . . . . . . . . Overview of the dose accumulation workflow . . . . . The Dose Interpolation Method . . . . . . . . . . . . The Energy Mapping Method . . . . . . . . . . . . . The Voxel Warping Method . . . . . . . . . . . . . . Intrinsic and extrinsic landmarks . . . . . . . . . . . The McGill deformable lung phantom . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 6 7 7 10 11 12 13 16 17 18 18 20 21 30 31 33 34 35 36 38 41 44 47 48 48 49 52

The structure of the EGSnrc code system . . . . . . . . . . . . . . . . . . defDOSXYZnrc geometry elements . . . . . . . . . . . . . . . . . . . . . . The dTransform geometry elements . . . . . . . . . . . . . . . . . . . . . . The MMCTP configurations window . . . . . . . . . . . . . . . . . . . . . The MMCTP external beam tab . . . . . . . . . . . . . . . . . . . . . . . The MMCTP DVH window . . . . . . . . . . . . . . . . . . . . . . . . . . a) The coordinate system for the plan images b) the coordinate system for MMCTP . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . MATLAB GUI flowchart . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 mm compression . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Batho . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . TMR . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . TMR . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . A linear dose profile is derived from simple dose mapping geometries . . . High resolution dose profile . . . . . . . . . . . . . . . . . . . . . . . . . .

Registered Images . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 56 Dose simulation on inhale . . . . . . . . . . . . . . . . . . . . . . . . . . . 59 Dose mapping differences . . . . . . . . . . . . . . . . . . . . . . . . . . . 60 xi

3.4 3.5 3.6 3.7 3.8 3.9 3.10 3.11 3.12 3.13 3.14

Correlation of dose mapping difference and landmark errors . . . . The influence of dose gradients . . . . . . . . . . . . . . . . . . . . location of the landmarks . . . . . . . . . . . . . . . . . . . . . . . high resolution dose gradient analysis . . . . . . . . . . . . . . . . . Simple beam plan results . . . . . . . . . . . . . . . . . . . . . . . Registration error magnitude versus FVC for DMDmm . . . . . . . Registration error magnitude versus FVC for DMDnmm . . . . . . Registration error values versus values of DMDmm and DMDnmm Magnitude of DMDmm and DMDnmm against FVC . . . . . . . . TMR . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Modelling the dose profile . . . . . . . . . . . . . . . . . . . . . . .

. . . . . . . . . . .

. . . . . . . . . . .

. . . . . . . . . . .

. . . . . . . . . . .

60 61 62 65 65 67 68 69 70 71 73

xii

Chapter 1

Introduction
1.1 Lung cancer statistics

Lung cancer is the leading cause of death from cancer and the second most commonly diagnosed cancer in Canada in both men and women [1]. In 2012 the five-year survival rate for lung cancer was only 18%. It is responsible for 27% of all cancer deaths and represents 14% of all new cancer cases [1]. The leading cause of lung cancer is smoking. Other causes of lung cancer include second hand smoking, radon, and environmental or occupational causes such as exposure to chemicals, wood smoke, chromium, tar, arsenic, or asbestos. There are two types of lung cancer: non-small and small cell lung cancer (NSCLC and SCLC). Non-small cell lung cancer accounts for 85% of lung cancers while small cell accounts for the remaining 15%. NSCLC includes adenocarcinoma, squamous cell (epidermoid) carcinoma, and large cell (undifferentiated) carcinoma. Adenocarcinoma is the most common form of lung cancer in the US. It is found in the outer regions of the lung and is common in both smokers and non-smokers. It grows slower than other types of lung cancer and is often found before having spread outside of the lung, making treatment easier. Squamous cell carcinoma is made of flat cells that usually line the bronchial tubes. This type of cancer is strongly linked to smoking. Finally large cell carcinoma can be found in any part of the lung. This is the hardest type of lung cancer to treat since it grows and spreads quickly. Small cell lung cancer, on the other hand, is almost exclusively found in smokers. The cells are much smaller, have undefined cell borders, and have an indistinguishable cell nucleus. SCLC usually starts in the bronchi and spreads to other parts of the body very quickly. Common therapies for both palliative and curative lung cancer treatment include surgery, chemotherapy 1

CHAPTER 1. INTRODUCTION and radiation therapy.

1.2

Introduction to radiation therapy

Approximately 50% of cancer patients receive radiation therapy at some point during their treatment [2]. In this section the mechanisms by which ionizing radiation interacts with cells in the body and causes damage to cancer cells will be discussed. The equipment and process by which radiation therapy is delivered will also be described.

1.2.1

The biological effects of radiation

Ionizing radiation is the emission of high energy particles, either electromagnetic waves, ions or subatomic particles, that have sufficient energy to cause ionization of atoms. Ionizing radiation can cause damage to a cell's DNA both directly and indirectly. In direct actions, radiation causes ionization or excitation events in the DNA structure leading to breakage of the bonds. In indirect actions, water molecules are ionized releasing an electron and undergoing a series of steps that result in the production of a hydroxyl ion. The hydroxyl ion is a free radical, termed a reactive oxygen species (ROS), and is responsible for approximately two thirds of cell deaths from radiation. Damage to the DNA structure can be a single strand break or a double strand break. Single strand breaks are more common but easily repaired since the cell can use the second strand as a template to repair the broken strand. These breaks are often the result of sparsely ionizing x-rays. Double strand breaks occur when two strands that are opposite from one another or close together are broken and results in the chromatin snapping into two pieces. The interaction of two double strand breaks may result in cell killing, mutation, or carcinogenesis [3]. These are often a result of densely ionizing radiations such as neutrons or alpha particles. When the cell undergoes mitosis for cell division and encounters the damaged DNA strand, mitotic catastrophe occurs leading to necrosis. This is the most common form of cell death from radiation. The other form of cell death is called apoptosis, which is a protective mechanism that prevents the propagation of cells that have sustained a high level of DNA damage. In radiation therapy the goal is to deliver a lethal dose of radiation to tumour cells while maintaining a minimal absorbed dose to the surrounding tissues. Absorbed dose is a measure of the energy imparted to tissue through the ionization and excitation of atoms that make up the tissue. It is measured using the unit Gray, where 1 Gy is equal to 1 J/kg. The treatment is divided over many treatments, called fractions, such that the dose delivered per treatment fraction is approximately 2 Gy. Fractionation 2

1.2. INTRODUCTION TO RADIATION THERAPY allows for healthy tissues to recover while maximizing damage to cancer cells. As the tumour shrinks in response to the treatment, blood circulation is opened to tumour cells that previously had little circulation increasing the oxygen levels in those tissues, which increases the radio sensitivity of the tissue.

1.2.2

Physics of dose deposition by external photon beams

Ionizing radiation is grouped into two categories: directly and indirectly ionizing radiation. Directly ionizing radiation includes charged particles that undergo a Coulomb interaction with matter to directly cause ionization or excitation of an atom. Indirectly ionizing radiation includes uncharged photons and neutrons that interact with matter to release charged particles that then go on to participate in directly ionizing interactions. High energy photons can interact with tissue to deposit energy via three interactions; the photoelectric effect, Compton scattering and pair production. In the photoelectric effect, a photon interacts with a bound electron. The energy of the photon is used to overcome the binding energy of the electron and the remaining energy is converted into kinetic energy of the released electron. Compton scattering is the dominant interaction in the therapeutic energy range. In these interactions, a photon interacts with a loosely bound electron, transferring some of its energy to kinetic energy of the electron. This is an inelastic scattering interaction whereby the photon and the electron are scattered and energy is conserved. The scattered photon can go on to be involved in further interactions until all of its energy is depleted. In pair production, a photon with an energy above 1.022 MeV interacts with the Coulomb field of the nucleus to produce an electron and a positron. Electrons released through these interactions go on to deposit energy by excitation and ionization of atoms, either collisional interactions, such as bremsstrahlung interactions or radiative interactions. A bremsstrahlung interaction occurs when an electron interacts with the Coulomb field of the nucleus causing the electron to decelerate. The energy lost by the electron is emitted as a photon. The energy deposited through ionization and excitation is related to the absorbed dose (D). The formal definition of dose is equal to the expectation value of the energy absorbed, < Eabs >, divided by the mass, dm: D= < Eabs > dm (1.1)

Kerma, or kinetic energy released per unit mass, is a quantity that measures the amount of energy transferred from indirectly ionizing radiation, such as photons, to 3

CHAPTER 1. INTRODUCTION directly ionizing radiation, such as electrons, in the medium per unit mass [4]. Kerma = ( µen )  (1.2)

en where ( µ ) is the mass energy absorption coefficient, a term that describes that amount

of energy absorbed in a medium per unit mass, and  is the energy fluence, defined as the expectation value of the total energy (exclusive of rest-mass energy) carried by all the particles striking an infinitesimal sphere. Kerma consists of two components: radiative kerma and collisional kerma. Radiative kerma describes the amount of secondary photons produced and collisional kerma describes the amount of energy dispersed from electrons through ionization and excitation interactions. If the number of charged particles entering a region is equal to the number of charged particles exiting that region, that is, if charged particle equilibrium exists, absorbed dose is equal to collisional kerma. The contributions of radiative kerma are minimal, therefore absorbed dose is approximately equal to kerma. Typical depth dose curves for photon beams of different energies are shown in Figure 1.1. The depth where the maximum dose deposited is proportional to the beam energy. Beam energies that are characteristic of orthovoltage units (100 kVp) deposit their maximum dose at the surface whereas beam energies that are characteristic to linacs (4-25 MV) have a depth of maximum dose of up to 4 cm [4]. The dose delivered to the patient's surface is termed the surface dose. The relatively low surface dose for high-energy photon beams is of great importance in radiotherapy and is termed the skin sparing effect.

1.2.3

Types of radiation therapy

Radiation therapy treatments are classified as internal radiation therapy, also called brachytherapy, and external beam radiation therapy. Brachytherapy is a technique in which a radioactive source is placed inside or next to the area requiring treatment. It is a common treatment technique for cervical, prostate, breast, and skin cancers [5]. In external beam radiation therapy radiation can be produced using a cobalt unit, an orthovoltage unit or a linear accelerator. A cobalt unit relies on the natural decay of cobalt-60 which decays by emitting gamma rays with energies of 1.17 and 1.33 MeV. An orthovoltage unit is an x-ray tube which produces x-rays, typically of energies less than 600 keV. These energies can only penetrate to depths of approximately 6 cm limiting their use to treating skin, superficial tissues, and ribs. For deeper tumours, a medical linear accelerator is used which produces higher energy photon beams, ranging in energies from 4 MeV to 25 MeV. 4

1.2. INTRODUCTION TO RADIATION THERAPY

Figure 1.1: Depth dose curves for photon beams of energies ranging from 4 MV to 25 MV, as well as for 3.0 mm Cu HVL and 60 Co [4].

The linear accelerator, as seen in Figure 1.2, consists of five major components an injection system, a radiofrequency (RF) system, an auxiliary system, a beam collimation and a beam monitoring system. The injection system is a simple electrostatic accelerator also called an electron gun, and serves as the source of electrons in the linac. The RF system accelerates the electrons up to energies of 25 MeV using high frequency microwaves in a waveguide. The auxillary system consists of a vacuum pumping system since all electron production and acceleration must be done in a vacuum, a water cooling system, an air pressure system for pneumatics, a gas pressure system which supplies dielectric gas (SF6 ) to the waveguide and shielding to minimize leakage of radiation for the linac. After the electrons are accelerated in the waveguide they are transported to the target using magnetic steering and focusing devices. The electrons interact with the target atoms producing Bremsstrahlung photons. The beam collimation and monitoring system, found in the treatment head, use highly attenuating materials to shape, manipulate, and monitor the clinical x-ray or electron beam [6]. This system contains a flattening filter to ensure that the beam intensity is uniform, upper and lower jaws to shape the beam and multi-leaf collimators (MLCs) to fine-tune the shape of the beam as depicted in Figure 1.3. It is common practice to state the energy of a photon beam in `MV' which is the nominal accelerating potential used by the linear accelerator to 5

CHAPTER 1. INTRODUCTION

Figure 1.2: Components of a medical linear accelerator [6]. produce the photon beam. The output of a linac is a spectrum of photon energies whose mean energy is approximately 1/3rd of the maximum energy.

1.2.4

External beam radiation therapy process

The radiation therapy treatment process begins with imaging of the patient. For lung cancer patients CT images of the lung, which are used to plan the treatment, are acquired a few weeks before treatment begins. Organs are identified on the CT images and are contoured using treatment planning software. The International Commission of Radiological Units and Measurements (ICRU) has defined various volumes for planning radiation treatments as depicted in Figure 1.4. The gross tumour volume, or GTV, is the volume that contains the clinically detected tumour. The clinical target volume, or CTV, encompasses the GTV as well as lymph node groups and/or a region surrounding the GTV where microscopic disease is suspected. Outside of the CTV another margin is applied to form the planning target volume (PTV) which accounts for geometrical uncertainties in the locations of the CTV, for example due to patient setup errors. Common CTV-PTV margins are 7 mm in the thorax and abdomen and 3 mm for head and neck treatment [8]. Organs that are susceptible to radiation are defined as organs at risk (OARs). OARs have different radiation tolerances depending on the tissues involved. 6

1.2. INTRODUCTION TO RADIATION THERAPY

Figure 1.3: Diagram of a radiation beam defined by a multi-leaf collimator (MLC). The independently moving leaves of the MLC allow for the beam aperture to conform to the target volume (shown in gray) [7].

Figure 1.4: Illustration of the relationship between the target volumes used for radiation therapy treatment planning.

7

CHAPTER 1. INTRODUCTION They place constraints on the dose that may be safely delivered without causing side effects. The treatment plan is a set of instructions that define how many beams of what size and shape and from which angle will be used to deliver what energy of radiation. This plan is made by the dosimetrist. It is based on the prescribed dose to the PTV and the clinically predefined maximum doses that are considered acceptable to the OARs. Typical doses for radiation therapy of the lung, which are prescribed by the radiation oncologist, range from 60 to 70 Gy. The treatment plan undergoes a series of quality assurance tests which can include delivering a plan to a phantom and checking that the delivered dose matches the planned dose. When the patient comes in for treatment, tattoos, which were marked on their skin at the time of CT imaging, are used to align the patient with lasers on the walls of the linac room. This ensures that the target area is in the proper position. Immobilization devices are also often used to ensure consistent positioning between imaging and treatments and in-room imaging is used for target localisation during treatment. Finally the treatment plan is delivered to the patient.

1.3

Motion in radiation therapy

Since the delivery of a radiation therapy plan requires extreme precision, motion in radiation therapy is a great cause for concern. Internal organ motion occurs due to physiological processes such as respiration, cardiac and digestive functions. Respiratory motion is a periodic motion and it affects many treatment sites, most notably lung tumours and tumours in the upper abdomen. Cardiac function can also contribute to tumour motion for lung cancer sites at a frequency of 60 to 72 beats/min with an average magnitude of approximately 2 ± 1 mm [9]. Digestive functions, such as bowel and bladder filling cause motions in reproductive organ and abdominal sites such as the pancreas, liver and kidneys. However, these motions can be minimized by treating at the same time of the day and using the same dietary, bowel, and bladder preparations before each treatment [10].

1.3.1

Respiratory motion characteristics

During normal respiration, the lung volume changes by approximately 20% [11]. This translates into a volume of air displaced, which is termed the tidal volume, of 3.3 to 4.1 L. A study by Wang et al. found that for 43 lung cancer patients and 44 lung tumours the mean 3D motion magnitude resulting from respiratory movements was 3.5 ± 1.5mm and the dominant direction was the superior inferior direction [12]. The size of the tumour 8

1.3. MOTION IN RADIATION THERAPY was found to be inversely proportional to the magnitude of motion. Tumours that have an attachment to a rigid structure, such as the chest wall, vertebrae, or mediastinum, have a lower magnitude of motion. Tumours located near the diaphragm had the highest amount of motion, specifically those at the periphery of the lung, as well as solitary tumours located in the posterior segment of the upper lobe [12]. In prostate cancer patients, no movement due to respiratory motion is found when patients are treated in the supine position; however more than 5 mm of organ motion was found when patients were positioned prone [10]. Respiratory motion can also cause motion in liver sites, averaging at 4 ± 4 mm, 9 ± 5mm, and 5 ± 3 mm in the left-right, cranial-caudal, and anterior-posterior directions, respectively [9].

1.3.2

Measurement of respiratory motion

Respiratory motion can be measured using indirect or direct methods. In indirect methods tumour motion is derived from the motion of a surrogate. For example, the displacement of the patient's chest or the volume of air exhaled. Direct methods use imaging to measure the motion of the internal anatomy [13]. These methods include 4DCT and fluoroscopy. Tumour motion can also be measured by tracking implanted transponders. 4DCT imaging is the process in which many CT images are acquired at every position of interest along the patient's sagittal axis. Figure 1.5 illustrates the steps of a 4DCT acquisition. First the breathing phase of each image is determined based off a concurrently measured respiration trace. The images are sorted and binned according to the breathing phase making many 3D CT sets each corresponding to a particular breathing phase. The set of 3D CT image sets over all breathing phases forms a 4DCT set [7]. Challenges arise in 4DCT acquisition when the CT scanning speed is equal to or less than the tumour motion speed. If the CT scanning speed is much slower than the tumour motion speed the tumour image becomes smeared. When it is almost equal, the tumour position and shape become heavily distorted, resulting in lengthening or shortening of the target, or streak-like artifacts on the image. Additionally the centre of the target can be displaced by as much as the amplitude of the motion [14]. In fluoroscopy, an x-ray source and a detector are placed on either side of a patient in order to obtain real-time moving images of the internal structures of a patient. This procedure requires a continual exposure to x-ray radiation for the duration of the procedure. Multiple projections are required to measure organ motion in more than 1 direction. This procedure is limited to structures that are sufficiently radio opaque for adequate visualization and the benefit of this procedure must outweigh the risk associated with the radiation exposure. 9

CHAPTER 1. INTRODUCTION

Figure 1.5: A block diagram showing the steps of 4DCT acquisition including binning of images according to the breathing phase determined for a respiration signal [7]. The ability to measure tumour motion using x-ray imaging can be enhanced by using internal fiducials. For example, gold markers are implanted into the patient and monitored using continuous x-ray imaging. However this poses the risk of pneumothorax and marker migration [15]. An electromagnetic transponder-based positioning system has been developed that uses active markers which emit radiofrequecy signals that can be detected by a panel placed near the patient [16]. The panel contains source coils, which generate an oscillating electromagnetic field that induce a resonance in the transponder that can be detected when the source signal is shut off. The benefit of this technique is that it does not require imaging however these transponders are not currently being used clinically for lung cancer treatment sites due to difficulties in the implantation of the transponders into the lung.

1.3.3

Effect of respiratory motion on delivered dose

There are 3 main effects of motion on the delivered dose: blurring, deformation and interplay effects [17]. Because the target volume moves in and out of the radiation beam, the delivered dose has blurred edges and large beam penumbra at the field edges (see Figure 1.6). The edges of the target volume spend the least amount of time in the radiation beam and therefore receive the least amount of dose. At interfaces between structures of different densities and composition spatial varia10

1.3. MOTION IN RADIATION THERAPY

Figure 1.6: A comparison of measured and calculated dose profiles for a static plan compared to a convolution of the dose to represent the dose delivered on moving anatomy. The edges of the beam of the moving dose, depicted by the solid line, are blurred whereas the static dose, depicted by the dotted line, has a sharp edge [17].

11

CHAPTER 1. INTRODUCTION

Figure 1.7: Dose distributions calculated with the same treatment plan on inhale and exhale images. The changes in the location of interfaces and the densities lead to the dose deformation phenomena. If the inhale and exhale dose distribution was spatially invariant than there would be no differences between these dose distrbutions. The differences are normalized to the doses calculated on the inhale phase. Red is 1%, green 2%, dark blue 3%, yellow 4%, light blue 5%, and magenta 6% [17].

tions in the dose distribution also occur. This is called dose deformation and is a result of the dependence of the dose on density. For example, a comparison of the dose distributions calculated with the same treatment plan for inhale and exhale phases shows dose differences of up to 6%, normalized to the prescription dose (see Figure 1.7) [17]. This is a result of the change in lung tissue densities between the two phases. In intensity modulated radiation therapy (IMRT), a common radiation therapy delivery technique, MLCs are used to modulate the treatment beam as it is being delivered. Interplay effects occur when the target volume moves out of sync with the MLC movements and can drastically change the dose delivered to the target area and organs at risk. In Figure 1.8 if the target is represented by the white star then it receives the desired dose, however, if the target moves out of sync with the MLC motion, such as that depicted by the black star, then it is covered by the MLCs for the entire treatment and receives no dose. Yu et al. [18] found that the dose variations due to interplay effects strongly depends on the speed of the beam relative to the target motion. The maximum variation occurred when the speed of the beam approached the breathing motion speed. Although the maximum dose variation caused by the interplay effect for 1 field and 1 12

1.3. MOTION IN RADIATION THERAPY

Figure 1.8: A depiction of the interplay effect. The white star represents the desired synchronization of the MLC motion with the tumour motion. In this case the tumour is exposed to the radiation beam at all times. The black star shows the situation where the tumour is covered by the MLCs at all times resulting in no dose received by the tumour [17]. fraction was found to be up to 30%, the dose variation resulting from a 5 field plan after 30 fractions was less then 2% due to averaging [17].

1.3.4

Respiratory motion management

Because respiratory motion affects the delivered dose, it needs to be accounted for at the time of planning or delivery. Several methods to account for motion exist including tumour tracking, gating, breath hold, margins, and 4D optimization. In tumour tracking the tumour motion is monitored in real time. Tumour motion information is provided by internal or external markers. Internal markers include gold fiducials, which are implanted into the patient and monitored using continuous x-ray imaging. However, this poses the risk of pneumothorax and marker migration, and results in additional radiation exposure [15]. External markers include reflective markers placed on the patient's abdomen that are monitored using an infrared camera. A correlation model is used to relate the external motion to the internal motion of the tumour. Since there is a time delay between when the positional information is read and the beam motion is triggered, complex software is required to predict the target's location and adjust the beam. Tracking of the target motion can be achieved using the MLCs or couch motion. A specialized compact linac mounted on a robotic arm (Cyberknife) is capable of tracking the tumour motion based on combined internal and external motion monitoring [19]. In gating, radiation is delivered within a specified part of the breathing cycle called 13

CHAPTER 1. INTRODUCTION the 'gating window'. Although the delivery efficiency of the treatment is reduced due to the beam being intermittently turned on and off, this treatment technique is beneficial for patients with irregular breathing patterns. Beam gating can be based on breathing amplitude or phase. Similar to the tumour tracking method, fiducial markers, more commonly external, are used to monitor the breathing pattern. Other respiration monitoring techniques include placing a belt with a strain gauge around the abdomen, using a thermistor to detect changes in the air temperature of the exhaled breath and measuring the volume of exhaled breath using a spirometer [15] [20]. The most common method to account for motion in treatment planning is by applying an additional margin. The ICRU defines the internal target volume (ITV) as a geometrical construct that encompasses all variations of CTV due to physiological processes [21]. The size of the ITV depends on the extent of the motion that it is accounting for. In general, it is the overlap of all the positions of the CTV on all the different 4DCT images. The limitation of this method is that there is an increased volume of irradiated healthy tissue which limits the maximum dose that can be delivered to the target. It has been demonstrated that by planning on the average position of the tumour, called the midventilation image, the margin required for respiratory motion can be reduced [22]. Another approach, 4D optimization, models and considers the effect of the motion, including rotations and deformations, on the dose distribution during the treatment plan optimization. The treatment parameters are adjusted until the dose distribution that accounts for motion covers the CTV while sparing OARs as much as possible. This method takes into account patient-specific information such as breathing patterns. It considers what percentage of time is spent in each breathing phase in the treatment design and requires the ability to calculate the effect of the patient's specific respiratory motion on the dose distribution [23]. The advantage of 4D optimization over the use of an ITV is that it spares dose to healthy lung tissue [24].

1.4

Calculating dose in moving anatomy

Respiratory motion during radiation therapy alters the delivered dose distribution and therefore must be accounted for during treatment planning. Dose calculation algorithms that use the motion information to give an estimate of the delivered dose are used to assess the impact of the motion and to make treatment plans that incorporate this motion. 14

1.4. CALCULATING DOSE IN MOVING ANATOMY

1.4.1

Convolution

Since the dominant effect of respiratory motion is to blur the dose distribution, the effect of motion can be predicted by convolving a dose distribution with a motion kernel [25]. The limitations of the convolution method are that it assumes spatial invariance of the dose distribution delivered on different anatomies and cannot model differential motion.

1.4.2

Dose accumulation

Unlike the convolution method, in dose accumulation the dose deformation effects are accounted for. Dose accumulation is performed by calculating the dose distribution on different states of anatomical motion and then mapping the dose to a reference state. The doses are weighted depending on the time they spent in that motion state, and summed. The greater the number of motion states are used the more accurate the accumulated dose will be. In lung, the dose can be calculated on the phases of the 4DCT dataset. As seen in Figure 1.9 the first step for dose accumulation is obtaining a deformation vector field, which gives the correspondence between voxels in the reference CT and each phase CT. This is done using deformable image registration (DIR). The dose on all the CT sets are mapped to the reference anatomy where it is summed giving the total dose distribution. There are several dose mapping methods including dose interpolation method (DIM), energy mapping, and voxel warping. In DIM, the reference dose grid points are mapped to the target image using the vectors from DIR and the dose is estimated at the "tracked" locations using trilinear interpolation of the dose in neighbouring voxels [26]. In Figure 1.10 the target image is the exhale image. The dose at point C is mapped to the location C' on the inhale image. The dose at C' is interpolated using the doses at neighbouring dose grid points a, b, c, and d. The DIM is fast and straight forward to implement but one of the limitations is that the energy deposited in the target geometry is not conserved during the mapping which can affect the accuracy of the accumulated dose [27]. In the energy mapping method (EMM), vectors from DIR are used to map the energy deposited in a target image to the reference image as shown in Figure 1.11. The vectors created in DIR map from the target to the reference image, which is opposite to the direction of dose mapping. This was originally implemented using a Monte Carlo dose calculation algorithm. Particle transport is performed on a rectilinear coordinate system of the target image, and each energy deposition event is mapped to the reference image [27]. The reference dose is then calculated by summing the mapped energies, ei , in each 15

CHAPTER 1. INTRODUCTION

Figure 1.9: An overview of the dose accumulation workflow. Dose accumulation begins with a deformation vector field created using a DIR algorithm and ends by combining all the deformed doses on a reference image [7].

16

1.5. DEFORMABLE IMAGE REGISTRATION

Figure 1.10: A schematic depicting the dose interpolation method. The centre of the exhale dose grid point, C, is mapped onto the inhale scan, C', and the dose at this point is estimated by trilinear interpolation of the doses at the closest neighbouring dose grid points a, b, c, and d [26]. voxel and dividing it by the mass, m at that voxel: D= ei m (1.3)

In the voxel warping method, the dose deposition is calculated on a deformed voxel grid [28]. This requires a Monte Carlo dose calculation algorithm. The deformed grid is generated by applying the deformation vector field to the reference grid to deform it to match the target grid as shown in Figure 1.12. The dose is calculated in this deformed grid distribution and the grid is relaxed back to its reference state giving the reference dose distribution. A limitation of this method is that it is time consuming since Monte Carlo simulation of particle transport on a deformed grid is more difficult than on a rectangular grid.

1.5

Deformable image registration

As discussed in the previous section, in order to map the dose between geometries the voxel correspondence must be known. This is determined through deformable image registration. 17

CHAPTER 1. INTRODUCTION

Figure 1.11: In the EMM, energy depositions occuring in IS at xE are mapped to IR using the deformation vector field S R (x'E ).

Figure 1.12: In the voxel warping method dose deposition is calculated on the reference grid that was deformed to match the target grid.

18

1.5. DEFORMABLE IMAGE REGISTRATION

1.5.1

DIR algorithms

Image registration is the process of determining a spatial transformation that aligns features in one image to another image. It can be rigid or deformable. In rigid image registration only rotation, scaling, translation, and other affine transformations are possible. Whereas in deformable image registration local expansions and compressions of the image features are possible. Most DIR algorithms have two main components: a similarly metric and a regularization method. A similarity metric measures the similarity between two images. Images can be compared using the sum of squared intensity differences, cross-correlation or mutual information [29]. The regularization method ensures a smooth and physically realistic deformation and is determined by the transformation model. Commonly used transformation models include B-splines, optical flow, and the finite-element model (FEM) [30]. The output of a DIR algorithm is a set of deformation vectors for each voxel or control point of the image.

1.5.2

Methods to determine accuracy of DIR

The accuracy of an image registration can be assessed by comparing image intensities or anatomical features. The correlation between image intensities from the deformed target and reference images can be calculated [28]. The limitation of this method is that it lacks spatial information about the registration accuracy. The registration accuracy can also be quantified by the magnitude of the 3 dimensional difference between the measured motion of landmark coordinates identified on the target image and the predicted motion from the deformation vector field [28]. Examples of extrinsic (a) and intrinsic (b) landmarks are shown in Figure 1.13. Intrinsic landmarks are identifiable anatomical structures such as bifurcations of vessels or bronchioles in the lung and extrinsic landmarks are markers placed on the skin. The limitation of this approach is that it depends on the accuracy of the landmark identification and it is time consuming. Registration accuracy could also be assessed by distance to agreement (DTA) between deformed and target surface meshes derived from planning contours [28]. The limitation is that the accuracy of this method depends on the consistency with which organs are contoured on each image set. Although landmark analysis is a common method for determining the accuracy of DIR, it is not always completely accurate because it relies on the accuracy of the individually identified landmarks. Mencarelli et al. [31] performed an analysis of variance based 19

CHAPTER 1. INTRODUCTION

Figure 1.13: Intrinsic and extrinsic landmarks are shown in the circles [28].

validation to account for observer variation in the manual identification of landmarks for distance to agreement validation of DIR. Ignoring the impact of observer variations was found to lead to an underestimation of DTA by around 25%. Castillo et al. [32] also investigated the precision of the DTA method based on the number of landmarks identified. He found that the uncertainty of the DTA is inversely proportional to the square root of the number of landmark point pairs that are identified and the magnitude of the registration error. They found that the minimum number of landmarks required for a 95% confidence interval within 0.5 mm of the registration error was 1050 for the optical flow algorithm and 36 for the moving least-squares algorithms. Motion phantoms provide a solution to many of the limitations of landmark based accuracy assessment on patient images. The phantom's motion, density, and geometry should emulate a lung. It contains materials to represent a tumour and vessel bifurcations allowing for easily identifiable landmark and contour based analysis. Deforming phantoms have been made containing point dosimeters to monitor single dose reference points as well as two- and three-dimensional dosimeters such as film or radiosensitive gel. Serban et al. [33] developed a phantom that consists of a Lucite cylinder filled with water containing a latex balloon stuffed with dampened natural sponges as seen in Figure 1.14. The balloon is attached to a piston that mimics the human diaphragm. Nylon wires and Lucite beads were glued to various locations throughout the sponges to emulate vascular and bronchial bifurcations and a tissue equivalent tumour made using a thermoplastic elastomer was used which can hold radiochromatic film that measures radiation exposure. Kashani et al. [34] developed a phantom out of foam infused with iodine to obtain an attenuation factor comparable to that of a lung. This phantom contained various materials such as hard rubber, plastic, and porous foam to mimic four tumours of various densities and sizes as well as 48 small markers for landmark anal20

1.5. DEFORMABLE IMAGE REGISTRATION

Figure 1.14: In a deformable lung phantom the central area is made to emulate a lung and contains landmarks to facilitate automatic detection [33].

21

CHAPTER 1. INTRODUCTION ysis. This phantom was used to compare the accuracy of eight registration algorithms using CT scans of the phantom at inhale and exhale. The registration algorithm was used to determine the deformation vector field (DVF) between these two CT images and this DVF was applied to the landmark coordinates. The resulting deformed landmark coordinates was compared to the coordinates of the landmarks identified on the inhale CT scan. Average errors between the deformed landmark coordinates and the manually identified landmark coordinates ranged from 1.5 to 3.9 mm and maximum errors ranged from 5.1 to 15.4 mm. The maximum errors were found in areas near significant shape changes and areas with uniform contrast but large local motion discontinuity [35].

1.6

Impact of DIR accuracy on dose accumulation

The deformation vector fields produced from DIR are used in dose mapping therefore the accuracy of the DIR directly affects the accuracy of the dose mapping. The limitation of the methods used to evaluate the accuracy of DIR is that they evaluate spatial accuracy not the dosimetric accuracy. The correlation between spatial accuracy and dose mapping accuracy will depend on if there are gradients in the dose distribution. Therefore it is preferable to have a method to directly estimate dose mapping error. Several methods have been presented to validate the use of DIR for dose mapping. Murphy et al. [36] developed a statistical sampling procedure for spatially-correlated uncertainties in DIR. A Monte Carlo-like procedure was used where sample error maps generated by varying parameters of the DIR were added to the DVF to calculate the effect of the DVF errors on the dose mapping. This was also done using spatially uncorrelated DVF errors. It was found that dose mapping error from the spatially-correlated DVF uncertainties were different from that due to randomly distributed uncertainties. Greater DVF uncertainties resulted in greater dose mapping error. Zhong et al. [37] developed a method to automatically detect areas in an image that could result in high DIR inaccuracies. A finite-element-based elastic framework was used to calculate unbalanced elastic energy in each voxel resulting from application of a deformation vector field (DVF). Unbalanced energy (UE) in neighbouring voxels is a result of DVF errors since based on the principle of energy conservation and, ignoring the force of gravity at equilibrium, the strain energy that causes the tissue be distorted is equal to the work of all forces acting on the tissue. Therefore areas where the displacement caused by the DVF result in a strain energy that is not equal to the sum of elastic forces on that voxel indicates a DVF error [37]. Knowledge of the areas in an image where 22

1.6. IMPACT OF DIR ACCURACY ON DOSE ACCUMULATION high DIR inaccuracies are likely can give insight to the dose mapping accuracies in those areas. Zhong et al. [38] later validated this method by comparing spatial registration error with UE on nine prostate CT images. The average of the Pearson correlation coefficients between the unbalanced energy and standard displacement error (from contour based analysis) over the simulated registration instances was above 70%. The advantage of the UE-based assessment is that it can be automatically performed at each voxel and does not require knowledge of the ground truth in tissue deformation. Yan et al. [39] studied the accuracy of dose mapping using a method to evaluate dose errors for mass conserving deformations. For several regions of interest (ROIs), the dose mapped to the target image was compared to the mapped dose that was deformed back to the reference image using the inverse vectors. It was found that the largest dose mapping inconsistencies occurred close to the boundary between soft tissue and air. Similarly, Hub et al. [40] developed an approach to identify areas where dose mapping is likely to be inaccurate. In this approach small additional random deformations were added to the deformation vector field and the sum-of-square differences (SSD) of image intensities from a small area around each voxel after registration was computed. The largest spatial deviation between the deformation using the initial deformation field and each of the modified deformation fields that did not increase the local SSD was said to be equal to the uncertainty of the image registration. This method was also used to determine the uncertainty of the dose mapping. The largest deviation of the dose mapped using the initial deformation vectors from the dose mapping using the modified deformation vectors was determined and said to be equal to the uncertainty for the dose mapping. Salguero et al. [41] derived a dose mapping uncertainty at a point from the 3D spatial uncertainty of the DIR by calculating the dose gradient across a sphere centered at the point, with a diameter related to the spatial variance of the DIR and a factor related to the desired degree of confidence. As a result, large DIR errors that occur in areas of uniform dose result in minimal or no dose mapping error. The largest dose mapping errors occurred in areas of high dose gradient provided that the spatial uncertainty direction and the dose gradient direction were correlated [41]. Saleh-Sayah et al. [42] found that in areas of high dose gradients a spatial DIR accuracy of approximately 1 mm is required for accurate dose mapping. A tool, termed distance to dose difference (DTD), was used to determine the required accuracy of the vector fields used for mapping dose. In a previous study performed by our group, differences between the dose mapped using the voxel warping and energy mapping methods were noted. These differences were 23

CHAPTER 1. INTRODUCTION found to increase as the level of accuracy of the deformable image registration decreased [43]. The differences in mapped dose were attributed to differences in the geometries on which energy deposition is scored for the two methods. The voxel warping method scores the energy on a reference image dose grid that is deformed to match the target grid while the energy mapping method scores the energy on the rectilinear target dose grid. The scoring geometries differs due to spatial image registration errors, incorrect density values that result from registration errors, and difference in scoring volumes of deformed voxels compared to rectilinear target voxels. The results from this study did not show a straightforward correlation but for large registration errors the difference between the mapped dose increased. This dose mapping difference was further investigated by an undergraduate student for a single beam plan on a lung patient CT. The dose mapping difference, calculated as the absolute difference between VWM and EMM dose, was compared with the spatial DIR accuracy quantified by landmark analysis 3D distance to agreement for a single beam plan [44]. In some cases it appeared that there was a linear correlation between these quantities for a single-beam plan. However, this plan was not clinically realistic therefore further work on realistic patient plans is needed. Also, the influence of the dose grid resolution requires investigation.

1.7

Hypothesis and objective

The goal of this thesis project was to further investigate the correlation between difference in dose mapped by VWM and EMM and the registration error, quanitifed by the magnitude of the landmark error, for clinically realistic patient plans. It is hypothesized that dose mapping difference will be directly proportional to registration errors. Specific objectives included characterizing the effect of the dose gradient and resolution on the dose mapping difference.

1.7.1

Organization of thesis

Chapter 2 covers the materials and methods used in this study. Materials include patient data and treatment plans, image registration code, EGSnrc Monte Carlo codes, dTransform code, and MMCTP. The methods section is broken into two sections. The first section covers the methods that were used to examine the correlation of dose mapping difference and landmark error and the second section covers the methods used in the investigation of factors that affect dose mapping difference. Chapter 3 covers the results and is also broken up into the same two sections. The last chapter discusses the results for the correlation of dose mapping difference with landmark 3D DTA, the 24

1.7. HYPOTHESIS AND OBJECTIVE investigation of impact of registration error in simple dose mapping scenarios, and the development and evaluation of a formula for a uniform dose distribution as well as a dose gradient region. Next chapter 4 discusses the results of this project, the limitations, the conclusions, the future work, and the outlook.

25

CHAPTER 1. INTRODUCTION

26

Chapter 2

Materials and Methods
This chapter will first give a description of the image data and software used in this project. The methods section is split into two sections: the first section will describe the methods used to investigate correlation between dose mapping difference and landmark error. Since the preliminary results of this project were not consistent with the hypothesis, the decision was made to further investigate the nature of the relationship between dose mapping difference and registration error.

2.1

Patient data

4DCT data for a small-cell lung cancer patient who was previously treated at the University of Texas MD Anderson Cancer Center was provided by the Deformable Image Registration Laboratory (www.dir-lab.com) under ethics approval. This patient data had a tumour located in the lower left lobe with a volume of 132 mL and an average motion amplitude (and standard deviation) for respiratory motion of 11.10 (6.98) mm. Included with the 4DCT images were 300 manually identified anatomical landmark pairs for the maximum inhalation and exhalation phases and 119 manually identified landmarks on the intermediate phases of respiration [45]. Three independent observers manually identified a subset of 150 of the primary landmarks to find an intraobserver error of 0.97 mm with a standard deviation of 1.38 mm. The 4DCT images were imported into the Pinnacle treatment planning system at the Princess Margaret Hospital. All planning was done by a previous student, Gillian Ecclestone. The following planning structures were contoured on the exhale images: GTV, CTV, PTV, heart, carina, esophagus, spinal cord, left lung, and non-GTV lung. 27

CHAPTER 2. MATERIALS AND METHODS The GTV and CTV were also contoured on the inhale phase and an ITV was constructed by combining the CTV countours at exhale and inhale. A treatment plan was designed on the exhale image. The plan consisted of three beams to deliver a prescribed dose of 42 Gy. No PTV margin was used to ensure that the plan would be highly sensitive to motion.

2.2

Image registration software

The Automated Nonlinear Image Matching and Anatomical Labelling (ANIMAL) algorithm was used for deformable image registration of the patient 4DCT images. The output of the DIR is a deformation vector field (DVF) that describes the transformation between a target image and a reference image. The algorithm determines a 3D deformation field by minimizing an objective function which consists of a image similarity function and a cost function [46]. The cost function prevents unrealistically large deformations while the image similarity function maximizes the correlation between the target and reference image intensities. An advantage of the ANIMAL algorithm is its flexibility due to a large number of registration parameters. Adjustable parameters include the deformation lattice spacing, lattice diameter, sublattice radius, iteration weight, and smoothing weight. The deformation lattice spacing sets the spatial resolution of the vector field. The lattice diameter and the sublattice parameters determine the size of the region and number of samples used to evaluate image similarity in the neighbourhood of each node of the deformation lattice. The iteration and smoothing weights are related to regularization of the deformation vectors. Deformations are estimated iteratively and added to estimates from previous iterations. The iteration weight determines what fraction of the current estimate is added to the previous estimate. Smaller iteration weights result in smoother vectors but can compromise registration accuracy. After each iteration, the deformation vectors are smoothed by averaging over the 26 local neighbouring vectors [46]. The smoothing weight determines the relative contribution of this smoothed value. Several other software tools from the Montreal Neurological Institute (MNI) were used for determining the 3D DTA of landmarks. A visualization tool called Register was used for viewing landmark locations on the CT images. Other software was used to apply deformation vectors to landmark coordinates (transformtags) and to images (mincresample). 28

2.3. EGSNRC MONTE CARLO CODE

2.3

EGSnrc Monte Carlo Code

All dose calculations in this thesis were performed using the EGSnrc Monte Carlo software. EGSnrc (Electron-Gamma-Shower) is a package of computer codes for Monte Carlo simulation of coupled electron/positron and photon transport [47]. The radiation transport can be simulated in any element, compound, or mixture with atomic numbers ranging from 1 through 100 and for a range of particle and photon energies from a few keV up to several hundreds of GeV. As depicted in Figure 2.1 EGSnrc can be separated into two parts. The main EGSnrc code handles the physics of the simulation including particle transport while the usercode specifies the simulation geometry and quantities to be analyzed. The reason for seperating the usercode from the main code is that it provides flexibility to the user to make modifications to simulation geometry and output without having to modify the main EGSnrc code. In this thesis, we used the following usercodes: BEAMnrc, DOSXYZnrc, and defDOSXYZnrc. The basic process of a Monte Carlo simulation of radiation transport begins with an incident particle and a set of random numbers. The random numbers are used to sample the probability distributions describing the different possible interactions in order to determine where the next interaction occurs and what type of interaction it is. The particle is transported to the site of interaction and the change in energy and generation of secondary particles are simulated according to the physics of that interaction. The energy of the particle and its position are tracked and when the energy falls below a cutoff value the simulation is stopped. A large number of particles must be simulated in order to adequately sample the probability distributions so that an outcome with reasonable statistical uncertainty is obtained (below approximately 3%).

2.3.1

BEAMnrc

BEAMnrc is a usercode for simulating radiation therapy devices including x-ray machines and linear accelerators. It uses component modules, which consist of codes for modelling specific geometries that represent different parts of radiation therapy devices. This allows the user to model a unique therapy device from a series of component modules. The output is a phase-space file [48]. The phase-space file contains information about the position, energy, direction, charge and history of each particle at a specified plane in the linac model. In this thesis, BEAMnrc was used to generate phase-space files for each of the beams in the treatment plan. 29

CHAPTER 2. MATERIALS AND METHODS

Figure 2.1: The structure of the EGSnrc code system when used with a user-code [47].

30

2.3. EGSNRC MONTE CARLO CODE

Figure 2.2: An illustration of deformed voxel geometry in defDOSXYZnrc showing the deformation vectors that are applied at the nodes. Particle transport is performed on the deformed voxel grid.

2.3.2

DOSXYZnrc

DOSXYZnrc is a usercode that scores absorbed dose in a rectilinear geometry composed of rectangular voxels. The geometry can be manually defined by the user or generated from patient CT data. The latter requires a conversion of the CT intensities to density and material which are saved in an egsphant file. The radiation source can be a simple point source or a phase-space file from a BEAM simulation. The output of a DOSXYZ simulation is a 3 dimensional dose array that gives the average value and standard deviation of the dose deposited in each voxel. In this thesis, dose distributions on the target and reference phases were calculated using DOSXYZnrc. A GUI exists that allows the user to specify the source settings, geometry and Monte Carlo settings.

2.3.3

defDOSXYZnrc

defDOSXYZnrc is a 4D Monte Carlo dose calculation code that performs dose mapping using the Voxel Warping Method. It uses deformation vectors to deform the nodes at each voxel as seen in Figure 2.2. The voxel mass is conserved by adjusting the densities of the deformed voxels according to the change in volume. Incident particles are transported through the deformed voxels and dose is scored [49]. defDOSXYZ uses the same inputs as DOSXYZnrc, except a deformation vector file 31

CHAPTER 2. MATERIALS AND METHODS is additionaly required. These deformation vectors could be obtained from deformable image registration or manually generated. The defDOSXYZnrc also requires the reference geometry grid to be padded by an additional, undeformed layer. This is done in order to determine in which voxel a particle enters the phantom geometry. Similar to DOSXYZnrc, the output of defDOSXYZnrc is a 3 dimensional dose array.

2.3.4

Statdose

Statdose is a program that reads the 3D dose arrays output by DOSXYZnrc and defDOSXYZnrc and extracts dose profiles at a specified location and direction.

2.4

Energy mapping code

dTransform is a code that maps dose from a target image to a reference image using the Energy Mapping Method as depicted in Figure 2.3 [43]. This code requires as input the dose distribution on the target image, the deformation vector field produced from registration of the reference image to the target image, and the CT images of the target and the reference images. The dose distribution on the target image is mapped to the reference image using a volume overlap method; E (i) =
j T {V (i)}

D(j )(j )V (j )  T {V (i)}

(2.1)

where the energy mapped to the reference voxel i, E (i), is equal to the energy on the target image that is intersected by the volume of that voxel when it is deformed to match the target image, T {V (i)}. The energy on the target image is calculated from the dose, D(j ), the density, (j ), and the volume, V (j ) in the target voxel. The mapped energy is divided by the density multiplied by the volume of the voxel on the reference phase that corresponds to the voxel it was mapped from on the target phase.

D(i) =

E (i) V (i)(i)

(2.2)

Because image registration errors may cause energy to be mapped from a high density voxel to a low density voxel, causing a large variation in dose, there is a second version of dTransform that simultaneously maps the target geometry density distribution to the reference geometry in the same manner that the energy is mapped. In this thesis this version of dtransfom is referred to as the "mass mapping" version. 32

2.5. MMCTP

Figure 2.3: The deformation vectors are applied at the nodes and the reference dose is calculated using a volume overlap method on the target dose. The energy contribution from the central voxel is shown in brown but the energy in all voxels overlapped by the region bounded by the dashed line are mapped.

2.5

MMCTP

The McGill Monte Carlo Treatment Planning (MMCTP) system is a platform for importing treatment plans generated from commercial planning systems, such as Pinnacle, and converting them into input files for BEAMnrc and DOSXYZnrc simulations. Dose visualization and analysis tools are included to facilitate comparison of dose distributions calculated using different algorithms [50]. The basic functionality is illustrated in Figures 2.4 - 2.6. In the Configurations window (shown in Figure 2.4) the parameters related to Monte Carlo simulations are specified, such as the linac name, beam energy and input files specifying linac model. When a treatment plan is imported into MMCTP beam parameters such as gantry angles and collimater settings are extracted and displayed in the External Beam window (Figure 2.5). In the BEAMnrc tab the input files are generated for BEAMnrc and the simulations are launched. In the DOSXYZnrc tab the egsphant file and the dose input files can be made. The egsphant file is created using the CT images which are converted into a file that contains density and material information and then resampled to the desired dose calculation resolution. In the DVH tab, as seen in Figure 2.6, the user is able to create dose volume histograms (DVHs) for any structure that is contoured in the plan. 33

CHAPTER 2. MATERIALS AND METHODS

Figure 2.4: The Configurations window in MMCTP allows the user to set the linac name, model and energy, among other parameters related to Monte Carlo simulations.

34

2.6. METHODS - PART 1: EXAMINATION OF CORRELATION OF DOSE MAPPING DIFFERENCE AND LANDMARK ERROR

Figure 2.5: The External Beam tab lists the beam parameters that are set.

2.6

Methods - Part 1: examination of correlation of dose mapping difference and landmark error

2.6.1

Image registration and evaluation

Deformable image registration of the patient 4DCT data was performed using ANIMAL. The exhale image was used as the reference image. The registration was first performed using a large deformation lattice spacing, then the lattice spacing was progressively decreased for subsequent registrations to give higher image registration accuracy. The previous step's registration was always used as an initial estimate for the subsequent step. The initial lattice spacing was set to 32 x the image resolution, followed by 16, 8 and finally 4 x the image resolution for the last registration step. The parameters used for these registrations, listed in Table 2.1, were previously determined by a summer research student. The output of each registration was a deformation vector file containing the x, y, and z components of the deformation vectors. These deformation vectors were applied to the exhale image using mincresample and the transformed image was compared to the inhale image in order to visually assess the quality of the registration at each step size. 35

CHAPTER 2. MATERIALS AND METHODS

Figure 2.6: DVH tab in MMCTP allows dose volume histograms for any contoured structure to be compared for different plans.

36

2.6. METHODS - PART 1: EXAMINATION OF CORRELATION OF DOSE MAPPING DIFFERENCE AND LANDMARK ERROR Table 2.1: Image registration parameters used for Exhale to Inhale registration Registration Name 32 step 16 step 8 step 4 step Lattice Spacing (mm) 31.04, 31.04, 40 15.52, 15.52, 20 7.76, 7.76, 10 3.88, 3.88, 5 Sub-lattice diameter (mm) 110 60 40 20 # of sublattice nodes 20 20 16 10 Stiffness Weight # of iterations 5 10 10 6 Previous estimate none 32 step 16 step 8 step

0.3 0.3 0.3 0.3

0.9 0.9 0.8 0.9

A translation and rotation were applied to the deformation vector file in order to match the coordinate system of the plan images to that used in MMCTP. The y coordinates were inverted then a rotation of 90 degrees was performed to switch the y and z coordinates. Lastly, a shift of 1.358 cm was applied in the y direction corresponding to the y offset of the CT images in MMCTP. The registration accuracy assessment was evaluated quantitatively using landmark analysis. The deformation vectors obtained from the registration were applied to the landmark coordinates defined on the reference image using a code called transformtags. Next, the 3D distance to agreement between the transformed reference landmark coordinates;  (XR ),  (YR ), and  (ZR ), and the landmark coordinates on the target image; XT , YT , and ZT , was calculated using LandmarkError = X 2 +  Y 2 +  Z 2 (2.3)

where X =  (XR ) - XT , Y =  (YR ) - YT , and Z =  (ZR ) - ZT .

2.6.2

Creation of input files using MMCTP

A MATLAB code was used to convert the patient CT images in DICOM format to the format expected by MMCTP. The images and treatment plans were imported into MMCTP and input files for BEAMnrc simulations were created for each beam. A BEAMnmc model of a Varian CL21EX linac was used to simulate beam energies of 6 MV. Sufficient histories were simulated to obtain approximately 5 million particles for each beam. Two egsphant files were created in MMCTP with resolutions of 3x3x3 mm3 and 1x1x2.5 mm3 to be used as phantoms in the dose simulations. An additional 3 mm of 37

CHAPTER 2. MATERIALS AND METHODS

Figure 2.7: a) The coordinate system for the plan images b) the coordinate system for MMCTP air was added to the default phantom boundary in order to prevent voxels around edges of the phantom from collapsing once the vectors are applied. The CT ramp is a file that contains the data used to convert image intensities, in Hounsfield units, into tissue densities (Table 2.2). Table 2.2: CT Ramp Data Material AIR700ICRU LUNG700ICRU ICRUTISSUE700 ICRUBONE700 HU Low -1000 -950 -700 125 HU High -950 -700 125 2000 Min Density (g/cm3 ) 0.001 0.044 0.302 1.101 Max Density (g/cm3 ) 0.044 0.302 1.101 2.088

MMCTP was also used to generate the input file for the DOSXYZnrc and defDOSXYZnrc simulations.

2.6.3

Simulations

All Monte Carlo simulations were performed using the Kraken cluster of the Shared Hierarchical Academic Research Computing Network (SHARCNET). Cutoff energies were set to 0.7 MeV for electrons and 0.01 MeV for photons. Simulations were divided into parallel jobs in order to further improve computational efficiency. 500 million incident 38

2.6. METHODS - PART 1: EXAMINATION OF CORRELATION OF DOSE MAPPING DIFFERENCE AND LANDMARK ERROR particles were used for all low resolution DOSXYZnrc and defDOSXYZnrc simulations and 2 billion histories were used for all high resolution simulations in order to obtain equivalent statistical uncertainty values. defDOSXYZnrc simulations were run for each of the deformation vectors listed in Table 2.1.

2.6.4

Calibration factor

A calibration factor was determined in order to relate the Monte Carlo dose (DM C ), which is scored as dose per incident particle, to the dose output by the linac for the beam-on time specified by the number of Monitor Units (MUs) in the treatment plan. Linacs are calibrated to deliver 101 cGy in tissue at the calibration depth, zmax , per 100 MUs [50]. The calibration factor of 9.74035 × 10-15 cGy/particle was determined by performing a Monte Carlo simulation in water under the clinical calibration conditions of a 10x10 cm2 field size, a source to surface distance (SSD) of 100 cm, and depth at
D zmax (1.5 cm). Next the patient dose [ particle ]patient from the Monte Carlo calculation

was expressed in terms of absorbed dose per monitor unit as follows:
D [ particle ]patient Dparticle (cGy ) 1.01cGy × f ractions × = D MU 1M U [ particle ]calibration

(2.4)

The number of MUs for beams 1, 2, and 3 were 95, 97, and 64 and the number of fractions used was 25.

2.6.5

Calculation and analysis of dose mapping difference

dTransform was used to map the dose using the Energy Mapping Method by applying the deformation vectors of the registrations listed in Table 2.1. Both versions of dTransform, with and without mass mapping, were used. First the dose distribution was calculated on the inhale phase using DOSXYZnrc and then the Exhale-Inhale deformation vectors from the image registration were used to map this dose to the reference (exhale) phase. The dose mapping difference, DMDmm, was calculated using; DM Dmm = |DV W M - DEM M mm | (2.5)

where DV W M is the dose mapped using the defDOSXYZnrc and DEM M mm is the dose mapped using the dTransform with mass mapping. When using the Energy Map39

CHAPTER 2. MATERIALS AND METHODS ping Method with no mass mapping we have DM Dnmm = |DV W M - DEM M nmm |, (2.6)

where DEM M nmm is the dose mapped using the dTransform with no mass mapping. The dose mapping difference was extracted for the voxels that overlapped the landmark locations. A MATLAB user interface was programmed to produce correlation graphs of landmark error and dose mapping differences. The Monte Carlo dose distribution files for each beam were loaded into the GUI. The dose values in each voxel were divided by the appropriate calibration factor in Equation 2.4 then the dose delivered for each beam was summed to give the total dose. This interface provides the option to plot absolute dose mapping difference or percentage dose mapping difference, where percentage dose mapping difference is equal to the absolute dose mapping difference normalized to the prescription dose. The statistical uncertainties in the MC dose calculation were propagated for all dose mapping difference calculations.

2.6.6

Examination of correlation of landmark error and DMD using single beam plan

Preliminary results found no clear correlation between dose mapping difference and landmark 3D DTA. Therefore, one of the experiments performed by a former student, Christiane, was repeated as an independent check. A 10x20 cm2 parallel beam (source 1) with energy of 2 MeV was centered on left lung on the Exhale CT image. The beam was incident from the left anterior side of the patient. 4.5 × 108 histories were used for the DOSXYZnrc and defDOSXYZnrc simulations. The 4 step deformation vectors were used for defDOSXYZnrc simulations and dTransform dose mapping. No coordinate system transformation was necessary in this experiment.

2.7

Methods - Part 2: Investigation of factors that affect dose mapping difference (DMD)

2.7.1

Simple dose mapping scenarios

To investigate the relationship between registration errors and the difference in the mapped doses using VWM and EMM, a simple dose mapping scenario was created. In this scenario the reference geometry was made to match the target geometry with a 1 40

2.7. METHODS - PART 2: INVESTIGATION OF FACTORS THAT AFFECT DOSE MAPPING DIFFERENCE (DMD)

Figure 2.8: A flowchart showing the functionality of the user interface created in MATLAB for data analysis

41

CHAPTER 2. MATERIALS AND METHODS to 1 correspondance so that no transformation was required to map the target geometry to match the reference geometry. The reference and target geometries were composed of 10 voxels, 10x10x.3 cm3 in dimension, stacked along the z axis with density values of 1 g/cm3 and material set to water. The dimensions ranged from -5 cm to 5 cm in the x and y directions and 0 to 0.3 cm in the z direction. The voxel size along the x and y directions was chosen to be 10 cm in order to eliminate the effect of the buildup region for beams entering from the side. 3 mm was chosen for z direction length since this is similar to the dimension used for the previous dose simulations in Part 1. Two scenarios were investigated: a scenario with uniform dose over the voxels and a scenario with a dose gradient over the voxels. In both scenarios a parallel monoenergetic photon beam with rectangular collimation and energy of 2 MeV was used. In the first scenario, a uniform dose was created by directing the incident beam parallel to the direction of voxel deformation, entering from the top (Figure 2.9). The beam size was 10x10 cm2 . In the second scenario a 1x1 cm2 beam was directed at the geometry perpendicular to the z axis in order to achieve a dose gradient region. All geometries and beams were defined using the EGSnrc Monte Carlo Code and all dose simulations were performed using the DOSXYZnrc code. Deformations were manually imposed on the reference geometry to simulate registration errors. 10 different registration errors (Table 2.3) were simulated by manually moving the voxel boundaries and changing the densities to conserve mass in each voxel. These deformations affected voxels 10-12 for the parallel beam and voxels 1-3 for the perpendicular beam scenario. The first of these cases was a 1 mm compression of voxel 2 as depicted in Figure 2.10. The upper boundary of voxel 2 was moved from its undeformed position at 0.6 cm to 0.5 cm. The density in voxel 2 was changed from 1 g/cm3 to 1.5 g/cm3 and the density in voxel 3 was changed to 0.75 g/cm3 . Table 2.3 provides a detailed list of all simulated registration errors including the frational volume change (FVC), which is the ratio of the deformed volume to the undeformed volume, and changes in densities.

2.7.2

Calculation of dose mapping difference

DOSXYZnrc was used to calculate the dose in both the target and manually deformed geometry. 1 million incident particles were used for all simulations to give a statistical uncertainty of 3% or less for the dose in each voxel. EMM dose values were obtained by performing manual calculations using the simulated registration errors and the dose values on the target geometry. For example, in the case of a 1 mm compression of voxel 2 (refer to Figure 2.10), the energy in target voxel 42

2.7. METHODS - PART 2: INVESTIGATION OF FACTORS THAT AFFECT DOSE MAPPING DIFFERENCE (DMD)

(a)

(b)

Figure 2.9: Illustration of the two reference geometries. a) A beam parallel to the direction of voxel deformation was used to produce a uniform dose field in the voxels of interest and b) a beam perpendicular to the direction of deformation of the voxels was used to produced a dose gradient region over the voxels of interest.

43

CHAPTER 2. MATERIALS AND METHODS

Figure 2.10: A registration error of a 1 mm compression of the upper boundary of voxel 2 was simulated by moving the upper boundary of voxel 2 (a) down by 1 mm (b). The density values of each voxel were changed to conserve mass resulting in an increased density for voxel 2 and a decreased density for voxel 3. The deformed geometry overlaying the reference geometry is illustrated in (c).

44

2.7. METHODS - PART 2: INVESTIGATION OF FACTORS THAT AFFECT DOSE MAPPING DIFFERENCE (DMD) 2, 7.80 Gy, was found by multiplying the dose by the mass of the voxel, where mass is found by multiplying the density of the voxel by the volume; 1 g/cm3 × 30 cm3 = 30 g, converting to kg we have 0.03 kg. Energy is equal to; 7.80 Gy × 0.03 kg = 0.234 J (2.8) (2.7)

The mapped energy was calculated by multiplying the energy in target voxel 2 by the ratio of the volume of deformed reference voxel 2 to that of the overlapped target voxel 2, 0.67 in this case. 0.67 × 0.234 J = 0.157 J (2.9)

For EMM with mass mapping the dose was calculated by dividing the mapped energy by the mapped mass; 0.157 J = 7.80 Gy 0.67 × 0.03 kg (2.10)

and for EMM with no mass conservation the dose was calculated by dividing the mapped energy by the mass of reference voxel 2; 0.157 J = 5.23 Gy 0.03 kg (2.11)

Dose mapping differences were calculated in each voxel of interest using Equations 2.5 and 2.6. The value of DMDmm: DM Dmm = DV W M - DEM M and DMDnmm: DM Dnmm = DV W M - DEM M nmm (2.13) (2.12)

were also calculated for each voxel of interest. The dependence of the absolute and magnitudes of dose mapping difference with and without mass mapping on the absolute and magnitude value of registration error and fractional volume change were investigated. 45

CHAPTER 2. MATERIALS AND METHODS

2.7.3

Development and testing of a formula for dose mapping difference

Initial results indicated a correlation between the magnitude of DMDnmm and FVC, therefore the task was redefined to derive a relationship between these two quantities. It was decided to focus on the non-mass mapping case as it showed a stronger correlation. Dose was assumed to be equal to collisional kerma, therefore;

EM M nmm Dr =(

µen Vdr )t t ×  Vt µen )dr dr 

(2.14)

V WM Dr =(

(2.15)

EM M nmm and D V W M are the doses mapped from the target to the reference where Dr r

geometry using the Energy Mapping Method with no mass mapping and the Voxel Warpen en ing Method, respectively, ( µ )t and ( µ )dr are the mass energy absorption coefficients

for the target and deformed reference materials,  is the energy fluence, Vdr is the volume of the deformed reference voxel, and Vt is the volume of the target voxel. Equation 2.14 is valid for the case where a voxel is compressed. For the non-mass mapping case:
V WM EM M nmm DM Dnmm = Dr - Dr

(2.16) (2.17)

DM Dnmm = (

µen µen Vdr )dr dr - ( )t t ×   Vt

Given that the mass energy absorption coefficient is independent of density changes, the mass energy absorption coefficient on the deformed reference will be equal to that on the target; DM Dnmm = ( Vdr µen )t (dr - t × )  Vt (2.18)

and assuming that the energy fluence on the deformed reference is equal to some correction factor, CF, multiplied by the energy fluence on the target we have;

DM Dnmm = (

µen Vdr )t t × (CF - )  Vt = Dt × (CF - F V C )

(2.19)

DMDnmm values were calculated using this equation for voxels 1, 2, and 3 of the 46

2.7. METHODS - PART 2: INVESTIGATION OF FACTORS THAT AFFECT DOSE MAPPING DIFFERENCE (DMD)

Figure 2.11: An illustration showing the setup in a Batho heterogeneity correction factor calculation

uniform dose scenario using all cases of simulated registration error and for voxel 3 of the dose gradient scenario using the first four cases of simulated registration error. The percentage difference between the calculated and simulated DMDnmm was used to determine the accuracy of the formula for DMDnmm.

2.7.4

Investigation of correction factors for density changes

Changes in voxel volumes result in changes in density values which affect the dose absorbed. In Equation 2.19 the effect of the density changes was represented by a correction factor, CF. The Batho heterogeneity correction factor and an empirically derived correction factor that account for this effect were investigated. The Batho correction factor is given by the following equation: CF = T M R(d1 , rd )1 -2 T M R(d2 , rd )1-2 (2.20)

where T M R is the tissue maximum ratio calculated using the depth of the point within the heterogeneous material and using a field size equal to that at the level of the point of interest [51], 1 and 2 are the densities within and above the heterogeneity, and d2 is the depth of the point as illustrated in Figure 2.11. T M R is equal to: T M R(d1 , rd ) = D(d1 , tissue , rd ) D(dmax , tissue , rd ) (2.21)

where D is the dose and dmax is the depth of maximum dose in tissue material overlaid with enough air to achieve the same source to point distance as illustrated in Figure 47

CHAPTER 2. MATERIALS AND METHODS

Figure 2.12: A diagram showing the depths used in the calculation of TMR [51]

Figure 2.13: An illustration showing the geometries used for the development of the empirical formula

2.12. The ratio of the dose in water at a depth correponding to the center of voxel 2 to the dose at dmax overlain with air was used in this calculation. The value of dmax was estimated to be 1 cm using the average dmax values taken from several dose simulations in water. An empirical correction factor was also derived by performing simulations on a uniform geometry matching the target geometry with modified density values in voxel 2 as depicted in Figure 2.13. The ratio of the dose in voxel 2 with modified density to the dose with unit density was plotted against the fractional volume change that would result for this density value to obtain an equation describing the relationship between density changes and fractional volume change as seen in Figure 3.13. 48

2.7. METHODS - PART 2: INVESTIGATION OF FACTORS THAT AFFECT DOSE MAPPING DIFFERENCE (DMD)

(a) Target geometry

(b) 1 mm compression (c) 1 mm expansion gegeometry ometry

Figure 2.14: Schematic diagram of geometries and quantities considered in derivation of equation for DMDnmm for dose gradient scenario.

2.7.5

Extending the DMD formula to account for dose gradients

Equation 2.19 does not account for dose gradients. When a dose gradient is present across voxels, the effect of dose averaging over the deformed voxel volume must be accounted for in DV W M . Therefore it is important to accurately model the dose at different locations along the dose profile, corresponding to the center of voxels, in order to calculate the VWM dose value when registration errors are present. The EMM dose values are not affected by the dose gradient since DEM M is calculated by multiplying the target dose value by the fractional volume change. In order to calculate VWM doses the dose profile was fitted using linear and sigmoidal functions. 2.7.5.1 Linear model of the dose profile Initially, a linear model of the dose profile penumbra region was used to calculate VWM dose values in voxel 3 as illustrated in Figure 2.14a. In the case of a compression of voxel 3 the center of voxel 3 moves down towards voxel 4 as illustrated in Figure 2.14b. Assuming voxel compressions only of voxel 3, while voxel 2 expands, VWM dose values were calculated using:

DV W M = DT 3 + [(

m2 + m3 1 - FV C ) × zres × ( )] 2 2 49

(2.22)

CHAPTER 2. MATERIALS AND METHODS where DT 3 is the dose in voxel 3 of the target geometry, m2 is the dose gradient between voxels 2 and 3 and m3 is the dose gradient between voxels 3 and 4, zres is the resolution
VC in the z direction and F V C is the fractional volume change. zres × ( 1-F ) represents 2

the amount that the center of voxel 3 shifted down. The average of the dose gradients between voxels 2 and 3 as well as between voxels 3 and 4 was used since the voxel compressed down towards voxel 4. For compression cases the EMM dose value is equal to the fractional volume change multiplied by the dose in voxel 3: DEM M nmm = DT 3 × F V C DMDnmm was calculated for compression cases using; DM Dnmm = DV W M - DEM M nmm = [DT 3 + ( m2 + m3 1 - FV C ) × zres × ( )] - (DT 3 × F V C ) 2 2 (2.24) (2.23)

For cases of expansion of voxel 3 into voxel 2, the dose value at voxel 3 was taken as the initial dose, then the gradient between voxels 2 and 3 was used to compute the dose in the deformed voxel (Figure 2.14c). The following equation was used to solve for the VWM dose of voxel 3: DV W M = DT 3 - m2 × zres( FV C - 1 ) 2 (2.25)

C -1 ) represents the amounts that the center of voxel 3 shifts as a result of the zres( F V 2

expansion of this voxel. For the EMM dose the portion that the expanded voxel overlaps voxel 2 is accounted for using: DEM M = DT 3 + DT 2 × (1 - F V C ) This results in the equation for DMDnmm of: DM Dnmm = [DT 3 - m2 × zres( FV C - 1 )]- 2 [DT 3 + DT 2 × (1 - F V C )] (2.26)

(2.27)

50

2.7. METHODS - PART 2: INVESTIGATION OF FACTORS THAT AFFECT DOSE MAPPING DIFFERENCE (DMD) 2.7.5.2 Sigmoidal model of the dose profile As an alternative to approximating the dose gradient as being linear, the dose profile was modelled with a sigmoidal function to obtain the VWM dose values using: DV W M = 1.8326 0.2529 + 21.7813e-8.7102×d (2.28)

where d is the depth of center of the deformed voxel whose dose value, D, is being solved for. The coefficients for this equation were solved for using nonlinear regression fitting tool in Matlab using the target dose values and the corresponding depths of the center of voxels 1, 2, 3 and 4. The VWM dose values were implemented into the equation for DMDnmm in a method similar to that for the linear fit, for example for the case of a compression we have: DM Dnmm = DV W M - DEM M nmm 1.8326 = - DT × F V C 0.2529 + 21.7813e-8.7102×d and in cases of an expansion of voxel 3 into voxel 2, we have: DM Dnmm = DV W M - DEM M nmm 1.8326 - [DT 3 + DT 2 (F V C - 1)] = 0.2529 + 21.7813e-8.7102×d

(2.29)

(2.30)

2.7.6

A high resolution dose profile

In order to obtain a high resolution estimate of the dose profile a DOSXYZnrc simulation was performed using a dose grid resolution of 10x10x0.1 cm3 . Dose values for deformed voxels were obtained by averaging the high resolution voxels that this voxel overlapped. Each low resolution undeformed voxel, 10x10x0.3 cm3 , was divided into three high resolution voxels, 10x10x0.1 cm3 as illustrated by the red rectangles inside the black rectangles in Figure 2.15. For the case of a 1 mm compression, two high resolution voxels fit inside the deformed voxel on the low resolution and the VWM dose value was taken as the average of these two voxels: DV W M = AV G(Dhighres-voxel2 + Dhighres-voxel3 ) (2.31)

EMMnmm dose values were calculated by multiplying the average of the three high resolution voxels, which fit inside the corresponding low resolution target voxel, by the 51

CHAPTER 2. MATERIALS AND METHODS

Figure 2.15: Three voxels on the high resolution dose profile fit inside each voxel on the low resolution dose profile, providing more information about the dose profile

52

2.7. METHODS - PART 2: INVESTIGATION OF FACTORS THAT AFFECT DOSE MAPPING DIFFERENCE (DMD) fractional volume change: DEM M nmm = AV G(Dhighres-voxel1 + Dhighres-voxel2 + Dhighres-voxel3 ) × F V C (2.32) For the same compression case, the DMDnmm was calculated as follows: DM Dnmm = AV G(Dhighres-voxel2 + Dhighres-voxel3 )- AV G(Dhighres-voxel1 + Dhighres-voxel2 + Dhighres-voxel3 ) × F V C

(2.33)

53

CHAPTER 2. MATERIALS AND METHODS

Table 2.3: Simulated Registration Errors Simulated Error FVC for voxel 2 0.67 0.33 1.33 1.67 0.33 1 Location of Error voxel 2 upper boundary voxel 2 upper boundary voxel 2 upper boundary voxel 2 upper boundary voxel 1 upper boundary voxel 2 upper and lower boundaries voxel 2 upper and lower boundaries voxel 2 lower boundary voxel 2 upper and lower boundaries voxel 2 upper and lower boundaries Density of Voxel 1 (g/cm3 ) 1 1 1 1 3 0.75 Density of Voxel 2 (g/cm3 ) 1.5 3 0.75 0.6 0.6 1 Density of Voxel 3 (g/cm3 ) 0.75 0.6 1.5 3 1 1.5

1 mm compression 2 mm compression 1 mm expansion 2 mm expansion 2 mm compression 1 mm shift (+z) 2 mm shift (+z) 1 mm shift and 1 mm compression 1 mm shift and 2 mm compression 1 mm shift and 1 mm expansion

1

0.6

1

3

0.67 0.33

0.75 0.75

1.5 3

1 0.75

1.33

0.75

0.75

3

54

Chapter 3

Results
This chapter is divided into two sections. The first section will describe the results of the analysis of the correlation of dose mapping difference and landmark error. Since results showed no correlation between DMD and landmark 3D DTA a new direction was taken - investigation of factors that affect DMD. The second section will describe these results.

3.1

Examination of correlations of DMD and landmark error

3.1.1

Image registration and accuracy

4DCT images of the patient at inhale and exhale as well as all images deformed from exhale to inhale using the different registrations are shown in Figure 3.1. The green region at the inferior end of the lung shows where the deformed reference image does not match the target image. The alignment increased with lower deformation lattice spacing, as shown in Figure 3.1, this is seen by the decrease in the amount of green as the deformation lattice spacing decreased from 31.04x31.04x40 mm3 to 3.88x3.88x5 mm3 . This visual assessment was confirmed by the calculations of the average landmark 3D distance to agreement (DTA) for each registration listed in Table 3.1. Registration error decreased with smaller deformation lattice spacing.

3.1.2

DMD-landmark error correlation

Simulations of treatment plan delivery were performed on the exhale and inhale phases. Dose distributions were mapped from inhale to exhale using VWM (defDOSXYZnrc) and EMM (dTransform), with and without mass mapping, for all registrations. Figure 55

CHAPTER 3. RESULTS

(a) inhale phase

(b) exhale phase

(c) before registration

(d) 32 step

(e) 16 step

(f) 8 step

(g) 4 step

Figure 3.1: Images of the inhale phase in red and the exhale phase in green. The exhale phase is deformed using image registration and overlain over the inhale phase to show the alignment over different image registration accuracies.

56

3.1. EXAMINATION OF CORRELATIONS OF DMD AND LANDMARK ERROR Table 3.1: Image registration accuracy evaluated using landmark DTA between landmarks on inhale and deformed exhale Registration name 32 step 16 step 8 step 4 step Average landmark 3D DTA (mm) [range] 5.9 ± 3.1 [0.3, 16.7] 4.3 ± 3.0 [0.5, 15.6] 3.0 ± 2.3 [0.2, 13.1] 2.3 ± 1.7 [0.3, 13.1]

3.2 shows the static dose distributions on exhale and inhale and the mapped dose distributions using VWM (defDOSXYZnrc) and EMM (dTransform) with and without mass mapping using the 4 step registration. Since the volume of the lung is smaller in the exhale CT image the dose covers portions of the lung closer to the inferior of the lung when delivered on the exhale phase. When the inhale dose was mapped to the exhale CT image, as seen in c) and d), the resultant dose distribution was compressed in the superior-inferior direction and was also warped upward within the lungs compared to the chest where the anatomy does not move with respiration. The dose distribution that was mapped using dTransform with no mass mapping appears non-uniform compared to the other dose distributions. Absolute and percentage dose mapping differences were calculated from VWM and EMM dose distributions, with and without mass mapping. Figure 3.3 shows both absolute and percentage DMDmm and DMDnmm. The images show that DMDmm values are largest near the inferior edges of the beams where the dose warping was most prominent. Large DMDmm values were also noted in the other beam penumbra regions. Since these areas have the highest dose gradients, largest DMDmm values are expected. The magnitudes of DMDnmm values were larger than DMDmm. Also, the largest DMDnmm values appear near the center of all the beams instead of in dose gradient regions. Average absolute DMDmm and DMDnmm values are summarized for all registrations in Table 3.2. There were no clear trends between the average absolute DMDmm or DMDnmm and registration accuracy. Recall that average landmark 3D DTA decreased for smaller deformation lattice spacing as seen in Table 3.1. DMDmm decreased as expected between 32 and 16 step, did not change between 16 and 8 step, but then increased from 8 to 4 step. DMDnmm decreased from 32 to 16 step, however it increased from 16 to 8 step. It decreased again between 8 and 4 step. Figure 3.4 shows the graphs of DMDmm (a) and DMDnmm (b) versus landmark 3D DTA for all registrations. R2 values were determined to be zero in Excel assuming a linear relationship between DMD 57

CHAPTER 3. RESULTS and landmark 3D DTA for all registration accuracies. The Spearman's Rank Correlation coefficient was calculated for the monotonical relationship between registration accuracy and absolute and percentage DMDmm and DMDnmm to be 0, 0, 0.8, and 0.8. For a Spearman's Rank Correlation 0 shows no relationship and 1 shows a correlation. DMDnmm, therefore, is shown to have some monotonical dependence on registration accuracy. Table 3.2: Average dose mapping differences across all landmarks for each registration Registration name 32 step 16 step 8 step 4 step Average absolute DMDmm(Gy) 0.3 ± 1.7 0.2 ± 1.6 0.2 ± 1.1 0.3 ± 1.6 Average percentage DMDmm(%) 1±4 0.5 ± 4 0.5 ± 3 1±4 Average absolute DMDnmm (Gy) 3.7 ± 1.7 2.6 ± 1.6 3.0 ± 1.5 1.9 ± 1.6 Average percentage DMDnmm(%) 9±4 6±4 7±4 5±4

3.1.3

Influence of dose gradient

The effect of dose gradient magnitude on the correlation of landmark 3D DTA and dose mapping difference using 4 step registration is shown in Figure 3.5. The correlation of landmarks located in areas above 0%, 20%, 40%, and 60% of the maximum dose gradient value were plotted. By using a higher dose gradient cutoff value, landmarks that have a high landmark error and low DMD were removed from the correlation graph since they lie in regions of uniform dose. This is seen in Figure 3.5 (b) when a 20% gradient threshold was applied all of the landmarks with 3D DTA above 6 mm were no longer included. However, increasing the gradient threshold did not improve the correlation between landmark error and DMDmm.

3.1.4

Investigation of trends for individual landmarks

Two landmarks, #68 and #184, shown over the exhale CT image with the dose distributions mapped using VWM and the 4 step registration in Figure 3.6, were further investigated to determine causes of the poor correlations noticed in Figures 3.4 and 3.5. Landmark #68 was located on the edge of one beam whereas landmark #184 was located in the overlap of the penumbra of all three beams. Both landmarks were therefore in regions of dose gradient, however, the dose gradient at landmark #184's location was higher. The dose gradient values were calculated in the neighbourhood of the voxel overlapped by the deformed exhale landmark coordinates using the dose values from the 58

3.1. EXAMINATION OF CORRELATIONS OF DMD AND LANDMARK ERROR

(a) Inhale

(b) Exhale

(c) defDOSXYZnrc

(d) dTransform

(e) dTransform with no mass mapping

Figure 3.2: a) Dose distribution resulting from simulating treatment plan delivery on the inhale CT image, b) the dose distribution on the exhale CT image and dose distributions mapped from inhale to exhale using c) defDOSXYZnrc, d) dTransform code with mass mapping and e) dTransform code without mass mapping.

59

CHAPTER 3. RESULTS

(a)

(b)

(c)

(d)

Figure 3.3: a) Absolute and b) percentage dose mapping difference with mass mapping and c) absolute and d) percentage dose mapping difference without mass mapping. Note: percentage DMDs are normalized to the prescription dose of 42 Gy.

(a)

(b)

Figure 3.4: Correlation of dose mapping difference (a) with mass mapping; and (b) without mass mapping and landmark error

60

3.1. EXAMINATION OF CORRELATIONS OF DMD AND LANDMARK ERROR

(a) 0% gradient threshold, R2 = 0

(b) 20% gradient threshold, R2 = 0.2

(c) 40% gradient threshold, R2 = 0

(d) 60% gradient threshold, R2 = 0.4

Figure 3.5: The correlation of landmark 3D DTA and dose mapping difference with mass mapping where different gradient thresholds were applied. These are results from the dose mapping difference calculated using the 4 step registration.

61

CHAPTER 3. RESULTS

Figure 3.6: Landmark #68 is shown on the left and landmark #184 shown on the right. Both landmarks are located in regions where a dose gradient exists.

inhale dose distribution in order to determine their impact on the correlation of landmark error and DMDmm. The relation between dose gradients, landmark errors and dose mapping difference was investigated using all x, y and z components for landmarks #68 and #184. A predicted dose mapping difference was calculated using the 3D values of landmark error and dose gradients as well as using the individual components of each. Summaries of the 3D dose gradient, 3D landmark error and DMD are shown in Tables 3.3 and 3.4. For landmark #68 registration error increased from 4 to 16 step registrations, which resulted in an increase in DMDmm. Landmark error increased from 16 to 32 step registration accuracies, however the DMDmm decreased. The dose gradient analysis suggests that DMD would increase between 16 and 32 step registrations. The reason for DMDmm decrease is not clear. No clear trend was observed between landmark 3D DTA and DMDnmm. DMDnmm decreased from 4 to 8 step and increased between 8 and 16 step and 16 and 32 step. The predicted dose mapping difference values using the 3D values and the components did not agree with the simulated DMD vlaues, nor did they follow a similar trend. For landmark #184 the registration error decreased between the 4 step and 8 step registrations while DMDmm increased. Image registration error increased over 8, 16 and 32 step registrations and DMDmm increased over these registration accuracies as expected. Landmark #184 had a low landmark error over all registrations such that the landmark never moved into a new voxel. Therefore, the dose gradient between the inhale coordinate and the deformed reference coordinate stayed the same over all registrations. The dose gradient at this location was very high but never resulted in a high DMDmm. This can be explained by looking at landmark and dose gradient components. A large 62

3.1. EXAMINATION OF CORRELATIONS OF DMD AND LANDMARK ERROR Table 3.3: Landmark #68 analysis 4 step Landmark error (mm) x component y component z component 3D Gradient (Gy/mm) x component y component z component 3D Dose mapping difference predicted from 3D values (Gy) Dose mapping difference predicted from components (Gy) DMDmm (Gy) DMDnmm (Gy) -0.74 0.64 -1.04 1.43 -0.96 -0.06 -0.16 0.98 1.40 0.73 0.38 6.81 8 step -0.87 1.51 -2.90 3.39 -1.01 0.05 -0.25 1.04 3.51 1.14 2.42 4.96 16 step -0.12 3.39 -3.18 4.65 -1.01 0.05 -0.25 1.04 4.82 0.82 2.82 8.11 32 step 0.24 4.25 -4.27 6.03 -0.81 0.00 -0.26 0.85 5.13 1.13 0.99 8.32

component of landmark error for registrations 4, 8, and 16 occured in the z direction over which the dose gradient was small. The z component of the landmark error dropped to 0 mm for 32 step registration but this had no effect of the DMDmm since the dose gradient was small in this direction. However, the dose gradient analysis predicted much larger values of DMDmm. The trends in the predicted dose mapping difference using the 3D values and the components were not consistent with the trends in the simulated DMDmm or DMDnmm values. DMDnmm decreased with decreased image registration accuracy. This cannot be explained by the dose gradient analysis.

3.1.5

Influence of voxel size

Graphs of landmark 3D DTA and dose mapping difference with mass mapping using dose simulations performed on a high resolution dose grid (1x1x2.5 mm3 ) are shown in Figure 3.7. These results were calculated using the 4 step registration and a dose gradient threshold of 0% (3.7a) and 20% (3.7b). These graphs resemble the correlation graphs from the low resolution dose grid analysis shown in Figures 3.5a and 3.5b. No strong correlation is seen in either graph. R2 values of 0 were found for both the high and low resolution dose grid correlations using a 0% dose gradient threshold. However, there are less landmarks on the correlation graph resulting from the high resolution dose 63

CHAPTER 3. RESULTS Table 3.4: Landmark #184 analysis 4 step Landmark error (mm) x component y component z component 3D Gradient (Gy/mm) x component y component z component 3D Dose mapping difference predicted from 3D values (Gy) Dose mapping difference predicted from components (Gy) DMDmm (Gy) DMDnmm (Gy) 0.78 0.89 -1.01 1.56 -2.75 36.13 0.05 36.23 56.52 32.23 0.10 10.89 8 step 0.94 0.04 -0.95 1.34 -2.75 36.13 0.05 36.23 48.55 2.96 0.19 14.45 16 step 1.00 0.44 -0.87 1.40 -2.75 36.13 0.05 36.23 50.72 16.13 0.66 7.36 32 step -0.13 2.14 0.00 2.14 -2.75 36.13 0.05 36.23 77.50 77.32 1.65 0.35

grid when using a 20% gradient threshold than the correlation graph resulting from the low resolution dose grid using the same registration and gradient threshold as shown in Figure 3.5b. This is because there is less chance that a given landmark falls in a high resolution voxel which has a much smaller volume than the low resolution voxels. No clear correlation between absolute DMDmm and landmark 3D DTA was found for the high resolution analysis.

3.1.6

Correlation of landmark error and DMD using single beam plan

DMDmm generated from a single beam plan, which used no coordinate system transformation, was plotted against landmark 3D DTA as shown in Figure 3.8. This graph resembles Figure 3.4a in that no correlation is seen using the 4 step registration.

3.2
3.2.1

Part 2: Investigation of factors that affect DMD
Dose mapping difference for simple dose mapping scenarios

Graphs were plotted to compare registration error magnitude and fractional volume change as measures of registration accuracy against absolute DMDmm (Figure 3.9) and DMDnmm (Figure 3.10) for simple dose mapping scenarios. In Figure 3.10a the four 64

3.2. PART 2: INVESTIGATION OF FACTORS THAT AFFECT DMD

(a) 0% dose gradient threshold

(b) 20% dose gradient threshold

Figure 3.7: Absolute DMDmm and landmark 3D DTA correlation graph showing points located in dose gradient regions above 0% and 20% of the maximum dose gradient value for the high resolution dose grid simulation.

Figure 3.8: Correlation of dose mapping difference, using dTransform with mass mapping, and registration accuracy, defined using landmark distance to agreement generated from a single beam plan. 65

CHAPTER 3. RESULTS points appear as two due to overlapping of points with the same registration error magnitudes. A correlation was found in the graph of registration error magnitude against absolute DMDnmm for simple dose mapping scenarios in a uniform dose region in 3.10a. However, no correlation was found in any other graphs using registration error magnitude therefore it was concluded that overall no clear correlation was found between registration error magnitude and DMDmm or DMDnmm. A correlation was found for the value of registration error against DMDmm and DMDnmm as seen in Figure 3.11. However, a new metric to evaluate registration errors, called fractional volume change (FVC), was used since it provides information about the registration error value as well as information about volumetric changes that are likely in realistic cases of deformed voxels in the dose mapping done using the Voxel Warping Method. FVC found to give a better correlation in most dose mapping scenarios. In Figure 3.12 the value of DMDmm and DMDnmm was plotted against FVC. Using the value of DMDnmm and FVC as metrics to evaluate DMD and registration error gave the strongest correlations. From this point forward correlations using the value of DMDnmm and FVC were evaluated.

3.2.2

Assessment of DMD formula: uniform dose scenario

Equation 2.19 with no CF (CF = 1) was tested on 10 cases, summarized in Table 2.3, of simulated registration errors using a geometry in a uniform dose distribution. Calculated DMDnmm values were compared with DMDnmm calculated from VWM and EMM simulations in the same geometries. Average values for multiple cases of DMDnmm calculated on different voxels that had the same FVC are shown in Table 3.5. Average percentage differences in Table 3.5 are the average values of the individual percentage differences between the simulated and calculated DMDnmm values. Table 3.5: Comparison of simulated and calculated DMDnmm in uniform dose scenario FVC 0.33 0.67 1.33 1.67 Average Simulated DMDnmm (Gy) 5.2 ± 0.6 2.6 ± 0.1 -2.6 ± 0.2 -5.2 ± 0.1 Average Calculated DMDnmm (Gy) 5.2 ± 0.1 2.6 ± 0.04 -2.6 ± 0.1 -5.2 ± 0.1 Average Percentage Difference 1.1% 1.9% 1.4% 1.0%

A good agreement was found between calculated and simulated DMDnmm values with a maximum percentage difference of 3.5%. The empirical correction factor was found from a plot of ratios of doses in altered density to unity density voxels to FVC (shown in Figure 3.13). The Batho and empirical 66

3.2. PART 2: INVESTIGATION OF FACTORS THAT AFFECT DMD

(a) R2 = 0

(b) R2 = 0.1

(c) R2 = 0.9

(d) R2 = 0.9

Figure 3.9: Correlation graphs of DMDmm magnitude and registration error magnitude for simple dose mapping scenarios containing (a) a uniform dose region and (b) a dose gradient region. Correlation graphs of DMDmm and FVC for simple dose mapping scenarios containing (c) a uniform dose region and (d) a dose gradient region.

67

CHAPTER 3. RESULTS

(a) R2 = 1

(b) R2 = 0

(c) R2 = 0

(d) R2 = 0.9

Figure 3.10: Correlation graphs of DMDnmm magnitude and registration error magnitude for simple dose mapping scenarios containing (a) a uniform dose region and (b) a dose gradient region. Correlation graphs of DMDnmm and FVC for simple dose mapping scenarios containing (c) a uniform dose region and (d) a dose gradient region.

68

3.2. PART 2: INVESTIGATION OF FACTORS THAT AFFECT DMD

(a) R2 = 0.9

(b) R2 = 0.9

(c) R2 = 1

(d) R2 = 0.9

Figure 3.11: Correlation graphs of DMDmm and registration error for simple dose mapping scenarios containing (a) a uniform dose region and (b) a dose gradient region. Correlation graphs of DMDnmm and registration error values for simple dose mapping scenarios containing (c) a uniform dose region and (d) a dose gradient region.

69

CHAPTER 3. RESULTS

(a) R2 = 0.9

(b) R2 = 0.9

(c) R2 = 1

(d) R2 = 0.9

Figure 3.12: Correlation graphs of FVC against DMDmm in a region of (a) uniform dose (b) dose gradient and FVC against DMDnmm in a region of (c) uniform dose and (d) dose gradient.

70

3.2. PART 2: INVESTIGATION OF FACTORS THAT AFFECT DMD

Figure 3.13: Empirical density correction factor as a function of fractional volume change. correction factors were calculated and compared to the ratio of the dose on the deformed geometry to the target dose. Results, shown in Table 3.6, show that the empirical correction factors were closer to the ratio of simulated doses. Table 3.6: Evaluation of Batho and empirical density correction factors FVC 0.33 0.67 1.33 1.67 Batho CF 0.03 0.52 1.21 1.24 Empirical CF 1.02 1.01 0.99 0.98 Ratio of dose on deformed geometry to target dose 1.01 1.01 1.00 0.99

Results of using the empirical correction factor on DMDnmm for 6 cases of registration error for voxel 2 and 3 chosen at random were compared to the results of the DMDnmm calculated using no correction factor in Table 3.7. Results show that overall the DMDnmm calculated using no correction factor better approximated the simulated DMDnmm results. For this reason it was chosen to use no correction factor for the influence of density changes of energy fluence.

3.2.3

Assessment of DMDnmm formula: non-uniform dose scenario

The first four simulated registration error cases listed in Table 2.3 (1 and 2 mm compressions and expansions) were used to test the formula for DMDnmm (Equation 2.19) for the scenario where there was a dose gradient for voxel 3 (Table 3.8). Percentage 71

CHAPTER 3. RESULTS Table 3.7: Agreement of simulated and calculated DMDnmm with and without empirical correction factor FVC 0.33 0.67 1.33 1.67 0.67 0.33 Simulated DMDnmm (Gy) 5.3 2.6 -2.6 -5.2 2.5 5.1 Uncorrected DMDnmm (Gy) 5.2 2.6 -2.6 -5.2 2.5 5.1 DMDnmm with empirical CF (Gy) 5.4 2.7 -2.6 -5.4 2.7 5.4

differences between simulated and calculated DMDnmm ranged from 12 to 64% showing that Equation 2.19 for DMDnmm does not work in areas with a dose gradient. Table 3.8: Evaluation of DMDnmm formula for the 1 and 2 mm compressions and expansions on voxels on a region with a dose gradient FVC 0.33 0.67 1.33 1.67 Simulated DMDnmm (Gy) 3.1 1.9 -1.3 -3.0 Calculated DMDnmm (Gy) 4.3 2.1 -2.1 -4.3 Percentage Difference 38% 12% 64% 42%

Modifications were made to the formula for DMDnmm in order to account for the dose gradient. The fit of a sigmoidal function to the dose profile in order to estimate dose values for VWM given different voxel sizes and different center of voxel values is illustrated in Figure 3.14. Results from using Equations 2.24 and 2.27 to calculate the DMDnmm are presented in Table 3.9. Percentage difference values between the calculated and simulated VWM dose values ranged from 0 to 37%. This resulted in percentage differences between calculated and simulated DMDnmm values ranging between 0 and 61%. Results from using Equations 2.29 and 2.30 to calculate DMDnmm are shown in Table 3.10. The sigmoidal function provided VWM dose values with small percentage differences from the simulated VWM dose values (less than 7%) for these 4 cases of registration errors. However, since DMDnmm are much smaller quantities than the dose values, the result is DMDnmm values with large percentage differences from simulated DMDnmm values (up to 54%). When a high resolution was used for the dose simulation a smoother dose profile 72

3.2. PART 2: INVESTIGATION OF FACTORS THAT AFFECT DMD

Figure 3.14: The dose profile, seen in blue, was modelled using a sigmoidal profile, shown in red.

73

CHAPTER 3. RESULTS Table 3.9: Agreement of calculated and simulated DMDnmm using linear dose profile model (Equations 2.24 and 2.27) FVC Simulated DV W M (Gy) 5.2 6.2 6.0 5.2 Calculated DV W M (Gy) [% difference] 7.1[37] 6.8[10] 5.8[3] 5.2[0] Simulated DMDnmm (Gy) 3.1 1.9 -1.3 -3.0 Calculated DMDnmm (Gy) [% difference] 5.0 [61] 2.5 [32] -1.5 [15] -3.0 [0]

0.33 0.67 1.33 1.67

Table 3.10: Agreement of simulated and calculated DMDnmm using sigmoidal dose profile model (Equations 2.29 and 2.30) FVC Simulated DV W M (Gy) 5.2 6.2 6.0 5.2 Calculated DV W M (Gy) [% difference] 6.9[32] 6.7[8] 6.1[1] 5.3[1] Simulated DMDnmm (Gy) 3.1 1.9 -1.3 -3.0 Calculated DMDnmm (Gy) 4.7 [52] 2.4 [26] -1.3 [0] -2.9 [3]

0.33 0.67 1.33 1.67

was obtained as seen in Figure 2.15. This information was used to derive dose values at different locations along the dose profile for the VWM dose value in the calculation of DMDnmm as shown in Table 3.11. EMMnmm dose values were obtained using Equation 2.32. The percentage differences between the EMMnmm values calculated using the low resolution and high resolution dose values are shown in Table 3.11. Although the results of DMDnmm for the expansion cases were within 8% difference to the simulated results, the compression cases were not accurate, having percentage differences up to 45%. These errors were caused by the effect of an increase in density caused by the compression of the voxel.

74

3.2. PART 2: INVESTIGATION OF FACTORS THAT AFFECT DMD

Table 3.11: Agreement of simulated and calculated DMDnmm using high resolution dose profile FVC Simulated DV W M (Gy) 5 .2 6 .2 6.0 5.2 Calculated DV W M (Gy) [% difference] 6.7[29] 6.6[6] 6.1[2] 5.3[2] Calculated DEM M nmm (Gy) [% difference] 2.2 [5] 4.3 [0] 7.3 [0] 8.2 [0] Simulated DMDnmm (Gy) 3.1 1.9 -1.3 -3.0 Calculated DMDnmm (Gy) [% difference] 4.5 [45] 2.3 [21] -1.2 [8] -2.9 [3]

0.33 0.67 1.33 1.67

75

CHAPTER 3. RESULTS

76

Chapter 4

Discussion and conclusions
4.1
4.1.1

Discussion
Correlation of DMD with landmark 3D DTA

The aim of this thesis was to further investigate a new metric for deformable image registration accuracy, which was defined as the difference between dose distributions mapped using the Voxel Warping Method (VWM) and the Energy Mapping Method (EMM). The hypothesis was that this dose mapping difference would be directly correlated with registration error due to the difference in geometries used for dose mapping and would therefore provide a measure of registration accuracy. In this project image registrations of exhale and inhale images were performed, dose calculations for a clinical treatment plan were performed, and doses were mapped from inhale to exhale phases for the calculation of dose mapping difference with (DMDmm) and without mass mapping (DMDnmm). Registration accuracy was quantified by comparing the coordinates of the transformed reference landmarks to the target landmarks. No correlation was found when landmark 3D DTA was used as a metric for registration error against absolute DMDmm or DMDnmm. The application of a dose gradient did not improve the correlation and increasing the dose grid resolution also had no influence on the correlation. Since no correlation between landmark 3D DTA and DMDmm was found using real patient data and plans, a single beam plan was investigated to determine if the coordinate system transformations that were applied for the treatment plan simulations had an effect on the correlation. However, no correlation of DMDmm and landmark 3D DTA was found for the single plan causing a change in the direction of this project. 77

CHAPTER 4. DISCUSSION AND CONCLUSIONS

4.1.2

Investigation of impact of registration error in simple dose mapping scenarios

The aim of this part of the thesis project was to investigate of the impact of registration error in simple dose mapping scenarios. DMD was investigated using 2 scenarios, one containing a uniform dose region and the other with a dose gradient, as registration errors were manually applied. Simulated registration errors consisted of voxel compressions, expansions, shifts as well as combinations of shifts and compression or expansions. The changes in voxel volumes made a significant contribution to dose mapping differences. Since DMDmm (and DMDnmm) is due, in part, to differences in dose averaging over different volumes (because doses are calculated on a grid) a registration error metric that takes the voxel's volume into consideration resulted in a better correlation. As such, fractional volume change was found to be a more suitable metric. Furthermore, the DMDnmm was found to give a stronger correlation than DMDmm. The correlation between DMDnmm and FVC was stronger than when using DMDmm since, for example, the decoupling of the energy and mass mapping increased the sensitivity of EMM dose to registration errors.

4.1.3

Development and evaluation of formula for DMDnmm in a uniform dose distribution

A formula for the calculation of DMDnmm was developed (Equation 2.19). 10 simple simulations that incorporated dose mapping errors were performed which showed an agreement within 3.5% between the calculated and the simulated DMDnmm results. Differences between simulated and calculated results were due to changes in density of voxel material which was not accounted for in the formula. Although several methods were investigated to account for density changes in voxels, overall, these methods produced less accurate results. The Batho correction factor is known to only work in areas of electron equilibrium [52]. Since voxel sizes used in the simple dose mapping scenarios that contained different density values ranged from 0.1 to 0.5 cm electronic equilibrium did not exist in the voxels. The voxel size was not large enough for the averaging of the dose in the voxel to outweigh the electronic disequilibrium brought on by the rebuild up region from the density heterogeneity. The empirical density correction results matched the simulated dose values better than the Batho corrected results, however they were still less accurate than the non-corrected results. There are additional effects of the voxel size and shape on the fluence that have not been accounted for by the empirical correction factor. 78

4.2. LIMITATIONS

4.1.4

Discussion of results of formula on dose gradient region

Equation 2.19 was used to calculate for DMDnmm values in regions of a dose gradient. The results showed poor agreement with the values of DMDnmm obtained from simulations since this formula does not take the effect of the dose gradient into account for the VWM dose value. Several modifications to Equation 2.19 were investigated to account for this dose gradient, however no accurate method was found. Modifications included modelling the dose gradient using a local linear function, a sigmoidal function and using a dose profile that was simulated on a high resolution dose grid to solve for dose values at different center of voxel depths. Although a sigmoidal function fit well over the dose penumbra region, it did not provide accurate results when estimating dose values at different depths. It was found that there was not enough information about the dose gradient to accurately estimate dose values at different depths when using a resolution of 0.3 cm in the z direction (across the dose profile). When the dose values were taken from the high resolution dose profile, adequate information was available to derive VWM dose values in some cases. However, results showed percentage differences up to 45% for some simulated registration errors.

4.2
4.2.1

Limitations
Limitations of formula

The formula for DMDnmm (Equation 2.19) only works in areas of uniform dose since the formula does not model a dose gradient. Also, using FVC as a metric to evaluate registration error does not properly account for registration error when they result in the shift of a voxel. The volume of the voxel does not change in shift cases where the FVC value is 1, which suggests that no registration error is present. Lastly, realistic cases of image registration on lungs involve a deformation from the reference geometry to the target geometry as the lung volumes expands between exhale and inhale. Accounting for an underlying deformation in the formula of DMD was beyond the scope of this thesis.

4.3

Conclusions

Dose mapping difference, quantified as the difference between doses mapped to the reference geometry using VWM and EMM, was found to have no correlation with landmark error, quantified by the landmark 3D DTA. However, a correlation was found when fractional volume change was used as a measure of registration error. A mathematical 79

CHAPTER 4. DISCUSSION AND CONCLUSIONS formula to calculate DMDnmm using FVC and dose values from the target dose distribution was derived which produced accurate results in regions of uniform dose with percentage differences between simulated and calculated DMDnmm values below 3.5%. This formula does not work in areas containing a dose gradient.

4.4

Future work

Further investigations are required in order to extend the formula for DMDnmm to regions with dose gradients and geometries that contain underlying deformations. Also, a method to incorporate the amount of shift as well as the FVC caused by a registration error is required in the metric for registration error. Lastly, a method to calculate FVC in a patient image registration needs to be developed and the formula needs to be validated by performing tests using patient CT images and plans.

4.5

Outlook

A map of DMDnmm could be used to determine locations of poor image registration accuracy. This would provide important information in clinical radiation therapy when evaluating the impact of motion on treatment plans and the underlying error in the plans. Large registration errors lead to improper dose mapping and therefore inaccurate accumulated dose distributions. If such errors were found to exist in critical regions, such as on or near target volumes or organs at risk, this would indicate the need for revision of the image registration algorithm. A map of DMDnmm could be used to systematically evaluate DIR for its usefulness in terms of dose accumulation. As 4D treatment planning techniques become more widely used in the clinics, a map such as this one would show where image registration errors occur giving insight about their overall impact on the treatment plan.

80

Bibliography
[1] Canadian Cancer Society's Advisory Committee on Cancer Statistics. Canadian cancer statistics 2013, 2013. [2] National Cancer Institute. Radiation therapy for cancer, 2010. [3] Eric J Hall. Radiobiology for the Radiobiologist. Lippincqtt Williams and Wilkins, New York, 2000. [4] Faiz M. Khan. The physics of radiation therapy. Lippincott Williams and Wilkins, Philadelphia, 2003. [5] Mayo clinic staff. Brachytherapy, 2011. [6] Jacob Van Dyke. Modern technology of radiation oncology. Medical Physics Publishing, Wisconsin, 1999. [7] S S Vedam, P J Keall, V R Kini, H Mostafavi, H P Shukla, and R Mohan. Acquiring a four-dimensional computed tomography dataset using an external respiratory signal. Physics in Medicine and Biology, 48:45­62, 2003. [8] International Commission on Radiation Units and Measurements. Icru report 50. prescribing, recording and reporting photon beam therapy, 1993. [9] Hiroki Shirato, Yvette Seppenwoolde, Kei Kitamura, Rikiya Onimura, and Shinichi Shimiza. Intrafractional tumor motion: lung and liver. Seminars in Radiation Oncology, 14:10­18, 2004. [10] Laura A. Dawson and James M. Balter. Interventions to reduce organ motion effects in radiation delivery. Seminars in Radiation Oncology, 14:76­80, 2004. [11] Paul J. Keall et al. The management of respiratory motion in radiation oncology report of aapm task group 76. Medical Physics, 33:3874­3900, 1993. 81

BIBLIOGRAPHY [12] Yan Wang, Yong Bao, Li Zhang, Wei Fan, Zong-Wen Sun, Xiao Hu, Shao-Min Huang, Ming Chen, and Xiao-Wu Deng. Assessment of respiratory-induced motion and its impact on treatment outcome for lung cancer, 2013. [13] Simon Rit, Jasper Nijkamp, Marcel van Herk, and Jan-Kajob Sonke. Comparative study of respiratory motion correction techniques in cone-beam computed tomography. Radiotherapy and Oncology, 100:356­359, 2011. [14] Jerry L. Prince and Jonathan M. Links. Medical imaging signals and systems. Pearson Prentice Hall Bioengineering, New York, 2006. [15] A. J. Cole, G. G. Hanna, S. Jain, and J. M. O'Sullivan. Motion management for radical radiotherapy in non-small cell lung cancer. Clinical Oncology, 26:67­80, 2014. [16] James M. Balter, J. Nelson Wright, Laurence J. Newell, Barry Friemel, Steven Dimmer, Yuki Cheng, John Wong, Edward Vertatschitch, and Timothy P. Mate. Accuracy of a wireless localization system for radiotherapy. International Journal of Radiation Oncology Biology Physics, 61:933­937, 2005. [17] Thomas Bortfeld, Steve B. Jiang, and Eike Rietzel. Effects of motion on the total dose distribution. Seminars in Radiation Oncology, 14:41­51, 2004. [18] Cedric X Yu, David A Jaffray, and John W Wong. The effects of intra-fraction organ motion on the delivery of dynamic intensity modulation. Physics in Medicine and Biology, 43:91­104, 1998. [19] J.R. Adler, S.D. Chang, M.J. Murphy, J. Doty, P. Geis, and S.L. Hancock. The cyberknife: A frameless robotic system for radiosurgery. Stereotactic and Functional Neurosurgery, 69:124­128, 1997. [20] Hana Qudsi and Maneesh Gupta. Low-cost, thermistor based respiration monitor, 2013. [21] International Commission on Radiation Units and Measurements. Icru report 62. prescribing, recording and reporting photon beam therapy: the problem of margins. Patras Medical Physics, pages 25­31, 1999. [22] Jochem W. H. Wolthaus, Jan-Jakob Sonke, Marcel van Herk, Jose S. A. Belderbros, Maddalena M. G. Rossi, Joos V. Lebesque, and Eugene M. F. Damen. Comparison of different strategies to use four-dimensional computed tomography in treatment 82

BIBLIOGRAPHY planning for lung cancer patients. International Journal of Radiation Oncology Biology Physics, 70:1229­1238, 2008. [23] Alexei Trofimov, Eike Rietzel, Hsiao-Ming Lu, Benjamin Martin, Steve Jiang, George T Y Chen, and Thomas Bortfeld. Temporo-spatial imrt optimization: concepts, implementation and initial results. Physics in Medicine and Biology, 50:2779­ 2798, 2005. [24] Christian Vrancic, Alexei Trofimov, Timothy C.Y. Chan, Gregory Sharp, and Thomas Bortfeld. Experimental evaluation of a robust optimization method for imrt of moving targets. Physics in Medicine and Biology, 54:2901­2914, 2009. [25] P.J. Keall, W.A. Beckham, J.T. Booth, S.F. Zavgorodni, and M. Oppelaar. A method to predict the effect of organ motion and set-up variations on treatment plans. Australasian Physical and Engineering Science in Medicine, 22:48­52, 1999. [26] Mihaela Rosu, Indrin J. Chetty, James M. Balter, and Marc L. Kessler. Dose reconstruction in deforming lung anatomy: Dose grid size effects and clinical implications. Medical Physics, 32:2487­2495, 2005. [27] Jeffrey V. Siebers and Hualiang Zhong. An energy transfer method for 4d monte carlo dose calculation. Medical Physics, 35:4096­4105, 2008. [28] Emily Heath, D. L. Collins, P. J. Keall, L. Dong, and J. Seuntjens. Quantification of accuracy of automated nonlinear image matching and anatomical labelling (animal) nonlinear registration algorithm for 4d ct images of lung. Medical Physics, 34:4409­ 4421, 2007. [29] Eike Rietzel and George T. Y. Chen. Deformable registration of 4d computed tomography data. Medical Physics, 33:4423­4430, 2006. [30] K. K. Brock, M. B. Sharpe, L. A. Dawson, S. M. Kim, and D. A. Jaffray. Accuracy of finite element model-based multi-organ deformable image registration. Medical Physics, 32:1647­1659, 2005. [31] A. Mencarelli, S. Van Beek, S. Van Kranen, C. Rasch, M. Van Herk, and J.-J. Sonke. Validation of deformable registration in head and neck cancer using analysis of variance. Medical Physics, 39:6879­6884, 2012. [32] Richard Castillo, Edward Castillo, Guerra Rudy, Valen E Johnson, Travis McPhail, Amit K Garg, and Thomas Guerrero. A framework for evaluation of deformable 83

BIBLIOGRAPHY image registration spatial accuracy using large landmark point sets. Physics in Medicine and Biology, 54:1849­1870, 2009. [33] Monica Serban, Emily Heath, Gabriela Stroian, D. Louis Collins, and Jan Seuntjens. A deformable phantom for 4d radiotherapy verification: Design and image registration evaluation. Medical Physics, 35:1094­1102, 2011. [34] Rojano Kashani, Kwok Lam, Dale Litzenberg, and James Balter. Technical note: A deformable phantom for dynamic modelling in radiation therapy. Medical Physics, 34:199­201, 2006. [35] Rojano Kashani et al. Objective assessment of deformable image registration in radiotherapy: A multi-institution study. Medical Physics, 35:5944­5953, 2008. [36] Martin J. Murphy, Francisco J. Salguero, Jeffrey V. Siebers, David Staub, and Constantin Vaman. A method to estimate the effect of deformable image registration uncertainties on daily dose mapping. Medical Physics, 39:573­580, 2012. [37] Hualiang Zhong, Terry Peters, and Jeffrey V Siebers. Fem-based evaluation of deformable image registration for radiation therapy. Physics in Medicine and Biology, 52:4721­4738, 2007. [38] Hualiang Zhong, Elisabeth Weiss, and Jeffrey V. Siebers. Assessment of dose reconstruction errors in image-guided radiation therapy. Physics in Medicine and Biology, 53:719­736, 2008. [39] C. Yan, G. Hugo, F. J. Salguero, N. Saleh-Sayah, E. Weiss, and W. C. Sleeman. A method to evaluate dose errors introduced by dose mapping processes for mass conservation deformations. Medical Physics, 39:2119­2128, 2012. [40] Martina Hub, Christian Thieke, Marc L. Kessler, and Christian P. Karger. A stochastic approach to estimate the uncertainty of dose mapping caused by uncertainties in b-spline registration. Medical Physics, 39:2186­2192, 2012. [41] Francisco J. Salguero, Nahla K. Saleh-Sayah, Chenyu Yan, and Jeffrey V. Siebers. Estimation of three-dimensional intrinsic dosimetric uncertainties resulting from using deformable image registration for dose mapping. Medical Physics, 38:343­ 353, 2011. [42] Nahla K. Saleh-Sayah, Elisabeth Weiss, Francisco J. Salguero, and Jeffrey V. Siebers. A distance to dose difference tool for estimating the required spatial accuracy of a displacement vector field. Medical Physics, 38:2318­2323, 2011. 84

BIBLIOGRAPHY [43] Emily Heath, Frederic Tessier, and Iwan Kawrakow. Investigation of voxel warping and energy mapping approaches for fast 4d monte carlo calculations in deformed geometries using vmc++. Physics in Medicine and Biology, 56:5187­5202, 2011. [44] Christiane Burton. Evaluation of new metric for image registration accuracy. undergraduate degree thesis Ryerson University, 2011. [45] Edward Castillo, Richard Castillo, Josue Martinez, Maithili Shenoy, and Thomas Guerroro. Four-dimensional deformable image registration using trajectory modelling. Physics in Medicine and Biology, 55:305­327, 2010. [46] D. L. Collins and A. C. Evans. Animal: validation and applications of nonlinear registration-based segmentation. Artificial Intelligence, 11:1271­1294, 1997. [47] I. Kawrakow, E. Mainegra-Hing, D.W.O. Rogers, F. Tessier, and B.R.B. Walters. The egsnrc code system: Monte carlo simulation of electron and photon transport, 2011. [48] D.W.O. Rogers, B. Walters, and I. Kawrakow. Beamnrc users manual, 2011. [49] Emily Heath and Jan Seuntjens. A direct voxel tracking method for four-dimensional monte carlo dose calculations in deforming anatomy. Medical Physics, 33:434­445, 2006. [50] Andrew Alexander. Mcgill monte carlo treatment planning users manual, 2011. [51] K. et al. Papanikolaou. Aapm report no. 85 tissue inhomogeneity corrections for megavoltage photon beams, 2004. [52] E. El-Khatib and J.J. Battista. Improved lung dose calculation using tissue-

maximum ratios in the batho correction. Medical Physics, 11:279­86, 1984.

85

BIBLIOGRAPHY

86

Glossary
ANIMAL automated nonlinear Image Matching and Anatomical Labelling CF correction factor CTV clinical target volume DIM dose interpolation method DIR deformable image registration DMD dose mapping difference DEM M dose mapped using Energy Mapping Method DEM M mm dose mapped using Energy Mapping Method with mass mapping DEM M nmm dose mapped using Energy Mapping Method with no mass mapping DMD dose mapping difference DMDnmm dose mapping difference with mass mapping DMDnmm dose mapping difference with no mass mapping DV W M dose mapped using Voxel Warping Method DTA distance to agreement DTD distance to dose difference DVF deformable vector field DVH dose volume histogram EGS Electron-Gamma-Shower EMM Energy Mapping Method FEM finite-element model FVC fractional volume change GTV gross tumour volume IMRT intensity modulated radiation therapy ITV internal target volume Kerma kinetic energy released per unit mass MLC multileaf collimator MMCTP McGill Monte Carlo Treatment Planning Software 87

NSCLC non-small cell lung cancer OAR organ at risk PTV planning target volume RF radiofrequency ROS reactive oxygen species SCLC small cell lung cancer TMR tissue to maximum ratio UE unbalanced energy VWM Voxel Warping Method

88


