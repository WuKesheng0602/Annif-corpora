THE DESIGN AND DEVELOPMENT OF AN ALGORITHM FOR AUTOMATICALLY CREATING TRANSIT NETWORKS IN TRANSCAD TO MEASURE REGIONAL ACCESSIBILITY

by Rishi Lukka, P.Eng., B.A.Sc., Honours Systems Design Engineering & B.A. Liberal Arts, University of Waterloo, 2007

A Major Research Paper (MRP) presented to Ryerson University in partial fulfillment of the requirements for the degree of Master of Engineering in the Program of Civil Engineering

Toronto, Ontario, Canada, 2016 © Rishi Lukka, 2016 

Author's Declaration for Electronic Submission of a MRP
I hereby declare that I am the sole author of this MRP. This is a true copy of the MRP, including any required final revisions. I authorize Ryerson University to lend this MRP to other institutions or individuals for the purpose of scholarly research I further authorize Ryerson University to reproduce this MRP by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research. I understand that my MRP may be made electronically available to the public.



ii

Abstract
The design and development of an algorithm for automatically creating transit networks in TransCAD to measure regional accessibility. Master of Engineering, 2016, Rishi Lukka, Civil Engineering, Ryerson University

The Metrolinx Economic Analysis team commissioned Arup Canada to create a tool to measure regional transit accessibility called WithinReach. It allows transportation professionals to quickly evaluate and compare existing services versus potential projects, using availability metrics. The calculation requires the summarization of all transit route operations across a geographic area into performance standards for one service day. In the Greater Toronto-Hamilton Area (GTHA), detailed timetables are available in the General Transit Feed Specification (GTFS) format, however manually preparing this data for WithinReach is labour-intensive. Due to the frequency of changes to vehicle and route schedules, and the number of regional agencies, maintaining an up-to-date summary of operations is cumbersome. This report covers the design, development, testing, procedure, and validation of a Transit Network Builder (TNB) to automate this effort. The TNB abstracts GTFS schedule data into performance benchmarks for use

with the WithinReach Tool and the TransCAD transportation planning environment.



iii

Acknowledgements
IwouldliketothanktheteamatMetrolinx,AnnaKramer,ShahrzadBorjian,andJakeSchabas, alongwithmycolleaguesatArupCanadaforprovidingmewiththesupport,training,andtopic fortheprojectundertakenaspartofthisreport,aswellasthepermissiontosharethefindings. IwouldalsoliketothankDr.JosephChowforbeingmygraduatestudentadvisoroverthelast twoyearsandRachelHarpleyfortheadministrativehelpthroughoutmytimeatRyerson.Lastly, IwouldliketothankDr.AhmedEl-Rabbany,Dr.BhagwantPersaud,andDr.JosephChowfor evaluatingthisreport.



iv

Table of Contents
Author'sDeclarationforElectronicSubmissionofaMRP........................................................ ii Abstract.................................................................................................................................iii Acknowledgements................................................................................................................iv TableofContents.................................................................................................................... v ListofTables..........................................................................................................................vi ListofFigures........................................................................................................................vii 1 2 3 4 5 6 7 8 9 10 Introduction ....................................................................................................................1 ConceptualizationofWithinReachandtheTransitNetworkBuilder...............................3 SystemRequirementsandOverallProcedure.................................................................7 ProgrammingLanguageSelection.................................................................................. 11 IntroductiontoGTFS...................................................................................................... 13 GTFSInconsistencies...................................................................................................... 18 AlgorithmSummary....................................................................................................... 23 TestingandValidation................................................................................................... 34 Conclusion..................................................................................................................... 38 Recommendations..................................................................................................... 39

References............................................................................................................................ 41



v

List of Tables
Table1-SixdefinedstandardTimePeriods..................................................................................8 Table2-TTCGTFSSummaryexample........................................................................................16 Table3-GTFSFileLocationsforGTHAAgencies.........................................................................19  



vi

List of Figures
Figure1­TransitServiceAvailabilitySample................................................................................3 Figure2-ComprehensiveDialogBox .............................................................................................9 Figure3­GTFSFileFieldRelationships......................................................................................17 Figure4-AlgorithmSummary.....................................................................................................23 Figure5-DialogBoxincludingsampleinputs.............................................................................24 Figure6-FinalTransCADoutput .................................................................................................33 Figure7-QCSummaryofSept10PlanningDate.......................................................................35 Figure8-ExampleofIntermediateFilesusedforvalidation......................................................36 Figure9-Checkingroutesservicingeachintersection...............................................................36 Figure10-ValidationoffinalGTHATransCADRouteSystem .....................................................37 Figure11-MontrealTransCADNetworkbuiltwithTNB............................................................37 



vii

1

Introduction

Metrolinx was created in 2006 as an agency of the Government of Ontario to "improve the coordinationandintegrationofallmodesoftransportationintheGreaterTorontoandHamilton Area (GTHA)," (1).  Initially, the governing board of the agency included both private-sector technical experts and local political representation, which provided the cross-party support requiredtocreateanewregionaltransportationvisioncalled,"TheBigMove,"(2).TheToronto areasuffersfromsomeoftheworstcongestioninNorthAmerica,wherecommutersspendon average66minutesgettingtoandfromworkeveryday,hamperingeconomicgrowthtothetune ofsixbilliondollarsperyearinlostproductivity(3).Therefore,thecornerstoneoftheplanwas toimprovemobilityefficiencyintheGTHAbybuildingover1200kilometresofrapidtransitwithin a25-yeartimeline(2). TheplanandMetrolinxgovernancemodelwereseenasanimprovementondecadesof regionaltransportationplanningfailuresduetheambitiousgeographicalcoverage(something for everyone), the backing of municipal and provincial decision makers, and the insertion of independentprivatesectorexpertstothedecisionmakingprocess(4).In2009,Metrolinx'srole as politically independent transportation planning advisors was cemented when the province restructured the accountability structure of the agency.  Ontario's Bill 163 removed electable political representatives from the Metrolinx board (5) intending for transportation decision makingtobeseparatedfromtheshortertermthinkingofelectioncycles.Whiletheagencywas notgivenanyoverarchingauthority,ithascontinuedworkingcloselywiththeprovince,planning departments in each municipality, and transit operators to improve regional connectivity.



1

Beyond the overall "Big Move" plan, ongoing projects cover policy, capital, and operating initiatives including Regional Express Rail, Investment Strategy, Fare Integration, Wayfinding, RegionalRelief,andProjectEvaluationtonameafew(6). The "Big Move" plan identified the overall vision for regional connectivity and specific corridorsforinvestment,itdidnotincludesufficientdetailsthatdecisionmakerscoulduseearly ontoevaluateprojectalternatives.Toensurethatindividualprojectswereconsistentwiththe overallobjectivesofthe"BigMove"andtoprovidereturnoninvestmentguidanceforarangeof potential rapid transit implementations, the Metrolinx Economic Analysis team, following the leadofTransportforLondon(7)begantopublishBusinessCaseAnalyses(BCAs)(8).Thesecover "transportationuserbenefitscomparedtothefinancialimpact;goodvaluefortax-payerdollars; environmental, economic and social benefits of the various alternatives; the impacts that a projecthasoncommunities;andalignmentwiththecurrentpolicyobjectives,(8)." Whilethe businesscaseapproachhasbeenpraisedforitsuseoftheMultipleAccountEvaluation(MAE) technique to quantify project costs versus anticipated benefits (9), the analysis is non-trivial, takingmonthstocompleteforasingletransportationcorridor (10).Itprovidesthemostvalue whenevaluatingcapitalprojectsbutitomitsanyanalysisontheimpactofservicefrequencies and the quality of on-the-ground operations.  Given this limitation, the Metrolinx Economic Analysisteam,ledbyDanielFisherandMichaelSutherland,commissionedthedevelopmentof anaccessibilitytool,calledWithinReach,toevaluatetransitserviceavailabilityacrosstheregion. 



2

2

Conceptualization of WithinReach and the Transit

Network Builder
TheWithinReachprojectwasconceivedbymembersoftheMetrolinxEconomicAnalysisteam, whohadusedaccessibilitymetricswhenpreviouslyworkingforTransportforLondon(TfL)(11). Basedontheirexperiencesthereandlocalpriorities,threeapplicationareaswereenvisionedfor thetool(12).Thefirstwasageographicalrepresentationofthedifferenceinservicefrequencies tocompareregionaltransitavailabilityat-a-glanceandidentify"transitdeserts"(seeFigure1).


Figure1­TransitServiceAvailabilitySample(13)

  Thesecondapplicationwastousetheserviceavailabilitydataalongsidedemographic,

socio-economic, zoning, and density data in Geographic Information System (GIS) to further identify areas for further transit investment prioritization.  The last piece was to allow transportationplannerstoevaluatehowtransitaccessibilityscoreswouldchange(andintheory improve)ifanycombinationoftransitimprovementswereputintooperation.  3

InWithinReach,twotypesofGTHAaccessibilityscoresaresupportedandtheregionis brokenupintoagridtosimplifythecalculationanddecoupleitfromnodesonthetransportation network,whichcouldchangeovertime.Thefirstmetric,knownasAccessibilitytoTransit(ATT), isbasedontheEquivalentDoorstopFrequency(EDF)calculationusedatTfL (11).Itevaluates thetotalaccesstimeformeverygrid-pointtoeveryavailabletransitservicewithinacatchment area.  For grid-points with multiple transit services available, the combination of all services providesthescore.Oncethisisevaluatedforallpoints,theuserisabletochoosewhetherthey'd liketheinformationdisplayedonalinearorlogarithmiccolourscale.(14) Thesecondmetric,knownasAccessibilitytoDestinations(ATD),focusesonthedistance travelledbytransitwithinafixedtimebudgetfromasetoforiginstoasetofdestinations(O-D). ItextendstheATTcalculationbyaddingtheshortestpathtraveltimesforeachO-Dpairtothe accesstimes,andallowsanalyststoseetheimpactofthespeedofservice.Morespecifically,it showcasesthemodaladvantageofbeinglocatedclosertohigherorderrapid-transitasopposed tohigherfrequency,butslowersurfaceroutes(14). TheATTandATDaccessibilitycalculationsrequiredetailedinformationaboutthetransit routes serving each grid point.  Additionally, the results may be investigated alongside other geospatialdata.Therequiredbreadthofanalysiscapabilitiesmeantthatonlycertainspeciality toolscouldmeettherequirementstocombinetransportationplanning,publictransitrouting,a GISengine,customscriptsfordataprocessing,andgraphicaluserinterface(GUI)automation. Due to license availability, the team's familiarity with the tool, and the support for the aforementioned features (15), Caliper Corporation's TransCAD software was chosen as the implementationmediumbyMetrolinx(12).



4

In the GTHA, transit schedules are published using the GTFS (General Transit Feed Specification)standardforeachofthetenserviceoperators(seeSection5forGTFSdetails).The GTFSfilesetforeachagencythereforeprovidesaconvenientsourcelocationforobtainingthe transitroutesoperatingateachstop,asrequiredfortheATTandATDcalculations.However, theschedulesinthisformatareincrediblyspecificandcoverindividualvehiclelevelperformance (i.e.absolutestop-by-stoptimestamps)foreverytransitrunforeveryrouteacrossaserviceday (seeSection5forGTFSdetails).Itwasdecidedthatrequiringvehicle-runlevelofdetailwouldbe overkillforboththebaseline(i.e.currentnetwork)generalizedaccessibilitymeasureaswellas future,potentialtransitimprovements.Requiringthislevelofprecisionforwhatcouldbealarge numberofhypotheticaltransitprojects/alignments/servicedefinitionswouldhaveundermined thevalueofWithinReachasarapidanalysistool.Consequently,thetransitnetworkdefinition required to run the ATT and ATD calculations became overall route-by-route performance summary for a user-specific time period on a typical service day.  The key metrics being the averagevehicleheadwayandtheaveragetraveltimetothenextstoponasinglevehiclerunof theroute(12). ForthefirstversionoftheWithinReachtooldeliveredbyAruptoMetrolinx,theGTFS transitschedulesforeachagencyweremanuallysummarizedusingacombinationofthebuilt-in TransCAD functions, as well as database and spreadsheet operations in Microsoft Excel and Microsoft Access.  The GTFS file manipulation and pre-processing for a single set of transit schedulesfromFall2014tookseveralweeksofforanintermediateconsultant,withafurther weektoimportandpreparethefinalgeospatialdatasothattheTransCADenvironmentcould beusedtoruntheATTandATDcalculationsontheexistingnetwork, (12).Thedeliveredtool



5

wassufficientforaperiodofmonths,howevertherenewedfocusbytheprovinceandGTHA municipalitiesonimprovingtransitoperationstoaddressshort-termneed(16)(17),hasresulted inthebaselineregionalaccessibilityscorescalculatedusingtheFall2014GTFSfilesetbecoming dated. Whilethesamemanualnetworkbuildingprocessfrombeforecouldhavebeenrepeated, there was no ongoing added-value in doing this continually to stay on top of schedule improvementsthatcouldhappenasoftenaseverysixweeks.Forthisreason,theteamsatArup and Metrolinx partnered to build a Transit Network Builder (TNB).  The TNB would programmaticallyandautomaticallypre-processnewGTFSfilesetsandpreparetheTransCAD environmentforaccessibilitycalculationswithinhoursofcomputingtime,insteadofweeksof manual person-hours.  This would allow Metrolinx (and in the future, other transportation planners)tokeepbaselinenetworkseasilyup-to-date,whilefocusingeffortsonevaluatingthe viabilityoffutureprojects(18).  Theremainderofthisreportwilloutlinethealgorithmdesign,development,andtesting

processes.Itisbrokendownintosectionstohelpthereaderfollowthedecisionmakingprocess andprovidesomeproceduralguidanceonworkingwiththeGTFSstandardandusingtheGISDK scriptinglanguagewithintheTransCADenvironment.  



6

3

System Requirements and Overall Procedure

The overall purpose of the Transit Network Builder (TNB) is to make it easy for Metrolinx transportationplannerstokeepthebase-linetransitnetworkup-to-datesothatongoinganalysis inWithinReachalwaysconsidersthecurrentstateoftransitoperationsintheGTHA.Thismeans thatthefinaloutputoftheTNBhastobeaTransCADworkspacethatcontainsthetransportation network and all transit services including performance details of each route.  While the automationofboththeGTFSanalysisandthepreparationoftheTransCADenvironmentwould growthedevelopmenttimeoftheproject,thiswasthebestwaytoensurethedatawasbeing preparedconsistentlyeverytimeandtominimizeanyfutureeffortonthispiece.  Fromadatainputperspective,summarizedtransitperformancedataforeachrouteis

requiredtoruntheWithinReachaccessibilitytool.IntheGTHA,alltentransitoperatorsprovide detailedscheduleinformationintheGTFSfilestructure.Therefore,inordertolimitthescopeof developmentandfocusonMetrolinx'sneeds,itwasdecidedthatthefirstversionoftheTNB wouldonlysummarizeschedulesprovidedintheGTFSformat(18). Due to the length of time required to analyze the GTFS schedules, route performance averagingwasonlycompletedfortheAM-Peakserviceperiodduringthemanualpreparationof thedata.Withthecomputationalalgorithmdirectlyreplacingthehands-onstages,thislimitation wasremoved.Duringthekick-offmeeting,sixstandardtimeperiodsforGTFSsummarization weredefined(seeTable1).Furthertothis,theoptiontospecifyuptothreecustomtimeperiods wasaddedtotheTNBrequirementsbyMetrolinx (18).Thisadditionofthetemporalflexibility furthercementedtheneedfortheautomatedTNB.Duetothelabourrequired,processingtime, and(insomecases)dataavailability,MetrolinxBCAsandplanningeffortstypicallyfocusonpeak-



7

houranalysis (8).Astheavailabilityoftransitservicenormallyfluctuatesthroughouttheday, accessibilitymetricscannowreflecttheregionaldifferencesinonversusoffpeakservice. 
Table1-SixdefinedstandardTimePeriods(18)

TimePeriodLabel All-Dayaverage AMPeakaverage Middayaverage PMPeakaverage Eveningaverage Overnightaverage  

TimePeriodStart(24hclock) 0600 0600 0900 1600 1900 0000

TimePeriodEnd(24hclock) 2100 0900 1600 1900 2359 0600

Thesecondkeypieceofinputdatawasthegeographicalrepresentationoftheintegrated

transportationnetworkandregionofanalysisinTransCAD.Toloadandprocesstransitroutes, theTransCADworkspacerequiresanunderlyinglinelayersymbolizingtheoveralltransportation network (19).  Additionally, the WithinReach ATT and ATD metrics are calculated based on subdividing the region into grid-points.  For this application, the Ontario Ministry of Transportation(viaMetrolinx)providedageographicshapefile,calledtheOntarioRoadNetwork (20).Whilethisincludedallofthepavementandroadsintheprovince(andthereforeregion),it wasmissingtheheavyrailtracksthatGOTransitrunsonandtheTTCMetro/Subwaynetwork. ThiswasaddedbyArupGISspecialistsintheearlystagesoftheinitialprojectandkeptup-todate through the opening of new transit-only links like the Mississauga Transitway.  Lastly, becauserailtransitstationsaretypicallylocatedofftheexplicitroadgrid,ArupGISspecialists created"walking-only"linkstoconnectstationstotheroads,andensurethattheATTandATD calculationscouldevaluatethewalkingtimes(i.e.accesstimes)accordingly.Thus,anintegrated transportationnetworkfile,includinglinksforroads,heavyrail,metro/subway,andwalking-only  8

links,isanessentialrequirementforTransCAD.FromtheperspectiveoftheTNB,itisassumed thatthesefileshavealreadybeenprepared,priortoanyrunofthealgorithm(18).  ThelastrequirementwastominimizeuserinterventionduringtheexecutionoftheTNB.

ThevolumeofdataineachGTFSfilesetissubstantialandthepreviousexperienceprocessing thedatamanuallyusingMicrosoftAccessprovidedtheguidancethatthealgorithmcouldtake severalhourstofinishexecuting.Insteadofrequiringperiodicuserinputstospecifydataatthe stagewhereit'sneeded,asingleallencompassingdialogbox(seeFigure2)wasdesired(18).


Figure2-ComprehensiveDialogBox(36)

  The last system design consideration is TransCAD's built-in GTFS file set.  Since 2012,

TransCADhassupportedthedirectimportofGTFSfiles(21),howeverexperimentingwiththisat thestartoftheTNBprocessindicatedthattheimplementationwouldnotbeappropriate.The TransCADGTFSimportonlysupportsonceagencyatatimeandsoamulti-agencyregionhasto bemergedafterthefact.Thisisnotstraightforward.Secondly,theGTFSimportincludesallof  9

the detailed schedule information and not the summarized route performance needed for WithinReach.Metrolinxrequiredmorecontrolovertheroutesummaries,specifictimeperiods, andtraceabilityinthecalculationssothebuilt-infunctionalitywasnotused(18).  Given the above requirements, the TNB can loosely be broken down into two major

segments.Thefirstisthepre-processingandsummarizationofthedetailedGTFSscheduledata intoanaveragefrequency/headwaybasedaggregation,andthesecondisthecreationofthe amalgamatedandrepresentativeworkspaceinTransCAD.Thenextsectionwilloutlinedecisions aroundthetoolsselectedforimplementation.  



10

4

Programming Language Selection

TransCAD is built on the GISDK (Geographical Information System Development Kit) engine, offering a built-in compiler, scripting engine, and the ability to immediately run commands alongsidethenativeGUI(graphicaluserinterface)commands.Withthetwostageseparationof theTNB,therewastheopportunitytoconsiderandevaluateexternaltoolsthatcouldbeused forthefirststageofGTFSsummarization.Intheend,thedecisionwasmadebythedeveloper towritetheentirealgorithmintheGISDKscriptingalgorithminsteadoftryingtouseanexternal .NETcaller(18). TheprimaryjustificationwasthatGISDKwouldstillhavetobelearnedandusedeven with a .NET calling structure, which would have complicated the development and troubleshootingprocess.Additionally,thesimplicityofseamlessintegrationbetweenGISDKand TransCAD,thebuilt-intablemanagementandSQLfunctions,andtheGUIinteractionwereall advantagesofmaintainingalldevelopmentwithinGISDK(15).Using.NETwouldhaveaddedan additionalcallingandremoteexecutionlayer. TheGISDKfunctionsetislimitedcomparedtoafullyfledgedprogramminglanguage.It is a scripting language that supports 850 functions (15), inclusive of TransCAD GIS and transportationplanningspecificfunctions.Notallstandardfunctions,suchasarraysorting,are normallyavailable,andduetothelimiteddomainofthetool,supportresourcesarenotreadily foundontheinternet.Thismadetheinitialramp-upperiodofusingGISDKdifficultandinitially anexternallanguagewaspreferredfortheGTFSstep. ThealgorithmneededtobelaunchedfromaTransCADdialogbox,meaningthatevenif .NETwaspreferableforGTFSprocessing,GISDKwouldstillbeneededfortheinitialsetup.Inthe



11

end,becausetherewasnoavoidingGISDKthroughoutdevelopment,itmadesensetogothrough the initial pain of learning the language up-front.  As knowledge of the syntax and functional specificationswasgained,thepaceofdevelopmentaccelerated.Lastly,theCaliperCorporation TransCADandGISDKsupportisexcellent,providinganoutletforfurtherresourcesandtraining asneeded.  TheseamlessintegrationofthescriptinglanguagewithTransCADwasabonusinusing

thesoftware.Codecouldbewritteninanytexteditorandwascompiledandrundirectlyfrom TransCADcontextmenus.Therewasalsothe"ImmediateExecution"functionalitythatallowed code to be run immediately on any items open in the TransCAD GUI.  This allowed for rapid prototypingthroughoutdevelopmentandtheabilitytotryoutshortsectionsofcodeandsyntax withinstantfeedback.Forexample,ifafiltercommandneededtobetested,thefilecouldbe opened using the TransCAD context menu, and "Immediate Execution" used to see if the intendedcodeworkedcorrectly.Ifanexternal.NETcompilerwasused,thealgorithmwouldnot have this functionality and a special development environment would need to be used, with somebackandforthrequiredtotestfunctionality.  The built-in file and data management was another plus for TransCAD.  The initial

intentionwastousearraystoprocesstheGTFSdata,butthisdrasticallyincreasedtheprocessing timeandwasinefficient.ConvertingtheGTFS.txtfilestobinaryfilesusingTransCAD'sbuilt-in file functions allowed the files to be accessed efficiently, including being able to use SQL commandsonthefilteringandprocessing.WhiletheTransCADSQLfunctionsarelimited,they areatleastintegratedandavailablewithoutneededanexternalengineasanadd-on. 



12

5

Introduction to GTFS

Although each transit agency uses their own software to manage routes, allocate/schedule vehicles(runcutting),andassigndrivers(blockcutting),thecreationoftheGeneralTransitFeed Specification(GTFS)byGoogle (22),hassimplifiedtransitschedulereportingandanalysis.As discussedinthesystemrequirements,alltenGTHAagenciesthatMetrolinxworkswith,useGTFS asacommonoutputformat.ThisstreamlinedtheprogrammingoftheTNBasonlyonetypeof timetablestandardhadtobesupportedasadatainput.  The GTFS reference is available online (23) and provides information on a common

structureforsavingandexportingtransitschedules.Thewebsiteincludesinformationonthe naming conventions of files and individual fields within each file, as well as required versus optionalinputs. AdetailedreproductionoftheGTFSreferenceisbeyondthescopeofthisreporthowever theauthorhasincludedsomehigh-levelguidanceonthestandard.Thenotesintheremainder of this section were based on the programmer's experience in using and interpreting the file reference in an actual project.  They are being shared to introduce readers to the standard's terminologywithinthecontextofthereportandmayalsoservetohelpfutureGTFSusersintheir ownunderstandingofthespecification. While GTFS is intended to be a standard the implementation in practice contains inconsistenciesthathadtobeunderstoodindepthbeforecodecouldbewrittentoautomatically process the files for the TNB.  GTFS files are typically published as .zip files on each agency's websiteormadeavailableonlineattheparentmunicipality/governmentorganization'swebsites



13

(seeTable3below).TheTNBusessixcoreGTFSfilesforanalysis,andashortdescriptionofthese filesisprovidedbelow.  calendar.txtandcalendar_dates.txt(23) Thecalendarfilesdefinewhichgroupoftransitservices,knownas"service_ids"operateona givendate.ApublishedGTFSfilesetincludeseverytransitvehiclerunwithinadaterange,for alldates,includingweekdayversusweekendversusholidayschedules.Thesimplestuseofthe "service_id" field is to categorize trips by these three broad service categories.  The GTFS standardrecommendsusingthecalendar.txtfiletospecifythetypicalservice_idsthatoperate on a specific date, based on the day of the week, across a date range, whereas the calendar_dates.txtfileshouldbeusedtoidentifyspecificdateswhereanexceptionoccurs.Most exceptions are when holiday service is being run on a weekday instead of typical services, implyingthatthecalendar_datesfileshouldbeprocessedafterthecalendarfile.  routes.txt(23) The routes.txt file is an informational summary relating a numerical and unique "route_id" identifier(usedinotherGTFSfiles)tothecommonlyknownpublicrouteinformation,suchas route name and number.  It also specifies the transit technology for a specific line in the "route_type"field.   



14

stops.txt(23) Thestops.txtfile,likeroutes.txt,isaninformationalsummaryofalltransitstops(currentand sometimeshistorical)foranagencyandisusuallythethirdlargest(longest)filewithinafileset. Thestopsfileprovidesauniquestopidentifiercalled"stop_id"andrelatesittothecommonly (publicly)knownstoporstationname.Italsoprovidesthelongitudeandlatitudecoordinatesof eachstop,whichisneededwhenimportingtransitservicesintoGIS.  trips.txt(23) Thistrips.txtfileisthefirstoftwomajoramalgamationfilesthatdefinetransitoperationsinthe GTFSstandardandisusuallythesecondlongest/largestfile.Itlistseverypossiblevehiclerun (i.e.everytimeavehiclestartsarunonaroute)thatexistsforeveryrouteandallservice_ids acrossalldatesthatthefilesetisintendedtocover.Eachtripisgivenauniqueidentifiercalled trip_id,andeachtripalsohasfieldsthatdefinetheroute_idandservice_idparametersoutlined inthecalendarandroutefilesforthesakeofcross-referencing.  stop_times.txt(23) Thestop_times.txtfileisthelargestoftheGTFSfilesinasetandconnectsthegeospatiallocation of transit stops (stop_id) with individual transit vehicle runs (trip_id).  The stop_times file providestheorderofstopsvisitedbyavehicleinagivenrun,aswellastheabsolute24-hour timestampthateachvehicleisexpectedtoarriveateachstop.Itisthemostcriticalfileforthe TNBbecauseitcontainsdetailsaboutstoppingpatternsforeachrouteaswellastimeelapsed foravehiclerun.



15

 Asanexample,afilebyfilerelativesizebreakdownofthetheTorontoTransitCommission's(TTC) GTFSfilesetfromAugust26th2015(24)isprovidedin Table 2.TheTTCpublishesanewGTFSfilesetevery6weeksorsoandthedatasummarized belowincludesallservicesoperatingbetweenSeptember6th2015andOctober10th2015.


Table2-TTCGTFSSummaryexample(25)

Files
Calendar.txt Calendar_dates.txt Routes.txt Trips.txt

DescriptiveGTFSSummaries
4serviceIDs:1,2,3,4 RepresentingWeekday,Saturday,Sunday,andholidayservice th 1exceptiondateonMondaySeptember7 (LabourDayHoliday) 192routes 127,895totaltransittripsacrossalldates/service_idsandroutes  42,567transittripsoperatingonservice_id=1,atypicalweekday 10,737TTCstopstotal 4,800,543totalstop_timesforallpossibletrip_ids  1,563,801stop_timeslistedforthosetrip_idsthatoperateonservice_id=1dates.

Stops.txt Stop_Times

 Adatabaserelationshipdiagramwhichconnectsthesixmainfilesisprovidedin Figure3 below,withtheGTFSrequiredfieldsinboldandtheoptionalfieldsinnormalfont.



16


Figure3­GTFSFileFieldRelationships(26)

 



17

6

GTFS Inconsistencies

TheGTFSreference (23)recommendscertainimplementationpracticesforthefilesandfields. However,becausethefilesetsaregeneratedfrom3rdpartyschedulingsoftwareandtheoutput istext-based,theserulesarenotenforced.Thiscanresultineachagency'sfilesetbeingexported withslightdifferences,whichcanbeproblematicwhentryingtowriteageneralalgorithm.This section highlights specific inconsistencies to be wary of when working with GTFS files from differentagencies.  GTFSFileAvailability&Updating One of the most challenging aspects of keeping a transit network up-to-date is the manual processforobtainingeachagency'sGTFSfilesetandtheawarenessofnewreleases.Thereare noreliablecentralizedlocationscontainingthelatestversionforeachagency,andcategorization onlineiserratic,renderingtheuseofGoogleandcommonsearchtermsuseless.SomeGTFSfiles are easily found on agency/municipality websites, whereas others could only be obtained by contactingtheoperatorsdirectlyand/orsigningadatasharingagreement.Thefewaggregator websitesthatdoexistarefrequentlyout-of-dateorincomplete.  This "fetching" nature of obtaining GTFS files is further complicated by the differing

scheduleupdatecyclesbetweenagencies(evenwithinthesameregion).Someagencies,likethe TTCprovideupdated/improvedscheduleseverysixweeks (24),whereasothersonlyupdatea coupletimesperyear,whichmeansthattherecognitionofapatterncantakeawhileSome guidance can be gleaned from the range of dates in the calendar files, however, in general multipleweblocationsneedtobeintentionallycheckedonaregularbasis. Table3providesthe



18

websiteswheretheGTFSfilescanbefoundforthetenGTHAtransitagencies. 
Table3-GTFSFileLocationsforGTHAAgencies

AgencyName TTC(24) GOTransit(27) Mississauga MiWay(28) BramptonTransit (29) OakvilleTransit (30) BurlingtonTransit (31) MiltonTransit YorkRegion Transit(32) HamiltonStreet Railway(33) DurhamRegion Transit  Datamanagement

GTFSFileSourceLocation http://www1.toronto.ca/wps/portal/contentonly?vgnextoid=96f236899 e02b210VgnVCM1000003dd60f89RCRD http://www.gotransit.com/publicroot/en/schedules/DeveloperResource s.aspx http://www.mississauga.ca/portal/miway/developerdownload http://www.brampton.ca/EN/City-Hall/OpenGov/Open-DataCatalogue/Pages/Data-Set-Details.aspx?ItemID=1 http://www.oakville.ca/data/oakville-transit-route-information.html http://cob.burlington.opendata.arcgis.com Notavailablepubliclyonline­ContactagencyorTownofMiltonformore information http://www.yorkregiontransit.com/en/aboutus/GTFS.asp https://www.hamilton.ca/city-initiatives/strategies-actions/openaccessible-data Unavailableonline/publicly­requiresdatasharingcontractwithRegion ofDurham

Vehicleleveltripdetailsareexportedfromindustrystandardschedulingintotextformat.The standardcannotassertanyruleswithrespecttodatavalidation,cleanup,andmanagement.It isthereforeuptotheindividualtransitschedulersateachagencytomanageandremovestops thatarenolongeroperational,eliminatetripsandservicedatesinthepast,andtonotstore scheduleversionsorvariantsasdifferent"service_ids."Allofthesescenarioswereencountered whenanalyzingthetenGTHAagenciesandresultedinseveralidentifiersexistinginonefile,but notintheothersthatarecross-referenced (26).TheTNBhadtobeflexibleenoughtohandle  19

datathatisimperfect.  CalendarFilesandServiceIDs Thecalendarandcalendar_datesfilesareintendedtoworkintandemtodefinewhichservice_ids operateoneachspecificdate.AccordingtheGTFSreference(23),thecalendarfileshouldbe readfirsttodefinethetypicalservicethatoperates,withthecalendar_datesusedtoidentify exceptionssuchasholidaysorextendedservicechangessuchasamajordetourlastingmore thanacoupledays.Therecommendedpracticeisforeachdatetohaveoneservice_idhowever some agencies sub-divide service_id operations by geography, detours, route types (express/local),and/orvehiclecategories.Thismeansthatanyautomationsoftwaremustbe abletohandleasingledatehavingmultipleservice_ids.  Otheragencies,suchasGOTransit(27),usethecalendar_datesmethodofhandlingevery

dateasanexception,omittingtheuseofcalendar.txtentirely.Handlingeverycalendardateas anexceptioncanbeadvantageousiftherearedifferentservicesbeingofferedeverysingleday of the year, however in practice this is unlikely and is be a customer service and way-finding nightmare.Anyautomatedsoftwareneedstobeabletoautomaticallydetectbothvariants.  MissingStopTimeData Thestop_times.txtfile (23)isintendedtoprovidethetimeofarrivalanddepartureforevery transitvehicleoneveryrunforeverytripintheschedule.Sometransitagenciesinsteaduse timingpointsandonlyprovideabsolutearrivalanddeparturetimesforonlyaportionofstops onatrip.IntheGTHA,threeofthetentransitoperatorsusethismethodofreportingschedules.



20

Forconsistencyinimportingandanalyzingtheschedules,themissingstoptimeswillneed tobebackfilled.Thiscanbedonebycalculatingthetotalrunningtimeofatransittrip,andusing the total travelled distance and the assumption of constant speed between timing points to linearlyinterpolateandfillinthemissingdata.  RouteIdentification InGTFS,theroutes.txtfile(23)containsdescriptiverouteinformationtoconnecttheuniqueGTFS identifiers to the public route names.  One of the issues is that GTFS, and by corollary the schedulingsoftware,doesnotexplicitlydistinguishbetweenroutebranches,routevariants,and scheduledshortturnoperations.ThesedifferentstoppingpatternsarereportedinGTFSasthe samephysicalroutenumber.Thislackofdetailisproblematicintheaccessibilitytoolasthe variants each have unique service frequencies and travel speeds.  The routes will need to be separatedgiventhelevelofanalysisbeingdone.  DataFormatandColumnOrder TheGTFSfileformatspecifiesthatthefilesinthesetmustbeoutputas.txtfiles,andrequires certaincolumnlabelstoappear (23).Itdoesnotspecifictheorderofthecolumnsorthedata typesineach.Lastlyitdoesnotspecifytheformattingstandardforthetextfiles.Withinthe GTHA, two different text formats are used, ISO-8859-1 and UTF-8-VOM, and there is inconsistencyinthepresenceandorderofdatafields. Becausecertainfields(datacolumns)arekeyinGTFSanalysis,allfieldsfirstneedtobe scannedtodetermineorderbeforecomma-delimitingandtheconversiontoatablecanoccur.



21

Also,theISOtextformatprependstextfileswritteninitsformatwitha3-characteridentifier code.Insimpletexteditorsthiscancauseanerrorwhenlookingforspecificcolumnnamesthat don't exist because the first entry in the text file has additional characters.  When writing software,anextraconditionalprocessingstepwillneedtobewrittenandexecutedifanexact columnmatchdoesnotoccur.  



22

7

Algorithm Summary

Theprevioussectionshaveoutlinedsomeofthedifficultiesencounteredwhenworkingwiththe GTFSfilesetandrequirementsforpreparingtheTransCADenvironmenttoruntheWithinReach accessibility.Intheend,thefinalTNBalgorithmexceeded4900linesofGISDKcode,including comments (34).Whilethecodeitselfcannotbeincludedinthisreportduetoconfidentiality, thissectionprovidesahigh-levelstep-by-stepbreakdownofthealgorithm'soperations.Figure4 isanoverallprocessdiagram,showingthedialogbox,intermediatestages,andthelookofthe finalTransCADenvironmentwhentheaccessibilitytoolisready-to-run. 


Figure4-AlgorithmSummary(35)

 



23

DialogBoxInputs(seeFigure5)


Figure5-DialogBoxincludingsampleinputs(36)

 · FinalOutputsFolderLocation o FinallocationforallGTFSSummaryfiles(includingintermediatefilesgenerated byTNBprocess),andTransCADWorkspacefiles · TransportationNetworkFileLocation o Inputthatspecifiesthelocationofthetransportationnetworkshape/geographic databasefile · Customtimeperiodsanalysis o Dropdown menu allowing to user to add from 0-3 additional time periods for networkperformanceaveraging § Additional fields to define the start and end times of each custom time periodbecomeavailabledependingonthenumberselectedabove.



24

·

TransitAgencyinputs o AsktheuserhowmanytransitagencyGTFSfilesets(1-10),thatwillbeusedto generatethesummaryfilesandthenimportedintoTransCAD § Theuserisaskedtonameeachagency,specifythecalendarplanningdate forthatagency,andspecifythefolderlocationoftheGTFSfiles

 Generationof3SummaryFiles ThreeGTFSsummaryfilesaregeneratedinthealgorithminthefirststageoftheprocessthatwill befilledinastheaveragingproceeds. 1. Listofallstops(AllStops) o Createsamasterstoplistinonefilethatassignsauniquestop_idtoeachentry o Opensthestops.txtfileforeachagency o Alsoincludesthefollowingstops.txtdata: § § AgencyName StopIDaswrittenintheGTFSstops.txtfileforeachagency.Thisfieldis notcheckedforuniquenessasmultipleagenciesmayusethesamestop identifier, however the first field - unique stop id field allows for the separation § § § Stopname Latitude Longitude

2. ListofallRouteInformation(RouteInfo)



25

o Will be filled in as routes are summarized in the first stage of the process, but needstoincludethefollowingfields: § UniqueOverallRouteID-uniqueidentifierforeachindividualroutevariant discoveredbyanalysingstop_times.txtstoppingsequencesforallagencies § § § AgencyName RouteIDasidentifiedintheGTFS Route Variant ­ sub category of route IDs based on unique stopping patterns § § § § § § § § § § § § § RouteTechnology­transittechnologyidentifierfromGTFS AllDayaverageheadway AMPeakaverageheadway Middayaverageheadway PMPeakaverageheadway Eveningaverageheadway Overnightaverageheadway CustomTimePeriod1averageheadway CustomTimePeriod2averageheadway CustomTimePeriod3averageheadway RouteShortName RouteLongName StoppingSequence

3. ListofallRoutesincludingthestops(RouteStops)



26

o Thisistheequivalentofanoverallstop_times.txtfileforallagenciesbutonlyhave 1triporvehiclerunforeachuniqueroutevariant o Starts as blank that will be filled throughout the algorithm with the following fields: § § § § § § § § § § § § § § § § §  UniqueRouteStopidentifier UniqueOverallRouteID(matchingtheRouteInfofile) AgencyID RouteIDasidentifiedintheGTFS RouteVariant StopOrderNumber StopIDasidentifiedintheAgency'sGTFS TheIDofthenextstopintheroute AllDayaveragetraveltimetonextstop AMPeakaveragetraveltimetonextstop Middayaveragetraveltimetonextstop PMPeakaveragetraveltimetonextstop Eveningaveragetraveltimetonextstop Overnightaveragetraveltimetonextstop CustomTimePeriod1averagetraveltimetonextstop CustomTimePeriod2averagetraveltimetonextstop CustomTimePeriod3averagetraveltimetonextstop



27

Stage1SummaryofGTFSfiles · DeterminethesetofServiceIDsthatareactiveontheplanningdateforeachagency o Taketheuserinputtedplanningdateanddeterminedayoftheweek o Firsttrytoopencalendar.txtforeachagencyifitexists,ifitdoesn'tgostraightto calendar_dates.txt o Ifcalendar.txtexists § Usethedaterangeanddayoftheweektodeterminethenormal/standard serviceIDset o Alwaysopencalendar_dates.txtifitexists § Searchfortheplanningdateinthefile.Ifitdoesn'texist,thenthereare noexceptionsandleaveserviceIDsetasis § Iftheplanningdateexistsinthefile,add/removetheserviceIDpreviously specifiedincalendar.txtbasedontheException_Typecolumninthefile · Filteringtrips.txtfiles o For each agency, merge the routes.txt and trips.txt files and save the resulting masterfileasafixedformatbinaryfile o Usingthesetof"active'serviceIDsforeachagencyonthechosenplanningdate, filterthecombinedtripsfile,removinganytripsthatdon'trunontheplanning date o Storethelistofactive/runningtrip_ids · Filteringstop_times.txtfile o Openandsavethestop_timesfileasafixedformatbinary



28

o Usethefilteredlistofactivetrip_idstoremoveanytrip_idsfromstop_timesthat don'tmatch,creatingasmallerdataset · IdentifyingRouteVariants,TripTimeofDayoperations,AverageTravelTimes o Progressthrougheachagency'sstop_timesfileonlyonce,linebyline,astheyare large § § Sortthestop_timesfilebytrip_idandthestop_sequencevalue Createanintermediatefileusedtotrackuniqueroutevariantsforeach agency(AgencyRouteVariantMaster) § Create a temporary column to identify the route_variant within the an overallroute_ididentifier § Createcolumn(s)toidentifyiftripsoccurwithinanyofthe6-9timeperiods foranalysis § Calculatetherelativetraveltimebetweenstopsbasedonstop1arrival timeminusstop0departuretime,andstoreinnewlycreatedTTNS(time tonextstop)columnsforeachtimeperiod · Ifanagencyusestimingpointsinsteadofeverystopstop_times, thenskipthisstepandinsteadfillintheTTNSbasedontheentire tripruntime,withthebackfillingtobedonelateroncethedistance travelledinformationisavailable § Keeptrackoftheorderofstopidstoestablishatrip'sstoppingsequence andstoreasatemporaryvariable



29

§

Whenthelaststopinatripisencountered(therewillbeablankinthenext stop column), the stopping pattern for the trip is compared versus the AgencyRouteVariantMasterfile · If stopping pattern already exists, then fill the route_variant to match · If it does not, then add the new route variant to the AgencyRouteVariantMasterfile,giveitauniqueid,copythestored stopping pattern, and fill in the temporary route_variant column withthenewroute_variantsubID

·

RouteInformationsummaries(RouteInfo) o Usingthetemporarycolumnsinthepreviousstep,usethelengthofeachtime period,andthenumberoftransitvehicletripsforeachroutevariantwithineach timeperiodtocomputetheheadwayforeach o FillintheRoutedata,includingroutevariantidentifier,averageheadwayforeach timeperiod,andtheroutevariantsstoppingpatterntotheRouteInfosummary file

·

TravelTimeaveraging(RouteStopFilesummary) o Re-open the stop_times binary file that was created including the temporary columns o Createatemporarycolumnthatisatext-basedaggregateoftheagencyname, routeid,routevariant,currentstop,andnextstop



30

§

Usingthebuilt-inGISDKaggregatetablefunctionandcomputetheaverage time to next stop for each time period using this temporary columns uniquename(whichistheroutevariantspecificperformanceforagiven stoppair)

o CreateanentryintheRouteStopfileforeachroute,routevariant,andstopin order. o FilltheaverageTTNSforeachpairasdefinedabovewhichwillreflecttheaverage performanceofaroute  Stage2­TransCADintegration · · · CreateanewTransCADmap/workspace Importthetransportationnetworkgeographicfiles Usingtheattributestableforeachlinkinthenetwork,useSQLcommandstogeneratea subsetofalllinksthatare: o WalkingLinks(combinationofroads,walking-only,butnotfreewayorrestricted access) o Metro/SubwayOnlyLinks o RoadLinks(thatcanrunprivatevehiclesortransitbusesorLRT/streetcar) o RegionalCommuterHeavyRail · · GenerateaTransCADnetworkfileforwalking ImporttheAllStopssummaryfileintoTransCADasapointlayer,soalltransitstopsinthe regionarenowavailable



31

·

Groupthetransitstopsbythetransittechnologyeachstopsupports(basedontheGTFS route_typecolumnintheRouteInfocolumn) o Bus_streetcar_LRTstops o Metro_Subwaystops o RegionalHeavyCommuterRailstops

·

Createnewgroupingsforthetransportationnetworklinksbasedonwhetherthereare transitstopsidentifiedinthesummaryfilesthatactuallyoperateontheplanningdate. Thiswillcreateasubsetoflinksthatareactivefortransitintheanalysisthencreatea TransCAD network file for transportation network links that operate transit on the planningdate

·

CreateaTransCADroutesystembyimportingtheRouteInfoandRouteStopfiles o Thiswillcreatethetransitroute"spaghetti"ascanbeseeninFigure6 o CreateRouteSystemsubsetsbasedontheroutevariantsthatoperateineachtime period

·

Based on the overall route systems created in the previous step, create a TransCAD "transitnetwork"foreachofthe6(orupto9)timeperiodsoftheday

 Onceallofthesestepsarecomplete,theTransCADmapwillhavefivelayersasseeninFigure6 below,aswellasafilefolderthatincludestwotypesofbasicnetwork(transitlinks,andwalking links),aswellasbetweensixandninetransitnetworkfiles.Thesefilesareusedalongwiththe fivegeographiclayersintheaccessibilitytool. 



32


Figure6-FinalTransCADoutput(37)

 



33

8

Testing and Validation

Thedevelopmentofthealgorithmwasbasedonthepreviousmanualmethodforsummarizing andaveragingtheGTFSfiles,followedbyaTransCADimport.Acomprehensiveanddetailedset ofnoteswerenotavailableastheinitialversionproceededonatrial-and-errorbasis,however Arupconsultantswereabletoprovidesomeongoingguidanceandroughnotesfortheprocess to be replicated in GISDK (38).  The algorithm was programmed sequentially by a single developer,breakingdownindividualstepstomatchthetheoperationsandoutputsgenerated manuallyusingMicrosoftExcel.Developmentnoteswerekeptinroughformatinahardcopy notebook(39)andinaqualitycontrolsummaryfileinExcel(seeFigure7below).  DuetotheamountofdatainasingleGTFSfileset,ascalingprocesswasusedtovalidate

theinitialfilteringoperations.ThiswasdonebyvaryingthesizeoftheGTFSinputfilesfroma limitedcustomset,toasmalleragency,toalargeragency,andthenfinallymulti-agency.The customGTFSfilesetwascreatedbychoosingaspecificservice_IDandsetofroute_idsfromthe smallestagency(Milton)andfiltering/deletingdatausingExcelacrossthesixcoreGTFSfilesto match.Thisdrasticallyreducedthefilesizestoacouplekilobyteseach(dozensofentries),and meantthatTNBoutputsineachstagecouldbevalidatedvisuallyagainsttherawdata.Oncethe algorithmworkedforthe"custom"smalltransitagency,eachGTFSfile(forMilton)wasrestored one at a time, and rerun.  If it worked using the full Milton data, then a larger agency like MississaugaorTorontowasused.Thisprocessworkedwellbecauselargerdatasetscouldalways befilteredinExcelorTransCADandcomparedtothefilesgeneratedbythealgorithm. 



34


Figure7-QCSummaryofSept10PlanningDate(40)

  Algorithmvalidationforthelatterstagesproceededinasimilarfashion,typicallystarting

withalimiteddatasetandthenscalinguptoanentireGTFSschedule.Duetothesizeofthe data,arandomizedspot-checkingmethodwasemployedalongwiththegenerationoftemporary intermediarysummaryfiles(39)(seeFigure8).Onceoneofthelarger,summaryoperationswas performed,anumberofindividualroutesandstopswithinanagencywerequeriedinExceland checked in the intermediary files to ensure that the results "made logical sense."  While this required some faith in the back-end aggregation and math operations of GISDK, the instantaneous feedback of developing the code line-by-line using the Immediate Execution mitigatedtheconcerns. Thefinaltransitnetworkwascompletedaftertheimportingandcreationoftheregional "RouteSystem"inTransCAD.Twenty-fiverandomintersectionsacrosstheregionwereselected atrandomandqueriedontheTransCADmaptoprovidealistofroutesservingeachintersection fortheamalgamatedtransitnetworkbuiltfromtheTNBGTFSsummaries(seeFigure9).Thelist of routes at each intersection in TransCAD that manually checked against each agency's route/systemmaps(seeFigure10).



35


Figure8-ExampleofIntermediateFilesusedforvalidation(41)




Figure9-Checkingroutesservicingeachintersection(42)



36


Figure10-ValidationoffinalGTHATransCADRouteSystem(43)


ThefinaltestwastoseeiftheTNBwouldbuildanetworkforasetofagenciesbasedon GTFSfilesthathadneverbeenprocessedthroughthealgorithm.Inthiscase,theGTFSfilesfor thefouragenciesoperatingtransitservicesintheMontrealareaandageographicdatabasewere obtained.TheresultingTransCADworkspace(seeFigure11)wasbuiltwithoutanyerrors,and proves that the algorithm can be used to prepare networks for WithinReach that it wasn't designedwith.


Figure11-MontrealTransCADNetworkbuiltwithTNB(44)



37

9

Conclusion

Asoutlinedinthisreport,thedevelopmentofanautomatedTransitNetworkBuilderinvolves expertise in the GTFS file format, pre-existing knowledge of each agency's operations, and detailed knowledge of the TransCAD/GISDK environment.  Overall the project, including the initial training to understand the GTFS file set, TransCAD/GISDK familiarization, algorithm conception, development, and testing was a full-time job for an intermediate transportation consultantforfourmonths.Thisallowedforthedevelopmentofacomplexalgorithmthatcan generateacompleteandaccurateTransCADbasedtransportationnetwork,whichcanbeused formultipleformsofanalysiswithinhoursinsteadofweeks.Theautomaticsummarizationof routeperformancebasedonlow-levelschedulingdetailsfromGTFSfileswasakeycomponent of the algorithm and including analysis for multiple time periods was a large added bonus. Althoughthetooldevelopmentrequiredsubstantialinvestment,theeffortwillberecuperated within the first few runs/updates of a baseline transit network due to the time it saves consultantstofocusonmorevalue-addedtasksinsteadofdataprocessing.Theintentionofthe reportwastosupplythereaderwithanintroductiontotheGTFSfilestandard,considerations whenworkingwiththefileset,decisionmakingaroundTransCAD,andanoutlineofthealgorithm thatwasdeveloped.Itcanandshouldbeusedasreferencewhenconsideringanyprojectthat includestheGTFSstandard,orifusingGISDKinTransCAD.  



38

10

Recommendations

The Transit Network Builder was purpose built for Metrolinx's ongoing analysis of transit availability in the region.  The exercise served as an excellent introduction to both the GTFS standardandtheGISDKenvironmentandthoseskillswillbereusableinthefuture.TheMontreal example also proves that the algorithm was flexible enough (in general) to build a TransCAD workspacefromGTFSfilesthatwerenotpartofitsdesignandvalidationprocess.Thefollowing are recommendations to the reader for software development using GISDK and TransCAD, workingwithGTFS,andfurtheralgorithmimprovements. 1. WhenfirstlearningGISDK,thefunctionalsupportislimitedanddoesnotincludemany examples.Additionally,onlineresourcesarefewandfarbetween.Tobecomeproficient atGISDK,itisrecommendedthatauseruseacombinationof: a. Properlydocumented/commentedexamplecode b. Agoodmentor/reference c. AccesstoTransCAD/GISDKe-mailsupport d. and/orCompleteaformaltrainingclass 2. The implementation of transit networks in TransCAD for both display and processing requiresageographiclinelayer,theuseoftheroutesystemcreation/importtool,and thecreationofaTransitNetworkfile.SimilartotheguidanceprovidedforGISDK,formal training should be pursued to completely understand why the software has these differentcomponentsandtheinterplay/advantageofitsmethodology 3. UnderstandingtheGTFSformattobeabletoanalyzeitisnotasimpletask.Tomake learning the intricacies of the standard easier, the recommendation is that users start



39

analyzing a network they are deeply accustomed to.  It will be more obvious how the differentfilesandfieldsrelateifthereissomepre-conceivedcontextandfamiliarityto thenamesandplaces.  FortheTNBalgorithmthefollowingrecommendationsaresuggested. 1. Allowmoreflexibilityinhowthegeographicfileispreparedincluding: a. Automaticcreationofwalkinglinkswheretransitstationsareofftheroadgrid b. Flexibility in naming fields, and giving the user choices around the subcategorizationsofroutetypes c. Automaticdetectionoflayerandfieldnamestobeaddedtoadropdownmenuin thedialogbox 2. Openupthescheduleimportingtosupportnon-GTFSfileformats 3. CurrentlyLRTandBRTlinesareclassifiedasstandardin-mediumroadbasedservicesor asmetro-subwayrail.Anewcategorymayberequiredasthesetypesoflinescomeonline intheGTHAtosupportthemanyimplementationvariants 4. Automaticvalidation­itwouldbebeneficialtodevelopatesttolinkthesummarized GTFSfilesandTransCADroutesystemsbacktoanagency'ssystemmaporroutelistingto helpanend-userverifytheirownregion'simportedtransitnetworks Providetheusersuggestionsonthebestplanningdatetouse.Todaytheuserguideadvisesthat atypicalnon-holidayweekdayisthebestdatetoselect,howevermoredetailedguidancecould bebeneficialforthoseregionalrailagencieswheretheservicesbeingrunareslightlydifferent everyday. 



40

References
  (1) "MetrolinxOverview,"Metrolinx,TorontoON,n.p.,n.m.,Accessed­Jan142016,Web: http://www.metrolinx.com/en/aboutus/metrolinxoverview/metrolinx_overview.aspx  (2) "TheBigMove­TransformingTransportationintheGreaterTorontoandHamilton Area,"Metrolinx,TorontoON,Published­November2008,n.m.,Accessed­Jan14 2016,Web: http://www.metrolinx.com/thebigmove/Docs/big_move/TheBigMove_020109.pdf  (3) "TORONTO'SVITALSIGNSREPORT2015­GettingAround,"TorontoFoundation, Published­Oct2015,n.m.,Accessed­Jan142016,Web: https://torontofoundation.ca/sites/default/files/OP-TVS%202015-Full-ReportPRINTING.pdf  (4) Levy,E.,"RapidTransitinToronto­ACenturyofPlans,Progress,Politics,&Paralysis," BAConsultingGroup,TorontoON,2015,Book.  (5) "Bill163-AnActtoamendtheGreaterTorontoTransportationAuthorityAct,2006and tomakeconsequentialamendmentstoanotherAct,"LegislativeAssemblyofOntario, ProvinceofOntario,RoyalAssent&Published­May142009,n.m.,Accessed­Jan14 2016,Web: http://www.ontla.on.ca/web/bills/bills_detail.do?locale=en&BillID=2167&detailPage=bil ls_detail_status  (6) "RegionalPlanning,"Metrolinx,n.p.,n.m.,Accessed­Jan142016,Web: http://www.metrolinx.com/en/regionalplanning/regional_planning_index.aspx  (7) "BusinessCaseDevelopmentManual,"MayorofLondonUK-TransportforLondon ProgrammeManagementOffice,Published­May2013,Web: https://www.whatdotheyknow.com/request/197881/response/495035/attach/3/Busin ess%20Case%20Development%20Manual%20May%202013%20Redacted.pdf  (8) "BusinessCaseAnalysis,"Metrolinx,n.p.,n.m.,Accessed­Jan142016,Web: http://www.metrolinx.com/en/regionalplanning/projectevaluation/benefitscases/benef its_case_analyses.aspx  (9) Schabas,M.,"REVIEWOFMETROLINX'SBIGMOVE,"NeptisFoundation,TorontoON, Published-December2013,n.m.,Accessed­Jan142016,Web: http://www.neptis.org/sites/default/files/metrolinx_review_2013/neptis_schabas_repo rt_dec_2013_finaljuly23.pdf



41

      (10) Fisher,D.,"NextGenerationTransportationBusinessCases:SupportingtheOptimization ofTransportationInvestmentsintheGTHA,"Metrolinx,PresentedatTransportation Futures­RoadPricingandPlanningWorkshop,HiltonDoubletreeHotel,TorontoON, Nov242014  (11) "MeasuringPublicTransportAccessibilityLevels,"TransportforLondon,Published­ May2010,n.m.,Accessed­Jan142016,Web: http://data.london.gov.uk/dataset/public-transport-accessibilitylevels/resource/86bbffe1-8af1-49ba-ac9b-b3eacaf68137/proxy  (12) "Ongoingmeetingsanddiscussions,includingiterativedevelopmentdetails,between MetrolinxandArupCanadaaspartofservicescontract",Fall2013toDecember2015. InternalArupMeetingNotesandRecords.  (13) Lukka,R.andCamargo,F.,"WithinReachoutputsamplefromTransCAD,"ArupCanada, TorontoON,Oct142015.InternalArupDocument.  (14) Camargo,F.,"TechnicalNote:AccessibilityModelmethodology,"ArupCanada,Toronto ON,July172015.InternalArupDocument.  (15) "TransCADTransportationPlanningSoftware,"CaliperCorporation,NewtonMA,n.p., n.m.,Accessed­Jan142016,Web:http://www.caliper.com/tcovu.htm  (16) "TTCtorollout61newandimprovedbusroutesacrossthecitytoall-day-every-dayand overnightbus,streetcarservice",TorontoTransitCommission,Published-May242015, n.m.,Accessed­Jan142016,Web: https://www.ttc.ca/News/2015/May/5_24_015_NR_service_improvements.jsp  (17) "Improvingourservice,"MetrolinxGOTransit,n.p.,n.m.,Accessed-Jan242016,Web: http://www.metrolinx.com/en/regionalplanning/rer/rer_service.aspx  (18) "MeetingNotes­TransitNetworkBuilderKickoff,August2015,"Attendedby:Rishi Lukka&FelipeCamargoofArupCanada,andAnnaKramerofMetrolinx.TorontoON. InternalArupMeetingMinutes.  (19) Runey,L.,"RouteSystemCodinginTransCAD,"ITRE,RaleighNC,Published­Oct25 2005,n.m.,Accessed­Jan162006,Web: https://connect.ncdot.gov/projects/planning/TPB%20Model%20User%20Groups/ITRE% 20Route%20System%20Coding.pdf  (20) "OntarioRoadNetworkGISShapeFile,"OntarioMinistryofTransportation,Providedto ArupFall2014byMetrolinx   42

      (21) "TransCAD6.0isReleased,"CaliperCorporation,NewtonMA,Published­Aug142012, n.m.,Accessed­Jan162016,Web:http://www.caliper.com/press/pr20120814.htm  (22) Roth,M.,"HowGoogleandPortland'sTriMetSettheStandardforOpenTransitData," StreetsBlogSF,Published­Jan52015,n.m.,Accessed­Jan162016,Web: http://sf.streetsblog.org/2010/01/05/how-google-and-portlands-trimet-set-thestandard-for-open-transit-data/  (23) "GeneralTransitFeedSpecificationReference,"GoogleInc.,MountainViewCA,n.p., LastModified­Feb2015,Accessed­Jan162016,Web: https://developers.google.com/transit/gtfs/reference  (24) "TTCRoutesandSchedules,"CityofTorontoOpenDataCatalogue,Published­August 262015,LastModified­Jan112016,Accessed­Jan142016,Web: http://www1.toronto.ca/wps/portal/contentonly?vgnextoid=96f236899e02b210VgnVC M1000003dd60f89RCRD  (25) Lukka,R.,"SummaryofTTCAugust262015GTFSFileSet­basedonTTCOpenData (24),"ArupCanada,TorontoON,September2015  (26) Lukka,R.,"GTFSFileRelationshipdiagrambasedonGTFSReference(23),"ArupCanada, TorontoON,December2015  (27) "GOtransit.com­DeveloperResources,"GOTransit-adivisionofMetrolinx,n.p.,Last Modified­Jan82016,Accessed­Jan162016,Web: http://www.gotransit.com/publicroot/en/schedules/DeveloperResources.aspx  (28) "MiWayDeveloperDownload,"CityofMississaugaMiWay,n.p.,LastModified­Dec4 2015,Accessed­Jan162016,Web: http://www.mississauga.ca/portal/miway/developerdownload  (29) "OpenDataSetDetails,"CityofBrampton,n.p.,LastModified­Dec232015,Accessed ­Jan162016,Web:http://www.brampton.ca/EN/City-Hall/OpenGov/Open-DataCatalogue/Pages/Data-Set-Details.aspx?ItemID=1  (30) "Dataset:OakvilleTransitRouteandScheduleInformation,"TownofOakville,Published ­May12014,LastModified­Dec152015,Accessed­Jan162016,Web: http://www.oakville.ca/data/oakville-transit-route-information.html  (31) "OpenDataCatalogue,"CityofBurlington,n.p.,LastModified­Jan152016,Accessed­ Jan162016,Web:http://cob.burlington.opendata.arcgis.com 



43

      (32) "GoogleTransitFeedSpecification(GTFS),"YorkRegionTransitVIVA,n.p.,LastModified ­Jan122016,Accessed­Jan162016,Web: http://www.yorkregiontransit.com/en/aboutus/GTFS.asp  (33) "Open&AccessibleData,"CityofHamilton,n.p.,n.m.,Accessed-Jan162016,Web: https://www.hamilton.ca/city-initiatives/strategies-actions/open-accessible-data  (34) Lukka,R.&Camargo,F.,"AutomatedTransitNetworkBuilderSourceCode,"Arup Canada&Metrolinx,TorontoON,December2015  (35) Lukka,R.,"TransitNetworkBuilderGeneralAlgorithmFlowDiagram,"ArupCanada, TorontoON,December2015  (36) Lukka,R.,"TransitNetworkBuilderDialog,"ArupCanada,TorontoON,December2015  (37) Lukka,R.,"SampleoffinalTransCADWorkspaceenvironment,"ArupCanada,Toronto ON,December2015  (38) Camargo,F.,"NotesforpreparingGTFSfilesforTransCADimport,"ArupCanada, TorontoON,August2015  (39) Lukka,R.,"PersonalNotebookforArupprojectsincludingdevelopmentnotesforTNB," ArupCanada,TorontoON,UsedApril2015topresent.  (40) Lukka,R.,"QualityControlofTNBDevelopment­Sept10PlanningDate,"ArupCanada, TorontoON,December2015  (41) Lukka,R.,"SampleofIntermediateFileGenerationduringTNBExecutionforValidation," ArupCanada,TorontoON,December2015  (42) Lukka,R.,"FinalGTHANetworkValidation­Servicesateachintersection,"ArupCanada, TorontoON,December2015  (43) Lukka,R.,"FinalGTHANetworkValidation­Crossreferencingsystemmaps­ExcelQC Sample,"ArupCanada,TorontoON,December2015  (44) Lukka,R.,"MontrealTNBgeneratedTransCADNetwork,"ArupCanada,TorontoON, January2016



44

