SIMULATION MODELS OF CURRENT DENSITY IMAGING IN STUDYING CARDIAC STATES

by Mohammadali Beheshti B.Sc., Isfahan University of Technology, Isfahan, Iran, 2001 M.A.Sc., McMaster University, Hamilton, Ontario, Canada, 2004

A dissertation presented to Ryerson University

in partial fulfillment of the requirements for the degree of Doctor of Philosophy in the Program of Electrical & Computer Engineering

Toronto, Ontario, Canada, 2016 c Mohammadali Beheshti 2016

AUTHOR'S DECLARATION FOR ELECTRONIC SUBMISSION OF A DISSERTATION

I hereby declare that I am the sole author of this dissertation. This is a true copy of the dissertation, including any required final version, as accepted by examiners.

I authorize Ryerson University to lend this dissertation to other institutions or individuals for the purpose of scholarly research.

I further authorize Ryerson University to reproduce this dissertation by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

I understand that my dissertation may be made electronically available to the public.

ii

Abstract

Simulation Models Of Current Density Imaging In Studying Cardiac States

Doctor of Philosophy, 2016 Mohammadali Beheshti Electrical and Computer Engineering Ryerson University

Electro-mechanical disorders in cardiac function result in arrhythmias. Due to the non-stationary nature of these arrhythmias and, owing to lethality associated with certain type of arrhythmias, they are challenging to study. Most of the existing studies are limited in that they extract electrical activity from surface intracardiac electrical activity, either through the use of electrical or optical mapping. One way of studying current pathways inside and through biological tissues is by using Magnetic Resonance Imaging (MRI) based Low Frequency Current Density Imaging (LFCDI). For the first time CDI was used to study ex-vivo beating hearts in different cardiac states. It should be said that; this approach involves heavy logistical and procedural complexity, hence, it would be beneficial to adapt existing electrophysiological computer models to investigate and simiii

ulate current density maps specific to studying cardiac function. In achieving this, the proposed work presents an approach to model the current density maps in 3D and study the current distributions in different electrophysiological states of the heart. The structural and fiber orientation of the heart used in this study were extracted using MRI-based Diffusion Tensor Imaging. The monodomain and bidomain Aliev-Panfilov electrophysiological models were used for CDI modeling, and the results indicate that different states were distinguishable using range and correlation of simulated current density maps. The obtained results through modeling were corroborated with actual experimental CDI data from porcine hearts. Individually and comparatively, the experimental and simulation results for various states have the same trend in terms of variations (trend correlation coefficients  0.98) and state correlations (trend correlation coefficients  0.89). The results also show that the root mean square (RMS) error in average range ratios between bidomain CDI model results and real CDI data is 0.1972 and the RMS error in state correlations between bidomain CDI model results and real CDI data is 0.2833. These results indicate, as expected, the proposed bidomain model simulation of CDI corroborates well with experimental data and can serve as a valuable tool for studying lethal cardiac arrhythmias under different simulation conditions that are otherwise not possible or difficult in a real-world experimental setup.

iv

Acknowledgment
I would like to thank my supervisors Dr. Karthi Umapathy and Dr. Sri Krishnan for their valuable support and guidance without which this work would have been impossible. I would like to thank my colleagues in Biomedical Signal and Image Processing Lab, Farbod Foomany, and Karl Magtibay who contributed and cooperated in designing and implementing CDI imaging setup and conducting experiments. I would like to thank Mr. Jim Koch who provided technical support for the circuitry & wiring and cutting works and for his useful suggestions in the implementation of CDI imaging setup. I would like to thank Dr. Kumar Nanthakumar, Stephene Masse, Patrick Lai, Nima Zamiri and John Asta from the Hull Family Cardiac Fibrillation Management Lab at Toronto General Hospital who conducted the surgeries and provided their lab facility, expertise, and time without which we would not have been able to conduct the experiments. I would also like to thank Mr. Eugen Hlasny and Mr. Neil Spiller from Toronto General Hospital Medical Imaging Department who helped us conduct MRI imaging and data collection. Their technical comments and kind support contributed to this work. I would also like to acknowledge that the experimental procedure and design was a collective effort of the team members of the project from Spatio-Temporal Targeting and Amplification of Radiation Response Program (STTARR), Toronto General Hospital (TGH) and Ryerson University. Finally I also like to thank Canadian Institute of Health Research (CIHR) grant number 111253 for funding this research, Queen Elizabeth and Ontario Graduate Scholarships for supporting my graduate studies. Last but not least, my parents and siblings for all the kindness and support throughout all my years of studying.

v

Contents
Author's Declaration Abstract Acknowledgement List of Tables List of Figures 1 Introduction 1.1 Background . . . . . . . . . . . . . . . . . . . . . . . . . . 1.2 Motivation . . . . . . . . . . . . . . . . . . . . . . . . . . . 1.3 Objective . . . . . . . . . . . . . . . . . . . . . . . . . . . 1.4 Previous Works . . . . . . . . . . . . . . . . . . . . . . . . 1.4.1 Review of CDI work . . . . . . . . . . . . . . . . . 1.4.2 Review of Electrophysiological Ventricular Modeling 1.5 Proposed Approaches and Contributions . . . . . . . . . . . 1.6 Organization of Thesis . . . . . . . . . . . . . . . . . . . . Methodology: MRI Imaging 2.1 MRI Basics . . . . . . . . . . . . . 2.2 CDI protocol and its implementation 2.3 DTI . . . . . . . . . . . . . . . . . 2.4 Langendorf Setup . . . . . . . . . . 2.5 Image Processing Techniques . . . . ii iii v viii ix 1 1 6 6 7 7 9 14 16 20 20 27 32 34 34 45 45 47 49 50 51

. . . . . . . .

. . . . . . . .

. . . . . . . .

. . . . . . . .

. . . . . . . .

. . . . . . . .

. . . . . . . .

. . . . . . . .

. . . . . . . .

. . . . . . . .

. . . . . . . .

. . . . . . . .

2

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

3

Methodology: Electrophysiological Modeling 3.1 Electrophysiology at Cell Level . . . . . . . . . . . . . . . . . . . 3.2 Electrophysiological models at cell level . . . . . . . . . . . . . . . 3.2.1 Simplified two variable models . . . . . . . . . . . . . . . . 3.2.2 First generation biophysically detailed ventricular cell model 3.2.3 Second-generation biophysically detailed models . . . . . . vi

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

. . . . .

3.3 3.4

3.5

3.2.4 Reduced cardiac models . . . . . . . . . . . . . . . . . . . . . . . Electrophysiology at tissue level . . . . . . . . . . . . . . . . . . . . . . . Electrophysiological models at tissue level . . . . . . . . . . . . . . . . . . 3.4.1 Monodomain Models . . . . . . . . . . . . . . . . . . . . . . . . . 3.4.2 Bidomain Models . . . . . . . . . . . . . . . . . . . . . . . . . . . FEM . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3.5.1 Finite Element Method Steps . . . . . . . . . . . . . . . . . . . . . 3.5.2 Assembling Matrix Form of the FEM Problem . . . . . . . . . . . 3.5.3 FEM Formulation for coupled Elliptical and Parabolic Heart Model 3.5.4 Software Packages to Implement FEM for Cardiac Models . . . . .

. . . . . . . . . .

. . . . . . . . . .

. . . . . . . . . .

. . . . . . . . . .

51 52 52 53 53 56 56 63 66 66 71 71 71 74 79 83 83 84 85 89 89 91 96 98 104 106 106 117 124 131 133 135 138 140

4

CDI Modeling Using Real World Data 4.1 Database . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4.1.1 CDI Database . . . . . . . . . . . . . . . . . . . . . . . 4.1.2 DTI Database . . . . . . . . . . . . . . . . . . . . . . . 4.2 Mobile Langendorf . . . . . . . . . . . . . . . . . . . . . . . . 4.3 Improvements to CDI implementation . . . . . . . . . . . . . . 4.3.1 A reliability measure . . . . . . . . . . . . . . . . . . . 4.3.2 Quantifying current injection effect on noise level in CDI 4.3.3 Noise distribution in CDI images and their denoising . . 4.4 Constructing CDI Model . . . . . . . . . . . . . . . . . . . . . 4.4.1 Implementation of 2D Model in COMSOL . . . . . . . 4.4.2 Sensitivity analysis of model parameters in 2D . . . . . 4.4.3 3D Model in COMSOL . . . . . . . . . . . . . . . . . 4.5 Monodomain Simulation Scenarios . . . . . . . . . . . . . . . . 4.6 Bidomain Simulation Scenarios . . . . . . . . . . . . . . . . .

. . . . . . . . . . . . . .

. . . . . . . . . . . . . .

. . . . . . . . . . . . . .

. . . . . . . . . . . . . .

. . . . . . . . . . . . . .

. . . . . . . . . . . . . .

. . . . . . . . . . . . . .

. . . . . . . . . . . . . .

. . . . . . . . . . . . . .

. . . . . . . . . . . . . .

5

Results and Discussion 5.1 Monodomain CDI Model Results . . . . . . . . . . . . . . . . . . . . . . . . . . . 5.2 Analyzing and Comparing real CDI data and Monodomain Simulated Results . . . 5.3 Bidomain CDI Model Results . . . . . . . . . . . . . . . . . . . . . . . . . . . . Conclusions and Future Work

6

A Noise Distribution in Phase Wrapped Images B Reliability Metric Performance C Physical Units in CDI Model D List of CDI Experiments

vii

List of Tables
2.1 3.1 4.1 4.2 4.3 5.1 5.2 5.3 5.4 5.5 Derivative templates . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31 Two exact 3 point Gaussian Quadratures for 2D Second Order Polynomials [1] . . 64 MRI acquisition parameters for ex-vivo CDI experiments . . . . . . . . . . . . . . 74 Parameter sweep analysis for Aliev-Panfilov model . . . . . . . . . . . . . . . . . 93 Label reference for Simulation scenarios . . . . . . . . . . . . . . . . . . . . . . . 104 The average ratio of variations in normalized current density compared to AS state for both measured and monodomain simulation results . . . . . . . . . . . . . . . The average correlation values for measured current density results and monodomain simulation results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . The average ratio of variations in normalized current density compared to AS state for both measured and bidomain simulation results . . . . . . . . . . . . . . . . . The average correlation values for normalized measured current density results and bidomain CDI model simulation results . . . . . . . . . . . . . . . . . . . . . . . The root mean square difference of average correlation values and ratio of variations between bidomain simulation results and measured results from experiments . 121 121 129 129 130

B.1 Reliability Metric results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 136 D.1 List of CDI Experiments . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 141

viii

List of Figures
1.1 1.2 1.3 1.4 1.5 2.1 Electrical Conduction System of the Heart . . . . . . . . . . . Onset of VF condition as shown in ECG. The figure is taken Physionet database [2] . . . . . . . . . . . . . . . . . . . . . Block diagram of the model and data structure . . . . . . . . . Construction and expansion of CDI model . . . . . . . . . . . Organization of thesis. . . . . . . . . . . . . . . . . . . . . . . . . from . . . . . . . . . . . . . . . open . . . . . . . . . . . . . . . . access . . . . . . . . . . . . . . . . . 2

. 4 . 17 . 18 . 19

2.2 2.3 2.4 2.5 2.6 2.7 2.8 2.9 2.10 2.11 2.12 2.13 2.14 2.15 2.16 2.17 2.18 3.1 3.2 3.3 3.4 3.5

a) Magnetziation vector of a proton, b) Orientation of the magnetization vectors in the absence of external magnetic field, and c)Orientation of the magnetization vectors in the presence of MRI main magnetic field . . . . . . . . . . . . . . . . a) Rotating RF pulse and the receiver coil b)FID signal . . . . . . . . . . . . . . Frequency encoding across x axis . . . . . . . . . . . . . . . . . . . . . . . . . Phase Encoding across y axis . . . . . . . . . . . . . . . . . . . . . . . . . . . . Spin-Echo Sequence . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Filling K-Space matrix . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . CDI current pulses a) phase cycle 1, and b) phase cycle 2 . . . . . . . . . . . . . CDI single slice acquisition pulse sequence . . . . . . . . . . . . . . . . . . . . CDI multi slice acquisition pulse sequence (4 slices) . . . . . . . . . . . . . . . Measuring components of the induced magnetic field, a)Bz , b) By , and c)Bx . . . CDI Protocol Steps . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Phase wrapped and unwrapped images in a phantom . . . . . . . . . . . . . . . Magnitude, binary mask and current density image for the phantom in Figure 2.12 Absolute value colour coding scheme . . . . . . . . . . . . . . . . . . . . . . . DTI and Tractography for a pig heart . . . . . . . . . . . . . . . . . . . . . . . . Langendorf Setup block diagram . . . . . . . . . . . . . . . . . . . . . . . . . . Erosion of the calculated current density a) with out erosion b) After erosion . . . Image registration applied to binary masks a) Unregistered b) Registered . . . . . Cardiac Action Potential . . . . . Hodgkin-Huxley model [3] . . . . Representation of Bidomain Model FEM steps . . . . . . . . . . . . . Mesh Refinement . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

. . . . . . . . . . . . . . . . . . . . . . .

21 22 23 24 25 26 28 29 30 32 37 38 39 40 41 42 43 44 46 48 54 57 60

ix

3.6 3.7 3.8 3.9 4.1 4.2 4.3 4.4 4.5

Piecewise linear approximation of the solution . . . . . . . . . . . . . . . Mesh generation and refinement . . . . . . . . . . . . . . . . . . . . . . Initial Model output samples obtained by Matlab implementation of FEM COMSOL GUI . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

. . . .

. . . .

. . . .

. . . .

. . . .

61 67 69 70 72 73 75 76

4.6 4.7 4.8 4.9 4.10 4.11 4.12 4.13 4.14 4.15 4.16

4.17

4.18 4.19 4.20 4.21 4.22 4.23 4.24 5.1 5.2

a) Block diagram of GE circuit, and b) Picture of the GE circuit . . . . . . . . . . a) The cylindrical phantom, b) Magnitude image for one slice. . . . . . . . . . . . Sample recorded ECGs for VF and NS states. . . . . . . . . . . . . . . . . . . . . Timeline of ex-vivo experiment. . . . . . . . . . . . . . . . . . . . . . . . . . . . DTI reconstruction in Matlab and 3DSlicer. Colours red (up-down) ,green (leftright), and blue (perpendicular to the page) colours represent the three perpendicular directions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . DTI reconstruction in 3D Slicer and DTIStudio, the directional color coding is same as Figure 4.5 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Schematic of mobile Langendorf setup . . . . . . . . . . . . . . . . . . . . . . . . Acrylic Boxes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . a) The reservoir b) Cannulated heart c) Acrylic boxes d) Positioning the heart and boxes in MRI bore . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Box-plot of Normalized SSEs for different scenarios applied to Dataset 1. . . . . . Box-plot of Normalized SSEs for different scenarios applied to Dataset 2. . . . . . Box-plot of BM3D noise suppression for Dataset 1. . . . . . . . . . . . . . . . . . Box-plot of BM3D noise suppression for Dataset 2. . . . . . . . . . . . . . . . . . 2D Sample activation maps a)isotropic b)anisotropic . . . . . . . . . . . . . . . . Activation in a square isotropic domain excited by a sinusoidal source for two time instances . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Activation (blue) and Recovery (green) variables for a, b, and k Parameter sweeps as other parameters are kept constant in the scenario implemented in Figure 4.15. The probe is at point (0,0). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Activation (blue) and Recovery (green) variables for , µ1 , µ2 , diso Parameter sweeps as other parameters are kept constant in the scenario implemented in Figure 4.15. The probe is at point (0,0). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . An unexcitable obstacle in the way of propagation . . . . . . . . . . . . . . . . . . Reproduction of reentrant pattern in COMSOL, the color bar displays values of V . Diffusion Coefficients in a slice of pig heart extracted from DTI a through f represent D11 , D12 , D13 , D22 , D23 , and D33 respectively. The values are in mm2 /s . . . . The CAD geometry made out of DTI images . . . . . . . . . . . . . . . . . . . . Transparent view of the geometry in Figure 4.21 . . . . . . . . . . . . . . . . . . . Injected current pulse in CDI simulations . . . . . . . . . . . . . . . . . . . . . . Mesh refinement effect. The red areas are activated and blue areas are at rest . . . .

77 78 80 81 82 87 88 88 89 91 92

94

95 96 97 99 100 100 101 102

Progression of activation map (V ) in Scenarios C (isotropic, R) and H (Anisotropic, R) for HS1. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 108 Average diffusive current densities for Scenarios C and H in chosen slice of HS1. . 109 x

5.3 5.4 5.5

5.6

5.7

5.8 5.9

5.10

5.11

5.12

5.13

5.14

Box plot of Pearson correlations of Jdiffz and activation maps between scenarios A and F (AS with current injection, isotropic and anisotropic) for the middle slice. . . Box plot of Pearson correlations of Jdiffz and activation maps between scenarios D and I (Normal with no current injected, isotropic and anisotropic) for middle slice. . Box plot of Pearson correlations of Jdiffz and activation maps between scenarios E and J (Reentrant with no current injected, isotropic and anisotropic) for the middle slice. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Box plot of Pearson correlations of Jdiffz and activation maps between scenarios C and H (Reentrant with current injected, isotropic and anisotropic) for the middle slice. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . a) activation map (V ) in scenario B (isotropic, NS) at t=85 in chosen slice for HS1 b) activation map (V ) in scenario K (anisotropic, VF) at t = 85 in chosen slice for HS1. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . a) Jdiffz in scenario B (isotropic, NS) in chosen slice of HS1 b) Jdiffz in scenario K (anisotropic, VF) for the chosen slice of HS1. . . . . . . . . . . . . . . . . . . . . a) Comparing Pearson correlation of Jdiffx for various states in chosen slice of heart HS1 using monodomain model b) Comparing Pearson correlation of Jdiffy for various states in chosen slice of heart HS1 c) Comparing Pearson correlation of Jdiffz for various states in chosen slice of heart HS1. . . . . . . . . . . . . . . . a) Comparing Pearson correlation of Jdiffx for various states in chosen slice of heart HS2 using monodomain model b) Comparing Pearson correlation of Jdiffy for various states in chosen slice of heart HS2 c) Comparing Pearson correlation of Jdiffz for various states in chosen slice of heart HS2. . . . . . . . . . . . . . . . a) Comparing Pearson correlation of Jdiffx for various states in chosen slice of heart HS3 using monodomain model b) Comparing Pearson correlation of Jdiffy for various states in chosen slice of heart HS3 c) Comparing Pearson correlation of Jdiffz for various states in chosen slice of heart HS3. . . . . . . . . . . . . . . . a) Comparing histograms of averaged Jdiffz for various scenarios in chosen slice of heart HS1 using monodomain model a) Scenario J (R, no), b) Scenario I (NS, no), c) Scenario H (R, yes) d) Scenario F (AS, yes), e) Scenario G (N, yes), and f) Scenario K (VF, yes). The horizontal axis shows values of Jdiffz above 1. The  values represent the parameters of Poisson distributions fitted to the histograms . . a) Comparing histograms of averaged Jdiffz for various scenarios in chosen slice of heart HS2 using monodomain model a) Scenario J (R, no), b) Scenario I (NS, no), c) scenario H (R, yes) d) Scenario F (AS, yes), e) Scenario G (NS, yes), and f) Scenario K (VF, yes). The horizontal axis shows values of Jdiffz above 1. The  values represent the parameters of Poisson distributions fitted to the histograms . . Comparing histograms of averaged Jdiffz for various scenarios in chosen slice of heart HS3 using monodomain model a) Scenario J (R, no), b) Scenario I (NS, no), c) Scenario H (R, yes) d) Scenario F (AS, yes), e) Scenario G (NS, yes), and f) Scenario K (VF, yes). The horizontal axis shows values of Jdiffz above 1. The  values represent the parameters of Poisson distributions fitted to the histograms . . xi

110 111

111

112

112 113

114

115

116

118

119

120

5.15 Comparison of range of variations trend of experimental and monodomain simulation results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 122 5.16 Comparison of correlation trend of experimental and monodomain simulation results123 5.17 Jdiffz calculated by the monodomain model for NS condition . . . . . . . . . . . . 123 5.18 Measured current densities in A/m2 in a NS experiment for the same slice in Figure (5.17). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 124 5.19 Structural similarity maps for two comparable experimental datasets . . . . . . . . 125 5.20 a) Comparing Pearson correlation of averaged Jdiffx for various states in chosen slice of HS1 using bidomain model b) Comparing Pearson correlation of averaged Jdiffy for various states in chosen slice of HS1 c) Comparing Pearson correlation of average Jdiffz for various states in chosen slice of HS1. . . . . . . . . . . . . . . . 126 5.21 a) Comparing Pearson correlation of average Jdiffx for various states in chosen slice of HS2 using bidomain model b) Comparing Pearson correlation of average Jdiffy for various states in chosen slice of HS2 c) Comparing Pearson correlation of average Jdiffz for various states in chosen slice of HS2. . . . . . . . . . . . . . . . 126 5.22 a) Comparing Pearson correlation of average Jdiffx for various states in chosen slice of HS3 using bidomain model b) Comparing Pearson correlation of average Jdiffy for various states in chosen slice of HS3 c) Comparing Pearson correlation of average Jdiffz for various states in chosen slice of HS3. . . . . . . . . . . . . . . . 127 5.23 Comparing histograms of average Jdiffz for various scenarios in chosen slice of HS1 using bidomain model a) Scenario C (R, yes), b) Scenario B (NS, yes), c) Scenario A (AS, yes) d) Scenario K (VF, yes). The horizontal axis shows values of averaged Jdiffz above 0.1. The  values represent the parameters of Poisson distributions fitted to the histograms . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 127 5.24 Comparing histograms of average Jdiffz for various scenarios in chosen slice of HS2 using bidomain model a) Scenario C (R, yes), b) Scenario B (NS, yes), c) Scenario A (AS, yes) d) Scenario K (VF, yes). The horizontal axis shows values of average Jdiffz above 0.1. The  values represent the parameters of Poisson distributions fitted to the histograms . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 128 5.25 Comparing histograms of Jdiffz for various scenarios in chosen slice of HS3 using bidomain model a) Scenario C (R, yes), b) Scenario B (NS, yes), c) Scenario A (AS, yes) d) Scenario K (VF, yes). The horizontal axis shows values of average Jdiffz above 0.1. The  values represent the parameters of Poisson distributions fitted to the histograms . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 128 5.26 Comparison of correlation trend of experimental and bidomain simulation results . 130 5.27 Comparison trend of range of variations ratio (to AS state) for experimental and bidomain simulation results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 130 B.1 Reliability maps for phantom experiment . . . . . . . . . . . . . . . . . . . . . . 136 B.2 Rotation mismatch and image registration for heart experiment . . . . . . . . . . . 137

xii

Chapter 1 Introduction

I

N this chapter, the electrical conduction system of the heart and arrhythmia along with its various types are described. Current statistics on the prevalence of arrhythmia are presented and

objectives & motivations behind this dissertation are explained. This is followed by a comprehensive review of previous relevant works as well as the proposed approaches of this dissertation. The organization of the contents of this thesis is provided at the end of the chapter.

1.1

Background

While all cells in the myocardium are electrically excitable, only a portion of them can initiate electrical activity inside the heart. This group of cells, called pacemaker cells, are part of the cardiac conduction system, which also includes the Atrio-Ventricular Node (AV Node); the bundle of his, left, and right bundles; and finally Purkinje Fibre. Under normal conditions, electrical excitation starts at the Sino-Atrial Node (SA Node) positioned on top of the atria (Figure 1.1) and propagates in an orderly fashion through the electrical conduction system to the Purkinje fibres, allowing the heart chambers to contract rhythmically and pump blood throughout the body. As electrical activity propagates through the conduction system, adjacent myocardium cells become excited, propagating the excitation to adjacent cells through cell gap junctions. This results in continuous propagation of electrical activity in the myocardium. Once electrical activity reaches the myocardium, the cells release Calcium, causing the the muscle to contract. Any problem in the initiation and propagation of electrical activity may result in abnormal rate 1

SA Node
A-V Node

Bundles

Bundle of His

Purkinje

Figure 1.1: Electrical Conduction System of the Heart and/or rhythm of the heartbeat, resulting in arrhythmia. In their initial stages, arrhythmia may not cause noticeable harm; in many instances, they are not even detectable. However, when they become more advanced, arrhythmias can interrupt normal daily activity, even leading to the hospitalization or death of the patient. Based on the Heart Disease and Stroke Statistics 2014 update released by the American Heart Association, the rate of death from cardiovascular disease in the U.S. alone is 235.5 per 100000 patients, or roughly 1 death every 40 seconds [4]. Correspondingly, cardiovascular disease is responsible for 1 out of every 3 deaths in the U.S. [4]. The report estimates that between 2 and 6 million people in the U.S. experience arrhythmia in the atria, or 2

Atrial Fibrillation (AF), a condition that increases the likelihood of stroke by a factor of five. The most dangerous type of arrhythmia, Ventricular Fibrillation (VF), originates from ventricles, and is responsible for more than 400,000 cases of cardiac arrests per year in the U.S. [4]. If not treated immediately, VF can be fatal. Survival rates after VF-associated cardiac arrest reported in hospitals is around 10 per cent; it is more than 30 per cent in out-of-hospital incidents [4]. Arrhythmias are categorized either based on the location of their incidence or the effect they have on heart rate. For instance, an arrhythmia that happens in a ventricle is called Ventricular Arrhythmia; an arrhythmia that occurs above a ventricle is known as Supraventricular. Examples of arrhythmia that are categorized by effect on the rate of heart beat include Barrycardia, or a heartbeat of fewer than 60 beats per minute,and Tachycardia, or a rate above 100 [5]. In Ventricular Tachycardia (VT), the ventricle beats at a higher-than-normal rate. If VT condition persists for many hours, it can lead to life-threatening VF condition. Other types of arrhythmias include SinoAtrial Dysfunction, in which conduction from the SA node to the bundles is blocked; and Atrial Fibrillation, a type of Supraventricular Arrhythmia wherethe atria shivers instead of beating. While some arrhythmias are the result of secondary causes, such as thyroid performance or stress, and will go away if the cause is addressed, others will become progressively worse if not dealt with, leading to permanent damage in the heart. Treatment applied to arrhythmia varies depending on the cause and type of arrhythmia. In general, pacemakers are used to sustain normal electrical activity, while pharmacological agents can be used to modulate ion channel function that can control electrical activity. In the specific case of out-of-the hospital VF, defibrillation by electric shock is often administered, though it may not always be successful in restoring normal rhythm. In patients with a diagnosed risk of cardiac arrest, Implantable Cardioverter Defibrillators (ICD) are used to deliver appropriate pacing maneuvers, or shocks, to restore normal rhythm. From the literature, we know that arrhythmias are influenced by changes in the static structure of the fibres (scar tissues) or cell gap junctions and/or changes in dynamic cell electrical performance of ion channels [6, 7]. These arrhythmias are generally detected through abnormalities reflected in a patient's Electrocardiograms (ECGs). In the case of VF, for example, there are premature ventricular activations with ever-changing frequency and amplitude, which is reflective of

3

chaotic electrical activity in the heart. Figure 1.2 shows the onset of VF condition after a normal heartbeat as recorded in ECG. As ventricles play a major role in pumping blood to the body, it fol-

Figure 1.2: Onset of VF condition as shown in ECG. The figure is taken from open access Physionet database [2] lows that any abnormality in the ventricular electrical activity can cause life-threatening conditions to develop. One way of measuring the local electrical activity of a ventricles is to insert a mesh of electrodes into it. The mesh inflates in the ventricle and is able to measure electrical activity on its internal surface, or the Endocardium. This enables physicians to obtain more information than relying on an ECG alone. Another method is an ex-vivo heart experiment, where the heart beats outside of the body on a Langendorf setup [8], which supplies nutrition to cardiac cells. In these experiments, the external surface of ventricles, or Epicardium, is also accessible. This allows a mesh of electrodes to be attached externally, and more information can be obtained on local electrical activity. Other ex-vivo methods of measuring local electrical activity on the surface of the heart include Optical Mapping, in which a kind of dye is injected into the heart's tissue, which is sensitive to the voltage changes. These local electrical mapping methods only enable us to obtain data from the surface of the heart, However, and there is no knowledge of the electrical activity inside the tissue during different cardiac states. There are limited works using needle electrodes [9], 4

though there limitations to this method: the insertion of needle electrodes in the tissue will cause tissue fibres to detach, and this method only provides the disturbed electrical activity of one point per electrode. Due to this lack of volumetric data on cardiac electrical activity during various arrhythmias, physicians have suggested various hypotheses for their initiation and maintenance, all of which have come from observed data from the surface the surface of the heart. To broaden the pool of knowledge on arrhythmia and arrhythmogenesis, electrophysiological mathematical models [10] were developed for the heart based on Hodgkin-Huxley's model for nerve cells [11]. These models, which are concerned with the generation of action potential in cardiac cells and their propagation through the tissue, enable us to study various hypotheses put forth by physicians. They have therefore been applied in studying various types of arrhythmia [10], and the literature shows that they are able to replicate and explain various electrophysiological phenomena in the heart. Simulated results have been further validated by experimental data, such as in their application in studying arrhythmogenesis in VF. In this application, electrical mapping of the heart was used on a heart in VF condition. Physicians observed that rotor activation patterns formed on the surface of ventricles move spatially over time [12], quickly activating and deactivating regions that normally would not be activated. Researchers came up with two hypotheses to explain this phenomenon. The first stated that these rotors are generated as a result of the SA Node not generating the initial excitation; this led other parts of the electrical conduction system to initiate the excitation in a chaotic way, leading to multiple sources of excitation instead of one initial source. Supporters of this hypothesis suggested burning those focal points in order to prevent the formation of rotors [12, 13]. The second hypothesis postulated that, if an excitation wave-front faces an obstacle (such as scar tissue), rotors will be generated, and this interaction may look like focal points or centres of rotors from the surface [12, 13]. Researchers were able to provide some evidence in support of this second hypothesis using electrophysiological models [14]; however, as mentioned before, there is no way to experimentally study the electrical activity inside the tissue in a 3D volume, and the simulation results obtained by the models inside the tissue could not be validated. Further, these models enabled a simulation of states and conditions that may be impossible to implement due to their lethality, risk of causing permanent damage to the heart, or for scenarios

5

which experiments are hard to conduct due to implementation.

1.2

Motivation

As discussed in previous section, there is ongoing debate on the genesis of patterns observed from the surface of the heart in electrical mapping of arrhythmias. Specifically, there are various hypotheses for their genesis in VF state. However, the existing measurement techniques are limited in terms of their ability to produce real data for the electrical activity inside the tissue. Finding a method that is able to indirectly measure the effect of various heart states on electrical activity of the heart inside the cardiac tissue will be a positive towards gaining more knowledge on the arrhythmia and arrhythmogenesis. Currently, the direct measurement of the electrical activity is impossible, as it is not strong enough to be picked up by MRI machine. Electrophysiological models are able to theoretically explain many electrophysiological phenomena at cell and tissue level, and are therefore applied as a method to weigh in on various hypotheses and testing scenarios, which are otherwise difficult or impossible to implement experimentally. Applying these models to the experimental MRI-based CDI method provides us a powerful tool to reproduce experimental results obtained by CDI from the inside of cardiac tissue in 3D, and helps us to avoid complexity of performing experiments that are impractical in real-world scenarios. Further, they not only help us to avoid the complexities associated with experiments, but also allow us to implement scenarios that are otherwise impossible to be study experimentally.

1.3

Objective

This dissertation aims to introduce an experimental way to investigate changes in the electrical activity of the heart specific to cardiac arrhythmias in a 3D volume for various conditions using Magnetic Resonance Imaging (MRI). It then integrates the knowledge from the experiments to develop a model based on existing electrophysiological models to simulate electrical activity inside the heart in 3D during different cardiac states that are otherwise difficult, impractical, or too expensive to implement experimentally. The simulated results are then corroborated with experimental

6

findings through comparative analysis. The hypothesis we investigate in this dissertation is that the Current Density Imaging is able to reflect changes in the volumetric electrical activity for various cardiac states. This is investigated using both experimental and theoretical data obtained from the models.

1.4

Previous Works

In this section, previous work carried out in the experimental CDI and theoretical electrophysiological ventricular modeling fields are reviewed.

1.4.1

Review of CDI work

Low-frequency CDI (LFCDI) is an MRI-based method that was developed by Joy et al. in the early 1990s [15, 16]. Later on, another type of CDI was introduced, which was called Radio Frequency CDI (RFCDI). In RFCDI [17], a radio frequency current density component in the direction of the main magnetic field can be measured. In order to obtain all three components of the current density, the subject must be positioned in three perpendicular positions and take three measurements for each slice. Though LFCDI similarly requires that the subject be positioned in three perpendicular orientations, the subject should be rotated 90 degrees around the axis of measurement; thus, three additional rotations and measurements are needed. In this sense, implementing LFCDI is more complicated and more sensitive to the rotations. Originally, the RFCDI method was developed for homogeneous materials and single slice imaging. Later on, however, it was expanded to non-homogeneous materials, making multi-slice imaging possible for this method [18]. One limitation in RFCDI is that the frequency of the injected current should be at Larmor frequency of the imager, or 42 MHz per Tesla. Other limitations include that RFCDI assumes the magnetic field generated by the transmitter coil is homogeneous,
i and that for the measurement direction i (which can be x, y or z ) it is assumed that | H | i

Ji ,

where H is magnetic field strength and J is current density. These assumptions are neither realistic nor necessary for LFCDI. Thus, LFCDI is much more widely used in ex-vivo and in-vivo cases, and is correspondingly the more established method when compared with RFCDI [18]. Due to 7

these limitations, we will use the LFCDI method, and for simplicity, we will henceforth referred to LFCDI as CDI. After its initial development in the early 1990s, CDI was widely applied to phantoms, exvivo, and in-vivo tissues for non-dynamic studies. In the initial work, Joy et al. showed CDI measurements on a concentric cylindrical phantom filled with saline for 20 mA current pulses for a duration of 30 ms as well as on a human forearm for 2 mA current pulses for a duration of 40 ms [15]. Later on, Scott et al. compared the theoretically calculated current density in a cylindrical phantom and compared it with experimental results obtained from CDI imaging [16]. Their work showed that the total current measurements were within 5 per cent of the theoretically calculated value, concluding that the method is sufficiently accurate [16]. The CDI method was further verified by Pesikan et al., who applied it to measuring current density in a printed circuit board [19]. Still more research proposed the application of CDI in monitoring temperature inside of a tissue: Khang et al. postulated this based on the knowledge that tissue conductivity is temperature dependent [20]. Sersa et al. studied current density patterns generated in a cancerous tumor in a mouse, demonstrating that the current tends to pass from the surface. However, they showed that the electrode type and positioning pattern affects current density patterns in a tumor. The researchers concluded that CDI can be used for monitoring electrochemotherapy in cancerous tumors [21]. Considerable research has also been dedicated to studying current pathways in animals. For example, Gamba and Delpy applied CDI to study current pathways in a piglet head by positioning electrodes on the skull and in the mouth. Their work showed that, in the post-mortem piglet, the current reaching the brain is reduced 62 per cent; comparatively, which matches with the literature [22]. Joy et al. also studied the current pathways, though their work looked at a rabbit brain with various electrodes positionings on forehead and behind the ear [23]. CDI was applied CDI to a post mortem pig torso for the first time by Yoon et al., who studied current pathways generated by defibrillator electrodes attached to the torso, demonstrating that current densities were higher in the chest wall [24]. Later, Demonte et al. compared the current pathways generated by defibrillator electrodes in a live and post-mortem piglet torso [25], showing that, although there only small

8

differences in current pathways at the micro scale, there are considerable differences in pathways at the micro scale, particularly in the heart region. Unfortunately, these works do not have good resolution as the experiments were conducted on the torso [25]. Patriciu et al. studied the skin burn patterns under the gel-type surface electrodes, which are widely used for monitoring, stimulation of nerves or defibrillation, positioned on the body surface of a pig using CDI. Their research showed that regions with higher current densities correlate to regions burned, leading the researchers to conclude that burns are associated with an electrochemical mechanism instead of temperature [26].

1.4.2

Review of Electrophysiological Ventricular Modeling

Electrophysiological models have a common ancestor, which is Hodgkin-Huxley's model for squid nerve cells' electrical activity [11]. In this model, three ion channels with membrane-voltagedependent conductivities are considered: Sodium, Potassium, and Chloride. Hodgkin and Huxley modeled conductivity profiles through some experiments, and their model is able to simulate the generation of an action potential in a nerve cell. Many models have since been developed for cardiac applications, each combining cell models with tissue models that represent the structure of the cardiac muscle fibres and explain the action potential propagation through diffusion differential equations [9, 10]. The complexity of these models depend on how detailed they are in terms of representing ion channels. It should be noted that they do not take mechanical processes involved in the cardiac electrical activity into account for the sake of simplicity, though we know that the electrical and mechanical activity are coupled through the release of calcium. This assumption may be even closer to the reality in cases where the heart does not beat vigorously, such as in VF condition. In this section, some applications of the electrophysiological models in ventricles are reviewed [10]. From the literature, two methods for representing the ventricle tissue structure in the models can be identified. The first is based on histology. Two such examples of histologically extracted heart structures commonly used in the literature include the UCSD Rabbit [27] and Auckland Swine [28]. The second method used to obtain the heart structure is MRI-based DTI images, including such examples from the literature as the Oxford Rabbit, JHU Canine, and JHU Human

9

structures [29]. Trayanova has categorized the application of models in cardiac electrophysiology into the following six branches [10]: 1-Models of Ventricular Propagation: These models study the propagation of an action potential in a normal heart. They study normal propagation in scenarios that are otherwise not possible to demonstrate experimentally, such as the effect of structure, size, blood vessels, and trabeculations in normal propagation. One such model is Bishop et al.'s work in which an MRI-obtained structure of a rabbit heart is used to study the effect of inclusion of structural details on the normal propagation [30]. The structure constructed in their model had very high resolution, to the scale of a micron. They compared this detailed model with a simplified model that ignored the vessels and trabeculations, showing that the introduction of such structural complexity affected the propagation patterns in micro scale, particularly in the presence of external electrical stimulation. Bishop et al. further showed that blood vessels can act like shortcut paths [30], and recommended the use of very detailed structures wherever possible. A detailed heart structure was also studied in humans by Simelius et al., who included details of the conduction system to model the propagation of an action potential in 3D [31]. Lorange et al. studied the effect of a partial and full conduction block on the propagation of action potential in the human heart structure and simulated Electrocardiogram (ECG), Vectorocardiogram (VCG), and Body Surface Potential Maps (BSPM) [32]. Later, Sampson et al. studied the effect of electrotonic potential (local non-propagating potential) on action potential dispersion and its connection with heart size by comparing 3D Luo-Rudy models in rabbit and mouse. They found that the effect will be more prominent in larger hearts [33]. 2-Models of Ventricular Arrhythmia Mechanisms: These models focus on studying the propagation patterns of reentrant waves in 3D. They have been beneficial in understanding arrhythmogenesis, particularly in that they provide information on the aspects of reentrant arrhythmia that cannot be obtained through experiments. In 1995, Panfilov and Keener used the Fitzhugh Nagumo model [34, 35] in a canine heart to show that the centre of a reentrant wave may reside inside the myocardium and the surface view of these reentrant waves may be mistakenly interpreted as point sources while these focal points on the surface are generated due to the collision of reentrant wavefronts [36]. Panfilov and Hogeweg showed that a breakup in scroll waves generated by Fitzhugh

10

Nagumo model will happen if the relative refractory period of the excitable tissue is shortened in the model [37]. Panfilov later showed in 1998 that this spiral wave breakup phenomenon can be used to model chaotic patterns observed in VF [38]. Xie et al. studied the causes of wave break in VF [39]. In the literature, there is a debate on whether the static anisotropy of the tissue causes the break up to appear or the dynamic instability of the ion channels is contributing to the phenomenon. In their model, Xie et al. have showed that if the ion channels are stable, even in the presence of non-uniform tissue structure, no break up will occur; thus they concluded that the instability of the ion channel is the main contributor to wave breakups that cause chaotic activation patterns in the VF condition [39]. Modeling a canine heart using Luo-Rudy cardiac cell model Xie et al. showed that reentrant waves were generated by increasing maximum conductance of slow Calcium ion channels. They also demonstrated further increasing conductivity will cause a break up to occur. Thus, this conductivity controls the Calcium channel current amplitude, nd by increasing conductivity of the slow inward Calcium channel, the total amplitude of the current in Calcium ion channels is reduced. In both experiments and simulations, this is shown to increase the slope of the Action Potential Duration (APD) restitution curve (which plots APD on y axis versus Diastolic interval on x axis) [39]. Vadakumpadan et al. explained how to represent the heart structure in detail by segmenting infarct, boundary, and normal zones and considering the blood vessel structure [40]. Later, Clayton studied the effects of initial condition, kinetic changes, and geometry on the number and propagation of vortex filaments (centre of reentrant waves) in reentrant waves and concluded that all the aforementioned parameters affect the number, direction and propagation of vortex filaments [41]. Using optical mapping, Samie et al. showed that there is a difference in dominant activation frequencies in left and right ventricles during VF and suggested that it is due to the difference in background current (Ik1 ). This conclusion has since been verified in their work using a 2D model [42]. Baher et al. modified a Luo-Rudy phase I model to include a generic memory current component in order to explain the effect of pacing memory on APD as seen in reality. This has been helpful in explaining how pacing can contribute to the generation of a mother rotor and initiate VF [43]. Tusscher et al. have shown in their model that the reason that number of rotors observed during VF in human is much less than dog and pig

11

hearts (which are almost of the same size of human heart) due to the difference in the dynamic of APD in various species [44]. In their work, Tuscher human cell model [45] was used. Garfinkel et al. suggested the use of bretylium to flatten APD restitution curves in order to reduce risk of VF, as their model suggests higher slopes contribute to more chaotic activation patterns in VF [46]. Blocking L-type Ca2+ ion channels can contribute to changing chaotic VF patterns to more oraganized rotors as seen in VT, which was demonstrated by Bernus et al. Their work carried out modeling on 2D isotropic tissue and 3D anisotropic tissue of the human heart [47], using Bernus et al. model of human heart for their simulation [48]. Alternans (beat-to-beat variations in APD) are known to contribute to VF initiation and it is known that spatially non-synchronous alternans can cause uni-directional conduction blocks, which in turn initiates reentrant waves and can lead to VF condition [49]. Echebarria et al. studied the alternans and their effects on VF initiation in the rabbit heart model using a three ion channel model [49, 50]. In another work, Cherry and Fenton studied effect of memory and electrotonic current on the alternans in the presence of steep APD restitution, where they demonstrated that memory and electrotonic effects can stabilize reentrant waves even in the presence of steep APD restitution [51]. The effect of APD restitution heterogeneity in various parts of tissue has also been studied (Kalderman et al.) [52]. They have shown that more heterogeneity contributes to more fillaments (centre of rotors) [52]. Kalderman et al. showed that both mother rotors (sources) and wavelets (collision of waves fronts) can be present in VF condition in human [53]. This may explain why ablation of the mother rotor is reported to terminate VF using the Tusscher-Noble-Noble-Panfilov (TNNP) model [53]. 3-Models of Arrhythmia in Diseased Heart: These models are associated with modeling electrophysiology and structure of ischemia and Infarct regions. Jie et al. have implemented a Luo-Rudy model on the UCSD rabbit heart structure to study the effect of acute regional ischemia on the emergence of reentrant patterns. Their work showed that as the level of hyperkalemia (i.e. elevation in potassium ion concentration in extracellular domain) increases the chance of reentrant waves initiation. The researchers have also investigated the effect of the Boundary Zone (BZ) width on appearance of reentrant waves, concluding a wider BZ reduces the likelihood of reentrant waves [54]. Other relevant works include Arevalo et al., who modeled infarction in a scarred

12

canine heart structure obtained in details through DTI and segmented using image processing. Their model which is based on the Luo-Rudy model [55], demonstrated that in the BZ, APDs get longer and conduction velocity decreases [55]. 4-Ventricular Models of Arrhythmia Initiation with electrical shocks and defibrillation: These models are associated with studying the effects of defibrillation shocks in initiating or terminating arrhythmia. They are inherently more complex because both extracellular and intracellular domains should be defined for the tissue (i.e. bidomain). Rodriguez and Trayanova investigated the unidirectional block formation due to an external shock and its connection with the Upper Level of Vulnerability (ULV) and Lower Level of Vulnerability (LLV) [56]. Using a modified BeelerReuter model [57] in a rabbit ventricle, the researchers showed that the strength of the shock in the vulnerability range causes a unidirectional block, which in itself generates reentrant waves [56]. In other works, Rodriguez et al. used the modified Beeler-Reuter model on rabbit ventricles to study the effect of shock direction on Vulnerability Area (VA), demonstrating that reversing the direction affects the VA [58, 59]. Later, Ashihara et al. studied monophasic and biphasic shocks in a rabbit ventricle using a Luo-Rudy model modified for defibrillation studies [60]. Their conclusion was that the difference between the outcome of these two shocks is due to the different intramural excitable regions. They also put forward the hypothesis of tunnel intramural propagation that contributes to the induction of VF due to the shock [61]. 5-Ventricular Models containing Purkinje fibre: These models study the role of the conduction system, specifically, they explore the Purkinje fibre and his branch in arrhythmia and arrhythmogenesis. Berenfeld and Jalife explained the focal points observed in the endocardium during VT using the Fitzhugh-Nagumo model in a piece of ventricle tissue. Their work suggested that the Purkinje-Ventricle connection can contribute to reentry in VT [62]. The effect of an external electric field on the generation of sawtooth effect in cardiac cells in the Purkinje was modeled by Vigmond et al. [63], using the San Diego rabbit heart structure and Difrancesco-Noble Purkinje model [64]. Purkinje plays a role in reentry induction after shocks, as shown by Deo et al. who modeled the effect of purkinje on reentry induced by the shock, using the rabbit heart structure and Mahajan model [65]. Finally, Boyle et al. showed that the level of coupling between Purkinje fibre

13

and myocites determines the type of reentry, using a rabbit heart [66]. 6-Whole Heart Models of Fluorescent Recording in the Heart: In these models, electrophysical models are combined with photon-scattering models in order to find a way to correct photon scattering in optical mapping experimental results [67, 68]. There has been some works in the literature that have modeled mechanical aspects associated with electrical activity of the heart [54,69,70], which are beyond the scope of this dissertation. The future of cardiac modeling is bright and much research is being conducted to obtain more detailed models from cell to the patient body and combining mechanical and electrical aspects. There is also a focus on the development of patient-specific models and drug development [10]. Because of the widespread application of electrophysiological cardiac models and their benefits in providing more degrees of freedom for studying various scenarios in arrhythmias, they have been chosen in this dissertation as the theoretical method to corroborate the experimental CDI data that in itself, provides a glimpse into the changes in the volumetric current pathways in different cardiac states. In order to obtain more realistic, case-specific models, the DTI method is applied to each case of study providing the fibre structure and local conductivity of the studied heart.

1.5

Proposed Approaches and Contributions

The approaches proposed by this dissertation can be divided into two branches: experimental and theoretical approaches. In the experimental approach the application of MRI-based CDI is proposed to study intramuscular electrical activity in the heart. CDI is an imaging method developed in early 1990s [19] that enables us to measure current density vectors in a subject of study in 3D. This current density is generated by an external current source injected through two electrodes. The method has since been applied to phantoms and in-vivo experiments for various applications. This method is proposed based on the fact that the measured current density in an ex-vivo beating heart reflects the modulation of the current density generated by the externally injected current and the electrical activity of the heart. Thus, it has the potential to reflect the effect of changes in the electrical activity in various heart states and can be applied for the dynamic study of such changes. This is in contrast with existing applications of CDI studying non-dynamic changes in current 14

pathways. As the proposed work implements CDI on an ex-vivo heart for the first time, multidisciplinary expertise was required, including such domains as cardiac electrophysiology, surgery, chemistry, MRI imaging, and various Engineering fields, including numerical methods and image and signal processing. This expertise was made available to us through a collaboration with various experts and facilities at Toronto General Hospital (TGH). To implement CDI imaging, the injected currents should be generated by a pulse generator synchronized with an MRI sequence as per CDI protocol [16]. Further, we required access to beating ex-vivo hearts in the MRI machine. Therefore, access to animal hearts in a medical facility was needed, so that the hearts may be extracted through surgery and kept alive in a Langendorf setup. There are only few cardiac research centres which are equipped with Langendorf setup and have the expertise to perform ex-vivo beating heart experiments and also have an MRI facility nearby. All these were made accessible for us through collaboration with TGH. Considering that traditional Langendorf setups are fixed and not designed for the MRI room, a mobile Langendorf setup that is MRI compatible had to be developed as part of the study to carry the ex-vivo beating heart from one wing of the hospital to the MRI room. In order to obtain static structural data from the hearts, MRI-based Diffusion Tensor Imaging (DTI) was proposed [71]. DTI enables us to obtain the direction of the fibres in the heart, and provides data that can also be used to generate the geometry and structural data needed in electrophysiological models. In the theoretical approach, two particular areas were required. First, a model had to be developed based on the relatively new and simplified Aliev-Panfilov electrophysiological model on the heart structures. Second, we proposed calculating the current density maps theoretically using an averaged diffusive current density term in the model. This averaged diffusive current density is reflective of the current density maps because CDI measures time-averaged current density over acquisition time and in the macro scale. It should be noted that the CDI method is not able to measure current densities at the cell level. Electrophysiological heart models are defined based on a set of differential equations that mimic the physical diffusion of activation in the heart. These differential equations do not have a closed-form solution; therefore, Finite Element Method (FEM) should be used to solve them [3]. For this purpose, COMSOL Multiphysics software was used to

15

implement and solve the model [72]. Initially, for the implementation of the model, a simple, 2D isotropic CDI model from the literature was used to generate patterns associated with various heart condition. The model was subsequently upgraded to a 3D model with real heart structures represented by anisotropic diffusion tensors obtained from DTI. Four different heart conditions of Asystole (A), Reentrant (R), VF, and Normal Sinus (NS) were implemented in the anisotropic 3D model, which are relevant for studying cardiac abnormal electrical function. In the next stage, the experimental CDI data were compared with the simulation results to corroborate the model results. Next the Bidomain representation of the tissue was added, in order to obtain a more detailed and realistic model. A block diagram of the proposed approaches for modeling in this dissertation are shown in figures 1.3 and 1.4, respectively. In achieving this dissertation's objective, the main contributions of this work can be summarized as: · Novel implementation of CDI imaging on ex-vivo beating hearts, the development of a CDI model in different cardiac states using experimental data · Development of a customized mobile Langendorf setup that enables the opportunity to perform CDI imaging inside MRI · Correlation of structural data obtained by DTI imaging and dynamic CDI data for the first time [73, 74] · Improved post processing of the CDI imaging [75­77], and · Validation of the model results with data from CDI experiments and conclusion that CDI method demonstrates potential for studying electrical activity in different cardiac states.

1.6

Organization of Thesis

Chapter one explained the background and motivation of this dissertation and subsequently presented the objectives. It then reviewed state-of-the-art for CDI method and electrophysiological 16

Excitation

DTI Data providing fiber direction and diffusion coeff

CDI Data

Combine, compare and validate

Cell Model parameters and functions

FEM Model

Simulation time step and mesh spacing Boundary Conditions

Figure 1.3: Block diagram of the model and data structure modeling. Finally, it described the proposed approaches outlined in this dissertation and contributions to current research. The last section reviewed the organization of this thesis. Chapter two introduces the basics of MRI and CDI and DTI protocols. It explains the operation and components of a Langendorf setup. In the last subsection, some image processing techniques applicable to this research are presented. Chapter three describes the electrophysiology of cardiac cell and tissue and their categorization and mathematical representation. Finally, it presents the Finite Element Method as the desirable numerical method for solving the cardiac electrophysiological models by briefly explaining the stages involved in the implementation of this numerical method. 17

Make 2D isotropic CDI model work

Consider Anisotropy using DTI

Upgrade to 3D model

Model NS/R/VF/AS

Potentially expand the model to include detailed ion channels

Upgrade CDI model to bidomain

Use experimental CDI results to validate the model

Figure 1.4: Construction and expansion of CDI model Chapter four explains the process of data collection from pig experiments, the customization of the Langendorf setup to carry the ex-vivo beating heart from VF lab to the MRI facility, and making the setup MRI compatible. It presents some improvements in post-processing techniques for the CDI method, which help us quantify and counter noise and distortion more efficiently. The initial implementation process of the cardiac electrophysiological models and choosing and defining their parameters, the CDI model construction process, and the simulated scenarios are explained in this chapter. Chapter five then presents and analyzes the simulation results obtained from monodomain and bidomain CDI models, quantitatively comparing the simulation results with the experimental current densities measured from pig experiments using CDI. Chapter six concludes the dissertation and suggest the future expansion of the developed CDI model. The chart in Figure ?? summarizes the organization of this dissertation. The blue boxes are related to the background and existing research work while the green boxes contain the new contributions made by this work. The lowercase bold symbols are used for vectors, lowercase non-bold symbols are used for the scalars, and capitals represent matrices except for commonly used physics symbols, such as B (magnetic field vector), H (Magnetic intensity vector), I (current), C (capacitance), V (voltage), 18

Modeling & Application of Current Density Imaging in Studying Electrophysiological State of the Heart

- Background

-MRI Basics
-Implementation of CDI -DTI -Langendorf -Electrophysiological models at tissue level -FEM models at cell level -Electrophysiological at cell level

-Electrophysiology

- Objective - Motivation - Proposed

 (accumulated phase), Sv (surface to volume ratio), and M (magnetization vector).

19
Approach Setup
-Image Processing Techniques - Previous Works - Organization of

-Database -Mobile Langendorf -Improvements to CDI implementation -Constructing CDI Model -Monodomain and Bidomain Simulations

-Monodomain CDI Model Results -Analyse and compare monodomain results with experimental CDI data -Analyse and compare bidomain results with experimental CDI data

Conclusion & Future Work

Figure 1.5: Organization of thesis.

Chapter 2 Methodology: MRI Imaging
2.1 MRI Basics
AGNETIC Resonance Imaging (MRI) basically shows us the concentration of hydrogen atoms in a tissue. Though all biological tissues contain a considerable amount of water,

M

varying water concentrations makes distinction possible. Water molecules themselves are made of two hydrogen atoms, and each hydrogen atom has one electron and a nucleus containing a proton with positive charge. We know from the physics that movement of a charge in loop generates a magnetic field. Therefore, from a magnetic point of view, a proton in the nucleus is like a magnet with magnetization vector M . In addition to the proton movements, the proton spins around its axis, which in turn generates a spinning magnet (Figure 2.1a ) [78]. MRI images are produced with the help of this spinning magnet made of protons in the hydrogen nucleus. Thus MRI is also called Nuclear Magnetic Resonance (NMR) imaging. MRI machines have a static main magnetic field that is always on, and homogeneous field in the subject being imaged is desired. Compared to the earth magnetic field, this magnetic field (denoted byB0 ), is very strong. In a tissue with an absence of external magnetic field, the magnetization vectors M are not aligned (Figure 2.1 b) [78]. However when we put the tissue in the magnetic field (B0 ), these magnetization vectors align to the direction of the external magnetic field (Figures 2.1 b and c) [78]. As these magnetization vectors align with B0 due to their spinning, they precess around the B0 axis. The frequency of this precession is determined by the strength of B0 and a constant determining the type of nucleus used for imaging, known as the gyromagnetic ratio and formulated 20

M

Proton B0

(a)

(b)

(c)

Figure 2.1: a) Magnetziation vector of a proton, b) Orientation of the magnetization vectors in the absence of external magnetic field, and c)Orientation of the magnetization vectors in the presence of MRI main magnetic field by Larmor equation [78]:

0 = B0

(2.1)

where 0 is precession frequency and  is the gyromagnetic ratio, which is 42.58 MHz/T for a hydrogen nucleus. In the literature, the coordinate system used to explain the MRI imaging has its z axis aligned with the B0 [78]. After the subject is left in main magnetic field, a rotating Radio Frequency (RF) magnetic field pulse (B ) is applied. This pulse is perpendicular to B0 and its rotation frequency in the x - y plane is the same as the precession frequency of the hydrogen proton. Because this RF field is applied temporarily and tips the magnetization over 90 degree and brings it into x - y (transverse) plane and is called the 90 RF pulse (Figure 2.2a ). The MRI signal is the voltage signal induced in a coil by rotating transverse magnetization vector based on Faraday's law. This signal is called Free Induction Decay (FID) and shown in Figure 2.2b. 21

Z

B0

Voltage
Receiver Coil
90o

M
B
x

Y

t

Recorded Signal

(a)

(b)

Figure 2.2: a) Rotating RF pulse and the receiver coil b)FID signal Soon after the pulse is turned off, the signal amplitude starts to decay. If the magnetization vector is separated in two components, one in x - y plane (Mxy ) and the other in z direction (Mz ), initially, the Mz is zero because magnetization vector is in the x - y plane. Over time, it is observed that the (Mxy ) decays exponentially with time constant T2 while Mz recovers exponentially to its initial value before RF pulse with time constant T1 [78]. T2 is much smaller than T1 in the tissues. Thus, the decay in the MRI signal is due to two factors: realignment of the magnetization vector with B0 and dephasing of magnetization due to the interactions between spins (spin-spin dephasing), causing some magnetization vectors to rotate faster and others slower. This spin-spin
 dephasing phenomenon reduces transverse decay time constant to T2 in reality. Therefore, to

obtain real T2 , another type of sequence exists, which adds a 180 RF pulse that rephases the dephased spins before acquisition. This sequence is called spin-echo sequence and the time between 90 pulse and acquisition time is called echo time. The magnetization received by MRI acquisition coil is a superposition of all magnetizations

22

from all over the imaged subject. In order to separate the contribution of each point in the subject, a mechanism to locate its contribution is needed [78]. To separate signals originating from various slices, slice-selection gradients are used. Instead of applying an RF magnetic field (B ) to all spins in the subject, the field is only applied to spins in a plane, so that the recorded signal is originating from that plane. The thickness of the slice is controlled by a gradient called Gz . Gradients add or subtract a small value from B0 based on their distance from a centre line, thus changing the precession frequency based on location. To encode signals in two other dimensions phase encoding and frequency encoding are used [78]. In frequency encoding a reading gradient is applied across the x axis, giving different precession to magnetization vectors in each row (Figure 2.3).

y

x=1

1

x=2

2 3

x=3

Figure 2.3: Frequency encoding across x axis We can apply a phase gradient Gy across the y axis right after the second RF and before readout gradient, since all magnetizations vectors have the same phase aligning to y axis at the end of the second RF pulse. The phase gradient causes magnetization vectors in y direction to travel different phases based on their y location (Figure 2.4). 23

y
First First Phase phase encoding encoding x=1 10
0

20

0

30
0

0

x=2

10

0

20

30

0

y
Second Phase Encoding x=1 20
0

40

0

60
0

0

x=2

20

0

40

60

0

y
Third Phase Encoding
x=1 300 60
0

90
0

0

x=2

30

0

60

90

0

. . .

.

.
.

Figure 2.4: Phase Encoding across y axis Samples of the signal received will fill one row of a matrix called k-space. To fill the other matrix rows, these phase encodings are repeated with progressively stronger phase encoding gradients (Figure 2.4). Figure 2.5 shows the whole spin-echo sequence. In order to generate a 180 degree rotation in the transverse M , the magnitude of the 180 degree pulse should be twice the 90 degree pulse. Many MRI acquisition sequences exist (Gradient Echo,...); however, the Spin Echo is used in this dissertation to obtain MRI images, as per CDI requirements. The signal received in k th phase encoding can be shown mathematically as the summation of sinusoid voltage signals with various frequencies and phases:
N M

S (k, t) =
n=1 m=1

Pmn expj ((0 +n)t+km)

(2.2)

in which t is time, k is k th phase encoding, M is number of rows, and N is number of columns in the image,  is the phase difference between two adjacent columns for the first phase encoding, 24

TE /2 180 900

0

90

0

RF Pulses
TR

Echo

TE

GZ

GY

Gx

Figure 2.5: Spin-Echo Sequence and Pmn is proton density at point (m, n). This equation shows that k-space is 2D Inverse Fourier Transform of proton densities; thus, using 2D Fourier transform on the k-space matrix, we can find the magnetization contribution of each pixel and subsequently its proton density, which is the MRI image [78]. Figure 2.6 shows how the k-space matrix is filled. The transverse magnetization contribution of point (x, y ) reaching the receiver coil is given as [79]: M (x, y ) = P (x, y )[1 - e
- TR
1 T

]e

- TE
2

T

(2.3)

To measure T1 and T2 for a subject, it should be scanned with various values of TR and TE . 25

Signal recorded after first phase encoding

Signal recorded after second phase encoding

K-Space Matrix

Figure 2.6: Filling K-Space matrix The points found are then used to fit exponentials and find their time constants, T1 and T2 . T1 and T2 are different for different types of tissue. To scan any subject, TR and TE should first be determined by the operator. Looking back at equation 2.3, we can see that for short TR and TE , the term containing T2 is closer to 1. Thus this acquisition is called T1 weighted. For long TR and TE , the term containing T1 is closer to 1, and is therefore called T2 weighted. Finally, if TR is long and TE is short, both terms containing T1 and T2 are close to 1, and therefore it is proton-density weighted. The T1 and T2 for cardiac muscle tissue are 900ms and 40ms, respectively [78]. In a T1 weighted image, the contrast enhanced blood appears brighter because of its shorter T1 . The signal level in MRI images increases as Field Of View (FOV) increases, decreases as matrix size increases, and increases as slice thickness increases. There is hence a trade-off between signal level and resolution. Furthermore, higher NEX improves Signal-to-Noise Ratio (SNR) by increasing acquisition time. Lower TE also increases the signal [80]. In in-vivo MRI imaging of the hearts, the movement of the heart and the blood flow causes

26

blurring in the images that can be overcome by synchronizing the acquisition with cardiac rhythm. This process is known as cardiac gating, and its application in cardiac MRI imaging allows us to obtain a video of various stages of a heart beat. This type of imaging is called cine imaging.

2.2

CDI protocol and its implementation

CDI is an MRI-based imaging method introduced by Joy et al. [15] that images the current density generated inside a subject due to an external current injection. When an external current (I ) is injected into the subject, it goes through various paths based on its conductivity geometry. These paths can be represented by current density J in the subject. This current density in turn generates a magnetic field BJ . In the CDI, the current I is a square current pulse with a duration of Tc . The phase changes recorded in the MRI phase images () at each point is proportional to the induced magnetic field BJ at that point [81]:

 = BJ Tc

(2.4)

where  is gyromagnetic ratio equal to 26.751 × 107 . Two current pulses with opposite polarities, phase cycle 1 (PC1) and phase cycle 2 (PC2) are applied at different stages of CDI imaging (Figure 2.7). The MRI sequence used in this imaging is spin-echo sequence. Figure 2.8 shows the singleslice acquisition sequence [81], which only adds the current pulse to the spin-echo sequence. The phase changes in the MRI phase images is proportional to the energy of the current pulse. Therefore, to have more signal, current should be kept on continuously before acquisition but off during RF firing to avoid interference with RF pulses. Further, if we do not change the polarity of injected current after 180o pulse, then the accumulated phase starts to vanish; therefore, the polarity of the current should be reversed after 180o pulse. In order to obtain current density maps in more than one slice in one acquisition (TR ), Demonte has provided the multislice sequence shown in Figure 2.9 for both phase cycles and for four slices in one repetition time [81]. Multislice acquisition helps us to speed up image acquisition and will be very useful in time sensitive experiments.

27

(a)

(b)

Figure 2.7: CDI current pulses a) phase cycle 1, and b) phase cycle 2 The phase cycling is performed for each acquisition and the resulted phases are subtracted and divided by two. This way any constant phase that is not due to the injected current can be removed. The phase obtained after phase cycling can be related to the magnetic field induced by the current in the direction of main magnetic field (B0 ) using equation 2.2. However in order to obtain one component of current density, two components of the induced magnetic field perpendicular to that J component are needed as per Ampere's Law [81]:

J =×H

(2.5)

where J is current density vector, H is magnetic intensity vector and × represents curl. We can see that two components of B are needed to calculate one component of J . For example, for Jz we have [81]: 1 By Bx [ - ] µ0 x y 28

Jz =

(2.6)

GY
900

TE /2

180

0

RF Pulses Echo

GZ

GY

Gx

Current Tc/2 Tc/2

Figure 2.8: CDI single slice acquisition pulse sequence Where µ0 is magnetic permeability equal to 4 × 10-7 and B is magnetic field. This equation means that, for every component of J , two components of B should be obtained by a 90o rotation of the subject. Before imaging for each acquisition, we should determine which acquisition sequence (single or multislice) is used, the amplitude of the current to be injected and its duration Tc , the repetition time TR , Echo time TE , field of view size, number of frequency and phase encodings (which in turn determine number of pixels in the final image), slice thickness, slice spacing, and number of excitation (NEX). In addition to the phase images obtained for different orientations we also need the magnitude images [81]. These magnitude images are used to find the binary mask for each slice. The mask is found by thresholding the magnitude images and is used to remove the noisy area outside the subject in the phase images by multiplying binary mask and the phase images. The phase images obtained are phase wrapped, and should first be unwrapped, then allowing us to calculate the induced magnetic field B using equation 2.2. Subsequently, spatial derivative of the magnetic fields should be calculated in order to obtain the components

29

TR TE TE TE TE

Phase cycle 1

RF Pulses

Current

TE

TE

TE

TE

Phase cycle 2

RF Pulses

Current

Figure 2.9: CDI multi slice acquisition pulse sequence (4 slices) of the current density. To calculate the derivatives, some templates can be used. These templates approximate the derivative and reduce the noise, though they compromise the spatial resolution, and are applied to the image by convolution. Table 2.1 shows a list of possible templates as provided by Scott et al. [79]. The resulting derivative should be normalized by x and y . We use the simplest 2D template because it takes both dimensions into account and also uses a smaller neighborhood to approximate the derivative, which is more appropriate for nonhomogeneous materials and also less computationally complex. As MRI is only able to record the signal inside the subject and doesn't have any signal in the surrounding air, that means we do not 30

Table 2.1: Derivative templates Name D1 D2
1 2 1 2

Template -1 1 -1 1 -1 0 1 

D3

 -1 0 1 1 -2 0 2  8 -1 0 1  -1 0 1 1 -1 0 1  6 -1 0 1  -1 -2 -2 -2 -1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 2 2 2 1       

D4

D5

1 32

    

have the magnetic field induced outside the subject. Thus, the derivatives calculated on the borders of the subject are not reliable and should be eroded. To obtain components of the current density, derivatives obtained from perpendicular orientations should be subtracted. In order to do this, they should be rotated and translated to match each other. This can be done with the help of a binary mask of the subject in each orientation. In the case of imperfect rotations, image registration can be also helpful. After the aforementioned processing is done on the MRI phase images, we can obtain components of the current density. Figure 2.10 shows the three perpendicular orientations for a slice in a cylindrical subject [16]. Figure 2.11 shows the steps of CDI protocol for one component of J assuming orientation 1 (OR1) is x and orientation 2 is y [81]. Figure 2.12 shows the wrapped phase and unwrapped phase, while Figure 2.13 shows magnitude image, binary masks for a phantom. 31

Bz

B0

By

B0

Bx

B0

(a)

(b)

(c)

Figure 2.10: Measuring components of the induced magnetic field, a)Bz , b) By , and c)Bx

2.3

DTI

Diffusion Tensor Imaging (DTI)is an MRI based imaging technique developed by LeBihan et al. in 1986 to study neurological changes in the brain [82]. This method is based on the fact that as MRI signal obtained from a voxel (volume pixel) tends to attenuate in the presence of a relatively strong linear gradient pulse (relative to frequency and phase encoding pulses) based on the level of water molecule diffusion at that point: s = exp(-bd) s0

(2.7)

Where, s is signal in the presence of diffusion gradient and s0 is the signal in the absence of a diffusion gradient that is used as a reference for measuring diffusion related attenuation which has diffusion coefficient d in the examined direction [83]. In 1991, Douek et al. showed that water molecule diffusion can be used to map the fibre direction in the brain because the water molecules tend to have higher diffusion in the direction of the fibre [84]. To obtain DTI images, the spinecho sequence is modified to contain the diffusion related gradient [85]. In order to obtain a 3D map of the diffusion and, subsequently, fibre direction, multiple diffusion gradients in multiple 32

directions will be fired. These directions and the intensity of them are determined by a table called b-table [83]. The obtained set of images are called Diffusion Weighted Images (DWI) [86]. These images are used to fit an elliptical surface on the diffusions in various directions. This elliptical surface can be represented mathematically by a structure tensor [87] which is a 3 by 3 symmetric matrix representing spatial gradients of the 3D diffusion and is called diffusion tensor [71, 88]. This structural tensor of gradients has the following structure:  D11 D12 D13 D =  D21 D22 D23  = V V T D31 D32 D33 

(2.8)

The eigen values of this tensor () determine the size of the three axis of the ellipsoid and its eigen vectors (V ) represent the direction of their directions. Therefore, the direction of fibre is equal to the main eigen vector (associated with largest eigen value) [89]. Some metrics are defined in the literature based on the eigen values of the tensor to distinguish various types of tissues. Two examples are Mean Diffusivity (MD), defined as the average of three eigen values, and Fractional Anisotropy (FA): 3 2 (1 - M D)2 + (2 - M D)2 + (3 - M D)2 2 2 2 1 + 2 + 3

FA =

(2.9)

In which 1 , 2 , 3 are the eigen values of the diffusion tensor and M D is mean diffusivity. The fibre direction obtained from the mathematical tensor can be visualized through colour coding [89]. Throughout this dissertation one of the most common colour representations, called absolute value scheme, is used. In this colour coding scheme, the sign of the vector does not matter and has mirror and rotational symmetry. It assigns one main RGB (Red, Green, and Blue) colour to each axis. Figure 2.14 represents this colour-coding scheme. Another way to visualize the fibres is by reproducing them in 3D in a software with 3D visualization features, this process is called tractography. The MRI machine provides raw DWI images, which should then be processed in order to obtain final colour coded DTI images. There are many DTI tools available [88]. One of the most comprehensive, open-source tools able to perform tensor estimation, region of interest analysis, 33

and tractography is the 3D Slicer, developed jointly by the Massachusetts Institute of Technology and Harvard's Brigham and Women's Hospital [88, 90]. It also has features for 3D modeling from slices and a Matlab bridge, making it even more attractive. The DTI images in this dissertation are obtained from the GE machine in DICOM format [91].Throughout this dissertation, DTI images are constructed using 3D Slicer software. Figure 2.15 shows a sample of DTI and tractography images obtained from pig heart.

2.4

Langendorf Setup

In order to perform ex-vivo experiments on a beating heart, blood (or a substitute nutrition) career should be regularly oxygenated and pumped to the heart. A setup for this purpose was invented by Langendorf et al. more than a century ago [8]. In addition to oxygen and temperature regulation, the PH of the perfusate should be regulated through Carbogen (95% O2 +5% CO2 ). A block diagram of the Langendorf setup is shown in Figure 2.16 [8]. The Langendorf setup consists of a pump that circulates the perfusate with a constant adjustable flow and a heater pump that heats distilled water and pumps it through a water jacket to keep the temperature of the perfusate close to 37 degrees. The perfusate that comes out of the pump goes through the heat jacket, stabilizing its temperature before entering a reservoir called the bubble trap, which keeps the pressure constant and removes any bubbles formed in the circulation path before entering the heart. The bubble trap is also used for injecting drugs and measuring temperature. The perfusate then goes to the cannulas attached to the aorta or the coronaries; before being collected in a reservoir into which Carbogen is infused. The collected perfusate is then sucked back by the pump and the cycle continues.

2.5

Image Processing Techniques

Unwrapping: In order to perform unwrapping, the 2D Quality Guided Path Following Method is used in this dissertation [92]. There are various types of phase unwrapping techniques in the literature and their relative performance are problem dependent [93]. However, there are generally

34

some differences in terms of implementation speed, precision (in the presence of sharp changes in the phase), and performance (in the presence of noise). A comparison of a series of methods on a typical unwrapping problem was performed by Ozaktas and Onural, [94] showing that Quality Guided Path Following Method had the best overall performance. In cases with very high level of noise, the Flynn method may show better results [93]. Before applying the unwrapping technique, the phase images are masked to remove noise outside the subject. Figure 2.12 shows the phasewrapped and phase-unwrapped images generated by Quality Guided Unwrapping Method. Erosion: To erode unreliable current density values on the edges, binary image erosion technique was applied to the binary masks [95]. Figure 2.17 shows the current density calculated for a slice of pig heart with and without erosion. Image Registration: The image registration for images obtained from orientations 1 and 2 was performed using built-in Matlab function, which uses similarity transformation (including rotation translation and scaling) in conjunction with a mean squares metric. A step gradient descent optimizer [96] minimizes the difference based on the metric and iteratively optimizes the transformation. In order to obtain the transformation from the masks and apply it to the phase images the built-in Matlab code was modified. Figure 2.18 shows two unregistered masks for two orientations of a pig heart slice and the final registered images. Denoising: In order to perform denoising on the calculated current densities, a series of methods are used throughout this dissertation. 2D Median filtering, which replaces the value for each pixel with an average of values in a defined neighborhood, is implemented using built-in Matlab functions [97]. Perona-Malik is another smoothing method that preserves the edges as it smooths out the image. The edges are determined by gradient of the image. This method iteratively smooths the image. The iterations can be formulated as steps of a diffusion equation [98]. Another method is the adaptive Wiener method, which estimates the statistics of an additive Gaussian noise in a neighborhood and accordingly uses the Wiener filter concept to suppress the noise [97]. This method is designed to counter Gaussian noise. Finally Block Matching Three Dimensional method (BM3D), which was originally designed to counter Gaussian noise using image statistics and patterns at the same time, is used. It relies on defining a set of patterns in an image using a similarity measure. The

35

similar patches are stacked in 3D before being filtered and replaced by hard thresholding. Results from various patches are subsequently weighted and combined for the overlapping area [99]. This chapter reviewed the methodologies used to obtain our experimental data. First, the general theoretical backgrounds of MRI imaging, CDI, DTI, and Langendorf setup were explained. Afterwards, image processing techniques commonly used for CDI imaging were reviewed. In the next chapter, the background concepts of electrophysiological modeling utilized in the construction of CDI model are reviewed.

36

OR1
Magnitude Image Phase Image PC1 Phase Image PC2 Magnitude Image

OR2
Phase Image PC1 Phase Image PC2

Mask Binary Mask 1 Phase Unwrapping
Calculate Bx

Mask Rotate & Translate Phase Unwrapping
Calculate -Bx

Rotate & Translate

Rotate & Translate

Mask
Binary Mask 2

Mask

Phase Unwrapping

Phase Unwrapping

Subtract & Divide by 2 Convolve with derivative template  

Calculate By

Calculate -By

Subtract & Divide by 2

Convolve with derivative template

Subtract & calculate J with invalid edge

 

Mask 1 & 2

Erosion

Jz

Figure 2.11: CDI Protocol Steps

37

Wrapped Phase in Radian

Unwrapped Phase in Radian

Figure 2.12: Phase wrapped and unwrapped images in a phantom

38

Magnitude Images and Binary Masks

Current Density in A/m2

Figure 2.13: Magnitude, binary mask and current density image for the phantom in Figure 2.12

39

z
Y

x

Figure 2.14: Absolute value colour coding scheme

40

DTI of an slice of pig heart

Tractography of pig heart

Figure 2.15: DTI and Tractography for a pig heart

41

Heat Jacket

Heater Pump
Bubble Trap

Pump

Perfusate Reservoir

Carbogen Tank

Figure 2.16: Langendorf Setup block diagram

42

a)

b)

Figure 2.17: Erosion of the calculated current density a) with out erosion b) After erosion

43

a)

b)

Figure 2.18: Image registration applied to binary masks a) Unregistered b) Registered

44

Chapter 3 Methodology: Electrophysiological Modeling

V
3.1

ENTRICULAR electrophysiological models simulate electrophysiology of the ventricles at both the cell and tissue level. In this chapter, the cardiac electrophysiology modeling

approaches using Finite Element Method are presented.

Electrophysiology at Cell Level

The structure of a cardiac cell is made of membrane and multiple ion channels and exchangers (pumps). Electrical activity starts at the cell level by sodium, potassium, calcium, chloride (four major ion types) and other ion exchanges through the membrane, which separates extracellular and intracellular domains. Among major ions, sodium, chloride, and calcium have higher extracellular concentration, while potassium has higher intracellular concentration. Their levels are kept constant by ion pumps [9]. In the absence of an external stimulus, a cardiac cell is electrically at rest, meaning there is no change in its transmembrane potential which is intracellular voltage minus extracellular voltage. For most cardiac cells, the transmembrane potential is between -85 mV and -90 mV. In resting state, the voltage in the intracellular compartment is less than the extracellular compartment. As ion channels in the membrane are ion selective, the cell is able to maintain a difference between ion concentrations on both sides of the membrane. When a stimulus is applied that is stronger than a given threshold, the transmembrane voltage will increase from its resting value. This process is known as depolarization. Gating mechanisms in ion channels depend on 45

the transmembrane voltage. Changes due to depolarization, which in itself causes transmembrane voltage to be reduced back to resting potential is known as repolarization. The depolarization and repolarization of a cell due to an stimulus forms an action potential (Figure 3.1).

Membrane Voltage (mV)

APD

Figure 3.1: Cardiac Action Potential In this figure, Action Potential Duration (APD) and the five phases of an action potential are shown. In Phase 0, there is a sharp rise in transmembrane voltage generated by the opening of fast sodium channels. During Phase 1, repolarization begins as transient outward potassium channels open. However, this repolarization is delayed by the opening of calcium channels in Phase 2, generating a plateau. Repolarization opens up other types of potassium channels, causing faster 46

repolarization in Phase 3, before the transmembrane voltage finally returns to its resting value in Phase 4. During APD, the cell will not respond to any further stimulation, a phenomenon known as refractoriness. The refractoriness period matches APD [9]. There are four major types of paths between extracellular and intracellular compartments of a cardiac cell: voltage-gated channels, ligand-gated channels, stretch-activated channels, and exchangers [9]. Heart diseases are associated with changes in the performance of ion channels, cell connections and structural damages to the cells [9]. These types of paths will be explained below: Voltage-gated channels: The gating mechanism of these types of ion channels depend on the transmembrane voltage. Major voltage gated ion channels in cardiac cells are sodium, potassium, and calcium. Sodium channels are mainly responsible for the initial sharp rise of the transmembrane voltage and are closed very quickly after Phase 0. Calcium channels contribute to Phase 2 of the action potential as well as the contraction of cells. Ligand-gated channels: These channels are closed in normal condition and are only activated by abnormal chemical levels. An example of this is an acetylcholine activated potassium channel. This channel is activated if the acetylcholine level increases from normal levels. Stretch-activated channels: These ion channels are normally closed but are activated when under pressure, affecting the transmembrane voltage. The presence of these channels play the main role in mechano-electrical feedback. Exchangers: The exchangers' major function is to maintain the gradient in ion concentration between intracellular and extracellular compartments. The sodium-calcium exchangers balance the calcium movements, while the sodium-potassium pump sends sodium out and potassium in to the cell to keep the balance.

3.2

Electrophysiological models at cell level

In modeling cellular electrophysiology, the membrane is modeled as a capacitor, for which one plate represents the extracellular side and the other represents intracellular side [3]. The ion channel currents change the voltage across this capacitor. This is mathematically explained by the following formula [3]: 47

Cm

dVm =- dt

In
N

(3.1)

In which Cm is the capacitor per unit area representing the membrane, Vm is the transmembrane voltage, and N is the number of modeled ion channels or exchangers. In s refer to ion channels or exchangers currents per unit area of the membrane. There are more than a hundreds of cell models available in the literature [3]. Figure 3.2 shows the Hodgkin-Huxley model represented by electrical components [9]. Clayton

Intracellular

Cm Vm

gNa

gK

gL

ENa

EK

EL

Extracellular

Figure 3.2: Hodgkin-Huxley model [3]

48

and Panfilov have divided cardiac cell models into four categories, which are explored in the following subsections [3].

3.2.1

Simplified two variable models

In these models, the complex operation of ion channels is simplified and represented by two variables; excitation and recovery. The main goal is to reproduce the shape of an action potential as closely as possible using only two variables. The activation (scaled transmembrane voltage) is usually represented by variable V , while recovery is represented by variable u. The general form of equations representing the changes in the activation and recovery variables is as follows [3]: u V = f (u, V ), = g (u, V ) t t

(3.2)

Where function f is cubic in V and linear in u and function g is linear in V and u. The activation variable u represents the transmembrane voltage. The Fitzhugh-Nagumo model and its variants are subsets of this category of models [34, 35]. The Fitzhugh-Nagumo model was originally developed by simplifying a biophysically representative Hodgkin-Huxley model of ion channels [11], which is "the father of all" electrophysiological models of cardiac cells. Fitzhugh Nagumo model is defined by the following pair of equations [34, 100]: V 1 u 1 =c - V3+u+V +I , = - [V + bu - a] t 3 t c

(3.3)

Here, parameters c, b and a are constants that can be modified to change the shape of the action potential and I is the external injected current. Other variants of the Fitzhugh Nagumo model include the Aliev-Panfilov model [101], which is shown to reproduce spiral patterns associated with VT and VF conditions and able to reproduce APD restitution; Rogers and McCulloch [102]; Van Capple and Durrer [103]; and Nash and Panfilov [104]. Each of these models adds more detail in one aspect while keeping the two variable representation.

49

3.2.2

First generation biophysically detailed ventricular cell model

These models directly reflect the electrophysiology of the ion channels in their equations and vary from simple to very complex representation of ion channel kinetics. While the Hodgkin-Huxley model is primarily used in this category, the other models are developed by adding more details to the Hodgkin- Huxley model, helping to explain ion channel operations. However, the HodgkinHuxley model was originally developed for nerve cells. The first model to be adapted for cardiac cells was Noble's model [105]. The general form of these types of models is as follows [3]:

m =- Cm dV dt

S

IS (3.4)

¯ S 1 2 · · · n (Vm - VS ) IS = G S S S
dS dt

=

s (Vm -S ) S (Vm )

In which IS is the current associated with ion type S , Cm is the transmembrane capacitor, t is time, VS is Nearnst potential for ion type S , GS is maximum channel conductance for ion type S , n is the number of gating variables associated with ion channel type S , S  is the steady state value for gating variable S , and S is the time constant for gating variable S . In biophysical representation of ion channels, the time and voltage dependence of the conductance for the ion channel is formulated using some gating variables which in turn have some biophysical meaning. The time evolution of each of these gating variables for each ion type is explained by the third equation in equation 3.5. Another model in this category is McAllistar et al. [106], which models sodium, calcium, and three types of potassium channels in a simplified way; however, it improves the Noble model in representing Purkinje fibre using experimental data. Luo-Rudy model [60] also added more detail in potassium channel representation. One of the most recent models in this category is the Tusscher and Panfilov model [107], which is a modified version of the LuoRudy model for human cardiac cells. There are many other models available in literature in this category [9].

50

3.2.3

Second-generation biophysically detailed models

These models consider ion concentrations and the role of exchangers in addition to the ion channels. The general form of these models is as follows [3]:

m =- Cm dV dt

S

IS (3.5)

d [S ] dt

=

k k IS (Vm , S )

Where S represents the type of ion, IS is the total current for ion S , Cm is transmembrane capacitance, Vm is the membrane voltage, [.] represents ion concentration, t is time, and k represents the number of various types of channels of the same ion. The second equation is only shown for one type of ion. DiFrancisco and Noble in 1985 introduced the first model in this category [64]. Their model is also the most comprehensive in terms of Purkinje representation, though the LuoRudy model was also upgraded to include ion concentrations in 1994 [108]. It therefore considers calcium, sodium, and potassium concentrations. The 1994 Luo-Rudy model is the most comprehensive in terms of electrophysiological details, and has been widely supported by experimental data. This makes it one of the most attractive, biophysiologically detailed models in the literature. Another model in this category is the TNNP model [45] which is used for human cardiac cells.

3.2.4

Reduced cardiac models

Reduced cardiac models act like a bridge between simplified and biophysically detailed models, overlapping with both categories. One example of these models is the Fenton and Karma model [50]. In choosing the appropriate cell model for a simulation we must consider how much detail is needed in the study and which details are more applicable for the region of study. We should also note the computational complexity of the model and the required simulation times: secondgeneration biophysically detailed models are computationally intensive, while simplified models are the least computationally intensive.

51

3.3

Electrophysiology at tissue level

Cardiac tissue is formed from cardiac cells placed in certain orientations, shaping the structure of the heart. These cells are connected to each other through the gap junctions, which help an action potential generated in a cardiac cell to propagate and affect adjacent cells. The number of gap junctions determine the conductivity among the cells. There are differences in gap junction concentrations among various types of cells. Bundle branches and Purkinje network have the highest conductivity among cardiac cells while SA and AV nodes have the lowest conductivity. Gap junctions can also be affected in heart diseases, such as by the creation conduction blocks. Since the gap junctions are more concentrated in the longitudinal direction of cardiac cells, there is a higher conductivity in the direction of fibres. After formulating the electrophysiology of the cell through equations that either simply replicate action potentials generated by cells or represent ion exchanges in detail, these cells should be connected together to model electrophysiology at the tissue level and replicate the propagation at the tissue level. The propagation of an action potential at the tissue level is a diffusive phenomenon, therefore, to formulate it, the diffusion equation from physics is applied. The structure and conductance of the tissue are thus formulated in a diffusion tensor. As explained in Chapter 1, this diffusion tensor can either be extracted through histology or DTI imaging. Electrophysiological cardiac models are divided into two categories in terms of tissue representation [3]: monodomain and bidomain models. While the monodomain model considers the tissue as a single medium for diffusion of electrical activity, the bidomain model considers two interacting compartments that represent extracellular and intracellular environments. Though this separation of intracellular and extracellular environment adds to the electrophysiological detail and is more representative of true electrophysiology, it requires us to obtain intracellular conductivities, which is far more detailed information.

3.4

Electrophysiological models at tissue level

The mathematical representation of electrophysiological models at the tissue level can be obtained by combining tissue structure data and the equations representing the chosen cell model. The gen-

52

eral forms of monodomain and bidomain models are described in the following two subsections.

3.4.1

Monodomain Models

These types of models represent the tissue as a continuous conductive medium. The general form of these models is as follows [3]: Iion + Iapplied Vm =  · (DVm ) - t Cm

(3.6)

here Cm is membrane capacitance, Vm is transmembrane voltage, D is diffusion tensor, Iapplied is the injected external current, and Iion is the ion channel current determined by the cell model used in the model. The diffusion is connected to the conductivity in isotropic cases through the following equation [3]: Gij Sv Cm

Dij =

(3.7)

where G is conductance and Sv is the surface to volume ratio for the cell. These models, which are simpler and their implementation less computationally intensive, are usually precise in studies where an external current is not injected. The boundary condition for the differential equation is usually defined on the exterior surface of the heart (assuming there is no electrical exchanges between heart and adjacent organs), while n is the vector perpendicular to the boundary formulated as:

n · (DVm ) = 0

(3.8)

However, there are also models that consider the conduction between heart and surrounding blood bath.

3.4.2

Bidomain Models

Another representation of the tissue considers separate intracellular and extracellular domains and is called bidomain. Figure 3.3 shows a representation of bidomain model.

53

Extracellular

Ion Channel

Intracellular

Figure 3.3: Representation of Bidomain Model In the bidomain model, the transmembrane potential is defined as intracellular voltage minus extracellular voltage:

Vm = i - e The general form of the bidomain model is as follows [3, 109]:

(3.9)

54

 · (Di + De )e = - · (Di Vm ) (Im + Iext )  · (Di Vm ) +  · (Di e ) = - C1 m
m + Iion Im = Cm dV dt

(3.10)

In this formula Di is intracellular diffusion tensor, De is extracellular diffusion tensor, and Im is membrane current. The same boundary condition as monodomain is applied to both Vm and e . These models provide more detailed information, especially in the presence of an injection of external current, and are thus applied in defibrillation studies. Due to a more complex formulation, it should be noted that these equations are also more computationally intense. Both monodomain and bidomain models, when combined by the cell models, form a system of differential equation that does not have a closed form solution [3]. Therefore, numerical methods should be applied to solve them. The two main numerical methods include the Finite Difference Method (FDM) and Finite Element Method (FEM). A good FDM-based solution for such systems of differential equations in the more complex bidomain models is suggested by Keener and Bogar [3, 110]. Some FEM-based approaches for bidomain models are developed by Austin et al. [111], Santos et al. [112], and Vigmond et al. [113]. FEM is more widely used because it has been shown to perform better with complex domains and is more precise in approximating the values in-between nodes: however, in terms of stability, FEM is weaker [114]. Generally speaking, the preference of one method over another is problem dependent. In the case of monodomain and bidomain models of cardiac electrophysiology, FEM is more preferred [3]. In this dissertation, a simplified model called Aliev-Panfilov is used for CDI modeling [101], as it has been shown to explain many APD-related phenomena and, since we deal with electrical activity in macro scale in CDI modeling (as CDI is only able to measure time and space averaged current density), more detailed and complex models containing ion channels kinetics are not needed. Initially, the monodomain version of Aliev-Panfilov model was implemented in this work; however, due to the injection of external current, the more complicated bidomain model is also considered as it is recommended in defibrillation modeling in the literature. The bidomain models are more powerful in 55

explaining phenomena observed in defibrillation.

3.5

FEM

As mentioned before, the systems of Partial Differential Equations (PDEs) used in cardiac electrophysilogical models do not have analytic solution. In order to solve them, numerical methods should be applied. Initial cardiac electrophysiological modeling works used FDM widely due to its less computational complexity, but in recent years, Finite Element Method has become favoured as more powerful computers and software tool are available, reducing simulation time and implementation complexity. FEM was first developed by the mathematician Richard Courant in 1943, and was refined in the 1960s by John Argyris from University of Stuttgart, M. J. Turner from Boeing and Ray Clough from the University of California Berkeley [115]. During the 1970s, Gilbert Strang from MIT and George Fix, both mathematicians, contributed to the further development of the finite elements [114]. It is now used extensively in various modeling problems, including biological, chemical, physical and financial. It is also used to solve electromagnetic, astrophysics, fluid dynamics, structural analysis and material science problems.

3.5.1

Finite Element Method Steps

The main steps of FEM start by reformulating the original PDE problem into another form, called the weak form, Next, the shape of elements are chosen and the mesh is mathematically defined before the basis is chosen. Afterwards, the Galerkin approximation uses projection theorem to approximate solution on a subspace. At the end, the integrals in the Galerkin-approximated matrix form of the problem should be calculated. Weak Form: First, we should find an approximate formulation of the original differential equation. This approximate formulation should be easier to solve, either analytically or numerically, and is called the weak or variational formulation of the problem. To generate weak form, some test functions are used, and Green's theorem (the integration by parts rule depending on dimension of the problem) is applied. The multidimensional form of Green's theorem is given as [1]: 56

Weak Form

Mesh Generation & Basis Selection

Galerkin Approximation

Assembling Matrix Form

Figure 3.4: FEM steps

v u · n =
 

v ·  u +


v

u

(3.11)

where   is the boundary of region , n is the normal vector to the boundary,  represents Laplacian (.), v represents test functions, and u is the unknown function. This weak form uses properties of inner product. For the two vectors v1 and v2 of the vector space V , the inner product operation is shown as < v1 , v2>: V × V  R. Using an inner product operator, a norm can be defined as v =< v, v >. The weak form

for different PDEs and different boundary conditions is different. Some well-known forms are presented in the mathematical FEM books [1]. Galerkin Approximation: After the weak form of the original problem is obtained, the next step is to approximate the solution. One of the most widely used methods of approximation proposed by Russian mathematician Galerkin, is the Galerkin method. The reasons for the popularity of this approximation method are that they result in block-diagonal stiffness matrices, are stable, and accurate, and can be applied for any mesh structure [116]. This method combines properties of inner product with the projection theorem The projection theorem is defined as follows [1]: For an inner product vector space V and its subspace W (with finite dimension), if we choose a member u  V then 1. There is a unique w  W for which u-w  u-z 57 for any other z  W that is not

equal to w. This w is called projection of u on the W subspace. 2. A vector w is the projection of vector u if and only if <u - w, z> = 0 for any z  W Applying the above concept to functions, if we assume that finite dimension space W can be represented by a set of n basis functions {w1 , ..., wn } then w  W can be expanded in following form [1]: w=
j =1 n

j wj

(3.12)

substituting this into the second part of projection theorem by replacing z by wi :
n

<u -
j =1

j wj , wi>= 0

(3.13)

and after rearranging terms for each wi we will following equation:
n

<u, wi>=
j =1

<wj , wi> j

(3.14)

For a known function u and known n basis vectors, the system of n equations for n unknown i values can be written as [1]: G = b (3.15)

This last equation is called the Normal Equation, and matrix G is called Gram Matrix which is defined as Gij =< wj , wi > i, j = 1, ..., n. However, we don't know the solution u, and it must therefore be approximated. At this point, the weak formulation becomes very helpful. Weak formula can be shown generally in the following format for a test function v and unknown function u [1]: <u, v>= f (v ) (3.16)

The inner product definition is different for different problems. These inner products are only dependent on v and are called energy inner products. The norm defined by them is shown as ·
E

and is called energy norm. The normal equation in this case is K u=f in which Kij = <wj , wi>, u is vector of i coefficients and fi = <u, wi> = l(wi ) [1] if we use basis functions as test functions. The Gram matrix K is called the stiffness matrix in FEM applications, and basis functions in FEM 58

are shown as i instead of wi . It is necessary to make sure the properties of inner product is satisfied by the left side of weak formula. In more general cases, there may be other terms of unknown vector u in the matrix form of the problem. To summarize, the Galerkin method finds approximate solution in a lower-dimension space that is closest in terms of energy norm. To apply the Galerkin approximation, a basis for the subspace that is approximating the solution should be selected. Based on the choice of basis functions and the procedure of deriving the weak form, different FEM methods other than Galerkin method are available. Mesh Generation: Basis functions are dependent on the mesh used for the discretization of the domain. Thus, one of the main steps of FEM is mesh generation. To generate a mesh, the first step is to choose element shapes and number of elements. To explain the process and, for the sake of simplicity, triangular elements in 2D are considered. Triangles in the mesh that are connected should have common vertex (node) and/or common edge. Two connected triangles should not have part of an edge in common [1]. If the solution domain is polygonal, then it is possible to cover whole domain by triangulation. This is an approximation for general domain (geometry). When the number of elements is very large, then it is very hard to define the mesh, and the vectors and matrices that define the mesh become very large and complicated. Therefore, in the first step of mesh generation, a coarse mesh with few elements should be chosen, then the coarse mesh should be refined as many times as necessary to generate a detailed mesh structure. Figure 3.5 shows one refinement step for a triangular element. The standard refinement for a triangular mesh is to divide each triangle element to four triangles by connecting the midpoints of each edge. The new nodes and edges can then be defined in each refinement step and should be added to the nodes and edges from previous steps, and all vectors and matrices defining the mesh structure should be updated. The algorithm for standard refinement of triangular mesh T0 to T is given by Gockenbach [1]. In mesh generation, it is important to keep track of all nodes, edges, and elements and how they are connected. Basis Selection: In order to implement the Galerkin approximation, a set of basis should be chosen. This set of basis specifies the subspace approximating the solution space. The simplest basis is piecewise linear basis. In a 2D domain, the solution u is a 3D surface.

59

Old Vertices

New Vertices

Coarse Mesh

Figure 3.5: Mesh Refinement Using a piecewise linear basis, the 3D surface of u is approximated by planes for each element. Thus each plane has three corners defined by the values at vertices. In other words, for each element, the approximating surface is a triangle cut out of a plane. Figure 3.6 shows piecewise linear approximation of the solution for a triangular element. These planes take the general form of z = ai + bi x + ci y for ith element, and parameters ai , bi , and ci are specified by the value of u at vertices of the triangular element Ti . If the three vertices of element Ti are named as vi1 , vi2 , and vi3 in which vik = (xik , yik ) then u(xik , yik ) = ai +bi xik +ci yik while i represents ith element and k = 1, 2, 3 which results in a system of three equations with three unknowns. Because of continuity, the values of u in adjacent triangles are related and parameters a, b and c are therefore not independent in two adjacent triangle [1].
1 The set of all piecewise linear shapes defined on a mesh h is denoted by Ph . In this notation,

h is name of the mesh and 1 denotes linear. If the triangular mesh has nv vertices then a basis for
1 1 this subspace Ph is denoted as {1 , ..., n } so that for any v  Ph ,v= nv i=1

i i . The condition

vj =

nv i=1

i i (xj , yj ) = j (xj , yj ) is therefore satisfied if [1]: i (xj , yj ) = 60 1 0 i=j i=j (3.17)

Vertices

2D triangular element Approximated 1st order solution

Vi3 Vi1

Vi2

Figure 3.6: Piecewise linear approximation of the solution Satisfying this condition means that the value at each node can be represented by the basis that has value of 1 at that node and zero at other nodes. The test function for a piecewise linear subspace is in the form of v (x, y ) = ai + bi x + ci y . Therefore, inside element Ti , derivatives of v with respect to x and y are constant. This is the main reason that piecewise linear basis are attractive. Another type of basis for triangular mesh is Piecewise Quadratic Basis. In this case, the approximating surfaces are of quadratic form and can be shown as [1]: v (x, y ) = a + bx + cy + dx2 + exy + f y 2 (3.18)

This shows that six parameters are needed to define such a surface. Therefore values of u are needed at three more nodes in each triangular element. These new nodes are added at midpoints of each side of the triangle, so that these new points are shared among adjacent triangles and the continuity condition is maintained. Thus each element on the mesh now has six nodes. The
2 quadratic piecewise subspace is denoted as Ph . These approximating surfaces bounded by the

triangular mesh are called Lagrange Triangles.
2 For Ph , the basis shapes that satisfy the condition in equation (3.17) are of two types, depending

on the position of (xi , yi ) on the mesh. This means that, by increasing the order of approximating 61

surfaces, there are more than one type of basis functions. Another type of basis for triangular meshes is Piecewise Cubic Basis. They can be shown as [1]: v (x, y ) = a + bx + cy + dx2 + exy + f y 2 + gx3 + hx2 y + ixy 2 + jy 3 (3.19)

To define such a surface on each element, ten parameters should be defined. Therefore ten points should be assigned to each element. Each edge is divided to three parts by assigning two nodes to each edge. This way we are short of one node. However, a cubic surface of two variables reduces to a cubic form of one variable on a line for which four parameters are enough to determine. Therefore, for continuity to be held, four nodes on each edge are enough. Therefore, the tenth remaining node can be inside the element and is chosen at
3 three types of basis shapes for Ph [1]. xi1 +xi2 +xi3 3 yi1 +yi2 +yi3 . 3

and

There are

For polynomials of arbitrary order d, there are d + 1 nodes on each edge, including vertices. Therefore, for each element, there are 3 + 3(d - 1) = 3d nodes. A polynomial of order d in two variables needs element [1]. Element shapes other than a triangle can be used, including rectangles for which the basis are introduced in [1]. For a 1st order piecewise polynomial approximation on a triangle, the basis function over Tk is given as [1]: i (x, y ) = ai + bi x + ci y (x, y )  Tk i = 1, 2, 3 Considering mutual exclusiveness of basis function from equation(3.17) for i = 1 [1]:   a1 + b 1 x 1 + c 1 y 1 = 1 a1 + b 1 x 2 + c 1 y 2 = 0   a1 + b 1 x 3 + c 1 y 3 = 0 (3.20)
(d+1)(d+2) 2 (d+1)(d+2) 2

parameters to be defined. Therefore,

- 3d nodes fall inside the

(3.21)

In this system of equations, (xi , yi ) are vertices of the triangle. The matrix form of this system of equation is:     1 x1 y 1 a1 1  1 x 2 y 2   b1  =  0  1 x3 y 3 c1 0 62  (3.22)

By combining system of equations for i = 1, 2, 3 [1]:      1 x1 y 1 a1 a2 a3 1 0 0  1 x 2 y 2   b1 b2 b3  =  0 1 0  1 x3 y 3 c1 c2 c3 0 0 1

(3.23)

from this equation, all coefficients can be calculated by inverting the leftmost matrix, which is denoted as matrix M .

3.5.2

Assembling Matrix Form of the FEM Problem

After defining the mesh and determining every element, edge, and node and their interconnection in the mesh mathematically, the integrals that should be calculated for the matrix form will be calculated on each element and contribution of each element will be assembled into the matrix form. In the process of calculating these integrals on each element, it is needed to approximate integrals. For this purpose, Quadratures and Gaussian Quadratures should be used. These approximations will become exact under certain conditions. For the one dimensional case,the simplest quadrature rule is called the trapezoidal rule, which is defined as [1]:
1

f (t)dt = f (-1) + f (1)
-1

(3.24)

This gives the exact value of the integral, if f (t) is a first-order function. To apply Gaussian Quadratures to the two dimensional triangular mesh, a reference triangle should be used. This reference triangle has vertices at (0, 0), (0, 1), and (1, 0). The integral over this reference triangle (TR ) is approximated as [1]:
n

f=
TR i=1

i f (si , ti )

(3.25)

Where i s define the n-point approximation rule. For the above approximation to be exact for first-order polynomials in 2D, the following conditions must be satisfied [1]:  1   TR 1 = 2 =  1 =  1 s1 s= 1 6 TR   1 t = 6 = 1 t1 TR

(3.26)

63

Coeffs (s1 , t1 ) (s2 , t2 ) (s3 , t3 ) 1 2 3

Rule 1 Rule 2 (1 , 1) 6 6 , 1) (2 3 6 (1 , 2) 6 3
1 6 1 6 1 6 1 (2 , 0)

, 1) (1 2 2
1 (0, 2 ) 1 6 1 6 1 6

Table 3.1: Two exact 3 point Gaussian Quadratures for 2D Second Order Polynomials [1] which results in 1 = 1 ,t = 1 , and s1 = 2 1 3
1 3

meaning that [1]: (3.27)

1 1 1 f = f( , ) 2 3 3 TR

For second order polynomial, the above integrals should be calculated on (1, s, t, st, s2 , t2 ) and since there is no exact two-point rule available for 2D [1], three-point rules are used, but they are not unique. Two of them are shown in Table 3.1 [1]. To generalize integration over reference triangle to general triangles, the transformation that converts arbitrary triangle to reference triangle should be found and the integral will be calculated on the reference triangle using Jacobian. For example, if vertices of the arbitrary triangle are at (x1 , y1 ), (x2 , y2 ) and (x3 , y3 ), then if one assumes that corresponding vertices on the reference triangle are (0, 0), (1, 0) and (0, 1), assuming (s, t)  TR and (x, y )  T then the following formula shows how to calculate the integral [1]: x y
T

=

x1 x2 - x1 x3 - x1 s + y1 y2 - y1 y3 - y1 t f (x, y )dA = TR g (s, t) | det(J ) | dA

g (s, t) = f (x1 + (x2 - x1 )s + (x3 - x1 )t, y1 + (y2 - y1 )s + (y3 - y1 )t) x2 - x1 x3 - x1 J= y2 - y1 y3 - y1

(3.28)

64

For a two point approximation case (which is exact for first order polynomial), then we have [1]:
TR T 1 1 1 g( 3 , 3) g=2 J 2

f=

f (¯ x, y ¯)

(3.29)

1 1 (x1 , y1 ) + 3 (x2 , y2 ) + 1 (x3 , y3 ) (¯ x, y ¯) = 3 3

in the above formula, (¯ x, y ¯) is the centroid of triangle and J is determinant of J . If the three point rules are used then for Rule 1 [1]: f= J [f (¯ x1 , y ¯1 ) + f (¯ x2 , y ¯2 ) + f (¯ x3 , y ¯3 )] 6 (3.30)

 T 1 2  (x1 , y1 ) + 6 (x2 , y2 ) + 1 (x3 , y3 ) x1 , y ¯1 ) = 3 (¯ 6 1 2 1 (¯ x2 , y ¯2 ) = 6 (x1 , y1 ) + 3 (x2 , y2 ) + 6 (x3 , y3 )   1 (¯ x3 , y ¯3 ) = 1 (x1 , y1 ) + 6 (x2 , y2 ) + 2 (x3 , y3 ) 6 3

In the above formula, (¯ xi , y ¯i ) is the coordinate of one point inside the triangle based on coordinates of vertices. To show the coordinate of a point inside a polygon based on its vertices in geometry, Barycentric coordinate is used. For a triangle [1]:
i i i (xi , yi ) = 1 (x1 , y1 ) + 2 (x2 , y2 ) + 3 (x3 , y3 ) i i i  [0, 1] , 3 , 2 1 i i i =1 + 3 1 + 2

(3.31)

Barycentric coordinate is generally used to show table(3.1). The difference in this case is that the area of reference triangle is assumed to be 1; therefore, i coefficients should be multiplied by two [1]. If the structure of mesh is already defined (as mentioned before), the element based algorithm can be used. Based on this algorithm, the contribution of elements can be calculated and added to matrix K . In order to calculate integrals over triangles, their vertices should be known.

65

3.5.3

FEM Formulation for coupled Elliptical and Parabolic Heart Model

For the monodomain tissue models when two variable cell models are used, the equivalent system of PDEs is [117]: + Iion (u, V )) -  · ( V ) + I vol = 0 (C V t u = f (u, V ) t model, and I vol is external volume current injection. After discretizing the time domain using the explicit Euler method, the weak form is [117]: Find V m+1 , satisfying C t V m+1 i d3 x +
 

(3.32)

In this equation, V is transmembrane potential, Iion is ion channels' current given by the cell

( V m+1 · i d3 x) =

C t
 neu

V m  i d3 x


(3.33)

-


(I vol + Iion (u, V m ))i d3 x +

I (surf ) i dS

in which V m is membrane voltage at time m, u is the recovery variable at this time, and the term containing I (surf ) appears when there is a surface current injection. There is a Neuman boundary condition, meaning there is no electrical exchange between the heart and adjacent organs at the boundary. This Neuman boundary condition is n.DVm = 0 [3]. Its equivalent matrix form is then given as [117]: ( where Mij =
 

C C M + K )V m+1 = MV m + l t t


(3.34)

i j , Kij =

i · ( j )d3 x, li = -



(I (vol) + Iion (u, V m ))i d3 x +

I (surf ) i dS , and i s are basis functions of the subspace. The matrix form for bidomain model

and different possible boundary conditions are given for the two variable cell model in [117].

3.5.4

Software Packages to Implement FEM for Cardiac Models

As an initial step, in this dissertation, the discretized equations shown in previous subsection were solved in 2D on a slice of a pig heart through implementation of FEM steps in Matlab. The slice and the mesh generation steps are shown in Figure 3.7. The triangular elements are used for this mesh. Initial samples of the FEM implementation on this mesh were encouraging in the sense that we could observe action potential generation and its 66

Pig MRI Image

Extracted Domain

Coarse Mesh

First Refinement

Second Refinement

Final Mesh

Figure 3.7: Mesh generation and refinement propagation as well as the repolarization of the tissue. The model implemented on this mesh was a combination of a continuously firing pace maker cell modeled by the Fitzhugh Nagumo model and Aliev-Panfilov model for the excitable tissue. The initial samples of the implementation are shown in Figure 3.8. This implementation of FEM for electrophysiological heart models is a basic implementation of FEM steps, while FEM is a complex mathematical method. However, there are many mathematical FEM software packages that consider the mathematical complexity of implementing FEM in a professional way. One of the most widely used packages is COMSOL. It has been applied in various fields of engineering [72, 118], as it is modular and user friendly, making the implementation of various scenarios easier. It also has powerful 3D visualization features and the arbitrary

67

geometry can be imported into the software in Computer Aided Design (CAD) format. It is also possible to export the simulation results to Matlab for further processing. There are also proprietary cardiac modeling software developed by various research groups for the purpose of cardiac modeling; however, these models are either not openly available or require some extra coding to be customized for various scenarios. One such example includes Chaste (available for download by Oxford group), though it needs coding for various scenarios and is implemented on Oxford Rabbit structure. It has an interface with CellML. Others examples are CMISS, and CARP [119]. For these reasons we use COMSOL for FEM analysis of the cardiac models in this dissertation. An initial work on studying action potential propagation using COMSOL in 3D was done by Filippi and Cherubini [118]. In their work, however, they extracted the geometry of the heart from a stack of MRI images, and the fibre structure was not used. Further, Aliev-Panfilov arrhythmia patterns were only reproduced in a 2D sample [118]. Figure 3.9 shows a screenshot of COMSOL environment. In summary, this chapter reviewed background methodologies for the construction and implementation of electrophysiological models. The next chapter will explain the data collection procedure in our experiments as well as the steps taken for the creation of CDI model and the simulation scenarios.

68

Excitation point

1

2

3

4

5

6

7

Figure 3.8: Initial Model output samples obtained by Matlab implementation of FEM

69

Figure 3.9: COMSOL GUI

70

Chapter 4 CDI Modeling Using Real World Data

T

HIS chapter describes the experimental data collection steps and required logistics, as well as customization of the Langendorf setup to become MRI adaptable and mobile for our

experiments. It then reviews the CDI method improvement in terms of reliability and noise reduction by introducing a reliability measure and deriving the noise distribution in current density maps. Next, it describes the implementation of Aliev-Panfilov model in 2D and 3D in COMSOL and sensitivity analysis of the model parameters. Finally, it describes the construction of the CDI model based on the Aliev-Panfilov model by time averaging the diffusive current in the electrophysiological model and the introduction and implementation of monodomain and bidomain CDI model simulation scenarios designed to match the experimental conditions.

4.1
4.1.1

Database
CDI Database

Current Injection Circuit: The CDI experiments were conducted in GE MRI machines at imaging facility in Toronto General Hospital (TGH). As per CDI protocol earlier mentioned in chapter 2, a current pulse synchronized with MRI trigger pulse should be generated and injected into the subject. The circuitry needed for the current injection in the CDI protocol was designed in house using an Arduino board. The circuit should generate the two phase cycle currents, Phase Cycle one (PC1) and Phase Cycle two (PC2) with a small delay after the 90 degree pulse in Spin-Echo sequence. Adjustment of the delays, duration, and polarity were done through a laptop by changing 71

Power

Trigger Circuit GE Circuit MRI Trigger

PC1 GND PC2 To amplifier

(a)

(b)

Figure 4.1: a) Block diagram of GE circuit, and b) Picture of the GE circuit parameters in the Arduino code using a USB connection. The MRI trigger was provided by the machine, which was used as an input to the circuit to generate and synchronize the current pulses. The block diagram of the GE circuit (current injection circuit designed to work with GE MRI machine) and an image of the circuit are shown in Figure 4.1. An auto-trigger circuit was added enabling us to test the current pulses and perform fine tuning in the absence of an MRI-generated trigger. The circuit had to be sensitive enough to pick up pulse widths in microseconds. This was achieved by designing circuits in-house at ryerson university. The current pulses generated by these circuits were then amplified using an adjustable HP Harrison 6824A power supply-amplifier, which supports a maximum peak-to-peak voltage of 50V for currents up to 1A. The current amplitudes were kept constant and measured as a voltage across a 10  resistor in series with the amplifier's output. Imaging Phantom: In order to fine tune the equipment and software designed for the CDI imaging, two cylindrical Plexiglass phantoms were built. The phantoms were filled by a CuSO4 NaCl solution with T2 =170ms and T1 =200ms [81]. Two plates of copper were attached to both the

72

Figure 4.2: a) The cylindrical phantom, b) Magnitude image for one slice. top and base of the phantom to act as electrodes. In the second phantom, two plexiglass bars were added to aid us in keeping track of the orientations. The cross section of this phantom is shown in Figure 4.2. These two phantoms were used throughout all phantom experiments in this dissertation

Along with fine-tuning experiments, we collected data from 15 experiments on phantom and heart (dead and ex-vivo). A list of these experiments and the injected currents are presented in Appendix D. Three different types of electrodes made of brass, silver, and copper were compared in terms of the distortion they generated in CDI images using imaging phantoms as expected. It was concluded that copper had the best performance, as it is expected because it has closest magnetic susceptibility to water when compared with brass and silver [120,121]. After fixing issues with the new setup and implementing multislice acquisition in the current injection circuit, the initial exvivo heart experiments were performed. To perform ex-vivo heart experiments in a GE machine, two other sets of electrodes were added to the setup with the help of experts at TGH: one for recording ECG to help us determine the state of the heart, and the other for stimulation to either induce VF condition or break the VF. Figure 4.3 shows samples of the recorded ECGs for VF and

73

Normal Sinus (NS) states. It can be seen that the regular depolarization and repolarization patterns are recorded in NS state and the chaotic electrical activity was recorded for the VF state. The porcine hearts were extracted under deep anaesthesia by physicians in an operating room based on an approved Animal Use Protocol (AUP) from TGH. The harvested hearts were then preserved in perfusate at 4 degrees centigrade and quickly transformed to VF lab to be cannulated and fitted on the mobile Langendorf setup. Aortic cannulation is used for all ex-vivo experiments. The whole process was time sensitive as the time between harvesting the heart and hooking it on Langendorf setup affected the success of the experiment. This is because as the time passes, the chances of the heart beating on Langendorf setup reduces. The MRI acquisition parameters used for ex-vivo pig experiments are provided in Table 4.1. Table 4.1: MRI acquisition parameters for ex-vivo CDI experiments Parameter Value TR 700ms TE 40ms Tc 16ms Slice thickness and spacing 7mm NEX (No of Excitations) 3 FOV (Field of View) 15cm

The timeline for ex-vivo beating heart experiments starting from heart extraction in the operation room to the end of imaging process in the imaging facility is shown in Figure 4.4.

4.1.2

DTI Database

The raw data images were obtained for each direction for each slice. These images were loaded into 3D Slicer that detected the number of directions, slices, b value, and b table from the DICOM tags and assembled them to a volumetric DWI image in Nrrd (Nearly raw raster data) format. This image was subsequently used to reconstruct colour-coded DTI images by following the reconstruction steps from 3D Slicer documentation. In order to verify the colour-coding scheme and obtain diffusion tensors, the DWI Nrrd file was read in Matlab. This provided the six elements of the 74

Sample VF ECG from our experiments

Sample NS ECG from our experiments

Figure 4.3: Sample recorded ECGs for VF and NS states.

75

Heart extracted in Operation room

15-20 min

30-45 min
Heart is delivered to VF lab

Heart is cannulated, fitted to langendorf setup and electrodes attached, left to beat for a while

15-20 min

45-90 min
CDI protocol is executed for 6 slice multislice sequence and 2 orientations Heart and electronic equipment are ready for imaging

10 min
Heart is transported to the MRI facility as it beats

35 min

DTI protocol is executed

Total timeline is 2.5 hrs to 4 hrs

Figure 4.4: Timeline of ex-vivo experiment.

76

DTI Reconstruction in Matlab

DTI Reconstruction in 3DSlicer

Figure 4.5: DTI reconstruction in Matlab and 3DSlicer. Colours red (up-down) ,green (left-right), and blue (perpendicular to the page) colours represent the three perpendicular directions diffusion tensor for each voxel. Next, as fibre direction is the direction of the main eigen vector of the diffusion tensor, the main eigen vectors were calculated and colour coded using absolute value colour coding scheme. The reconstructed DTI images in Matlab matched the reconstructed DTIs in 3D Slicer (Figure 4.5). In this figure, the red colour represents up-down direction, green represents left-right direction and blue represents the direction perpendicular to the page. To further verify DTI results, reconstruction was carried out in DTIStudio software [122], matching the results from the 3D Slicer (Figure 4.6). The values of diffusion coefficients calculated were matched by the values reported for DTI of cardiac tissue in the literature [123, 124]. In another work, we compared the DTI results with CDI results in a dead pig heart for the first time. The results matched the widely accepted theory that electrical current follows the fibre path [74]. The acquisition parameters used to obtain DTI images of the pig hearts are 30 directions, NEX=6, slice spacing and thickness of 7 mm, and b=1000 s/mm2 .

77

DTI Reconstruction in 3DSlicer

DTI Reconstruction in DSIStudio

Figure 4.6: DTI reconstruction in 3D Slicer and DTIStudio, the directional color coding is same as Figure 4.5

78

4.2

Mobile Langendorf

The Langendorf setups are designed as fixed structures in research labs. For our CDI experiments, we needed a mobile, MRI-compatible Langendorf setup to move the heart from the cannulation room to the MRI room as well as place and hold the heart in the MRI machine. We made this mobile Langendorf setup from scratch. Around the same time as we were making this Langendorf setup a British group also made a Langendorf setup for Ex-vivo cardiac studies in the MRI [125]; however, our Langendorf setup differs from theirs in that our design was motivated by a mobile setup to transport the beating heart from the VF lab to the MRI room. Our setup is equipped with a UPS that makes the setup mobile and allows the heating and circulation pump to run on UPS for the 15 to 20 minutes necessary to transport the perfused heart from the VF lab to the imaging facility. Furthermore, we do not use the heat jacket, rather rely on a coiled tube of warm, distilled water immersed in the reservoir to warm up the perfusate. Our system also is a combination of constant pressure and constant flow system with a backflow path to the bucket controlled by a pressure relief valve set at 2 PSI. For CDI experiments we designed two acrylic boxes to ensure the heart did not deform and perpendicular positions of the heart were maintained. The smaller box which can rotate 90 degrees, holds the heart in place while letting the flow pass through it, while the larger box has openings for the electrodes and inlets and outlets for the perfusate. We also added a second, small-size bubble trap inside the large box to remove any bubble that might form as we connect the cannulated heart with the perfusate flow in the larger box. Figure 4.7 shows a schematic diagram of our mobile Langendorf setup. Figure 4.8 shows the acrylic phantom designed to hold the heart in the MRI bore and Figure 4.9 is a picture of the system. The perfusate used in our experiments was Krebs-Henseleit buffer (118 mM NaCl, 4.7 mM KCl, 1.2 mM MgSO4 , 1.2 mM KH2 PO4 , 24.0 mM NaHCO3 , 1.8 mM CaCl2 , and 11.1 mM glucose) [8].

79

Reservoir

Figure 4.7: Schematic of mobile Langendorf setup

80

Figure 4.8: Acrylic Boxes

81

Cannulated Heart

Carbogen Tank

Relief Valve

ECG Electrodes

Flow Adjusting Valve Current Injection Electrodes Circulation Pump

a
MRI Bore

Stimulation/Pacing Electrodes

b

Cannulae and Electrodes Small Box (Holding Heart)

ECG/Defibrillation Pads Large Acrylic Box

c

d

Figure 4.9: a) The reservoir b) Cannulated heart c) Acrylic boxes d) Positioning the heart and boxes in MRI bore

82

4.3

Improvements to CDI implementation

In this section some post processing improvements and new findings regarding CDI method are presented.

4.3.1

A reliability measure

As mentioned before CDI is very sensitive to rotation mismatch and deformation. A reliability measure based on Gauss's law for magnetism was suggested and its performance and the improvements gained by registration were investigated in the phantom and dead pig heart [77]. Based on Gauss's law for magnetic field we have: ·B =0 (4.1)

Where B is magnetic field and · represents divergence. Whenever the main component of the current density is in the z direction (the current is injected in direction z ) the z component of the magnetic field is either not present or small enough that it can be ignored. In this case, the above equation can be expanded as: Bx By + =0 x y Therefore the current density measured at a point was deemed reliable if threshold r : Bx By + <r x y constant k and was defined as: ¯x | + |B ¯y |) r = k (|B (4.4) (4.3)
Bx x

(4.2) +
By y

was less than

the threshold r was defined based on magnitude of the magnetic field and an experimentally chosen

¯ · represents the average. The constant k is chosen so that the reliability measure satisfied the inequality for 95 % of points without any rotation mismatch. For phantom experiment, this value was set at 10. The reliability metric was defined as: nA 100nB 83 (4.5)

while nA was the number of points satisfying the inequality and nB was the total number of points in the combined mask of CDI [77]. The results in [77] show that the metric is able to reflect the degradation caused by mismatches and the improvements gained by intensity based image registration. In general, it was observed that the metric could be high while the results were not reliable, which means that if the results were more reliable, the metric value would be higher. The reverse did not generally hold and high metric value was therefore not necessary and sufficient condition for reliability. However, the metric can be used to measure reliability in cases where unreliability is caused only by rotation mismatches and not by other factors such as deformation or noise. The results of the reliability metric performance on a phantom are provided in Appendix B.

4.3.2

Quantifying current injection effect on noise level in CDI

Another factor that could cause an unreliable CDI result is noise. In the literature, the connection between the CDI MRI acquisition parameters and noise are studied by Scott et al. [79]. A denoising method based on ramp-preserving Perona-Malik denoising is also presented by Lee et al. [126]. Perona-Malik method is an edge-preserving, iterative smoothing technique [98]. SNR in magnitude MRI images has been assumed to have Gaussian distribution [79] and SNR measures have been developed by Firbank et al. [127]. We performed noise analysis experiments on phantom and pig heart and studied the contribution of current injection to the level of noise [76]. In this work, a baseline analysis method was suggested, which adds the phase changes from two phase cycles instead of subtracting them. This way, the calculated magnetic field was due to the effect of noise and is called hypothesized baseline. This baseline was calculated using phase cycles in the presence of current injection and therefore reflects any noise effect contributed by current injection. In conjunction with a regular baseline, this hypothesized baseline, was used to calculate the current density contributed by noise. To analyze the results, a fluctuation measure f was introduced. The measure was defined by calculating the deviation from a second order 2D polynomial surface s fitted to the calculated current density J . The measure was defined as follows: f= 1 n-1 (J (x, y ) - s(x, y ))2
(x,y )M

(4.6)

84

where M is the mask, and n is the number of points in the mask. The results supported the fact that the current injection does not contribute to more fluctuations, and current injection henceforth has no effect on the noise.

4.3.3

Noise distribution in CDI images and their denoising

In order to counter the noise in CDI images more efficiently, we need to characterize the CDI noise distribution. In another study by our group, the distribution of noise in the phase images was calculated and the distribution of noise in the final CDI images was approximated [75]. The closed form of noise distribution for the phase-wrapped images was proved in [75], the proof of which is provided in Appendix A. The phase distribution for a point inside the subject is proved to be [75]:

e-  2 f () =  2

(s2 +r 2 )

  2 c  c22 c [ + e 4 [1 - erf (-  )]] 2 4 2 

while

-     .

(4.7)

Where erf is Gaussian error function, r and s are uncorrupted real and imaginary values at the point,  is the argument of xR + ixI while xR is the random variable representing noisy intensity in real image (refer to Appendix A) and xI is the random variable representing noisy intensity in  imaginary image (refer to Appendix A),  = 2 while  is standard deviation of noise in the background, and c = 2s cos() + 2r sin(). Although this distribution looks complex, if we take a look at some sample distributions for various values of r, s and  arbitrarily chosen in the observed ranges for these parameters, we can see that they look very close to a Gaussian. It is shown that the mean of these distributions depend on r and s while the variance depends on r, s, and  . In order to quantify the Gaussianness of these distributions, two measures, called Kurtosis and Skewness, are used [128]. For a Gaussian distribution Skewness is zero and Kurtosis is three while the excess Kurtosis is zero [129]. To decide which distribution is Gaussian or close to Gaussian, these measures should be calculated for the distribution; however, there is no common threshold set in the literature. Therefore, a Gaussianity classifier developed by D'Agostino was used to classify the distributions as Gaussian or non Gaussian [128]. This classifier performs based on Kurtosis 85

and Skewness measures using a significance level that is usually set to 0.01 through a complex multi-step algorithm. These phase distributions can be safely approximated as Gaussian [75]. The distribution of current density at each point can also be approximated as Gaussian [75]. The theoretical results were then corroborated by experimental data [75]. The fact that the distribution of current density at each point is Gaussian was used to efficiently denoise current density maps. For this purpose, a Block Matching 3D (BM3D) method, which was originally designed to suppress Gaussian noise, was used [99]. BM3D is shown to outperform other commonly used denoising techniques in the presence of Gaussian noise [99]. The performance of two other denoising methods, Adaptive Wiener [97] and Perona-Malik (which was already used for current density images in the literature) were compared with BM3D on phantom data [75]. The methods were applied at two different stages of CDI protocol; once on initial real and imaginary images, and once on the calculated current density. It was expected that BM3D would be superior to the other two methods as the Perona-Malik method only divides image patterns to edge and non-edge while BM3D divides the image into a set of various patterns. Further, BM3D uses noise statistics while Perona-Malik does not. In comparison with Adaptive Wiener, BM3D should also perform better, because it uses the image patterns and redundancy in the image, while Adaptive Wiener does not. For both Adaptive Weiner and BM3D, the noise statistics are used. The results of error comparisons are shown in the form of box plots for two phantom datasets with different injected currents (Dataset 1 20mA and Dataset 2 45mA) in Figures 4.10 and 4.11. In all box plots in this dissertation, the whiskers represent the maximum and minimum of non-outlier data. The red line represents the median and the blue box represents 75th percentile. The red plus symbols are used to show outliers, and error measure used is the Sum of Squared Error (SSEs). Each box plot contains data from 5 slices for Dataset 1 and 6 slices for Dataset 2. The errors are normalized by the amplitude of injected current. The results of BM3D are compared with the best Adaptive Wiener result obtainable. For Dataset 1, these were obtained using block size 3 and for Dataset 2, the best block size was 5. For Perona-Malik method, the best iteration number was 10 for dataset 1 and 6 for dataset 2.

86

Box plot of Normalized SSE for different scenarios 120

100

80
Normalized SSE

60

40

20

0
on I-R r ne ie 5 5x on I-R B 3D M on I-R B 3D M on J 10 r= ite on J r ne ie 5 5x on J sy oi C n re ur t

P

M

ite

r=

10

W

P

M

W

N

Figure 4.10: Box-plot of Normalized SSEs for different scenarios applied to Dataset 1. As expected, we can see that BM3D outperforms the other two methods for both experiments and also performs better when applied on current density maps (J ). Figures 4.12 and 4.13 compare noise suppression gain obtained by BM3D with that of Weiner and PM methods for Dataset 1 and Dataset 2 respectively.

87

Box plot of Normalized SSE for different scenarios

30

25
Normalized SSE

20

15

10

5

0
on I-R r ne ie 3 3x on I-R B 3D M on I-R B 3D M on J 6 r= ite on J r ne ie 3 3x on J sy oi C n re ur t

P

M

ite

6 r=

P

M

W

W

N

Figure 4.11: Box-plot of Normalized SSEs for different scenarios applied to Dataset 2.

Noise power suppression using BM3D on I-R for set 1 7

6

dB per pixel

5

4

3

2

B

D M3

i ga

rW ve no

-R nI ro e ien 3D in ga

er ov

PM

on

I-R

BM

Figure 4.12: Box-plot of BM3D noise suppression for Dataset 1.

88

Noise power suppression using BM3D on I-R for set 2 9.5 9 8.5

dB per pixel

8 7.5 7 6.5 6

B

D M3

i ga

rW ve no

-R nI 3o x 3 er ien D M3 in ga

P er ov

M

i

-R nI 6o = ter

B

Figure 4.13: Box-plot of BM3D noise suppression for Dataset 2.

4.4

Constructing CDI Model

As explained in Chapter 3, the electrophysiological model used in this dissertation was AlievPanfilov model. The mathematical formula explaining the model, as well as 2D and 3D simulations, are shown in this section.

4.4.1

Implementation of 2D Model in COMSOL

The formula for the monodomain Aliev-Panfilov model is as follows [3, 104]: V =  · (DV ) - kV (V - a)(V - 1) - uV t u µ1 u =( + )(-u - kV (V - b - 1)) t µ2 + V

(4.8) (4.9)

where V is dimensionless activation (transmembrane voltage), u is dimensionless recovery variable, t is scaled simulation time, D is (in general) the diffusion tensor representing the anisotropic tissue structure and conductivity that we extract from DTI images. In this thesis, whenever variable "V " is mentioned, we are referring to the dimensionless V , unless otherwise stated. As briefly 89

mentioned in Chapter 2, isotropy means homogeneous, constant conductivity (scalar diffusion diso instead of D) in all directions represented by a constant scalar, while anisotropy represents conductivities with various values and directionality over the 3D space represented by a tensor (D), which is the real structural condition in the heart. The other parameters of the model are chosen from the literature for normal condition. These values are 0.01, 8, 0.2, 0.1, 0.07 and 0.3 for , k, a, b, µ1 and µ2 respectively for normal condition [100, 104, 130]. These parameters in a simplified model like Aliev-Panfilov do not have direct electrophysiological association and their collective choice affect the shape of action potential. To convert the activation variable V (which is dimensionless) to mV and also convert scaled simulation time t to ms, the following formula can be used [101]:

t[ms] = 12.9 × t[dimensionless] V [mV] = 100 × V [dimensionless] - 80

(4.10) (4.11)

In the presence of an external current injection, Equation 4.9 should be replaced with the following equation [104]: V =  · (DV ) - kV (V - a)(V - 1) - V u + Is t (4.12)

in which Is is the external current normalized by membrane capacitance. The Aliev-Panfilov model is mathematically studied in the literature [100, 130]. As mentioned in Chapter 3, the equations were defined in COMSOL software and parameters were defined. To excite the model, an initial value of one was chosen for V and zero for u [130]. A sample of activation V results for a 2D circular domain excited at the centre combining FHN model and Aliev-Panfilov model are shown for isotropic and an anisotropic cases in Figure 4.14. This figure shows that, in an isotropic domain the activation uniformly diffuses in all directions, while in an anisotropic domain with higher diffusion coefficient in a single direction shows more diffusion in that direction. Figure 4.15 shows the implementation of Aliev-Panfilov model on an isotropic square domain with a sinusoidal excitation for Is on lower left corner and parameters used for this simulation were = 0.002, k = 8, diso = 0.0001 except in the source, in which it is 0.1 µ1 = 0.2, µ2 = 0.3, b = 0.15, a = 0.01. The figure shows bands of activations originating from sinusoidal source.

90

(a) isotropic

(b) anisotropic

Figure 4.14: 2D Sample activation maps a)isotropic b)anisotropic

4.4.2

Sensitivity analysis of model parameters in 2D

To get a sense of how changes in the parameters affect activation and recovery, each parameter was swept while keeping the others constant for the scenario and geometry in Figure 4.15 with diso default value equal to 1. The sinusoidal source at the lower-left corner of Figure 4.15 has a period of 20 dimensionless time units (t). The activation and recovery variables recorded by a probe at point (0,0) are shown in Figures 4.16 and 4.17. In these figures, the green colour represents recovery variable (u) while blue colour represents activation variable (V ). In these figures, the horizontal axis represents the number of equally distributed points, which is equal to ten times the dimensionless time unit (t)(10 points are equal to 1 time unit). Figure 4.16 a shows that, as a increases, the frequency of activation does not change, though its duration slightly shrinks. In Figure 4.16, results for each parameter value takes 1000 unit on x axis. Figure 4.16 b shows parametric sweep simulation results for values of b equal to 0, 0.05, 0.1, and 0.15 each run for 1000 points on the x axis from left to right, respectively. As b increases, it is evident that the frequency 91

(a) t =94.3

(b) t =100

Figure 4.15: Activation in a square isotropic domain excited by a sinusoidal source for two time instances

92

Table 4.2: Parameter sweep analysis for Aliev-Panfilov model Increase in Parameter Observation a Activation duration slightly shrinks b Activation duration shrinks, and frequency increases. The Amplitude of recovery increases and its duration shrinks. k Frequency of activation and amplitude of recovery increases. Amplitude of activation and recovery decreases as their shapes become closer to sinusoid. µ1 Restitution (duration of active to rest) decreases and frequency increases. µ2 Restitution increases and frequency decreases. diso Activation starts earlier

of activation increases and its duration is reduced. Figure 4.16 c shows results for smaller k values compared to the normal value used in Figure 4.15. Here, as k reduces, the frequency and amplitude of activation and recovery are reduced. Figure 4.17 a shows that, as increases, the shape of

activation and recovery are affected and their amplitude decreases considerably. Figure 4.17 b shows simulation results for a parametric sweep of µ1 for three values, each for 1000 points on the x axis. It can be seen that this sweep affects both restitution (active duration to rest duration ratio) and frequency. Figure 4.17 c shows simulation results for a parametric sweep of µ2 for three values, each for 1000 points on the x axis. From this we can see that both restitution and frequency are affected, though, in the reverse order when compared to µ1 . Finally, Figure 4.17 d shows the parametric sweep results for diso . In this figure, results for each parameter are shown for 200 points on x axis. Here, as diso increases, the activation takes place faster and its duration is reduced, which is expected as it determines the speed of propagation. The parameter-sweeping simulation results are summarized in Table 4.2. Figure 4.18 shows how adding a blocked region that can not be activated affects the propagation. It can be seen that the activation front turns around this region. The dead tissues can then be modeled as an area that never can be activated. 93

(a) Parameter sweep for a=0.005,0.01,0.015 from left to right respectively for each 1000 points on x axis

(b) Parameter sweep for b=0,0.05,0.1,0.15 from left to right respectively for each 1000 points on x axis

(c) Parameter sweep for k =2,4,6,8 from left to right respectively for each 1000 points on x axis

Figure 4.16: Activation (blue) and Recovery (green) variables for a, b, and k Parameter sweeps as other parameters are kept constant in the scenario implemented in Figure 4.15. The probe is at point (0,0).

94

(a) Parameter sweep for =0.002,0.152,0.302,0.455 from left to right respectively for each 1000 points on x axis

(b) Parameter sweep for µ1 =0.1,0.15,0.2 from left to right respectively for each 1000 points on x axis

(c) Parameter sweep for µ2 =0.3,0.8,1.3 from left to right respectively for each 1000 points on x axis

(d) Parameter sweep for diso =0.0001,1,10 from left to right respectively for each 200 points on x axis

Figure 4.17: Activation (blue) and Recovery (green) variables for , µ1 , µ2 , diso Parameter sweeps as other parameters are kept constant in the scenario implemented in Figure 4.15. The probe is at point (0,0).

95

Figure 4.18: An unexcitable obstacle in the way of propagation Figure 4.19 shows reproduction of reentrant patterns in COMSOL based on the model parameters and the procedure provided by Harada et al. [130]. The colour bars show the value of variable V . Parts a and b show the initiation and progression of an activation front and part c shows activation suppressed in the upper half. Part d shows the activation entering the blocked region after the block is removed. The activation entering the upper part and propagate backward and comes behind the activation front to form reentry which is shown in part e. Lastly, part f shows the reentrant patterns taking over the whole domain.

4.4.3

3D Model in COMSOL

After obtaining initial results in 2D and matching them with the literature, the model was upgraded to 3D using 3D heart geometry and diffusion and fibre structure from DTI images. The tensor elements D11 , D12 , D13 , D22 , D23 , D33 are shown for a slice in pig heart in Figures 4.20 a through f, respectively. The diffusion coefficient maps are in mm2 /s and match the ranges reported in the

96

(a)

(b)

(c)

(d)

(e)

(f)

Figure 4.19: Reproduction of reentrant pattern in COMSOL, the color bar displays values of V

97

literature [123, 124]. Figure 4.21 shows the 3D Computer Aided Design (CAD) geometry imported in COMSOL. The CAD volume is made in Matlab, modifying the package provided by Hart [131] for our data. Figure 4.22 shows the transparent view of the 3D geometry showing two small cubic region at the top and bottom, which represent the electrodes in the CDI modeling simulations. The small sphere represents the initial excitation region, which was chosen to be close to the SA node. The larger cubic region is used to implement the temporary blocking condition in the model for reentrant and VF simulations. Figure 4.23 shows the dimensionless current pulse injected in the CDI modeling simulations, which was chosen to be square to mimic CDI current pulses. The unit conversion for the model is explained in Appendix C.

4.5

Monodomain Simulation Scenarios

Three different heart structures obtained from three pig hearts through DTI imaging were used, for which the Aliev-Panfilov-based CDI model is implemented in order to show structure independence of the results. These heart structures are referred to as HS1, HS2, and HS3. CDI data was also obtained from these ex-vivo hearts in various electrophysiological states. In all hearts, the CDI electrode positions were obtained from corresponding CDI data. For each of these three heart structures, the geometry, excitation point, boundary condition, and fibre structure were defined and four different electrophysiological states were simulated. These states were: · Normal Sinus (NS): The small sphere (in the Figure 4.22) is excited and there is no block. · Asystole (AS): There is no initial excitation at the small sphere. In the Asystole condition there is minimal electrical activity in the heart, though the cells are still excitable and not dead. · Reentrant (R): In this scenario the normal propagation of action potential is blocked in the larger cubic block in Figure 4.22 [130]. · VF : This condition is the same as, the R scenario, only after the block is removed, the value of parameter a in the model is reduced to 0.01 [130]. 98

(a)

(b)

(c)

(d)

(e)

(f)

Figure 4.20: Diffusion Coefficients in a slice of pig heart extracted from DTI a through f represent D11 , D12 , D13 , D22 , D23 , and D33 respectively. The values are in mm2 /s

99

Figure 4.21: The CAD geometry made out of DTI images

Initial excitation point close to SA node

Current injection electrodes

Temporarily Blocked Region

Figure 4.22: Transparent view of the geometry in Figure 4.21

100

Figure 4.23: Injected current pulse in CDI simulations The diffusive current densities are calculated as DV (refer to equation 4.12). However, in CDI, the time-averaged current density during acquisition time is produced. Thus, to calculate the simulated CDI current densities, the diffusive current density is averaged over 105 time units. The number of elements for the HS1 to HS3 are 10556, 3256, and 4228. The number of elements depends on the size of the heart and smoothness of the surface. In order to have consistent comparisons for all monodomain models, general physics calibrated predefined normal meshes are used in COMSOL. These predefined meshes have the same element size parameters (maximum element size, minimum element size, resolution of narrow regions, resolution of curvatures, and maximum element growth rates). To investigate the effect of mesh refinement on the results, however, the activation maps must be compared for HS3 in isotropic monodomain Normal sinus scenario with no current injection using coarse mesh (4228 elements) and refined mesh (10716). These results are shown in Figure 4.24 for time instances of t=82 in coarse mesh and t=90 in refined mesh. We observed that more refinement makes the results smoother and generates approximately an eight time unit delay in the front propagation, though the pattern of propagation was otherwise not affected. The correlation values of the activation between refined and coarse meshes respectively at

101

50

50

100

100

150

150

200

200

250 50 100 150 200 250

250 50 100 150 200 250

(a) coarse,t=82

(b) refined,t=90

Figure 4.24: Mesh refinement effect. The red areas are activated and blue areas are at rest times t=90 and t=82 is more than 0.97, while this correlation for the same time instances t=90 is 0.8. The models in this dissertation are run for 105 dimensionless time units, which is approximately equal to the duration of one normal heartbeat. For the monodomain model, it takes almost eight hours to finish one simulation of 105 time units. To study the effect of the anisotropy of the tissue, current injection and various cardiac states on the current density maps, eleven scenarios were implemented. The isotropic scenario was modelled using a scalar value in the range of diffusion values instead of the real diffusion tensor, while in anisotropic scenario the real diffusion tensor was used. The scenarios are named alphabetically. Scenarios A to E are for isotropic domain, while scenarios F to K are for anisotropic domain: · A) Current injected in AS state: The external current pulse shown in Figure 4.23 was injected through the electrodes and the small sphere region was not excited. This was a state in which the heart did not beat but the cells were still excitable and not completely dead. This scenario can be assumed to be close to Asystole state in the CDI experiments. In this scenario, the domain was assumed to be isotropic. 102

· B) Current injected in NS state: The external current was injected through electrodes and the small sphere region was excited. The initial excitation diffuses to adjacent regions and activates the cells as in normal heart. This scenario can be assumed as a simulation of Normal Sinus (NS) state in CDI experiments. The domain was assumed to be isotropic. · C) Current injected in R state: The external current was injected while reentrant waves were created by temporarily blocking excitation in large cube as normal sinus excitation was propagating through the domain. The blocking was modeled between dimensionless time units 60 and 65. This state modeled reentrant excitation pattern (i.e. activation maps) have been observed on the heart's surface in various cardiac arrhythmia. The domain was assumed to be isotropic. · D) No current injected in NS state: This scenario was basically the same as scenario B, only this time, the external current was not injected and electrodes were removed. In this scenario, the domain was assumed to be isotropic. · E) No current injected in R state: This scenario was the same as scenario C, only this time the external current was not injected and electrodes were removed. The domain was assumed to be isotropic. · Scenarios F to J : These scenarios were the same as scenarios A through E respectively, only the domain was considered to be anisotropic and the real fiber structure (the tensor) was used instead of a scalar constant diffusion coefficient. This was considered to investigate the effect of the introduced anisotropy on the excitation variable (V ) and averaged diffusive current density. · K) current injected in Ventricular Fibrillation state: In this scenario the external current injected and the state of the heart was Ventricular Fibrillation (VF), which was generated as explained in section 5. The domain was considered to be anisotropic. This scenario was added to compare the model results with VF experimental CDI results. The results of the simulations are provided in the next chapter. 103

Table 4.3: Label reference for Simulation scenarios Label Current Injection A yes B yes C yes D no E no F yes G yes H yes I no J no K yes Tissue State Isotropic AS Isotropic NS Isotropic R Isotropic NS Isotropic R Anisotropic AS Anisotropic NS Anisotropic R Anisotropic NS Anisotropic R Anisotropic VF

For ease of reference, these scenarios are summarized in Table 4.3.

4.6

Bidomain Simulation Scenarios

In the monodomain model, the tissue is assumed to be a continuous medium. Conversely, in the bidomain model, the tissue is divided into two sections, intracellular and extracellular, which is biophysically more realistic. The diffusion tensors obtained by DTI are not separable into intracellular and extracellular and it is thus a bulk measurement of the diffusivity. Therefore, in bidomain models the fibre structure obtained from DTI is used to find the fibre direction and some assumptions are made for the conductivity values along the fibre (f), perpendicular to the fiber inside the sheet (s) and perpendicular to both sheet and fibre direction (n) for both intracellular and extracellular sections D = D1 ffT + D2 ssT + D3 nnT [109, 132, 133]. However, the substitution of synthetic diffusion coefficients from the literature will have adverse effect on the results. This is unavoidable, as DTI provides us the bulk diffusion coefficients and is unable to provide exact intracellular diffusion coefficients for an individual heart structure. Using the Aliev-Panfilov model, the bidomain model is mathematically defined as [133]:

104

 · (Di + De )e = - · (Di Vm )
m  · Di (Vm + e ) = ( V + kVm (Vm - a)(Vm - 1) + uVm + Iext ) t

(4.13)

u t

=( +

µ1 u )(-u µ2 +Vm

- kVm (Vm - b - 1))

The conductivity values for the bidomain model were obtained from [109] and converted to the diffusion values using equation 3.7. The diffusive currents in the case of bidomain simulations are calculated using e and extracellular conductivity tensor De . The bidomain simulation scenarios are the same as the monodomain, except that the mesh is refined in order to obtain convergence and the number of elements for models 1 to 3 are respectively 39964, 24746, and 39513. One simulation scenario in this case takes around three days on a desktop computer. The COMSOL direct solvers used for both monodomain and bidomain models have a complexity and memory requirement which depends on the problem. The computational complexity and memory requirements are of orders between O(n2 ) and O(n3 ), where n is the degree of freedom for the FEM problem (number of unknowns to be solved multiplied by number of nodes) [134]. This chapter explained the logistics required for the CDI experiments, the CDI and DTI data collection processes, and some improvements in CDI implementation in terms of reliability and denoising. It also explained the generation of monodomain and bidomain CDI models, the simulation scenarios and the parameters selected. In the next chapter, the simulation results are provided and discussed in more detail.

105

Chapter 5 Results and Discussion

I

N this chapter, the monodomain and bidomain CDI model results are presented and compared with real CDI measurements and subsequently analyzed. The effect of anisotropy on activation

and diffusive current density are compared in different cardiac states using monodomain AlievPanfilov model. Next, the range of variations in simulated current density maps and the pairwise correlation of simulated current density maps are calculated and analyzed using monodomain and bidomain models to investigate differences in the diffusive current density caused by a change in cardiac state. The simulated current density maps are then corroborated with CDI experimental data.

5.1

Monodomain CDI Model Results

The simulation Scenarios A to K explained in chapter 4 are implemented in three different heart structures (HS1 to HS3) to show that the simulation results are independent of heart structure. Due to the complexity of the experiments and considerable preparation and coordination time and effort required for each experiment, however, only three sets of compatible CDI and DTI data are available. This makes the calculation of a confidence interval for the comparisons of simulated CDI in various states irrelevant. The activation variable V represents scaled transmembrane potential and the activation values around zero represent areas at rest while values around 1 represent fully excited cells. The diffusive propagation of electrical activity is observed in 3D for the simulation scenarios. Figure 5.1 shows 106

these progressions over time for variable V in Scenarios C and H using the monodomain model. C and H scenarios both model the reentrant state in the presence of current injection, where C is for isotropic domain and H is for anisotropic domain. Thus, this figure depicts the effect of anisotropy on the activation variable. Subfigures a), c), e), and g) show time progression of activation variable for time instance t=60, 65, 85, and 105 respectively for Scenario C (isotropic) while Subfigures b), d), f), and h) show time progression of activation variable for time instance t=60, 65, 85, and 105, respectively, for Scenario H (anisotropic). The results are shown in a slice at the middle of the heart slab in HS1 for four different critical time steps: t=60, right before introduction of the electrical block in the large cubic region; t=65, when the electrical block is removed; t=85, 20 time units after the block is removed, and t=105, which is the last time step. It can be seen from Figure 5.1 g and h that reentrant wave is formed. The averaged diffusive current densities are calculated using dimensionless V and D in mm2 /s. The time averaging over simulation time mimics the accumulated phase changes in CDI. The x, y, and z components of this averaged diffusive current density are Jdiffx , Jdiffy and Jdiffz and are shown for scenarios C and H in the middle slice of HS1 in Figure 5.2. Comparing Figures 5.1 and 5.2, it is evident that the introduction of anisotropy affects the average diffusive current density more than the activation maps. The differences introduced by anisotropy are quantified using box plots. Figure 5.3 shows the box plot of Pearson correlations for the three heart structures HS1 to HS3 calculated between Scenarios A (AS state with current injection,isotropic) and F (AS state with current injection,anisotropic). The left box plot is the correlation of averaged diffusive current in z direction Jdiffz in the middle slice while the right box plot is the correlation of activations in the same slice. The Pearson correlation between two images A and B with same size is defined as follows [95, 135]: ¯ ¯ m n (Amn - A)(Bmn - B ) P = (5.1) ¯2 ¯ 2 m n (Amn - A) m n (Bmn - B ) ¯ and B ¯ are the mean values where Amn and Bmn are the pixel values of images A and B, and A of the pixels in the images A and B, respectively. Scenarios A and F are the same, only one is isotropic and the other is anisotropic. It can be seen that the correlation values for activations are higher and distinct from correlations of diffusive current densities. This shows that Jdiffz is more different between isotropic and anisotropic cases compared to the activation. Figure 5.4 107

(a) Scenario C, t =60

(b) Scenario H, t =60

(c) Scenario C, t =65

(d) Scenario H, t =65

(e) Scenario C, t =85

(f ) Scenario H, t =85

(g) Scenario C, t =105

(h) Scenario H, t =105

Figure 5.1: Progression of activation map (V ) in Scenarios C (isotropic, R) and H (Anisotropic, R) for HS1. 108

(a) Average Jdif fx Scenario C

(b) Average Jdif fx Scenario H

(c) Average Jdif fy Scenario C

(d) Average Jdif fy Scenario H

(e) Average Jdif fz Scenario C

(f) Average Jdif fz Scenario H

Figure 5.2: Average diffusive current densities for Scenarios C and H in chosen slice of HS1.

109

0.95

0.9

Pearson Correlation

0.85

0.8

0.75

0.7 J_Diffz (0-85) Activation at t=85

Figure 5.3: Box plot of Pearson correlations of Jdiffz and activation maps between scenarios A and F (AS with current injection, isotropic and anisotropic) for the middle slice. compares the correlations between anisotropic and isotropic cases for scenarios D (NS state with no current injection,isotropic) and I (NS state with no current injection,anisotropic), Figure 5.5 compares the correlations between anisotropic and isotropic cases for scenarios E (R state with no current injection,isotropic) and J (R state with no current injection,anisotropic), Figure 5.6 compares the correlations between anisotropic and isotropic cases for scenarios C (R state with current injection,isotropic) and H (R state with current injection,anisotropic). It can be seen that the correlation values for activations are higher and distinct from correlations of diffusive current densities. As evident from the figures, the introduction of anisotropy will result in more change in the diffusive current. The results in the box plots are shown for Jdiffz because the current injection direction is aligned with the z direction in CDI experiments and is measured in this direction in the experiments; further, time averaging is performed over 85 time steps as there is not much activation after step 85 in some scenarios. The results in Figures 5.3-5.6 mean that the diffusive current density is a better way to look at the various states compared with activation maps if they ever were available inside the cardiac muscle. This is expected because the current density is directly connected to the diffusion tensor (D). Figure 5.7 a shows activation map (V ) for scenario B at

time t=85 for HS1, while Figure 5.7 b shows activation map at time t=85 for scenario K in HS1. Figure 5.8 a shows average diffusive current in z direction (Jdiffz ) for scenario B for HS1 while Figure 5.8 b shows average diffusive current in z direction (Jdiffz ) for scenario K in HS1. 110

1

0.95

Pearson Correlation

0.9

0.85

0.8

0.75

0.7 J_Diffz (0-85) Activation at t=85

Figure 5.4: Box plot of Pearson correlations of Jdiffz and activation maps between scenarios D and I (Normal with no current injected, isotropic and anisotropic) for middle slice.

1

0.95

Pearson Correlation

0.9

0.85

0.8

0.75

J_Diffz (0-85)

Activation at t=85

Figure 5.5: Box plot of Pearson correlations of Jdiffz and activation maps between scenarios E and J (Reentrant with no current injected, isotropic and anisotropic) for the middle slice.

111

1.05 1 0.95

Pearson Correlation

0.9 0.85 0.8 0.75 0.7 0.65 0.6 J_Diffz (0-85) Activation at t=85

Figure 5.6: Box plot of Pearson correlations of Jdiffz and activation maps between scenarios C and H (Reentrant with current injected, isotropic and anisotropic) for the middle slice.

(a)

(b)

Figure 5.7: a) activation map (V ) in scenario B (isotropic, NS) at t=85 in chosen slice for HS1 b) activation map (V ) in scenario K (anisotropic, VF) at t = 85 in chosen slice for HS1.

112

(a)

(b)

Figure 5.8: a) Jdiffz in scenario B (isotropic, NS) in chosen slice of HS1 b) Jdiffz in scenario K (anisotropic, VF) for the chosen slice of HS1. In order to study and compare the simulations quantitatively, the Pearson correlation between heart states are compared for the three hearts. Figure 5.9 shows a comparison of correlations calculated between components x, y, and z for averaged diffusive current density in the middle slice of HS1. There are seven comparisons in this figure tagged as C1 to C7. The trends are matching for the three components x, y, and z . Figure 5.10 shows the same correlation comparisons for HS2. This figure also shows consistent trends in the three components. Figure 5.11 shows the same correlation comparisons this time for HS3. In these figures, "R" represents reentrant state, "AS" asystole state, "NS" normal state, and "VF" ventricular fibrillation. "Yes" means current is injected while "No" means no current injected. These results show consistently that in all three heart structures, VF-R and NS-AS have the highest correlation while R-NS, R-AS and VF-AS have lower correlations. These differences can help us distinguish current distribution in Normal and Asystole states from reentrant and VF states and confirms the potency of CDI images to distinguish current distribution in various heart states. The results also show that the current injection does not have a major effect on averaged diffusive 113

Pearson Correlation between Heart States
0.8 0.6 0.4

C3

C5

C1:R-NS, no C2:R-AS, yes C3:NS-AS, yes
C6

C4:R-NS, yes
C7

C1

C4

0.2 0 -0.2

C2

C5:VF-R, yes C6:VF-AS, yes C7:VF-NS, yes

a) JDiffx
C5

0.8 0.6 0.4

C3

0.8

0.4

C6

C4

C1

C2

C1

C2

C4

0 -0.2

0 -0.2

b) JDiffy

c) JDiffz

Figure 5.9: a) Comparing Pearson correlation of Jdiffx for various states in chosen slice of heart HS1 using monodomain model b) Comparing Pearson correlation of Jdiffy for various states in chosen slice of heart HS1 c) Comparing Pearson correlation of Jdiffz for various states in chosen slice of heart HS1. current density. To further quantify the results, the histograms of calculated averaged Jdiffz in

the chosen middle slice are investigated. Figure 5.12 shows the histogram of averaged diffusive current in z direction for various scenarios. In the histograms, values above 1 are displayed in order to visualize the tail of the histogram. These histograms have a similarity to Poisson, Rician, and Rayleigh distributions; therefore, to quantify them the above-mentioned distributions are fitted to the histograms. The chi-square goodness of fit test is used for these distributions, which proved the hypothesis to be valid only for Poisson distribution with a significance level of 0.05. Consequently, the parameter  is displayed on each histogram to quantify the length of their tails. It can be seen

114

C6

C7

0.2

C7

0.2

C3

C5

0.6

Pearson Correlation between Heart States
C3
0.8 0.6 0.4 0.2

C1:R-NS, no
C5

C2:R-AS, yes C3:NS-AS, yes C4:R-NS, yes C5:VF-R, yes C6:VF-AS, yes C7:VF-NS, yes

C2

C1

C4

C6

0 -0.2

a) J

Diffx

C3

C7

C3

0.8 0.6 0.4

0.8

C5

C1

C4

C5

C2

0.6 0.4

C6

0.2

C7

0.2 0 -0.2

C1

0 -0.2

C2

b) JDiffy

C4

c) JDiffz

Figure 5.10: a) Comparing Pearson correlation of Jdiffx for various states in chosen slice of heart HS2 using monodomain model b) Comparing Pearson correlation of Jdiffy for various states in chosen slice of heart HS2 c) Comparing Pearson correlation of Jdiffz for various states in chosen slice of heart HS2.

115

C6

C7

Pearson Correlation between Heart States
0.8 0.6 0.4 0.2

C3

C1:R-NS, no
C5

C2:R-AS, yes C3:NS-AS, yes C4:R-NS, yes

C2

C1

C4

C6

C7

C5:VF-R, yes C6:VF-AS, yes C7:VF-NS, yes

0 -0.2

a) J

Diffx

C5

C3

0.8 0.6 0.4

C3

0.8 0.6 0.4

C2

C1

C4

C7

0.2 0 -0.2

C6

0.2

C1

C2

C4

C5 C6

0 -0.2

b) JDiffy

c) JDiffz

Figure 5.11: a) Comparing Pearson correlation of Jdiffx for various states in chosen slice of heart HS3 using monodomain model b) Comparing Pearson correlation of Jdiffy for various states in chosen slice of heart HS3 c) Comparing Pearson correlation of Jdiffz for various states in chosen slice of heart HS3.

116

C7

that reentrant and VF scenarios have longer tails, or a higher range of variation in their averaged diffusive current which results in higher  values. The histograms in this figure are obtained from implementing model scenarios in HS1. Figure 5.13 shows the same histograms for HS2. The results match that of Figure 5.12 and we see higher values of lambda and longer tails for VF and reentrant scenarios. Figure 5.14 shows the same histograms for HS3. Results in this figure are consistent with results from Figures 5.12 and 5.13. To summarize, these histograms show that there are higher variations in the averaged diffusive current density in the cases of reentrant and VF states. These results mean that, as well as providing a possibility to distinguish current distributions in various cardiac states, CDI may be able to detect areas of reentry. A possible explanation for this higher range of activity may be that in VF and reentry states, areas that should be at rest become activated and contribute to higher time averaged diffusive current density.

5.2

Analyzing and Comparing real CDI data and Monodomain Simulated Results

In the next step, the results of the monodomain model simulations are corroborated with real CDI data obtained from eight pig experiments. This validated the theoretical findings from the model. Before analyzing the CDI data, unreliable slices are removed. These unreliable slices were identified by distortions introduced to the magnitude images due to the presence of electrodes in the imaged slices. To make sure that rotation mismatches, masking and noise are not dramatically affecting the slices, only the slices in which measured current is more than 70 percent of total injected current in the z direction are chosen. For the sake of comparison, and because of different current amplitudes injected in the experiments, the obtained current densities were normalized by the amplitude of injected currents. As well, due to the difference in the size of the hearts and slices the results are normalized by the area of the slice. Due to technical limitations in rotating a perfusing heart, only the component z of the current densities were measured in the experiments. The average range of variations for normalized current densities in different states compared to the AS state for the experiments and monodomain simulations are shown in Table 5.1. These results demonstrate that there is higher variation range in the case of VF when compared with Normal 117

300
pixels pixels

300  = 2.3985 200 100 0 0 300
pixels

200 100 0 0 300

 = 1.1431

5 (a) Jdiffz in (R,no)

10

5 (b) Jdiffz in (NS,no)

10

pixels

200 100 0 0 300

 = 3.6481

200 100 0 0 300

 = 1.2467

5 (c) Jdiffz in (R,yes)

10

5 (d) Jdiffz in (AS,yes)

10

pixels

100 0 0 5 (e) Jdiffz in (NS,yes) 10

pixels

200

 = 1.3736

200 100 0 0

 = 2.7013

5 (f) Jdiffz in (VF,yes)

10

Figure 5.12: a) Comparing histograms of averaged Jdiffz for various scenarios in chosen slice of heart HS1 using monodomain model a) Scenario J (R, no), b) Scenario I (NS, no), c) Scenario H (R, yes) d) Scenario F (AS, yes), e) Scenario G (N, yes), and f) Scenario K (VF, yes). The horizontal axis shows values of Jdiffz above 1. The  values represent the parameters of Poisson distributions fitted to the histograms

118

400
pixels pixels

400

200

 = 1.6523

200

 = 1.4445

0 0 400
pixels

5 (a) Jdiffz in (R,no)

10

0 0 400
pixels

5 (b) Jdiffz in (NS,no)

10

200

 = 1.6911

200

 = 1.2812

0 0 400
pixels

5 (c) Jdiffz in (R,yes)

10

0 0 400
pixels

5 (d) Jdiffz in (AS,yes)

10

200

 = 1.429

200

 = 1.832

0 0

5 (e) Jdiffz in (NS,yes)

10

0 0

5 (f) Jdiffz in (VF,yes)

10

Figure 5.13: a) Comparing histograms of averaged Jdiffz for various scenarios in chosen slice of heart HS2 using monodomain model a) Scenario J (R, no), b) Scenario I (NS, no), c) scenario H (R, yes) d) Scenario F (AS, yes), e) Scenario G (NS, yes), and f) Scenario K (VF, yes). The horizontal axis shows values of Jdiffz above 1. The  values represent the parameters of Poisson distributions fitted to the histograms

119

300
pixels pixels

300  = 3.3357 200 100 0 0 300
pixels

200 100 0 0 300

 = 1.2643

5 (a) Jdiffz in (R,no)

10

5 (b) Jdiffz in (NS,no)

10

pixels

200 100 0 0 300

 = 3.1297

200 100 0 0 300

 = 1.3232

5 (c) Jdiffz in (R,yes)

10

5 (d) Jdiffz in (AS,yes)

10

pixels

100 0 0 5 (e) Jdiffz in (NS,yes) 10

pixels

200

 = 1.2753

200 100 0 0

 = 2.9319

5 (f) Jdiffz in (VF,yes)

10

Figure 5.14: Comparing histograms of averaged Jdiffz for various scenarios in chosen slice of heart HS3 using monodomain model a) Scenario J (R, no), b) Scenario I (NS, no), c) Scenario H (R, yes) d) Scenario F (AS, yes), e) Scenario G (NS, yes), and f) Scenario K (VF, yes). The horizontal axis shows values of Jdiffz above 1. The  values represent the parameters of Poisson distributions fitted to the histograms

120

Table 5.1: The average ratio of variations in normalized current density compared to AS state for both measured and monodomain simulation results State: VF Average ratio of variations(measured in experiments) : 2.05 Average ratio of variations(monodomain CDI model simulation) : 3.34 AS 1 1 NS 1.12 0.92

Table 5.2: The average correlation values for measured current density results and monodomain simulation results Comparison: AS-VF Correlation (measured from experiments): 0.4437 Correlation (monodomain CDI model simulation): 0.0098 NS-AS NS-NS 0.6010 0.6680 0.5795 1

Sinus and Asystole states. This matches our theoretical findings from the monodomain model in Figures 5.12 - 5.14. For the VF results in this table, 18 slices of 4 separate experiments are used. For AS and NS states, 11 slices of 3 experiments and 17 slices of 4 experiments are used, respectively. This table shows that, while the ratio of variations between VF and AS from experiment and simulation is more than 2, the range of variations for NS is within 12 percent of the range of AS. The average correlation values for the monodomain model simulation results and CDI experiment results are shown in Table 5.2. However, there are only four of eight experiments with comparable results (i.e. different states in the same experiment). The results are correlated between corresponding slices in different datasets of the same experiment and averaged for various slices. These results show that VF is relatively more distinct than AS, while NS and AS are more correlated. This result is in line with correlation results from simulations. It can be seen that even for the same states (NS-NS) the experimental results will not be very close. This may be due to the variations in electrical activity and the fact that current injection is not synchronized with the initiation of the heart's electrical activity, as is the case in the simulations. The trend of experimental and simulation values in Tables 5.1 and 5.2 have a trend correlation coefficient of 0.99. The results in Table 5.1 are plotted for a better visualization of the similarity of trends in Figure 5.15. Similarly, Figure

121

3.5

3

2.5

Average ratio of variations measured from experiments Average ratio of variations from monodomain simulation

2

1.5

1

0.5

Figure 5.15: Comparison of range of variations trend of experimental and monodomain simulation results 5.16 visually compares the trend of results in Table 5.2. A sample of current densities measured by CDI method and the simulated current density for the same slice in NS condition are shown in Figures 5.17 and 5.18. The simplification of real condition in the model, and the fact that initiation of electrical activity in the heart is not synchronized with the current injection pulse can explain the differences that makes one to one comparison inappropriate; however, as shown before, the overall performance of the model matches experimental results in terms of variations in diffusive J and correlations. The findings from analyses of the CDI results and the theoretical model results support the hypothesis that CDI is able to reflect the changes in electrical activities inside the cardiac muscle. This was also presented in another work by our group [73], which infused real CDI data and DTI data using information-theory-based approaches. While correlation variable reflects the global similarity or dissimilarity of two images, structural similarity is a measure that reflects local structural similarity using locally calculated mean and variances [136]. The structural similarity maps for two comparable experimental datasets for 122

AS

NS

VF

1

0.9

0.8

Average of state correlations measured from experiments Average of state correlations from monodomain simulation

0.7

0.6

0.5

0.4

0.3

0.2

0.1

0

Figure 5.16: Comparison of correlation trend of experimental and monodomain simulation results

Figure 5.17: Jdiffz calculated by the monodomain model for NS condition

A SVF

123

NSNS

NSAS

40

50

20

100

0

-20 150

-40 200

-60 250 50 100 150 200 250

Figure 5.18: Measured current densities in A/m2 in a NS experiment for the same slice in Figure (5.17). VF-AS, NS-AS, and NS-NS comparisons are shown in Figure 5.19. The results show that VF-AS case has relatively the highest dissimilarity, AS-NS dissimilarity is in second place, and NS-NS comparison map the least, which are in line with correlation results.

5.3

Bidomain CDI Model Results

To further investigate the CDI model, Aliev-Panfilov bidomain model was implemented in the same three heart structures HS1 to HS3. In order to obtain convergence for these models, the tetrahedral meshes are refined. In order, the number of elements for HS1 to HS3 are 39964, 24746, and 39513. The extracellular and intracellular diffusion coefficients were chosen from the literature [109], as mentioned in Chapter 4. These changes cause a slight delay in wavefront propagation and, in order to observe reentrant waves in this condition, blocking time is increased to 20 units. This allows the areas adjacent to the blocked region to get enough relaxation time to pass their refractory period before the blocking is removed. Otherwise, all other simulation settings are the same as

124

VF-AS

NS-AS

NS-NS
1 0.98

0.96

0.94

0.92

0.9

0.88

0.86

0.84

0.82

0.8

Figure 5.19: Structural similarity maps for two comparable experimental datasets monodomain model. The state correlation results of average diffusive current density in three directions using bidomain CDI model for HS1 is shown in Figure 5.20. The results in terms of trends are consistent with monodomain CDI model results. Figure 5.21 shows the state correlation values in HS2 which follows the trends in Figure 5.20. Figure 5.22 shows the correlations in HS3 with the same conclusion in terms of the trend. Figure 5.23 shows the histogram of simulated CDI maps in direction z with  of fitted Poisson distribution using bidomain CDI model in HS1. It shows that, similar to the monodomain CDI model, the reentrant and VF scenarios have longer tails, or ranges. Figure 5.24 shows the same histograms in HS2 with results in line with Figure 5.23. Finally, 5.25 shows the same histograms for HS3 with results in line with those in Figures 5.24 and 5.23. The results show that, on average, the trend of correlations for bidomain models has a correlation value of 0.89 with CDI experiment results. From the histograms of the reentrant and VF scenarios, we can see that there are higher ranges of variations when compared with other scenarios considered in the simulations. This reaffirms the monodomain modeling results and the corrobo-

125

Pearson Correlation between Heart States
C5
0.8 0.6 0.4

C2:R-AS, yes C3:NS-AS, yes C4:R-NS, yes

C2

C4

C6

C7

0.2 0 -0.2

C3

C5:VF-R, yes C6:VF-AS, yes C7:VF-NS, yes

a) JDiffx

0.6 0.4 0.2

C5

0.8

0.8 0.6 0.4

C3

C7

C4

0.2

C3

C5

C6

C2

C2

0 -0.2

C4

0 -0.2

b) JDiffy

c) JDiffz

Figure 5.20: a) Comparing Pearson correlation of averaged Jdiffx for various states in chosen slice of HS1 using bidomain model b) Comparing Pearson correlation of averaged Jdiffy for various states in chosen slice of HS1 c) Comparing Pearson correlation of average Jdiffz for various states in chosen slice of HS1.

Pearson Correlation between Heart States

0.8

C3

C6

0.6 0.4 0.2 0 -0.2

C5

C2:R-AS, yes C3:NS-AS, yes

C4

C7

C4:R-NS, yes C5:VF-R, yes C6:VF-AS, yes C7:VF-NS, yes

C2

a) JDiffx

0.8

0.8

C3

C5

0.6 0.4

0.6 0.4

C3

C4

C5

C4

C6

C6
Diffz

C2

C6

0.2 0 -0.2

C7

0.2 0 -0.2

b) J

C2

Diffy

c) J

Figure 5.21: a) Comparing Pearson correlation of average Jdiffx for various states in chosen slice of HS2 using bidomain model b) Comparing Pearson correlation of average Jdiffy for various states in chosen slice of HS2 c) Comparing Pearson correlation of average Jdiffz for various states in chosen slice of HS2.

126

C7

C7

Pearson Correlation between Heart States

C3

0.8 0.6 0.4 0.2

C2:R-AS, yes C3:NS-AS, yes

C5

C4:R-NS, yes

C4

C2

C6

C7

C5:VF-R, yes C6:VF-AS, yes C7:VF-NS, yes

0 -0.2

a) JDiffx

0.8 0.6 0.4 0.2 0 -0.2

0.8 0.6

C3

C3

C2

0.4

C5

C4

C5

C4

C6

C2

C7

0 -0.2

b) JDiffy

c) JDiffz

Figure 5.22: a) Comparing Pearson correlation of average Jdiffx for various states in chosen slice of HS3 using bidomain model b) Comparing Pearson correlation of average Jdiffy for various states in chosen slice of HS3 c) Comparing Pearson correlation of average Jdiffz for various states in chosen slice of HS3.

300 250 200  = 0.25415

300 250 200  = 0.11629

pixels

150 100 50 0 0 0.5 (a) Jdiffz in (R,yes) 1

pixels

150 100 50 0 0 0.5 (b) Jdiffz in (NS,yes) 1

300 250 200  = 0.19117

300 250 200  = 0.21605

pixels

150 100 50 0 0 0.5 (c) Jdiffz in (AS,yes) 1

pixels

150 100 50 0 0 0.5 (d) Jdiffz in (VF,yes) 1

Figure 5.23: Comparing histograms of average Jdiffz for various scenarios in chosen slice of HS1 using bidomain model a) Scenario C (R, yes), b) Scenario B (NS, yes), c) Scenario A (AS, yes) d) Scenario K (VF, yes). The horizontal axis shows values of averaged Jdiffz above 0.1. The  values represent the parameters of Poisson distributions fitted to the histograms

127

C6

0.2

C7

300 250 200  = 0.19748

300 250 200  = 0.14872

pixels

150 100 50 0 0 0.5 (a) Jdiffz in (R,yes) 1

pixels

150 100 50 0 0 0.5 (b) Jdiffz in (NS,yes) 1

300 250 200  = 0.13134

300 250 200  = 0.16867

pixels

150 100 50 0 0 0.5 (c) Jdiffz in (AS,yes) 1

pixels

150 100 50 0 0 0.5 (d) Jdiffz in (VF,yes) 1

Figure 5.24: Comparing histograms of average Jdiffz for various scenarios in chosen slice of HS2 using bidomain model a) Scenario C (R, yes), b) Scenario B (NS, yes), c) Scenario A (AS, yes) d) Scenario K (VF, yes). The horizontal axis shows values of average Jdiffz above 0.1. The  values represent the parameters of Poisson distributions fitted to the histograms

300 250 200  = 0.21841

300 250 200  = 0.12471

pixels

150 100 50 0 0 0.5 (a) Jdiffz in (R,yes) 1

pixels

150 100 50 0 0 0.5 (b) Jdiffz in (NS,yes) 1

300 250 200  = 0.13774

300 250 200  = 0.19115

pixels

150 100 50 0 0 0.5 (c) Jdiffz in (AS,yes) 1

pixels

150 100 50 0 0 0.5 (d) Jdiffz in (VF,yes) 1

Figure 5.25: Comparing histograms of Jdiffz for various scenarios in chosen slice of HS3 using bidomain model a) Scenario C (R, yes), b) Scenario B (NS, yes), c) Scenario A (AS, yes) d) Scenario K (VF, yes). The horizontal axis shows values of average Jdiffz above 0.1. The  values represent the parameters of Poisson distributions fitted to the histograms

128

Table 5.3: The average ratio of variations in normalized current density compared to AS state for both measured and bidomain simulation results State: VF AS NS Average ratio of variations(measured from experiments) : 2.05 1 1.12 Average ratio of variations(bidomain CDI model simulation) : 1.7540 1 0.9494 Table 5.4: The average correlation values for normalized measured current density results and bidomain CDI model simulation results Comparison: AS-VF NS-AS Correlation (measured from experiments): 0.4437 0.6010 Correlation (bidomain CDI model simulation): 0.1487 0.3922 NS-NS 0.6680 1

ration of experimental and simulation results, meaning that CDI is able to reflect the changes in the electrical activity inside the tissue. The trend of variation ranges from the bidomain model has a correlation of 0.98, with the same trend from experiments. The results are quantified in Tables 5.3 and 5.4. The root means square (RMS) of the differences between monodomain and bidomain results and the results from experiments are shown in Table 5.5. As expected these results show that the CDI model generated based on bidomain Aliev-Panfilov model has better performance compared with monodomain version. To visualize the comparison of trends in correlations for bidomain CDI model with experimental results, the values are plotted in Figure 5.26, a visual comparison of the trend of range ratios of bidomain CDI model with experimental results is shown in Figure 5.27 is used. It can be noted that, although higher mesh refinement level (general physics calibrated predefined finer mesh) is used for all bidomain models for the sake of numerical convergence, the relative comparison of results has a similar trend as monodomain models with coarser meshes, which points toward the fact that the relative comparison of the results in the CDI model is almost independent of mesh refinement.

129

Table 5.5: The root mean square difference of average correlation values and ratio of variations between bidomain simulation results and measured results from experiments RMS of deviation Monodomain Bidomain Average correlation values 0.3157 0.2833 Average ratio of variation 0.7537 0.1972

1

0.8

Average state correlations measured from experiments Average state corrlations from bidomain simulation

0.6

0.4

0.2

0

Figure 5.26: Comparison of correlation trend of experimental and bidomain simulation results

2.2

2

1.8

1.6

1.4

Average ratio of variations measured from experiments Average ratio of variations from bidomain simulation

1.2

1

0.8

A SVF

Figure 5.27: Comparison trend of range of variations ratio (to AS state) for experimental and bidomain simulation results 130

AS

NS

VF

NSNS

NSAS

Chapter 6 Conclusions and Future Work

S

TUDYING arrhythmias and the underlying causes behind them is an active area of research in cardiac electrophysiology. However, due to the lack of real data on the electrical activities

inside the tissue and the complexity of the cardiac electrophysiology, various hypotheses exist in the literature. In this dissertation we have investigated the application of MRI-based current density imaging to indirectly study the dynamic changes in cardiac electrical activity in 3D cardiac tissue. This imaging method provides the opportunity to indirectly quantify electrical activity inside the tissue. This information is not otherwise available in the literature and was applied for the first time to ex-vivo live hearts in this work. In the process, we developed a customized, MRI-adaptable Langendorf setup. This work then led us to develop a CDI model that could simulate CDI in different cardiac states, thereby avoiding logistical and impractical complexities involved in performing CDI on an ex-vivo beating heart. This CDI model exploits existing well established theoretical models. The CDI model was implemented in three different heart structures using monodomain and bidomain scenarios in different cardiac states. The simulation results corroborated well with real data values obtained from CDI experiments, in terms of correlation and histograms. The results reaffirm that CDI is not only able to indirectly reflect the current distribution changes in the cardiac electrical activity in 3D, but also that CDI has significant potential for studying electrophysiological changes inside the heart. The CDI method in conjunction with the CDI model have potential impact on obtaining valuable data on the volumetric cardiac electrical activity that may be helpful

131

in providing insights into arrhythmia mechanisms. The model can be used as a testbed for simulating a variety of scenarios without the real-world complexity of the experiments. The model also helps us to save animal lives that would be otherwise sacrificed for further studies. Future directions of this work include an expansion of the model to adapt to more heart structures and states, simulate the effects of MRI acquisition parameters in CDI, and application to investigating specific hypotheses for arrhythmic conditions. The more realistic heart structures represented by DTIs recorded from diseased heart structures can also be used in the future for more precise representation of cardiac fibres in various arrhythmia scenarios. Finally, the model could also be incorporated to include micro ion channel contributions.

132

Appendix A Noise Distribution in Phase Wrapped Images
If we assume that for each pixel inside the subject xR is the random variable representing corrupted intensity in real images and xI is the random variable representing corrupted intensity in imaginary image we have for one pixel: xR = r + n R xI = s + nI nR  N (0,  ) nI  N (0,  ) (A.1) (A.2)

nR is the noise random variable for the chosen pixel in Real image and nI is the random variable representing noise in Imaginary image for the same pixel. Therefore xR and xI are Gaussian at each pixel with non-zero means r and s at that pixel. In this case the joint distribution of xR and xI is a bi-variate Gaussian distribution given as: f (xR , xI ) = while
1  2 r) exp(-[ (xR- + 2   = 2.
2

(xI -s)2 ]) 2

(A.3)

The distribution of angle and magnitude of xR + ixI can be found using Jacobian of the transformation as: f (, m) = while
1 m  2

· exp(-[ (s

2 +r 2 +m2 -2ms sin( )

2

-

2mr cos() ]) 2 2 x2 R + xI .

 = arg (xR + ixI ) 133

and m =

(A.4)

The symbol arg represents the argument of xR + ixI . Because the current density is measured from the phase changes we find f () by integrating over m: f ( ) = =
1  2 e
-

 0

m · exp(-[ (s
 0

2 +r 2 +m2 -2ms sin( )

2
2 -2ms sin( )

- -

2mr cos() ])dm 2 2mr cos() ])dm. 2

(s2 +r 2 ) 2

 2

m · exp(-[ (m

2

(A.5) (A.6)

Defining e-  2 =  2 = e-
(s2 +r 2 )

c = 2s cos() + 2r sin(),
 0 c 2 (m - 2 ) - m · exp(-[ 2   c2 4

])dm,

(A.7)

(s2 +r 2 ) 2

e 4 2
0

c2

 2

m · exp(-[

c 2 (m - 2 ) ])dm. 2

(A.8)

c Changing variable u = m - 2 ,
- (s2 +r 2 ) c2 2 e 4 2

=

e

 2

(

 c -2

u · exp(-[ u ])du + 2

2

 c c 2 -2

· exp(-[ u ])du). 2

2

(A.9)

Using following identities: e
-ax2

   dx =  = erf (x a) 2 a xe-ax dx = -
2

a > 0,

(A.10) (A.11)

1 -ax2 e , 2a

the distribution can be simplified to [75]: e-  2 f ( ) =  2
(s2 +r 2 )

  2 c  c22 c [ + e 4 [1 - erf (-  )]] 2 4 2 

while

-     .

(A.12)

While erf is Gaussian error function.

134

Appendix B Reliability Metric Performance
For the quantification of the reliability metric, experiments were carried out using TR of 700 ms and TE s of 100 ms and 50 ms for the phantom and heart respectively. Rotation mismatches of 10 and 20 degrees were introduced and the reliability maps were compared for the phantom in Figure B.1 while black points inside the phantom represent unreliable points and white ones represent reliable points. Figure B.2 shows the 20 degree mismatch and the intensity based image registration correction for pig heart. Table 4.2 shows the calculated current, effect of mismatches on the calculated current and reliability metric. "rot" means rotation mismatch in degrees, "Reg" specifies presence or absence of intensity based registration, I is the current injected and Im is the measured current. The results in the Table B.1 show that the metric is able to reflect the degradation caused by mismatches and the improvements gained by intensity based image registration.

135

Figure B.1: Reliability maps for phantom experiment

Table B.1: Reliability Metric results Rot 0 100 200 200 Pig Heart 00 00 200 200 Subject Phantom Reg I (mA) Im (mA) Reliability metric N 66.7 63.9 95 % N 66.7 59.2 56 % N 66.7 51.4 26% Y 66.7 57.4 71 % N 28.6 18.7 88 % Y 28.6 18.6 91 % N 28.6 15.4 75% Y 28.6 18.3 90 %

136

Figure B.2: Rotation mismatch and image registration for heart experiment

137

Appendix C Physical Units in CDI Model
Diffusive current density is measured in the model is DV , while because V [mV ] = 100V - 80, V [mV ] = 100V . The space unit is in pixel. Each pixel is 150/256 mm which is 0.58mm. Before plugging D in m2 /s in equations we should have taken pixel to mm conversion (the space derivative is with respect to SI unit m in COMSOL) and dimensionless time which means a correction of 1.72 /12900, 12900 comes from time conversion formula (1000*12.9). The diffusion tensor Dwater (read from DTI) has unit determined by the unit of b in MRI machine (in our case for b it was s/mm2 ) therefore it is mm2 /s for Dwater . It is assumed to be proportional with D calculated from conductivity. The typical values of D are provided in [3] which shows a factor of 0.001 should be multiplied by our Dwater before using it in differential equation. Conductivity (G) and diffusion coefficients(D) are related through the equation provided in Panfilov review paper to satisfy ohms law [3]. while C is transmembrane capacitance for cardiac cells which regardless of species (rabbit, canine and human) it is 0.01 F/m2 [109, 133], and Sv is surface to volume ratio for the cell which depends on species and their development stage and typically are between 1000 to 5000 /cm [133]. In the formula, G has unit of S/m and D m2 /s. Therefore to convert from D (m2 /s) to G (S/m) we should multiply D by 0.01 (F/m2 )*(100000 to 500000)(/m) =1000 to 5000. This means that to calculate current density in A/m2 from DV we should multiply it by 1000 to 5000 if D is in m2 /s and V is in Volt which is not far from our experimental range for a 20mA experiment (-20 to 20 A/m2 for Normal state) while in the model with Is =1 for unit surface area of each cell we get +-0.002*(1000 to 5000)*0.1, while 0.1 factor is

138

for conversion to volt.

139

Appendix D List of CDI Experiments
The following table lists the experiments conducted on phantom, dead and live ex-vivo heart for which data has been successfully collected. It determines the amplitude of current if injected and number of datasets obtained. Furthermore it shows whether multi slice or single slice sequences are used and how many slices are obtained for the multi-slice sequences.

140

Table D.1: List of CDI Experiments Label PH1 PH2 DH1 Subject Phantom Phantom Dead Heart Machine GE GE GE Full 3D Dead Heart DH2-WB Water Bottle PH3 PH4 PH5 H1 PH6 H2 H3 H4 Phantom Phantom Phantom Heart Phantom Heart Heart Heart GE GE GE GE GE GE GE GE GE N/A Full 2D Full 2D Full 2D 2 Full set / AS & VF 30 dir DTI Full 2D Full/VF Full/NS Full/VF 30 dir DTI 3 Full set / AS,VF,NS 30 dir DTI 2 Full set / NS 30 dir DTI 2 Full sets / AS and VF 30 dir DTI 141 N/A 45 mA 50 mA 50 mA 20 mA N/A 6 multi 6 multi 6 multi 6 multi 21 6 multi 6 multi 6 multi 6 multi 22 6 multi 21 40 mA 6 multi Copper, Brass and Silver distortions N/A 30 mA N/A 3 multi N/A State Full 3D Full 3D Full 3D Full 2D Injected Current (mA) Slice No. 30 mA 1 70 mA 1 40 mA 3 single 30 mA 1 Comment

Single and multislice on dead heart noise study , pump, lights, elec equipment

20 mA 30 mA 20 mA 20 mA N/A 20 mA

H5

Heart

GE

H6

Heart

GE

H7

Heart

GE

20 mA

6 multi

Bibliography
[1] MS Gockenbach. Understanding And Implementing the Finite Element Method. Society for Industrial and Applied Mathematics Philadelphia, 2006. [2] AL Goldberger, LAN Amaral, L Glass, JM Hausdorff, PC Ivanov, RG Mark, JE Mietus, GB Moody, CK Peng, and HE Stanley. and PhysioNet: logic signals. PhysioBank, PhysioToolkit,

Components of a new research resource for complex physioCirculation, 101(23):e215­e220, 2000 (June 13). Circulation Elec-

tronic Pages: http://circ.ahajournals.org/cgi/content/full/101/23/e215 PMID:1085218; doi: 10.1161/01.CIR.101.23.e215. [3] RH Clayton and AV Panfilov. A guide to modelling cardiac electrical activity in anatomically detailed ventricles. Progress in biophysics and molecular biology, 96(1):19­43, 2008. [4] AS Go, D Mozaffarian, VL Roger, EJ Benjamin, JD Berry, MJ Blaha, S Dai, ES Ford, CS Fox, S Franco, et al. Heart disease and stroke statistics­2014 update: a report from the american heart association. Circulation, 129/3/e28:1­268, 2014. [5] Cardiac arrhythmias. Technical report, Belvoir Media Group, LLC, 04 2010. Copyright Copyright 2013 by Harvard University. All rights reserved. HHP/HMS content licensing handled by Belvoir Media Group; Last updated - 2013-06-24. [6] NS Peters and AL Wit. Myocardial architecture and ventricular arrhythmogenesis. Circulation, 97(17):1746­1754, 1998.

142

[7] GR Mines. On circulating excitations in heart muscles and their possible relation to tachycardia and fibrillation. Trans R Soc Can IV, pages 43­52, 1914. [8] R Liao, BK Podesser, and CC Lim. The continuing evolution of the langendorff and ejecting murine heart: new advances in cardiac phenotyping. American Journal of Physiology-Heart and Circulatory Physiology, 303(2):H156­H167, 2012. [9] B He, PA Iaizzo, DC Sigg, and YF Xiao. Cardiac Electrophysiology Methods and Models. Springer, 2010. [10] NA Trayanova. Whole-heart modeling applications to cardiac electrophysiology and electromechanics. Circulation Research, 108(1):113­128, 2011. [11] AL Hodgkin and AF Huxley. A quantitative description of membrane current and its application to conduction and excitation in nerve. The Journal of physiology, 117(4):500­544, 1952. [12] J Jalife. Ventricular fibrillation: mechanisms of initiation and maintenance. Annual Review of Physiology, 62(1):25­50, 2000. [13] RE Ideker and JM Rogers. Human ventricular fibrillation wandering wavelets, mother rotors, or both? Circulation, 114(6):530­532, 2006. [14] K Agladze, JP Keener, SC M¨ uller, and A Panfilov. Rotating spiral waves created by geometry. Science, pages 1746­1746, 1994. [15] M Joy, G Scott, and M Henkelman. In vivo detection of applied electric currents by magnetic resonance imaging. Magnetic resonance imaging, 7(1):89­94, 1989. [16] GC Scott, MLG Joy, RL Armstrong, and RM Henkelman. Measurement of nonuniform current density by magnetic resonance. Medical Imaging, IEEE Transactions on, 10(3):362­ 374, 1991.

143

[17] GC Scott, MLG Joy, RL Armstrong, and RM Henkelman. RF current density imaging in homogeneous media. Magnetic Resonance in Medicine, 28(2):186­201, 1992. [18] D Wang, TP DeMonte, W Ma, MLG Joy, A Nachman, et al. Multislice radio-frequency current density imaging. Medical Imaging, IEEE Transactions on, 28(7):1083­1092, 2009. [19] P Pesikan, MLG Joy, GC Scott, and MR Henkelman. Two-dimensional current density imaging. Instrumentation and Measurement, IEEE Transactions on, 39(6):1048­1053, 1990. [20] HS Khang, SH Oh, BH Han, SY Lee, MH Cho, and EJ Woo. A preliminary study on temperature change monitoring using the MR current density imaging technique. Measurement Science and Technology, 13(4):N42, 2002. [21] I Ser sa, K Beravs, NJF Dodd, S Zhao, D Miklav ci c, and F Demsar. Electric current density imaging of mice tumors. Magnetic resonance in medicine, 37(3):404­409, 1997. [22] HR Gamba and DT Delpy. Measurement of electrical current density distribution within the tissues of the head by magnetic resonance imaging. Medical and Biological Engineering and Computing, 36(2):165­170, 1998. [23] MLG Joy, VP Lebedev, and JS Gati. Imaging of current density and current pathways in rabbit brain during transcranial electrostimulation. Biomedical Engineering, IEEE Transactions on, 46(9):1139­1149, 1999. [24] RS Yoon, TP DeMonte, KF Hasanov, DB Jorgenson, and MLG Joy. Measurement of thoracic current flow in pigs for the study of defibrillation and cardioversion. Biomedical Engineering, IEEE Transactions on, 50(10):1167­1173, 2003. [25] TP DeMonte, RS Yoon, DB Jorgenson, and MLG Joy. A system for in-vivo cardiac defibrillation current density imaging in a pig. In Engineering in Medicine and Biology Society, 2003. Proceedings of the 25th Annual International Conference of the IEEE, volume 1, pages 175­178. IEEE, 2003. 144

[26] A Patriciu, K Yoshida, JJ Struijk, TP DeMonte, MLG Joy, and H Stodkilde-Jorgensen. Current density imaging and electrically induced skin burns under surface electrodes. Biomedical Engineering, IEEE Transactions on, 52(12):2024­2031, 2005. [27] FJ Vetter and AD McCulloch. Three-dimensional analysis of regional cardiac function: a model of rabbit ventricular anatomy. Progress in biophysics and molecular biology, 69(2):157­183, 1998. [28] C Stevens, E Remme, I LeGrice, and P Hunter. Ventricular mechanics in diastole: material parameter sensitivity. Journal of biomechanics, 36(5):737­748, 2003. [29] F Vadakkumpadan, H Arevalo, AJ Prassl, J Chen, F Kickinger, P Kohl, G Plank, and N Trayanova. Image-based models of cardiac structure in health and disease. Wiley Interdisciplinary Reviews: Systems Biology and Medicine, 2(4):489­506, 2010. [30] MJ Bishop, G Plank, RAB Burton, JE Schneider, DJ Gavaghan, V Grau, and P Kohl. Development of an anatomically detailed MRI-derived rabbit ventricular model and assessment of its impact on simulations of electrophysiological function. American Journal of PhysiologyHeart and Circulatory Physiology, 298(2):H699­H718, 2010. [31] K Simelius, J Nenonen, and M Horacek. Modeling cardiac ventricular activation. International Journal of Bioelectromagnetism, 3(2):51­58, 2001. [32] M Lorange and RM Gulrajani. A computer heart model incorporating anisotropic propagation: I. model construction and simulation of normal activation. Journal of electrocardiology, 26(4):245­261, 1993. [33] KJ Sampson and CS Henriquez. Electrotonic influences on action potential duration dispersion in small hearts: a simulation study. American Journal of Physiology-Heart and Circulatory Physiology, 289(1):H350­H360, 2005. [34] J Nagumo, Arimoto S, and Yoshizawa S. An active pulse transmission line simulating nerve axon. Proceedings of IRE, 50:2061­2070, 1962. 145

[35] R FitzHugh. Impulses and physiological states in theoretical models of nerve membrane. Biophysical Journal, 1:445­466, 1961. [36] A. Panfilov and J.P. Keener. Re-entry in an anatomical model of the heart. Chaos, Solitons & Fractals, 5(34):681­689, 1995. [37] AV Panfilov and P Hogeweg. Scroll breakup in a three-dimensional excitable medium. Physical Review E, 53(2):1740, 1996. [38] AV Panfilov. Spiral breakup as a model of ventricular fibrillation. Chaos: An Interdisciplinary Journal of Nonlinear Science, 8(1):57­64, 1998. [39] F Xie, Z Qu, J Yang, A Baher, JN Weiss, and A Garfinkel. A simulation study of the effects of cardiac anatomy in ventricular fibrillation. Journal of Clinical Investigation, 113(5):686, 2004. [40] F Vadakkumpadan, LJ Rantner, B Tice, P Boyle, AJ Prassl, E Vigmond, G Plank, and N Trayanova. Image-based models of cardiac structure with applications in arrhythmia and defibrillation studies. Journal of electrocardiology, 42(2):157­e1, 2009. [41] RH Clayton. Vortex filament dynamics in computational models of ventricular fibrillation in the heart. Chaos: An Interdisciplinary Journal of Nonlinear Science, 18(4):0431271­12, 2008. [42] FH Samie, O Berenfeld, J Anumonwo, SF Mironov, S Udassi, J Beaumont, S Taffet, AM Pertsov, and J Jalife. Rectification of the background potassium current a determinant of rotor dynamics in ventricular fibrillation. Circulation research, 89(12):1216­1223, 2001. [43] A Baher, Z Qu, A Hayatdavoudi, ST Lamp, MJ Yang, F Xie, S Turner, A Garfinkel, and JN Weiss. Short-term cardiac memory and mother rotor fibrillation. American Journal of Physiology-Heart and Circulatory Physiology, 292(1):H180­H189, 2007.

146

[44] KHWJ Ten Tusscher, A Mourad, MP Nash, RH Clayton, CP Bradley, DJ Paterson, R Hren, M Hayward, AV Panfilov, and P Taggart. Organization of ventricular fibrillation in the human heart: experiments and models. Experimental physiology, 94(5):553­562, 2009. [45] KHWJ Ten Tusscher, D Noble, PJ Noble, and AV Panfilov. A model for human ventricular tissue. American Journal of Physiology-Heart and Circulatory Physiology, 286(4):H1573­ H1589, 2004. [46] A Garfinkel, YH Kim, O Voroshilovsky, Z Qu, JR Kil, MH Lee, HS Karagueuzian, JN Weiss, and PS Chen. Preventing ventricular fibrillation by flattening cardiac restitution. Proceedings of the National Academy of Sciences, 97(11):6061­6066, 2000. [47] O Bernus, B Van Eyck, H Verschelde, and AV Panfilov. Transition from ventricular fibrillation to ventricular tachycardia: a simulation study on the role of Ca2+-channel blockers in human ventricular tissue. Physics in medicine and biology, 47(23):4167­4179, 2002. [48] O Bernus, R Wilders, CW Zemlin, H Verschelde, and AV Panfilov. A computation-

ally efficient electrophysiological model of human ventricular cells. American Journal of Physiology-Heart and Circulatory Physiology, 282(6):H2296­H2308, 2002. [49] B Echebarria and A Karma. Mechanisms for initiation of cardiac discordant alternans. The European Physical Journal Special Topics, 146(1):217­231, 2007. [50] F Fenton and A Karma. Vortex dynamics in three-dimensional continuous myocardium with fiber rotation: filament instability and fibrillation. Chaos: An Interdisciplinary Journal of Nonlinear Science, 8(1):20­47, 1998. [51] EM Cherry and FH Fenton. Suppression of alternans and conduction blocks despite steep APD restitution: electrotonic, memory, and conduction velocity restitution effects. American Journal of Physiology-Heart and Circulatory Physiology, 286(6):H2332­H2341, 2004. [52] RH Keldermann, KHWJ ten Tusscher, MP Nash, R Hren, P Taggart, and AV Panfilov. Effect of heterogeneous APD restitution on VF organization in a model of the human ventricles. 147

American Journal of Physiology-Heart and Circulatory Physiology, 294(2):H764­H774, 2008. [53] RH Keldermann, KHWJ Ten Tusscher, MP Nash, CP Bradley, R Hren, P Taggart, and AV Panfilov. A computational study of mother rotor VF in the human ventricles. American Journal of Physiology-Heart and Circulatory Physiology, 296(2):H370­H379, 2009. [54] X Jie, V Gurev, and N Trayanova. Mechanisms of mechanically induced spontaneous arrhythmias in acute regional ischemia. Circulation research, 106(1):185­192, 2010. [55] HJ Arevalo, P Helm, NA Trayanova, et al. Development of a model of the infarcted canine heart that predicts arrhythmia generation from specific cardiac geometry and scar distribution. In Computers in Cardiology, 2008, pages 497­500. IEEE, 2008. [56] B Rodriiguez and N Trayanova. Upper limit of vulnerability in a defibrillation model of the rabbit ventricles. Journal of electrocardiology, 36:51­56, 2003. [57] N Trayanova, K Skouibine, and P Moore. Virtual electrode effects in defibrillation. Progress in biophysics and molecular biology, 69(2):387­403, 1998. [58] B Rodriguez, L Li, JC Eason, IR Efimov, and NA Trayanova. Differences between left and right ventricular chamber geometry affect cardiac vulnerability to electric shocks. Circulation research, 97(2):168­175, 2005. [59] B Rodr´ iguez, JC Eason, and N Trayanova. Differences between left and right ventricular anatomy determine the types of reentrant circuits induced by an external electric shock. A rabbit heart simulation study. Progress in biophysics and molecular biology, 90(1):399­413, 2006. [60] C Luo and Y Rudy. A model of the ventricular cardiac action potential. depolarization, repolarization, and their interaction. Circulation research, 68(6):1501­1526, 1991.

148

[61] T Ashihara, J Constantino, and NA Trayanova. Tunnel propagation of postshock activations as a hypothesis for fibrillation induction and isoelectric window. Circulation research, 102(6):737­745, 2008. [62] O Berenfeld and J Jalife. Purkinje-muscle reentry as a mechanism of polymorphic ventricular arrhythmias in a 3-dimensional model of the ventricles. Circulation Research, 82(10):1063­1077, 1998. [63] EJ Vigmond and C Clements. Construction of a computer model to investigate sawtooth effects in the purkinje system. Biomedical Engineering, IEEE Transactions on, 54(3):389­ 399, 2007. [64] D DiFrancesco and D Noble. A model of cardiac electrical activity incorporating ionic pumps and concentration changes. Philosophical Transactions of the Royal Society B: Biological Sciences, 307(1133):353­398, 1985. [65] M Deo, P Boyle, G Plank, and E Vigmond. Arrhythmogenic mechanisms of the purkinje system during electric shocks: a modeling study. Heart rhythm, 6(12):1782­1789, 2009. [66] P Boyle, S Masse, K Nanthakumar, and E Vigmond. Purkinje-myocardial coupling determines reentry type in simulations. Heart Rhythm, 7(5, Supplement):S258 ­ S318, 2010. [67] MJ Bishop, DJ Gavaghan, NA Trayanova, and B Rodriguez. Photon scattering effects in optical mapping of propagation and arrhythmogenesis in the heart. Journal of electrocardiology, 40(6):S75­S80, 2007. [68] H Arevalo, MJ Bishop, B Rodriguez, and NA Trayanova. Photon scattering during optical mapping distorts the spatiotemporal organization in VF. Heart Rhythm, 5:S359, 2008. [69] D Kelly, L Mackenzie, P Hunter, B Smaill, and DA Saint. Gene expression of stretchactivated channels and mechanoelectric feedback in the heart. Clinical and experimental pharmacology and physiology, 33(7):642­648, 2006.

149

[70] RH Keldermann, MP Nash, H Gelderblom, VY Wang, and AV Panfilov. Electromechanical wavebreak in a model of the human left ventricle. American Journal of Physiology-Heart and Circulatory Physiology, 299(1):H134­H143, 2010. [71] D Le Bihan, JF Mangin, C Poupon, CA Clark, S Pappata, N Molko, and H Chabriat. Diffusion tensor imaging: concepts and applications. Journal of magnetic resonance imaging, 13(4):534­546, 2001. [72] T Adam and U Hashim. COMSOL multiphysics simulation in biomedical engineering. Advanced Materials Research, 832:511­516, 2014. [73] K Magtibay, M Beheshti, FH Foomany, K Balasundaram, S Masse, P Lai, J Asta, N Zamiri, DA Jaffray, K Nanthakumar, et al. Fusion of structural and functional cardiac magnetic resonance imaging data for studying ventricular fibrillation. In Engineering in Medicine and Biology Society (EMBC), 2014 36th Annual International Conference of the IEEE, pages 5579­5582. IEEE, 2014. [74] FH Foomany, M Beheshti, K Magtibay, S Masse, W Foltz, E Sevaptsidis, P Lai, T Farid, N Krishnakumar, DA Jaffray, et al. 712 correlating current pathways with myocardial fiber orientation through fusion of data from current density and diffusion tensor imaging. Canadian Journal of Cardiology, 28(5):S372­S373, 2012. [75] M Beheshti, FH Foomany, K Magtibay, DA Jaffray, S Krishnan, K Nanthakumar, and K Umapathy. Noise distribution and denoising of current density images. Journal of Medical Imaging, 2(2):024005­1­024005­10, 2015. [76] FH Foomany, M Beheshti, K Magtibay, S Masse, P Lai, J Asta, N Zamiri, DA Jaffray, Sridhar Krishnan, K Nanthakumar, et al. A novel approach to quantification of real and artifactual components of current density imaging for phantom and live heart. In Engineering in Medicine and Biology Society (EMBC), 2014 36th Annual International Conference of the IEEE, pages 1075­1078. IEEE, 2014.

150

[77] M Beheshti, FH Foomany, K Magtibay, S Masse, W Foltz, E Sevaptsidis, P Lai, DA Jaffray, Sridhar Krishnan, K Nanthakumar, et al. Analysis of reliability metrics and quality enhancement measures in current density imaging. In Engineering in Medicine and Biology Society (EMBC), 2013 35th Annual International Conference of the IEEE, pages 4394­4397. IEEE, 2013. [78] P Libby and RY Kwong. Cardiovascular magnetic resonance imaging. Springer Science & Business Media, 2008. [79] GC Scott, MLG Joy, RL Armstrong, and RM Henkelman. Sensitivity of magnetic-resonance current-density imaging. Journal of Magnetic Resonance (1969), 97(2):235­254, 1992. [80] A C ¸ elik et al. MRI handbook: MR physics, patient positioning, and protocols. Springer Science & Business Media, 2011. [81] T DeMonte. Low frequency current density imaging cylindrical phantom experiment. University of Toronto, Toronto, ON, Tech. Rep, 2001. [82] D Le Bihan, E Breton, D Lallemand, P Grenier, E Cabanis, and M Laval-Jeantet. MR imaging of intravoxel incoherent motions: application to diffusion and perfusion in neurologic disorders. Radiology, 161(2):401­407, 1986. [83] V Flamini, C Kerskens, KM Moerman, CK Simms, and C Lally. Imaging arterial fibres using diffusion tensor imagingfeasibility study and preliminary results. EURASIP Journal on Advances in Signal Processing, 2010(1):904091, 2010. [84] P Douek, R Turner, J Pekar, N Patronas, and D Le Bihan. MR color mapping of myelin fiber orientation. Journal of computer assisted tomography, 15(6):923­929, 1991. [85] EW Hsu, AL Muzikant, SA Matulevicius, RC Penland, and CS Henriquez. Magnetic resonance myocardial fiber-orientation mapping with direct histological correlation. American Journal of Physiology-Heart and Circulatory Physiology, 274(5):H1627­H1634, 1998.

151

[86] Y Wu, C Zou, W Liu, W Liao, W Yang, DA Porter, X Liu, and EX Wu. Effect of b-value in revealing postinfarct myocardial microstructural remodeling using MR diffusion tensor imaging. Magnetic resonance imaging, 31(6):847­856, 2013. [87] S Arseneau. Junction Analysis. VDM Verlag, 2008. [88] JM Soares, P Marques, V Alves, and N Sousa. A hitchhiker's guide to diffusion tensor imaging. Frontiers in neuroscience, 7:1­14, 2013. [89] S Pajevic, C Pierpaoli, et al. Color schemes to represent the orientation of anisotropic tissues from diffusion tensor data: application to white matter fiber tract mapping in the human brain. Magnetic Resonance in Medicine, 42(3):526­540, 1999. [90] A Fedorov, R Beichel, J Kalpathy-Cramer, J Finet, JC Fillion-Robin, S Pujol, C Bauer, D Jennings, F Fennessy, M Sonka, et al. 3D slicer as an image computing platform for the quantitative imaging network. Magnetic resonance imaging, 30(9):1323­1341, 2012. [91] P Mildenberger, M Eichelberg, and E Martin. Introduction to the DICOM standard. European radiology, 12(4):920­927, 2002. [92] DC Ghiglia and MD Pritt. Two-dimensional phase unwrapping: theory, algorithms, and software, volume 4. Wiley New York:, 1998. [93] L Ying. Phase unwrapping. Wiley Encyclopedia of Biomedical Engineering, 2006. [94] HM Ozaktas and L Onural. Three-Dimensional Television: Capture, Transmission, Display. Signals and Communication Technology. Springer, 2008. [95] RC Gonzalez, RE Woods, and SL Eddins. Digital image processing using MATLAB. Pearson Education India, 2004. [96] JH Mathews and KD Fink. Numerical methods using MATLAB, volume 31. Prentice hall Upper Saddle River, NJ, 1999.

152

[97] JS Lim. Two-dimensional signal and image processing, volume 1. Englewood Cliffs, NJ, Prentice Hall, 1990. [98] P Perona and J Malik. Scale-space and edge detection using anisotropic diffusion. Pattern Analysis and Machine Intelligence, IEEE Transactions on, 12(7):629­639, 1990. [99] K Dabov, A Foi, V Katkovnik, and K Egiazarian. Image denoising by sparse 3D transformdomain collaborative filtering. Image Processing, IEEE Transactions on, 16(8):2080­2095, 2007. [100] S G¨ oktepe and E Kuhl. Computational modeling of cardiac electrophysiology: a novel finite element approach. International journal for numerical methods in engineering, 79(2):156­ 178, 2009. [101] RR Aliev and AV Panfilov. A simple two-variable model of cardiac excitation. Chaos, Solitons & Fractals, 7(3):293­301, 1996. [102] JM Rogers and AD McCulloch. A collocation-galerkin finite element model of cardiac action potential propagation. Biomedical Engineering, IEEE Transactions on, 41(8):743­ 757, 1994. [103] FJ Van Capelle and D Durrer. Computer simulation of arrhythmias in a network of coupled excitable elements. Circulation research, 47(3):454­466, 1980. [104] MP Nash and AV Panfilov. Electromechanical model of excitable tissue to study reentrant cardiac arrhythmias. Progress in biophysics and molecular biology, 85(2):501­522, 2004. [105] D Noble. A modification of the hodgkinhuxley equations applicable to purkinje fibre action and pacemaker potentials. The Journal of Physiology, 160(2):317­352, 1962. [106] RE McAllister, D Noble, and RW Tsien. Reconstruction of the electrical activity of cardiac purkinje fibres. The Journal of physiology, 251(1):1­59, 1975.

153

[107] KHWJ Ten Tusscher and AV Panfilov. Cell model for efficient simulation of wave propagation in human ventricular tissue under normal and pathological conditions. Physics in medicine and biology, 51(23):6141­6156, 2006. [108] C Luo and Y Rudy. A dynamic model of the cardiac ventricular action potential. i. simulations of ionic currents and concentration changes. Circulation research, 74(6):1071­1096, 1994. [109] N Trayanova, J Eason, and F Aguel. Computer simulations of cardiac defibrillation: a look inside the heart. Computing and Visualization in Science, 4(4):259­270, 2002. [110] JP Keener and K Bogar. A numerical method for the solution of the bidomain equations in cardiac tissue. Chaos: An Interdisciplinary Journal of Nonlinear Science, 8(1):234­241, 1998. [111] TM Austin, DA Hooks, PJ Hunter, DP Nickerson, AJ Pullan, GB Sands, BH Smaill, and ML Trew. Modeling cardiac electrical activity at the cell and tissue levels. Annals of the New York Academy of Sciences, 1080(1):334­347, 2006. [112] RW Santos, G Plank, S Bauer, and EJ Vigmond. Parallel multigrid preconditioner for the cardiac bidomain model. Biomedical Engineering, IEEE Transactions on, 51(11):1960­ 1968, 2004. [113] EJ Vigmond, F Aguel, N Trayanova, et al. Computational techniques for solving the bidomain equations in three dimensions. Biomedical Engineering, IEEE Transactions on, 49(11):1260­1269, 2002. [114] G Strang and GJ Fix. An analysis of the finite element method. Prentice-Hall Englewood Cliffs, NJ, 1973. [115] JL Meek. A brief history of the beginning of the finite element method. International journal for numerical methods in engineering, 39:3761­3774, 1996.

154

[116] B. Cockburn. Discontinuous galerkin methods. ZAMM-Journal of Applied Mathematics and Mechanics/Zeitschrift f¨ ur Angewandte Mathematik und Mechanik, 83(11):731­754, 2003. [117] Prath P. Chaste:finite element implementations. Online, from Oxford University, June 2012 at https://chaste.cs.ox.ac.uk/. [118] S Filippi and C Cherubini. Multiphysics models of biological systems. In Proc. COMSOL Users Conference, Milano, Italy, 2006. [119] RH Clayton and MJ Bishop. Computational models of ventricular arrhythmia mechanisms: recent developments and future prospects. Drug Discovery Today: Disease Models, 2014. [120] A Sunderland, L Ju, W McRae, and DG Blair. Reducing the magnetic susceptibility of parts in a magnetic gradiometer. arXiv preprint arXiv:0709.1323, 2007. [121] JF Schenck. The role of magnetic susceptibility in magnetic resonance imaging: Mri magnetic compatibility of the first and second kinds. Medical physics, 23(6):815­850, 1996. [122] FC Yeh, VJ Wedeen, and WYI Tseng. Generalized-sampling imaging. Medical Imaging, IEEE Transactions on, 29(9):1626­1635, 2010. [123] LA McGill, TF Ismail, S Nielles-Vallespin, P Ferreira, AD Scott, M Roughton, PJ Kilner, SY Ho, KP McCarthy, PD Gatehouse, et al. Reproducibility of in-vivo diffusion tensor cardiovascular magnetic resonance in hypertrophic cardiomyopathy. J Cardiovasc Magn Reson, 14(86):1­15. [124] H Wei, M Viallon, BM Delattre, VM Pai, H Wen, H Xue, C Guetter, MP Jolly, P Croisille, and Y Zhu. In vivo cardiac diffusion tensor imaging in free-breathing conditions. Journal of Cardiovascular Magnetic Resonance, 15, Suppl 1(P231):1­2, 2013. [125] A Schuster, A Chiribiri, M Ishida, G Morton, M Paul, S Hussain, B Bigalke, D Perera, T Schaeffter, and E Nagel. Cardiovascular magnetic resonance imaging of isolated perfused pig hearts in a 3T clinical MR scanner. Interventional Medicine and Applied Science, 4(4):186­192, 2012. 155

[126] C Lee, K Jeon, S Ahn, HJ Kim, and EJ Woo. Ramp-preserving denoising for conductivity image reconstruction in magnetic resonance electrical impedance tomography. Biomedical Engineering, IEEE Transactions on, 58(7):2038­2050, 2011. [127] MJ Firbank, A Coulthard, RM Harrison, and ED Williams. A comparison of two methods for measuring the signal to noise ratio on MR images. Physics in medicine and biology, 44(12):N261­N264, 1999. [128] RB D'agostino, A Belanger, and RB D'Agostino Jr. A suggestion for using powerful and informative tests of normality. The American Statistician, 44(4):316­321, 1990. [129] Rebecca M Warner. Applied statistics: From bivariate through multivariate techniques. Sage, 2008. [130] R Harada and H Konno. Numerical analysis of aliev-panfilov model. Pacific Science Review, 12(1):74­76, 2010. [131] R.T. Hart. Generation of lofted NURBS curves for 3D model generation with COMSOL. Technical report, Ohio State University, Tech. Rep, 2013. [132] SM Shuaiby, MA Hassan, and M El-Melegy. Modeling and simulation of the action potential in human cardiac tissues using finite element method. Journal of Communications and Computer Engineering, 2(3):21­27, 2011. [133] RH Clayton, O Bernus, EM Cherry, H Dierckx, FH Fenton, L Mirabella, AV Panfilov, FB Sachse, G Seemann, and H Zhang. Models of cardiac tissue electrophysiology: progress, challenges and open questions. Progress in biophysics and molecular biology, 104(1):22­ 48, 2011. [134] Michelsen Centre. Solving the linear matrix direct and iterative solvers. Technical report, COMSOL, 2012. [135] A Miranda Neto, A Correa Victorino, I Fantoni, DE Zampieri, JV Ferreira, Delberis Lima, et al. Image processing using pearson's correlation coefficient: Applications on autonomous 156

robotics. In Autonomous Robot Systems (Robotica), 2013 13th International Conference on, pages 1­6. IEEE, 2013. [136] Z Wang, AC Bovik, HR Sheikh, and EP Simoncelli. Image quality assessment: from error visibility to structural similarity. Image Processing, IEEE Transactions on, 13(4):600­612, 2004.

157

