A NOVEL PREDICTIVE CONTROL STRATEGY FOR NEUTRAL-POINT CLAMPED CONVERTER WITH HARMONIC SPECTRUM SHAPING
By

Jaksa Rubinic
B.Sc, University of Novi Sad, Novi Sad, Serbia, 2010 M.Sc, University of Novi Sad, Novi Sad, Serbia, 2011

A thesis presented to Ryerson University in partial fulfillment of the requirements for the degree of Master of Applied Science in the Program of Electrical and Computer Engineering

Toronto, Ontario, Canada, 2016 © Jaksa Rubinic, 2016

Author's Declaration

I hereby declare that I am the sole author of this thesis. This is a true copy of the thesis, including any required final revisions, as accepted by my examiners. I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research.

I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

I understand that my thesis may be made electronically available to the public.

ii

A Novel Predictive Control Strategy for Neutral-Point Clamped Converter with Harmonic Spectrum Shaping
Jaksa Rubinic Master of Applied Science Electrical and Computer Engineering Ryerson University, Toronto, 2016

Abstract

This thesis proposes a new predictive control strategy to achieve fixed-switching frequency operation for a neutral-point clamped (NPC) inverter. The classical fixed-sampling frequency finite control-set model predictive control (FSF-FCS-MPC) operates with variable switching frequency, and thus produces spread-spectrum in an output current. The classical method also suffers from high computational complexity as the number of converter voltage levels increases. To overcome these issues, a high performance variable sampling frequency finite control-set model predictive control (VSF-FCS-MPC) strategy is proposed to control the power converters. The proposed control technique combines the advantages of space vector modulation (SVM) with a newly introduced mechanics to determine the appropriate sampling frequency. With these features the major requirements such as balancing of DC-link capacitor voltages, switching frequency minimization and common-mode voltage mitigation have been achieved with simultaneous elimination of even-order and inter-harmonics in the load current harmonic spectrum. The VSF-FCS-MPC strategy for current control with decoupled active/reactive power regulation of grid-connected multilevel converter was also analyzed. Moreover, a novel DC-link voltage balancing technique is presented which eliminates the need for balancing the capacitor voltages through cost function, and thus alleviates the weighting factor design. An introduction of SVM highly reduces the calculation time by considering only

iii

adjacent vectors, rendering FCS-MPC more suitable for implementation with multi-level converters with a number of voltage levels higher than three. Finally, the proposed control technique has been validated through simulation and experimental verification and a detailed comparison of VSF-FCS-MPC with FSF-FCS-MPC and SVM is presented.

iv

Contents
Author's Declaration...............................................................................................ii Abstract..............................................................................................................iii List of Figures......................................................................................................viii CHAPTER 1 - INTRODUCTION.............................................................................................................. 1 1.1 Introduction ......................................................................................................................................... 1 1.2 Converter Topologies .......................................................................................................................... 3 1.2.1 Two-Level Voltage Source Converter........................................................................................... 4 1.2.2 Three-Level NPC VSC ................................................................................................................. 5 1.2.3 Four-Level Diode Clamped VSC .................................................................................................. 7 1.2.4 AFE NPC Rectifier ....................................................................................................................... 8 1.3 Current Control Methods for the Converters ...................................................................................... 9 1.3.1 Linear Control with PWM or SVM ........................................................................................... 10 1.3.1.1 Pulse Width Modulation ..................................................................................................... 10 1.3.1.2 Linear Control with Space Vector Modulation ................................................................... 10 1.3.2 Hysteresis Current Control......................................................................................................... 13 1.4 Control Requirements ....................................................................................................................... 14 1.5 Motivation for the Research ............................................................................................................... 15 1.6 Organization of the Thesis ................................................................................................................. 16 CHAPTER 2 - MODEL PREDICTIVE CONTROL ............................................................................ 17 2.1 Introduction ....................................................................................................................................... 17 2.2 Predictive Control in Power Electronic .............................................................................................. 18 2.2.1 Predictive Control Types............................................................................................................. 19 2.2.2 Control Requirements and Challenges for Three-Level Converters .......................................... 20 2.3 The Concept of FCS-MPC ................................................................................................................ 21 2.3.1 FSC-MSC Operating Principle.................................................................................................... 22 2.3.2 Controller Design ....................................................................................................................... 25 2.3.3 Current FCS-MPC of a 2L-VSI .................................................................................................. 27 2.4 Applications of Model Predictive Control and Challenges............................................................... 29 2.5 Summary ........................................................................................................................................... 30 CHAPTER 3 - VARIABLE SAMPLING FREQUECNY MODEL PREDICTIVE CONTROL ...... 31 3.1 Introduction ....................................................................................................................................... 31 3.2 Virtual System Simulator Model for Harmonic Spectrum Shaping ................................................. 32 3.2.1 Vector Selection Using SVM ..................................................................................................... 34

v

3.2.2 Auxiliary MPC and Virtual Load Current Calculation .............................................................. 37 3.2.3 Load Current Verification .......................................................................................................... 39 3.2.4 Sampling Frequency Shifter and Constrains .............................................................................. 40 3.2.5 Capacitor Voltage Balancing using P/N/O States ...................................................................... 41 3.3 Inverter ­ Side Predictive Control with Load Current Spectrum Shaping ........................................ 43 3.3.1 Mathematical Model of NPC Inverter........................................................................................ 45 3.3.2 Discrete-Time Model for Prediction .......................................................................................... 46 3.3.3 Cost Function Evaluation ........................................................................................................... 47 3.3.4 Capacitor Voltage Balancing ..................................................................................................... 48 3.3.5 Common-mode Voltage Reduction............................................................................................ 49 3.3.6 Simulation Results with High Power Inverter ........................................................................... 49 3.3.6.1 Steady-state and transient characteristics ............................................................................ 50 3.3.6.2 P/N/O Voltage Balancing.................................................................................................... 52 3.3.6.3 Common-mode Voltage Elimination .................................................................................. 53 3.4 Rectifier ­ Side Predictive Control with Grid Current Spectrum Shaping ....................................... 54 3.4.1 Mathematical Model of NPC AFE Rectifier .............................................................................. 56 3.4.2 Discrete-time Model of NPC AFE Rectifier .............................................................................. 57 3.4.3 Rectifier Simulation Results ...................................................................................................... 57 3.5 Switching Frequency Targeting versus Number of Samples ............................................................ 58 3.6 Summary ........................................................................................................................................... 60 CHAPTER 4 - DSP IMPLEMENTATION AND EXPERIMENTAL VERIFICATION .................. 61 4.1 Introduction ....................................................................................................................................... 61 4.2 Inverter Simulation Results with Low Power ................................................................................... 61 4.3 DSP Implementation ......................................................................................................................... 65 4.3.1 Delay Compensation .................................................................................................................. 66 4.4 Experimental Results and Analysis................................................................................................... 67 4.5 Summary ........................................................................................................................................... 74 CHAPTER 5 - CONCLUSION................................................................................................................ 75 5.1 Technical Challenges and Work Contributions ................................................................................ 75 5.1.1 Technical Challenges with Model Predictive Control ............................................................... 75 5.1.2 Work Contributions.................................................................................................................... 76 APPENDIX ................................................................................................................................................ 78 Discretization methods........................................................................................................................ 78 Approximate solution using numerical integration ............................................................................. 78

vi

Exact solution...................................................................................................................................... 80 Reference following ............................................................................................................................ 81 Delay compensation ............................................................................................................................ 81 Calculation of future reference using Lagrange extrapolation ............................................................ 82 Calculation of future references using vector angel compensation..................................................... 83 Weighting Factors Adjustment for cost functions with secondary terms ........................................... 84 REFERENCES .......................................................................................................................................... 86

vii

List of Figures
Figure 1 - High power converter classification .............................................................................................. 3 Figure 2 - Two-level voltage source converter ............................................................................................. 5 Figure 3 - Three-level neutral-point clamped voltage source converter ......................................................... 6 Figure 4 - Four-level voltage source converter............................................................................................... 7 Figure 5 - NPC AFE rectifier ......................................................................................................................... 9 Figure 6 - Pulse width modulator for a three-phase inverter ...................................................................... 10 Figure 7 - Principles of space vector modulation ....................................................................................... 12 Figure 8 - Classical control scheme using SVM ......................................................................................... 12 Figure 9 - Hysteresis current control for a three-phase inverter ................................................................. 13 Figure 10 - Characteristics of predictive control .......................................................................................... 18 Figure 11 - Classification of predictive control ............................................................................................ 19 Figure 12 - FCS-MPC operating principle: (a) ideal theoretical case (b) implementation case..................... 23 Figure 13 - FSC-MPC generic control diagram ........................................................................................... 24 Figure 14 - Voltage vectors generated by a) two level converter, b) three-level converter ........................... 26 Figure 15 - Flow diagram of implemented control algorithm....................................................................... 28 Figure 16 - General concept of MPC with VSS.......................................................................................... 33 Figure 17 - Model of Virtual System Simulator ......................................................................................... 33 Figure 18 - VSS module for reference calculation and nearest vector selection ........................................ 34 Figure 19 - Two-level SVM: a) Division of sectors and regions, b) Regions 1 to 4 in Sector I ................. 35 Figure 20 - General current spectrum with SVM........................................................................................ 36 Figure 21 - VSS module for virtual load current generation ...................................................................... 37 Figure 22 - Auxiliary MPC flow diagram for the NPC inverter ................................................................. 38 Figure 23 - VSS module for virtual load current verification ..................................................................... 40 Figure 24 - VSS module for sampling frequency control ........................................................................... 40 Figure 25 - P/N/O state sorting ................................................................................................................... 42 Figure 26 - P/N/O states arranged by the cost function .............................................................................. 42 Figure 27 - P/N/O states arranged using an external algorithm .................................................................. 43 Figure 28 - Inverter side control, VSS with MPC ....................................................................................... 44 Figure 29 - Internal VSS structure for inverter ........................................................................................... 44 Figure 30 - NPC inverter circuit ................................................................................................................. 46 Figure 31 - Predictive current control method for the NPC inverter .......................................................... 47

viii

Figure 34 - Transient response of a high power NPC inverter ................................................................... 52 Figure 35 - DC-link voltage balancing by switching from auto  balancing to P/N/O .......................... 53 Figure 36 - Common-mode voltage elimination through cost function minimization ............................... 54 Figure 37 - Rectifier side control, VSS with MPC ..................................................................................... 55 Figure 38 - Internal VSS structure for rectifier ........................................................................................... 55 Figure 39 - Rectifier operation: a) grid currents, b) DC-link capacitor voltages, c) harmonic spectrum ... 58 Figure 40 - Ns versus inverter switching frequency targeting Ns = 14 ........................................................ 59 Figure 41 - Ns versus inverter switching frequency targeting fsw = 1000 Hz ............................................... 59 Figure 42 - Steady-state comparison of line-to-line voltages: a) SVM; b) FSF-MPC; c) VSF-MPC ........ 62 Figure 43 - Steady-state comparison of 3-phase currents: a) SVM; b) FSF-MPC; c) VSF-MPC .............. 63 Figure 44 - Transient response comparison: a) SVM; b) FSF-MPC; c) VSF-MPC ................................... 64 Figure 45 - Steady-state comparison of line-to-line voltages: a) SVM; b) FSF-MPC; c) VSF-MPC ............ 68 Figure 46 - Steady-state comparison of 3-phase currents: a) SVM; b) FSF-MPC; c) VSF-MPC .............. 69 Figure 47 - Performance comparison: a) THD versus switch. freq.; b) THD versus modulation index..... 71 Figure 48 - Transient response comparison: a) SVM; b) FSF-MPC; c) VSF-MPC ................................... 73 Figure 49 - Approximating Continuous-Time Controller ........................................................................... 78 Figure 50 - Different Types of Integral Approximations ............................................................................ 79 Figure 51 - Branch and bound algorithm to reduce the number of simulations required to obtain... ...... suitable weighting factors........................................................................... ..84

ix

CHAPTER 1 INTRODUCTION
1.1 Introduction
development of power electronics in the last few decades. Several industrial processes have increased their power-level needs, driven mainly by economies of scale (production levels and efficiency), triggering the development of new power semiconductors, converter topologies, and V gate-turn-off (GTO) thyristors became commercially available. The GTO was the standard for The field of high-power converters has been one of the most active areas in research and

control methods. The development of high-power converters started in the mid- 1980s when 4500high power applications until the advent of insulated-gate bipolar transistors (IGBTs) and gatecommutated thyristors (GCTs) in the late 1990s [1], [2]. These switching devices are now extensively used in high-power converters and drives due to their superior switching characteristics,

reduced power losses, ease of gate control, and snubberless operation. High-power converters have found widespread applications in industry. They can be used for pipeline pumps in the petrochemical industry or water pumping stations, fans in the cement industry, traction applications in the transportation industry, steel rolling mills in the metals industry, grid integration of renewableenergy sources, reactive-power compensation, and other applications. The most important requirements for these converters are: high efficiency, overload

capability, high reliability and operation in harsh environments. The converters can be generally classified into a few significant families: Cycloconverters (CCV), Current Source Converters (CSC) design, performance and control strategies. The VSI converts the DC voltage to a three-phase AC and Voltage Source Converters (VSC). All of these families have shown important advances in voltage with adjustable magnitude and frequency whereas the CSC converts the DC current to an topologies, consisting of a conventional two-level converter, a three-level and four-level neutralconverter [3-11]. Either IGBT or GCT can operate in these converters as a switching device.

adjustable three-phase AC current. Mostly used topologies in the industry include three-phase VSI point clamped converter, a seven-level cascaded H-bridge converter and a four-level flying-capacitor

1

due to its pivotal importance for proper operation of converters. Properly designed control More often, various issues in the operation of power converters can be solved through judicious

The control of power converters is one of the most elaborate fields in power electronics

mechanisms may increase reliability, efficiency and the overall robustness of an entire system. control optimization rather than using more complex and expensive hardware solutions. The control of power converters is a topic undergoing intense study and is constantly evolving according to technological developments in power quality standards, control requirements, grid code requirements, semiconductor devices, control platforms, etc.

components were developed to control the firing angles of thyristors in order for an output voltage to be controlled [12]. A few years later, fully controllable device named IGBT has been developed the past used analog control circuits, where a single-phase pulse width modulator or hysteresis [3], improving power converters and requesting more complex control systems. The converters in controller generates the gating signals. Analog control platforms present several drawbacks such as a large number of components, reduced system reliability and poor computational capability to name a few [13]. To achieve high performance operation, digital control techniques were

During the 1960s, analog control platforms based on operational amplifiers and passive

developed during the 1970s which involved powerful calculations, complex strategies and mathintensive algorithms. Introduction of digital signal processors (DSPs) has created the basis for the implementation of digital control techniques. The digital control platforms evolved rapidly and revolutionized the industrial control area by allowing the user to develop sophisticated control algorithms. A few examples of modern real-time (RT) digital control platforms include:

microcontrollers, DSP, and field programmable gate array (FPGA). These platforms have been reliability and high computational power [13-19].

used widely in the control of various power electronic converters and they feature low cost, more Highly exploited and very well studied control techniques include the hysteresis and linear

controllers. Over the years they have become widely accepted by the power electronics industry.

More recent and advanced control techniques include sliding-mode, intelligent and predictive

control techniques. The predictive control uses the system model to predict the future responses of philosophy emerged during the 1970s for the process control which are normally very slow in nature. The application of predictive control in power electronics is a rather recent topic due to the 2

a plant. These predictions are then used to generate the optimal control action. This control

fast processing time required to control the electric variables. With the evolution in DSPs, a wide range of predictive controllers have been developed which includes deadbeat and hysteresis-based predictive control, trajectory-based predictive control, and model-based predictive control.

1.2 Converter Topologies
The design of power converters is faced with a number of challenges that relate to topologies and control as well as power semiconductor switching devices. One of the major requirements is to produce high quality waveforms and this is particularly important in a grid connected operation to reduce the device switching impact. In inverters and rectifiers, the waveforms are affected by the following factors: 1) the topology used; 2) the application; 3) the control algorithm; 4) the size of the filter; and 5) the choice of switching frequency [3, 20, 21]. Based on a method of achieving variable output in terms of magnitude and frequency the high-power converters can be classified into two main categories: direct AC­AC converters and indirect AC-DC-AC converters. The latter group introduces a link between two converters which can be of voltage or current nature. Both groups with their representatives have certain advantages and disadvantages, which should be taken into account when selecting the topology for a given application. The general classification of high power converters is provided in Figure 1.

High Power Converters

Indirect conversion (DC ­ link)

Current Source

Voltage Source

PWM Current Source Inverter

Load Commutated Inverter

Multilevel converters

High Power 2-level VSI

Single DC source

Multiple isolted DC sources

High Power Semiconductors Medium Power Semiconductors

NPC

Cascaded H-Bridge

Figure 1 - High power converter classification 3

level converter. However, at medium and high voltages the situation is completely different. Multilevel converter technology started with the introduction of the multilevel stepped waveform concept with a series-connected H-bridge, which is also known as cascaded H-Bridge converter,

At low voltage, a single topology that still dominates the market is the voltage-source two-

in the late 1960s [22]. This was closely followed by low-power development of an FC topology the same year [23]. Finally, in the late 1970s, the diode-clamped converter (DCC) [24] was first introduced. The DCC concept evolved into the three-level NPC (3L-NPC) converter we know for medium-voltage applications.

today as it was proposed in [8, 25] and can be considered as the first real multilevel power converter Multi-level converters provide a wide range of advantages over two-level topology such as

better waveform quality, lower dv/dt operation, reduced switch stress levels and many more. They are finding increased attention in industry and academia as one of the preferred choices of into the industry and therefore can be considered a mature and proven technology. Although it is electronic power conversion for high-power applications. They have successfully made their way an enabling and already proven technology, multilevel converters present a great deal of research and development is still growing in depth and width. Researchers all over the world are of multilevel converters, and broaden their application field as they become more attractive and competitive than classic topologies. 1.2.1 Two-Level Voltage Source Converter three-phase AC voltage with variable magnitude and frequency. The twolevel VSI is the main applications. The two-level topology presented in Figure 2 is one of the most commonly used topologies in the industry. The primary function of a voltage source converter is to convert a fixed DC voltage to a

challenges, and even more importantly, they offer such a wide range of possibilities that their contributing to further improve energy efficiency, reliability, power density, simplicity, and cost

building block for ACDC and ACDCAC converter systems for low and medium-power

capacitor as a DC-link. The presence of these active switches along with a proper control scheme,

The converter is composed of an array of six switching devices, typically IGBTs and a

allows the generation of sinusoidal currents at the input side, a fully adjustable power factor and a bidirectional power flow. Both carrier based pulse-width modulation (PWM) and space vector 4

modulation can be applied to generate the switching patterns for the 2L-VSC [3]. In addition, variable switching frequency methods as table or prediction based methods can also be used [12].

S1a Vd S1a a

S1b b

S1c c
LOAD

S1b

S1c

Figure 2 ­ Two-level voltage source converter and Vd, while the line-to-line voltage presents a three-level waveform. This impacts the total harmonic distortion (THD) of the input current, as larger active/passive filters or higher switching frequencies are needed in order to meet the limits imposed by the grid code. Even though the main As its name suggests this converter generates a binary pulse train, alternating between 0

features of this converter are its simplicity, modularity and low number of power components, they suffer from unwanted traits such as high dv/dt, static and dynamic voltage sharing and commonmode voltage (CMV). Some of these problems are solved with the invention of multilevel topologies. However, these topologies require a higher number of power devices, which increases the complexity of the design.

Multilevel Voltage Source Converters
application is to utilize a multilevel voltage synthesis strategy. Conceptually, the multilevel VSC configurations can be divided into:    Diode-clamped multilevel VSC, Another option for a VSI system to accommodate the voltage requirements of a high-power

H-bridge-based multilevel VSC,

Capacitor-clamped multilevel VSC.

1.2.2 Three-Level NPC VSC produce AC voltage waveforms with multiple levels can be generally configured as a three-, four-, 5 These types of converters employing clamping diodes and cascaded DC capacitors to

or five-level topology, but only the three-level converter, often known as the neutral-point clamped converter has found a wide application in high-power medium-voltage drives [7,8]. The schematic of the NPC converter is presented in Figure 3.

features two additional diodes per phase leg. These diodes link the midpoint of the "indirect series connection" of the main switches to the neutral point of the converter. This allows the connection of the phase output to the converter neutral point and enables the three-level characteristic of the topology. There are 27 switch states, whereas the two-level converter allows eight switch states not comprising a "0" state. Hence, the clearly superior output voltage quality is the most distinct advantage over the two-level converter. The three-level converter compared to a two-level VSC of reduced switch stress levels and it does not have dynamic voltage sharing problem.

Compared to a two-level converter with a direct series connection of devices the NPC VSC

the same rating can achieve reduced dv/dt and THD in its AC output voltages, lower switching losses,

C1 Z C2

S1a S2a a S1a S2a

S1b S2b b

S1c S2c c
LOAD

S1b S2b

S1c S2c

Figure 3 - Three-level neutral-point clamped voltage source converter voltages of its DC-bus capacitors at their prescribed (usually equal) levels and to prevent voltage drifts during the steady-state and dynamic regimes. Conceptually, there are two approaches to deal circuitry. The auxiliary circuitry can be a set of independent power supplies for capacitors, or it can with the DC capacitor voltage drift phenomenon. The first approach is to utilize an auxiliary power be a dedicated electronic converter that injects current into the capacitors and regulates their voltages. One main technical requirement for proper operation of the NPC converter is to maintain the

The approach is, however, not appealing for power systems applications due to its cost and 6

complexity. The second approach to equalize the voltages of the DC-side capacitors of a NPC

converter is to enhance the converter control strategy and, to modify the switching patterns of the

switches such that the capacitor voltages are regulated at their corresponding desired values. Another drawback of this topology is an increased number of components and complicated PWM switching pattern. 1.2.3 Four-Level Diode Clamped VSC carries similar features. The number of components is increased to 6 switches and 6 diodes per leg. is necessary. Four-Level NPC converter is an extension of the three-level NPC converter which means it

The clamping diodes withstand different reverse voltages and thus a series connection of two diodes

C1

S1a S2a S3a S1a

S1b S2b S3b S1b S2b S3b b

S1c S2c S3c S1c S2c S3c c
LOAD

C2

a

C3

S2a S3a

Figure 4 ­ Four-level voltage source converter point voltages that need to be balanced. The balancing techniques are similar to those used with the 3-level converter. The converter is presented in Figure 4. In the topology, only three switches conduct at any time and the switch pairs ( , ), ( , ), ( , ) operate in a complementary manner. The DC-link voltage is divided between 3 capacitors connected in series forming two neutral

A total of 37 voltage vectors with 64 switching combinations are available for the converter. The

main advantage of this converter is an increased switching frequency, which leads to a better power 7

quality or grid code compliance in case of grid connection. The converter can also be operated at higher voltage levels without connecting the switching devices in series. topologies versus the 2-level VSC is presented in Table I. Table I ­ Comparison of required power components
2L-VSC 3L-NPC VSC

A brief summary of the number of power components required in most common multilevel

3L-FLC VSC

4L-FLC VSC

5L-CHB VSC

Number of IGBTs Number of diodes Number of flying capacitors Number of LC filter capacitors / inductors

6 x 6.5 kV 6 23

12 x 3.3 kV 18 3/3 36

12 x 3.3 kV 12 3 3/3 33

18 x 2.5 kV 18 6 3/3 48

24 x 1.7 kV 24 3/3 54

Total component count

1.2.4 AFE NPC Rectifier transformation from alternating current to direct current performed by rectifiers is used in a large Rectifiers are by far the most widely used converters in power electronics. The

variety of applications (from small power up to several megawatts). There are three distinct types of rectifiers, the first of which is the diode rectifier. The main advantages of the diode rectifier are its simplicity and extremely low cost. · · · The disadvantages and limitations of the three-phase diode rectifier are that: it does not offer the possibility to control the power flow, it does not allow regeneration of power. it generates high harmonics at the input current, especially when it supplies a capacitive load, The second topology of importance is the thyristor rectifier which introduces the possibility

of control of power flow by changing the angle of the gate pulses  for the thyristors. Through angle  control, it is possible to change the mean value of the load voltage, regulating the control of power

delivered to the load. Thyristor rectifiers have in general the same advantages and limitations as the diode rectifiers. An additional negative feature is that an increase in the value of  increases the phase 8

displacement of the input current with respect to the source AC voltage, increasing the amount of fundamental reactive power. An advantage of thyristor rectifiers is that, in operating with they can regenerate power from the DC load to the power supply.

> 90,

S1a S2a
GRID

S1b S2b a S1b S2b
Figure 5 - NPC AFE rectifier

S1c S2c b c

C1 Z C2 R

S1a S2a

S1c S2c

the main power switches. This rectifier operates with high switching frequency and is also known as

The third important rectifier topology includes power transistors with antiparallel diodes as

an active front-end (AFE) rectifier. A three-level NPC AFE rectifier is presented in Figure 5. It

carries all the same features as the NPC converter, as it shares the 3-level topology, except for the power flow which is inverse. The AFE rectifier overcomes all the problems and limitations of the diode and thyristor rectifiers. Its main features are: 1. Controlled DC voltage.

2. Controlled input currents with sinusoidal waveform (reduced harmonics). 3. Operation with high power factor. 4. Full regenerative operation.

1.3 Current Control Methods for the Converters
there are two classical control methods that have been extensively studied over the last few decades: namely, linear control using pulse width modulation and hysteresis control [21, 26, 27]. 9 One of the most studied topics in power converters control is a current control, for which

1.3.1 Linear Control with PWM or SVM of the converter allows one to linearize the nonlinear converter. In this way, any linear controller can be used. The most common choice being used is the proportional­integral (PI) controller. 1.3.1.1 Pulse Width Modulation and the output of the comparator is used to drive the inverter switches. A sinusoidal reference voltage is compared to the triangular carrier signal generating a pulsed voltage waveform at the voltage. In a three-phase inverter, the reference voltage of each phase is compared to the triangular waveform, generating the switching states for each corresponding inverter leg, as in Figure 6.
* a

Considering a modulator stage for the generation of control signals for the power switches

In a pulse width modulator, the reference voltage is compared to a triangular carrier signal

output of the inverter. The fundamental component of this voltage is proportional to the reference

Sa

+
b*

-

vcr Sb

Driver Sa Driver

V

T1 T2

T3 T4

T5 T6  ab ib b  bc ic c

+
c*

-

cr Sc

N
a

ia a

b n

c

+

-

cr

 cr

* a

a)

 b*

 c*

0

t

1.3.1.2 Linear Control with Space Vector Modulation

Figure 6 ­ Pulse width modulator for a three-phase inverter

b)

the voltage vectors of the converter are calculated from the reference vector. It is based on the vector representation of the three-phase voltages, defined as 10

A variation of PWM is called space vector modulation, in which the application times of

= where , and

(

+

+

) =
/

(1) . The

output voltages of the inverter depend on the switching state of each phase and the DC-link voltage, of each phase, the three-phase inverter generates the voltage vectors listed in Table II. Table II - Switching states and voltage vectors Sa 0 1 1 0 0 0 1 1 0 0 1 1 1 0 0 1 Sb 0 0 0 0 1 1 1 1 Sc Voltage vector V =0 2 = 3 + =

are the phase-to-neutral voltages of the inverter and

, with x ={a, b, c}. Then, taking into account the combinations of the switching states

3 3 1 3 = - + 3 3 2 =- 3 1 3 = - - 3 3 1 3 = - 3 3 =0 =

1 3

six sectors, as shown in Figure 7(a). In this way, a given reference voltage vector v*, located at a during tk, tk+1 and t0, respectively. This can be summarized with the following equations:


Considering the voltage vectors generated by the inverter, the  ­  plane is divided into

generic sector k (Figure 7b), can be synthesized using the adjacent vectors Vk, Vk+1 and V0, applied = ( = + + + + ) (2) (3)

where T is the carrier period and tk/T, tk+1/T and t0/T are the duty cycles of their respective vectors. Using trigonometric relations the application time for each vector can be calculated, resulting in =
| |

(cos( - 11

)-

(



)

)

(4)

=

=

| |

(

-

-



)

(6)

(5)

where  is the angle of the reference vector v*and k is the angle of vector Vk.

between the reference and the measured load current is processed by a PI controller to generate the reference load voltages.


A classical current control scheme using SVM is shown in Figure 8. Here, the error

Sector 2
3

V k+1
tor Sec

V3 (010)

V2 (110)


Se cto

Sec to r

rk

* VS (100) V1

V4

cto r

(011) 60° (000) V 0,7 (111) (001) V5



V k+1

VS*

1

Vk


Se

Figure 7 ­ Principles of space vector modulation. (a) Voltage vectors and sector definition, (b) Generation of the reference vector in a generic sector
i*
+ -

With this method, constant switching frequency, fixed by the carrier, is obtained. The performance the reference current.

of this control scheme depends on the design of the controller parameters and on the frequency of Although the PI controller assures zero steady state error for continuous reference, it can 12

present a noticeable error for sinusoidal references. This error increases with the frequency of the

r4 cto Se

6

(101) V6

Sector 5

V 0,7

Vk

k



a)

b)

v* i

Space Vector Modulation (SVM)

Sa Sb Sc v

3

LOAD

Figure 8 ­ Classical control scheme using SVM

reference current and may become unacceptable for certain applications [27]. To overcome the problem of the PI controller with sinusoidal references, the standard solution is to modify the reference currents are constant values. 1.3.2 Hysteresis Current Control by changing the switching state of the converter each time the current reaches the boundary. Figure 9(a) shows the hysteresis control scheme for a three-phase inverter.
T1 T2
N

original scheme considering a coordinate transformation to a rotating reference frame in which the

The basic idea of hysteresis current control is to keep the current inside the hysteresis band

V
* ia

T3 T4 ia a a

T5 T6 ib b b n ic c c



Sa

+-

ia

Sa

Driver Driver

 ab

 bc

i

* ia

a)
ia

0

t

Here, the current error is used as the input of the comparator and if the current error is higher than

Figure 9 ­ Hysteresis current control for a three-phase inverter

b)

the upper limit /2, the power switch T1 is turned on and T2 is turned off. The opposite switching states are generated if the error is lower than -/2. It can be observed in Figure 9(b) that with this simple strategy the load current which in this case is sinusoidal. follows the waveform of the reference current 13


very well,

corresponding references using hysteresis comparators. Each comparator determines the switching

For a three-phase inverter, measured load currents of each phase are compared to the

state of the respective inverter leg (Sa, Sb and Sc) such that the load currents are forced to remain within the hysteresis band. Due to the interaction between the phases, the current error is not strictly limited to the value of the hysteresis band.

circuits or processors. The performance of the hysteresis controller is good, with a fast dynamic parameters, and operating conditions. This is one of the major drawbacks of hysteresis control, since variable switching frequency can cause resonance problems. In addition, the switching losses restrict the application of hysteresis control to lower power levels [27]. Several modifications have implemented in a digital control platform, a very high sampling frequency is required in order to keep the controlled variables within the hysteresis band all the time.

This method is conceptually simple and the implementation does not require complex

response. The switching frequency changes according to variations in the hysteresis width, load

been proposed in order to control the switching frequency of the hysteresis controller. When

1.4 Control Requirements

and stability of the system. Currently, industry requires more demanding technical specifications

Traditionally, control requirements were mainly associated with the dynamic performance

and constraints, and in many cases it is subject to regulations and codes. Many of these requirements enforce operating limits and conditions that cannot be dealt with by the hardware only, but also need to be addressed by the control system. This shift in trend has driven the development of more advanced control methods. The design of an industrial power electronic systems can be seen as an optimization problem where several objectives must be fulfilled at the especially important: same time. Among these requirements, constraints, and control challenges, the following are  provide the smallest possible error in the controlled variables, with fast dynamics for  operate the power switches in such a way that switching losses are minimized. This requirement leads to increased efficiency and better utilization of the semiconductor devices; reference following and disturbance rejection;

14

 power converters are switched systems that inherently generate harmonic content. Usually this harmonic content is measured as THD. Many power converter systems have limitations are usually specified in standards that can change from one country to another; defined standards and regulations; and restrictions on the harmonic content introduced by the modulation stage. These limits  the electromagnetic compatibility (EMC) of the system must be considered, according to  in many systems, common-mode voltages must be minimized due to the harmful effects lifetime of some systems;

that they can produce. These voltages induce leakage currents that reduce the safety and

 good performance for a wide range of operating conditions. Due to the nonlinear nature of single operating point of the linearized system model;

power converters, this is difficult to achieve when the controller has been adjusted for a

 some converter topologies have their own inherent restrictions and constraints such as forbidden switching states, voltage balance issues, power unbalances, mitigation of resonances, and many other specific requirements.

1.5 Motivation for the Research
making a significant impact in research field as well as in the market. Among predictive techniques, Considering the trends in control of power converters it can be seen that predictive control is

deadbeat control and MPC stand out due to their good properties. An implementation of MPC for power converters can be difficult due to the large number of calculations. A solution is found in FCS-MPC, which takes into account only the finite number of possible switching states, and can be implemented on various converters and rectifiers, uninterruptible power supplies, active filters and motor control. Some of the dominant features of FCS-MPC, such as simple and convenient algorithm for digital implementation, absence of linear controllers and the ability to easily include different

easily implemented using standard control hardware. The FCS-MPC has so far been successfully

control objectives make its research potential constantly growing. Despite of this good features, the FCS-MPC has two main drawbacks which make its application in industrial power converters difficult. The FCS-MPC needs a high sampling frequency to achieve high performance and, a large

number of calculations required for high-level converters combined with an extended prediction

horizon could make implementation impossible. Another significant issue of FCS-MPC is a non15

constant switching frequency producing widespread spectrum frequencies of generated currents and of power converters.

voltages. This fact leads to necessity for large passive filters, increasing the weight, volume and cost This thesis aims to investigate and solve some of the current issues associated with FCS-

MPC. Variable sampling frequency model predictive control has been proposed to achieve spectrumshaping for the NPC converter. The proposed control technique simultaneously considers load elimination of even-order and inter-harmonics in the load current harmonic spectrum, and fixedswitching frequency operation. The challenges associated with weighting factor design are also

current control, balancing of DC-link capacitor voltages, mitigation of common-mode voltage,

addressed. Through simulation and experimental verification on a low-power NPC converter, it has been demonstrated that the proposed method preserves high dynamic performance nature of MPC, and predefined harmonic spectrum characteristic of space vector modulation.

1.6 Organization of the Thesis

converter topologies and most established control techniques in industry. This section also provides

The thesis is divided into five chapters. Chapter 1 provides a brief introduction to power

the motivation for the research in field of model predictive control. Chapter 2 presents detailed

analysis of MPC, its operating principles, application and current issues. Chapter 3 is the main body of the thesis which presents a theoretical background with proposed solutions to the addressed issues in MPC presented in Chapter 2. Simulation results are also provided in this chapter. Chapter 4 presents experimental results and analysis along with DSP implementation of variable sampling frequency. Chapter 5 makes an overview of main contributions of this work and provides conclusions.

16

CHAPTER 2 MODEL PREDICTIVE CONTROL
2.1 Introduction
development of new control schemes must take into account the real nature of these kinds of systems. Power converters and especially drives are nonlinear systems of a hybrid nature, including linear and nonlinear parts and a finite number of switching devices. The input signals for power electronic devices are discrete signals that command the turn-on and turn-off transitions of each device. Several Considering the increasing demands in performance and efficiency of power converters, the

constraints and restrictions need to be considered by the control, some of which are inherent to the reasons, like current limitations to protect the converter and its loads.

system, like the maximum output voltage of the converter, while others are imposed for security All the characteristics of power converters, as well as the characteristics of the control

platforms, converge in a natural way to the application of model predictive control. The main characteristic of MPC is to use a model of the system to predict future behavior of the controlled number of switching states, minimization of the cost function through multiple iterations produces the optimal actuation for the switches. MPC may easily consider numerous control objectives, just becomes alleviated. Combined with modern digital processors it became prosperous control technique with ever growing potential. This chapter extends the discussion on control methods to one of newly introduced control variables. The main body of the model predictive control is the cost function. In case of a finite

by inclusion of appropriate terms into the cost function. In such a way, the design of the controller

strategies in power electronics, model predictive control. Different classes of predictive control challenges are discussed in this chapter. It further provides an example of the design process for as well as defining appropriate prediction horizon are also discussed. Finally, up-to-date challenges solving problems in predictive control applied to multi-level VSC. 17

algorithms, operating principles, algorithms, block diagrams, advantages and flexibility, as well as current control of two-level converter with necessary discretization steps. Digital implementation in MPC are presented. This chapter builds the foundations for the research which is focused on

2.2 Predictive Control in Power Electronic
Nowadays, practically all control strategies are implemented in digital control platforms running at discrete time steps. Design of any control system must take into account the model of the plant for adjusting the controller parameters, which in the case of power converters is well known. Control platforms offer an increasing computational capability thus more calculation-demanding control algorithms are feasible today. As described before, due to the nature of predictive control, various constraints and objectives could be easily implemented. Along with the known mathematical models of the converters and considering the finite number of switching states, predictive control has stand up as a mighty alternative to classical control methods. The main features converging toward predictive control are summarized in Figure 10, which highlights the characteristics that lead to simple control schemes for the control of power converters and drives.
Characteristics of power converters and drives Characteristics of present day control systems

Nonlinear systems

Discrete-time implementation

Finite number of switching states

Predictive Control

Known models of power converters and drives

Constraints

Fast control platforms

Figure 10 - Characteristics of predictive control Predictive control includes a wide class of controllers that have found rather recent application in power converters. It avoids the cascaded structure, which is typically used in a linear control scheme, obtaining fast transient responses. Nonlinearities of a system can be included in the 18

model, thus avoiding the need to linearize the model for a given operating point and improving the operation of the system for all conditions. It is also possible to include restrictions to some variables when designing the controller. 2.2.1 Predictive Control Types feature of predictive control is to use the model of the system in order to predict future values of The classification of different predictive control methods is shown in Figure 11. The main

controlled variables. This information is used by the controller to obtain the optimal actuation,

according to a predefined optimization criterion. The optimization criterion in the hysteresis-based predictive control is to keep the controlled variable within the boundaries of a hysteresis area, while in the trajectory based control the variables are forced to follow a predefined trajectory.
Predictive Control

- Needs a modulator - Fixed switching frequency - Low computations - Constraints not included

Deadbeat control

- No modulator - Variable switching frequency - Simple concepts

Hysteresis based

- No modulator - Variable switching frequency - No cascaded structure

Trajectory based

Model Predictive Control (MPC)

- Needs a modulator - Fixed switching frequency - Constraints can be included

MPC with continuous control set

- No modulator - Variable switching frequency - Online optimization - Low complexity (N=1) - Constraints can be included

MPC with finite control set

control, eliminates the classic linear controller by using a predictive model of the system. This model

One of the earlier predictive controllers used in power converters, so-called dead-beat

Figure 11 ­ Classification of predictive control

is used to calculate the required reference voltage in order to reach the desired reference value for a

certain variable (usually the current). The predicted reference voltage is later generated by the [34], rectifiers [35, 36], active filters [37, 38], and uninterruptible power supplies (UPSs) [39, 40]. 19

converter via a modulation stage. This scheme has been applied for current control of inverters [28]­

Another approach emerged called model predictive control, in which a model of the system is considered in order to predict the future behavior of the variables. MPC is based on a minimization of the cost function which may include different control objectives and constraints. Using discretized equations, it is possible to predict the future value of the controlled variables, obtaining the future control actions. The difference between these groups of controllers is that deadbeat control and MPC with

continuous control set need a modulator, in order to generate the required voltage. This will result in the converter, do not need a modulator, and present a variable switching frequency.

having a fixed switching frequency. The other controllers directly generate the switching signals for MPC has several advantages, such as easy inclusion of nonlinearities and constraints. This

scheme has few applications in power converter control due to high amount of calculations needed to solve the optimization problem online, which is incompatible with small sampling times used in problem offline, as presented in [41], where MPC is implemented as a search tree and the calculation converter control. One solution in order to reduce the calculation time is to solve the optimization time is reduced, making it possible to use the MPC in drive control. Another solution is the use of

Generalized Predictive Control (GPC) [42], where the optimization is solved analytically, obtaining a linear controller. Nevertheless, with GPC, it is very difficult to include system constraints and nonlinearities. Another approach to implement MPC for power converters takes advantage of the inherent

discrete nature of power converters. Since power converters have a finite number of switching states,

the MPC optimization problem can be simplified and reduced to the prediction of the system behavior only for those possible switching states. Then, each prediction is used to evaluate a cost function (also known as quality or decision function), and consequently, the state with minimum control actions (switching states) are finite. This method is also known as finite alphabet MPC or [12].

cost is selected and generated. This approach is known as a finite control set MPC since possible simply as predictive control, and it has been successfully applied to a wide range of power converters 2.2.2 Control Requirements and Challenges for Three-Level Converters to be used in high-power, medium-voltage industrial applications. They can synthesize near sinusoidal voltages while increasing the number of levels, leading to good power quality and 20 Multilevel converters are recognized as among the most suitable and efficient candidates

smaller output filters. In addition, higher levels of MV operation can be achieved without

connecting the switching devices in series. The most popular and well-known multi-level topologies are flying capacitor, cascaded H-bridge and diode-clamped converters. By using clamping diodes to divide the DC-link voltage among several capacitors, different configurations, ranging from three-level to m-level diode-clamped converters can be obtained.

Multi-level diode-clamped converters are suitable for many industrial applications such as: systems, and general MV motor drive applications (pumps, fans, etc.) In these applications, current control is one of the most important issues and it has been widely studied in literature.

STATCOM, train traction, ship propulsion, regenerative conveyors, wind and photovoltaic energy

Especially when the number of levels increases, the switching actions in three-level converters lead to an imbalance among the DC-link capacitor voltages. Usually, redundant switching states operation at low switching frequency in order to minimize the switching losses and to allow proper are used for proper balancing. Another important challenge for diode-clamped converters is the heat dissipation. This requirement can be accomplished with the PWM and SVM techniques by simply changing the carrier frequency. Unfortunately, low order harmonics are produced by the PWM and SVM techniques when operated below 1 kHz leading to poor output current quality. in the converter output voltages and this leads to higher common-mode voltage. The commoncommon-mode voltage through improvements in PWM/SVM techniques is a cost effective and levels.

DC-link capacitor voltage balancing is one of the main issues in diode-clamped converters.

One more critical issue is that fast switching actions of the semiconductor devices cause high dv/dt mode voltage is undesirable when multi-level converters are used in motor drives. Mitigation of attractive solution. However, the complexity of the SVM increases with the number of converter The finite control-set model predictive control takes over the functions of linear regulators

and SVM/PWM modulators. To accomplish the aforementioned control requirements, they can be assigned coefficients. This leads to fast and convenient implementation on digital processors.

described in a single cost function and the importance of each term can be weighted by using

2.3 The Concept of FCS-MPC

behavior of the variables (until a predefined horizon in time), 2) and selection of optimal actuations 21

The common elements of FSC-MPC are: 1) using a model of the system to predict the future

by minimizing a cost function for a finite number of states. This structure has several important advantages:  concepts are intuitive and easy to understand;

 it can be applied to a great variety of systems;  dead times can be compensated;  simple treatment of constraints;

 the multivariable case can be easily considered;  easy inclusion of nonlinearities in the model;  the resulting controller is easy to implement; specific applications.

 this methodology is suitable for the inclusion of modifications and extensions depending on However, there are certain disadvantages that are stated below:  larger amount of calculations for high-level converters;  the quality of the model has a direct influence of the quality of the resulting controller;  variable switching frequency caused by absence of a modulator. The quality of the model has a direct influence on the quality of the resulting controller. If

parameters of the system change with time, some adaptation or estimation algorithm must be considered. 2.3.1 FSC-MSC Operating Principle control action S(t) (usually the gate signals of the converter) that will drive a generic system variable The control problem for power converters can be defined as determining of an appropriate

x(t) as close as possible to a desired reference value x*(t). Consider the qualitative behavior of x(t) and its regularly sampled value x(tk) over a sample period Ts for a system with a finite number of control actions n, as shown in Figure 12(a), where measurements, computations, and control actions are performed instantly (i.e., ideal case). Since the control actions or control set is finite in number

Si with i = 1, . . . , n, they can be evaluated together with the measured value x(tk), based on a prediction function fp, to predict all possible system transitions xpi(tk+1) = fp{x(tk),Si}, for i = 1, . . . , n.

22

system. To determine which of the control actions is to be selected, a decision or cost function fg predictions can be defined, usually dependent on the desired reference value and the prediction gi = fg{x*(tk+1), xi(tk+1)} for i = 1, . . . , n. Note that a future reference value is needed x*(tk+1), which can dynamic behavior of the system, and thus, the reference can be considered constant over Ts. If needed be assumed to be equal to the actual value x*(tk), since Ts is sufficiently small compared with the for highly dynamic systems, the future reference value x*(tk+1) can be estimated via appropriate extrapolation methods. A typical example for fg would be the absolute error between the predictions and the reference gi = |x*(tk+1) - xpi(tk+1)|. The evaluation of the cost function with n predictions leads is selected to control the system.

This prediction function is directly derived from the discrete model and parameters of the

to n different costs. Naturally, control action leading to the minimum cost (min{gi}, for i = 1, . . . , n)

x
x(t) x* (t)

TS
S1 S2 S3 Sn

xp1(tk+1 )

TS
S1 S2 S3 Sn

. . .

xp2(tk+1 ) xp3(tk+1 ) xpn(tk+1 )

xp1(tk+2) xp2(tk+2)

. . .

xp3(tk+2) xpn(tk+2) tk+2

tk

x
x(t) x* (t)

1 step
st

TS

(a)

tk+1

t

2 step
nd

TS
S1 S2 S3 Sn

S3

xp2(tk+2) xp3 (tk+2) xpn(tk+2)

xp1 (tk+2)

. . .

tk

Figure 12 ­ FCS-MPC operating principle: (a) ideal theoretical case (b) implementation case

(b)

tk+1

tk+2

t

reference x*(tk+1), hence, S3 is selected and applied at t = tk. Following the same criterion, S2 is selected and applied in t = tk+1. However, the ideal theoretical case in which the variables can be measured, predicted, and controlled instantly in t = tk is not feasible in real-time applications. 23

Based on the example shown in Figure 12(a), the predicted value xp3(tk+1) is the closest to the

Nevertheless, this problem can be overcome if a two-step-ahead prediction is considered, as shown determined. This way, a complete sample period Ts is available to perform the algorithm.

in Figure 12(b), in which the control action to be applied in the following sample time S(tk+1) is Naturally, the sample period Ts has to be greater than the measurement, computation, and

actuation times added together. Assume that on a sample time tk, a measurement x(tk) is made and a first prediction can be made to obtain the future value x(tk+1) (this is the first step prediction).

the previously computed control action S(tk) is applied. With this information and the system model, Now, from the predicted value xp(tk+1), the FCS-MPC algorithm is performed for n possible

control actions, leading to one optimal selection S(tk+1) (this is second step prediction). Both predictions are performed during the first sample period, and then, at t = tk+1, the optimal selected control action S(tk+1) is applied, while x(tk+1) is measured to perform the algorithm again. As shown in the example in Figure 12(b), there is only one prediction for the first step, given by the applied selected from n predictions for the second step.
x*( k) Predictive model x(k+1) n

control action S(tk) = S3 determined in the previous execution of the algorithm, while S(tk+1) = S2 is

Minimization S of the cost function
x (k) measurements

Load

x(k)

in Figure 13, considering a generic system variable x(t). It is worth mentioning that this control perturbations, saturations, and, basically, every characteristic that can be mathematically modeled

A simplified control block diagram for the real-time implementation of FCS-MPC is shown

Figure 13 ­ FSC-MPC generic control diagram

method is not limited to a single variable; on the contrary, multiple variables, system constraints, and measured can be included in the predictive model and cost function. This is the basis of a great flexibility and control potential that can be achieved with FCS-MPC. Moreover, the fact that power converters have a reduced and limited number of switching states (or control set) makes this method

feasible for implementation with presently available microprocessing resources. Since only a

discrete model of the system is necessary, rather than approximated linear models (together with 24

control system design theory and modulation algorithms), a simpler and more direct design and implementation of the controller are achieved. 2.3.2 Controller Design identified: · · · In the design stage of FCS-MPC for the control of a power converter, the following steps are

modeling of the power converter with identifying all possible switching states and its relation to the input or output voltages or currents, defining a cost function that represents the desired behavior of the system, controlled.

obtaining discrete-time models for prediction of the future behavior of the variables to be When modeling a converter, the basic element is the power switch, which can be an IGBT,

a thyristor, a gate turn-off thyristor (GTO), or others. The simplest model of these power switches states of a power converter is equal to the number of different combinations of two switching states short-circuit the DC-link. As a general rule, the number of possible switching states N is =

considers an ideal switch with only two states: on and off. Therefore, the total number of switching of each switch. However, some combinations are not possible, for example, those combinations that (7)

where x is the number of possible states of each leg of the converter, and y is the number of phases

(or legs) of the converter. In this way a three-phase, two-level converter has N = 23 = 8 possible switching states, a three-phase, three-level converter has N = 33 = 27 switching states, and a fivephase, two-level converter has N = 25 = 32 switching states. In some multilevel topologies the number bridge converter, where the number of switching states is more than 16 million. of switching states of the converter can be very high, as in a three-phase, nine-level cascaded HAnother aspect of converter model is the relation between the switching states and the voltage

levels, in the case of single-phase converters, or voltage vectors, in the case of three-phase or multiphase converters. For current source converters, the possible switching states are related to current generate the same voltage vector. vectors instead of voltage vectors. It can be found that, in several cases, two or more switching states 25

different voltage vectors, with two switching states generating the zero vector. In a three-phase, three-level converter there is a major redundancy, with 27 switching states generating 19 different voltage vectors. Figure 14 depicts the relation between switching states and voltage vectors for two switching states may be different.

For example, in a three-phase, two-level converter, the eight switching states generate seven

different converter topologies. In some other topologies, the method of calculating possible
V

V3

V2
S 2 =(1,1,0)

S 3 =(0,1,0)

V4

S 4 =(0,1,1)

S 1 =(1,0,0) S 0 =(0,0,0) S 7 =(1,1,1) S 5 =(0,0,1) S 6 =(1,0,1)

V1 V0,7

V

V5

(a)
Im

V6

V11
(-,+,-)

V10

V9
(+,+,-)

(0,+,-)

V12
(-,+,0)

(0,+,0) (-,0, -)

V3

(-,+,+)

V13

(0,+,+) (-,0,0)

V4

(-,-,-) (0,0,0) (+,+,+) (0,0, +) (-,-,0)

V0

(+,+,0) (0,0, -)

V2

(+,0, -)

V8

(+,0,0) (0,-,-)

V1

(+,-,-)

V7

Re

(-,0, +)

V14

V5

(+,0, +) (0,-,0)

V6

(+,-,0)

V18

(-,-,+)

V15

(0,-,+)

V16

Figure 14 ­ Voltage vectors generated by a) two level converter, b) three-level converter 26

(b)

(+,-,+)

V17

control, torque control, power control, low switching frequency, etc. These requirements can be expressed as a cost function to be minimized. The most basic cost function measures the error error, etc. However, one of the advantages of the predictive control methods is the possibility to between a reference and a predicted variable, for example, load current error, power error, torque control different types of variables and include restrictions in the cost function. In order to deal with different units and magnitudes of the controlled variables, each term in the cost function is multiplied by a weighting factor that can be used to adjust the importance of each term.

Each application imposes several control requirements on the systems such as: current

to get discrete-time models that can be used for prediction of these variables. It is also important to

When building a model for prediction, the controlled variables must be considered in order

define which variables are measured and which ones are not measured, because in some cases will be needed. To get a discrete-time model it is necessary to use some discretization methods. For first-order systems it is simple to approximate the derivatives using the Euler forward method, i.e., using 
( ) ( )

variables that are required for the predictive model are not measured and some kind of estimation

(8)

where Ts is the sampling time. However, when the order of the system is higher, the discrete-time

model obtained using the Euler method is not precise because the error introduced by Euler's method be used.

for higher order systems is significant. For these higher order systems, an exact discretization must 2.3.3 Current FCS-MPC of a 2L-VSI principle analyzed in this section. The variable x(t) would be the current is; the control action S(t) represents the switching states (Si, with i = 0, . . . , 7) of the converter. The predictive model corresponds to the discrete time model of the load, with Euler approximation of the current derivative, which leads to = ( )= 27
( ) ( )

The FCS-MPC current control problem can be easily derived from the generic operating

(9) (10)

( [1

] )

where is(tk) is the measured current and vi(tk+1) is the voltage vector generated by the switching states minimized is

Si, with i = 0, . . . , 7. Additionally, note that ips = ip + jip. Finally, the cost function that needs to be ( )=


-

+



-

(11)

The corresponding simplified block diagram of the current FCS-MPC is shown in Figure 15 as a flow diagram.
Apply S( jop ) Sampling i*(k), i(k) ê(k) = v(k) + L i(k- 1) - RTS +L TS i( k)

TS

g op =  for j = 0:7 v( j ) = S( j )Vdc 1 [ Li(k) + TSv(k+1) - TS e(k+1) ]

i(k+1) =

RTS + L

p * p g = | i* - i | + | i- i |

if (g ( j ) < g op) g op = g ( j ) jop = j

j=7 yes

no

Figure 15 ­ Flow diagram of implemented control algorithm 28

switching frequency is variable, leading to a spread current spectrum. As shown in the flow diagram, this current control is performed in the following steps: 1. the value of reference current is obtained and the load current is measured; interval for each voltage vector;

The FCS-MPC does not force a commutation in each sample period. Hence, the average

2. the model of the system is used to predict the value of the load current in the next sampling 3. the quality function g evaluates the error between reference and predicted currents in the next sampling interval. The voltage that minimizes the current error is selected and applied to the load.

cyclical prediction for each voltage vector, evaluating the quality function, and storing the minimum value and the index value of the corresponding switching state.

As shown in the diagram, the minimization of the quality function can be implemented as

2.4 Applications of Model Predictive Control and Challenges
over 1 kHz are considered inconvenient. In fact most common switching frequencies are found around 500 Hz for IGBT and IGCT based converters. The use of lower switching frequencies introduces a mayor trade-off between efficiency and high dynamic performance, and has been a challenge in power electronics for decades. For power conversion systems in the megawatt range, device average switching frequencies

pre-calculate the behavior of the system for a predefined horizon in the future. The standard

Model predictive control is a powerful control strategy that uses the model of the system to

implementation of predictive current control calculates the voltage required by the load to get the used for the control of single-phase and three-phase inverters, inverters with output LCL filter,

desired current. Then this voltage is applied using pulse width modulation. This scheme has been rectifiers and active filters, and uninterruptible power supplies. This concept has also been used for torque control of induction machine. It is also possible to calculate the duty cycles for the converter instead of the voltages. Some works have been presented using this scheme for current control in a three-phase inverter and a matrix converter, flux and torque control of an induction machine [43], and direct power control in an active front end rectifier [44]. It is also possible to include and control different variables using a single cost function. For 29

instance, while the current is controlled, at the same time, the cost function minimizes the switching

frequency and balances the DC-link voltages in a neutral point clamped converter. This approach is

easily extended to the drives, where the entire system can be easily modelled including potential for a wide range of application and an ever growing research potential.

nonlinearities. The fact is that the versatility and universality of MPC approach delivers great In all applications the switching states are changed at equidistant time instants. However,

lack of modulation stage leads to a variable switching frequency producing spread voltage spectrum its potential for practical implementation. As discussed above, high number of converter voltage

over a range of frequencies. This is certainly one of the most significant issues in MPC which reduces levels generates many possible switching states. Due to extensive calculation required, real-time

implementation of MPC for high-level converters becomes troublesome. Moreover, weighting factor work in Chapter 3 presents solutions to some of the problems stated.

design faces significant problems as an optimized procedure has not been presented up-to-date. The

2.5 Summary

discussion of various classes of predictive control techniques. The operating principle of FCS-

In this chapter state-of-the-art converter control techniques are reviewed followed by the

MPC is discussed for ideal and implementation cases. The implementation of current control applications of model predictive control and technical challenges are also presented.

strategy has been discussed for 2-level converter through a flow diagram. Furthermore, the The strategy introduced in this chapter leverages the discrete nature of power converters

and microprocessors. The predictive control has proven to be effective with a good dynamic response and compares well with the classical methods. The use of linear and nonlinear controllers power of today's existing DSPs makes this method attractive to control power converters. Even though the method might be simple in case of 2-level converter, the control algorithm might calculations. is avoided. In addition, it is not necessary to include any type of modulator. The high calculation

become difficult to implement for some multilevel converters due to the extensive number of The results and analysis show that predictive control is a strong tool with a conceptually

different approach that opens up new possibilities for power converters control, especially in the field of multi-level converter based systems.

30

CHAPTER 3 VARIABLE SAMPLING FREQUECNY MODEL PREDICTIVE CONTROL
3.1 Introduction
rectifiers and inverters. One of the newest control methods with numerous advantages over classical control is certainly model predictive control. As many of control objectives could be simultaneously considered and easily implemented without the need for a cascaded control, MPC becomes promising solution to control the converters in the future. As discussed in a previous chapter, various control strategies can be used to control

predictive control that still has not been fully solved. The work in [45] proposes preliminary study on using a discrete Fourier transform (DFT) in the cost function to solve this issue. The authors in

Spread spectrum and variable switching frequency is a well-known problem with model

[46] presented a frequency weighted cost function to shape the harmonic spectrum. The addition of secondary control objectives to cost function reduces the relative importance of primary control objective, i.e., load current control. As a result, the quality (total harmonic distortion) of the load current deteriorates. The variable switching frequency nature with these two works is still determines the time each vector will be applied for. This method is able to concentrate the spectrum unanswered. In [47] the authors incorporate duty-cycle calculation into cost function which around certain frequency. However, the authors use a very high inverter switching frequency. It is

not clear how the method performs if the switching frequency was lower. Furthermore, the experimental results are not provided to support theoretical analysis. The work in [48] proposes selective harmonic elimination for predictive control. This concept fixes the switching frequency but only mitigates certain harmonics in the spectrum. The current waveform is not half-wave symmetrical and some low-order triplen harmonics are still present.

spectrum and variable switching frequency by introducing variable sampling frequency concept.

This work aims to solve the challenges associated with the FCS-MPC such as spread

This method uses an auxiliary algorithm to calculate the number of sampling points to be used in the main predictive control algorithm. This approach combines the working principles of the FCSswitching frequency operation as in SVM. MPC and space vector modulation to achieve high dynamic performance as in FCS-MPC and fixed 31

elimination of even-order harmonics and spectrum shaping. The proposed strategy was verified with the NPC converter, since it presents more challenges compared to a standard two-level converter. Multiple objectives are considered at the same time, such as: load current control,

In this chapter a variable sampling frequency model predictive control is presented for the

balancing of the DC-link capacitor voltages, common-mode voltage mitigation and elimination of are presented for both NPC rectifier and inverter configurations.

even-order harmonics in the load current harmonic spectrum. The corresponding simulation results

3.2 Virtual System Simulator Model for Harmonic Spectrum Shaping
as the control does not use a modulator. This issue leads to a variable switching frequency. Due to unsynchronized sampling between the measurements and output fundamental frequency, the chosen states (voltage vectors) vary from the selected switching states in the preceding cycle. The containing integer and non-integer multiples of the fundamental frequency. resulting switching does not fit into a pattern, leading to a spectrum with spread frequencies, To solve the spectral problem, a novel variable sampling frequency finite control-set model The very well-known characteristic of FCS-MPC is that a switching pattern does not exists

predictive control (VSF-FSC-MPC) is proposed for spectrum shaping and fixed switching frequency operation. The objectives of the proposed control strategy can be summarized as:    even-order harmonic elimination and spectrum shaping for inverters and rectifiers; frequency operation for spectrum shaping;

ability to maintain primary control objective with minimum error during fixed switching ability to fulfill secondary control objectives, such as voltage balancing or common-mode voltage mitigation/elimination while maintaining primary control objective and spectrum shaping;

 

rectifier active and reactive power control and capacitor voltage balancing with even-order harmonic elimination for grid-friendly operation; inverter/rectifier switching frequency control.

based on the operating conditions. The proposed concept whose general block scheme is presented 32

Variable sampling operation requires sampling frequency to be continuously adjusted

in Figure 16 introduces a control algorithm named virtual system simulator (VSS). The function of the VSS block is to simulate the power converter system with its load and locate an appropriate sampling frequency based on a simulated waveforms of required variables. It uses MPC to develop the data which will be analyzed on the existence of harmonics which should be eliminated from the spectrum. The VSS operates in parallel with main MPC and is implemented as its subroutine. providing convenient implementation on modern control hardware.
Virtual System Simulator Input

The VSS entity is fully described in C/C++ language and therefore reflects the FCS-MPC concept

fsam
Main Model Predictive Control Output

visually separated into four stages based on their function. First stage uses SVM concept to determine the position of the reference vector (

A more detailed version of the VSS is presented in Figure 17. The VSS structure can be ) and to locate the nearest three vectors that

Figure 16 ­ General concept of MPC with VSS

surround the reference vector. Secondly, the VSS uses an internal MPC to simulate the behavior of a power converter system. This module was named auxiliary model predictive control (AMPC) and is clocked at a sampling rate fed from the sampling frequency shifter block.
Sampling frequency shifter Calculate Apply frequency Y N Calculate nearest 3 vectors Harmonic verification AMPC sampling frequency Pattern verification

Virtual load current calculation Cost function minimization ... ...

v (k)
*

Auxiliary MPC ... ...

Virtual System Simulator

Figure 17 ­ Model of Virtual System Simulator 33

This module also carries the VSS waveform simulator/plotter which calculates the load waveforms. Subsequently, the produced waveforms are subjected to harmonic analysis which is done in third stage. Finally, the last stage is a frequency shifter and its function is to control the segments is explained with more details in the upcoming sections. 3.2.1 Vector Selection Using SVM at any time instant for a given reference current. The intensity and position of reference vector is calculated based on the reference current and Vc are selected based on nearest-three criterion with regard to the position of
 

sampling frequency with respect to setup operating conditions and restrictions. Each of these

The space vector hexagram is used to select the vectors available to predictive controller . Then as presented in figure 18, three vectors Va, Vb


imposed on the vectors has a significant impact on shape of the produced waveforms. If the controller in not allowed to randomly select vectors from a group of 27 available for the threeswitching sequence inside a fundamental cycle.

. The limitation

level converter, but is forced to use only three selected vectors, a pattern begins to appear in the
VSS

i*

Calculate v *(k)

v *(k)

Calculate nearest 3 vectors

Va,Vb,Vc

Figure 18 ­ VSS module for reference calculation and nearest vector selection prevents the cost function from considering the vectors arbitrarily. Performance-wise, in integration of SVM into MPC yields significant improvements by reducing the time needed for cost function assessment. For instance, if a number of available vectors at any point in time is not level converter. The appearance of a pattern during steady-state operation is due to the fact that SVM

greater than three, the calculation burden on the processor could be reduced up to 9 times for threeUsing SVM diagram presented in Figure 19(a) with all possible vectors and their states for

through the following expression:

the NPC converter, the intensity of

, i.e., the position of the peak of the vector is calculated =






(12)

34

Based on the intensity of the vector and its angular distance from the x-axis it is possible to assess its exact position, i.e. the region the vector is located in. All the lengths in Figure 19(b) are assumed By using trigonometry expressions, the following dynamic models are derived: = = =
 
 

where, i* is the reference current, Vdc is the converter DC-link voltage and IB is the base current.

to be multiplied by Vdc, but for the sake of simplicity the multiplication is not pictured in the figure.

(13) (14) (15)

( )





V15 NPN SECTOR III V9 NPO OPP NOO

SECTOR II OPN V8

V14 PPN 4 2 SECTOR I V7 PON POO ONN 3

OPO NON V4

V3

V2

PPO OON

4 TcV4
3 6

V16 NPP NOP V10 SECTOR IV

PPP NNN

1 OOO

V1

V13 PNN

vref

x3c
3

TbV3

OOP NNO

V5

V6

POP ONO

PNO V12 SECTOR VI PNP V18

x3a
3 6

x3b
2

NNP V17

1

Figure 19 ­ Two-level SVM: a) Division of sectors and regions, b) Regions 1 to 4 in Sector I and it is calculated during each sampling period Ts. The above expressions are used to calculate of the reference vector is then compared with the calculated length to determine its position. For the origin to the point on x3a-side for the given . If the intensity (length) of 35 instance, to determine if is located in region 1, expression (13) is used to find the length from The expressions in (13)-(15) need angle  which is obtained from -frame coordinates

V11 ONP SECTOR V

TaV1

the length from the origin to any point located on the sides of triangle 3 (Figure 19b). The intensity

is less than the

length from the origin to the point on x3a-side, side to determine whether

is higher than x3a and if  is less than 30 , then expression (14) is used to calculate the dot on x3bis located in region 3 or 2. We conclude that if the intensity of is located in region 2. If it is less, it is positioned in region

is located in region 1. Further, if the intensity

is higher than the calculated length,

3. The same principle is used for determining the position in regions 3 and 4.

switching sequence a special care has to be taken to the distribution of the dwell times and their one small vector among the nearest three and, secondly when the reference vector is located in region 1, there are two small vector of whom one is dominant half of the time.
50

The conventional SVM scheme uses a predefined switching sequence. In the design of a

correct arrangement. There are two possible cases that have to be considered. First, there is only

45 40

Mag (% of Fundamental)

30 25 20

35

15 10 0 5 0 5 10 15 20 25 30 35

Figure 20 ­ General current spectrum with SVM sequence B. It can be observed that type-A sequence should start with an N-type small vector while For even-order harmonic elimination two types of sequences should exist: sequence A and

Harmonic Order

type-B sequence should commence with a P-type small vector. Combining sequence A and B even-

order harmonics can be eliminated with a slight increase in current THD. Figure 20 presents a using SVM.

THD of the line-to-line voltage with implemented even-order harmonic elimination, obtained by Even though the SVM combined with FCS-MPC represents a significant step toward

spectrum shaping, it is only the combination of the variable sampling frequency and applied 36

restrictions in SVM-based operation that establishes the right conditions for complete elimination

of undesired spectral components in the load current. Therefore, further techniques constitute necessary steps toward final pattern design. 3.2.2 Auxiliary MPC and Virtual Load Current Calculation mechanics inside the VSS. It is important to note that the AMPC operates only in VSS and therefore is not directly related to the main MPC, i.e., AMPC does not control the converter. The AMPC however uses the same power converter model as MPC. An internal loop of the AMPC is is fed to the AMPC. The AMPC is then executed until one full fundamental cycle of the load current is calculated and stored for analysis. Cost function minimization delivers actuation for the switches S1x and S2x, which produces virtual currents iav, ibv and icv.
fsample
AMPC sampling frequency Auxiliary MPC

The VSS concept employs auxiliary model predictive control as a separate control

presented in Figure 21. The sampling frequency fsample determined by the frequency shifting block

VSS

vc1 ,vc2
p

ip ,

p

Cost function minimization

S1x,S2x

Virtual load current calculation

iav,ibv,icv

Figure 21 ­ VSS module for virtual load current generation If stored 3-phase current waveforms after analysis contain harmonics to be removed from the spectrum, the data storing registers will be flushed and the AMPC is restarted to develop new

virtual current at a different internal sampling frequency. The flow diagram of the AMPC is presented in Figure 22. It can be observed that AMPC considers only 3 vectors according to the implemented SVM. Selected vectors are applied to the virtual load and the measurements are fed back to the AMPC.

generate a set of values that will be analyzed on existence of various harmonic frequencies. The block generates virtual currents and stores the data by dynamically assigning memory space for the arrays. Subsequently, these values are used by the AMPC and compared with their virtual

Since THD estimation requires at least one complete fundamental cycle it is required to

references to calculate the error whose attempt of minimization will deliver required virtual voltage of the currents for one or more complete cycles. Once the train of information is formed, it is used 37

vector to be applied at k+1 horizon. Continuing in this fashion, we obtain an actual extrapolation

for harmonic analyzes. To develop the current waveforms, the virtual load current calculation block uses time domain load model.
Obtain i (k), vc1 (k), vc2 (k)

x = 0, gopt = inf

x=x+1

i p (k  1)  (1 

RTs Ts )i ( k )  v ( k ) L L

1 i c 1( k )T s C 1 vc 2 p ( k  1)  vc 2 ( k )  ic 2 ( k )T s C v c 1 p ( k  1)  v c 1( k ) 
* P * P P P g | i  i |  | i  i | dc | vC 1  vC 2 |

If(g<gopt){gopt = g xop = x}

yes

no

x = 3?
yes

Apply optimal vector v(k)

Figure 22 ­ Auxiliary MPC flow diagram for the NPC inverter Virtual load currents are calculated using expressions (16)-(18):  =  =  =
     

-(

   

-  )   -   -  )   -  
 



(16) (17) (18)

-( -(

 

-  )   -  

38

where Van, Vbn and Vcn are the phase to neutral voltages whose values are to be calculated based on selected switching signals , , and known DC-link voltage Vdc as: - - - -

= - -

(19)

Furthermore, Ioa, Iob and Ioc are the initial conditions that must to be known at the point in time where the switching signals change. The initial conditions are calculated using the same expressions (16)-(18) but with previously used vector, right before the calculation of the currents expressions are calculated with each VSS clock.

Ia, Ib and Ic using new assigned vector. In order for the algorithm to function properly, these Even though the load equations introduce time t and not sample time Ts, it is important to

note that t is also discretized, as the VSS eventually gets implemented on a digital processor. The recommended resolution of the calculated virtual output current is 64 times higher than the AMPC AMPC has to be internally slowed down in a ratio of 64:1. blocks. If this test passes, the correct 3.2.3 Load Current Verification

sampling frequency. Knowing that both AMPC and the waveform plotting part are parts of VSS, In the next stage of VSS the currents are passed through a pattern/harmonic verification

the DSP are set accordingly to match the new sampling rate.

is determined and the counter compare registers of

converter controlled by the MPC contain only the harmonics of interest is the verification module. This module utilizes two-step verification and is presented in Figure 23. The first step consists of analyzing the sequence of vectors across 6 SVM sectors in a fundamental cycle based on calculated comparison between arrays of integers. The block output is a signal which defines if the verification process continues or the pattern have failed to appear in the switching sequence. If the assume the current spectrum does not contain even or triplen harmonics. However, if the pattern 39

The main part of the VSS which assures that the produced output waveforms in the

virtual load currents iav, ibv and icv. This kind of verification is fast since it only requires a

pattern exist, further verification is required since establishing a pattern does not necessarily

does not exist the loop process is reset and starts from the beginning with different sampling frequency.
yes
no

iav,ibv,icv

VSS

iav,ibv,icv Harmonic Pattern verification verification

Figure 23 ­ VSS module for virtual load current verification uses the Discrete Fourier Transform (DFT) on a window with a high number of samples taken per virtual current fundamental cycle. Finally, the output result of the harmonic verification block approves or discards current sampling frequency, depending on spectrum content. If the block The second block in the chain performs a thorough harmonic verification. The algorithm

outputs a positive value, the sampling frequency used in the VSS is correct for the given operating shifter will provide the new sampling frequency based on given requirements and constraints. 3.2.4 Sampling Frequency Shifter and Constrains for the entire VSS. The block calculates the new frequency each time the VSS indicated current sampling frequency as not optimal through sampling frequency shift request.
fshift
VSS Sampling frequency shifter

conditions. If not, the sampling frequency is marked not optimal and the sampling frequency

The frequency shifter block presented in Figure 24 provides variable sampling frequency

fsample

Figure 24 ­ VSS module for sampling frequency control In order to provide the data to the controller in equidistant time points, the sampling frequency has been synchronized with the fundamental frequency of output load current. Considering the space-

vector diagram, there are 6 sectors, each phase shifted by 60 degrees. The correct synchronization sampling frequency can be obtained through equation (20), 40

requires the number of samples (Ns) to be the same integer in each of 6 sectors. Therefore, the

=

6

(20) is the required load current

where Ns stands for the number of samples per sector and

fundamental frequency or the grid frequency. It is required to provide Ns dynamically to obtain the switching pattern under any condition, producing spectrum content without even or triplen order harmonics. 3.2.5 Capacitor Voltage Balancing using P/N/O States Since pattern in the switching sequence can be created by using the VSS, it is now possible to The proposed VSS concept opens an alternative way for balancing the capacitor voltages.

balance the DC-link voltages by judiciously sorting the P and N states of small vectors. The

influence of each type of vectors to the DC-link voltage can be analyzed as follows. Since the neutral point Z is left unconnected, the switching state PPP does not affect VZ. Similarly, the other two zero switching states, OOO and NNN, do not cause VZ to shift either. With the P-type

switching state the three-phase load is connected between the positive DC bus and neutral point Z, switching state makes VZ decrease. The medium-voltage vectors also affect the neutral-point drop. Considering large vectors the load terminals are connected between the positive and negative DC buses. The neutral point Z is left unconnected, and thus the neutral voltage is not affected. To minimize the neutral-point voltage deviation, the dwell time of a given small vector can

therefore, the neutral current iz flows into Z causing VZ to increase. On the contrary, the N-type voltage. Depending on the converter operating conditions, the neutral-point voltage VZ may rise or

be equally distributed between the P- and N-type switching states over a sampling period. According to the triangular region that the reference vector is in, the following two cases are investigated. In the first case there is one small vector among three selected vectors. To minimize

the neutral voltage deviation, the dwell time for the small vector should be equally distributed between the P- and N-type states. In the second case two out of three selected vectors are small distributed. vectors. Again, to reduce the neutral voltage deviation, the dwell time should be equally If the states are correctly arranged it is possible to maintain the voltages balanced under

normal operating conditions. This way a nice feature emerges to control the inverter switching frequency. For instance, by sorting the states in a different order, but keeping the distribution of 41

the dwell-times equal, the operating switching frequency can be utilized differently. The resulting action will only affect the capacitor voltage ripple.
Detect length Ns Choose length SL Sort for minimum number of of the pattern of PN sequence
transitions

Alternate pattern in the next sector

Within yes switching frequency limit no

Figure 25 ­ P/N/O state sorting In a sense, the DC-link capacitor voltage ripple becomes decoupled from load current control in terms of converter switching frequency. Only a slight increase in current THD is expected with the increase in voltage ripple. The algorithm for sorting the vectors is presented in Figure 25.

Sector I

OOO

ONN

POO

OOO

OON

POO

PPO

OON

V0

V1

V1

V0

V2

V1

V2

V2

Sector II

OOO
V0

PPO
V2

OON
V2

OOO
V0

OPO
V3

PPO
V2

NON
V3

OPO
V3

Figure 26 ­ P/N/O states arranged by the cost function The algorithm consists of a several stages. Once the pattern is defined by the VSS it can go through P/N/O states arrangement and the desired switching frequency versus DC-link voltage ripple will be calculated. In the first stage it is required to detect Ns that was decided by the control. The next stage is to choose SL, i.e., how many identical P or N states can appear in series. At least 2 same states need to be positioned next to each other in order to minimize the switching frequency. After the length of the sequence is determined the algorithm proceeds with sorting the states of the vectors in such a manner that reduces the switching frequency as much as possible. In the next stage, the sequence inverses and will be applied in the forthcoming sector. An average switching frequency is calculated to check if the pattern with newly sorted states satisfies the switching frequency criterion. 42

Sector I

OOO
V0

POO
V1

POO
V1

OOO
V0

OON
V2

ONN
V1

PPO
V2

PPO
V2

Sector II

OOO
V0

OON
V2

OON
V2

OOO
V0

OPO
V3

PPO
V2

NON
V3

NON
V3

Figure 27 ­ P/N/O states arranged using an external algorithm and algorithmic P/N/O balancing. The pattern in Figure 26 was created by the control for the given references and the VSS was applied to shape the spectrum. In Figure 27, the same pattern is depicted, except the states of the small vectors are arranged by the algorithm for switching frequency minimization. The P/N/O sorting resulted in decrease of the switching frequency from 1150 Hz to 850 Hz. The DC-link voltage was set to 10780V and the voltage ripple increased from 80V to 150V. The simulation analysis shows the comparison between the cost function voltage balancing

3.3 Inverter ­ Side Predictive Control with Load Current Spectrum Shaping
To verify the feasibility of the proposed control scheme, the neutral-point clamped inverter

was considered as a case study, and this approach can be easily extended to any other power converter configuration. The NPC inverter presents more challenges compared to a standard twolevel voltage source inverter. The NPC inverter needs to maintain constant DC-link capacitor voltages in addition to excellent load current regulation. The control concept for the inverter is

presented in Figure 28. It contains MPC which is a converter control block. The other block carries for the NPC inverter is given in Figure 29.

the VSS which provides the correct sampling frequency for the MPC. The proposed VSS algorithm

43

cm, fsw
Virtual System Simulator

C1
L R

i*(k) i( k )

cm

fsam S(k)

Main Model Predictive Control

C2

n

Figure 28 ­ Inverter side control, VSS with MPC Upon giving new current reference values to the control, the VSS function will be called to determine an appropriate sampling frequency. The algorithm starts by determining the position of one sample. The sampling frequency shifter starts from previously used sampling frequency and sets a value for AMPC.

the reference vector and the nearest three vectors. Only these vectors will be used in AMPC during

fsw

Sampling frequency shifter Calculate v *(k)

Apply frequency

Y N

Harmonic verification AMPC sampling frequency

Pattern verification

Virtual load current calculation Cost function minimization i*(k) cm  dc

Virtual System Simulator

Calculate nearest 3 vectors

Auxiliary MPC

Figure 29 ­ Internal VSS structure for inverter

Immediately following, the AMPC algorithm is executed together with the virtual load simulator to obtain the virtual load current waveforms. This part of the algorithm repeats itself until enough data points are obtained for the execution of pattern and harmonics verification. First verification verification, the DFFT will be done to extract the harmonics of interest.

stage is to run a pattern verification on the obtained switching vectors. If this block allows further If the switching pattern exists but is formed in such a way that certain unwanted harmonics

appear in the spectrum or if the spectrum has spread frequencies, an execution of VSS repeats 44

itself with the sampling frequency shifted up or down. The process repeats until the right frequency is obtained and the desired harmonics are removed from the spectrum. It should also be noted that in case common-mode voltage needs to be mitigated, the VSS must receive the same request. fsample which allows fixed switching frequency operation with common-mode voltage mitigation.

Therefore, the VSS cost function will add and process another term and the algorithm will obtain The sampling frequency shifter allows certain restrictions and optimizations such as control

of switching frequency of the converter or speed optimization of the algorithm. If the switching the switching frequency. The VSS does not provide fixed switching frequency operation for all operating conditions and load ranges.

frequency has to be maintained constant across the entire range of load, the algorithm will target load values, but will select fsample to fix the switching frequency close to the desired value for all Once the value of fsample is known, the algorithm will automatically change the sampling

frequency of the MPC to a valid number. It is assumed that the calculations for fsample are going to be completed within one sampling period Ts. That way, the converter will always operate with a presumed switching pattern and the dynamics of the system are preserved as well. 3.3.1 Mathematical Model of NPC Inverter Considering the unitary vector the phases, the output voltage vector can be defined as = ( + =
/

which represents the 120 phase displacement between + ) (21)

connected to the DC source. Consequently, 27 switching states and 27 voltage vectors are obtained. 30, the equations for load current dynamics for each phase can be written as = + +

Different switching states will generate different configuration of the three-phase load

Taking into account the definitions of variables from the NPC converter circuit presented in Figure (22) (23) (24)

=

=

+ 45

+

+

+

idc C1 + vC1 -

S1a S2a

S1b S2b vb

S1c S2c vc L R

+ C2 vC2 -

Z

va

S1a S2a

S1b S2b

S1c S2c

n

Figure 30 ­ NPC inverter circuit By substituting (22)­(24) into (21) a vector equation for the load current dynamics can be obtained: = ( + + ) + ( + + ) + ( + + ) (25)

Considering the space vector definition for the inverter voltage given by (21), and the following definitions for load current = ( + + ) (26)

and assuming the last term of (25) equal to zero ( + + )=0 (27)

then the load current dynamics can be described by the vector differential equation where v is the voltage vector generated by the inverter and i is the load current vector. 3.3.2 Discrete-Time Model for Prediction the derivative is approximated as follows: If the load current derivative di/dt is replaced by a forward Euler approximation, that is, if 
( ) ( )

=

+

(28)

(29)

46

and then substituted in (28), we obtain an expression that allows prediction of the future load current at time k+1. This expression is +1 = 1- 3.3.3 Cost Function Evaluation switching states in a general case and generated by the inverter. For this purpose, it is necessary to function g is evaluated for each switching state.
i* (k+ 1)
Minim ization of g fun ction

+

(30)

The future values of load currents and voltages in the capacitors are predicted for 27

measure present load currents and voltages in the capacitors. After obtaining the predictions, a cost

L

R

n

i p (k+1), vcp1,c2 (k+ 1)

Predictive Con trol

i(k )
1

Figure 31 - Predictive current control method for the NPC inverter sampling period. The predictive control scheme for the NPC inverter is shown in Figure 31. The control requirements for the NPC inverter are:    Load current reference tracking DC-link capacitor voltages balance The switching state that minimizes the cost function is selected and applied during the next

vc ,c (k)
2

Reduction of the switching frequency

These requirements can be formulated as a cost function to be minimized. The cost function for the NPC inverter has the following composition: =|


-

|+



-

+

|

-

|

(31)

in the cost function measures the difference in the predicted values of the DC-link capacitor 47

where the first two terms are the load current errors in orthogonal coordinates and the third term

voltages. The reduction of switching frequency can be obtained either through changing Ns or by using P/N/O balancing algorithm. 3.3.4 Capacitor Voltage Balancing which are caused by the current that flows back to the NP. This problem arises due to tolerances continuous unsymmetrical power flow between the positive and negative DC-link. The two DClink voltages may deviate from each other continuously and may finally destroy the components. elegant way. Starting from the capacitor differential equations = and by approximating the derivatives as  =
( ) ( )

As it is already known, an NPC inverter may have neutral point (NP) balancing issues,

of the converter components and asymmetries of gating commands of the switches and leads to a

Model predictive controls allows balancing of the DC capacitors to be done in a very (32) (33)

(34)

the following discrete-time equations are obtained: ( + 1) = ( + 1) = ( )+ ( )+ ( ) ( ) (35) (36)

Currents ic1(k) and ic2(k) depend on the switching state of the inverter and are calculated using the following expressions: ( )= ( )= ( )- ( )- ( )- ( )- ( )

( )-

( )-

( )

(37)

(38)

where variables H1x and H2x depend on the switching states and are defines as: = 1 if = "+" 0 otherwise 1 if = " - " = 0 otherwise 48 (39) (40)

where x = a,b,c.

coefficient has a certain range of values. 3.3.5 Common-mode Voltage Reduction

The cost function can then be modified to include the balancing term

|

-

| where

into cost function which considers common-mode voltage with dedicated appropriate value of the weighting factor . The common-mode voltage is defined as: = where the voltages is given as: , and =|


The common-mode voltage can be mitigated or completely eliminated by adding

term

(41)

are phase to neutral voltages. The cost function to consider - |+


-

+

|

( )|

(42)

3.3.6 Simulation Results with High Power Inverter following simulations verify the steady-state and dynamic response, common-mode voltage mitigation and switching frequency regulation using P/N/O state balancing with high power inverter. The setup parameters are given in Table III. Converter Parameter DC-Link voltage Converter rating Table III ­ Simulation setup parameters for high power inverter 5 (MVA) Value SI To verify the proposed theory the inverter was simulated using Matlab/Simulink. The

Value pu 2.45 1 1

DC-Link capacitance Output frequency Filter inductance Load resistance

10784 (V) 1000 (µF) 50 (Hz)

3.65

16.1 (mH) 10.5 ()

0.43 0.9

49

3.3.6.1 Steady-state and transient characteristics a high power NPC inverter was simulated to verify the control actions similar to real-application environment. The steady-state response of the inverter controlled with VSF-MPC is provided in Figures 32 and 33.
300 150

Multilevel converter dominant area of operation is in high power applications. Therefore,

ia (A)

0 -150 -300 6000 4000 2000

a)

Vab (V)

-2000 -4000 -6000

0

0.00

0.01

0.02

time (s)

0.03

Mag (% of Fundamental)

16

20 12 8 4 0 0 5 10 15

b)

0.04

0.05

0.06

Harmonic Order

20

25

30

35

Figure 32 - Steady-state response at 50 Hz: a) ia, b) Vab and c) harmonic spectrum frequency of 50 Hz, corresponding line-to-line voltage and current harmonic spectrum, while the VSS achieves fixed switching frequency operation and a half-wave symmetry, leading to SVMFigure 32 presents the inverter load current waveform generated at a fundamental

c)

inverter operates at 0.4 pu of a rated current. It can be observed that for given operating conditions, based shape of spectrum with even-order harmonic elimination. A different fundamental frequency of 25 Hz is further selected to confirm the control ability to properly handle fundamental frequency reference changes. The results are provided in Figure 33. The switching frequency was kept 50

constant leading to doubling the number of switchings per fundamental cycle in the second case. However, VSF-MPC successfully achieves fixed switching frequency operation with spectrum shaping. For both operating conditions it can be stated that current waveforms do not display cycle to cycle oscillations, which means the switching frequency is fixed for given operating conditions. leading to even-order harmonic elimination. Thus, Figures 32 and 33 confirm steady-state operation for VSF-MPC with high power inverter.
300 150

Also, it is easily noticed that both current and voltage waveforms are half-wave symmetrical

ia (A)

0

-150 -300 6000 4000 2000

a)

Vab (V)

-2000 -4000 -6000

0

0.00

0.02

0.04

time (s)

0.06

Mag (% of Fundamental)

16

20

b)

0.08

0.1

0.12

12 8 4 0 0 5 10 15

Harmonic Order

20

25

30

35

Figure 33 - Steady-state response at 25 Hz: a) ia, b) Vab and c) harmonic spectrum presented in Figure 34. This test verifies the VSF-MPC with VSS using current step change from 0.4 pu to 0.8 pu. After receiving new reference values, the VSS successfully calculated new sampling frequency, in such way maintaining constant switching frequency operation. This can also be noticed by observing the capacitor voltages, which display symmetrically balanced values 51 The same setup was also tested with a step change in current reference and the results are

c)

before and after the transient. During transient, there is a very short drift in the DC-link voltages due to sudden relatively large current step. However, this behaviour was properly corrected by the control.
500 250 0 -250 -500

Vdc1, Vdc2 (V)

ia (A)

5600 5500 5400 5300 5200 0.00 0.01 0.02 0.03 0.04 0.05 time (s) 0.06 0.07 0.08 0.09

Figure 34 ­ Transient response of a high power NPC inverter 3.3.6.2 P/N/O Voltage Balancing when switched from auto This test confirms the ability of the control to achieve proper DC-link voltage balancing balancing through cost function to P/N/O balancing using an external

algorithm. Figure 35 presents and verifies that the switching frequency can be adjusted through the selection of P/N/O states. At t=0.03 s

algorithm chooses P/O/N states such that the capacitor voltages are balanced even though the controller, the switching frequency was changed from 1050Hz to 700Hz, and this can be noticed ( ).

value was changed from 0.01 to 0 at. The auxiliary

cost function omits this task. Due to the transfer of capacitor voltages balancing to the auxiliary by looking into the inverter output voltage waveform with respect to the mid-point of DC-bus The ripple in the capacitor voltages is also increased; however their mean value is equal

to half the total DC-bus voltage. The ripple in the load current waveform is not affected by this

phenomenon, because the overall control scheme forces the load current to follow predefined

52

harmonic profile. This test verifies the fixed switching frequency operation of the NPC inverter and the ability to influence the switching frequency both ways.
400 200

ia (A) Vdc1, Vdc2 (V) Vaz (V)

0 -200 5550 5475 5400 5325 5250 6000 3000 0 -3000 -6000 0.0 0.01 0.02 0.03 -400

Figure 35 ­ DC-link voltage balancing by switching from auto 3.3.6.3 Common-mode Voltage Elimination

time (s)

0.04

0.05

0.06

0.07

0.08

balancing to P/N/O

in an NPC inverter and also simultaneous elimination of even-order harmonics. The inverter was initially running with a switching frequency of 1050Hz, and the cost function considered the load s, the weighting factor current control, balancing of capacitor voltages and even-order harmonic elimination. At t=0.035 choosing only medium voltage vectors and zero vector. was changed from 0 to 0.1, mitigating the CMV to a few volts by

Figure 36 shows the effectiveness of the proposed control algorithm in mitigation of CMV

Due to use of medium vectors and zero vector only, the load current THD has increased slightly. However, the current ripple shape is still symmetrical to eliminate the even-order harmonics and inter-harmonics. Load current follows the predefined harmonic profile and thus the even-order and inter-harmonics are eliminated completely despite the changes in 53

To facilitate such procedure, the switching frequency of the inverter decreases to 600 Hz.

value. This test verifies the

effectiveness of the proposed scheme in eliminating even-order harmonics and CMV simultaneously.
400 200

ia (A) Vdc1, Vdc2 (V) cmv (V)

0 -200 5460 5430 5400 5370 5340 6000 4000 2000 0 -400

-2000 -4000 0.0 0.01 0.02 0.03

time (s)

0.04

0.05

0.06

0.07

0.08

Figure 36 ­ Common-mode voltage elimination through cost function minimization not only this algorithm achieves balanced voltages in steady state, but the overall control loop In this case the voltage balancing of the DC-link capacitors in not achievable. However,

displays a self-balancing effect as described in [49]. The strength of the self-balancing effect the per-unit impedance of the load is constant.

depends on the sampling frequency, but is independent of the power rating of the system assuming

3.4 Rectifier ­ Side Predictive Control with Grid Current Spectrum Shaping
If the predictive control is selected as a control method for the rectifier, spread spectrum

due to variable switching frequency is not suitable for a grid connection. Every converter interacting directly with the grid must respect grid code guidelines such is IEEE Std 519-1992, in terms of harmonic profile or Total Demand Distortion (TDD). 54

fsw C1 vg(k)
Virtual System Simulator

Grid

fsam C2 S (k)
Main Model Predictive Control

i*(k)

ig(k),vg(k)

Figure 37 - Rectifier side control, VSS with MPC In addition, to minimize the impact on the grid, rectifiers may use more complex filters, such as LCL filter. Variable switching frequency produces various harmonic frequencies in the spectrum which may induce oscillation and damage the equipment. Therefore, fixed switching frequency operation is of a great significance for proper operation of rectifiers and minimal negative impact on the grid.
Y Harmonic verification N Pattern verification Virtual load current calculation

fsw

Sampling frequency shifter

Apply frequency

Calculate

v (k)
*

Calculate nearest 3 vectors

AMPC sampling frequency

Auxiliary MPC

Cost function minimization

Virtual System Simulator

Vg(k)

i*(k)

Figure 38 ­ Internal VSS structure for rectifier The proposed control system for the rectifier is presented in Figure 37. The concept is similar to previously used method to control the inverter, with a few modification required by the rectifier configuration. In addition to previously considered in VSS, it is now required to consider the grid voltage and frequency as well. The frequency of the grid is an important parameter which has to be determined precisely in order for the sampling frequency to synchronize properly. The grid frequency if fairly constant but the VSS monitors its value using an additional PLL block. The other parameter used to determine the correct fsample is the grid voltage. The VSS internal structure is presented in Figure 38 with the inputs adjusted for rectifier operation. 55

3.4.1 Mathematical Model of NPC AFE Rectifier Based on the circuit shown in Figure 30, the equations for each phase can be written as: = = + + + + - - (43) (44) (45)

=

+

+

-

Then, considering the space vector definition for the grid voltage = where =
/

(

+

+

)

(46)

dynamics can be obtained as = + (

, and by substituting (43)-(45) into (46) the vector equation for the grid current ( + + + + ) + )- ( ( + + + + ) ) (47)

The last term of (47) is equal to zero ( + + )=0 (48)

The input current dynamics equation (47) can be simplified by considering the following definitions for the grid current vector and the voltage vector generated by the AFE: = ( ( + + ) (49) (50)

= Voltage can be expressed by the equation where

+

+

)

is determined by the switching state of the converter and the DC-link voltage, and =  (51)

is the DC-link voltage and S

is the switching state vector of the rectifier, defined as 56

= where , , and

(

+

+

)

(52) is

off, or 1 if

following vector equation:

The input current dynamics equation (47) can be rewritten in the stationary -frame as the = - - (53) is the voltage generated

is on (x = 1, 2, 3).

are the switching states of each rectifier leg, and can take value of 0 if

where i is the input current vector, by the converter.

is the supply line voltage and

3.4.2 Discrete-time Model of NPC AFE Rectifier The predicted current is calculated using the discrete-time equation obtained from discretizing (53) ( + 1) = 1 - for a sampling time ( )+ ( ( )- ( )) (54)

over one sampling period as considered in the previous part with the NPC converter. 3.4.3 Rectifier Simulation Results

. Discretization is done by approximating the derivative as the difference

PI controller in charge of the DC-link voltage regulation and by required load power on inverter side. In order to verify the proposed concept, the rectifier with L filter was selected as a study case

In a back-to-back system, the current reference for the rectifier is usually provided by the

and controlled with the VSS. The current reference was manually selected according to system presented in Figure 39. The NPC rectifier is drawing 0.4 pu of active power from the grid respecting zero reactive power reference.

parameters which are the same as in case of inverter. The results for the investigated system are

unity power factor. Furthermore, the voltages at the DC-link side are properly balanced. The current is half-wave symmetrical and therefore does not contain even-order harmonics, which can be seen from an associated harmonic spectrum of grid current waveform given in Figure 39c). 57

It can be noticed that the current is in phase with the grid voltage, thus taking power at

400

ig(abc), Vga (A)

200 0 -200 -400 5460 5430 5400 5370 5340 0.0 0.01 0.02 0.03 0.04 time (s) 0.05 0.06 0.07 0.08

Vg/10

a)

Vdc1, Vdc2 (V)

Mag (% of Fundamental)

16

20 12 8 4

b)

0

0

5

10

15 20 Harmonic Order

3.5 Switching Frequency Targeting versus Number of Samples

Figure 39 ­ Rectifier operation: a) grid currents, b) DC-link capacitor voltages, c) harmonic spectrum

c)

25

30

35

low to high values. In classical fixed sampling frequency FSC-MPC, the inverter switching frequency varies with the load current. Figure 40 shows the proposed VSF-MPC forcing constant sampling rate, where Ns was targeted for 14. through

It is known that the inverter switching frequency changes with load current ranging from

The cost function in this case includes load regulation term and capacitor voltage balancing

even-order harmonic elimination or fixed switching frequency operation. Thus, the sampling rate

. At certain operating points, the requested sampling frequency cannot provide either

is changed by the VSS to first nearby sampling frequency at which primary control objective can

be achieved. Ns could either increase (orange line) or decrease (blue line) depending on the VSS Ns will decrease fsw.

settings. An increase in Ns would naturally raise an inverter switching frequency while lowering 58

17 16 15
Ns

540

1401

1080 1170 360 0.1 900 0.2 0.3 1215 1082 782

541

482

14 13 12 0.0

482 1021 0.4 0.5 0.6 Inverter current (pu) 0.7 0.8

245

0.9

1.0

Figure 40 ­ Ns versus inverter switching frequency targeting Ns = 14
1100 1075
Switching Frequency (Hz)
30 15 12 12 13 13

1050 1025 1000 975 950 925 900 875 0.0
0.1 0.2 0.3

19 27 33

Figure 41 ­ Ns versus inverter switching frequency targeting fsw = 1000 Hz frequency was targeted at 1000 Hz within an allowed range of 10 % of fluctuation around the targeted value. The VSS was configured to automatically adjust the sampling rate to meet the requested criterion while maintaining fixed switching frequency with even-order harmonic objectives and simultaneously shape the harmonic spectrum. On the other hand, Figure 41 presents the control behavior when the inverter switching

0.4 0.5 0.6 Inverter current (pu)

0.7

0.8

0.9

1.0

elimination. Figures 40 and 41 show the flexibility of the proposed control scheme to fulfill various

59

3.6 Summary
technique employs variable sampling frequency and a virtual system simulator to determine the appropriate sampling frequency for spectrum shaping with even-order harmonic elimination. To verify the proposed method, an NPC converter is considered as a study case. Through simulations addition to the current regulation and balancing of DC-link capacitor voltages. The strategy is further verified with common-mode voltage mitigation, as an important aspect in motor drives. it has been proved that the spectrum can be shaped with eliminations of even-order harmonics in In this chapter a novel VSF-FCS-MPC scheme for inverter and rectifier is proposed. The

From the grid side prospective, simulation were performed with the rectifier as well, which confirms the control is able to maintain requested active power flow with simultaneous even-order harmonic elimination and DC-link voltage balancing.

60

CHAPTER 4 DSP IMPLEMENTATION AND EXPERIMENTAL VERIFICATION
4.1 Introduction
laboratory NPC inverter and compared with FSF-FCS-MPC and conventional control methods, in eliminate the steady-state error and a modulation stage to generate the gating signals. Even though The proposed VSF-FCS-MPC control scheme has been experimentally verified with the

this case, SVM. Classical current control techniques for a three level VSI use PI regulators to SVM provides fixed switching frequency operation regardless of operating conditions, the design

complexity is no match to its predictive counterpart. The complexity of the design and tuning process for SVM increase even further when another PI loop is added to balance the capacitor objectives are defined in a single cost function. Simulation and experimental results for low-power setup are both presented in this chapter for easier comparison, showing dynamic and steady-state voltages. In FCS-MPC, on the other hand, current control and capacitor voltage balancing

performances of NPC inverter. More specifically, the objective was to experimentally assess the performance of the proposed technique in terms of percentage total harmonic distortion (%THD) covers the DSP implementation of FSF-MPC using fixed-speed digital processor. and average switching frequency under various load and reference conditions. This chapter also

4.2 Inverter Simulation Results with Low Power

the control when multiple objectives need to be fulfilled, such as current control, capacitor voltage balancing and spectrum shaping. The parameters of the system are given in Table IV. Table IV ­ Setup parameters for low power inverter Converter Parameter Value SI Converter rating 3.6 (kVA) DC-Link voltage 370 (V) DC-Link capacitance 1000 (µF) Output frequency 60 (Hz) Filter inductance 7.5 (mH) Load resistance 11 () 61 Value pu 1 3.08 4.52 1 0.24 0.92

A low power setup was simulated using MATLAB-Simulink to observe the behavior of

200 100 50 150

vc1

vc2

vab (V), vc12 (V)

vab

-100 -150
0.0

-50

0

-200

5th 7th
0.01

11th 13th
0.02

17th 19th

23th 25th
0.04

29th 31th
0.05

time (s)

0.03

a)

200 100 150 50

vc1

vc2

vab (V), vc12 (V)

vab

-100 -150
0.0 0.01 0.02 0.03 0.04 0.05

-50

0

-200

time (s)

b)

150

200

vab (V), vc12 (V)

100 50

vc1 vc2

vab

-100 -150
0.0

-50

0

5th 7th
0.01

11th 13th
0.02

17th 19th

23th 25th
0.04

29th 31th
0.05

-200

time (s)

0.03

c)

Figure 42 - Steady-state comparison of line-to-line voltages: a) SVM; b) FSF-MPC; c) VSFMPC 62

20

15 10 5

ia

ib

ic

iabc (A)

-10 -20 -15
0.0

-5

0

5th 7th
0.01

11th 13th
0.02

17th 19th

23th 25th
0.04

29th 31th
0.05

time (s)

0.03

a)

10

15 5

ia

ib

ic

iabc (A)

-10 -15

-5

0

-20 -25

0.0

0.01

0.02

time (s)

0.03

0.04

0.05

b)

20

15 10 5

ia

ib

ic

iabc (A)

-10 -20 -15
0.0

-5

0

5th 7th
0.01

11th 13th
0.02

17th 19th

23th 25th
0.04

29th 31th
0.05

time (s)

0.03

c)

Figure 43 - Steady-state comparison of 3-phase currents: a) SVM; b) FSF-MPC; c) VSF-MPC 63

10

ia (A)

5

-10

-5

0

* ia

ia vc1 vc2

vc1 -vc2
0.0 0.02 0.04

time (s)

0.06

0.08

0.1

-50

a)

10

ia (A)

5

-10

-5

0

* ia

ia

vc1

vc2 vc1 - vc2

0.0

0.02

0.04

time (s)

0.06

0.08

-50 0.1

b)

10

ia (A)

5

-10

-5

0

* ia

ia

vc1 vc2 vc1 - vc2
0.0 0.02 0.04

time (s)

0.06

0.08

0.1

-50

c)

Figure 44 - Transient response comparison: a) SVM; b) FSF-MPC; c) VSF-MPC

64

vc12 (V)
50 0

vc12 (V)
50 0
100 150

vc12 (V)
50 0 150 100

100

150

and VSF-MPC. Simulated waveforms in Figure 42 represent the inverter line-to-line voltage and DC-link voltages during steady-state operation. The corresponding voltage spectrum is provided in each figure. The graph in Figure 42a) presents SVM operation of NPC inverter. As expected,

The simulation results provided in Figures 42-44 compare SVM current control with FSF-

SVM operates with fixed-switching frequency and due to implemented even-order harmonic

elimination achieves shaped spectrum including only the following harmonics: 5 th, 7th, 11th, 13th, 17th, 19th, 23rd, 25th, 29th and 31st. Figure 42b) presents FSF-MPC operating at constant sampling rate. It displays common MPC issue such as spread-spectrum due to variable switching frequency. The control is able to properly balance the DC-link voltages. However, line-to-line voltage

contains various harmonic frequencies. The graph in Figure 42c) displays variable sampling

frequency method. The proposed method fully removes even-order harmonics and achieves are properly balanced during operation.

spectrum shape similar to SVM in terms of individual harmonic frequencies. Capacitor voltages Moreover, Figure 43 presents the inverter 3-phase steady-state current waveforms for all

three simulated control schemes, with dedicated spectrum profiles. In Figure 43a), SVM operation is presented with fixed switching frequency operation. Similar to Figure 42b), 3-phase currents leads to variable switching frequency producing spread harmonic spectrum. Finally, in Figure accomplishing reference current tracking and capacitor voltage balancing. generated by fixed sampling frequency MPC are pictured in Figure 43b). This kind of operation 43c), the proposed VSF-MPC algorithm achieves spectrum shaping while simultaneously The dynamic performances are further analyzed in Figure 44. The graph in Figure 44a)

shows SVM response to a step change in current reference. Due to linear control and fairly complex modulation stage a considerable time is required to achieve steady-state operation compared to MPC response time. Both MPC techniques reveal superior predictive response performances against SVM. However, VSF-MPC establishes shaped harmonic spectrum after transient which can be observed in current waveform shape. It should also be stated that all three

control methods can properly balance the capacitor voltages during transients and achieve verified and presented in the following sections.

reference current tracking with zero error. Simulation results obtain above are experimentally

4.3 DSP Implementation

board with a PPC750GX digital processor clocked at 1 GHz. An internal architecture of the CPU 65

The control algorithm has been implemented on the laboratory dSPACE DS1103 control

supports 3 hardware interrupts controlled by two 32-bit counters and one 64-bit counter. The resolution of the counters is 15 ns and 30 ns according to the system bus clock to CPU clock ratio. compared with counter compare registers. All three counters are actively monitored with each system clock and their values are actively The algorithm has been written inside an interrupt routine and all calculations,

transformations and control equations are executed once with each interrupt cycle. However, the

VSS part of the algorithm in charge of finding fsample is implemented as a function which is called whenever there is a change in input parameters. The DSP supports complex task priority management. Since controlling the primary cost function objectives is a pivotal role, the VSS and the associated Forward-Euler discretization for proper operation. However, the code execution function was ranked second in the priority queue. This is required from the control point of view is optimized for fast calculation, thus all predictions can be completed in one Ts. If under certain conditions the calculation time for fsample would take longer than one Ts, the transient response of the system would not be affected because the MPC has the highest priority in an interrupt routine. Also, after a step change in current reference a certain time is required by the system to respond. counter compare registers are automatically loaded with the appropriate value.

This time adds to the available calculation time for fsample. Finally, when fsample is calculated the In order to speed up the function execution time the VSS can be started with non-zero

initial conditions. A practical equivalent of such action would be an instantaneous pre-charge of the inductors to some finite current value. Therefore, the initial conditions in (16)-(18) could be set to any assumed value according to the operating conditions. 4.3.1 Delay Compensation

switching devices is inevitable. In a cumulative delay, the portion provided by the digital signal processor is most significant. The gate drivers, switching devices and sensors introduce a delay of less than 2 µs. Considering that both MPC and VSS require 10-20 µs to complete, the reference is

In experimental setup, the delay provided by the digital signal processor, gate drivers, and

adjusted using vector angle compensation to minimize the impact of the processing time. Taking into account vector representation of the variables of a three-phase system, it is convenient to The load current vector i* can be described by its magnitude I* and angle 
(

estimate the future reference by considering the change in the vector angle during one sample time. )=


( )

( )

(55)

66

Assuming this vector rotates at an angular speed  and that the magnitude remains constant, the angle for the reference vector at tk+1 can be estimated as ( + 1) = ( )+ (56)

where Ts is the sampling time. Considering I*(k + 1) = I*(k) the value of the future reference vector can be estimated as
(

+ 1) =
(



( )
(

( ( )

)

(57) (58)

Combining (55) and (57) the final equation to be implemented is

4.4 Experimental Results and Analysis

+ 1) =

)

2006a software through a real-time interface. The dSPACE DS1103 controller is used to handle

The control algorithm has been implemented using a host PC running MATLAB/Simulink

the control processes such as load current prediction, load voltage estimation, and cost function LV25-P transducers, respectively. The feedback from the sensors has been sent to the controller through a CP1103 I/O connector. The prototype has been built with a Semikron SKM75GB123D

minimization. The load currents and DC-link voltages were measured using LEM LA55-P and

dual-pack insulated-gate bipolar transistor (IGBT) modules. The IGBT gate drivers are based on a six SKHI22B dual-core modules powered by 15 V supply. The experimental setup parameters are provided in Table V. Table V ­ Experimental setup parameters Converter parameter Converter rating DC-link voltage Load resistance

3.6 (kVA) 1000 (µF) 0.065 () 7.5 (mH) 60 (Hz) 1000 67 1 11 () 370 (V)

Value SI

Value pu 3.08 1

DC-link capacitance Filter leakage resistance Reference frequency Proportional gain Integral gain Filter inductance

0.005 0.24 1 -

0.92

4.52

1 50.0V

vc1

50.0V 3 200.0V 4

vc2

5.00 m/s

vab
0.161 0.137

0.046 5th THD = 40.4%

0.03 7th

0.062 11th

0.03 13th

0.115 17th 19th

0.087

0.127 29th

0.098 31th

23th 25th

a)
50.0V 3 200.0V 4 5.00 m/s

1 50.0V

vc1 vc2

vab

THD = 38.5%

b)
50.0V 3 200.0V 4 5.00 m/s

1 50.0V

vc1 vc2

vab
0.083 0.086

0.026 5th THD = 37.3% 7th

0.032

0.05 11th 13th

0.047

0.051

0.047

0.057

0.043

c)

17th 19th

23th 25th

29th

31th

Figure 45 - Steady-state comparison of line-to-line voltages: a) SVM; b) FSF-MPC; c) VSF-MPC 68

1 5.0A

ia

5.0A 3 5.0A 4

ib

ic

5.00 m/s

0.007 5th THD = 5.2% 7th

0.015 0.008 0.006 0.017 11th 13th 17th 19th

0.024 0.012 23th 25th

0.02

0.008 29th

0.009 31th

a)
5.0A 3 5.0A 4

1 5.0A

ia

ib

ic

5.00 m/s

THD = 5.57%

b)

1 5.0A

ia

5.0A 3 5.0A 4

ib

ic

5.00 m/s

0.007 5th THD = 4.45% 7th

0.013 0.013

0.01 0.014

0.013

0.006

0.006

0.006 0.004 29th 31th

11th

13th

17th 19th

23th 25th

c)

Figure 46 - Steady-state comparison of 3-phase currents: a) SVM; b) FSF-MPC; c) VSF-MPC 69

 Analysis of Steady-State Performance order harmonics while following other required objectives, the steady-state performance has been voltages and their harmonic spectrum in steady-state. Due to modulations stage, the SVM in Figure In order to represent the efficiency of the control to shape the spectrum and eliminate even-

assessed and compared with SVM and FSF-MPC. The graphs in Figure 45 represent line-to-line 45a) achieves fixed switching frequency operation including only the following harmonics: 5 th, 7th, 11th, 13th, 17th, 19th, 23rd, 25th, 29th and 31st. This is according to simulated waveforms. Evenorder harmonics are not present since SVM was implemented as a 7-segment switching sequence optimized for reduction of switching frequency and even-order harmonic elimination. Further analysis reveals that FSF-MPC performs with variable switching frequency (Figure 45b)). Cycle

to cycle difference between the gating signals delivers spectrum profile with frequencies spread across an entire spectrum. The switching pattern does not exist and cannot be established due to unsynchronized sampling times. When FSC-MPC gets accompanied with VSS to achieve optimal

sampling period, the switching pattern becomes evident, rendering VSF-MPC similar to SVM as the same harmonic frequencies appear in both spectrums which can be observed in Figure 45c). The graphs in Figure 45 also reveal that all three control techniques successfully balance the DCan obtained waveforms agree closely with simulation results.

link capacitor voltages. Therefore, the experimental results in this test corroborate the theory, as Further measurements in steady-state were carried out to include 3-phase currents with

associated spectrum analysis. The results are presented in Figure 46. As in previous experiment in indicating inter- or even-order spectral components, while FSF-MPC delivers spread harmonic

Figure 45, the SVM and VSF-MPC achieve fixed switching frequency operation without frequencies due to non-constant switching frequency. Therefore, it can be concluded that VSFproducing similar results to SVM. Again, experimentally obtained results are consistent with simulated low-power waveforms.

FCS-MPC is able to achieve fixed switching operation for given operating conditions, as such,

achieve lower %THD compared to SVM. This can be attributed to significantly less complex predictive control mechanics and control effort concentrated into a single cost function. On top of that, VSF-MPC stands out as a method delivering the lowest %THD of all three experimented 70

From current THD analysis of plots in Figures 45 and 46 it is deduced that both MPCs

techniques. This behavior is notices in both voltage and current THD percentage. From

experimentally obtained values for different operating conditions, a thorough THD analysis and comparison were performed and the results are presented in Figure 47.
14 12
10 8 6 4 2 0
VSF-MPC

(THD)

SVM

FSF-MPC

0

500

1000 1500 2000 Switching frequency (Hz)

2500

3000

a)

25

30

35
SVM FSF-MPC VSF-MPC

0.7 0.6 0.5  0.4 0.3 0.2

(THD)

15 5

20 10 0 0.0


0.1

0.2

0.3

0.4

b)

0.5 m

0.6

0.7

0.8

0.9

0.1 0.0 1.0

Figure 47 - Performance comparison: a) THD versus switching frequency; b) THD versus modulation index  THD Comparison conditions while the switching frequency was spanned from lowest possible to 3 kHz. Furthermore, the setup was tested with variable modulation index ranging from 0.1 to 1 at constant switching frequency. All three control techniques were compared against the %THD of load current they achieve under tested conditions and the results are presented in Figure 47. As VSFFCS-MPC uses the VSS to adjust the switching frequency through modifying the control sampling 71 The comparative analysis was performed in case of the inverter operating at rated

frequency, the sampling frequency of SVM was manually adjusted to always be 10 times higher

than the carrier frequency. This provides high sampling rate for SVM and therefore a fair

comparison between tested control algorithms. Figure 47(a) shows that at rated conditions VSMvector utilization at full load. Also, both MPCs were able to achieve lower sustainable inverter

FCS-MPC outperforms both SVM and FSM-FCS-MPC. Clearly, predictive control achieves better operating frequency than SVM, achieving only 150 Hz, while SVM was able to go as low as 175 Hz. It should be noted that all switching frequencies measured in the experiment are device switching frequencies.

m predictive control achieves lower THD than SVM, but in range of 0.3 to 0.7, SVM performs with lower overall THD. Such a phenomenon can be attributed to the fact that MPC requires to increase for adequate voltage balancing at lower m rates. At m=0.7, to 0.05. The switching frequency was still kept at 1 kHz, but increasing

The graph in Figure 47(b) presents modulation index change versus THD. At high and low

was increased from 0 effectively decreased

the switching frequency "dedicated" toward current reference tracking, as a certain number of switchings in small vectors became attributed only to DC-link capacitor voltage balancing. However, the SVM operating principle is different from MPC, since the capacitor voltages are balanced by extending or shrinking the dwell-times of certain small vectors. Balancing through

dwell-time correction does not interfere with switching frequency, providing this mechanism with less impact on THD. However, MPC still performs better at light loads due to absence of THD performance, even though the switching frequency is effectively less than with SVM.  Analysis of Dynamic Performance This set of measurements aims at stressing the response time of the system to determine the ability of each control mechanism to quickly and accurately follow a step change in current reference. It can be noticed that both VSF- and FSF-FSC-MPC outperform SVM when it comes to dynamic performance. Both predictive controls achieved almost instantaneous correction of load currents, The dynamic performances of the system were also verified and presented in Figure 48. modulation stage and lower complexity, which in turn enables better vector handling and better

accurately following the reference. On the other hand, SVM required over one and half fundamental cycles to nullify the error in reference tracking. Such a difference in response time is due to the fact that the overall SVM current control employs classical PI (proportional-plusstage.

integral) compensators using a dq-frame transformation followed by a fairly complex modulation 72

1 50.0V

50.0V 3 5.0A

vc1 vc2 ia*

4 5.0V

10.00 m/s

ia

vc1 - vc2
a)
1 50.0V 50.0V 3 5.0A

vc1

vc2

4 5.0V

10.00 m/s

ia*

ia

vc1 - vc2
b)
1 50.0V

vc1 vc2 ia*

50.0V 3 5.0A

4 5.0V

10.00 m/s

ia

vc1 - vc2
c) Figure 48 - Transient response comparison: a) SVM; b) FSF-MPC; c) VSF-MPC 73

The modulation stage uses a built-in look-up table based on the vectors with previously optimized switching sequence. The fact that SVM relies on a carrier and generates the dwell-times according to the position of the reference vector does not allow sudden changes to be accurately followed, making the response a bit sluggish. On the other hand, predictive control single cost functionsampling period. Thus, the response curves clearly reveal superior FCS-MPC characteristics when based operation is able to momentarily respond and apply vectors to minimize the error in the next it comes to dynamic performance. Figure 48 also compares the DC-link voltage balancing abilities.

All three control techniques behaved similarly and were able to maintained balanced condition VSM-FCS-MPC combines advantages of both techniques, providing fast response of FSC-MPC and fixed-switching frequency operation of SVM.

during reference step change, displaying similar behavior as observed in simulation. In conclusion,

4.5 Summary

subsequently gives the experimental results with low power setup. The novel technique using

This chapter presents simulation verification for a low power NPC inverter and

variable sampling frequency and a virtual system simulator to determine an appropriate sampling The presented simulation graphs in Figures 42-44 correlate closely with experimental results given in Figures 45, 46 and 48, displaying expected behavior for all control methods. The steady-state performance reveals accurate current tracking and proper voltage balancing in both simulation and

frequency for spectrum shaping with even-order harmonic elimination is thoroughly examined.

experimental verification. The dynamic performances display no difference in speed and accuracy of response with similar DC-link voltage balancing during transients. Further, this chapter provides the DSP implementation procedure used in the experiment.

74

CHAPTER 5 CONCLUSION
5.1 Technical Challenges and Work Contributions
it allows easy inclusion of various control objectives. A flexible formulation of the cost function An implementation of MPC to control modern power converters has numerous benefits as

permits optimization of several important parameters, such as: number of switchings, switching losses, reactive power control, motor torque ripple minimization, etc. Thus, the predictive offer flexible and simple alternative to classical control systems. controller takes over the functions of PWM block and cascaded multi-loop PI control, and can One of the main challenges in the concept of FCS-MPC is achieving fixed-switching

frequency operation while maintaining good dynamic performance. Variable switching frequency leads to spread spectrum which causes difficulties in the design and operation of power converters. harmonic frequencies rendering the system unstable or hardly controllable. In grid-interactive converter systems with LCL filtering, spread spectrum might excite certain This work aims at solving variable switching frequency by introducing variable sampling

frequency operation. It has been confirmed through simulations and experiments that the concept 5.1.1 Technical Challenges with Model Predictive Control technical challenges associated with FCS-MPC. One of significant aspects nowadays is available requirements. A practical implementation of MPC for multilevel converters with too many levels

is feasible and that spectrum shaping can be achieved for both inverter and rectifier configurations.

Aside from variable switching frequency and spread spectrum issues, there are other

digital computation power which in certain cases might still fail to handle all predictive control is still impossible due to extensive number of iterations. Adding up to this problem is a very complex programming required for the proposed VSS implementation in terms of describing a system and building a simulator that will precisely replicate its behavior.

proposed control technique are determination of the cost function weighting coefficients and 75

Besides that, issues associated with predictive control, but not tightly related to the

bandwidth analysis. Nowadays, the coefficients are still determined by empirical procedure. There

is no analytical or numerical solution proposed yet to obtain an optimal solution. When it comes to effective bandwidth analysis, related theoretical approach or frequency-response measurements have not been reported to date. This is not trivial, considering the fact that FCS-MPC is inherently a nonlinear control algorithm, in the same sense as the hysteresis controllers are. Hence, the applied to FCS-MPC. traditional concept and theory of bandwidth available for linear controllers cannot be directly 5.1.2 Work Contributions switching frequency operation. The contributions of the study are summarized below:  Spectrum Shaping with Even-Order Harmonic Elimination A complete elimination of even-order harmonics and inter-harmonic frequencies in the load current spectrum has been achieved with VSF-FCS-MPC. The proposed algorithm was verified with the NPC converter. The cost function simultaneously considered elimination in the NPC inverter was also verified, and this has been achieved without This work proposes variable sampling frequency model predictive control to achieve fixed-

balancing of DC-link capacitor voltages and load current control. Common-mode voltage altering the predefined harmonic profile. Furthermore, the algorithm was simulated with an NPC rectifier, where the harmonic profile was maintained constant while following active and reactive power references.  Novel Switching Frequency Control Feature Another important feature of the proposed control strategy is to arrange small vectors automatically through an auxiliary algorithm such that DC-link capacitor voltages and inverter switching frequency can be controlled independently without involving cost regulation and alleviates weighting factor design. function. This feature introduces one more degree of freedom for switching frequency  Extension of Variable Sampling Frequency FCS-MPC to Other Topologies Variable switching frequency MPC with integrated VSS has a universal approach to power converters. With SVM included, only certain vectors are deemed appropriate for cost 76

function minimization. An application of this work can be easily extended to other higherin current-source inverters since same optimization method can be used with topologyrelated modifications. Another field that can highly benefit from MPC with fixed-switching

level voltage source converters. Variable sampling frequency can also find its application

frequency is indeed the drives. As these systems employ both rectifiers and converters, predictive control can offer convenient and easy way to control the drives through a single cost function. At the same time, the rectifiers in drives may substantially benefit from in compliance with the grid codes.

fixed-harmonic profile if control with FSF-MPC, as this method delivers the performance  Simple and Flexible Converter Control Since the switching frequency can be controlled by controlling the P/N/O states of small vectors and by regulating the sampling frequency, the cost function can consider fewer Therefore, problems associated with weighting factor design are mitigated. Moreover, inclusions of only current tracking into the cost function produces less error in reference tracking and lower overall THD.  Faster DSP Execution Time Especially with higher level converters, predictive control requires a large amount of calculation to predict the behavior of currents and voltages for all possible switching states. An involvement of SVM into predictive control narrows down the number of vectors used

terms, i.e., n factor previously used for switching frequency reduction can now be omitted.

for prediction. This leads to significant reduction in calculation delay which will greatly in turn, increases performances even further.

improve performance. In such case, k+2 prediction horizon may not need to be used, which

77

APPENDIX
Discretization methods continuous-time controller is given as a transfer function, C(s). It is desired to find an algorithm (difference equation) for microprocessors so that the digital controller C(z) approximates the continuous-time controller, Figure 49. A discrete-time systems should mimic the continuous-time controllers. We assume that a

u(t)

C(s) u(kT)  C(s) C(z) e(kT)

e(t)

u(t)

D/A

A/D

e(t)

Figure 49 - Approximating Continuous-Time Controller Approximate solution using numerical integration question: what is the equivalent of the differential operator ( d/dt or s) in terms of the shift operator (z)? Let's start with a single integrator system, i.e. ( ) = ( ) or ( ) = ( ) = ( )+ (( + 1) ) = ( ) +
( ( )

To look for methods to approximate the transfer function, we start by examining a simpler

The solution to this system is At the sample instants

( )

=

(59)

( )
)

(60) ( ) (61)

using values only at the sample instants and not in between. Figure 50 illustrates these approximations.

There are three apparent choices to approximate the above integral in discrete time, i.e.

78

e( t )

e( t )

Forward Difference

T

( k+ 1)T

Time t

Backward Difference

T

(k+ 1)T

e( t )

Time t

( k+ 1)T T Time t Trapezoidal Approximation

Figure 50 - Different Types of Integral Approximations Mathematically, the discrete approximations of equation (61) can be summarized as follows: Forward difference: Backward difference: Trapezoidal approximation: ( + 1)  ( ) + ( )

( + 1)  ( ) + ( + 1) ( + 1)  ( ) +
[ ( ) ( )]

The pulse transfer function from input E(z) to output U(z) is: Forward difference: Backward difference: Trapezoidal Approximation: ( )= ( )= ( )=
( ) ( ) ( ) ( ) ( ) ( )

= = =

= = =

function we see that the discrete-time approximation of the continuous-time transfer function can be obtained by substituting the Laplace operator s with the following: Forward difference: Backward difference: Trapezoidal Approximation:   

Comparing with the pulse transfer functions above with the continuous-time transfer

79

Exact solution A mathematically exact calculation of the matrices of the discrete-time state space representation is of course not possible with the simple method described above. Let's start with The matrix ( )= + (62)

is called matrix exponential function. It is defined by the following Taylor series: = 
!

= +

!

+

!

+

!

+

(63)

Combining state-space representation with equation (62) the following equation is obtained: ( )= with ( ) + ( )= ( - ) ( ) (64) (65)

 is called transition matrix. If the time is set to = ( + 1) , the following equation results: (( + 1) ) = ( + 1) -
( )

+

(

)

(

)

( )

(66) = (67)

Since the value of u(t) is constant for (( + 1) ) =

  ( + 1) ( ) +

and using the substitution ( )

By comparing the coefficients of the above equation with space-state matrixes, Ad and Bd which present the discrete-time state and input matrix can be determined directly: = = Assuming a continuous system, it can be stated that time system thus results to: = ( - ) (68) (69)  0; the input matrix of the discrete(70)

80

With the help of the equation (68) and (70), the state matrix Ad and the input matrix Bd of the discrete-time system can be calculated. Reference following as an absolute value, square value, or integral value of the error for one sampling period: =| = ( =|
 

A measure of distance between reference and predicted value usually can be implemented - - | ) ( )) | (71) (72) (73)

( ( ) -

one error term. However, if the cost function has two or more different terms, results can be different. Squared error presents a better reference following when additional terms are included

Absolute error and squared error give similar results when the cost function considers only

in the cost function. Cost function (73) considers the trajectory of the variable between time t k and tk+1, not just the final value at instant tk+1, leading to the mean value of the error to be minimized. This then leads to more accurate reference tracking. Delay compensation and the cost function are calculated seven times. In this way, depending on the sampling frequency and the speed of the microprocessor used for the control, the time between measurement of the load currents and application of the new switching state can be considerable. If the calculation time currents are measured and the instant of application of the new switching state. As the three-phase inverter has twenty seven different voltage vectors, the predicted current

is significant compared to the sampling time, there will be a delay between the instant at which the A simple solution to compensate this delay is to take into account the calculation time and

apply the selected switching state after the next sampling instant. In this way, the control algorithm is modified as follows: 1. Measurement of the load currents.

2. Application of the switching state (calculated in the previous interval). 81

3. Estimation of the value of the currents at time t k+1considering the applied switching state. 5. Evaluation of the cost function for each prediction.

4. Prediction of the load currents for the next sampling instant t k+2 for all possible switching states. 6. Selection of the switching state that minimizes the cost function. The measured currents and the applied switching states at time t k are used to estimate the value of the load currents at time tk+1. ( + 1) = 1 - ( )+ ( )

(74)

Then, this current is used as a starting point for the predictions for all switching states. These predictions are calculated using the load model shifted one step forward in time: ( + 2) = 1 - ( + 1) + ( + 1)

(75)

where i(k+1) is the estimated current vector and v(k+1) is the actuation to be evaluated. The cost function is modified for evaluation of the predicted currents iP(k + 2), resulting in: = |  ( + 2) - ( + 2)| +


( + 2) -

( + 2)

(76)

Calculation of future reference using Lagrange extrapolation the reference can compensate the delay in the reference tracking in predictive control schemes. A possible solution is to calculate the one-step-ahead prediction using the actual current reference in the nth-order formula of the Lagrange extrapolation by:  ( + 1) =  (-1) +1


For sinusoidal references and large sampling times, the use of extrapolation methods for

( + - )

(77)

For sinusoidal references, n=2 or higher is recommended. Using the extrapolation formula, the future reference can be predicted  ( + 1) can be predicted, for n=2, with  ( + 1) = 3  ( ) - 3  ( - 1) +  ( - 2) (78)

82

Calculation of the future reference

This estimate can be calculated by shifting forward (78), giving

(

+ 2) is required when cost function (76) is considered. (79)

 ( + 2) = 3  ( + 1) - 3  ( ) +  ( - 1)

And, by substituting (78) into (79), the future reference can be calculated using only present and past values of the reference current. The resulting expression for the calculation of  ( + 2) is  ( + 2) = 6  ( ) - 8  ( - 1) + 3  ( - 2) Calculation of future references using vector angel compensation possible to implement and estimate the future reference by considering the change in the vector angle during one sample time. The load current vector  can be described by its magnitude
 (k) 

(80)

Taking into account vector representation of the variables of a three-phase system, it is

and angle : (81)

=



( )

( )

At steady state, it can be assumed that this vector rotates at an angular speed  and that the estimated as

magnitude remains constant. In this way, the angle of the reference vector for time tk+1 can be ( + 1) =


where Ts is the sampling time. Considering (82) and as
 (k

( )+

(82)

+ 1) =

( ), the value of the future reference vector can be estimated
(

(

+ 1) =

+ 1)

(

)

=



( )

( ( )

)

(83)

and inserting (81) into (83)
(

The same procedure can be used for the estimation of  ( + 2), assuming ( + 2) = 83 ( )+ 2

+ 1) =

(

)

(84)

(85)

and

(

+ 2) =



( ), resulting in

(

+ 2) =

(

)

(86)

Weighting Factors Adjustment for cost functions with secondary terms controlled using only the primary control objective or term. This can be simply achieved by the procedure is to convert the cost function with secondary terms into a cost function without primary variable. This is the easiest case for weighting factor adjustment, since the system can be first

neglecting the secondary terms forcing the weighting factor to zero ( = 0). Hence the first step of weighting factors. This will set the starting point for the measurement of the behavior of the The second step is to establish measurements or figures of merit that will be used to

evaluate the performance achieved by the weighting factor. Several error measures for current can be defined, such as the root mean square (RMS) value of the error at steady state, or the total harmonic distortion (THD). At least one additional measure is necessary to establish the trade-off with the secondary term.
Start =0 M 1 ( 0 ), M 2 ( 0 )  = 0.1
M 1 ( 0.1 ), M 2 ( 0.1 )

=1 M 1 ( 1 ), M 2 ( 1 )  = 0.5

 = 10
M 1 ( 10 ), M 2 ( 10 )

M 1 ( 0.1 ), M 2 ( 0.1 )

 = 0.25

M 1 ( 0.5 ), M 2 ( 0.5 )

M 1 ( 1 ), M 2 ( 1 )

M 1 ( 0.1 ), M 2 ( 0.1 )

M 1 ( 0.25 ), M 2 ( 0.25 )

M 1 ( 0.5 ), M 2 ( 0.5 )

0.1<  < 0.25 Figure 51 - Branch and bound algorithm to reduce the number of simulations required to obtain

suitable weighting factors

with simulations starting with  = 0 and increase the value gradually. Record the corresponding measures for each value of . Stop the increments of  once the measured value for the secondary 84

Once the measures are defined, the procedure is as follows. Evaluate the system behavior

term has reached the desired value for the specific application, or keep increasing  until the primary variable is not properly controlled. Then plot the results and select a value of  that fulfills the system requirements for both variables. This procedure can be programmed by automating and repeating the simulation, introducing an increment in the weighting factor after each simulation.

weighting factor, a branch and bound algorithm can be used. For this approach, first select a couple of initial values for the weighting factor , usually with different orders of magnitude to cover a very wide range, for example,  = 0, 0.1, 1, and 10. A qualitative example of this algorithm is illustrated in Figure 51. Then simulate these weighting factors and obtain the measures for both terms, M1 and M2, for the primary and secondary terms respectively. Then compare these results weighting factors (0.1 =  = 1 in the example). Then compute the measures for the  in half of the

In order to reduce the number of simulations required to find a proper value for the

to the desired maximum errors admitted by the application and fit them into an interval of two new interval ( = 0.5 in the example) and continue until a suitable  is achieved. Note in Figure 51 simulated. This method reduces the number of simulations necessary to obtain a working weighting factor.

that each solid line corresponds to a simulation and dashed lines correspond to values already

85

REFERENCES
[1] Motion Control Conference, 2004. IPEMC 2004. The 4th International, vol.1, no., pp.82-89 Vol.1, 14-16 Aug. 2004 H. Brunner, M. Hierholzer, T. Laska, A. Porst, "Progress in development of the 3.5 kV high voltage S. Rizzo, N. Zargari, "Medium voltage drives: what does the future hold?," in Power Electronics and

[2]

IGBT/diode chipset and 1200 A module applications," in Power Semiconductor Devices and IC's, 1997. ISPSD '97., 1997 IEEE International Symposium on , vol., no., pp.225-228, 26-29 May 1997 B. Wu, High-power converters and AC drives, 1st ed., ser. Wiley-IEEE Press. John Wiley & Sons, Inc., 2006. J. Rodriguez, J.-S. Lai, and F. Z. Peng, "Multilevel inverters: A survey of topologies, controls, and L. G. Franquelo, J. L. Rodriguez, J. Leon, S. Kouro, R. Portillo, and M. A. Prats, "The age of multilevel J. S. Lai, F. Z. Peng, "Multilevel converters - a new breed of power converters," in Industry

[3] [4] [5] [6]

applications," IEEE Trans. Ind. Electron., vol. 49, no. 4, pp. 724­738, Aug. 2002. converters arrives," IEEE Ind. Electron. Mag., vol. 2, no. 2, pp. 28­39, Jun. 2008.

Applications Conference, 1995. Thirtieth IAS Annual Meeting, IAS '95., Conference Record of the 1995 IEEE , vol.3, no., pp.2348-2356 vol.3, 8-12 Oct 1995 D. Krug, S. Bernet, S. S. Fazel, K. Jalili, M. Malinowski, "Comparison of 2.3-kV Medium-Voltage

[7]

Multilevel Converters for Industrial Medium-Voltage Drives," in Industrial Electronics, IEEE Transactions on , vol.54, no.6, pp.2979-2992, Dec. 2007 A. Nabae, I. Takahashi, and H. Akagi, "A new neutral-point clamped PWM inverter," in Conf. Rec. IEEE G. Beinhold, R. Jakob, and M. Nahrstaedt, "A new range of medium voltage multilevel inverter drives with K. Corzine, Y. Familiant, "A new cascaded multilevel H-bridge drive," in Power Electronics, IEEE B. Wang, "Four-level neutral point clamped converter with reduced switch count," in Power J. Rodriguez and P. Cortes, Predictive Control of Power Converters and Electrical Drives, 1st ed. Chichester,

[8] [9] [10] [11] [12] [13] [14]

Ind. Appl. Soc. Annu. Meeting, Sep./Oct. 1980, pp. 761­766.

floating capacitor technology,"in Proc. 9th European Conf. Power Electronics (EPE), Graz, Austria, 2001. Transactions on , vol.17, no.1, pp.125-131, Jan 2002

Electronics Specialists Conference, 2008. PESC 2008. IEEE, vol., no., pp.2626-2632, 15-19 June 2008 UK: IEEE Wiley press, Mar. 2012.

C. Buccella, C. Cecati, H. Latafat, "Digital Control of Power Converters--A Survey," in Industrial Informatics, IEEE Transactions on, vol.8, no.3, pp.437-447, Aug. 2012 T. Atalik, M. Deniz, E. Koc, C. O. Gercek, B. Gultekin, M. Ermis, I. Cadirci, "Multi-DSP and -FPGABased Fully Digital Control System for Cascaded Multilevel Converters Used in FACTS Applications," in Industrial Informatics, IEEE Transactions on , vol.8, no.3, pp.511-527, Aug. 2012

86

[15]

A. Sanchez, A. De Castro, J. Garrido, "A comparison of simulation and hardware-in-the-loop 2012.

alternatives for digital control of power converters," IEEE Trans. Ind. Informat., vol. 8, no. 3, pp. 491­500, M. P Kazmierkowski, M. Jasinski, G. Wrona, "DSP-Based Control of Grid-Connected Power Converters

[16]

Operating Under Grid Distortions," in Industrial Informatics, IEEE Transactions on , vol.7, no.2, pp.204211, May 2011 E. Monmasson, L. Idkhajine, M. N. Cirstea, I. Bahri, A. Tisan, M. W. Naouar, "FPGAs in Industrial

[17] [18]

Control Applications," in Industrial Informatics, IEEE Transactions on , vol.7, no.2, pp.224-243, May 2011 B. Alecsa, M. N. Cirstea, A. Onea, "Simulink Modeling and Design of an Efficient Hardware-Constrained pp.554-562, Aug. 2012 FPGA-Based PMSM Speed Controller," in Industrial Informatics, IEEE Transactions on, vol.8, no.3, K. Kim, M. Sung, H. Jin, "Design and Implementation of a Delay-Guaranteed Motor Drive for Precision Motion Control," in Industrial Informatics, IEEE Transactions on , vol.8, no.2, pp.351Electronics, IEEE Transactions on , vol.20, no.1, pp.82-89, Jan. 2005 Academic Press Series in Engineering, September 2002. T. Bruckner, D. G. Holmes, "Optimal pulse-width modulation for three-level inverters," in Power M. P. Kazmierkowski, R. Krishnan, and F. Blaabjerg, Eds., Control in Power Electronics: Selected Problems. W. McMurray, "Fast response stepped-wave switching power converter circuit," U.S. Patent 3581212, May 25, 1971. J. A. Dickerson and G. H. Ottaway, "Transformerless power supply with line to load isolation," U.S. Patent 365, May 2012

[19] [20] [21] [22] [23] [24] [25] [26] [27] [28] [29] [30] [31] [32]

3596369, Aug. 3, 1971.

R. H. Baker, "High-voltage converter circuit," U.S. Patent 4203151, May 13, 1980. R. H. Baker, "Bridge converter circuit," U.S. Patent 4270163, May 26, 1981. N. Mohan, T. M. Undeland, and W. P. Robbins, Power electronics, 3rd ed. John Wiley & Sons, Inc., 2003. no.8, pp.1194-1214, Aug 1994

J. Holtz, "Pulsewidth modulation for electronic power conversion," in Proceedings of the IEEE, vol.82, O. Kukrer, "Discrete-time current control of voltage-fed three-phase PWM inverters," in Power Electronics, IEEE Transactions on , vol.11, no.2, pp.260-269, Mar 1996 H. T. Moon; H. S. Kim; M. J. Youn, "A discrete-time predictive current control for PMSM," in Power Electronics, IEEE Transactions on , vol.18, no.1, pp.464-472, Jan 2003 L. Springob, J. Holtz, "High-bandwidth current control for torque-ripple compensation in PM synchronous machines," in Industrial Electronics, IEEE Transactions on , vol.45, no.5, pp.713-721, Oct 1998 Power Eng. Conf., 2001, pp. 526­530. S. J. Henriksen, R. E. Betz, and B. J. Cook, "Practical issues with predictive current controllers," in Proc. of G. H. Bode, P. C. Loh, M. J. Newman, D. G. Holmes, "An improved robust predictive current regulation on, vol.2, no., pp.1058-1063 Vol.2, 17-20 Nov. 2003.

algorithm," in Power Electronics and Drive Systems, 2003. PEDS 2003. The Fifth International Conference

87

[33] [34] [35]

S. M. Yang; C. H. Lee, "A deadbeat current controller for field oriented induction motor drives," in Power Electronics, IEEE Transactions on , vol.17, no.5, pp.772-778, Sep 2002. H. Abu-Rub, J. Guzinski, Z. Krzeminski, H. A. Toliyat, "Predictive current control of voltage-source inverters," in Industrial Electronics, IEEE Transactions on , vol.51, no.3, pp.585-593, June 2004. L. Malesani, P. Mattavelli, S. Buso, "Robust dead-beat current control for PWM rectifiers and active no., pp.1377-1384 vol.2, 12-15 Oct. 1998.

filters," in Industry Applications Conference, 1998. Thirty-Third IAS Annual Meeting. The 1998 IEEE , vol.2, W. Zhang, G. Feng, Y. F. Liu, B. Wu, "Analysis and implementation of a new PFC digital control pp.335-340 vol.1, 15-19 June 2003

[36]

method," in Power Electronics Specialist Conference, 2003. PESC '03. 2003 IEEE 34th Annual , vol.1, no., S. G. Jeong, M. H. Woo, "DSP based active power filter with predictive current control," in Industrial Conference on , vol.1, no., pp.645-650 vol.1, 6-10 Nov 1995

[37]

Electronics, Control, and Instrumentation, 1995., Proceedings of the 1995 IEEE IECON 21st International J. Mossoba, P. W. Lehn, "A controller architecture for high bandwidth active power filters," in Power Electronics, IEEE Transactions on , vol.18, no.1, pp.317-325, Jan 2003 S. Buso, S. Fasolo, P. Mattavelli, "Uninterruptible power supply multi-loop control employing digital APEC 2001. Sixteenth Annual IEEE, vol.2, no., pp.907-913 vol.2, 2001

[38] [39]

predictive voltage and current regulators," in Applied Power Electronics Conference and Exposition, 2001. P. Mattavelli, "An improved deadbeat control for UPS using disturbance observers," in Industrial Electronics, IEEE Transactions on , vol.52, no.1, pp.206-212, Feb. 2005 A. Linder, R. Kennel, "Model Predictive Control for Electrical Drives," in Power Electronics Specialists Conference, 2005. PESC '05. IEEE 36th, vol., no., pp.1793-1799, 16-16 June 2005 R. Kennel, A. Linder, "Generalized predictive control (GPC)-ready for use in drive applications?," in Power Electronics Specialists Conference, 2001. PESC. 2001 IEEE 32nd Annual, vol.4, no., pp.1839-1844 vol. 4, 2001 J. Rodriguez, J. Pontt, R. Vargas, P. Lezana, U. Ammann, P. Wheeler, F. Garcia, "Predictive direct European Conference on , vol., no., pp.1-10, 2-5 Sept. 2007

[40] [41] [42]

[43]

torque control of an induction motor fed by a matrix converter," in Power Electronics and Applications, 2007 P. Cortes, J. Rodriguez, P. Antoniewicz, and M. Kazmierkowski, "Direct power control of an AFE using predictive control," IEEE Transactions on Power Electronics, vol. 23, no. 5, pp. 2516­2523, Sep. 2008. S. Kouro, B. La Rocca, P. Cortes, S. Alepuz, B. Wu, and J. Rodriguez, "Predictive control based selective Congr. and Expo. (ECCE), Sep. 2009, pp. 3130­3136, San Jose, CA, USA.

[44] [45]

harmonic elimination with low switching frequency for multilevel converters," in IEEE Energy Conversion P. Cortes, J. Rodriguez, D. Quevedo, and C. Silva, "Predictive current control strategy with imposed load current spectrum," IEEE Trans. Power Electron.,vol. 23, no. 2, pp. 612­618, Mar. 2008. M. Rivera, M. Perez, V. Yaramasu, B. Wu, L. Tarisciotti, P. Zanchetta, P. Wheeler, "Modulated model

[46] [47]

predictive control (M2PC) with fixed switching frequency for an NPC converter," in Power Engineering,

88

Energy and Electrical Drives (POWERENG), 2015 IEEE 5th International Conference , vol., no., pp.623[48] 628, 11-13 May 2015. H. Aggrawal, J. I. Leon, L. G. Franquelo, S. Kouro, P. Garg, J. Rodriguez, "Model predictive control

based selective harmonic mitigation technique for multilevel cascaded H-bridge converters," in IECON 2011 - 37th Annual Conference on IEEE Industrial Electronics Society , vol., no., pp.4427-4432, 7-10 Nov. 2011.

[49]

Balancing Effect in Neutral-Point-Clamped Three-Level Inverters," in Power Electronics, IEEE Transactions on , vol.26, no.11, pp.3084-3095, Nov. 2011.

 der, R. Ro  sner, S. El-Barbari, "A Comprehensive Study of Neutral-Point SelfJ. Shen, S. Schro

89


