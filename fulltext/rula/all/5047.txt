NOVEL ULTRASOUND TRANSMISSION AND RECONSTRUCTION TECHNIQUES FOR SYNTHETIC TRANSMIT APERTURE IMAGING

by Ping Gong M.Sc. Lakehead University, Thunder Bay, Canada, 2012 B.Eng. Tianjin University, Tianjin, China, 2010

A dissertation presented to Ryerson University in partial fulfillment of the requirements for the degree of Doctor of Philosophy in the Program of Biomedical Physics

Toronto, Ontario, Canada, 2016 Â© Ping Gong, 2016

Author's Declaration
I hereby declare that I am the sole author of this dissertation. This is a true copy of the dissertation, including any required final revisions, as accepted by my examiners.

I authorize Ryerson University to lend this dissertation to other institutions or individuals for the purpose of scholarly research

I further authorize Ryerson University to reproduce this dissertation by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

I understand that my dissertation may be made electronically available to the public.

Ping Gong

ii

Abstract
Novel Ultrasound Transmission and Reconstruction Techniques for Synthetic Transmit Aperture Imaging Ping Gong Doctor of Philosophy, Biomedical Physics Ryerson University, 2016

This dissertation describes ultrasound algorithms developed for synthetic transmit aperture (STA) imaging during the transmission and the image reconstruction stages. Images generated using these algorithms demonstrate image quality enhancement both theoretically and experimentally. The advanced algorithms also improve the application of STA imaging. Due to the single element transmission pattern, the low signal-to-noise ratio is a major limitation for STA imaging. A delay-encoded transmission scheme (DE-STA) was designed in this dissertation to encode all the transmissions. The decoded RF signals were equivalent to the standard STA signals, but with a higher SNR. Improved image qualities were observed under DE-STA transmission in terms of lateral resolution (+28%), peak-signal-to-noise ratio (PSNR, +7 dB) and target contrast-to-noise ratio (CNR, +360%) compared to those acquired with the standard STA mode. The stability of DE-STA was analyzed and verified under various noise levels by the iii

special distribution of the singular values of the encoding matrix through singular value decomposition (SVD) (i.e. all the singular values were the same except for the first one and the last one). A more efficient decoding process was also derived based on pseudo-inversion (PI) and the computation complexity was reduced by 2/3. Speckle and undesired sidelobe signals can reduce the lesion CNR and detectability in ultrasound images. Typically, the CNR can be increased by spatial compounding (SC) or frequency compounding (FC) during reconstruction. We proposed methods to implement a 2dimentional (2-D) aperture domain filter in the SC/FC processes, referred to as filtered spatial compounding (FSC) and filtered frequency compounding (FFC), for synthetic transmit aperture (STA) imaging. Both techniques reduced the sidelobe interference and provided improved lesion CNR. Consequently, the lesion signal-to-noise ratio (lSNR) in FSC and FFC increased (up to +130%), compared to that in the standard delay-and-sum (DAS) method. This dissertation investigates all these proposed advanced ultrasound algorithms, with the end goal of implementing these methods in STA imaging to extend its application in clinic.

iv

Acknowledgements
I would like to sincerely thank my supervisors, Dr. Yuan Xu and Dr. Michael C. Kolios for their support and confidence during this research. Their excitement and enthusiasm about physics is not only motivating, but also highly contagious. I feel privileged to have worked with such knowledgeable professionals. I would also like to thank my supervisory committee, Dr. Richard Cobbold and Dr. Jahan Tavakkoli for their insightful guidance during this research. This work would not have been possible without the support of my colleagues who are also my close friends, Ying Li, Yan Wang and Na Zhao for their patience and help in many different ways. I am also grateful to the technical support provided by the lab and physics program; in particular, Arthur Worthington, Matthew Forrest and Graham Pearson for their knowledge in ultrasound and technical issues. I would like to thank my parents, for their support and for always encouraging me to pursue my desires. Finally I would like to express my gratitude to my husband, Jay Wu, who encouraged me to pursue a field I find exciting and rewarding. This work would not have been possible without his support.

v

Table of Contents

Author's Declaration .............................................................................................................. ii  Abstract ................................................................................................................................... iii  Acknowledgements ................................................................................................................. v  Table of Contents ................................................................................................................... vi  List of Tables .......................................................................................................................... xi  List of Figures ....................................................................................................................... xiv  List of Symbols ................................................................................................................... xxiii  Chapter 1 Introduction........................................................................................................... 1  1.1 Motivation ....................................................................................................................... 1  1.2 Principle of Synthetic Transmit Aperture (STA) Imaging .............................................. 2  1.2.1 Single Element Transmission pattern ....................................................................... 2  1.2.2 Delay-and-Sum Reconstruction................................................................................ 3  1.2.3 Dynamic Apodization ............................................................................................... 5  1.3 Image Assessment (Quality metrics)............................................................................... 7  1.3.1 Signal-to-Noise Ratio of Backscattered RF signals ( SNR dB ).................................. 7  1.3.2 Peak Signal-to-Noise Ratio (PSNR) ......................................................................... 8  1.3.3 Speckle Signal-to-Noise Ratio (sSNR)..................................................................... 8  vi

1.3.4 Lateral and Axial resolutions .................................................................................... 9  1.3.5 Contrast-to-Noise Ratio (CNR) ................................................................................ 9  1.3.6 Lesion Signal-to-Noise Ratio (lSNR) ....................................................................... 9  1.3.7 Clutter-energy-to-total-energy ratio (CTR) ............................................................ 10  1.4 Goals and Specific Aims ............................................................................................... 10  1.5 Overview of the Dissertation......................................................................................... 11  Chapter 2 Delay-encoded Transmission and Image Reconstruction Method in Synthetic Transmit Aperture Imaging................................................................................................. 14  2.1 Abstract ......................................................................................................................... 14  2.2 Introduction ................................................................................................................... 16  2.3 Methods ......................................................................................................................... 19  2.3.1 Theory of DE-STA imaging ................................................................................... 19  2.3.2 Application to Ultrasound Imaging: DE-STA ........................................................ 23  2.4 Results ........................................................................................................................... 29  2.4.1 Simulation Results .................................................................................................. 29  2.4.2 Experimental Results .............................................................................................. 32  2.5 Discussion ..................................................................................................................... 37  2.6 Conclusion ..................................................................................................................... 40  Chapter 3 Pseudo-Inverse (PI) Decoding process in Delay-encoded Synthetic Transmit Aperture (DE-STA) Imaging ............................................................................................... 41  3.1 Abstract ......................................................................................................................... 41  vii

3.2 Introduction ................................................................................................................... 43  3.3 Methods ......................................................................................................................... 44  3.3.1 Pseudo-Inverse (PI) in DE-STA Imaging ............................................................... 44  3.3.2 Application to Ultrasound Imaging: Pseudo-DE-STA ........................................... 46  3.4 Results ........................................................................................................................... 48  3.4.1 Singular Values and the Singular Vectors Study.................................................... 48  3.4.2 Simulation Results .................................................................................................. 50  3.4.3 Experimental Results .............................................................................................. 57  3.5 Discussion ..................................................................................................................... 58  3.6 Conclusion ..................................................................................................................... 63  Chapter 4 Image Reconstruction by Filtered Spatial Compounding (FSC) in Synthetic Transmit Aperture (STA) Imaging ..................................................................................... 64  4.1 Abstract ......................................................................................................................... 64  4.2 Introduction ................................................................................................................... 66  4.3 Methods ......................................................................................................................... 68  4.3.1 Filtered Spatial Compounding (FSC) in Synthetic Transmit Aperture (STA) Imaging ............................................................................................................................ 68  4.3.2 Application to Ultrasound Imaging: FSC ............................................................... 74  4.4 Results ........................................................................................................................... 75  4.4.1 Simulation Results .................................................................................................. 76  4.4.2 Stability against Noise ............................................................................................ 87  viii

4.4.3 Experimental Results .............................................................................................. 89  4.5 Discussion ..................................................................................................................... 92  4.5.1 Computational efficiency of Post-Processing in FSC technique ............................ 92  4.5.2 Aperture Domain Filter: An Unified Framework for Various Beamformers ......... 93  4.5.3 Lateral Resolution................................................................................................... 96  4.5.4 lSNR Improvement ................................................................................................. 99  4.6 Conclusion ................................................................................................................... 100  Chapter 5 Image Reconstruction by Filtered Frequency Compounding (FFC) in Synthetic Transmit Aperture (STA) Imaging .................................................................. 101  5.1 Abstract ....................................................................................................................... 101  5.2 Introduction ................................................................................................................. 103  5.3 Methods ....................................................................................................................... 105  5.3.1 Filtered Frequency Compounding (FFC) in Synthetic Transmit Aperture (STA) Imaging .......................................................................................................................... 105  5.3.2 Application to Ultrasound Imaging: FFC ............................................................. 107  5.4 Results ......................................................................................................................... 108  5.4.1 Hanning window and RF window Selection ........................................................ 108  5.4.2 Simulation Results ................................................................................................ 113  5.4.3 Experimental Results ............................................................................................ 115  5.5 Discussion ................................................................................................................... 117  5.5.1 Normalization Effect ............................................................................................ 118  ix

5.5.2 Lateral Resolution Loss ........................................................................................ 119  5.5.3 Axial Resolution Loss .......................................................................................... 119  5.5.4 Relationship between FFC and CFC .................................................................... 120  5.5.5 CNR and sSNR Improvement .............................................................................. 123  5.6 Conclusion ................................................................................................................... 123  Chapter 6 Conclusions and Future Work ........................................................................ 125  6.1 Summary and Conclusions .......................................................................................... 125  6.2 Future Work ................................................................................................................ 127  6.2.1 Decoding Scheme Extension ................................................................................ 127  6.2.2 Reducing Post-Processing time ............................................................................ 127  6.2.3 Phase Aberration Correction ................................................................................ 128  Appendix A .......................................................................................................................... 133  Bibliography ........................................................................................................................ 135  Glossary ............................................................................................................................... 147 

x

List of Tables
Table 2-1. PSNR and FWHM of the point target and CNR of the hyper-echoic inclusion in conventional B-mode, traditional STA and DE-STA images, respectively in Figure 2-6. ......................................................................................................................................... 34  Table 2-2. CNR of the 2nd and 3rd hypo inclusions in conventional B-mode, traditional STA and DE-STA images, respectively in Figure 2-7. ............................................................ 36  Table 3-1. Detailed quantifications of STA, CPI and TPI decoded RF signals with 0 dB additive noise at the transmission of 30th and 1st element respectively ........................... 54  Table 3-2. Detailed quantifications of STA, CPI and TPI decoded RF signals with -10 dB additive noise at the transmission of 30th and 1st element, respectively .......................... 56  Table 3-3. Detailed quantifications of CPI and TPI decoded images of the experimental phantom ........................................................................................................................... 58  Table 4-1. Quantification of lateral resolutions at different levels (-6, -20, and -40 dB), axial resolutions and CTR values of point target images obtained from (a) DAS, (b) CSC, and FSC with Hanning window filter sizes as: (c) 1.0, (d) 1.6, (e) 2.6, (f) 3.6 (g) 7.8, (h) 16.7 cm-1. (i) is the FSC image without Hanning window filtering. `--': out of the measurement range. ......................................................................................................... 79 

xi

Table 4-2. Quantification of sSNR, resolutions, CNR, and lSNR values of speckle generating phantom images obtained from (a) DAS, (b) CSC, and FSC with Hanning window filter sizes of : (c) 1.0, (d) 1.6, (e) 2.6, (f) 3.6 (g) 7.8 cm-1. ...................................................... 82  Table 4-3. Quantification parameters of sSNR, resolutions, CNR, and lSNR measured in DAS, CSC, and FSC images. CNR 1 stands for the CNR value for lesion 1 and lSNR 1 stands for the lSNR value for lesion 1, etc. ..................................................................... 87  Table 4-4. Quantification parameters of sSNR, resolutions, CNR, and lSNR measured in DAS, CSC, and FSC images with 0 dB band-passed white Gaussian noise. CNR 1 stands for the CNR value for lesion 1 and lSNR 1 stands for the lSNR value for lesion 1, etc. 89  Table 4-5. Quantification parameters of sSNR, resolutions, CNR, and lSNR measured in DAS, CSC, and FSC images. .......................................................................................... 92  Table 4-6. Comparison of active aperture size in DAS and FSC imaging techniques. .......... 99  Table 5-1. Quantification of sSNR, resolutions, CNR and lSNR values of the tissue mimicking phantom images (Figure 5-2) obtained by FFC with Hanning window filter sizes as: (a) 1.6, (b) 2.6, (c) 3.6, (d) 5.2 cm-1. CNR1 and lSNR1 represent the CNR and lSNR values for lesion 1, respectively, etc. The values for DAS image are shown as references. ...................................................................................................................... 110  Table 5-2. Quantification of sSNR, resolutions, CNR and lSNR values of the tissue mimicking phantom images (Figure 5-4) obtained by FFC with RF window lengths as: (a) 4, (b) 7.5, (c) 12.5, (d) 15, and (e) 20
.

CNR1 and lSNR1 represent the CNR and

xii

lSNR values for lesion 1, respectively, etc. The values for DAS image are shown as references. ...................................................................................................................... 113  Table 5-3. Quantification of sSNR, resolutions, CNR and lSNR values of the tissue mimicking phantom images (Figure 5-6) obtained by (a) DAS, (b) CSC, (c) FSC, and (d) FFC, respectively. .......................................................................................................... 115  Table 5-4. Quantification of sSNR, resolutions, CNR and lSNR values of the experimental gel phantom images (Figure 5-8) obtained by (a) DAS, (b) CSC, (c) FSC, and (d) FFC, respectively. ................................................................................................................... 117  Table 5-5. Quantification of sSNR, resolutions, CNR and lSNR values of the tissue mimicking phantom images (Figure 5-10) obtained by FFC with (a) and without (b) normalization. ................................................................................................................ 119  Table 5-6. The comparison between the measured and expected axial resolutions with different RF window lengths: (a) 4, (b) 7.5, (c) 12.5, (d) 15 and (e) 20


. ................. 120 

Table 6-1. Quantification values of resolutions, CR and CNR of the porcine kidney images obtained with (a) STA and (b) TPI-DE-STA. ............................................................... 129  Table 6-2. Quantification values for lateral and axial resolutions, CR, CNR, and lSNR of the porcine kidney images reconstructed using (a) DAS, (b) CSC, (c) FSC, and (d) FFC under the DE-STA transmission mode. ......................................................................... 131 
 

xiii

List of Figures
Figure 1-1. Synthetic aperture ultrasound imaging transmission scheme. TX#1 to TX#N are N consecutive transmissions. In each transmission only one element is excited with the same signal pulse P(t). Each square represents an element in the array and the solid square in the figure denotes the active transmitting element............................................. 3  Figure 1-2. Reconstruction geometry for the traditional STA imaging. t i is the i -th transmitter and rk is the k -th receiver. r is the scatter point. .......................................... 5  Figure 1-3. Diagram for dynamic transmit/receive apodization. The black bar stands for the active sub-apertures increasing with depth. ....................................................................... 5  Figure 1-4. The design of Hanning window function applied on both transmit and receive as apodization functions......................................................................................................... 6  Figure 2-1. Hadamard encoded transmission scheme. TX#1 to TX#N are N coded transmissions and in each transmission, active elements are excited with combinations of pulses (P(t)) and phase inverted pulses (-P(t)) simultaneously according to the Hadamard matrix. The figure shows a size 4 Hadamard sequence as an example. .......................... 17  Figure 2-2. The configuration and results of a numerical simulation with a point target and a four-element array to illustrate DE-STA. (a) Waveform function of each transmission element in one of the total four transmission events. (TX # l : l -th transmission event) (b) Geometry of the simulation model. (c) Signals received by channel 1 in DE-STA xiv

imaging. (d) Decoded RF signals received by channel 1 when only one element was excited as in traditional STA imaging. (TXCh1: channel 1 was excited) ....................... 23  Figure 2-3. Experimental system: Ultrasonix RP research plantform equipped with SonixDAQ acquisition system (Ultrasonix, Vancouver, CA). Transducer array: L14-5, linear array with 5 MHz central frequency. Sampling frequency was 40MHz ............... 28  Figure 2-4. Plots of the simulated raw RF signal obtained from: (a) traditional STA imaging without noise, (b) traditional STA imaging with noise and (c) the restored traditional STA by decoding the DE-STA signals with the same level of noise as in (b). ............... 31  Figure 2-5. Simulated log-enveloped beamformed images obtained in (a) B-mode imaging, (b) traditional STA imaging without adding noise, (c) traditional STA imaging with noise and (d) DE-STA imaging with the same amount of noise in raw RF signals as in (c). The dynamic ranges are: (a) 160 dB; (b), (c) and (d): 60 dB. ................................... 32  Figure 2-6. Experimental log-enveloped beamformed images obtained in (a) B-mode imaging, (b) traditional STA imaging and (c) DE-STA imaging. Top row: phantom images. Bottom row: lateral line plots at the depth of 2.4 cm. The white line indicates the position of line plots in the images. The dynamic ranges are: (a) 40 dB; (b) and (c): 80 dB..................................................................................................................................... 34  Figure 2-7. Experimental log-enveloped beamformed images obtained in (a) B-mode imaging, (b) traditional STA imaging and (c) DE-STA imaging. Top row: phantom images. Bottom row: axial line plots at 2.25 cm (indicated by vertical white lines). The

xv

dynamic ranges are: (a) 40 dB; (b) and (c): 60 dB. Three dashed squares on the axial line plot in (c) indicate the position of the three hypo inclusions........................................... 35  Figure 2-8. Experimental log-enveloped beamformed images obtained in (a) B-mode imaging, (b) traditional STA imaging and (c) DE-STA imaging. Top row: phantom images. Bottom row: axial line plots at 2.0 cm (indicated by vertical white lines). The white arrows in (b) indicate the locations of four wire targets. The dynamic ranges are: (a) 40 dB; (b) and (c): 60 dB. Three dashed squares on the axial line plot in (c) indicate the position of the hyper, hypo and another hyper inclusions. ........................................ 37  Figure 3-1. Singular values of coding matrix A in DE-STA methods at 3 different frequencies (i.e. 2, 3.5 and 5 MHz). The singular values are all the same ( 0 ) except for the first one ( 1 ) and the last one ( R ) at 2 and 3.5 MHz. At the central frequency 5 MHz (dotted line), the singular values are constant. ....................................................... 49  Figure 3-2. Pre-beamformed RF signals received by the 30th receiving element at the transmission of the 30th element from 4 different cases: (a) standard STA signal without noise, (b) standard STA signal with 0 dB additive band-passed noise, restored DE-STA signal after applying (c) CPI and (d) TPI to the RF data with the same amount of noise as in (b). ........................................................................................................................... 53  Figure 3-3. Pre-beamformed RF signals received by the 30th receiving element at the transmission of the 1st element from 4 different cases: (a) standard STA signal without noise, (b) standard STA signal with 0 dB additive band-passed noise, restored DE-STA

xvi

signal after applying (c) CPI and (d) TPI to the RF data with the same amount of noise as in (b). ........................................................................................................................... 54  Figure 3-4. Pre-beamformed RF signals received by the 30th receiving element at the transmission of the 30th element from 4 different cases: (a) standard STA signal without noise, (b) standard STA signal with -10 dB additive band-passed noise, restored DESTA signal after applying (c) CPI and (d) TPI to the RF data with the same amount of noise as in (b)................................................................................................................... 55  Figure 3-5.Pre-beamformed RF signals received by the 30th receiving element at the transmission of the 1st element from 4 different cases: (a) standard STA signal without noise, (b) standard STA signal with -10 dB additive band-passed noise, restored DESTA signal after applying (c) CPI and (d) TPI to the RF data with the same amount of noise as in (b)................................................................................................................... 55  Figure 3-6. Reconstructed images using (a) CPI and (b) TPI decoding processes with 0 dB additive noise ................................................................................................................... 56  Figure 3-7. Reconstructed images using (a) CPI and (b) TPI decoding processes with -10 dB additive noise ................................................................................................................... 56  Figure 3-8. Experimental DE-STA log-enveloped beamformed images decoded from (a) CPI and (b) TPI. Top row: phantom images obtained by (a) CPI and (b) TPI; Bottom row: lateral line plots through the wire target as in (c) CPI image and (d) TPI image. ........... 57  Figure 3-9. Plots of vectors v128 and v64 (reference) of coding matrix A at 8 MHz ........... 60 

xvii

Figure 4-1. Simulated STA image of the phantom with two closely located point targets. One is at (0.91 cm, 1.5 cm) and the other is at (1.01 cm, 1.5 cm). The image was beamformed using DAS........................................................................................................................ 71  Figure 4-2. Aligned RF signals at the transmission of second element in simulation. Focus is set on the point target at (1.01 cm, 1.5 cm) in Figure 4-1. (a) Aligned RF signals without the 2-D aperture domain filter; (b) Aligned RF signals with the 2-D aperture domain filter in FSC technique. The interference patterns (oblique lines) in (a) are removed. ... 72  Figure 4-3. Flow chart of the filtered spatial compounding (FSC) reconstruction method. DAS and CSC processes are shown as references. ......................................................... 73  Figure 4-4. Aligned channel RF signals in simulation (a) without and (b) with 2-D aperture domain filter from a speckle generating phantom. .......................................................... 76  Figure 4-5. Simulated beamformed images of a point target phantom reconstructed with (a) DAS, (b) CSC, and FSC with different Hanning window filter sizes as: (c) 1.0, (d) 1.6, (e) 2.6, (f) 3.6 (g) 7.8, (h) 16.7 cm-1. (i) is the FSC image without Hanning window filtering. The dynamic range is 55 dB. ............................................................................ 78  Figure 4-6. Lateral line plots through simulated images of the point target reconstructed with DAS (black solid line), CSC (black dashed line), and FSC with three Hanning window sizes chosen as examples: 1.0 (gray solid line), 2.6 (gray dashed line), and 16.7 cm-1 (gray dot-dashed line). ..................................................................................................... 79  Figure 4-7. Simulated beamformed images of a speckle generating phantom reconstructed with (a) DAS, (b) CSC, and FSC with different Hanning window filter sizes as: (c) 1.0, xviii

(d) 1.6, (e) 2.6, (f) 3.6, and (g) 7.8 cm-1. (h) shows the selected regions of interest (inside the inclusion) and the background (on its both sides) to quantify the CNR and lSNR for both hyper and hypo inclusions, as indicated by the white boxes. The dynamic range is 55 dB................................................................................................................................ 82  Figure 4-8. . CNR (a) and lSNR (b) curves for both hyper and hypo lesions in the simulated speckle generating phantom. Upper row: hyper lesion; Lower row: hypo lesion. .......... 84  Figure 4-9. Model of the tissue mimicking phantom which contained two hyper and two hypo inclusions numbered from lesion 1 to lesion 4. The six white boxes with the same size illustrate the regions selected from the targets (lesion 1-4) and the background for the CNR and lSNR quantification. .................................................................................. 85  Figure 4-10. Beamformed images of the simulated tissue mimicking phantom using (a) DAS, (b) CSC, and (c) FSC techniques. The dynamic range is 35 dB. .................................... 86  Figure 4-11. Lateral line plots through the center point target obtained from DAS (dashed line), CSC (dotted line), and FSC (solid line). ................................................................ 87  Figure 4-12. Beamformed images of simulated tissue mimicking phantom obtained with (a) DAS, (b) CSC, and (c) FSC under 0 dB band-passed white Gaussian noise. The dynamic range is 35 dB. ................................................................................................................. 88  Figure 4-13. Beamformed images of the experimental tissue mimicking phantom using (a) DAS, (b) CSC, and (c) FSC techniques. The dynamic range is 70 dB. .......................... 90  Figure 4-14. Zoomed-in images of the wire target inside the experimental tissue mimicking phantom obtained using (a) DAS, (b) CSC, and (c) FSC techniques. ............................. 91  xix

Figure 4-15. Lateral line plots through the wire target obtained from DAS (dashed line), CSC (dotted line), and FSC (solid line). .................................................................................. 91  Figure 4-16. The filters in the T/R spatial-frequency domain along transmit ( k m ) and receive ( k n ) directions in (a) DAS, (b) CSC, and (c) FSC with cut-off frequency of 1.0 cm-1. .. 94  Figure 4-17. T/R aperture matrix of a 64-element array. The shaded area is the selected subaperture with 30 elements in both T and R directions, corresponding to a cut-off spatial frequency of 2.6 cm-1. This area is translated along both directions. M' and N' are the sub-aperture sizes determined by the size of h along T and R , respectively. In this chapter, M'=N'. ............................................................................................................... 96  Figure 4-18. Beamformed images of tissue mimicking phantom obtained with FSC with (a) and without (b) apodization. The dynamic range is 35 dB. ............................................. 97  Figure 4-19. Lateral line plots through the point target obtained from DAS (black dashed line), CSC (black dotted line), FSC without apodization (black solid line) and FSC with apodization (gray dashed line). ........................................................................................ 98  Figure 5-1. Flow chart of the filtered frequency compounding (FFC) reconstruction method. DAS, CSC, and FSC processes are shown as references. ............................................. 107  Figure 5-2. Beamformed images of the tissue mimicking phantom (Figure 4-9) reconstructed using FFC with different Hanning window filter sizes as: (a) 1.6, (b) 2.6, (c) 3.6, (d) 5.2 cm-1. The dynamic range is 28 dB. ................................................................................ 110  Figure 5-3. lSNR plots for all the hyper and hypo lesions in the simulated tissue mimicking phantom as a function of Hanning window size. lSNR1 corresponds to the lSNR plot for xx

lesion 1, etc. lSNR1: black dashed line; lSNR2: gray solid line; lSNR3: gray dashed line;

lSNR4: black solid line. The selected window size is indicated by the vertical dashdotted line at 2.6 cm-1. ................................................................................................... 111  Figure 5-4. Beamformed images of the tissue mimicking phantom (Figure 4-9) reconstructed using FFC with different RF window lengths as: (a) 4, (b) 7.5, (c) 12.5, (d) 15, and (e) 20   . The dynamic range is 28 dB. ............................................................................. 112  Figure 5-5 lSNR plots for all the hyper and hypo lesions in the simulated tissue mimicking phantom as a function of RF window length. lSNR1 corresponds to the lSNR plot for lesion 1, etc. lSNR1: black dashed line; lSNR2: gray solid line; lSNR3: gray dashed line;

lSNR4: black solid line. The selected RF window length is indicated by the vertical
dash-dotted line at 12.5   . ........................................................................................... 113  Figure 5-6. Beamformed images of the tissue mimicking phantom (Figure 4-9) reconstructed with (a) DAS, (b) CSC (c) FSC, and (d) FFC, respectively. The dynamic range is 28 dB. ....................................................................................................................................... 114  Figure 5-7. Lateral line plots through the wire target from images obtained with DAS (dashed line), CSC (dotted line), FSC (thin solid line), and FFC (thick solid line).................... 115  Figure 5-8. Beamformed images of the experimental gel phantom reconstructed with (a) DAS, (b) CSC (c) FSC, and (d) FFC, respectively. The dynamic range is 70 dB. The two horizontal white lines in (a) indicate the two depth locations for line plots. ................. 116 

xxi

Figure 5-9. Lateral line plots at (a) 2.5 cm depth, through the wire target; and (b) 3.5 cm depth, through the inclusions from images obtained with DAS (dashed line), CSC (dotted line), FSC (thin solid line), and FFC (thick solid line). .................................... 117  Figure 5-10. Beamformed images of tissue mimicking phantom obtained with FFC with (a) and without (b) normalization. The dynamic range is 28 dB. ....................................... 118  Figure 6-1. Beamformed images of a porcine kidney under the transmission modes of (a) STA and (b) DE-STA where the data were decoded using truncated pseudo-inversion (TPI). The two white boxes in (a) indicate the regions selected for CR and CNR quantification. ................................................................................................................ 129  Figure 6-2. Beamformed images of a porcine kidney under DE-STA transmission mode and reconstructed using (a) DAS, (b) CSC, (c) FSC, and (d) FFC, respectively. ................ 130 

xxii

List of Symbols
Chapter 1
Ap (i ) Ap ( k )
Apodization value applied to the i -th transmitting element Apodization value applied to the k -th receiving element Combined apodization value while using the i -th transmitting element and k -th receiving element Speed of sound Diameter of the imaging target Distance from the i -th transmitting element to the image point r Distance from the image point r to the k -th receiving element Combined distance from the i -th transmitting element to the image point r , then to the k -th receiving element Transmission element index Low-resolution image in synthetic transmit aperture (STA) imaging High-resolution image in STA imaging Image value at point r from the contribution of transmit-receive element ( i , k ) pair Receiving element index Point target peak signal Radiofrequency (RF) signal value acquired by the k -th receiving element at time t (r, i, k ) after the transmission of the i -th transmitting element in the traditional STA imaging Scatter point in the image region Mean value of the log-enveloped background Mean value of the log-enveloped region of interest (ROI) Time of flight from the i -th transmitting element to the image point r , then to the k -th receiving element Width of the transducer element Wavelength of transmitted pulse Angle subtended at the transducer element corresponding to the full width at half maximum (FWHM) of the pressure field

Ap (i, k )
c d0

d (i, r ) d (r, k ) d (r, i, k )
i  1: I I low

I high I (r, i, k )
k  1: K
max{Starget}

p(t (r, i, k ), i, k )

r S background
S ROI

t (r, i, k )
W

  FWHM

xxiii

g m  background  ROI
 background

Grating lobe angle Main lobe angle Standard deviation of the envelope detected noise/background Standard deviation of the envelope detected region of interest Mean of the envelope-detected speckles in the background

Chapter 2-3

A

Ali ( f ) D e f0 Hn i  1: I k  1: K l  1: L mlk (t ) M lk ( f ) M
O() pik (t )

Encoding matrix with elements of Ali ( f ) Elements of encoding matrix Decoding matrix Noise in measured signals M Central frequency of transmitted pulse n-by-n Hadamard coding matrix Transmission element index Receiving element index Transmission event number Time domain RF signal in the delay-encoded STA imaging which is received by the k -th receiving element in the l -th transmission event Frequency spectrum of mlk (t ) Matrix with elements of M lk ( f ) , frequency-domain RF signal in the DESTA imaging Order of computational complexity Equivalent traditional STA signal, which is received by the k -th receiving element when only the i -th transmitting element is excited Frequency spectrum of pik (t ) Matrix with elements of Pik ( f ) Spectrum of decoded RF signal matrix with noise Difference between the spectra of decoded RF signal matrices with and without noise Rank of encoding matrix A Singular matrix of A containing all the singular values  i ( i  1 : R ) Time delay that is applied to the i -th transmitting element in the l -th transmission event Delay matrix with elements of tli Left singular vectors of A

Pik ( f ) P

Pn
P R S

tli
T

U  (u1 , u2 ,uR )

xxiv

V  (v1 , v2 ,vR )  i ( i  1: R )
Chapter 4-5*

Right singular vectors of A Singular values of A

Ap (m)

Apodization value applied to the m -th transmitting element Apodization value applied to the n -th receiving element Central frequency of the n-th sub-band in frequency compounding

Ap (n)
fn f low H


f high

Spectrum range undergoes frequency compounding 2-D aperture domain filter applied on both transmit and receive Inverse Fourier transform of H Aperture domain filter on transmit domain Aperture domain filter on receive domain Aperture-frequency index along transmit domain Aperture-frequency index along receive domain Image point reconstructed with conventional spatial compounding (CSC) with coordinates of ( x, z ) Image point reconstructed with delay-and-sum (DAS) Image point reconstructed with filtered frequency compounding (FFC) Image point reconstructed with filtered spatial compounding (FSC) Transmission element index Equivalent sub-aperture size in transmit domain in FSC Receiving element index Equivalent sub-aperture size in receive domain in FSC 3-D STA RF signal transmitted by channel m , received by channel n , after focusing delay compensation with t nm 3-D Fourier transform of p (t  t nm , n, m) 3-D STA RF signal after aperture domain filtering 3-D spectrum of pfiltered (t  tnm , n, m) 1-D Fourier transform of p(t  t nm , n, m) along temporal-frequency domain

h Hm

Hn km kn I CSC ( x, z ) I DAS ( x, z ) I FFC ( x, z ) I FSC ( x, z ) m (m  1 : M )
M' N'

n (n  1 : N )
p (t  t nm , n, m)
P

pfiltered (t  tnm , n, m) Pfiltered

P( f , n, m)e
*

 j 2ft nm

Note that from Chapter 4, the transmit and receive indices i (i=1:I) and k (k=1:K) were replaced by m (m=1:M) and n (n=1:N) in order to

avoid the confusion with the imaginary unit expression `i 'or `j'.

xxv

P (t  t nm , k n , k m )
Pnor Ptransmitted P( f n , f ) p( f n , t ) R T T  12.5 t nm

2-D Fourier transform of p (t  t nm , n, m) along transmit and receive domains 3-D spectrum of STA RF signals after aperture domain filtering and normalization in FFC 3-D spectrum of the transmitted pulse Filtered RF spectrum within the n-th sub-band Inverse Fourier Transform of P ( f n , f ) , filtered RF signals in time domain using the n-th sub-band Receive aperture domain Transmit aperture domain RF window length used in FFC Focusing delay applied to the STA RF signal received by the n -th element under the transmission of m -th element Sub-band filter at central frequency f n Inverse Fourier Transform of W ( f n ) , sub-band filter in time domain Coordinates of a point in the reconstructed image

W ( fn ) w(t )
( x, z )

xxvi

Chapter 1 Introduction

1.1 Motivation
Ultrasound imaging has been proven to be a safe, relatively simple and inexpensive, real-time medical imaging modality for soft tissues [1]. It has good spatial resolution (on the order of hundreds of microns) and imaging depth (on the order of 10 cm) depending on the frequency range used. The conventional ultrasound imaging (B-mode) is one of the most commonly used modes, in which the radiofrequency (RF) signals are acquired after sending focused beams along various A-lines sequentially in time. A disadvantage of B-mode imaging is that the images are only optimally focused at one depth because of the single transmission focus [2]. Therefore, the spatial resolution of B-mode ultrasound images still needs improvement at locations outside the transmission focus. Synthetic transmit aperture (STA) imaging is an approach to solve this problem associated with B-mode ultrasound imaging. It is based on a software beamforming process, and focusing can be obtained at every point in the image in both transmit and receive [2-6]. Synthetic transmit aperture imaging has been widely used in different fields such as radar and sonar systems [7], nondestructive testing (NDT) [8, 9], seismic monitoring [10], and medical ultrasound imaging such as breast micro-calcifications detection [11] and flow estimation [12] since it provides 1

images with high resolution and detectability. However, because of the single element transmission scheme, the low signal-to-noise ratio (SNR) of the channel RF data is a major limitation in the STA approach compared to the conventional B-mode imaging approach, leading to poor image quality and penetration depth. Detailed background about technologies for transmission power improvement in STA imaging will be introduced in Chapter 2 and 3. Moreover, the reconstructed images have large speckle variations which also results in low target detectability in STA images. Detailed speckle reduction methods will be introduced in Chapter 4 and 5. This dissertation is devoted to exploring novel ultrasound algorithms for STA imaging in the transmission (encoded transmission for higher signal-to-noise ratio) and the image reconstruction stages (spatial or frequency compounding) to improve the image quality.

1.2 Principle of Synthetic Transmit Aperture (STA) Imaging
1.2.1 Single Element Transmission pattern
In STA imaging as shown in Figure 1-1, an array of transmitters and receivers are typically used. An array element can serve as both a transmitter and then a receiver. Typically, each element is excited consecutively. In each transmission, the active element emits a semi-spherical wave that propagates through a large image region and then all the receiving elements are used to acquire the RF backscatter signals, which can then be used to reconstruct a low-resolution image. Afterwards, all the low resolution STA images can be 2

combined coherently or incoherently to form a high-resolution image (see Fig. 1 in Reference [2] for a detailed description of STA) [2]. In the following text of this dissertation, the data obtained in this transmission scheme are referred to as the traditional/standard STA data.

Figure 1-1. Synthetic aperture ultrasound imaging transmission scheme. TX#1 to TX#N are N consecutive transmissions. In each transmission only one element is excited with the same signal pulse P(t). Each square represents an element in the array and the solid square in the figure denotes the active transmitting element.

1.2.2 Delay-and-Sum Reconstruction
In STA image reconstruction, a dynamic focus can be attained in both transmit and receive processes [2]. Focusing in receive is obtained by first calculating the total geometric distance from certain transmitter to the scatter point in the image region and then back to a receiver as shown in Figure 1-2.

d (r, i, k )  d (i, r )  d (r, k )

1-1

where d (i, r ) denotes the distance from the i -th transmitter to the image point r and d (r, k ) denotes the distance from point r to the k -th receiver. The travel time can be calculated by dividing this geometric distance with the speed of sound c in order to calculate the proper signal value. 3

t (r, i, k ) 

d (r, i, k ) c

1-2

Therefore, the contribution of the RF signal from the transmit-receive ( i , k ) pair to the image value at r is:

I (r, i, k )  p(t (r, i, k ), i, k ) Ap (i, k )

1-3

where p(t (r, i, k ), i, k ) is the RF signal value acquired by the k -th receiver at time t (r, i, k ) after the transmission of the i -th element in the traditional STA; Ap (i, k ) is the corresponding apodization value. The signal value at point r in a low resolution image ( I low ) corresponding to the transmission at the i -th element is a summation from all the K receivers which contributes to the dynamic focusing in receive:
I low (r, i)   I (r, i, k )   p(t (r, i, k ), i, k ) Ap (i, k )
k 1 k 1 K K

1-4

After generating all the low resolution images, dynamic focusing in the transmission can be applied to produce a high resolution image. The image value at point r of the highresolution image is then calculated by summing all the low resolution images and dynamic focusing in transmit is accomplished at this step: I high (r )   I low (r, i )   p(t (r, i, k ), i, k ) Ap (i, k )
i 1 i 1 k 1 I I K

1-5

This process is repeated for all the image pixels and is referred to as delay-and-sum (DAS) beamforming. Hence, the image is focused at every point on both transmit and receive due to the dynamic focusing in STA imaging.

4

Figure 1-2. Reconstruction geometry for the traditional STA imaging. t i is the i -th transmitter and rk is the

k -th receiver. r is the scatter point.

1.2.3 Dynamic Apodization Standard dynamic apodization is used during DAS beamforming which controls the weights applied on each transmit or receive element to reduce sidelobe and grating lobe artifacts in the reconstructed images [13]. Figure 1-3 shows a diagram illustrating the process of dynamic apodization. The size of the active sub-aperture increases with imaging depth. A constant f-number is kept in order to achieve a relatively uniform resolution during beamforming.

Figure 1-3. Diagram for dynamic transmit/receive apodization. The black bar stands for the active sub-apertures increasing with depth.

5

The apodization value Ap (i, k ) in Eq. 1-3 is the multiplication of the values applied on transmit and receive elements as Ap (i, k )  Ap (i ) Ap (k ) 1-6

Typically, a Hanning window function is used for both Ap (i ) and Ap (k ) . Figure 1-4 displays the Hanning window design: it reaches a maximum weight 1 at 0Â° beam angle and decreases to zero at 30Â°.

Figure 1-4. The design of Hanning window function applied on both transmit and receive as apodization functions.

The cut-off angle 30Â° is selected for two reasons. One is to avoid the grating lobes using [1]
sin  m  sin  g 1 pitch





1-7

where  m and  g are the main lobe and grating lobe angles, respectively.  is the wavelength of transmitted pulse and pitch is the distance between the centers of two adjacent elements 6

(which typically is one  for a linear transducer array). Assuming  m   g , then we have

 g  30 . Such apodization will eliminate the interference from grating lobes in the image by
applying a zero weight to all the beam angles larger than  30 (Figure 1-4). Another reason is to match the directivity of a single rectangle element inside the transducer array as [1].

 FWHM  2 sin 1 (0.6 / W )

1-8

where  FWHM is the angle subtended at the transducer element corresponding to the full width at half maximum (FWHM) of the pressure field. W is the width of the element which is around one  . Then  FWHM is calculated as 2  37 . Combining the above two factors, the cut-off angle  30 is selected for the Hanning apodization function to process the signals acquired from a linear array with one  pitch in both simulations and experiments in this dissertation.

1.3 Image Assessment (Quality metrics)
To evaluate the quality of ultrasound images under different transmission or reconstruction modes, several image quality metrics will be introduced [14-18]. These are described below. 1.3.1 Signal-to-Noise Ratio of Backscattered RF signals ( SNR dB ) The signal-to-noise ratio of the backscattered RF signals is quantified as the energy 7

ratio between the signal and noise
SNR dB  20 log10 ( signal 2 / noise 2 )

1-9

This was used for simulated signals only. The noise was obtained by calculating the difference between the simulated signals with additive noise and the noiseless STA signals (used as reference).

1.3.2 Peak Signal-to-Noise Ratio (PSNR) The image PSNR measures difference between the maximum value in the image and the background. It is usually quantified using the point targets and defined as [15]. PSNR dB  20 log10 [max{Starget }/ background ] 1-10

where max{Starget} is the point target peak signal and  background is the standard deviation of the envelope detected noise/background at the same depth as the point target.

1.3.3 Speckle Signal-to-Noise Ratio (sSNR) Speckle SNR measures the fluctuations of the speckle pattern in the background which is calculated as sSNR   background /  background 1-11

where  background and  background are the mean and standard deviation of the envelope-detected speckles in the background. The theoretical value of sSNR for fully-developed speckle is 1.91 which will increase with compounding [19]. 8

1.3.4 Lateral and Axial resolutions The lateral and axial resolutions are the minimum distances at which two identical point targets can be distinguished. They are determined from the full width at half maximum (FWHM) of the point spread function (PSF) obtained from a point target in the simulated and experimental phantoms. In this dissertation, other than the FWHM, the lateral resolutions at 20 and -40 dB were also measured for a more thorough comparison. 1.3.5 Contrast-to-Noise Ratio (CNR) CNR describes the ability to distinguish a region of interest (ROI) from the background which is defined as

CNR 

S ROI  S background

 ROI 2   background 2

1-12

where S ROI and S background denote the mean values of log-enveloped ROI and background at the same depth, respectively.  ROI and  background are the standard deviation of logenveloped ROI and background region, respectively. The numerator of Eq. 1-12 is also defined as contrast ratio (CR). 1.3.6 Lesion Signal-to-Noise Ratio (lSNR) lSNR is one metric to measure the detectability of an isolated target from the background which measures the trade-off between CNR and resolution changes [16-18].

lSNR 

CNR  d 0 FWHMlat  FWHMaxial
9

1-13

where d 0 is the diameter of the target. 1.3.7 Clutter-energy-to-total-energy ratio (CTR) CTR is a quality metric for contrast resolution and describes the ability to detect anechoic objects in the presence of strongly scattering off-axis objects. CTR is a measure of the interference levels from the beam sidelobes and is defined as the ratio of the energy outside the region centered at the point target with a radius R to the total PSF energy [15].
2 2      x ,zR I ( x, z, x0 , z0 )   x , zR I ( x, z, x0 , z0 )  CTR  10 log   10 log 1  2  2  I ( x, z, x0 , z0 )  I ( x, z, x0 , z0 )         

1-14

( x0 , z 0 ) is the location of the point target and is also the center of the image region within radius R which was chosen as 5 wavelengths [20].

1.4 Goals and Specific Aims
Synthetic transmit aperture imaging has been investigated since 1960-1970 for ultrasound imaging which offers a variety of advantages compared to the conventional Bmode ultrasound imaging. However, it hasn't been widely translated to clinical imaging due to some limitations such as low transmitting power of a single element, limited penetration depth and long computational time associated with the signal processing [2]. The goal of this dissertation is to develop novel ultrasound algorithms based on Synthetic Transmit Aperture (STA) imaging to improve the image quality and accelerate the application of STA imaging in the clinic. 10

Specific Aims: 1) Develop a unique encoded transmission pattern to increase the transmitting power in STA imaging, leading to improved SNR in the decoded RF signals. 2) Validate the stability of the encoding and decoding pattern under different noise levels and develop a more efficient decoding process. 3) Reduce background speckle variations to improve target detectability through spatial compounding and frequency compounding

1.5 Overview of the Dissertation
In Chapter 2, I proposed a delay-encoded synthetic transmit aperture technique (DESTA) in ultrasound imaging. A unique coding matrix has been designed to encode the transmission scheme which can be implemented in commercial ultrasound scanners. The algorithm was tested in both Field II simulations and in experiments. Both simulated and experimental results demonstrated increased SNR of the pre-beamformed RF signals compared with traditional STA. This led to enhanced image qualities such as spatial resolution, PSNR and contrast in the DE-STA reconstructed images. In Chapter 3, I demonstrated the stability of the DE-STA method by testing the decoding process at various SNR levels using both a complete pseudo inverse (CPI) and a truncated pseudo inverse (TPI) algorithm. In this Chapter, we studied the property of encoding matrix A with the singular value decomposition (SVD) technique and found that all the singular values were the same except for the first one and the last one. The last 11

singular value had very minor effect on the overall image quality in both the simulation and experimental results. We also derived a more efficient decoding process by replacing the calculation of inverse of the coding matrix ( A 1 ) by the complex conjugate transpose ( A * ) with some modifications. The computational complexity was reduced by 2/3. In Chapter 4, a filtered spatial compounding (FSC) reconstruction technique for synthetic transmit aperture imaging data has been developed. The design of a 2-D aperture domain filter was introduced and FSC method was tested with data from numerical simulations and experiments. FSC offered increased image quality in terms of target CNR, and lSNR. The effects of the aperture domain filter bandwidth, additive noise, and apodization on the performance of FSC were also investigated. Other image reconstruction methods, such as delay-and-sum (DAS), conventional spatial compounding (CSC), and subaperture compounding, were shown to be special cases of FSC with different choices of filters. In Chapter 5, I developed a filtered frequency compounding (FFC) reconstruction technique for synthetic transmit aperture imaging data. The same design of the 2-D aperture domain filter was used as in the FSC technique. Then the frequency compounding was applied to acquire multiple sub-images from different sub-bands and sub-apertures. The FFC method was also tested with data from numerical simulations and experiments which demonstrated increased image quality in terms of target CNR, and lSNR as a combination of both spatial and frequency compounding. The effects of the filter bandwidth, RF window length on the performance of FFC were also investigated. 12

Chapter 6 summarized all the results and future work. Appendix A is a summary of the all the contributions resulting from research performed during my PhD studies that both directly and indirectly contributed to this dissertation.

13

Chapter 2 Delay-encoded Transmission and Image Reconstruction Method in Synthetic Transmit Aperture Imaging

Authors: Ping Gong, Michael C. Kolios, Yuan Xu P. Gong, M. C. Kolios, and Y. Xu, "Delay-encoded transmission and image reconstruction method in synthetic transmit aperture imaging," IEEE transactions on ultrasonics, ferroelectrics, and frequency control, vol. 62, pp. 1745-56, Oct, 2015.

2.1 Abstract
Synthetic transmit aperture (STA) imaging systems usually have a lower signal-tonoise ratio (SNR) compared with conventional B-mode ultrasound systems because only one or a small number of elements are selected for each transmission in STA. In this chapter, we proposed delay-encoded synthetic transmit aperture (DE-STA) imaging to encode all the transmission elements to increase the SNR of the pre-beamformed radiofrequency (RF) signals. The encoding scheme is similar to the Hadamard encoding. However, in each transmission of DE-STA imaging, selected transmitting elements were delayed by a half period of the ultrasound wave related to the rest transmitting elements, rather than using a 14

pulse inversion as in the Hadamard encoding sequence. After all the transmission events, a decoding process in the temporal frequency domain was applied to the acquired RF signals to recover the equivalent traditional STA signals with a better SNR. The proposed protocol was tested with simulated data (using Field II) and experimental data acquired with a commercial linear array imaging system (Ultrasonix RP). The results from both the simulations and the experiments demonstrated increased SNR of pre-beamformed RF signals and improved image quality in terms of peak signal-to-noise ratio (PSNR), resolution and contrast-to-noise ratio (CNR) compared with traditional STA. The lateral resolution (as assessed by a wire target) of DE-STA imaging was improved by 28% and the PSNR of the wire was increased by 7 dB, respectively, compared with traditional STA imaging. The proposed image reconstruction framework can also be extended to other transmission protocols.

Keywords: Coded excitation, Synthetic Transmit Aperture Imaging, Beamforming methods

15

2.2 Introduction
Due to the fact that only one or a small number of elements are selected for the transmission, the low SNR is a major limitation in STA system compared with conventional B-mode imaging approach, where a focused beam is excited and one A-line is acquired at a time. Various approaches that involve using multi-element sub-apertures have been proposed to overcome the low SNR in STA [21-33]. One of them is synthetic aperture imaging using a virtual source element in transmit and dynamic focusing in receive [22, 23]. The virtual source is located at the transmission focal depth of a sub-array. The multiple-element approach can increase the transmitting power and therefore, the SNR of the RF data. A similar technique, synthetic aperture sequential beamforming (SASB), has also been proposed which uses fixed focus in both transmit and receive to provide a more uniform resolution than the dynamic receiving focusing [26, 27]. The Hadamard spatial coding matrix has been designed to solve the loss of SNR by spatially encoding the transmission elements and using its inverse for decoding the received RF data as shown in Figure 2-1 [28, 29]. In this method, some array elements transmit a reference waveform whereas the others transmit a phase inverted version of the reference waveform simultaneously. The transmission scheme can be described by a Hadamard matrix, where 1 denotes reference pulse and -1 denotes negative/inverted pulse. More generally, multiple elements can be excited simultaneously with each excitation element transmitting different pulse sequences. After multiple transmissions, the backscatter signals received from all the transmissions can be processed to obtain the traditional STA data. The SNR of 16

decoded RF signals could be increased by

I

times ( I is the total number of active

transmitters) compared to the traditional STA. A more sophisticated method utilizes the orthogonal Golay codes combining with Hadamard encoding for the spatio-temporal encoding to improve SNR further [30]. By using an orthogonal Golay set, the SNR of received data after decoding can be increased by length).
IS

times ( S is the temporal coding

Figure 2-1. Hadamard encoded transmission scheme. TX#1 to TX#N are N coded transmissions and in each transmission, active elements are excited with combinations of pulses (P(t)) and phase inverted pulses (-P(t)) simultaneously according to the Hadamard matrix. The figure shows a size 4 Hadamard sequence as an example.

Temporal encoding has also been applied in synthetic aperture imaging by using linear frequency modulated (FM) pulse (chirp) to increase the transmitted energy, and therefore increase the SNR while still retain axial resolution [31, 34]. Chirped signals can also be combined with Hadamard encoding. However, Nikolov and Jensen found that this actually could degrade the image quality because non-linear effects have been introduced 17

into the medium via ultrasound propagation. Moreover, the implementation of chirped signals significantly increases the system complexity without proportionally matched improvement of image quality. The Hadamard based encoding protocols have common difficulties when being implemented in clinical devices. In many commercial scanners, the various elements of the array probe are driven by the same pulse sequence in one transmission, and only the timing or delay of the pulse sequence can be controlled/assigned for each individual element. The spatial coding proposed by Chiao et al [28] requires that the various elements of the array probe are driven by two waveforms with opposite phase in one transmission. Therefore, the phase inversion proposed by Chiao et al for the transmit electronics is not compatible with many commercial ultrasonic scanners (i.e. Ultrasonix RP, once the transmission sequence is designed, all the elements will be excited following the same sequence). In addition, any mismatch in the shape between the pulse and the phase inverted pulse may compromise its performance. S-sequence encoded synthetic aperture imaging is an approach proposed to avoid the inverted pulses required for Hadamard encoding [32, 33]. The S-sequence encoding matrix is constructed by replacing 1 with 0, -1 with 1 of Hadamard matrix and then removing the first row and column of the newly constructed matrix. Here we propose a new Hadamard based, delay-encoded synthetic transmit aperture (DE-STA) imaging protocol to spatially encode the transmission with half-period delay rather than with opposite polarity, to increase the SNR of the restored pre-beamformed RF 18

data. The transmission of such an approach can be implemented in commercial scanners without significantly sacrificing the SNR improvement performance of Hadamard encoding. The proposed protocol was tested with the data from both Field II simulations and experiments. In this chapter, the theory for encoding and decoding the transmission scheme is explained; then the encoding matrix design, simulation parameters, decoding process and the experiment setup are introduced. The simulation and experiment results are presented and potential improvement of the DE-STA method is discussed.

2.3 Methods
2.3.1 Theory of DE-STA imaging Generally, we assume there are L transmission events in the data acquisition to form one high resolution image (for example L  4 in Figure 2-2). In each transmission I elements (the same I elements for all the L transmissions) are excited with various delays,

tli ( l  1 : L and i  1 : I ), relative to a reference time ( t  0 ), where tli denotes the delay
that is applied to the i -th transmitting element in the l -th transmission event. We define an
L -by- I delay matrix T whose element is tli . When there is no delay, tli is 0; when there

is delay, tli equals to half period (

1 , f 0 is the central frequency of the ultrasound wave). 2 f0

When multiple elements are excited together, the received signal equals to the summation of the equivalent received signals when the same set of elements are excited individually with
19

the same corresponding delay. Therefore, for the l -th transmission we have

p
i 1

I

ik

(t  tli )  mlk (t )

2-1

where mlk (t ) is the RF signal in the DE-STA which is received by the k -th ( k  1 : K ) receiving element in the l -th transmission when multiple elements are excited together; pik (t ) is the equivalent traditional STA signal, which is received by the k -th receiving element when only the i -th ( i  1 : I ) transmitting element is excited (while all the other imaging conditions are the same as in DE-STA). According to the translation property of Fourier transform, applying a time-delay tli to the received signal pik (t ) is equivalent to multiplying the signal spectrum Pik ( f ) by a factor of Ali ( f )  e  j 2 ftli 2-2

where f is any frequency in the spectrum. Therefore after applying Fourier transform to both sides of Eq. 2-1, it can be transformed into the frequency domain at each frequency as

 A ( f )P
i 1 li

I

ik

( f )  M lk ( f )

2-3

or
AP  M

2-4

where M lk ( f ) is the Fourier transform of signal mlk (t ) , and A , P and M are matrices with elements of Ali ( f ) , Pik ( f ) , and M lk ( f ) , respectively. A is called the coding matrix which is constructed from the delay matrix T . Thus, the column index of A corresponds to a 20

particular transmission element position, and each row includes the delays applied to all transmission elements in one transmission event. In the proposed DE-STA, I  L ; otherwise, if I  L , A is highly ill-conditioned, pseudo-inverse or other regularization method is needed to estimate the equivalent traditional STA data. Note that the coding matrix Ali ( f ) depends on frequency. Eq. 2-4 can be solved to yield P , the spectrum of the traditional STA data. After that, the inverse Fourier transform of P can be used to produce the traditional STA data, pik (t ) . Lastly, low resolution images can be formed from the equivalent traditional STA data and then can be combined together to yield a high resolution image. The goal of decoding is to recover P from M in a stable way, since M is usually contaminated by noise. To obtain P , one can multiply both sides of Eq. 2-4 with the decoding matrix D  A 1 . However the direct inversion may not be stable at some frequencies as explained below. Pseudo-inversion and other regularization techniques can be used instead of the direct matrix inversion to solve Eq. 2-4 (will be discussed in Chapter 3). After obtaining the Pik ( f ) for each frequency in the frequency spectrum, an inverse Fourier transform is used to obtain pik (t ) . It is worth noting that when f equals 0 or 2 f 0 , the coding matrix will be a square matrix with all the elements equaling to 1, which cannot be inversed stably. To deal with this, the signal is processed by a band-pass filter to avoid the instable inversions around these frequencies.

21

Figure 2-2 presents the configuration and results of a numerical simulation with a point target and a four-element array to illustrate the principle of DE-STA imaging. Each row of Figure 2-2 (a) depicts the waveform function of each transmission element in one of the total four transmission events, where TX # l means the l -th transmission event. Figure 2-2 (b) presents the geometry of the simulation model. Each row of Figure 2-2 (c) shows the signals received by channel 1 in one transmission of DE-STA imaging. Each row of Figure 2-2 (d) displays the decoded RF signals received by channel 1 when only one element was excited as in the traditional STA imaging (TXCh1 means that channel 1 was excited). In Figure 2-2, the decoding was implemented in the frequency range of 2.5MHz-7.5MHz with the central frequency at 5MHz. Frequency components outside of this range were filtered by a Hanning window (2.5MHz-7.5MHz centered at 5MHz). More discussions on Figure 2-2 can be found in the discussion section in this chapter.

22

Figure 2-2. The configuration and results of a numerical simulation with a point target and a four-element array to illustrate DE-STA. (a) Waveform function of each transmission element in one of the total four transmission events. (TX # l : l -th transmission event) (b) Geometry of the simulation model. (c) Signals received by channel 1 in DE-STA imaging. (d) Decoded RF signals received by channel 1 when only one element was excited as in traditional STA imaging. (TXCh1: channel 1 was excited)

2.3.2 Application to Ultrasound Imaging: DE-STA

In order to demonstrate that the delay-encoded transmission enables SNR improvement in pre-beamformed RF signals and enhanced image quality in synthetic transmit aperture imaging (STA), we have performed a series of simulations as well as 23

experiments using the Ultrasonix RP (Ultrasonix, CA). We will introduce the delay-encoded transmission based on the Hadamard matrix, the encoding and decoding methods and the image reconstruction process for both simulations and experiments. 2.3.2.1 Implementation of the Delay-encoded Transmission following the Hadamard Matrix In this section, we will describe how to construct the delay matrix T and the coding matrix A for the 128-channel (receive and transmit) system in our simulations and experiments. The delay matrix T is a 128-by-128 square matrix which stands for I  128 active transmitting elements in each excitation and L  128 transmission events to acquire one complete set of data for one image. In each transmission, selected elements were delayed by a half period (the period was calculated at the central frequency of the transducer). We first constructed a Hadamard matrix of size 128, in which H li  1 indicates that no delay was added to the excitation of the i -th element in the l -th transmission and H li  1 indicates that a half period delay was added. The 128-by-128 Hadamard matrix H 7 was constructed 2 using Sylvester's construction as shown in Eq. 2-5.
H
2N

 H2  H

2 N 1

2-5

1 1  for N  2 , where H 2    and  denotes the Kronecker product. Once the Hadamard 1  1
matrix of size 128-by-128, H 27 is constructed, T can be obtained as
T  (1  H 2 7 )

td 2

2-6

24

where t d 

1 (half a period). 2 f0

2.3.2.2 Generating the Simulated RF Data with Field II for B-mode, STA and DE-STA The simulations were performed using the FIELD II program [35, 36]. First, we computed the traditional STA signals, which contained the backscatter signals of all receiving channels when each element was excited individually in a traditional STA scan. The transmitted pulse was simulated as two cycles of sinusoidal wave, weighted by a Hanning window. Then the pulses were delayed according to the delay matrix T and summed to yield the simulated DE-STA signals. We also simulated B-mode imaging for the same phantom, probe, and imaging configuration for reference. We considered a 3.8 cm-wide linear array probe with 128 elements excited with a 5 MHz central frequency. The received signals were sampled at 40 MHz and no attenuation was considered in the simulations. The location of the focus in the B-mode image was set at a depth of 3 cm in the phantom. The transducer array was simulated with 0.28 mm width, 0.02 mm kerf and 1540 m/s speed of sound, exactly following the array used in experiments. The simulated medium was a 40 mm  10 mm  40 mm (lateral  elevational  axial) which had a total of 200,000 point scatters. The phantom included a hyper- (on the left) and a hypo-echoic inclusion (on the right) with the same diameter of 12 mm. Both inclusions were centered at 30 mm away from the phantom top surface. In the background as well as in the hyper-echoic inclusion, the spatial distribution of the scatters was uniform and their scattering amplitude followed a zero mean Gaussian distribution. The standard deviation of 25

the scatters' amplitude distribution inside the hyper-echoic inclusion was 10 times that of the background and the hypo-echoic inclusion had no scatters. The probe was 5 mm away from the phantom surface. To simulate the DE-STA signals, we first used Field II to generate the traditional STA data and then used Eq. 2-1 to yield DE-STA signals. To generate the DE-STA signals in the l -th ( l =1-128) transmission, a half-period delay (100 ns) was applied to the traditional STA RF signals which corresponded to the transmission channels that should be delayed according to the l -th row of the delay matrix T . Then the signals of the k -th ( k =1-128) receiving channel in the l -th transmission of DE-STA were obtained by summing the 128
k -th receiving channel signals from the 128 transmissions of the traditional STA, as in Eq.

2-1. This process was repeated 128 times for the 128 different transmissions ( l =1-128) of one DE-STA process. White Gaussian noise with a SNR of -10 dB was first applied to the traditional STA data. Then, the noise with the same energy was added to the DE-STA signals assuming that both traditional STA and DE-STA have the same source of noise, such as electronic noise. Afterwards, all the RF data were processed by a 4-th order Butterworth filter with the passband ranging from 3.5MHz to 6.5MHz (the frequencies corresponding to half-maximum of the filter). Then the resultant SNR after the filtering was 0 dB in traditional STA. The decoding algorithm was implemented in MATLAB R2012b. As explained in section II. The received RF signals in DE-STA were first transformed into frequency domain using Fast Fourier Transform to obtain matrix M . The decoding matrix D was obtained by 26

direct inversion. The frequency spectrum of decoded RF signals P was calculated using
P  DM . Lastly, the signal in time domain was computed by applying inverse Fourier

transform function to P . The decoding process was implemented in the frequency range of 2MHz to 9MHz, in which the above filter has a non-zero weight. This band-pass filter was also applied to the traditional STA pre-beamformed data for fair comparison of the image qualities between STA and DE-STA images, both of which were obtained using the standard delay-and-sum reconstruction method in STA [2] with dynamic apodization as introduced in Chapter 1. 2.3.2.3 Experimental Acquisition Setup The experimental RF data were acquired using an Ultrasonix RP research platform equipped with the parallel channel acquisition system SonixDaq (Ultrasonix, Vancouver, CA) (as shown in Figure 2-3). The ultrasound probe was L14-5, which was a 4 cm-wide flat linear array probe with 128 elements that could be used as both transmitters and receivers (pitch: 0.3 mm; kerf: 0.02 mm; elevational width: 4 mm; elevational focus: 16 mm). The transmission scheme was controlled by Texo, a development toolkit provided by Ultrasonix that allows for lower level control of ultrasound system using a program written in C/C++. The transmitting pulse was one cycle of sinusoidal wave. The central frequency of the transducer was 5 MHz and data were sampled at 40 MHz. The tissue mimicking phantoms were made of degassed water (93.85% of total weight), gelatin powder (4.69%), polyethylene oxide (scatter) (1%) and formaldehyde (0.46%). In the background of the phantoms, the scatter concentration was 1% of the total weight, whereas inside the hyper-echoic inclusions 27

the scatter concentration was twice of that and the hypo-echoic inclusions had no scatters.

Figure 2-3. Experimental system: Ultrasonix RP research plantform equipped with SonixDAQ acquisition system (Ultrasonix, Vancouver, CA). Transducer array: L14-5, linear array with 5 MHz central frequency. Sampling frequency was 40MHz

RF data were acquired in B-mode (used as a standard reference), traditional STA and DE-STA for each phantom with exactly the same set of system parameters (such as the voltage levels for the transmission pulses). The transducer was fixed on the top of the phantom surface to ensure that images were taken from exactly the same section. The beamformed signals were processed by Hilbert transform followed by the logarithm compression and were then displayed as log-enveloped images. The decoding and reconstruction processes for the experimental data were the same as those described in the above section on the numerical simulations. 28

The experimental DE-STA data were acquired from three different phantoms for different perspectives which we defined them as Phantom 1, Phantom 2 and Phantom 3. Phantom 1 was a 4 cm by 4 cm square phantom which contained both a hyper- (on the right side) and a hypo-echoic (on the left) inclusion with a diameter of 1.2 cm, and three wire inclusions of 0.5 mm diameter. Phantom 2 was a 4 cm by 6 cm phantom which contained 3 hypo-echoic inclusions with a diameter of 1.6 cm, 1.2 cm and 0.7 cm, from the top to the bottom of the phantom, respectively. Phantom 3 was a 4 cm by 6.4 cm phantom which contained three 1.2 cm-diameter hyper, hypo and hyper-echoic inclusions from the top to the bottom and also 4 wire phantoms located at approximately the depth of 5 cm.

2.4 Results
2.4.1 Simulation Results

Figure 2-2 (c) shows the DE-STA RF signals in the simplified simulation model with a point target and a four-element array. The panels from the top to the bottom correspond to DE-STA RF signals received by channel 1 in the first, second, third, and the fourth DE-STA transmission, respectively. In any transmission event, there are four pulses in one RF signal and they correspond to the four transmitting elements. Figure 2-2 (d) shows the decoded RF signals. The panels from the top to the bottom correspond to the recovered RF signals received by channel 1 if Ch1, 2, 3, and 4 were excited individually as in traditional STA. There is only one pulse in a RF signal in each transmission. The SNR in the signals before and after decoding are 3.79 and 7.19 times, respectively which can also be visualized by 29

comparing the signals in Figure 2-2 (c) and (d). The amplitude of noise was reduced with the signal amplitude remaining almost the same. Therefore, the SNR of RF signals has been improved by 1.89 times by DE-STA technique. Figure 2-4 shows the results of the simulation with Field II. Figure 2-4 (a) shows the line plot of a typical pre-beamformed RF signal in the traditional STA without adding noise. The signal was received by the 30-th element at the transmission of the 30-th element in Field II. Figure 2-4 (b) shows the same signal after adding 0 dB bandpassed noise. As introduced in the method section, we added the same level of noise to the simulated DE-STA signals. Figure 2-4 (c) is the restored traditional STA signal by decoding the noisy raw DESTA signals. The signal in Figure 2-4 (c), decoded from the DE-STA signals, is similar to the noiseless STA signal in Figure 2-4 (a) and has a better SNR than the noisy traditional STA signal in Figure 2-4 (b). As described in method section 2.3.2.2, the resultant SNR in Figure 2-4 (b) is 0 dB. The SNR of the signal (Figure 2-4 (c)) restored from the DE-STA signals is 18 dB. Therefore, the pre-beamformed RF SNR has been increased by 18 dB (~8 times) in DE-STA over the traditional STA.

30

Figure 2-4. Plots of the simulated raw RF signal obtained from: (a) traditional STA imaging without noise, (b) traditional STA imaging with noise and (c) the restored traditional STA by decoding the DE-STA signals with the same level of noise as in (b).

The improvement of SNR in DE-STA for pre-beamformed RF signals in Figure 2-2 and Figure 2-4 over the traditional STA is 1.89 times and 8 times, respectively. The SNR improvement is close to the theoretical limit,
I

( I is the total number of transmitters, i.e. 4

for the simulation in Figure 2-2 and 128 for the simulation in Figure 2-4). The actual values are slightly lower than the theoretical ones. This is because the optimum SNR improvement occurs only at the central frequency f 0 . Figure 2-5 (a) and (b) show the beamformed log-enveloped images in conventional B-mode imaging and reconstructed traditional STA imaging, respectively, when there is no noise added to the RF data. Figure 2-5 (c) and (d) are the traditional STA and DE-STA images under the same amount of noise, respectively. The DE-STA provided an image with a 31

better SNR than that in the traditional STA. The DE-STA image (d) also agrees well with the corresponding B-mode image (a) and the STA image (b) without adding noise to the RF data.

Figure 2-5. Simulated log-enveloped beamformed images obtained in (a) B-mode imaging, (b) traditional STA imaging without adding noise, (c) traditional STA imaging with noise and (d) DE-STA imaging with the same amount of noise in raw RF signals as in (c). The dynamic ranges are: (a) 160 dB; (b), (c) and (d): 60 dB.

2.4.2 Experimental Results

Figure 2-6 shows the images (the top row) and line plots (the bottom row, at the location of the horizontal white lines through the wire as indicated by the white arrows) in (a) B-mode imaging, (b) traditional STA imaging and (c) DE-STA imaging of Phantom 1. The measured spatial lateral resolution, peak-signal-to-noise ratio (PSNR) of the wire target, and contrast-to-noise ratio (CNR) values of the hyper-echoic inclusion were used to compare the 32

image quality of the various imaging methods (Table 2-1). The image spatial resolution, PSNR, and CNR of the hyper-echoic inclusion in DE-STA were improved over those of the traditional STA image. Both the circular inclusions and the wire targets were better detected in the DE-STA image than the STA image. The bright dots inside the hypo-inclusion (probably due to air bubbles) can also be clearly seen after DE-STA reconstruction. The line plots (second row, Figure 2-6) further demonstrated that the spatial resolution and PSNR from the wire inclusion (denoted by the arrows) have been enhanced: the lateral resolution (assessed by the full width at half maximum (FWHM)) in DE-STA was improved by 28% and the PSNR was increased by 7 dB, compared with the traditional STA image. The DESTA image also provided best contrast property as assessed by the CNR of the hyperinclusion.

33

Figure 2-6. Experimental log-enveloped beamformed images obtained in (a) B-mode imaging, (b) traditional STA imaging and (c) DE-STA imaging. Top row: phantom images. Bottom row: lateral line plots at the depth of 2.4 cm. The white line indicates the position of line plots in the images. The dynamic ranges are: (a) 40 dB; (b) and (c): 80 dB.

Mode B-mode STA DE-STA

PSNR [dB] 16.7 31.0 38.0

FWHMlat [mm] 1.00 0.72 0.60

CNR (hyper) 0.9186 1.1725 1.4229

Table 2-1. PSNR and FWHM of the point target and CNR of the hyper-echoic inclusion in conventional Bmode, traditional STA and DE-STA images, respectively in Figure 2-6.

Figure 2-7 shows the images (the top row) and line plots (the bottom row, along the vertical white lines) in (a) B-mode imaging, (b) traditional STA imaging and (c) DE-STA imaging of Phantom 2. Both the phantom images and the line plots of DE-STA imaging 34

present a better contrast and spatial resolution than those of the traditional STA imaging. The smallest inclusion which was located at around the depth of 5.5 cm demonstrated that even for the inclusion which was far from the transducer surface, high resolution can still be obtained in DE-STA image due to the improved SNR of the pre-beamformed RF signals. Detailed CNR comparison of traditional STA and DE-STA images from 2nd and 3rd hypo inclusions are shown in Table 2-2.

Figure 2-7. Experimental log-enveloped beamformed images obtained in (a) B-mode imaging, (b) traditional STA imaging and (c) DE-STA imaging. Top row: phantom images. Bottom row: axial line plots at 2.25 cm (indicated by vertical white lines). The dynamic ranges are: (a) 40 dB; (b) and (c): 60 dB. Three dashed squares on the axial line plot in (c) indicate the position of the three hypo inclusions.

35

CNR B-mode STA DE-STA

2nd hypo 1.88 0.75 2.50 images, respectively in Figure 2-7.

3rd hypo 0.79 0.42 1.92

Table 2-2. CNR of the 2nd and 3rd hypo inclusions in conventional B-mode, traditional STA and DE-STA

Figure 2-8 shows the images (the top row) and line plots (the bottom row, along the vertical white lines) in (a) B-mode imaging, (b) traditional STA imaging and (c) DE-STA imaging of Phantom 3. The B-mode image displays a severe shadow below the first hyper inclusion (in both log-enveloped image and axial line plot) which leads to the indiscernibility of the other two inclusions. However, the STA and DE-STA images were less affected from the shadow brought by the first inclusion. The DE-STA image gave a better contrast for the hypo inclusion underneath the first hyper inclusion than those of the B-mode and the traditional STA images.

36

Figure 2-8. Experimental log-enveloped beamformed images obtained in (a) B-mode imaging, (b) traditional STA imaging and (c) DE-STA imaging. Top row: phantom images. Bottom row: axial line plots at 2.0 cm (indicated by vertical white lines). The white arrows in (b) indicate the locations of four wire targets. The dynamic ranges are: (a) 40 dB; (b) and (c): 60 dB. Three dashed squares on the axial line plot in (c) indicate the position of the hyper, hypo and another hyper inclusions.

2.5 Discussion
The proposed DE-STA was demonstrated to improve the SNR of pre-beamformed RF signals and therefore, the image qualities over the traditional STA in terms of spatial resolution, PSNR, CNR and detectability of inclusions. At the central frequency of the transducer array, DE-STA is equivalent to the spatial coding with Hadamard matrix [28, 29]. If we consider an ultrasound pulse as a sinusoidal wave train, shifting the wave train by half period is a rough approximation to invert the wave train. Therefore, we can consider DE37

STA as an approximation of the spatial coding that occurs with the Hadamard matrix. Since the spatial coding with the Hadamard matrix has been shown to improve the SNR of RF signals in ultrasound imaging, it is not surprising that DE-STA imaging can improve the SNR of RF data. The spatial resolution was significantly improved in DE-STA over STA imaging, which was demonstrated by significantly reduced size of both the wire phantoms and the speckles in the DE-STA image (Figure 2-6). Furthermore, the bright dots in the hypoinclusions which might be caused by air bubbles were also better detected in DE-STA images. These improvements are due to the fact that DE-STA imaging can increase the SNR of pre-beamformed RF signals by multi-element transmission to achieve the highest potential spatial resolution in traditional STA imaging. The B-mode images at the transmit focus could not yield the same resolution as the STA (DE-STA) images (e.g. Figure 2-5). This is because the active sub-aperture of B-mode imaging to form each A-line focusing at 3.5 cm depth was 32 elements to simulate the Ultrasonix RP hardware limit, whereas in STA or DE-STA images, the active aperture at the same depth was the whole array (128 active elements). DE-STA imaging was also shown to be least sensitive to the shadowing effect (Figure 2-8). The B-mode image was acquired by sending focused beams sequentially. Consequently, the upper inclusion blocked the beam and therefore shadowed inclusions under it. In STA and DE-STA imaging, the upper inclusion can only block the beams associated with the transmitting elements right above the upper inclusion whereas other elements can still transmit ultrasound to the area below the upper inclusion. Even though shadowing effect in 38

clinical ultrasound imaging can provide useful diagnostic information, when the region of interest is right under a highly attenuating object (Figure 2-8), we think DE-STA imaging is still a useful approach to reduce the shadowing effect. The hypo-echoic inclusion in the middle of Figure 2-8 can be visualized better in DE-STA image than STA image due to the much improved RF SNR. Therefore, DE-STA approach can minimize shadowing effect. The data acquisition speed in DE-STA imaging can be as fast as B-mode imaging and STA imaging since all of them have the similar transmission numbers (~128). The time it took for image processing and reconstruction in DE-STA imaging were 1 minute and 10 minutes, respectively, on a DELL OptiPlex 790 computer using MATLAB R2012b software. The decoding processes for each frequency and each receiving channel are independent which makes the process amendable to parallel programming. After decoding, the image reconstruction in traditional STA imaging can be implemented in real time [37, 38]. Therefore, future work may focus on the optimization of DE-STA imaging to speed up the decoding process and image reconstruction. We used a band-pass filter to cut off the frequency components which are far from the central frequency in order to stabilize the inversion of coding matrices. DE-STA can also be combined with Pseudo-inverse or other regularization methods [39] to inverse the encoding matrix more stably which will be introduced in the next chapter. The DE-STA technique can also be combined with temporal-encoding such as orthogonal Golay codes to further improve SNR in the future. The main goal of this chapter is to propose the theory of DE-STA, demonstrate its 39

feasibility, and verify the improvement of the SNR of the pre-beamformed RF signals. Since there are several other approaches to improve the SNR of the pre-beamformed RF signals by using multi-element transmission, it would be an interesting future study to compare the performance of these approaches and B-mode with DE-STA in a systematic way.

2.6 Conclusion
This chapter addressed the feasibility of a delay-encoded synthetic transmit aperture technique in ultrasound imaging. A unique coding matrix has been designed to encode the transmission scheme which can be implemented in commercial clinic ultrasound scanners. The algorithm was tested in both Field II simulations and experiments. The results from both simulations and experiments demonstrate increased SNR of pre-beamformed RF signals compared with traditional STA which led to enhanced image qualities such as spatial resolution, PSNR and contrast in the DE-STA reconstructed images. The proposed image reconstruction framework may be also extended to B-mode, plane wave imaging, and synthetic aperture sequential beamforming.

40

Chapter 3 Pseudo-Inverse (PI) Decoding process in Delay-encoded Synthetic Transmit Aperture (DE-STA) Imaging
Authors: Ping Gong, Michael C. Kolios, Yuan Xu

P. Gong, M. C. Kolios, and Y. Xu, "Pseudo-Inversion (PI) Decoding process in Delayencoded Synthetic Transmit Aperture Imaging," (Submitted for publication, IEEE transactions on ultrasonics, ferroelectrics, and frequency control, June 2015)

3.1 Abstract
As introduced in Chapter 2, in the decoding process of DE-STA, the equivalent STA data were obtained by directly inversing the coding matrix. This is usually regarded as an illposed problem especially under high noise levels. Pseudo inverse is usually used instead for seeking a more stable inversion process. In this chapter, we applied singular value decomposition to the coding matrix to conduct pseudo-inverse. Our numerical studies demonstrated that the singular values of the coding matrix had a special distribution, i.e. all the values were the same except for the first one and last one. We compared the pseudo inverse in two cases: complete pseudo inverse (CPI), where all the singular values were kept, and truncated pseudo inverse (TPI), where the last and smallest singular value was ignored. 41

The pseudo inverse (both CPI and TPI) DE-STA processes were tested against noise with both numerical simulations and experiments. The CPI and TPI can restore the signals stably and the noise affected mainly the pre-beamformed signals corresponding to the first transmit channel. The difference in the overall image qualities of the enveloped beamformed images between the CPI and TPI was negligible. Thus it demonstrated that DE-STA was a relatively stable encoding and decoding technique. Also, according to the special distribution of the singular values of the coding matrix, we proposed a new efficient decoding formula which was based on the conjugate transpose of the coding matrix. We also compared the computational complexity of the direct inverse and the new formula.

Keywords: Pseudo inverse, ultrasound imaging, singular value decomposition, delay-

encoded synthetic aperture imaging, inverse problem

42

3.2 Introduction
In the previous chapter, delay-encoded synthetic transmit aperture (DE-STA) imaging method was proposed based on the Hadamard-encoding technique [40, 41]. The transmission scheme in DE-STA imaging was encoded with half-period delay ( t 

1 , f 0 is the central 2 f0

frequency of the ultrasound wave), rather than with reversing the polarity as in Hadamard encoding. This enabled the implementation of DE-STA in commercial scanners. The coding matrix A in DE-STA method was generated from a Hadamard matrix with [-1, 1] codes. In this case however, one represented that no delay was added to the transmitted pulse and negative one represented a half-period delay to the transmitted pulse from the transducer element. The coding matrix A was then calculated by replacing all the -1 elements in a Hadamard matrix with e
 j 2ft

e

 j

f f0

, where f was an arbitrary frequency in the spectrum.

In the decoding process, a decoding matrix D (i.e. A -1 ) was applied to the received RF data. The SNR improvement of the equivalent STA RF data restored from the DE-STA raw data has been shown to be comparable to that in the Hadamard encoding technique. The decoding step in DE-STA was obtained by directly inversing the coding matrix
A in [40, 41]. However, when the signals in DE-STA are degraded by noise, the decoding

process to obtain the equivalent STA signals is a discrete ill-posed problem for the frequencies close to 0 or 2 f 0 [39], i.e. if an arbitrarily small perturbation of the DE-STA data can cause a large perturbation of the restored STA data. When the frequency is close to 0 or 43

2 f 0 , the coding matrix becomes a matrix with all elements being equal to one, a severely illconditioned matrix. As a result, the direct inversion of the coding matrix may be instable in the DE-STA decoding process. In such cases, a pseudo inverse is commonly used instead of direct inverse of the matrix A . In this chapter, we studied the pseudo inverse decoding process in DE-STA method using different noise levels. We also applied singular value decomposition (SVD) to the encoding matrix to study the properties of singular values and singular vectors of the matrix. We found that the noise affected mainly the pre-beamformed signals from the first transmit channel. The difference in the overall image qualities of the enveloped beamformed images between the direct and pseudo inverse was negligible. Based on the SVD results, an efficient decoding method was derived to reduce the computational complexity of the decoding process.

3.3 Methods
3.3.1 Pseudo-Inverse (PI) in DE-STA Imaging

The goal of decoding in DE-STA technique is to recover P from M in Eq. 2-4 in a stable manner, since M is usually contaminated by noise. To obtain P , one can multiply both sides of Eq. 2-4 with the decoding matrix D for each frequency within the frequency bandwidth of the RF signals:

P  DM

3-1

44

In principle, D  A 1 . However, because of the measurement noise in M , the direct inverse may not be stable. A pseudo-inverse method can be used instead to solve Eq. 3-1. Pseudo-inverse is implemented by first applying singular value decomposition (SVD) to the coding matrix A , then we have

A  USV*   ui i vi
i 1

R

*

3-2

where U  (u1 , u2 ,uR ) and V  (v1 , v2 ,vR ) are two orthonormal matrices and ui , vi are the
i -th column of U and V , which are defined as the left and right singular vectors of A ; R is

the rank of A ; S is a diagonal matrix which contains all the singular values (  i ) of A , distributing in a non-increasing order (such that 1   2     R  0 ) ). Since both U and
V are orthonormal matrices, we also have

D  A 1  VS-1U*
and

3-3

A*  VS* U*
or
D  A 1  VS -1U*  
i 1 R

3-4

viui

*

i

3-5

A   vi ui  i
* * i 1

R

*

3-6

45

where A * means the complex conjugate transpose of A . One or more small  i (i  1 R ) indicate that A is nearly rank deficient and illconditioned. Consequently, to stabilize the solution, the decoding matrix D is obtained by deleting the terms that are associated with the small singular values in Eq. 3-5 in the truncated pseudo inverse method (TPI) in this chapter. Moreover, from Eq. 3-5 and Eq. 3-6, it is clear that if the singular values are constant or almost constant, the decoding matrix D can be replaced by A * by some modifications (as will be shown later in this chapter). Therefore, Eq. 3-1 can be solved exactly or approximately to yield P , which can be used through inverse Fourier transform to produce the signals pik (t ) . In both simulations and experiments, we decode the pre-beamformed RF data from each receiver separately since it is independent from the others. In the result section 3.4, we first studied the singular values and the singular vectors of the DE-STA encoding matrix and derived a method to decode the STA data. Then we applied the pseudo inverse method to investigate the decoding process and the image reconstruction at various noise levels. 
3.3.2 Application to Ultrasound Imaging: Pseudo-DE-STA

The pseudo inverse method was first tested with simulation data and then with experimental data acquired by the Ultrasonix RP research platform (Ultrasonix, CA).

46

3.3.2.1 Simulation setup

The pseudo inverse was tested with Field II simulation program [35, 36]. The probe was a 3.8-cm-wide 128-element linear array with 0.28 mm width, 0.02 mm kerf and 1540 m/s speed of sound, the characteristics of the array used in experiments. Standard STA and DE-STA data were acquired from a 4 cm  1 cm  5.5 cm (lateral  azimuthal  axial) phantom which contained seven simulated wire targets located at 5 mm intervals from 15 to 45 mm in depth. The diameter of the wire targets was 200 m. Two noise levels (SNR equaled to 0 and -10 dB, respectively in the case of standard STA imaging) were added to both the standard STA and DE-STA data. No attenuation was added to the simulation. Afterwards, pseudo inverse steps were applied to restore the traditional STA data. Lastly, the restored prebeamformed RF signals from all receiving channels were examined to investigate the performance of SNR improvement undergoing the two inversions (complete pseudo inverse (CPI) and truncated pseudo inverse (TPI), will be defined later) with different noise levels.
3.3.2.2 Experimental Acquisition Setup

The experimental RF data were acquired using an Ultrasonix RP research platform equipped with the parallel channel acquisition system SonixDaq (Ultrasonix, CA), using probe L14-5. The central frequency of the transducer was 5 MHz with 40 MHz sampling frequency. RF data were acquired in DE-STA mode from a 4 cm  4 cm tissue mimicking phantom which contained a hyper- (on the right side) and a hypo-echoic (on the left) inclusion with a diameter of 1.2 cm as well as three wire inclusions of 0.5 mm diameter 47

(detailed description of the phantom can be found in Chapter 2). The DE-STA data were processed by both CPI and TPI. The beamformed signals were processed by Hilbert transform followed by the logarithm compression and were then displayed as log-enveloped images.

3.4 Results
3.4.1 Singular Values and the Singular Vectors Study

The coding matrix A was derived from the Hadamard matrix by replacing -1 with
e
 j f f0

. Applying SVD to A in Matlab illustrated that the singular values were all the

same ( 0 ) for all the frequencies we have studied except for the first one ( 1 ) and the last one ( R ) as shown in Figure 3-1. The singular values are displayed for the frequency dependent coding matrix A for three different frequency components as examples: 2 MHz, 3.5 MHz and 5 MHz. At 5 MHz (the central frequency of the transducer), e
 j f f0

is -1 and A

is exactly a Hadamard coding matrix with binary codes [-1, 1]. Then A is a stable matrix with condition number

1 (the ratio between the largest singular value to the smallest one) R

equaling to 1. The singular value distribution is a straight line. As the frequency component used in the calculation diverges from the central frequency, the coding matrix becomes more and more ill-conditioned with an increasing condition number as demonstrated by the curves corresponding to 2 and 3.5 MHz in Figure 3-1. 48

i

Figure 3-1. Singular values of coding matrix A in DE-STA methods at 3 different frequencies (i.e. 2, 3.5 and 5 MHz). The singular values are all the same

( 0 ) except for the first one ( 1 ) and the last one ( R ) at 2 and

3.5 MHz. At the central frequency 5 MHz (dotted line), the singular values are constant.

Then the terms associated with  1 and  R can be extracted and the decoding matrix D can be written as

vu v u 1 D 1 1  R R  1 R 0
* 1 1 *

*

*

v u
i 2

R 1

*

i i

vu v u 1 R 1 * * * * * *   R R  v u i  (v1u1 1  vR u R  R ) *  i i * 1 R  0  0 i 1  0 0
so that
D

3-7

v1u1  v u   1 (1  1 1 * )  R R (1  R R* )  A * 3-8 * 1   0 0  0 0  0 0 R

*

*

*

*

Then the calculation of A 1 has been replaced by A * which enables a more efficient DESTA decoding algorithm. The computational complexity has been reduced. 49

If the terms associated with all the singular values are kept (as in Eq. 3-8), it is equivalent to directly inversing A . Such process is referred to as complete pseudo inverse (CPI) in the following text. On the other hand, due to the special property of singular value distributions of A (Figure 3-1), the term associated with last singular value (  R ) can be deleted in order to stabilize the inversion and this decoding process is referred to as truncated pseudo inverse (TPI) (as in Eq. 3-9).
D
i 1 R 1

vi u i 1 vu  v u    1 1 (1  1 1 * )  R R (  R R* )  A* * i 1   0 0  0 0  0 0 R

*

*

*

*

*

3-9

3.4.2 Simulation Results

In Field II simulation results, the decoded RF signals from an arbitrary receive channel was analyzed (e.g. 30th receiving channel as an example) to compare the performance of TPI and CPI at two SNR levels of the pre-beamformed RF signals: 0 dB and -10 dB before decoding. The noise was filtered by a 4th order Butterworth band-pass filter to simulate the filtering effect of the transducer. No other filtering process was applied to decode DE-STA data except for a rectangle window to cut the frequencies close to 0 and 2 f 0 . Decoding steps was applied to the frequency range from 2 to 9 MHz (with non-zero amplitude). It has been found that the restored RF signals from all the combination of transmitting and receiving elements decoded from CPI almost completely overlapped with those from TPI with similar SNR values except for the case when the first element was used as the transmitter. 50

Figure 3-2 and Figure 3-3 show the simulation results corresponding to the signals received by the 30th element at the transmission of the 30th and the 1st element, respectively, with 0 dB additive noise. Figure 3-2 (a) displays the line plot of a typical noiseless prebeamformed RF signal in the standard STA mode as a reference. Figure 3-2 (b) illustrates the same signal after adding 0 dB band-passed noise. We added the same level of noise to the simulated DE-STA signals. Figure 3-2 (c) and (d) show the restored signals by decoding the noisy raw DE-STA signals using the CPI and TPI processes, respectively. The signals in Figure 3-2 (c) and (d) are similar to the noiseless STA signal as shown in Figure 3-2 (a). They both have a better SNR (improved by 22.62 and 21.68 dB, respectively) than the noisy traditional STA signal in Figure 3-2 (b). The enhancements match the theoretical value as well ( 10 log10 I  21dB). Figure 3-3 displays the pre-beamformed RF signals received by the 30th element at the transmission of the 1st element in the same order as those in Figure 3-2: (a) the noiseless STA signal, (b) STA signal with 0 dB noise, restored DE-STA signal after (c) CPI and (d) TPI. The restored DE-STA signal in Figure 3-3 (c) was similar to the reference in Figure 3-3 (a) while the signal in (d) was quite different. Also, the SNR enhancement was reduced compared with the theoretical value, especially for TPI decoded signal (Figure 3-2 (d)). The signal amplitude in Figure 3-2 (d) was reduced compared to that in Figure 3-2 (c), leading to a lower SNR in TPI than that in CPI (Table 3-1). Figure 3-2 and Figure 3-3 demonstrated that the pseudo-inverse process mostly affected the signals related to the 1st transmitter. Detailed RF SNR quantifications are shown in Table 3-1. 51

As a comparison, the RF signals in these four different modes were also presented while using the same setup, but with a higher level noise (SNR= -10 dB) as shown in Figure 3-4 (30th transmitter and 30th receiver) and Figure 3-5 (1st transmitter and 30th receiver). Detailed RF SNR quantifications of Figure 3-4 and Figure 3-5 are shown in Table 3-2. Similar general trends have been observed while using -10 dB noise. The SNR improvements after both CPI (22.67 dB) and TPI (22.57 dB) agreed well with the theoretical value at the transmission of the 30th transmitter, whereas, the SNR improvement was decreased at the transmission of the 1st element. However, under -10 dB noise, TPI provided a better SNR value while using 1st transmitter. Detailed quantification values are shown in Table 3-2. Other SNR levels such as -20 dB or -30 dB have also been investigated. Same trend was observed: at 30th transmitter, the SNR improvement for both CPI and TPI decoded data followed the theoretical value whereas at the 1st transmitter, as the noise increased, the superiority of TPI became more and more significant. The SNR improvement comparison between Table 3-1 and Table 3-2 illustrated that the decoding process, by either the CPI or the TPI, was stable using the DE-STA technique. For low noise levels, the CPI was better than the TPI. The superiority of the TPI was evident at higher noise levels and this was mainly reflected by the signals from the 1st transmitting element. The log-enveloped beamformed images obtained from CPI and TPI with 0 dB and -10 dB additive noise are presented in Figure 3-6 and Figure 3-7 ((a) CPI, (b) TPI) respectively. CPI and TPI provided similar reconstructed images in both Figure 3-6 and 52

Figure 3-7. This was due to fact that the effect of deleting the smallest singular value was minor (mainly affecting the 1st transmitting element). We will return to this point in the discussion section.

Figure 3-2. Pre-beamformed RF signals received by the 30th receiving element at the transmission of the 30th element from 4 different cases: (a) standard STA signal without noise, (b) standard STA signal with 0 dB additive band-passed noise, restored DE-STA signal after applying (c) CPI and (d) TPI to the RF data with the same amount of noise as in (b).

53

Figure 3-3. Pre-beamformed RF signals received by the 30th receiving element at the transmission of the 1st element from 4 different cases: (a) standard STA signal without noise, (b) standard STA signal with 0 dB additive band-passed noise, restored DE-STA signal after applying (c) CPI and (d) TPI to the RF data with the same amount of noise as in (b).

SNR (dB) 30th Transmitter 1st Transmitter

STA 0.78 0.72

CPI 23.40 8.92

TPI 22.46 2.27

Table 3-1. Detailed quantifications of STA, CPI and TPI decoded RF signals with 0 dB additive noise at the transmission of 30th and 1st element respectively

54

Figure 3-4. Pre-beamformed RF signals received by the 30th receiving element at the transmission of the 30th element from 4 different cases: (a) standard STA signal without noise, (b) standard STA signal with -10 dB additive band-passed noise, restored DE-STA signal after applying (c) CPI and (d) TPI to the RF data with the same amount of noise as in (b).

Figure 3-5.Pre-beamformed RF signals received by the 30th receiving element at the transmission of the 1st element from 4 different cases: (a) standard STA signal without noise, (b) standard STA signal with -10 dB additive band-passed noise, restored DE-STA signal after applying (c) CPI and (d) TPI to the RF data with the same amount of noise as in (b)

55

SNR (dB) 30th Transmitter 1st Transmitter

STA -8.8 -8.4

CPI 13.87 -1.39

TPI 13.77 2.40

Table 3-2. Detailed quantifications of STA, CPI and TPI decoded RF signals with -10 dB additive noise at the transmission of 30th and 1st element, respectively

Figure 3-6. Reconstructed images using (a) CPI and (b) TPI decoding processes with 0 dB additive noise

Figure 3-7. Reconstructed images using (a) CPI and (b) TPI decoding processes with -10 dB additive noise

56

3.4.3 Experimental Results

Figure 3-8 shows DE-STA images of the experimental tissue mimicking phantom as described in the method section with (a) CPI and (b) TPI. Figure 3-8 (c) and (d) are the lateral line plots through the wire targets in (a) and (b) as indicated by the white line, respectively. Image qualities obtained from CPI and TPI were quantified by peak-signal-tonoise ratio (PSNR, as assessed by the wire target), spatial resolution (as assessed by the full width at half maximum (FWHM) of the wire target) and contrast-noise-ratio (CNR) of the hyper inclusion. Detailed values are shown in Table 3-3. Based on the results presented in Figure 3-8 and Table 3-3, we concluded that the performance of CPI and TPI were similar, which also agreed well with the simulation results.

Figure 3-8. Experimental DE-STA log-enveloped beamformed images decoded from (a) CPI and (b) TPI. Top row: phantom images obtained by (a) CPI and (b) TPI; Bottom row: lateral line plots through the wire target as in (c) CPI image and (d) TPI image.

57

Mode CPI TPI

PSNR [dB] 38.0 38.2

FWHMlat [mm] 0.60 0.60

CNR (hyper) 1.4229 1.4444

Table 3-3. Detailed quantifications of CPI and TPI decoded images of the experimental phantom

3.5 Discussion
The SNR improvement for both CPI and TPI processes matches the theoretical value as in Hadamard encoding and is independent of the additive noise level. This demonstrates that the decoding process in the DE-STA technique is stable. Truncating the smallest singular value mainly affects the signals corresponding to the 1st transmit channel (Table 3-1 and Table 3-2). Considering the measured signals M are contaminated by noise e , then from Eq. 3-1 and 3-5, the decoded RF signals under noise Pn can be solved as
R ui u Pn  D(M  e)  DM  De   vi M   vi i e i i i 1 i 1 R * *

3-10

The difference between the solutions with and without noise,  P , is

P  Pn  P   vi
i 1

R

ui

*

i

e ,

3-11

where ui and vi are singular vectors associated with the output and input spaces, respectively. From Eq. 3-11, it can be clearly seen that the term corresponding to the small singular values will be more sensitive to the measurement noise e . The coding matrix A has a special distribution of singular values (Figure 3-1), which is a straight line ( 0 ) except for

 1 and  R ( R  128 in both simulations and experiments). Therefore, we only need to check
58

the term associated with the smallest singular value  128 , (i.e. v128

u128

*

 128

e ). Figure 3-9 shows

the plots of vector v128 and v64 (shown as a reference). The index of the horizontal axis, i , is the index of transmitting elements in the vector v128 and v64 . For example, v128 (i ) and v64 (i) indicates the weight used to restore the signals corresponding to the i -th transmitting element. Figure 3-9 shows that when i equals 1, v128 has a much greater value compared with the other points (others are all the same with a value around 0). Consequently, the  P in Eq. 3-11 mostly has an impact on the 1st transmitting element as indicated by Figure 3-9. On the other hand, other singular vectors, such as v64 , will affect signals related to majority of transmitters. The fact that only the signals related to one transmit channel is severely affected by noise shows that DE-STA is a relatively stable encoding and decoding technique in terms of the overall image quality of the enveloped beamformed images since deleting the signals corresponding to the 1st transmitter will not compromise the overall image qualities significantly.

59

Weights

Figure 3-9. Plots of vectors v128 and v64 (reference) of coding matrix A at 8 MHz

The signal amplitudes for TPI decoded data (Figure 3-3 (d) and Figure 3-5 (d)) have been decreased compared to the corresponding CPI decoded data (Figure 3-3 (c) and Figure 3-5 (c)) at the transmission of 1st element. This is because deleting the terms associated with last singular value  R results in loss of part of the signal information. If the noise level is low, the information loss will compromise the performance of TPI, leading to a lower SNR compared with CPI decoded data (Figure 3-3, Table 3-1). However, if the noise level is high, the amplification of noise e in the term of v128
u128
*

 128

e by  128 in the CPI process becomes

dominant. Then TPI shows superiority as illustrated by Figure 3-5 and Table 3-2: the reduction of noise amplitude compensates for the information loss, leading to a higher SNR in TPI decoded data than the CPI case. This term corresponding to  128 mainly affects the 1st 60

transmitting element, which explains the similarity of the image quality in the reconstructed images from CPI and TPI decoded DE-STA images (Figure 3-6, 7 and 8). Another novelty of this chapter is the derivation of a new inversion algorithm. Comparing CPI and TPI decoding processes (Eq. 3-8 and Eq. 3-9) to the original direct inversion as shown by Eq. 3-5, the calculation of coding matrix inversion ( A 1 ) has been replaced by the multiplication with the complex conjugate transpose of coding matrix ( A * ) with some modifications. The efficiency improvement in pseudo inverse includes two aspects: storage memory requirement and computational complexity. We will discuss each inverse process in their optimal situation. For both direct inverse and pseudo inverse (including CPI and TPI), we assume all the singular values and singular vectors ( ui , vi ,  i ) are pre-calculated and pre-loaded in the memory. Then the memory space needed for direct inverse must be sufficient for all the ( ui , vi , i  1 : R ) plus (  1 ,  R and  0 ). This requirement for memory is approximately

R 2

times compare to that in CPI or TPI in which only ( u1 , v1 ,  1 , u R , vR ,  R and  0 ) are needed to be stored. To estimate the computational complexity, we estimate the order of the number of the multiplication and summation in the decoding processes. For simplicity, we assume that the number of transmitters and receivers is the same order as R , ( I  K  R ), the rank of the encoding matrix. Then for the direct inverse process, the calculation of each step and

61

corresponding complexity to decode the k -th column in matrix M , M k ( k  1 : K , receiver index), are shown as below:

ui M k  O( R ) i vi ui M k  O( R  R )  O(2 R ) i Pk  
i 1 R *

*

vi ui M k  O( R  2 R  R 2 )  O(3R 2 ) , i

*

3-12

where Pk is the k -th column in matrix P (restored STA signal in frequency domain). For the pseudo inverse process, the calculation of each step and corresponding complexity are:

v1u1 M k  O( 2 R ) 1 vR u R M k  O(2 R ) R
*

*

A * M k  O( R 2 )
1 A * M k  O( R 2  R ) *  0 0

In total
* * * v u *   v u  1 Pk   1 1 (1  1 1 * )  R R (1  1 1 * )  A *  M k  O( R 2  5R ) * R  0 0  0 0  0 0  1 

3-13

From Eq. 3-12 to Eq. 3-13, the computational complexity has been reduced by 2 / 3 after implementing Eq. 3-8 or Eq. 3-9 compared with the direct inverse equation (Eq. 3-5).

62

The efficiency improvement is important as the decoding matrix is frequency dependent which involves heavy computational load (e.g. to generate Figure 3-8, over 300 decoding matrices are needed). In addition, the simplicity of Eq. 3-8 or 3-9 may also bring the opportunity to implement the decoding through hardware, which will further improve the speed of the decoding process.

3.6 Conclusion
In this chapter, we demonstrated the stability of DE-STA method by testing the decoding process at various SNR levels using both completed pseudo inverse (CPI) and truncated pseudo inverse (TPI). We studied the property of encoding matrix A with SVD and found that all the singular values were the same except for the first one and the last one. The last singular value had very minor effect on the overall image quality from simulation and experimental results. We also derived a more efficient decoding process by replacing the calculation of A 1 by A * with some modifications. The computational complexity was reduced from O(3R 2 ) to O( R 2 ) .

63

Chapter 4 Image Reconstruction by Filtered Spatial Compounding (FSC) in Synthetic Transmit Aperture (STA) Imaging
Authors: Ping Gong, Michael C. Kolios, Yuan Xu P. Gong, M. C. Kolios, and Y. Xu, "Image Reconstruction by Filtered Spatial Compounding (FSC) in Synthetic Transmit Aperture (STA) Imaging," (Submitted for publication, IEEE transactions on ultrasonics, ferroelectrics, and frequency control, Nov 2015)

4.1 Abstract
Spatial Compounding techniques have been developed to improve the image contrastto-noise ratio (CNR) by reducing the background speckle variations. This usually comes at the cost of temporal or spatial resolutions. Here we propose a filtered spatial compounding (FSC) image reconstruction method to enhance target CNR and lesion signal-to-noise ratio (lSNR, one metric to quantify lesion detectability) while still retaining the spatial resolution (at -6 dB level) achieved in delay-and-sum (DAS) beamforming for synthetic transmit aperture (STA) imaging. FSC includes two steps: (1) spatially filtering the off-axis signals 64

with a 2-dimentional (2-D) aperture domain filter along both transmit and receive dimensions; (2) then applying compounding on both dimensions. FSC does not introduce any additional transmission excitations and can potentially have the same frame rate as the DAS beamforming. The proposed FSC method was tested with data from numerical simulations and experiments. Image quality was improved in terms of the target CNR and lSNR (maximally improved by 110% in simulation). The effects of the filter bandwidth, additive noise, and apodization on the performance of FSC were also investigated. Lastly we showed that some other image reconstruction methods, such as DAS, conventional spatial compounding (CSC), and sub-aperture compounding, could be considered as special cases of FSC with different choices of filter parameters.

Keywords: Spatial compounding, 2-D aperture domain filter, Speckle suppression, Synthetic transmit aperture (STA) imaging

65

4.2 Introduction
The lesion SNR in ultrasound images is limited by the speckle signal-to-noise ratio (sSNR). Speckles in the ultrasound images are formed by constructive and destructive interferences of the echoes from a collection of non-resolvable scatterers [42]. Various spatial compounding (SC) methods have been developed and implemented in commercial ultrasound systems to increase the speckle SNR and improve target detectability [19, 43-47]. The compounding effect can be achieved by acquiring the common or overlapping subimages at multiple beam orientations. Each sub-image corresponds to one steering angle [19, 46]. Another compounding technique obtains sub-images using laterally translated sub-arrays [44, 48]. Afterwards, sub-images are combined incoherently with amplitude detection to suppress speckle. Each point in the compounded image may correspond to a different number of sub-images, potentially leading to artifacts during averaging. This can be reduced by some more advanced compounding methods such as acquiring the same scan-lines with different transmit apertures [47] or using a more uniform line density [49]. SC usually sacrifices temporal resolution by involving a greater number of transmission events. This can be compensated by recursive imaging in which the compounded image is updated after each acquisition of a new sub-image [14]. The temporal resolution loss can be further remedied by accomplishing compounding on partially overlapping receive sub-apertures rather than on transmit [50]. Another solution was proposed by Behar et al [51] to perform compounding with a system of three transducers: one phased array located at the center and was used as both transmitter and receiver; another 66

two unfocused piston transducers located at each side and were only used as receivers. This system offered improved image quality without multiple scans. Spatial compounding has also been applied to synthetic transmit aperture (STA) imaging [2] and is referred to as Synthetic Aperture Compounding (SAC) [14, 52, 53]. This technique performed compounding by manipulating the transmit and receive apodizations applied to a convex array. The technique enabled compounding at any angles without temporal resolution loss and provided better image spatial resolution, contrast, and lesion detectability than the conventional compounding and STA imaging. In this chapter, we propose a new spatial compounding technique in which a 2-D aperture domain filter is applied to standard STA signals and is referred to as filtered spatial compounding (FSC). Several methods based on aperture domain filters have been developed to reject signals from off-axis targets to reduce focusing errors and obtain more accurate aberration correction [54-59]. In our FSC technique, a 2-D aperture domain filter along both transmit and receive aperture directions is first applied to the 3-D synthetic transmit aperture RF data; then the compounding is applied to the filtered pre-beamformed data in both transmit and receive processes. The new method improves the speckle SNR and target CNR by compounding. It also retains comparable spatial resolution as achieved in DAS. The above two factors lead to an enhanced lSNR of the targets. Moreover, FSC does not introduce any additional transmissions and potentially preserves the frame rate of standard DAS beamforming.

67

The chapter is organized as follows: In Section 4.3, the theory behind the FSC technique is explained; the simulation and experiment setups and the quantification metrics for FSC images are introduced. Section 4.4 describes the results of both FSC numerical simulations and experiments, such as the effects of the filter bandwidth and noise on the performance of FSC. The comparison between FSC images and those reconstructed with DAS and conventional spatial compounding (CSC) techniques are shown as well. In Section 4.5, we show that some other image reconstruction methods, such as DAS, CSC, and subaperture compounding, can be considered as special cases of FSC with different choices of filters; the reasons of the enhanced image qualities are explained. The conclusions are drawn in Section 4.6. Note that from this chapter, the transmit and receive indices i (i=1:I) and k (k=1:K) will be replaced by m (m=1:M) and n (n=1:N) in order to avoid the confusion with the imaginary unit expression `i 'or `j'.

4.3 Methods
4.3.1 Filtered Spatial Compounding (FSC) in Synthetic Transmit Aperture (STA) Imaging 4.3.1.1 Theory The received channel RF data in the STA imaging technique are presented as a 3-D data matrix (i.e. timeÃreceiveÃtransmit). They are first aligned along time direction with various focusing delays to compensate the time-of-flight differences in each receiving 68

channel under each transmission while focusing at one image point ( I ( x , z ) , with coordinate of ( x, z ) ). Then they can be summed coherently (as in the conventional delay-and-sum (DAS)) to produce the value of the corresponding image point as

I DAS ( x, z )   p(t  tnm , n, m)Ap (n) Ap (m)
m 1 n 1

M

N

4-1

where p(t  t nm , n, m) is the standard STA signal in time domain. m ( m  1 : M ) and n
( n  1 : N ) are the transmit ( T ) and receive ( R ) indexes, respectively. t nm is the focusing

delay that is applied to the signal received by the n -th receiving element when only the m th transmitting element is activated. Ap (m) and Ap (n) are the apodization functions applied to the transmit channel m and the receive channel n , respectively. Standard STA signals can also be summed first coherently along the receive direction then incoherently along the transmit direction (conventional spatial compounding (CSC)) or vice versa as
M  N  I CSC ( x, z )   ENV p(t  tnm , n, m)Ap (n) Ap (m)  m 1    n 1

4-2

where ENV stands for the envelope detection which can be achieved by the Hilbert transform. This ENV was applied to the low resolution images in STA techniques as in Eq.42. CSC of STA data can be regarded as compounding with a laterally translated transmit subaperture. In this chapter, DAS/CSC images were processed with dynamic apodization ( Ap (m) , Ap (n) ) using a Hanning window function with a fixed f-number of 0.87 as introduced in Chapter 1.

69

In the aligned RF data, after the focusing delay compensation, ideally, signals from on-axis objects should be displayed as horizontal lines whereas those from off-axis objects are oblique lines/curves. Figure 4-1 shows a simulated STA image from two closely located point targets beamformed using DAS. The focus was selected at the point target on the right side ( ( x, z ) = (1.01 cm, 1.5 cm)). In the aligned RF signals (Figure 4-2 (a)), the oblique lines are from the off-axis point target on the left side ( ( x, z ) = (0.91 cm, 1.5 cm)), overlapping with the signals from the right one (horizontal lines). Figure 4-2 (a) represents time-aperture domain RF signals when firing the second transmitter. In the standard DAS of the STA signals, the RF data at the time corresponding to a focus point are summed over all combinations of receivers/transmitters, or equivalently across the horizontal direction in the aperture domain (the horizontal plane at t = 25.5 Âµs in Figure 4-2). This coherent summation of the on-axis signals is constructive and leads to the value of the focus point in the image. On the other hand, the signals from the off-axis points will add up destructively in the coherent summation since they have different phases for different transmitter/receiver combinations. This results in the suppression of undesired contribution from the off-axis signals. However, in the CSC technique, signals from both on- and off-axis objects are combined incoherently along the transmit dimension without phase information. Consequently, the beamformed image suffers more from the interferences of off-axis signals in the CSC than those in the DAS method, resulting in decreased image qualities such as poorer spatial resolution and lSNR, even though the speckle SNR can be improved due to compounding. 70

Figure 4-1. Simulated STA image of the phantom with two closely located point targets. One is at (0.91 cm, 1.5 cm) and the other is at (1.01 cm, 1.5 cm). The image was beamformed using DAS.

The different spatial orientation of the signals from on- and off-axis objects can be characterized as different spatial frequencies after applying a Fourier Transform (FT) over the T/R aperture directions of the 3-D data matrix. In principle, a simple low-pass filter in the aperture domain should remove the off-axis signals. Therefore, in the FSC technique, prior to the incoherent summations over T/R aperture directions, we implement a 2-D aperture domain filter to the 3-D Fourier transform of the aligned RF data over the T/R aperture domains to remove the off-axis signals as shown in Figure 4-2 (b). Then the signals are added incoherently across the T/R aperture directions (a horizontal plane) to produce a better speckle SNR.

71

(a)

(b)

Figure 4-2. Aligned RF signals at the transmission of second element in simulation. Focus is set on the point target at (1.01 cm, 1.5 cm) in Figure 4-1. (a) Aligned RF signals without the 2-D aperture domain filter; (b) Aligned RF signals with the 2-D aperture domain filter in FSC technique. The interference patterns (oblique lines) in (a) are removed.

The process of aperture domain filtering in FSC can be presented by Eq. 4-3. Pfiltered  HP 4-3 where P is the 3-D FT of the 3-D STA data matrix; H is a 3-D matrix which acts as 2-D aperture domain filter, (there is no filtering applied along time domain) H  HnHm 4-4

The off-axis signals are displayed as high spatial frequencies. Hence, H is designed as a low-pass filter along both transmit ( H m ) and receive ( H n ) directions ( H m and H n are 3-D matrices which perform filtering along transmit and receive aperture domains, respectively). A Hanning window function is used to design the low pass filters. In this chapter, the cut-off frequency of Hanning window is 1.0 cm-1 ( H n and H m approach zero at a spatial frequency of 1.0 cm-1) to optimize the image qualities (lSNR). A detailed discussion about the Hanning window selection will be introduced in the result section. Afterwards, Pfiltered undergoes inverse Fourier transform along three dimensions (timeÃreceiveÃtransmit) to obtain pfiltered (t  tnm , n, m) . Then spatial compounding (SC) is 72

applied on both transmit and receive by adding envelope-detected pfiltered (t  t nm , n, m) to further suppress the speckle and therefore, to improve the image CNR and lSNR.

N  I FSC ( x, z )    ENV pfiltered (t  t nm , n, m) m1  n 1 
M

4-5

The process of FSC is summarized into a flow chart as shown in Figure 4-3 with the references of DAS and CSC. The FSC process is iterated pixel by pixel over the entire reconstructed image.

Figure 4-3. Flow chart of the filtered spatial compounding (FSC) reconstruction method. DAS and CSC processes are shown as references.

73

4.3.2 Application to Ultrasound Imaging: FSC 4.3.2.1 Focusing Delay Compensation To improve the alignment accuracy, we compensated the focusing delay to the RF signals based on the translation property of Fourier transform over the temporal dimension as shown by Eq. 4-6. p (t  tnm , n, m)  P ( f , n, m)e  j 2ft nm 4-6

 j 2ft nm where P( f , n, m)e is the spectrum of p(t  t nm , n, m) in temporal-frequency domain.

f is any frequency component within the spectrum. The delay was applied to each frequency. 4.3.2.2 Simulation and Experiment Setup The filtered spatial compounding (FSC) technique was tested with both simulations and experimental data. Simulations were performed with the Field II program [35, 36]. A 64element 2-cm-wide 5-MHz linear array was used with a 0.3 mm pitch and a 0.02 mm kerf to simulate the experimental probe. It was placed 5 mm above the phantoms. The data were sampled at 40 MHz. Standard STA data were acquired from different simulated phantoms (as described below in the results section) and reconstructed with DAS, CSC and, FSC. The experimental RF data were acquired using Verasonics Vantage research platform (Verasonics Inc., Kirkland, WA). The ultrasound probe was the L7-4 linear array (Philips) (pitch: 0.298 mm; kerf: 0.05 mm; elevational width: 5.5 mm; elevational focus: 25 mm). The transmitting pulse was one cycle of sinusoidal wave. The central frequency was 5.208 MHz 74

and the sampling frequency was four times of the central frequency. RF data were acquired under standard STA mode. A 4 cm  4 cm tissue mimicking gel phantom was used, which contained a hypo- (on the left side) and a hyper-echoic (on the right side) inclusion with a diameter of 1.2 cm, as well as a wire inclusion of 0.5 mm diameter. The detailed composition description of the phantom can be found in [40, 41]. The STA signals were processed using DAS, CSC and, FSC modes and then displayed as log-enveloped images. The performance of the proposed FSC technique was evaluated using speckle signalto-noise ratio (sSNR), lateral resolution as assessed by PSF at -6, -20, and -40 dB, axial resolution as assessed by FWHM of PSF, contrast-to-noise ratio (CNR) and lesion-signal-tonoise ratio (lSNR) as introduced in Chapter 1 [14-18, 60].

4.4 Results
Both simulation and experimental results are shown in this section. For the simulation results, we first demonstrated the difference between the simulated pre-beamformed RF signals without and with the 2-D aperture domain filter. Then we compared the effects of various 2-D Hanning window aperture domain filters. The robustness of the FSC technique against additive noise was then tested. Lastly, the image qualities in the beamformed images of the simulated and experimental phantoms were analyzed.

75

4.4.1 Simulation Results 4.4.1.1 Filtering Effect on Pre-beamformed RF signals Figure 4-4 illustrates the comparison between the aligned pre-beamformed RF signals (a) without and (b) with the proposed 2-D aperture domain filter ( H ) while focusing on the point target at the center of a simulated speckle generating phantom. The continuous horizontal patterns of RF signals were disrupted by the interferences from off-axis scatters as shown in (a). These interferences were removed by the filter as displayed in (b). The filtered RF signals were shown as relatively straight lines (a spatial frequency of DC component along the receive or transmit domain) after focusing-delay alignment.

Figure 4-4. Aligned channel RF signals in simulation (a) without and (b) with 2-D aperture domain filter from a speckle generating phantom.

4.4.1.2 Hanning Window Selection The size of the 2-D Hanning window filter is a crucial factor in the FSC technique. To evaluate the effect of the Hanning window selection, both simulated point target and speckle generating phantoms were investigated. The FSC images were obtained with the Hanning filter size ranging from 1.0 to 16.7 cm-1, as listed in Figure 4-5 and Figure 4-7, Table 4-1 and Table 4-2.

76

A. Point Target Phantom Figure 4-5 shows the FSC images obtained from a point target phantom and reconstructed with (a) DAS, (b) CSC and FSC with different Hanning window filter sizes as: (c) 1.0, (d) 1.6, (e) 2.6, (f) 3.6 (g) 7.8, (h) 16.7 cm-1. (i) is an FSC image without Hanning window filtering. Figure 4-6 displays the lateral line plots through the point target reconstructed with DAS (Figure 4-5 (a)), CSC (Figure 4-5 (b)) and FSC with three Hanning window sizes chosen as examples for further comparison: 1.0 (Figure 4-5 (c)), 2.6 (Figure 4-5 (e)), and 16.7 cm-1 (Figure 4-5 (h)). The detailed quantifications of the image characteristics are presented in Table 4-1: lateral resolutions as assessed by the PSF at three different levels (-6, -20 and, -40 dB), axial resolutions as assessed by the FWHM and CTR with R equaling to 5 [20].

77

Figure 4-5. Simulated beamformed images of a point target phantom reconstructed with (a) DAS, (b) CSC, and FSC with different Hanning window filter sizes as: (c) 1.0, (d) 1.6, (e) 2.6, (f) 3.6 (g) 7.8, (h) 16.7 cm-1. (i) is the FSC image without Hanning window filtering. The dynamic range is 55 dB.

78

Figure 4-6. Lateral line plots through simulated images of the point target reconstructed with DAS (black solid line), CSC (black dashed line), and FSC with three Hanning window sizes chosen as examples: 1.0 (gray solid line), 2.6 (gray dashed line), and 16.7 cm-1 (gray dot-dashed line).

Hanning window size (cm-1) (a) DAS (b) CSC (c) 1.0 (d) 1.6 (e) 2.6 (f) 3.6 (g) 7.8 (h) 16.7 (i) no filter

Lateral resolution [mm] -6 dB [mm] 0.42 0.58 0.35 0.65 0.88 1.08 1.61 1.96 2.11 -20dB [mm] 0.81 1.12 1.04 1.11 1.73 2.23 3.96 6.26 9.94 -40dB [mm] 1.12 2.12 2.00 2.08 2.88 3.76 6.87 ---

FWHMaxial [mm] 0.35 0.35 0.35 0.35 0.35 0.35 0.35 0.35 0.35

CTR [dB] -61.14 -33.85 -41.88 -42.77 -39.56 -30.77 -12.94 -6.49 -3.87

Table 4-1. Quantification of lateral resolutions at different levels (-6, -20, and -40 dB), axial resolutions and CTR values of point target images obtained from (a) DAS, (b) CSC, and FSC with Hanning window filter sizes as: (c) 1.0, (d) 1.6, (e) 2.6, (f) 3.6 (g) 7.8, (h) 16.7 cm-1. (i) is the FSC image without Hanning window filtering. `--': out of the measurement range.

79

FSC images filtered by a narrow Hanning window (e.g. 1.0 cm-1 Figure 4-5 (c)) provided comparable lateral resolution at -6 dB (FWHM) to those in DAS (a). As the Hanning window size increased, the lateral resolutions (FWHM) in FSC images were degraded. At -20 and -40 dB, the lateral resolutions not only take into account the mainlobe width, but also the sidelobe. As the window size increased, the resolutions became broader and such trend agreed with the -6 dB measurement. We will return to this in the discussion section. The axial resolutions in all the images were the same since it mainly depends on the spatial pulse length and is unaffected by the Hanning filter size. The lateral resolution itself is not sufficient to evaluate the PSF since it mainly focuses on the mainlobe and sometimes ignores the impact of sidelobes (especially at -6 dB). Consequently, the CTR values were also calculated and compared as shown in Table 4-1. With narrower Hanning window sizes (  2.6 cm-1), the CTR values of FSC images were inbetween those of DAS and CSC images. More sidelobes were induced with increased window size (>2.6 cm-1), resulting in degraded CTR values in FSC images which provided the worst performance among the three techniques. From the simulation results of the point target phantom, a small Hanning window size is preferred. Later we demonstrate that the Hanning window size cannot be arbitrarily small to image a speckle generating phantom. An optimal Hanning window size needs to be selected to balance the trade-off between the sidelobe reduction and image CNR improvement to achieve the best lSNR. B. Speckle Generating Phantom 80

To further investigate the effect of Hanning window selection, the same test was performed on the speckle generating phantom as displayed in Figure 4-7 which was a 1 cm  2 cm phantom with a hyper (left) and a hypo (right) inclusions (4 mm diameter) as well as a point target at the center. The scattering strength of the hyper inclusion was 5 times of that in the background and the hypo inclusion had no scatterers in the Field II simulation. Table 4-2 lists the sSNR, lateral and axial spatial resolution (FWHM), CNR and lSNR of the images (quantification values for DAS (Figure 4-7 (a)) and CSC (b) images were shown as references).

81

Figure 4-7. Simulated beamformed images of a speckle generating phantom reconstructed with (a) DAS, (b) CSC, and FSC with different Hanning window filter sizes as: (c) 1.0, (d) 1.6, (e) 2.6, (f) 3.6, and (g) 7.8 cm-1. (h) shows the selected regions of interest (inside the inclusion) and the background (on its both sides) to quantify the CNR and lSNR for both hyper and hypo inclusions, as indicated by the white boxes. The dynamic range is 55 dB.

Hanning window size (cm-1)

sSNR

FWHM Lateral [mm]

FWHM Axial [mm]

CNR (hyper)

CNR (hypo)

lSNR (hyper)

lSNR (hypo)

(a)DAS (b)CSC (c) 1.0 (d) 1.6 (e) 2.6 (f) 3.6 (g) 7.8

1.40 1.76 2.74 3.02 3.68 3.39 2.16

0.5 0.61 0.42 0.5 1.08 1.35 2.19

0.35 0.35 0.35 0.35 0.35 0.35 0.35

1.95 2.74 2.01 2.14 2.52 2.71 2.19

-3.43 -2.82 -6.53 -6.20 -4.12 -3.59 -2.35

18.65 23.72 20.97 20.46 16.40 15.77 10.01

32.80 24.41 68.13 59.28 26.80 20.89 10.74

Table 4-2. Quantification of sSNR, resolutions, CNR, and lSNR values of speckle generating phantom images obtained from (a) DAS, (b) CSC, and FSC with Hanning window filter sizes of : (c) 1.0, (d) 1.6, (e) 2.6, (f) 3.6 (g) 7.8 cm-1.

From Figure 4-7 and Table 4-2, as the size of the Hanning window increased, the speckle SNR and CNR values of the hyper and hypo inclusion increased gradually due to the enhanced compounding effect. However, such CNR improvement reached the maximal point and then decreased after increasing the Hanning window to a certain size (3.6 cm-1 for the hyper inclusion in Table 4-2, also shown in Figure 4-8 (a), upper plot). For the hypo 82

inclusion, the CNR curve decreased after achieving the peak at a smaller window size of 1.0 cm-1 (Figure 4-8 (a), lower plot). This is due to the fact that hypo inclusion was more sensitive to the sidelode from off-axis structures than the hyper one. As a result, it suffered more severe interferences while using wider windows. The lateral resolution (FWHM) degraded with increased Hanning window size and the axial resolution was largely independent of the Hanning window size. This is similar to the results shown in the point target simulation. lSNR was used as the primary quantification metric for lesions as it describes the lesion detectability and accounts for both resolution variation and the CNR enhancement. lSNR curves were plotted for the both the hyper and hypo inclusions as a function of Hanning window size (Figure 4-8 (b)). They both exhibited a peak at the window sizes of 1.0 cm-1. Larger window sizes included more sidelobe effects and reduced the lSNR for both inclusions (Figure 4-8 (b) and Table 4-2). Therefore, a Hanning window size can be selected to trade-off between the CNR, lSNR improvements and sidelobe influence. The value 1.0 cm1

was chosen to process all of the remaining simulation and experimental results.

83

Figure 4-8. . CNR (a) and lSNR (b) curves for both hyper and hypo lesions in the simulated speckle generating phantom. Upper row: hyper lesion; Lower row: hypo lesion.

4.4.1.3 Beamformed Images In diagnostic ultrasound imaging, some lesions may provide a low contrast with the surrounding tissues. Hence, in this section, a 2 cm  2 cm tissue mimicking phantom with very low contrast inclusions were investigated. The tissue mimicking phantom contained four 4-mm-diameter inclusions (two hyper and two hypo echoic) and a point inclusion at the center (as shown by Figure 4-9). These four inclusions were numbered from one to four and referred to as lesion 1 to lesion 4 for convenience. The hyper- and hypo-inclusions, which were barely detectable in the conventional DAS image, had a scattering strength with the amplitudes of 1.7 and 0.6 times of that in the background, respectively. The six white boxes of the same size illustrate the regions selected from the targets (lesion 1-4) and the background for the CNR and lSNR quantification. Each lesion used the background region located at the same depth for calculation to avoid errors.

84

Figure 4-9. Model of the tissue mimicking phantom which contained two hyper and two hypo inclusions numbered from lesion 1 to lesion 4. The six white boxes with the same size illustrate the regions selected from the targets (lesion 1-4) and the background for the CNR and lSNR quantification.

Figure 4-10 shows the beamformed images of the simulated tissue mimicking phantom (Figure 4-9) whereas Figure 4-11 shows the line plots through the central point target using DAS (a), CSC (b), and FSC (c). Quantification metrics are shown in Table 4-3. The FSC image provided comparable CNR values to that in the CSC images but without sacrificing resolution, leading to significantly improved lSNR for all the hyper and hypo inclusions compared to DAS and CSC.

85

Figure 4-10. Beamformed images of the simulated tissue mimicking phantom using (a) DAS, (b) CSC, and (c) FSC techniques. The dynamic range is 35 dB.

86

Figure 4-11. Lateral line plots through the center point target obtained from DAS (dashed line), CSC (dotted line), and FSC (solid line).

Technique sSNR FWHMlat [mm] FWHMaxial [mm] CNR 1 CNR 2 CNR 3 CNR 4 lSNR 1 lSNR 2 lSNR 3 lSNR 4

DAS 1.89 0.46 0.30 0.51 -0.68 -0.87 0.44 5.49 7.32 9.37 4.74

CSC 2.59 0.65 0.30 0.75 -1.06 -1.37 0.71 6.79 9.60 12.41 6.43

FSC 3.03 0.38 0.30 0.87 -1.13 -1.34 0.92 10.31 13.39 13.80 9.47

Table 4-3. Quantification parameters of sSNR, resolutions, CNR, and lSNR measured in DAS, CSC, and FSC images. CNR 1 stands for the CNR value for lesion 1 and lSNR 1 stands for the lSNR value for lesion 1, etc.

4.4.2 Stability against Noise To further demonstrate the stability of FSC reconstruction technique in the presence of noise, 0 dB band-passed white Gaussian noise was applied to the simulated STA RF data acquired from the phantom in Figure 4-9. The reconstructed images and image metrics are 87

shown in Figure 4-12 and Table 4-4, respectively. The FSC image illustrated best lSNR among three reconstruction techniques which indicated stable performance with additive noise. Lesion 4 in the CSC image (Figure 4-12) showed a negative CNR value (that should not occur for a hyper lesion), resulting in undetectable lSNR in Table 4-4.

Figure 4-12. Beamformed images of simulated tissue mimicking phantom obtained with (a) DAS, (b) CSC, and (c) FSC under 0 dB band-passed white Gaussian noise. The dynamic range is 35 dB.

88

Technique sSNR FWHMlat [mm] FWHMaxial [mm] CNR 1 CNR 2 CNR 3 CNR 4 lSNR 1 lSNR 2 lSNR 3 lSNR 4

(a) DAS 1.92 0.46 0.35 0.51 -0.65 -0.81 0.37 5.08 6.48 8.07 3.69

(b) CSC 4.32 0.62 0.35 0.72 -1.15 -1.81 -0.01 6.18 9.87 15.54* --

(c) FSC 3.06 0.38 0.35 0.91 -1.01 -1.25 0.86 9.98 11.08 13.71 9.43

Table 4-4. Quantification parameters of sSNR, resolutions, CNR, and lSNR measured in DAS, CSC, and FSC images with 0 dB band-passed white Gaussian noise. CNR 1 stands for the CNR value for lesion 1 and lSNR 1 stands for the lSNR value for lesion 1, etc.

4.4.3 Experimental Results Filtered spatial compounding was tested with the experimental tissue mimicking gelatin phantom and the beamformed images are shown in Figure 4-13 reconstructed using (a) DAS, (b) CSC and (c) FSC. We zoomed in the region of the wire target to further investigate the image metrics of these three reconstruction techniques (Figure 4-14). The FSC image retained comparable lateral resolution compared to the DAS and CSC images (Figure 4-15). The image CNR in FSC was significantly improved, leading to greatly enhanced lSNR, especially for the hypo inclusion which was more vulnerable to the sidelobe effects. All the comparison values are shown in Table 4-5.
*

lSNR3 in CSC is higher than that in the FSC image. We think this is because the dynamic apodization applied on CSC caused darker

brightness on both sides of the image compared to the center, leading to an unreliable measurement for the hypo inclusion under noise.

89

Figure 4-13. Beamformed images of the experimental tissue mimicking phantom using (a) DAS, (b) CSC, and (c) FSC techniques. The dynamic range is 70 dB.

90

Figure 4-14. Zoomed-in images of the wire target inside the experimental tissue mimicking phantom obtained using (a) DAS, (b) CSC, and (c) FSC techniques.

Figure 4-15. Lateral line plots through the wire target obtained from DAS (dashed line), CSC (dotted line), and FSC (solid line).

91

Technique sSNR FWHMlat [mm] FWHMaxial [mm] CNR (hyper) CNR (hypo) lSNR (hyper) lSNR (hypo)

(a) DAS 1.80 0.50 0.37 0.85 -1.75 23.7 48.8 images.

(b) CSC 5.37 0.80 0.37 0.90 -3.20 19.9 70.6

(c) FSC 3.52 0.80 0.34 1.28 -4.03 29.5 92.7

Table 4-5. Quantification parameters of sSNR, resolutions, CNR, and lSNR measured in DAS, CSC, and FSC

4.5 Discussion
The improvements in terms of sSNR, CNR and lSNR in the FSC images have been demonstrated through both simulation the experimental results. Temporal resolution is also preserved in principle because no additional transmissions are involved. 4.5.1 Computational efficiency of Post-Processing in FSC technique In principle, FSC offers the same frame rate as that obtained using DAS. However, the post-processing steps are time-consuming. It takes approximately 1 sec to generate one image pixel with a 64-element array and 4 sec with a 128-element array on a DELL OptiPlex 790 computer using MATLAB R2012b software. As a result, it took about 69 hrs to obtain Figure 4-10 (c) (500Ã500 pixels). The most time-consuming part is focusing delay compensation for each transmit and receive channel. However, this step can be highly parallelized for real time imaging applications. Other methods such as reducing image pixels, using a reduced sampling rate or sparse transmit/receive channels can also be applied to speed up processing without significantly sacrificing the image quality. 92

4.5.2 Aperture Domain Filter: An Unified Framework for Various Beamformers Here we show that DAS, CSC, and sub-aperture compounding can be considered as special cases of FSC with different choices of filters. The relationships of DAS, CSC, and FSC are illustrated by the corresponding filters in the 2-D T/R aperture domain in Figure 4-16. We can first consider two extreme cases of choosing the filter: if the Hanning window size is extremely narrow (a single point filter) so that it only allows the DC component (spatial frequency equals to 0) to pass in both the transmit ( k m ) and receive ( k n ) directions, as in Figure 4-16 (a), then FSC is equivalent to the DAS technique without apodization as

P (t  tnm , kn , km )   p(t  tnm , n, m)e  j 2nk n e  j 2mk m
m 1 n 1 N

M

N

P (t  tnm ,0,0)   p(t  tnm , n, m)e  j 2n  0e  j 2m  0
m 1 n 1

M

4-7

    p (t  tnm , n, m)    ENV p (t  tnm , n, m) m 1 n 1 m 1  n 1   I DAS ( x, z )
M N M N

Note that when there is only a DC component in the aperture domain ( k m  k n  0 ), the signal p(t  tnm , n, m) is all the same at time (t  tnm ) for any combination of (m, n) , so that coherent and incoherent summations are equal. On the other hand, if the window size is extremely wide (infinity) along the transmit direction but extremely narrow (only the DC component passed) along the receive direction, as in Figure 4-16 (b), FSC is equivalent to the CSC technique, because this filter allows coherent summation along receive ( k n ) and performs compounding only along transmit ( k m ).

93

For the FSC method Figure 4-16 (c), compounding is applied on both transmit and receive with only low spatial frequency components passed.

Figure 4-16. The filters in the T/R spatial-frequency domain along transmit ( k m ) and receive ( k n ) directions in (a) DAS, (b) CSC, and (c) FSC with cut-off frequency of 1.0 cm-1.

Now we explain the relationship between FSC and sub-aperture compounding in STA. Considering the convolution property of Fourier Transform, multiplying the 3-D RF spectrum P with the 2-D aperture domain filter H in the spatial-frequency domain in Eq. 4-3 is equivalent to convolving the STA RF data with the inverse Fourier transform of H the in aperture domain as
Pfiltered  HP  pfiltered  h  p
   p (t  t nm , n' , m ' )  h( n' n) h ( m ' m )
m '1 n '1 M N

4-8

where h is the inverse Fourier transform of H in aperture domain and can be considered as an apodization function in DAS by comparing Eq. 4-8 with Eq. 4-1. The convolution of the
h and p , is equivalent to a sub-aperture coherent summation (or DAS) of the RF data p .

h(m'm) and h(n'n) are equivalent to the apodization functions (as Ap (m) and Ap (n) in
94

Eq. 4-1 and Eq. 4-2) applied to the T and R sub-apertures ( m' and n' are the transmit and receive coordinates shifted in the entire aperture). Therefore, FSC is equivalent to a subaperture compounding in STA, where the sub-aperture lengths along T and R directions are determined by the size of h. The sub-aperture is shifted by one element in either T or

R directions until it covers the entire aperture matrix. Then all the sub-aperture images are
combined together through incoherent compounding. Figure 4-17 shows an example of an array with T/R aperture of 64 elements (same as that used in the simulation). H with a cut-off frequency of 2.6 cm-1 provides a subaperture of 30 elements, shown as a shaded area in the top left hand corner of Figure 4-17. Then the shaded area will be translated horizontally ( T ) or vertically ( R ) by one element at a time to traverse the entire T/R matrix. The images obtained from each T/R sub-aperture are added incoherently to accomplish the compounding. The step size of one element is too small and the sub-images acquired by each subaperture are partially correlated and thus provide redundant information. Such small step size is also time consuming and limits the FSC implementation in real time imaging. In future work, we will examine how this step size can be enlarged without sacrificing the image quality in order to speed up the compounding process.

95

Figure 4-17. T/R aperture matrix of a 64-element array. The shaded area is the selected sub-aperture with 30 elements in both T and R directions, corresponding to a cut-off spatial frequency of 2.6 cm-1. This area is translated along both directions. M' and N' are the sub-aperture sizes determined by the size of h along T and

R , respectively. In this chapter, M'=N'. 4.5.3 Lateral Resolution

FSC images provided comparable lateral resolutions (-6 dB) in both simulations and experiments compared with those in DAS images. In the simulated FSC images, slightly enhanced lateral resolution can be observed with a 1.0 cm-1 Hanning window filter (Figure 45, 7, 10, 11). This is partially due to the absence of dynamic apodization in the simulated FSC image reconstruction. Based on the above discussion, the active sub-aperture to beamform each sub-image in FSC was almost the entire array corresponding to the 1.0 cm-1 96

Hanning window filter size. However, the active aperture in DAS/CSC was smaller than the physical aperture due to the dynamic apodization. Part of the array was used depending on the imaging depth (to retain the same f-number for the different locations). In FSC, as the Hanning window size increased, the corresponding sub-aperture size decreased, leading to broadened lateral resolution as those observed from Figure 4-5 and 4-7. Figure 4-18 (a) shows the reconstructed FSC image (using 1.0 cm-1 Hanning window filter) with exactly the same apodization as used in the DAS or CSC images. Figure 4-18 (b) is the FSC image without apodization shown as a reference. Figure 4-19 displays the lateral line plots through the point target at the center in images reconstructed with DAS, CSC, FSC without and with apodization for further comparison. The degraded lateral resolution in the FSC image with apodization (Figure 4-18 (a)) suggests that the lateral resolution enhancement in the FSC image (Figure 4-18 (b)) is related to the absence of apodization in FSC.

Figure 4-18. Beamformed images of tissue mimicking phantom obtained with FSC with (a) and without (b) apodization. The dynamic range is 35 dB.

97

Figure 4-19. Lateral line plots through the point target obtained from DAS (black dashed line), CSC (black dotted line), FSC without apodization (black solid line) and FSC with apodization (gray dashed line).

For experimental FSC images (Figure 4-13, Figure 4-14, Figure 4-15 and Table 4-5), the lateral resolution was slightly degraded compared to DAS. This is because the imaging region in the experimental phantom was at a greater depth compared to that in the simulated phantom. The increased depth results in an active aperture in DAS that exceeded the one used in FSC. As a result, DAS offered a better lateral resolution compared to FSC. The active aperture size for the DAS and FSC techniques in both simulation and experiment were calculated and shown in Table 4-6 while focusing at the point target. The slight superiority of FSC in terms of lateral resolution due to the absence of dynamic apodization mainly exists in the regions close to the transducer surface. For deeper regions using FSC, the lateral resolution is unaffected by apodization. Therefore, for deeper imaging regions (such as those imaged in the experimental results), the same dynamic apodization function as used in 98

DAS/CSC was actually applied to FSC for optimized lSNR and reducing sidelobe. Despite this, the significantly improved image CNR values in all FSC images still led to the best performance in lSNR.
Active Aperture Size (cm) Simulation Experiment 1.73 2.68 1.89 2.31 (a) DAS (b) FSC

Table 4-6. Comparison of active aperture size in DAS and FSC imaging techniques.

4.5.4 lSNR Improvement

The lSNR improvement in FSC images is a combination result of comparable lateral resolution and significantly improved target CNR. FSC introduces a compounding effect to produce higher speckle SNR and CNR while providing comparable resolution as in the DAS images. The off-axis signal interferences brought by the hyper inclusion with high contrast (Figure 4-7 and Table 4-2) are stronger compared to those from low contrast inclusions (Figure 4-10 and Table 4-3). The same Hanning window selection test was performed on the tissue mimicking phantom with low contrast inclusions (Figure 4-9). The hyper and hypo inclusions provided comparable lSNR values with Hanning window size ranging from 1.0 to 2.6 cm-1 (lSNR at 2.6 cm-1 Hanning window size offered a slightly better performance). Therefore, the Hanning window filter size can be adjusted accordingly (approximately from 1.0 cm-1 to 2.6 cm-1) based on the imaging phantom. Since high contrast hyper inclusions formed more severe clutters on the hypo region, which resulted in degraded lSNR, a 99

narrower window needs to be applied to perform stronger filtering. Whereas for low contrast inclusions, soft filtering (wider window size) is needed in order to maximize compounding.

4.6 Conclusion
In this chapter, we proposed a filtered spatial compounding (FSC) reconstruction technique for synthetic transmit aperture imaging data. The design of the 2-D aperture domain filter was introduced and FSC method was tested with data from numerical simulations and experiments which demonstrated increased image quality in terms of (a) speckle SNR, (b) target CNR, and (c) target lSNR. The effects of the filter bandwidth, additive noise, and apodization on the performance of FSC were also investigated. Other image reconstruction methods, such as delay-and-sum (DAS), conventional spatial compounding (CSC), and sub-aperture compounding, were shown to be special cases of FSC with different choices of filters.

100

Chapter 5 Image Reconstruction by Filtered Frequency Compounding (FFC) in Synthetic Transmit Aperture (STA) Imaging
Authors: Ping Gong, Michael C. Kolios, Yuan Xu

P. Gong, M. C. Kolios, and Y. Xu, "Image Reconstruction by Filtered Frequency Compounding (FFC) in Synthetic Transmit Aperture (STA) Imaging," (Submitted for publication, IEEE transactions on medical imaging, Jan 2016)

5.1 Abstract
Speckles reduce target contrast-to-noise ratio (CNR) and lesion signal-to-noise ratio (lSNR) in ultrasound images. Various spatial compounding (SC) and frequency compounding (FC) approaches have been proposed and implemented in commercial scanners to provide a more homogenous speckle pattern and improve the ultrasound image qualities. We proposed a filtered spatial compounding (FSC) technique in which a 2-dimentional (2-D) aperture domain filter was implemented during SC, for synthetic transmit aperture (STA) imaging data. Here we propose a method referred to as filtered frequency compounding (FFC). The same design of the aperture domain filter as in FSC was used to reduce the 101

interferences from the off-axis signals. Then the energy of the spectrum of the filtered signals was summed in FFC. The proposed FFC was tested with both numerical simulations and experiments. The resolution was degraded as in some other frequency compounding methods. Despite this, FFC offered a great enhancement of CNR, leading to significantly improved target lSNR, up to 130%, compared to that in the standard delay-and-sum (DAS) method. The effects of the filter bandwidth, the window length applied to the radiofrequency (RF) signal and the frequency domain normalization on the performance of FFC were investigated. Finally, we demonstrated that FFC is a combination of both spatial and frequency compounding in which each sub-image was obtained using a sub-aperture in the transmit-receive aperture domain and a sub-band in the temporal frequency domain of a complete STA data set. Consequently, the CNR improvement was more significant for low contrast targets, compared to FSC where only spatial compounding was involved.

Keywords--Frequency compounding, 2-D aperture domain filter, Speckle suppression,

Synthetic transmit aperture (STA) imaging

102

5.2 Introduction
As introduced in Chapter 4, speckle SNR can be improved by spatial compounding (SC) [14, 19, 43-53] and frequency compounding (FC) [16, 61-71]. This chapter will mainly focus on the FC technique. Conventional frequency compounding (CFC) can be achieved by either varying the central frequency of transmitted pulse or by dividing the signal spectrum into a bank of narrow sub-bands [61-64]. In the latter technique, the filtered RF signals achieved from each sub-band form an envelope detected sub-image. Finally, the compounding stage joins all the sub-images by a weighted averaging to provide more homogeneous speckle patterns and enhanced target detectability in ultrasound images. This technique is also known as frequency diversity or split spectrum processing [64]. Frequency decomposition and compounding with wavelet packets can suppress the noise by a soft thresholding of the wavelet coefficients [65]. One challenge which reduces the efficacy of CFC is the frequency dependent attenuation. Some adaptive frequency compounding methods have been proposed such as applying a higher weighting factor to a lower frequency sub-band as the depth increases [66] or using short time Fourier transform (STFT) to analyze the RF spectrum along depth [67]. Frequency equalized compounding (FEC) also estimates the center frequency downshift as the ultrasound pulse travels and the corresponding depth dependent band-pass filters are then designed and implemented [68]. The CFC technique also results in a reduced axial resolution due to the narrow bandwidth of each sub-band which compromises its performance on image quality improvement. Various approaches have been proposed to overcome this disadvantage. One 103

of them is to combine FC with resolution enhancement compression (FC-REC) to extend the trade-off between speckle reduction and axial resolution loss. A coded excitation is used in FC-REC with a wider bandwidth compared to conventional pulsing [16]. Another technique replaces the 1-D narrow-band filters with a bank of wide-band 2-D directive filters to provide effectively the same bandwidth as the original image [69-71]. In this chapter, we describe the technique named filtered frequency compounding (FFC) for synthetic transmit aperture (STA) imaging data [2]. In the FFC method, a twodimensional (2-D) aperture domain filter in both transmit and receive aperture directions is first applied to the 3-D STA RF data. Such 2-D aperture domain filtering step is the same as that in filtered spatial compounding (FSC) technique [60], described in Chapter 4. It is equivalent to the spatial compounding using translated sub-apertures on both transmit and receive. We show that FFC is equivalent to combine both spatial and frequency compounding. Consequently, the enhancement of speckle SNR and image contrast-to-noise ratio (CNR) is a combination of both spatial and frequency compounding processes. The spatial resolution is degraded in FFC as in other frequency compounding methods. However, the combination of both spatial and frequency compounding in the proposed FFC technique extends the trade-off between resolution loss and CNR enhancement, resulting in significantly improved target lSNR in FFC images. The chapter is organized as follows: In Section 5.3, the theory behind the FFC technique is explained; then the simulation and experiment configurations are introduced. Section 5.4 describes the results of both numerical simulations and experiments. Effects of 104

the filter bandwidth and RF window length in FFC method are examined. The comparison between FFC images and those reconstructed with standard delay-and-sum (DAS), conventional spatial compounding (CSC) and FSC techniques is shown as well. In Section 5.5, we explain the reasons for lateral and axial resolution loss in the FFC method. The relationship between the proposed FFC and conventional frequency compounding is also derived to demonstrate that FFC is a combination of both SC and FC, leading to significantly enhanced target CNR and lSNR. Conclusions are drawn in Section 5.6.

5.3 Methods
5.3.1 Filtered Frequency Compounding (FFC) in Synthetic Transmit Aperture (STA) Imaging

5.3.1.1 Theory The received channel RF data in STA imaging technique are presented as a 3-D data matrix (i.e. timeÃreceiveÃtransmit). The same steps as in the FSC technique, such as focusing delay compensation and aperture domain filtering, are applied to the 3-D STA RF signals to obtain pfiltered (t  t nm , n, m ) , which stands for the filtered STA signal transmitted by

m -th (m  1 : M ) element and received by n -th (n  1 : N ) element with a focusing
delay t nm . p (t  t nm , n, m ) is the signal within a 12.5-wavelength RF window (to optimize lSNR) around the focusing point. The 2-D aperture domain filter ( H ) used in this chapter is the same as the one used in Chapter 4 only except for the cut-off frequency of the Hanning 105

window function (2.6 cm-1 is used in FFC method). The detailed discussion about Hanning window and RF window selections for optimized lSNR will be shown in the result section 5.4. Then filtered RF spectrum is normalized by dividing the spectrum of transmitted pulse to make each frequency component within the spectrum to contribute equally to the frequency compounded image in order to average out the speckle patterns more effectively.
Pnor  Pfiltered Ptransmitte d

5-1

where Pfiltered is the 3-D Fourier transform of pfiltered (t  t nm , n, m ) . This normalization step is equivalent to applying a weighting factor to each frequency component during compounding. Then the signal energy is summed within the signal spectrum (2-8 MHz with central frequency at 5 MHz in this chapter) to generate the corresponding image point I FFC ( x, z ) as I FFC ( x, z )  
M N

m 1 n 1 f  f low

P

f high

2

nor

( f , kn , km )

5-2

The processes of DAS, CSC, FSC, and FFC are summarized as a flow chart in Figure 5-1.

106

Figure 5-1. Flow chart of the filtered frequency compounding (FFC) reconstruction method. DAS, CSC, and FSC processes are shown as references.

5.3.2 Application to Ultrasound Imaging: FFC

The filtered frequency compounding (FFC) technique was tested with both numerical simulations and experimental data. 5.3.2.1 Simulation and Experimental Acquisition Setup The simulation and experiment configurations were the same as those described in Section 4.3.2.2. The simulated phantom as shown in Figure 4-9 was tested with FFC using the Field II program.

107

The experimental RF data were acquired using the Verasonics Vantage research platform (Verasonics Inc., Kirkland, WA). The STA signals acquired from the same phantom as shown in Figure 4-13 were reconstructed with FFC method. Then all the DAS, CSC, FSC and FFC images were displayed as log-enveloped images. The performance of the proposed FFC technique was evaluated using speckle signalto noise-ratio (sSNR), lateral and axial resolutions as assessed by full width at half maximum (FWHM) of point spread function (PSF), contrast-to-noise ratio (CNR) and lesion-signal-tonoise ratio (lSNR) [14-18, 60] as introduced in Chapter 1.

5.4 Results
5.4.1 Hanning window and RF window Selection

The size of Hanning window and the length of RF window are two critical factors in the FFC method which determine the image lateral and axial resolutions, respectively, and therefore affect the lSNR. They were selected by testing the tissue mimicking phantom in simulation (Figure 4-9) to optimize lSNR. 5.4.1.1 Hanning Window Selection Figure 5-2 lists the FFC images obtained with different Hanning filter sizes as (a) 1.6, (b) 2.6, (c) 3.6, (d) 5.2 cm-1, respectively. The detailed quantification values are shown in Table 5-1, including sSNR, lateral and axial resolutions (assessed by the point target), CNR and lSNR values for four different lesions. Values in the DAS image were shown as references. All the FFC images offered significantly improved CNR and lSNR values over 108

those obtained in the DAS image. The lateral resolution decreased from (a) to (d), as the size of the Hanning window increased. However, the speckle background became more homogeneous, resulting in improved CNR values. Axial resolution was independent of Hanning window size and remained relatively a constant value under different conditions. lSNR describes the target detectability from the background and it takes into consideration both resolution degradation and CNR enhancement. lSNR curves were plotted for all the hyper and hypo inclusions as a function of Hanning window size (Figure 5-3). Generally, those four curves (for lesion 1 to 4) achieved the maximum value with a Hanning window size ranging from 1.6 cm-1 to 2.6 cm-1. Hence, a Hanning window filter size of 2.6 cm-1 was selected to process all of the remaining simulation and experimental results.

109

Figure 5-2. Beamformed images of the tissue mimicking phantom (Figure 4-9) reconstructed using FFC with different Hanning window filter sizes as: (a) 1.6, (b) 2.6, (c) 3.6, (d) 5.2 cm-1. The dynamic range is 28 dB.

Hanning window size (cm-1)

sSNR

FWHM Lateral [mm]

FWHM Axial [mm]

CNR1

CNR2

CNR3

CNR4

lSNR1

lSNR2

lSNR3

lSNR4

DAS (a) 1.6 (b) 2.6 (c) 3.6 (d) 5.2

1.89 5.93 7.80 9.08 10.46

0.46 0.83 1.02 1.85 3.14

0.30 1.75 2.00 2.08 2.17

0.51 2.99 3.72 4.03 4.02

-0.68 -5.05 -5.53 -5.80 -6.15

-0.87 -5.62 -7.73 -8.51 -8.30

0.44 2.53 3.46 4.45 5.33

5.49 9.92 10.42 8.22 6.16

7.32 16.76 15.49 11.83 9.42

9.37 18.65 21.65 17.35 12.72

4.74 8.40 9.69 9.07 8.17

Table 5-1. Quantification of sSNR, resolutions, CNR and lSNR values of the tissue mimicking phantom images (Figure 5-2) obtained by FFC with Hanning window filter sizes as: (a) 1.6, (b) 2.6, (c) 3.6, (d) 5.2 cm-1. CNR1 and lSNR1 represent the CNR and lSNR values for lesion 1, respectively, etc. The values for DAS image are shown as references.

110

Figure 5-3. lSNR plots for all the hyper and hypo lesions in the simulated tissue mimicking phantom as a function of Hanning window size. lSNR1 corresponds to the lSNR plot for lesion 1, etc. lSNR1: black dashed line; lSNR2: gray solid line; lSNR3: gray dashed line; lSNR4: black solid line. The selected window size is indicated by the vertical dash-dotted line at 2.6 cm-1.

5.4.1.2 RF Window Selection Similar to selection steps used to derive the Hanning window filter size, Figure 5-4 lists the FFC images obtained with different RF window lengths of (a) 4  , (b) 7.5  , (c) 12.5  , (d) 15  , and (e) 20  , respectively. The RF window length is an important measurement parameter with a trade-off between the precision of the spectral estimate of the power spectrum and the spatial localization of the measurement. The quantification values are shown in Table 5-2. From (a) to (e), as the size of the RF window increased, the axial resolution degraded and the values were linearly proportional to the RF window length. The lateral resolution remained relatively a constant. lSNR curves are show in Figure 5-5, all of which presented the maximum peak around RF window size ranging from 7.5  to 12.5  . The value 12.5  was chosen to processing the remaining results. 111

In summary, a Hanning window size of 2.6 cm-1 and a RF window length of 12.5  were selected as the best compromise between the loss in lateral and axial resolutions and the enhancement in image CNR. They were used to generate the remaining simulation and experimental results in order to demonstrate the image quality using the FFC technique.

Figure 5-4. Beamformed images of the tissue mimicking phantom (Figure 4-9) reconstructed using FFC with different RF window lengths as: (a) 4, (b) 7.5, (c) 12.5, (d) 15, and (e) 20   . The dynamic range is 28 dB.

112

RF window length (  )

sSNR

FWHM Lateral [mm]

FWHM Axial [mm]

CNR1

CNR2

CNR3

CNR4

lSNR1

lSNR2

lSNR3

lSNR4

DAS (a) 4 (b) 7.5 (c) 12.5 (d) 15 (e) 20

1.89 2.90 5.12 7.80 7.33 8.01

0.46 0.83 0.96 1.02 1.08 1.22

0.30 0.59 1.25 2.00 2.33 3.08

0.51 1.59 2.61 3.72 3.72 4.24

-0.68 -2.54 -4.07 -5.53 -5.55 -5.28

-0.87 -3.11 -5.72 -7.73 -6.94 -6.65

0.44 1.83 2.63 3.46 3.31 3.73

5.49 9.09 9.53 10.42 9.38 8.74

7.32 14.52 14.86 15.49 14.00 10.90

9.37 17.78 20.89 21.65 17.50 13.72

4.74 10.46 9.60 9.69 8.35 7.70

Table 5-2. Quantification of sSNR, resolutions, CNR and lSNR values of the tissue mimicking phantom images (Figure 5-4) obtained by FFC with RF window lengths as: (a) 4, (b) 7.5, (c) 12.5, (d) 15, and (e) 20   . CNR1 and lSNR1 represent the CNR and lSNR values for lesion 1, respectively, etc. The values for DAS image are shown as references.

Figure 5-5 lSNR plots for all the hyper and hypo lesions in the simulated tissue mimicking phantom as a function of RF window length. lSNR1 corresponds to the lSNR plot for lesion 1, etc. lSNR1: black dashed line; lSNR2: gray solid line; lSNR3: gray dashed line; lSNR4: black solid line. The selected RF window length is indicated by the vertical dash-dotted line at 12.5   .

5.4.2 Simulation Results

Figure 5-6 illustrates the beamformed images of the tissue mimicking phantom reconstructed using (a) DAS, (b) CSC, (c) FSC, and (d) FFC, respectively. The image 113

characteristics are quantified using the speckle signal-to-noise ratio (sSNR), spatial resolution (as assessed by the point target), CNR and lSNR (as assessed by the inclusions). Figure 5-7 shows the lateral line plots across the point target in the image center. The detailed values are shown in Table 5-3. The lateral and axial resolutions (Figure 5-6 and Figure 5-7) were degraded in the FFC image compared with those in DAS, CSC, and FSC images. However, the target CNR was significantly enhanced in the FFC technique (especially for hypo inclusions) compared to the other three methods, leading to the best lSNR in the FFC image.

Figure 5-6. Beamformed images of the tissue mimicking phantom (Figure 4-9) reconstructed with (a) DAS, (b) CSC (c) FSC, and (d) FFC, respectively. The dynamic range is 28 dB.

114

Figure 5-7. Lateral line plots through the wire target from images obtained with DAS (dashed line), CSC (dotted line), FSC (thin solid line), and FFC (thick solid line).

Technique sSNR FWHMlat [mm] FWHMaxial [mm] CNR 1 CNR 2 CNR 3 CNR 4 lSNR 1 lSNR 2 lSNR 3 lSNR 4

DAS 1.89 0.46 0.30 0.51 -0.68 -0.87 0.44 5.49 7.32 9.37 4.74

CSC 2.59 0.65 0.30 0.75 -1.06 -1.37 0.71 6.79 9.60 12.41 6.43

FSC 3.03 0.38 0.30 0.87 -1.13 -1.34 0.92 10.31 13.39 13.80 9.47

FFC 7.80 1.02 2.00 3.72 -5.53 -7.73 3.46 10.42 15.49 21.65 9.69

Table 5-3. Quantification of sSNR, resolutions, CNR and lSNR values of the tissue mimicking phantom images (Figure 5-6) obtained by (a) DAS, (b) CSC, (c) FSC, and (d) FFC, respectively.

5.4.3 Experimental Results

Filtered frequency compounding was also tested with the experimental tissue mimicking gelatin phantom and the beamformed images are shown in Figure 5-8 115

reconstructed using (a) DAS, (b) CSC, (c) FSC, and (d) FFC. For further comparison, the lateral line plots at two depths (as indicated by the white lines in Figure 5-8 (a)) are shown in Figure 5-9: (a) 2.5 cm; (b) 3.5 cm. The FFC image had some resolutions loss (Figure 5-9 (a)) which agreed with the simulation results. The image CNR in FFC was significantly improved (Figure 5-9 (b)) as demonstrated by the good contrast of both inclusions and the reduced speckle fluctuation as observed in the DAS line plot, which led to greatly enhanced lSNR. All the comparison values are shown in Table 5-4.

(a) (b)

Figure 5-8. Beamformed images of the experimental gel phantom reconstructed with (a) DAS, (b) CSC (c) FSC, and (d) FFC, respectively. The dynamic range is 70 dB. The two horizontal white lines in (a) indicate the two depth locations for line plots.

116

Figure 5-9. Lateral line plots at (a) 2.5 cm depth, through the wire target; and (b) 3.5 cm depth, through the inclusions from images obtained with DAS (dashed line), CSC (dotted line), FSC (thin solid line), and FFC (thick solid line).

Technique sSNR FWHMlat [mm] FWHMaxial [mm] CNR (hyper) CNR (hypo) lSNR (hyper) lSNR (hypo)

(a) DAS 1.80 0.50 0.37 0.85 -1.75 23.7 48.8

(b) CSC 5.37 0.80 0.37 0.90 -3.20 19.9 70.6

(c) FSC 3.52 0.80 0.34 1.28 -4.03 29.5 92.7

(d) FFC 6.34 1.15 1.88 5.20 -12.72 42.4 103.8

Table 5-4. Quantification of sSNR, resolutions, CNR and lSNR values of the experimental gel phantom images (Figure 5-8) obtained by (a) DAS, (b) CSC, (c) FSC, and (d) FFC, respectively.

5.5 Discussion
From both the simulation and experiment results, the axial resolutions in the FFC technique were degraded; this is a common consequence of other frequency compounding methods. However, the FFC technique provided a more homogeneous speckle pattern. The 117

CNR values for both hyper- and hypo-inclusions have also been significantly improved, leading to better lSNR in FFC images than that in DAS, CSC, and FSC images.
5.5.1 Normalization Effect

The normalization step during FFC as shown in Eq. 5-1 is equivalent to applying a weighting factor to each frequency component during compounding. Figure 5-10 shows the images of the simulated phantom reconstructed using FFC with (a) and without (b) the normalization step. Detailed quantifications are listed in Table 5-5. From both the images and the metric values, the contribution of the normalization step is insignificant to the final image quality. In this chapter, Ptransmitted was simulated as a Gaussian shaped spectrum. In reality, the transmitted pulse may have null points in its spectrum which will give an infinity value after division. Moreover, the change in spectrum caused by frequency dependent attenuation will also affect the performance of the normalization step, especially in the deep imaging regions. For the experimental results shown in this chapter, the normalization step was removed from FFC to process the image.

Figure 5-10. Beamformed images of tissue mimicking phantom obtained with FFC with (a) and without (b) normalization. The dynamic range is 28 dB.

118

Normalization

sSNR

FWHM Lateral [mm]

FWHM Axial [mm]

CNR1

CNR2

CNR3

CNR4

lSNR1

lSNR2

lSNR3

lSNR4

(a) with (b) without

7.80 7.08

1.02 1.02

2.00 2.00

3.72 3.39

-5.53 -5.27

-7.73 -6.66

3.46 3.05

10.42 9.49

15.49 14.75

21.65 18.65

9.69 8.54

Table 5-5. Quantification of sSNR, resolutions, CNR and lSNR values of the tissue mimicking phantom images (Figure 5-10) obtained by FFC with (a) and without (b) normalization.

5.5.2 Lateral Resolution Loss

The lateral resolution decreased as the Hanning window size increased due to the same reason as discussed in Chapter 4. Multiplying the T/R aperture with the 2-D aperture domain filter H in the spatio-frequency domain is equivalent to a sub-aperture compounding applied to both T and R domains. The inverse Fourier transform of the aperture domain filter corresponds to the size of sub-aperture and therefore, determines the lateral resolution of sub-images. Hence, according to the scale property of the Fourier Transform, a larger Hanning window size in the spatio-frequency domain corresponds to a narrower sub-aperture size in the aperture domain, leading to a degraded lateral resolution in the compounded image.
5.5.3 Axial Resolution Loss

The axial resolution loss was caused by the RF window involved in the FFC process. We assume that the amplitude of frequency components which are outside the pass-band range of ( f low


f high ) is zero. Then based on Parseval's theorem, we have

119

I FFC ( x, z )  
M N T

M

N

m1 n 1 f  f low

P

f high

2

nor

( f , kn , km )
2

5-3

 T  Pnor (t  t mn , k n , k m )
m1 n 1 t 0

where T  12.5 , which was the total length of RF window used in FFC. The frequency compounding over the range of ( f low


f high ) is equivalent to the energy summation within the

rectangle RF window in time domain as shown in Eq. 5-3. The window length T determines the axial resolution of the reconstructed image which approximately equals to T 2 (due to the round trip travel distance in ultrasound imaging). This can be verified by the simulation results from Section 5.4.1.2. Table 5-6 indicates the comparison between the measured and expected axial resolutions calculated using different RF window lengths (corresponding images were shown in Figure 5-4). The measured and expected values in Table 5-6 agree with each other with a maximum percentage difference of 7.5%.
RF window length (   ) Axial resolution [mm] (Measured) Axial resolution [mm] (Expected) % Difference

(a) 4 (b) 7.5 (c) 12.5 (d) 15 (e) 20

0.59 1.25

4  / 2  0.62

5%

7.5 / 2  1.16
12 .5 / 2  1.93 15  / 2  2.31 20  / 2  3.08

7.5% 3.5% 0.86% 0.0% .

2.00 2.33 3.08

Table 5-6. The comparison between the measured and expected axial resolutions with different RF window lengths: (a) 4, (b) 7.5, (c) 12.5, (d) 15 and (e) 20


5.5.4 Relationship between FFC and CFC

The axial resolution loss in the FFC images can also be explained from the process of frequency compounding (i.e. the signal spectrum is divided into narrow sub-bands, leading to 120

degraded axial resolution in the sub-images). In this section, the relation between the proposed FFC and the conventional frequency compounding (CFC) will be examined. In the conventional frequency compounding technique, the spectrum of RF signals are divided into narrow sub-bands using sub-band filters as: P( f n , f )  W ( f  f n ) P( f ) 5-4

where P( f ) stands for the spectrum of RF signals, the aperture dimensions ( m, n ) are omitted in the following equations for easier reading of the equations. W ( f ) is the sub-band filter and f n is the central frequency of the n-th sub-band. Then inverse Fourier transform is applied to the filtered RF spectrum P ( f n , f ) to obtain the sub-band signals in time domain
p ( f n , t ) as

p( f n , t )   P( f n , f )e j 2 ft df

5-5

Afterwards, p ( f n , t ) are processed by conventional delay-and-sum (DAS) beamforming to generate a single sub-image for compounding. In DAS, the focusing delay compensation is first applied to each transmit and receive channel before addition over T/R aperture directions. We assume that the signals are aligned at the focusing point with a reference time
t  0 . Therefore, based on Eq. 5-4 and Eq. 5-5, we have

p ( f n ,0)   P ( f n , f )e j 2f 0 df   W ( f  f n ) P( f )d f  W ( f n )  P( f n )

5-6

121

where  means convolution. We assume that the sub-band filters are symmetric so that
W ( f n ) is equivalent to W (  f n ) . Then the compounding is performed by the summation of

all the sub-images achieved by each sub-band after envelope detection as
I ( x, z )   p ( f n ,0) df n
2

5-7

Considering the convolution property of Fourier Transform, the convolution of the sub-band filter W ( f n ) with the RF spectrum P( f n ) in Eq. 5-6 is equivalent to multiplying the subband filter in time domain w(t ) with the STA RF data in time domain p(t ) . According to Parseval's theorem after combining the above two equations:
I ( x, z )   p ( f n ,0) df n   W ( f n )  P ( f n ) df n   w(t )  p (t ) dt
2 2 2

5-8

Now we can apply Parseval's theorem again to the last term of the above equation, then we have
2 ~ 2 I FFC ( x, z )   w(t )  p(t ) dt   P ( f ) df

5-9

~ where P ( f ) is the Fourier Transform of w(t )  p(t ) (i.e., the spectrum of windowed RF signals), which agrees with the definition of proposed FFC as in Eq. 5-2. From the derivation, the frequency compounding part in FFC is equivalent to CFC with the sub-band scanning through the frequency spectrum with a step size of 1/T, where T is the length of the windowed RF data. w(t ) corresponds to the RF window used in the FFC technique and its Fourier transform W ( f n ) determines the equivalent sub-band used for frequency compounding. Our previous results show that FSC is equivalent to the sub-aperture spatial compounding by translating the sub-apertures in both transmit and receive domains by one 122

element width. In addition to the spatial compounding in FSC, now we show that FFC is equivalent to the sub-band frequency compounding by translating the sub-bands along the frequency spectrum by one frequency interval (or the inverse of the data length in the time domain) on the complete STA data set.
5.5.5 CNR and sSNR Improvement

From the above discussion, the FFC technique combined both spatial and frequency compounding processes, resulting in more significant improvement in the CNR and sSNR values compared to FSC alone (Figure 5-6 and 8, Table 5-3 and 4). The spatial compounding happened during the aperture domain filtering whereas the frequency compounding was implemented during energy summation of the windowed RF signals. Even though the axial and lateral resolutions were degraded, lSNR was the greatest using the FFC technique compared to the other reconstruction methods, especially for low contrast targets. Post image processing methods such as deconvolution can be considered to reduce the resolution loss in the future.

5.6 Conclusion
In this chapter, we proposed a filtered frequency compounding (FFC) reconstruction technique for synthetic transmit aperture imaging data following the work of filtered spatial compounding. The same design of the 2-D aperture domain filter was used here as in FSC technique. The FFC method was tested with data from numerical simulations and experiments which demonstrated increased image quality in terms of target CNR, and lSNR 123

(especially for low contrast targets) as a result of combining both spatial and frequency compounding. The effects of the filter bandwidth, RF window length and normalization effect on the performance of FFC were also investigated to find out the optimum parameters for image reconstruction.

124

Chapter 6 Conclusions and Future Work

6.1 Summary and Conclusions
The work in this dissertation describes ultrasound algorithms in synthetic transmit aperture imaging for image quality improvement. These novel transmission and reconstruction techniques have been validated both theoretically and experimentally from Chapter 2 to 5. This section summarizes the significant findings and conclusions from Chapters 2 through 5. A delay-encoded synthetic transmit aperture (DE-STA) imaging technique has been proposed in Chapter 2 to overcome the low SNR in the RF signals in the standard STA imaging. In the encoding scheme of DE-STA, a half period of delay was applied to certain elements when compared to other transmitting elements; the elements for which the delay was introduced were chosen based on the coding matrix. The decoded RF signals were equivalent to the standard STA signals but with a higher SNR due to this encoding. The DESTA method can be implemented in commercial scanners without phase inversion and the improvement was shown to be comparable to that in Hadamard encoding. Both simulation and experiment results demonstrated enhanced image characteristics in term of resolution (+28%), PSNR (+7 dB) and CNR (+360%), respectively, compared with standard STA 125

imaging. The stability of proposed DE-STA technique was verified in Chapter 3 through singular value decomposition (SVD) study of the coding matrix. Based on the special singular value distribution of the coding matrix (i.e. all the values were the same except for the first one and last one), we proposed two pseudo inverse cases: (1) complete pseudo inverse (CPI), where all the singular values were kept, (2) truncated pseudo inverse (TPI), where the last and smallest singular value was ignored. Both inversion processes were tested under various noise levels. CPI and TPI can restore the signals stably: (1) the noise affected mainly the pre-beamformed signals corresponding to the first transmit channel; (2) the difference in the overall image qualities was negligible. A new efficient decoding formula was also derived and the computational complexity of the new formula decreased by 2/3 compared to the direct inverse. In Chapter 4 and 5, we proposed two compounding techniques which were referred to as filtered spatial compounding (FSC) and filtered frequency compounding (FFC) to reduce the speckle variations and improve lSNR in ultrasound imaging. In both FSC and FFC, a 2dimentional (2-D) aperture domain filter along both transmit and receive dimensions were designed to spatially filter the off-axis signals. Then spatial compounding was applied on both dimensions in FSC. FFC combined both spatial compounding (SC) and frequency compounding (FC). Both FSC and FFC demonstrated improved image qualities in terms of speckle SNR (up to +312%), target CNR (up to +790%), and target lSNR (up to +130%), compared to the values obtained from the standard delay-and-sum (DAS) beamforming on 126

the same dataset. The spatial resolution was degraded in FFC. However, the CNR improvement in FFC was more significant compared to that in FSC alone due to the joint effect of SC and FC. This resulted in greater lSNR in FFC image, especially for low contrast targets.

6.2 Future Work
6.2.1 Decoding Scheme Extension

The decoding framework proposed in Chapter 2 can be applied to the case when a different encoding matrix or different t li is used such as for B-mode, plane wave imaging, and synthetic aperture sequential beamforming. For the above methods, we just need to construct the corresponding delay matrix T , and the decoding and image reconstruction process will be similar to that of DE-STA. We expect that the decoding and image reconstruction framework proposed here can be applied to the image reconstruction using the pre-beamformed RF data obtained in B-mode and plane wave imaging to improve the image quality [72].

6.2.2 Reducing Post-Processing time

As mentioned in Chapter 2 and 5, the time it took for signal decoding and image beamforming in DE-STA imaging were 1 minute and 10 minutes, respectively, on a DELL OptiPlex 790 computer using MATLAB R2012b software. The post-processing steps in FSC or FFC were also time-consuming which cost approximately 1 sec to generate one image 127

pixel with a 64-element array and 4 sec with a 128-element array on a DELL OptiPlex 790 computer using MATLAB R2012b software. As a result, it took about 69 hs to obtain Figure 4-10 (c) (500Ã500 pixels). In principle, the data acquisition speed in DE-STA imaging can be as fast as B-mode imaging and FSC/FFC offers the same frame rate as that obtained using DAS. The postprocessing steps for each technique are totally independent which makes the process amendable to parallel programming and therefore potentially suitable for real time imaging. Therefore, future work may focus on the optimization of DE-STA, FSC and FFC imaging processing steps to accelerate the decoding process and image reconstruction. Methods such as reducing the number of image pixels, using a reduced sampling rate or sparse transmit/receive channels can also be applied to speed up the process without significantly sacrificing the image quality.

6.2.3 Phase Aberration Correction

The ultimate goal is to translate all these techniques to clinical imaging. In the reconstruction schemes, the speed of sound was assumed to be 1540 m/s for soft tissues. However, this value can be as high as 1610 m/s as in muscle or as low as 1470 m/s as in fat [73]. Phase aberration arises from the ultrasound velocity inhomogeneities when ultrasound pulse travels through different tissue structures, leading to beam distortion and focusing errors in the reconstructed images [74]. Phase aberration correction is one of the necessary next steps that need to be examined in preparation for the clinical application of the techniques developed. 128

Figure 6-1 shows a preliminary test of the TPI-DE-STA technique on a porcine kidney and Table 6-1 shows the image metric values. The background noise in the top right hand corner has been reduced in the TPI-DE-STA image (Figure 6-1 (b)). Moreover, the TPIDE-STA image provided better contrast ratio (CR) and CNR compared with the STA image (Figure 6-1 (a)).

Figure 6-1. Beamformed images of a porcine kidney under the transmission modes of (a) STA and (b) DE-STA where the data were decoded using truncated pseudo-inversion (TPI). The two white boxes in (a) indicate the regions selected for CR and CNR quantification.

Techniques FWHMlat [mm] FWHMaxial [mm] CR (dB) CNR

(a) STA

(b) TPI-DE-STA

0.60 0.44 21 2.46

0.56 0.45 24 2.66

Table 6-1. Quantification values of resolutions, CR and CNR of the porcine kidney images obtained with (a) STA and (b) TPI-DE-STA.

Figure 6-2 shows beamformed images of the porcine kidney using (a) DAS, (b) CSC, (c) FSC, and (d) FFC, respectively. The decoded data from TPI-DE-STA were used for reconstructions. The quantification metrics are shown in Table 6-2. The FSC image provided 129

more homogeneous speckle patterns and improved CNR and lSNR values compared to the DAS image. It is also less sensitive to the artifacts caused by off-axis interferences as can be seen in the CSC image (shown in the white ellipse in (b)). FFC sacrificed the resolutions, but the image provided more significant enhancement on the speckle variation reduction and CNR improvement.

Figure 6-2. Beamformed images of a porcine kidney under DE-STA transmission mode and reconstructed using (a) DAS, (b) CSC, (c) FSC, and (d) FFC, respectively.

130

Techniques FWHMlat [mm] FWHMaxial [mm] CR (dB) CNR lSNR

(a) DAS

(b) CSC

(c) FSC

(d) FFC

0.56 0.45 24 2.66 21.2

0.72 0.45 13.84 5.76 40.5

0.92 0.45 23 4.37 27.2

1.36 1.86 45 7.23 18.2

Table 6-2. Quantification values for lateral and axial resolutions, CR, CNR, and lSNR of the porcine kidney images reconstructed using (a) DAS, (b) CSC, (c) FSC, and (d) FFC under the DE-STA transmission mode.

From both Figure 6-1 and Figure 6-2, the same general trends established from Chapter 2 to Chapter 5 in the numerical simulations and tissue mimicking phantom experiments are observed. However, the magnitude of the improvement is not as significant as those in the simulations or phantom experiments where the ultrasound speed was relatively uniform through the entire phantom. The performance degradation may be caused by focusing errors arising from phase aberration. Several approaches can be used to minimize phase aberration. Approaches for aberration corrections include using the peak position of cross correlation with iteration methods to estimate the arrival time differences across the transducer array [74, 75]. Multiple estimates of the aberration delays for a group of adjacent elements were computed in the multi-lag cross correlation method and the arrival time was estimated using least-meansquare error [76-78]. In order to obtain a more accurate aberration measurement profile, a 2D spatial filter was designed to be implemented prior to the measurement to suppress off-axis signals [57]. Some other techniques apply a weighting function during beamforming process which was calculated based on coherence factor [55, 79-81] or phase coherence factor [82] to 131

improve the accuracy of beamformed data. More recent work generated spatial maps of the speed of sound in tissue using pulse-echo sonography according to echo phase shift, which provided another promising tool for aberration correction [83]. We expect that by combining the phase aberration correction techniques with the developed algorithms in this dissertation, we can achieve the optimized performance of those algorithms in tissue imaging.

132

Appendix A
A summary of publications directly and indirectly related to this dissertation between 20122016.

Journal Publications
[1] P. Gong, M. C. Kolios, and Y. Xu, "Delay-encoded transmission and image reconstruction method in synthetic transmit aperture imaging," IEEE transactions on ultrasonics, ferroelectrics, and frequency control, vol. 62, pp. 1745-56, Oct 2015. [2] P. Gong, M. C. Kolios, and Y. Xu, "Pseudo-Inversion (PI) Decoding process in Delay-encoded Synthetic Transmit Aperture Imaging ," (Submitted for publication, IEEE UFFC, June 2015) [3] P. Gong, M. C. Kolios, and Y. Xu, "Image Reconstruction by Filtered Spatial Compounding (FSC) in Synthetic Transmit Aperture (STA) Imaging," (Submitted for publication, IEEE UFFC, Nov 2015) [4] P. Gong, M. C. Kolios, and Y. Xu, "Image Reconstruction by Filtered Frequency Compounding (FFC) in Synthetic Transmit Aperture (STA) Imaging," (manuscript in preparation, IEEE UFFC)

133

Conference Publications
[5] P. Gong, M. C. Kolios, and Y. Xu, "Simulation Studies of Filtered Spatial Compounding (FSC) and Filtered Frequency Compounding (FFC) in Synthetic Transmit Aperture (STA) Imaging," in IEEE International Ultrasonics Symposium (IUS), 2015. [6] P. Gong, A. Moghimi, M. C. Kolios, and Y. Xu, "Delay-encoded transmission in synthetic transmit aperture (DE-STA) imaging," in Ultrasonics Symposium (IUS), 2014 IEEE International, 2014, p. 1005. [7] P. Gong, M. C. Kolios, and Y. Xu, "Comparison of Different Image Reconstruction Algorithms for Synthetic Transmit Aperture Imaging using Sparse Receiving Array," 2014 IEEE International Ultrasonics Symposium (IUS), 2014. [8] Y. Li, P. Gong, M. C. Kolios, and Y. Xu, "Hadamard-Encoded Synthetic Transmit Aperture Imaging with a Reduced Number of Receiving Channels," IEEE International Ultrasonics Symposium (IUS), 2015. [9] D. Yang, P. Gong, J. Ravakkoli, Y. Xu, " Plane Wave Ultrasound Imaging Using Synthetic Aperture Image Reconstruction Techniques: A Simulation Study," (in preparation for IEEE letter)

Patent
[10] Y. Xu, M. C. Kolios, P. Gong, Y. Li " Improved Synthetic Aperture Imaging Methods And Systems" United States Provisional Patent Application No. 62/044,410

134

Bibliography
[1] R. S. C. Cobbold, Foundations of biomedical ultrasound. Toronto: Oxford University Press, 2007. [2] J. A. Jensen, S. I. Nikolov, K. L. Gammelmark, and M. H. Pedersen, "Synthetic aperture ultrasound imaging," Ultrasonics, vol. 44, Supplement, p. e5, 12/22 2006. [3] C. R. Hazard and G. R. Lockwood, "Effects of motion on a synthetic aperture beamformer for real-time 3D ultrasound," 1999 IEEE Ultrasonics Symposium Proceedings, Vols 1 and 2, p. 1221, 1999. [4] N. Bottenus, B. C. Byram, J. J. Dahl, and G. E. Trahey, "Synthetic Aperture Focusing for Short-Lag Spatial Coherence Imaging," IEEE Transactions on Ultrasonics Ferroelectrics and Frequency Control, vol. 60, p. 1816, Sep 2013. [5] Y. Tasinkevych, Z. Klimonda, M. Lewandowski, A. Nowicki, and A. Lewin, "Modified multi-element synthetic transmit aperture method for ultrasound imaging: A tissue phantom study," Ultrasonics, vol. 53, p. 570, Feb 2013. [6] G. R. Lockwood, J. R. Talman, and S. S. Brunke, "Real-time 3-D ultrasound imaging using sparse synthetic aperture beamforming," IEEE transactions on ultrasonics, ferroelectrics, and frequency control, vol. 45, p. 980, 1998. [7] Y. K. Chan and V. C. Koo, "An Introduction to Synthetic aperture Radar (SAR)," in Progress In Electromagnetics Research B, 2008, p. 27.

135

[8]

J. T. Ylitalo and H. Ermert, "Ultrasound synthetic aperture imaging: monostatic approach," IEEE Transactions Ultrasonics, Ferroelectrics and Frequency Control, on, vol. 41, p. 333, 1994.

[9]

C. H. Chang, Y. F. Chang, Y. Ma, and K. K. Shung, "Reliable Estimation of Virtual Source Position for SAFT Imaging," IEEE Transactions on Ultrasonics Ferroelectrics and Frequency Control, vol. 60, pp. 356-363, Feb 2013.

[10]

Z. Li, Q. Chen, J. Zhou, and B. Tian, "Analysis of synthetic aperture radar image characteristics for seismic disasters in the Wenchuan earthquake," Journal of Applied Remote Sensing, vol. 3, p. 031685, 2009.

[11]

L. Huang, Y. Labyed, K. Hanson, D. Sandoval, J. Pohl, and M. Williamson, "Detecting breast microcalcifications using super-resolution ultrasound imaging: A clinical study," Medical Imaging 2013: Ultrasonic Imaging, Tomography, and Therapy, vol. 8675, p. 86751O, 2013.

[12]

Y. Li and J. A. Jensen, "Synthetic aperture flow imaging using dual stage beamforming: Simulations and experiments," Journal of the Acoustical Society of America, vol. 133, p. 2014, Apr 2013.

[13]

T. L. Szabo, Diagnostic ultrasound imaging: inside out: Elsevier/Academic Press, 2004.

[14]

J. M. Hansen and J. A. Jensen, "Compounding in Synthetic Aperture Imaging," IEEE Transactions on Ultrasonics Ferroelectrics and Frequency Control, vol. 59, pp. 2054-2065, Sep 2012. 136

[15]

K. F. ÃstÃ¼ner and G. L. Holley, "Ultrasound Imaging System Performance Assessment," Siemens Medical Solutions USA, presented at 2003 AAPM Annual Meeting, 2003

[16]

J. R. Sanchez and M. L. Oelze, "An ultrasonic imaging speckle-suppression and contrast-enhancement technique by means of frequency compounding and coded excitation," IEEE Trans Ultrason Ferroelectr Freq Control, vol. 56, pp. 1327-39, Jul 2009.

[17]

S. W. Smith, R. F. Wagner, J. M. Sandrik, and H. Lopez, " Low Contrast Detectability and Contrast Detail Analysis in Medical Ultrasound," Ultrasonic Imaging, vol. 4, pp. 188-188, 1982.

[18]

M. F. Insana and T. J. Hall, "Visual detection efficiency in ultrasonic imaging: A framework for objective assessment of image quality," The Journal of the Acoustical Society of America, vol. 95, pp. 2081-2090, 1994.

[19]

S. K. Jespersen, J. E. Wilhjelm, and H. Sillesen, "Multi-angle compound imaging," Ultrasonic Imaging, vol. 20, pp. 81-102, Apr 1998.

[20]

G. Montaldo, M. Tanter, J. Bercoff, N. Benech, and M. Fink, "Coherent plane-wave compounding for very high frame rate ultrasonography and transient elastography," IEEE transactions on ultrasonics, ferroelectrics, and frequency control, vol. 56, p. 489, Mar 2009.

137

[21]

M. Karaman, L. Pai-Chi, and M. O'Donnell, "Synthetic aperture imaging for small scale systems," Ultrasonics, Ferroelectrics, and Frequency Control, IEEE Transactions on, vol. 42, p. 429, 1995.

[22]

M. H. Bae, M. K. Jeong, T. K. Song, and Y. B. Ahn, "Experimental study of transmit synthetic focusing combined with receive dynamic focusing in B-mode ultrasound imaging systems," 1999 IEEE Ultrasonics Symposium Proceedings, Vols 1 and 2, p. 1261, 1999.

[23]

B. Moo-Ho and J. Mok-Kun, "A study of synthetic-aperture imaging with virtual source elements in B-mode ultrasound imaging systems," Ultrasonics, Ferroelectrics, and Frequency Control, IEEE Transactions on, vol. 47, p. 1510, 2000.

[24]

F. Gran and J. A. Jensen, "Multi element synthetic aperture transmission using a frequency division approach," in Ultrasonics, 2003 IEEE Symposium on, 2003, p. 1942.

[25]

F. Gran, J. A. Jensen, and B. Jakobsson, "A code division technique for multiple element synthetic aperture transmission," Medical Imaging 2004: Ultrasonic Imaging and Signal Processing, vol. 5373, p. 300, 2004.

[26]

C. H. Frazier and W. D. O'Brien, Jr., "Synthetic aperture imaging with a virtual source element," in IEEE Ultrasonics Symposium Proceedings., p. 1555, 2006.

[27]

J. Kortbek, J. A. Jensen, and K. L. Gammelmark, "Sequential beamforming for synthetic aperture imaging," Ultrasonics, vol. 53, p. 1, 1 2013.

138

[28]

R. Y. Chiao, L. J. Thomas, and S. D. Silverstein, "Sparse array imaging with spatially-encoded transmits," in IEEE Ultrasonics Symposium Proceedings., p. 1679, 1997.

[29]

R. Y. Chiao and L. J. Thomas, "Method and apparatus for ultrasonic synthetic transmit aperture imaging using orthogonal complementary codes," apr # ~11 2000.

[30]

R. Y. Chiao and L. J. Thomas, "Synthetic transmit aperture imaging using orthogonal Golay coded excitation," 2000 IEEE Ultrasonics Symposium Proceedings, Vols 1 and 2, p. 1677, 2000.

[31]

S. I. Nikolov and J. A. Jensen, "Comparison between different encoding schemes for synthetic aperture Imaging," Medical Image 2002: Ultrasonic Imaging and Signal Processing, vol. 4687, p. 1, 2002.

[32]

R. J. Zemp, A. Sampaleanu, and T. Harrison, "S-Sequence Encoded Synthetic Aperture B-Scan Ultrasound Imaging," 2013 IEEE International Ultrasonics Symposium (IUS), p. 589, 2013.

[33]

T. Harrison, A. Sampaleanu, and R. J. Zemp, "S-Sequence Spatially-Encoded Synthetic Aperture Ultrasound Imaging," IEEE Transactions on Ultrasonics Ferroelectrics and Frequency Control, vol. 61, p. 886, May 2014.

[34]

K. L. Gammelmark and J. A. Jensen, "Multi-element synthetic transmit aperture imaging using temporal encoding," Medical Image 2002: Ultrasonic Imaging and Signal Processing, vol. 4687, p. 25, 2002.

139

[35]

J. A. Jensen and N. B. Svendsen, "Calculation of pressure fields from arbitrarily shaped, apodized, and excited ultrasound transducers," Ultrasonics, Ferroelectrics and Frequency Control, IEEE Transactions on, vol. 39, p. 262, 1992.

[36]

J. A. Jensen, "Field: A program for simulating ultrasound systems," Med. Biol. Eng. Comput., vol. 34, pp. 351-353, 1996.

[37]

J. A. Jensen, O. Holm, L. J. Jensen, H. Bendsen, S. I. Nikolov, B. G. Tomov, et al., "Ultrasound research scanner for real-time synthetic aperture data acquisition," IEEE Transactions on Ultrasonics Ferroelectrics and Frequency Control, vol. 52, p. 881, May 2005.

[38]

J. A. Jensen, H. Holten-Lund, R. T. Nilsson, M. Hansen, U. D. Larsen, R. P. Domsten, et al., "SARUS: A Synthetic Aperture Real-Time Ultrasound System," Ieee Transactions on Ultrasonics Ferroelectrics and Frequency Control, vol. 60, p. 1838, Sep 2013.

[39]

S. Gilbert, "The fundamental theorem of linear algebra," American Mathematical Monthlt, vol. 100, p. 848, 1993.

[40]

P. Gong, A. Moghimi, M. C. Kolios, and Y. Xu, "Delay-encoded transmission in synthetic transmit aperture (DE-STA) imaging," in Ultrasonics Symposium (IUS), 2014 IEEE International, 2014, p. 1005.

[41]

P. Gong, M. C. Kolios, and Y. Xu, "Delay-encoded transmission and image reconstruction method in synthetic transmit aperture imaging," IEEE transactions on

140

ultrasonics, ferroelectrics, and frequency control, vol. 62, pp. 1745-56, 2015-Oct 2015. [42] C. B. Burckhardt, " Speckle in Ultrasound B-mode Scans," IEEE Transactions on Sonics and Ultrasonics, vol. 25, pp. 1-6, 1978. [43] D. P. Shattuck and O. T. vonRamm, " Compound Scanning with a Phased-Array," Ultrasonic Imaging, vol. 4, pp. 93-107, 1982. [44] M. O'Donnell and S. D. Silverstein, "Optimum displacement for compound image generation in medical ultrasound," IEEE transactions on ultrasonics, ferroelectrics, and frequency control, vol. 35, p. 470, 1988. [45] J. Park, J. B. Kang, , and , "Speckle Reduction Techniques in Medical Ultrasound Imaging," Biomedical Engineering Letters (BMEL), vol. 4, pp. 32-40, 2014. [46] V. Behar and M. Nikolov, "Statistical analysis of image quality in multi-angle compound imaging," IEEE John Vincent Atanasoff 2006 International Symposium on Modern Computing, Proceedings, pp. 197-201, 2006. [47] A. H. Cai, "Aperture compounding for medical imaging," United States Patent 6508770, 2003. [48] G. E. Trahey, S. W. Smith, and O. T. vonRamm, "Speckle Pattern Correlation With Lateral Aperture Translation - Experimental Results and Implications for Spatial Compounding," IEEE Transactions on Ultrasonics Ferroelectrics and Frequency Control, vol. 33, pp. 257-264, May 1986. 141

[49]

A. H. Cai, and R. C. Loftman, "Overlapped scanning for multi-directional compounding of ultrasound images," United States Patent 6790181, 2004.

[50]

K. F. Ustuner, C. E. Bradley, D. E. Need, "Medical ultrasonic imaging method and system for spatial compounding," United States Patent 6527720, 2003.

[51]

V. Behar, D. Adam, and Z. Friedman, "A new method of spatial compounding imaging," Ultrasonics, vol. 41, pp. 377-384, Jul 2003.

[52]

J. M. Hansen and J. A. Jensen, "Performance of synthetic aperture compounding for in-invo imaging," in Ultrasonics Symposium (IUS), 2011 IEEE International, 2011, p. 1148.

[53]

J. M. Hansen and J. A. Jensen, "Optimizing Synthetic Aperture Compound Imaging," 2012 IEEE International Ultrasonics Symposium (IUS), pp. 382-385, 2012.

[54]

S. Krishnan, P. C. Li, and M. O'donnell, "Adaptive compensation of phase and magnitude aberrations," IEEE Transactions on Ultrasonics Ferroelectrics and Frequency Control, vol. 43, pp. 44-55, Jan 1996.

[55]

P. C. Li and M. L. Li, "Adaptive imaging using the generalized coherence factor," IEEE transactions on ultrasonics, ferroelectrics, and frequency control, vol. 50, p. 128, Feb 2003.

[56]

J. J. Dahl and G. E. Trahey, "Off-axis scatterer filters for improved aberration measurements," 2003 IEEE Ultrasonics Symposium Proceedings, Vols 1 and 2, pp. 343-347, 2003.

142

[57]

J. J. Dahl and T. J. Feehan, "Direction of arrival filters for improved aberration estimation," Ultrasonic Imaging, vol. 30, pp. 1-20, Jan 2008.

[58]

P. Gong, M. C. Kolios, and Y. Xu, "Simulation Studies of Filtered Spatial Compounding (FSC) and Filtered Frequency Compounding (FFC) in Synthetic Transmit Aperture (STA) Imaging," in IEEE International Ultrasonics Symposium (IUS), Taiwan, 2015.

[59]

M. L. Li, "Adaptive Imaging Using Principal-Component-Synthesized Aperture Data," 2008 IEEE Ultrasonics Symposium, Vols 1-4 and Appendix, pp. 1076-1079, 2008.

[60]

P. Gong, Y. Xu, and M. C. Kolios, "Image Reconstruction by Filtered Spatial Compounding (FSC) in Synthetic Transmit Aperture (STA) Imaging," submitted for IEEE UFFC, Nov 2015.

[61]

V. L. Newhouse, N. M. Bilgutay, J. Saniie, and E. S. Furgason, "Flaw-To-Grain Echo Enhancement bu Slit-Spectrum Processing," Ultrasonics, vol. 20, pp. 59-68, 1982.

[62]

H. E. Melton and P. A. Magnin, "A-Mode Speckle Reduction with Compound Frequencies and Compound Bandwidths," Ultrasonic Imaging, vol. 6, pp. 159-173, 1984.

[63]

G. E. Trahey, J. W. Allison, S. W. Smith, and O. T. Vonramm, "A Quantitative Approach to Speckle Reduction Via Frequency Compounding," Ultrasonic Imaging, vol. 8, pp. 151-164, Jul 1986.

143

[64]

S. M. Gehlbach and F. G. Sommer, "Frequency Diversity Speckle Processing," Ultrasonic Imaging, vol. 9, pp. 92-105, Apr 1987.

[65]

G. Cincotti, G. Loi, and M. Pappalardo, "Frequency decomposition and compounding of ultrasound medical images with wavelet packets," IEEE Transactions on Medical Imaging, vol. 20, pp. 764-771, Aug 2001.

[66]

Y. Erez, Y. Y. Schechner, and D. Adam, "Space variant ultrasound frequency compounding based on noise characteristics," Ultrasound in Medicine and Biology, vol. 34, pp. 981-1000, Jun 2008.

[67]

I. S. Song, C. H. Yoon, G. D. Kim, Y. Yoo, and J. H. Chang, "Adaptive Frequency Compounding for Speckle Reduction," 2011 IEEE International Ultrasonics Symposium (IUS), pp. 1435-1438, 2012.

[68]

C. Yoon, G.-D. Kim, Y. Yoo, T.-K. Song, and J. H. Chang, "Frequency equalized compounding for effective speckle reduction in medical ultrasound imaging," Biomedical Signal Processing and Control, vol. 8, pp. 876-887, Nov 2013.

[69]

R. G. Dantas and E. T. Costa, "Ultrasound speckle reduction using modified Gabor filters," Ieee Transactions on Ultrasonics Ferroelectrics and Frequency Control, vol. 54, pp. 530-538, Mar 2007.

[70]

P. Liu and D. Liu, "Directive Filtering Schemes for Frequency Compounding in Ultrasound Speckle Reduction," Proceedings of 2008 International Pre-Olympic Congress on Computer Science, Vol Ii: Information Science and Engineering, pp. 1317, 2008. 144

[71]

P. Liu and D. Liu, "Oriented Demodulation and Frequency Splitting for Directive Filtering Based Compounding," 2008 IEEE Ultrasonics Symposium, Vols 1-4 and Appendix, pp. 353-356, 2008.

[72]

D. Yang, P. Gong, J. Ravakkoli, Y. Xu, "Plane Wave Ultrasound Imaging Using Synthetic Aperture Image Reconstruction Techniques: A Simulation Study," (in preparation for IEEE letter)

[73]

J. J. Dahl, S. A. McAleavey, G. F. Pinton, M. S. Soo, and G. E. Trahey, "Adaptive imaging on a diagnostic ultrasound scanner at quasi real-time rates," IEEE Transactions on Ultrasonics Ferroelectrics and Frequency Control, vol. 53, pp. 1832-1843, Oct 2006.

[74]

S. W. Flax and M. O'Donnell, "Phase-aberration correction using signals from point reflectors and diffuse scatterers: basic principles," IEEE transactions on ultrasonics, ferroelectrics, and frequency control, vol. 35, p. 758, 1988.

[75]

M. Odonnell and S. W. Flax, "Phase-Aberration Correction using Signals from Point Reflectors and Diffuse Scatterers - Measurements," IEEE Transactions on Ultrasonics Ferroelectrics and Frequency Control, vol. 35, pp. 768-774, Nov 1988.

[76]

D. L. Liu and R. C. Waag, "Time-shift Compensation of Ultrasonic Pulse Focus Degradation using Least-mean-squar-error-estimates of Arrival Time," Journal of the Acoustical Society of America, vol. 95, pp. 542-555, Jan 1994.

[77]

R. C. Gauss, G. E. Trahey, and M. S. Soo, "Wavefront estimation in the human breast," in Medical Imaging 2001 Conference, San Diego, Ca, 2001, pp. 172-181. 145

[78]

E. Gonzalez, N. Sheth, B. Castaneda, J. Dahl and R. Lavarello, "Accuracy of backscatter coefficient estimation in aberrating media using different phase aberration correction strategies - A simulation study," 2014 IEEE International Ultrasonics Symposium (IUS), pp. 2438-2441, 2014.

[79]

K. W. Hollman, K. W. Rigby, and M. O'Donnell, "Coherence factor of speckle from a multi-row probe," 1999 IEEE Ultrasonics Symposium Proceedings, Vols 1 and 2, pp. 1257-1260, 1999.

[80]

M. L. Li and P. C. Li, "A new adaptive imaging technique using generalized coherence factor," in IEEE Ultrasonics Symposium Proceedings., p. 1627, 2002.

[81]

C. C. Nilsen and S. Holm, "Wiener beamforming and the coherence factor in ultrasound imaging," Ultrasonics, Ferroelectrics and Frequency Control, IEEE Transactions on, vol. 57, p. 1329, 2010.

[82]

J. Camacho, M. Parrilla, and C. Fritsch, "Phase Coherence Imaging," IEEE Transactions on Ultrasonics Ferroelectrics and Frequency Control, vol. 56, pp. 958974, May 2009.

[83]

M. Jaeger, G. Held, S. Peeters, S. Preisser, M. Gruenig, and M. Frenz, "Computed Ultrasound Tomography in Echo Mode for Imaging Speed of Sound Using PulseEcho Sonography: Proof of Principle," Ultrasound in Medicine and Biology, vol. 41, pp. 235-250, Jan 2015.

146

Glossary
CFC CNR CPI CR CSC CTR DAS DC DE-STA ENV FC FEC FFC FM FSC FT FWHM lSNR PSF PSNR R REC RF ROI SAC SC SNR sSNR STA STFT SVD T TPI Conventional frequency compounding Contrast-to-noise ratio Completed pseudo-inverse Contrast ratio Conventional spatial compounding Clutter-energy-to-total-energy ratio Delay-and-sum Direct current Delay-encoded synthetic transmit aperture Envelope detection Frequency compounding Frequency equalized compounding Filtered frequency compounding Frequency modulated Filtered spatial compounding Fourier transform Full width at half maximum Lesion signal-to-noise ratio Point spread function Peak signal-to-noise ratio Receive Resolution enhancement compression Radiofrequency Region of interest Synthetic aperture compounding Spatial compounding Signal-to-noise ratio Speckle signal-to-noise ratio Synthetic transmit aperture Short Time Fourier transform Singular value decomposition Transmit Truncated pseudo-inverse

147

