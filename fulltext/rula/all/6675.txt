DESIGN AND DEVELOPMENT OF HARDWARE PLATFORM FOR FULLY-ASSISTIVE LOWER LEG EXOSKELETON

By Bryan Bonnici Bachelor of Engineering Ryerson University, 2013

A thesis presented to Ryerson University in partial fulfillment of the requirements for the degree of Master of Applied Science in the Program of Electrical and Computer Engineering

Toronto, Ontario, Canada
Â© Bryan Bonnici, 2017

AUTHOR'S DECLARATION
AUTHOR'S DECLARATION FOR ELECTRONIC SUBMISSION OF A THESIS I hereby declare that I am the sole author of this thesis. This is a true copy of the thesis, including any required final revisions, as accepted by my examiners. I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research. I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research. I understand that my thesis may be made electronically available to the public.

ii

ABSTRACT
DESIGN AND DEVELOPMENT OF HARDWARE PLATFORM FOR FULLY-ASSISTIVE LOWER LEG EXOSKELETON Bryan Bonnici Master of Applied Science, Electrical and Computer Engineering, Ryerson University, 2017.

The abundance of cheap, portable computing has allowed for complex applications of robotics, especially in the medical rehabilitation field. The emergence of wearable robotics which simulate the movement of healthy individuals is seen as a new option for treating and rehabilitating individuals with paraplegia and other motor disorders. This thesis presents the design and implementation of a miniaturized, low-power, extensible hardware platform for control of a fully-assistive lower-body exoskeleton. A preliminary ARM Cortex-M4-based control platform using modular COTS parts was developed and implemented in a medical exoskeleton (the Bionik Laboratories' ARKE) and was evaluated through human medical trials. Clinical feedback was used to drive the design of a new platform. A functional prototype of the design was constructed and retrofitted onto an exoskeleton. Data acquisition and MATLAB was then used to evaluate and compare the performance of the two designs. A size reduction of 29% is achieved.

iii

ACKNOWLEDGEMENTS
Thank you to my graduate supervisor, Dr. Kaamran Raahemifar for providing me the opportunity to study with him and opening the pathway for my future. Without his assistance I truly could not have succeeded to the level I have today. Thank you to Michal Prywata, Peter Bloch, Amir Takhmar, Nabeel Ahmed and the whole Bionik family for welcoming me into their circle, allowing me to collaborate, and letting me spend time researching with the ARKE. Thank you to my professors, especially Dr. Vadim Geurkov, Dr. Lev Kirischian, and Dr. Gosha Zywno for their advice and direction. Thank you to all my friends, especially my graduate colleagues, Brian Battaglia, Steve Chui, Omar Alejandro Rodriguez, Steve Jones, Jean Claude Clarke, Anna Leschenko, Daniel "Freebird" Adarve, Isuru Weerasekera, and last but definitely not least, Nik Trutiak for their ongoing support. Thank you to my family, who kept me well fed. Thank you to Goran Slavkovic, Sasko Trajcevski and the Rams Water Polo club, who kept me on my toes. Last but not least, I would like to thank Ryerson University and the Faculty of Engineering and Architectural Science for their financial support.

iv

DEDICATION
I dedicate this thesis to my mother, Mercedes Salvador, for inspiring me to give people their lives back.

v

TABLE OF CONTENTS
Author's Declaration ....................................................................................................................... ii Abstract .......................................................................................................................................... iii Acknowledgements ........................................................................................................................ iv Dedication ....................................................................................................................................... v List of Tables ................................................................................................................................. ix List of Figures ................................................................................................................................. x List of Appendices ........................................................................................................................ xii 1 Introduction ............................................................................................................................. 1 1.1 1.2 1.3 1.4 1.5 Motivation ........................................................................................................................ 3 Objectives ......................................................................................................................... 4 Author's Contribution ...................................................................................................... 5 Thesis Layout ................................................................................................................... 6 Background ...................................................................................................................... 7 State of the art ........................................................................................................... 7 Efficacy of Robotic Orthoses .................................................................................. 11 Gait Cycle and Walking .......................................................................................... 11 Forward Kinematics and Trajectory ....................................................................... 12 Motor Control ......................................................................................................... 16

1.5.1 1.5.2 1.5.3 1.5.4 1.5.5 2 2.1 2.2 2.3

Platform Design ..................................................................................................................... 18 Introduction .................................................................................................................... 18 Collaborative work with Bionik Laboratories ................................................................ 18 The ARKE ...................................................................................................................... 19 Firmware Overview ................................................................................................ 21 Application Overview ............................................................................................. 22 Microcontroller ....................................................................................................... 26 Wireless Interface ................................................................................................... 27 IMU ......................................................................................................................... 28 Servomotor Drives .................................................................................................. 28 Summary of Preliminary Design ............................................................................ 29

2.3.1 2.3.2 2.4 2.4.1 2.4.2 2.4.3 2.4.4 2.4.5 2.5

Preliminary Design ......................................................................................................... 24

Shortcomings of Preliminary Design ............................................................................. 30

vi

2.5.1 2.5.2 2.5.3 2.5.4 2.5.5 2.6 2.6.1 2.6.2 2.6.3 2.6.4 2.6.5 2.7 3 3.1 3.2 3.3 3.4 3.5 3.6 3.7 3.8 3.9

Resilience ................................................................................................................ 30 Extensibility ............................................................................................................ 30 Signal Integrity........................................................................................................ 31 Power Architecture ................................................................................................. 32 Design Conclusions for Preliminary Design........................................................... 33 Design Requirements .............................................................................................. 34 Power Architecture ................................................................................................. 38 Logic Architecture .................................................................................................. 44 Block Diagrams ...................................................................................................... 50 PCB Layout and Model .......................................................................................... 51

The Integrated Design .................................................................................................... 34

Summary ........................................................................................................................ 54 Introduction .................................................................................................................... 55 Validation Method.......................................................................................................... 55 Design Verification ........................................................................................................ 56 Vendor Selection ............................................................................................................ 56 Bare Board Inspection and Test ..................................................................................... 57 PCB Assembly ............................................................................................................... 59 PCB Post-Assembly Inspection ..................................................................................... 60 PCB Post-Assembly Electrical Test ............................................................................... 63 Unit Test and Integration................................................................................................ 63 Initial Power On ...................................................................................................... 63 Power Supply Verification...................................................................................... 64 Foot Sensors ............................................................................................................ 66 System Control........................................................................................................ 67 Bluetooth Configuration ......................................................................................... 68

Fabrication and Test of Integrated Design ............................................................................ 55

3.9.1 3.9.2 3.10.1 3.10.2 3.10.3

3.10 Additional Peripherals .................................................................................................... 66

3.11 Flashing .......................................................................................................................... 69 3.12 System Integration.......................................................................................................... 69 3.13 Conclusion...................................................................................................................... 69 4 Experiment............................................................................................................................. 70

vii

4.1 4.2 4.3 4.4 4.5 5 5.1 5.2 5.3 5.4 6 6.1 6.2 6.3

Introduction .................................................................................................................... 70 Experimental Setup ........................................................................................................ 70 Trial Procedure ............................................................................................................... 70 Data Collection and Post Processing.............................................................................. 71 Summary ........................................................................................................................ 72 Introduction .................................................................................................................... 73 Performance data ............................................................................................................ 73 Size Analysis .................................................................................................................. 76 Summary ........................................................................................................................ 77 Conclusions .................................................................................................................... 78 Improvements ................................................................................................................. 78 Recommendations and Future Works ............................................................................ 79

Experimental Results and Discussion.................................................................................... 73

Conclusions and Future Works.............................................................................................. 78

Appendices .................................................................................................................................... 83 References ..................................................................................................................................... 92 Glossary ...................................................................................................................................... 102

viii

LIST OF TABLES
Table 1.1: Life expectancies of persons with SCI [6]..................................................................... 1 Table 1.2: Comparison of FDA approved lower body exoskeletons ............................................ 10 Table 2.1 Comparison of Modular vs Integrated designs ............................................................. 33 Table 2.2: Device-level requirements for Integrated Design ........................................................ 35 Table 2.3: Mechanical Requirements for Integrated Design ........................................................ 36 Table 2.4: Communication Requirements for Integrated Design ................................................. 36 Table 2.5: Power Requirements for Integrated Design ................................................................. 37 Table 2.6: Processing Requirements for Integrated Design.......................................................... 37 Table 2.7: Power Budget Table for Integrated logic board. ......................................................... 39 Table 2.8: Heat analysis of LDO regulators of Integrated Design ............................................... 41 Table 2.9: Microcontroller Specification [50] .............................................................................. 44 Table 2.10: Expansion Port and Console Header Signal Mappings ............................................. 46 Table 2.11: Dimensions of Integrated Design .............................................................................. 54 Table 2.12: Surface Area and Volume of Integrated Design ........................................................ 54 Table 3.1: Results of electrical test on unpopulated PCBs ........................................................... 58 Table 3.2: Results of Post-assembly PCB testing ......................................................................... 63 Table 3.3: Summary of Power Supply Tests ................................................................................ 66 Table 3.4: Summary of Foot Sensor Unit Test ............................................................................. 67 Table 3.5: Summary of System Control Unit Tests ...................................................................... 68 Table 5.1: Dimensions of Preliminary Design .............................................................................. 76 Table 5.2: Dimensions of COTS modules .................................................................................... 76 Table 5.3: Size comparison of Preliminary vs Integrated designs ................................................ 77

ix

LIST OF FIGURES
Figure 1.1: (a) ReWalk Personal (ReWalk) front [22], (b) ReWalk Personal rear [22], (c) The Indego (Parker Hannifin) [23], (d) Ekso GT (Ekso Bionics) [24]. ................................................. 8 Figure 1.2: Sit to Stand and Stepping in a lower body exoskeleton (from Ekso Bionics and [25]) ......................................................................................................................................................... 9 Figure 1.3:a) Manual control of a lower limb orthotic, such as the wristwatch-like controller for the ReWalk (adapted from [28], and b) Automatic control of a robotic orthosis using body tilt to sense walking intention ................................................................................................................. 10 Figure 1.4: The Gait Cycle (adapted from [37]) ........................................................................... 12 Figure 1.5: Leg geometry and reference angles for hip, knee, ankle [12] .................................... 13 Figure 1.6: Sagittal joint angles for Hip, Knee and Ankle. Red line: unperturbed. Blue line: perturbed. The shaded boundary is 3. [39] ................................................................................. 14 Figure 1.7: Sampling of an arbitrary curve. The position (angle) of the corresponding joint has been normalized to 8-bit resolution (0 to 255).............................................................................. 16 Figure 1.8: Illustration of PWM control of servomotor. The actuator has a 180Â° range of motion. Adapted from [48]......................................................................................................................... 17 Figure 2.1: The ARKE Generation 2.0 Exoskeleton [49]............................................................. 20 Figure 2.2: ARKE Simplified State Machine ............................................................................... 21 Figure 2.3: Flowchart showing typical therapy session with device. ........................................... 23 Figure 2.4: Walking Interface on Control Tablet [49] .................................................................. 24 Figure 2.5: Top view of Preliminary logic board ......................................................................... 25 Figure 2.6: Preliminary logic board in-situ with additional hardware components ..................... 25 Figure 2.7: Block diagram of exoskeleton system with Preliminary logic board......................... 26 Figure 2.8: Power architecture of Integrated Design .................................................................... 38 Figure 2.9: Schematic Design of PPSU ........................................................................................ 42 Figure 2.10: Schematic of 12V Buck Converter in Integrated Design ......................................... 43 Figure 2.11: Efficiency vs. Load Current and Vin curves for LM5010 regulator (adapted from [66])............................................................................................................................................... 43 Figure 2.12: JTAG port on Tiva C-Series Launchpad (adapted from [52]) ................................. 47 Figure 2.13: JTAG Connection to PCB ........................................................................................ 49 Figure 2.14: System Block Diagram of Integrated Design ........................................................... 50
x

Figure 2.15: Block diagram of system with Integrated Design. ................................................... 51 Figure 2.16: (a) top left: 2D layout of Microcontroller; (b) example of 3D model of part provided in Altium Vault; (c) examples of 3d models of parts provided by part vendor, (d) example of simple self-modeled part ............................................................................................................... 52 Figure 2.17: 3D Isometric view of Integrated Design showing components and system interfaces ....................................................................................................................................................... 53 Figure 3.1 a) Top side and b) Bottom side of the bare board. ...................................................... 58 Figure 3.2 a) Various solder bridges are present across IC legs after reflow, b) A connector pulled askew during reflow........................................................................................................... 61 Figure 3.3 a) Assembled top side of PCB, b) Assembled bottom side of PCB, c) Close-up of IMU ............................................................................................................................................... 62 Figure 3.4: Initial programming of the microcontroller. The microcontroller is loaded with the blink program. The LED on the lower left of the board is illuminated and flashes with the adjacent LED. ............................................................................................................................... 64 Figure 3.5: Reworked Buck Converter ......................................................................................... 65 Figure 3.6: Output of 12V0 buck converter .................................................................................. 65 Figure 3.7 Testing the foot sensors. The left and right LEDs on the board illuminate when their respective foot sensor is occluded. a) Both sensors open, b) Left sensor occluded, c) Right sensor occluded, d) Both sensors occluded. ............................................................................................. 67 Figure 3.8: Integrated Design advertising over Bluetooth ............................................................ 69 Figure 4.1: Workflow for collecting and processing walking session data .................................. 72 Figure 5.1: Joint angles and velocities of ARKE system using Preliminary Logic Board ........... 74 Figure 5.2: Joint angles and velocities of ARKE system using Integrated Logic Board.............. 75 Figure 6.1: Addition of reworked RC network to PCB. ............................................................... 79

xi

LIST OF APPENDICES
APPENDIX A: PCB DRC RESULTS AND STACKUP ............................................................. 83 A.1 PCB Stackup....................................................................................................................... 84 APPENDIX B: IR REFLOW OVEN ........................................................................................... 85 APPENDIX C: SCHEMATICS .................................................................................................... 86

xii

1 INTRODUCTION

Robotics are considered as a new modality for treating disability [1,2]. When an individual's brain or central nervous system (CNS) is affected by injury or pathology (e.g. stroke), he/she may suffer from varying degrees of motor impairment. The resulting long-term effects of motor impairment, which include atrophy, denervation and cardiovascular disease [3-5], are still of great concern to affected individuals and their families. For example, the life expectancy of persons with spinal cord jury (SCI) remains significantly lower than the life expectancies of healthy individuals. Data, adapted from the US National Spinal Cord Injury Statistical Center [6], and listed in Table 1.1, indicate that on average persons with paraplegia live between 10 to 15 years less than healthy individuals. Persons surviving the first 24 hours Persons surviving at least 1 yr. post injury
Age at Injury AIS-D No SCI Paraplegic Low Tetra (C5-C8) AIS-D Para Low Tetra (C5-C8)

20 40 60

59.5 40.6 23.1

52.6 34.2 17.9

45.1 27.7 13.1

40.0 23.5 10.3

52.9 34.5 18.2

45.5 28.1 13.4

40.7 24.1 10.6

Table 1.1: Life expectancies of persons with SCI [6]

The goal of robotic therapy, then, is to place the individual in a device which shares the movement and forces of healthy ("pathology-free") individuals and utilizes their neuroplasticity [7,8] to retrain their motor skills, while promoting innervation and redevelopment of muscle and bone density [9]. Through this training, it is hoped that these impairments can be corrected or mitigated.

1

There is a large range of new possibilities for rehabilitative robotics, including arms [8], [10] and legs. Legged machines have greatly evolved since the hopping machines of Raibert [11] in 1985. The advent of cheap and abundant computing as the result of Moore's law has allowed for a generational leap in the complexity of robots. Modern embedded systems have made computationally demanding applications possible in small, portable and inexpensive forms. Wearable mobile machines, known as exoskeletons, are an important innovation emerging from the flexibility and performance of such modern systems. Exoskeletons can be generally described as systems consisting of powered joints and linkages enveloping the user, and can be divided into two main categories: 1) exoskeletons for performance augmentation, such as in [12-15], which increase the strength and endurance of the wearer with general use in civilian and military applications, and 2) exoskeletons used in the medical sector for rehabilitative purposes, such as in [16-18]. The second group can be further divided into partialassist devices, which, like augmentative devices amplify the residual strength, and full-assist devices which completely control the wearer's movement. These rehabilitative devices, also known as orthoses, would be used to restore the walking ability lost due to disease or trauma such as SCI. Exoskeletons can also be classified into two groups: full and partial-body orthoses. Partial body orthoses for lower limbs are presently a highly active field of research that is also experiencing growing public visibility. For instance, the 2014 FIFA World Cup in Brazil began with a kick by Juliano Pinto, a 29-year-old paraplegic, that was accomplished with the help of a full body exoskeleton and a brain-computer interface made by Brain Products [19]. Several companies are actively developing medical exoskeletons, including the Ryerson University-based Bionik Laboratories, Ekso Bionics, ReWalk, Parker, and Cyberdyne.

2

The design of medical exoskeletons poses numerous engineering challenges including the flexibility of the device to move and accommodate different user geometries, power control, failsafe operation, and preventing joint fouling or other user injury. On the consumer side, these challenges are offset by the improved prognosis that they provide compared to the traditional wheelchair.

1.1

MOTIVATION

The existing lower body exoskeletons are large and cumbersome for users. This research aims to develop a miniaturized hardware platform using commercial electronics which will reduce the size of these devices, increasing their portability, range and therefore autonomy of their users. In addition, the design seeks to add modularity and extensibility to offset the high costs and risks associated with the development components for medical devices. Generally, the healthcare industry remains conservative due to liability. By enabling rapid design cycles without sacrificing performance, smaller and more capable orthoses will come to the market hopefully in the near future.

3

1.2 OBJECTIVES

The main objective of this work is to develop an extensible fully-assistive lower-body exoskeleton controller which coordinates the top-level control and interfacing tasks for the exoskeleton. The following stages were considered towards that goal: 1. Research and analyze the existing approaches to hardware design of robotic exoskeletons, their demands and constraints. 2. Develop and install prototype hardware platform into an existing exoskeleton system. 3. Demonstrate that the design i) is functional, ii) meets or exceeds the performance of an existing system through the collection and analysis of device performance data, and iii) reduces the size of an existing platform. 4. Identify possible improvements of the proposed hardware platform through testing.

4

1.3 AUTHOR'S CONTRIBUTION
The following contributions were made towards the main objective: 1. Performed an in-depth literature review of the existing medical lower body exoskeletons, PCB layout techniques and embedded design principles. 2. Collaborated with the ARKE team at Bionik Laboratories to develop hardware for prototype exoskeleton platform used for baseline performance; verified and validated design, then deployed controller in four ARKE systems for medical trials at rehabilitation centres in Ottawa and Montreal. 3. Clinical and engineering feedback was gathered over eight months of medical trials to revise the design, incorporating additional functionality and increasing the resilience. 4. Developed, fabricated and tested revised platform design in ARKE system. 5. Gathered performance data, performed analysis on results in MATLAB and translated observations into suggested features for future revisions.

5

1.4 THESIS LAYOUT
The following chapters are organized as follows:



In Chapter 2, a detailed overview of the existing exoskeleton and how it works is provided. A preliminary design used for the command and data handling subsystem of the device is presented as the baseline for performance. The existing controller was analyzed for its shortcomings to improve upon the design. The improved design is presented, with focus placed on improving resilience and extensibility of the platform.



Chapter 3 presents the validation process for assembling a unit of the improved design. A unit is assembled and tested prior to insertion into the system for performance evaluation.



Chapter 4 presents the experiment used for gathering performance data, as well as the methodology behind data collection and post-processing.



Chapter 5 contrasts the results of the Preliminary design with the Integrated, and a size analysis is performed on the two designs.



Chapter 6 presents the conclusions of the thesis, and proposes improvements to the design, recommendations and future works.

6

1.5 BACKGROUND
The following background is provided to give insight into the current state-of-the-art design of lower body orthoses and the operational theory, including the emulation of walking kinematics. Several exoskeletons that are currently used in clinical settings are discussed in Section 1.5.1. 1.5.1 State of the art

In Canada and the United States, medical devices such as these orthoses are subject to regulatory compliance before authorization for sale. The governing bodies for these countries are Health Canada and the FDA, respectively. Examples of Health Canada or FDA approved lower body orthoses are the ReWalk Personal (ReWalk Robotics, shown in Figure 1.1a and b) [16], Indego (Parker Hannifin, Figure 1.1c) [20] and Ekso GT (Ekso Bionics, Figure 1.1d) [21]. These orthoses are intended for clinical use, and, in the case of the ReWalk and Indego, also for home use. Each orthotic follows a common mechanical design, consisting of a fitted metal frame with a computerized control system worn on the user's trunk. Fabric padding is provided for user's comfort and to minimize skin abrasion. Similarly, each orthotic uses a symmetrical four-axis arrangement to implement walking trajectories along the sagittal plane. Whereas the hip is a spherical joint with a complicated six degrees of freedom (DOF) range of movement, these devices approximate the motion using single revolutionary joints due to the difficulty of reproducing this range of motion robotically. The loss of these DOF is not necessary to approximate walking.

7

(a)

(b)

(c)

(d)

Figure 1.1: (a) ReWalk Personal (ReWalk) front [22], (b) ReWalk Personal rear [22], (c) The Indego (Parker Hannifin) [23], (d) Ekso GT (Ekso Bionics) [24].

8

These orthoses perform sit-to-stand and stand-to-sit motions which allow users with varying levels of hemiparesis or paralysis to stand and walk over level ground. Some orthoses, such as the ReWalk, can also navigate stairs. Figure 1.2 shows a typical sit-to-stand motion. It should be noted that the user is reliant on a pair of crutches for maintaining balance and navigating while inside the orthotic. These orthoses, therefore, are not intended for individuals with upper extremity disability.

Figure 1.2: Sit to Stand and Stepping in a lower body exoskeleton (from Ekso Bionics and [25])

To allow for free roaming in clinical and neighborhood settings, these orthoses are powered by rechargeable batteries which allow for several hours of use. Two means of user input are generally provided by each orthotic. The first is control from an external apparatus, such as a wireless controller (ReWalk, shown in Figure 1.3a), tethered remote (Ekso GT), or smartphone application (Indego). The second is via the use of onboard

microelecromechanical (MEMS) sensors which detect angular and translational displacement and forces of the orthotic. Rueterbories et al. in a study of various orthoses conclude that the most common types of sensors found are accelerometers typically in combination with gyroscopes, with little criticality as to the positioning of the sensors in the device [26]. These sensors determine user
9

intent via means ranging from binary thresholding of these sensor values to complex multi-sensor algorithms. An example of accelerometry being used to determine walking intention is shown in Figure 1.3b. By measuring tilt, an orthotic can detect the user's center of gravity (COG) shifting onto the stance leg, which, in healthy gait, precedes the motion of the swing leg. This can be used to trigger the leg motion of the orthotic. Other orthoses, such as the Cyberdyne HAL, use ground forces to detect user intention [27]. Many other methods exist, however the choice of sensor should emphasize reliability, minimizing components and size, and user acceptance [26].

(a)

(b)

Figure 1.3:a) Manual control of a lower limb orthotic, such as the wristwatch-like controller for the ReWalk (adapted from [28], and b) Automatic control of a robotic orthosis using body tilt to sense walking intention

The user characteristics and weights for the ReWalk, Ekso GT and Indego are listed in Table 1.2. These orthoses are designed to suit most of the population, either by being adjustable (such as for shared devices in clinical settings) or built personalized to each user. Parameter User Height Range User Weight Range Device Weight SCI Level: ReWalk 5'3" (160cm) - 6'3" (190cm) Up to 220lb (100kg). Appx. 50lb (23kg) T4 or lower Ekso GT 5'2" (157cm) - 6'2" (188cm) Up to 220lb (100kg). Appx. 50lbs (23kg) C7 or lower Indego 5'1 (155cm) - 6'3 (191cm) Up to 250lbs (113kg) Appx. 26lb (12kg) C5 or lower

Table 1.2: Comparison of FDA approved lower body exoskeletons

10

The approximate cost of these orthoses are $100,000USD each with an expected lifespan of 5 years [16]. 1.5.2 Efficacy of Robotic Orthoses

The therapeutic benefits of bionic rehabilitation are presently the subject of intense study. Arazpour et al. [29] have summarized the medical studies on the efficacy of orthoses and generally found improved gait pattern and walking speed and reduced energy consumption. This is concurred by Benson et al. [30]. Kressler et al. [31] demonstrate reduced pain intensity with orthoses. Murtagh [16] found that lower body robotic orthoses are generally well tolerated with no serious adverse events reported for the devices. 1.5.3 Gait Cycle and Walking

Walking involves the intricate coordination of different muscles and joints coupled with sensory feedback used by the nervous system to correct disturbances or deviations from intended movement [32]. Walking, from a neurology perspective, consists of i) voluntary activation of the somatic nervous system with the intent to walk, ii) activation of the central nervous system and propagation of signals to muscles in the extremities, iii) muscle contraction, and iv) generation and regulation of muscle forces and joint torques [32,33]. A person's manner of walking is known as gait. The cyclic process of upright body locomotion is known as the gait cycle [34]. Biomechanically, pathology-free gait consists of bilaterally symmetrical swing and stance phases occupying 40% and 60% of each gait cycle, respectively [15]. These phases overlap with the swing phase for one leg starting during the stance phase of the other. A gait cycle can also be further broken down into the following phases: Heel Strike,

11

Foot Flat, Mid-Stance, Push-Off (also referred to as Heel-Off), Toe-Off and Mid-Swing [34Â­36]. Figure 1.4 illustrates a gait cycle. In addition, a gait cycle can also be divided into single support (when only one foot is in contact with the floor) and double support (when both feet are in contact with the floor) phases.

Figure 1.4: The Gait Cycle (adapted from [37])

1.5.4

Forward Kinematics and Trajectory

The trajectory of the lower body during the gait cycle has been extensively modeled by researchers like Hogan [38]. These models are used as a reference for approximation of human walking by lower limb orthoses. First consider the lower body in the sagittal plane. Without loss of generality, consider the joint angles of one leg since the body is bilaterally symmetric. Figure 1.5 shows the geometry of the hip, knee and ankle. Zoss et al. [12] and Moore et al. [39] use the convention of defining the nominal (zero) angles for the hip ( ), knee ( ) and ankle ( ) to be such that the vectors

from the shoulder to the hip, the hip to knee, knee to heel, and heel to toe be collinear.

12

1 INTRODUCTION

Robotics are considered as a new modality for treating disability [1,2]. When an individual's brain or central nervous system (CNS) is affected by injury or pathology (e.g. stroke), he/she may suffer from varying degrees of motor impairment. The resulting long-term effects of motor impairment, which include atrophy, denervation and cardiovascular disease [3-5], are still of great concern to affected individuals and their families. For example, the life expectancy of persons with spinal cord jury (SCI) remains significantly lower than the life expectancies of healthy individuals. Data, adapted from the US National Spinal Cord Injury Statistical Center [6], and listed in Table 1.1, indicate that on average persons with paraplegia live between 10 to 15 years less than healthy individuals. Persons surviving the first 24 hours Persons surviving at least 1 yr. post injury
Age at Injury AIS-D No SCI Paraplegic Low Tetra (C5-C8) AIS-D Para Low Tetra (C5-C8)

20 40 60

59.5 40.6 23.1

52.6 34.2 17.9

45.1 27.7 13.1

40.0 23.5 10.3

52.9 34.5 18.2

45.5 28.1 13.4

40.7 24.1 10.6

Table 1.1: Life expectancies of persons with SCI [6]

The goal of robotic therapy, then, is to place the individual in a device which shares the movement and forces of healthy ("pathology-free") individuals and utilizes their neuroplasticity [7,8] to retrain their motor skills, while promoting innervation and redevelopment of muscle and bone density [9]. Through this training, it is hoped that these impairments can be corrected or mitigated.

1

There is a large range of new possibilities for rehabilitative robotics, including arms [8], [10] and legs. Legged machines have greatly evolved since the hopping machines of Raibert [11] in 1985. The advent of cheap and abundant computing as the result of Moore's law has allowed for a generational leap in the complexity of robots. Modern embedded systems have made computationally demanding applications possible in small, portable and inexpensive forms. Wearable mobile machines, known as exoskeletons, are an important innovation emerging from the flexibility and performance of such modern systems. Exoskeletons can be generally described as systems consisting of powered joints and linkages enveloping the user, and can be divided into two main categories: 1) exoskeletons for performance augmentation, such as in [12-15], which increase the strength and endurance of the wearer with general use in civilian and military applications, and 2) exoskeletons used in the medical sector for rehabilitative purposes, such as in [16-18]. The second group can be further divided into partialassist devices, which, like augmentative devices amplify the residual strength, and full-assist devices which completely control the wearer's movement. These rehabilitative devices, also known as orthoses, would be used to restore the walking ability lost due to disease or trauma such as SCI. Exoskeletons can also be classified into two groups: full and partial-body orthoses. Partial body orthoses for lower limbs are presently a highly active field of research that is also experiencing growing public visibility. For instance, the 2014 FIFA World Cup in Brazil began with a kick by Juliano Pinto, a 29-year-old paraplegic, that was accomplished with the help of a full body exoskeleton and a brain-computer interface made by Brain Products [19]. Several companies are actively developing medical exoskeletons, including the Ryerson University-based Bionik Laboratories, Ekso Bionics, ReWalk, Parker, and Cyberdyne.

2

The design of medical exoskeletons poses numerous engineering challenges including the flexibility of the device to move and accommodate different user geometries, power control, failsafe operation, and preventing joint fouling or other user injury. On the consumer side, these challenges are offset by the improved prognosis that they provide compared to the traditional wheelchair.

1.1

MOTIVATION

The existing lower body exoskeletons are large and cumbersome for users. This research aims to develop a miniaturized hardware platform using commercial electronics which will reduce the size of these devices, increasing their portability, range and therefore autonomy of their users. In addition, the design seeks to add modularity and extensibility to offset the high costs and risks associated with the development components for medical devices. Generally, the healthcare industry remains conservative due to liability. By enabling rapid design cycles without sacrificing performance, smaller and more capable orthoses will come to the market hopefully in the near future.

3

1.2 OBJECTIVES
The main objective of this work is to develop an extensible fully-assistive lower-body exoskeleton controller which coordinates the top-level control and interfacing tasks for the exoskeleton. The following stages were considered towards that goal: 1. Research and analyze the existing approaches to hardware design of robotic exoskeletons, their demands and constraints. 2. Develop and install prototype hardware platform into an existing exoskeleton system. 3. Demonstrate that the design i) is functional, ii) meets or exceeds the performance of an existing system through the collection and analysis of device performance data, and iii) reduces the size of an existing platform. 4. Identify possible improvements of the proposed hardware platform through testing.

4

1.3 AUTHOR'S CONTRIBUTION
The following contributions were made towards the main objective: 1. Performed an in-depth literature review of the existing medical lower body exoskeletons, PCB layout techniques and embedded design principles. 2. Collaborated with the ARKE team at Bionik Laboratories to develop hardware for prototype exoskeleton platform used for baseline performance; verified and validated design, then deployed controller in four ARKE systems for medical trials at rehabilitation centres in Ottawa and Montreal. 3. Clinical and engineering feedback was gathered over eight months of medical trials to revise the design, incorporating additional functionality and increasing the resilience. 4. Developed, fabricated and tested revised platform design in ARKE system. 5. Gathered performance data, performed analysis on results in MATLAB and translated observations into suggested features for future revisions.

5

1.4 THESIS LAYOUT
The following chapters are organized as follows:



In Chapter 2, a detailed overview of the existing exoskeleton and how it works is provided. A preliminary design used for the command and data handling subsystem of the device is presented as the baseline for performance. The existing controller was analyzed for its shortcomings to improve upon the design. The improved design is presented, with focus placed on improving resilience and extensibility of the platform.



Chapter 3 presents the validation process for assembling a unit of the improved design. A unit is assembled and tested prior to insertion into the system for performance evaluation.



Chapter 4 presents the experiment used for gathering performance data, as well as the methodology behind data collection and post-processing.



Chapter 5 contrasts the results of the Preliminary design with the Integrated, and a size analysis is performed on the two designs.



Chapter 6 presents the conclusions of the thesis, and proposes improvements to the design, recommendations and future works.

6

1.5 BACKGROUND
The following background is provided to give insight into the current state-of-the-art design of lower body orthoses and the operational theory, including the emulation of walking kinematics. Several exoskeletons that are currently used in clinical settings are discussed in Section 1.5.1. 1.5.1 State of the art

In Canada and the United States, medical devices such as these orthoses are subject to regulatory compliance before authorization for sale. The governing bodies for these countries are Health Canada and the FDA, respectively. Examples of Health Canada or FDA approved lower body orthoses are the ReWalk Personal (ReWalk Robotics, shown in Figure 1.1a and b) [16], Indego (Parker Hannifin, Figure 1.1c) [20] and Ekso GT (Ekso Bionics, Figure 1.1d) [21]. These orthoses are intended for clinical use, and, in the case of the ReWalk and Indego, also for home use. Each orthotic follows a common mechanical design, consisting of a fitted metal frame with a computerized control system worn on the user's trunk. Fabric padding is provided for user's comfort and to minimize skin abrasion. Similarly, each orthotic uses a symmetrical four-axis arrangement to implement walking trajectories along the sagittal plane. Whereas the hip is a spherical joint with a complicated six degrees of freedom (DOF) range of movement, these devices approximate the motion using single revolutionary joints due to the difficulty of reproducing this range of motion robotically. The loss of these DOF is not necessary to approximate walking.

7

(a)

(b)

(c)

(d)

Figure 1.1: (a) ReWalk Personal (ReWalk) front [22], (b) ReWalk Personal rear [22], (c) The Indego (Parker Hannifin) [23], (d) Ekso GT (Ekso Bionics) [24].

8

These orthoses perform sit-to-stand and stand-to-sit motions which allow users with varying levels of hemiparesis or paralysis to stand and walk over level ground. Some orthoses, such as the ReWalk, can also navigate stairs. Figure 1.2 shows a typical sit-to-stand motion. It should be noted that the user is reliant on a pair of crutches for maintaining balance and navigating while inside the orthotic. These orthoses, therefore, are not intended for individuals with upper extremity disability.

Figure 1.2: Sit to Stand and Stepping in a lower body exoskeleton (from Ekso Bionics and [25])

To allow for free roaming in clinical and neighborhood settings, these orthoses are powered by rechargeable batteries which allow for several hours of use. Two means of user input are generally provided by each orthotic. The first is control from an external apparatus, such as a wireless controller (ReWalk, shown in Figure 1.3a), tethered remote (Ekso GT), or smartphone application (Indego). The second is via the use of onboard

microelecromechanical (MEMS) sensors which detect angular and translational displacement and forces of the orthotic. Rueterbories et al. in a study of various orthoses conclude that the most common types of sensors found are accelerometers typically in combination with gyroscopes, with little criticality as to the positioning of the sensors in the device [26]. These sensors determine user
9

intent via means ranging from binary thresholding of these sensor values to complex multi-sensor algorithms. An example of accelerometry being used to determine walking intention is shown in Figure 1.3b. By measuring tilt, an orthotic can detect the user's center of gravity (COG) shifting onto the stance leg, which, in healthy gait, precedes the motion of the swing leg. This can be used to trigger the leg motion of the orthotic. Other orthoses, such as the Cyberdyne HAL, use ground forces to detect user intention [27]. Many other methods exist, however the choice of sensor should emphasize reliability, minimizing components and size, and user acceptance [26].

(a)

(b)

Figure 1.3:a) Manual control of a lower limb orthotic, such as the wristwatch-like controller for the ReWalk (adapted from [28], and b) Automatic control of a robotic orthosis using body tilt to sense walking intention

The user characteristics and weights for the ReWalk, Ekso GT and Indego are listed in Table 1.2. These orthoses are designed to suit most of the population, either by being adjustable (such as for shared devices in clinical settings) or built personalized to each user. Parameter User Height Range User Weight Range Device Weight SCI Level: ReWalk 5'3" (160cm) - 6'3" (190cm) Up to 220lb (100kg). Appx. 50lb (23kg) T4 or lower Ekso GT 5'2" (157cm) - 6'2" (188cm) Up to 220lb (100kg). Appx. 50lbs (23kg) C7 or lower Indego 5'1 (155cm) - 6'3 (191cm) Up to 250lbs (113kg) Appx. 26lb (12kg) C5 or lower

Table 1.2: Comparison of FDA approved lower body exoskeletons

10

The approximate cost of these orthoses are $100,000USD each with an expected lifespan of 5 years [16]. 1.5.2 Efficacy of Robotic Orthoses

The therapeutic benefits of bionic rehabilitation are presently the subject of intense study. Arazpour et al. [29] have summarized the medical studies on the efficacy of orthoses and generally found improved gait pattern and walking speed and reduced energy consumption. This is concurred by Benson et al. [30]. Kressler et al. [31] demonstrate reduced pain intensity with orthoses. Murtagh [16] found that lower body robotic orthoses are generally well tolerated with no serious adverse events reported for the devices. 1.5.3 Gait Cycle and Walking

Walking involves the intricate coordination of different muscles and joints coupled with sensory feedback used by the nervous system to correct disturbances or deviations from intended movement [32]. Walking, from a neurology perspective, consists of i) voluntary activation of the somatic nervous system with the intent to walk, ii) activation of the central nervous system and propagation of signals to muscles in the extremities, iii) muscle contraction, and iv) generation and regulation of muscle forces and joint torques [32,33]. A person's manner of walking is known as gait. The cyclic process of upright body locomotion is known as the gait cycle [34]. Biomechanically, pathology-free gait consists of bilaterally symmetrical swing and stance phases occupying 40% and 60% of each gait cycle, respectively [15]. These phases overlap with the swing phase for one leg starting during the stance phase of the other. A gait cycle can also be further broken down into the following phases: Heel Strike,

11

Foot Flat, Mid-Stance, Push-Off (also referred to as Heel-Off), Toe-Off and Mid-Swing [34Â­36]. Figure 1.4 illustrates a gait cycle. In addition, a gait cycle can also be divided into single support (when only one foot is in contact with the floor) and double support (when both feet are in contact with the floor) phases.

Figure 1.4: The Gait Cycle (adapted from [37])

1.5.4

Forward Kinematics and Trajectory

The trajectory of the lower body during the gait cycle has been extensively modeled by researchers like Hogan [38]. These models are used as a reference for approximation of human walking by lower limb orthoses. First consider the lower body in the sagittal plane. Without loss of generality, consider the joint angles of one leg since the body is bilaterally symmetric. Figure 1.5 shows the geometry of the hip, knee and ankle. Zoss et al. [12] and Moore et al. [39] use the convention of defining the nominal (zero) angles for the hip ( ), knee ( ) and ankle ( ) to be such that the vectors from the shoulder to the hip, the hip to knee, knee to heel, and heel to toe be collinear.

12

Figure 1.5: Leg geometry and reference angles for hip, knee, ankle [12]

Based on this convention, the corresponding joint angles for a typical leg over a pathology-free gait cycle in the sagittal plane are shown in Figure 1.6, from [39].

13

Figure 1.6: Sagittal joint angles for Hip, Knee and Ankle. Red line: unperturbed. Blue line: perturbed. The shaded boundary is 3. [39]

There are numerous methods for implementing the trajectories shown in Figure 1.6. One involves splines, numeric functions defined by piecewise polynomial functions, to generate a smooth trajectory [40]. This requires large computational overhead since only the parameters are stored and trajectory data are synthesized at runtime. However, this method has the benefit of being more flexible to online modification, such as to scale trajectories for different user proportionalities. A simpler albeit less flexible method is to store sample values in a lookup table (LUT) at the sampling frequency of the trajectory. This involves less computational overhead at the expense of reduced runtime flexibility (i.e., more difficult to modify), and greater memory consumption. However,

14

several robots such as in [41, 42] combine the lookup table approach with genetic algorithms to create evolutionary device behavior. In addition, memory usage can be mitigated by minimizing the number of samples required to store the trajectory through means such as linear interpolation. Whether the trajectory data are computed or pre-calculated and stored, smooth motion is essential for the proper mobility of these orthoses. Slow control loops result in jittery motion, which would be unsuitable for the end user. One generally sought minimum control loop frequency for smooth actuator control is 1 kHz. This is used by Boston Dynamics' BigDog [43] robot and others, such as in [44, 45]. Figure 1.7 shows an example curve sampled at various points along the cycle. In the LUT approach, the samples shown would be stored in contiguous memory. In the spline approach, these would be calculated based on the polynomial coefficients and a time parameter. These samples are passed onto the servomotor controller as the desired position setpoint for the given instant in time [46]. The resolution as to which these samples are stored or calculated is chosen based on the range of movement and mechanical resolution of the actuator and feedback mechanism. In Figure 1.7, 8bit resolution is shown, represented in hexadecimal. An unsigned 8-bit value can take on values ranging from 0 to 255. For an actuator with a 180 degree range of motion, this corresponds to 0.70Â°/LSB.

15

Figure 1.7: Sampling of an arbitrary curve. The position (angle) of the corresponding joint has been normalized to 8-bit resolution (0 to 255)

1.5.5

Motor Control

A servomotor is an actuator coupled with a feedback mechanism and controller which allows for precise control of position or velocity [47]. While servomotors may be AC or DC powered depending on the motor type, brushless DC motors (BLDCs) are popular in robotics since their construction lends themselves to fine positional control, and they require less maintenance and have greater efficiency than their brushed counterparts. One common interface for positional control off-the-shelf servomotor drives is pulse-width modulation (PWM). In this configuration, the position of the actuator is mapped to the duty cycle of a control signal, as shown in Figure 1.8. The trajectory is executed by varying the duty cycle over time. For an 8-bit resolution PWM signal (such as the one used in Figure 1.7) the value `0' maps to a duty cycle of 0%, `128' (`80' hexadecimal) maps to a duty cycle of 50%, and `255' (`FF' hexadecimal) maps to a duty cycle of 100%.

16

PWM modules are common peripherals on modern microcontrollers, and these waveforms can be generated by loading a register with the desired positional value. Different interfaces such as RS232, RS-485 and EtherCAT also exist where these set point values are transmitted in a digital frame to the servomotor drive. Unlike PWM, which is unidirectional, these interfaces allow for bidirectional communication. The benefit of bidirectional communication is that it enables multiloop control and linear-parameter-varying systems (providing that the loop is sufficiently fast) since the servomotor data can now be read back by the main controller.

Figure 1.8: Illustration of PWM control of servomotor. The actuator has a 180Â° range of motion. Adapted from [48].

The controller for the servo provides the commutation sequence to move the motor to the desired position. Depending on the complexity of the drive, this may allow for PID routines.

17

2 PLATFORM DESIGN
2.1 INTRODUCTION
This chapter will discuss the theory and operation of a lower body exoskeleton, as well as the details of the designs of two hardware platforms used to run the main application firmware. The first design (the "Preliminary" design), is analyzed and used as a basis for the development of the second, successor platform, the "Integrated" design).

2.2 COLLABORATIVE WORK WITH BIONIK LABORATORIES
This research was part of a joint initiative conducted between Ryerson University and Bionik Laboratories Inc., a medical devices company based in Toronto, Canada and Ryerson DMZ alumnus. This collaboration granted access to a medical exoskeleton (The ARKE) as a hardware platform to test and verify research. In addition, this collaboration also included the deployment of ARKE units for medical study at The Ottawa Hospital Rehabilitation Centre (TOHRC) and the Institut de rÃ©adaptation Gingras-Lindsay-de-MontrÃ©al. In addition to the two controller designs that were produced from this collaboration, many of the design constraints and requirements for the system and controller were developed in collaboration with the ARKE team. The Preliminary design was placed inside four ARKE units and deployed for medical study. Performance data and feedback were gathered from study participants and development team over the span of approximately 8 months.

18

2.3 THE ARKE
The ARKE Generation 2 (Figure 2.1) is a fully-assistive lower body exoskeleton in clinical research and development. The device is composed of adjustable padded linkages that cradle the user. The device has four motorized axes, two at the hips and knees, which actuate them along the sagittal plane. Two passive, spring loaded joints at the ankle provide flexion and extension and support the device which weighs approximately 34kg. The system is powered by a removable lithium-ion battery pack, allowing untethered operation over environments with smooth terrain [49]. The device features adjustable trajectories based on user parameters such as leg length and hip width, walking and individual stepping modes, sit-tostand, stand-to-sit, and patient or therapist triggered stepping. The device is wirelessly commanded with a Windows-based tablet running proprietary ARKE control software, intended for use by a clinician or therapist. This tablet provides an API for data logging which is used for patient and engineering analysis. Additional user interfaces include:  MEMS sensors to measure the device attitude and forces which are used for the detection of walking intent   A speaker for audio cues Foot sensors for ground contact detection

Brief overviews of the firmware and control tablet follow. This is provided for context to the hardware implementations described in this chapter.

19

Figure 2.1: The ARKE Generation 2.0 Exoskeleton [49]

20

2.3.1

Firmware Overview

A simplified version of the device state machine, shown in Figure 2.2, defines the high-level operation of the system.

Figure 2.2: ARKE Simplified State Machine

The corresponding states are listed as follows:  Pre-Connect: The device enters this state when first powered on or reset. The device sits idle waiting for the tablet to initiate a connection.  Set Parameters: Upon successful handshake with the tablet, the device automatically downloads the device and session parameters.   Homing: The device self-tests its actuators, aligns its axes, then moves to a seated position. Sitting: The device idles in a seated state. This is the position in which the user dons and doffs the device. The device stands when triggered by the operator (sit-to-stand motion).  Standing: The device is upright. At this time, the operator may manually trigger stepping or enable patient control which uses the onboard inertial measurement unit (IMU) to

21

determine the walking intention of the user. The device then initiates a stride under the following conditions: 1. A command to step from the operator, in clinician control mode 2. The device tilt exceeds the minimum threshold set for the user, in patient control mode Alternately, the device may be commanded by the operator to sit without initiating any walking sequence, such as to practice standing and sitting technique.  Left/Right Step: The device executes a planned stepping trajectory for the corresponding leg. After completion of the stride, the system waits for user or operator input, then proceeds with the alternate leg. At the end of the exercise, a "stop" instruction brings the legs into alignment, and the device may then be seated or another walking session commenced. Note that the operator may switch modes arbitrarily; for example, the operator may begin a session by manually triggering steps, then hand off to the user for control, then take over if the user requires additional assistance. Once the user has been seated at the end of the walking session, the operator finishes the session from the tablet which places the device into idle until a new session is initiated. At this time, the device may be powered off. 2.3.2 Application Overview

The operator interface and control of each ARKE device is performed via a Windows-based tablet running PatientProfile, a companion software for the device. PatientProfile configures the device and provides a touchscreen for operation. The sequence of a typical therapy session is shown in Figure 2.3. The operator first powers on the tablet, starts PatientProfile and retrieves the user profile. Settings, such as user dimensions, walking speed, and tilt sensitivity are loaded and

22

transferred to the device upon connection. Once the user dons the device, the operator commences the walking session by bringing the device and the patient to the standing position. In standing position, the operator is presented with the screen shown in Figure 2.4, allowing the choice of operating mode. The walking session then continues as described in the device state machine. In addition, PatientProfile tracks performance data for the device during the walking session and logs to a local database. The tablet API is further discussed in experimental data collection in Section 4.4.

Figure 2.3: Flowchart showing typical therapy session with device.

23

Figure 2.4: Walking Interface on Control Tablet [49]

2.4 PRELIMINARY DESIGN
The preliminary logic board design was co-developed in 2015 with the ARKE team and was used to determine baseline performance for a fully-assistive lower body exoskeleton. Shown in Figure 2.5, the design used a custom interface board to modularly connect consumeroff-the-shelf (COTS) subsystems for the microcontroller, wireless, and IMU modules. These are detailed below. Logic power for the system was supplied by an external module adjacent to the logic board. This is shown alongside the fully assembled logic board in an early version of the system chassis in Figure 2.6.

24

Figure 2.5: Top view of Preliminary logic board

Figure 2.6: Preliminary logic board in-situ with additional hardware components

The logic board was responsible for the top-level command and data processing tasks for the system. Shown in a simplified system block diagram (Figure 2.7), the logic board interfaced with

25

discrete servomotor drives and system control peripherals, such as foot sensors for ground contact detection.

Figure 2.7: Block diagram of exoskeleton system with Preliminary logic board.

2.4.1

Microcontroller

The microcontroller on the logic board needed to perform the following tasks:    Store and interpolate trajectory data for multiple user proportionalities Implement the device state machine Interface with local system control peripherals, such as speakers, temperature sensors and foot sensor modules

26

  

Send and receive commands and data to and from the control tablet Send commands to and receive data from four brushless servomotor drives Read and filter IMU data

A COTS microcontroller module, the Texas Instruments Tiva C-series Launchpad, was chosen due to having sufficient GPIO, RAM and Flash to implement these interfaces as well as its adequate computational power (100DMIPS) [50] for these tasks and support for TI-RTOS [51]. The Tiva Launchpad is a general purpose evaluation kit featuring two headers for expansion modules ("Booster Packs"); a Tiva TM4C-series microcontroller using ARM Cortex M4 architecture, and an integrated USB JTAG emulator [52]. The decision to use the Launchpad system allowed for the flexibility to swap the microcontroller out with another Launchpad (such as the CC3200 or TM4C129x series microcontroller) if necessary, without having to redevelop the interfacing electronics. 2.4.2 Wireless Interface The wireless interface of the system serves two functions: first, for receiving commands from the controller, and second, for streaming data. As shown in Figure 2.5, the design featured a 10x2 pin hardware socket commonly used by COTS RF modules such as XBee. In addition, many WiFi and Bluetooth modules use this socket. Bluetooth was chosen for point-to-point interoperability with standard end consumer hardware, such as tablets, phones and laptops, and the selected module was the Roving Networks RN42-XV [53]. The RN42XV module reliably supports virtual COM port operation over a UART interface at 115.2kBaud which was sufficient for the bandwidth requirements of the data. The advantage of these modules is that the communications overhead is offloaded from the main microcontroller, obviating the need for implementing a wireless stack.

27

2.4.3

IMU

Device attitude and acceleration were measured through a pair of MEMS sensors connected to the main microcontroller via I2C. These were:

 An InvenSense ITG-3200, a 3-axis gyroscope  An Analog Devices ADXL345, a 13-bit resolution 3-axis accelerometer with
programmable sensitivity ranges between Â±2g and Â±16g These devices were suitable due to their high resolution, low power consumption, and software support. 2.4.4 Servomotor Drives

The exoskeleton used four independent servomotor drive modules to drive the system's four custom non-backdrivable rotary actuators with built-in position encoders. These drives featured:  Onboard PID control, allowing the control task to be offloaded from the main application host    Voltage and current limiting In-depth status reporting (position, voltage, current, etc.) and RS232, RS-485 and PWM interfaces

These drives were mounted on a custom mounting card housed in the lower compartment of the system chassis. The logic board provided the trajectory information to the drivers over PWM and collected measurements over RS-485. RS-485 was chosen for data collection due to its multi-point addressing capability, necessitating only one transceiver for all four drivers, its industrially-robust

28

noise-rejecting differential, balanced twisted-pair design [54,55], its low cost, and its sufficient bandwidth to gather a snapshot of system data at a minimum of 50Hz. PWM was chosen for sending setpoint commands since each drive had a dedicated channel. Unlike RS-485, it involved no data frames or time-division multiplexing which would incur latency. This allowed the system to operate at the standard 1 kHz control loop required for smooth movement. The PID parameters of these drives were tuned either in an external jig or in-situ via an RS-485 cable to a PC running the OEM configuration software for the drives. Overdamping was a requirement in order to maintain smooth operation and minimal vibration. These drives were rated for peak current of 60A and were supplied with the nominal battery voltage, 48-60V DC. To protect the drives and actuators, the current was set to limit to 30 amps. These currents are possible during motor stall events such as a toe-strike or during sit-to-stand or standto-sit motions. 2.4.5 Summary of Preliminary Design

The Preliminary design performed generally well and its modular design successfully allowed rapid prototyping and development. By using COTS parts and interfaces, system parts could be easily and quickly serviced, swapped, and purchased with short lead-times. Human medical trials of four ARKE units with the Preliminary design commenced at the end of 2015. There were no failures of the prototype boards during the medical trials and, as of writing, the boards remain inservice.

29

2.5 SHORTCOMINGS OF PRELIMINARY DESIGN
The following observations were made about the Preliminary design. 2.5.1 Resilience

The Preliminary design relied on friction fit connections to hold the MCU and Bluetooth modules in position. Given that the typical operating environment of an exoskeleton exposes internal electrical components to harsh mechanical shock, it is expected that these connections fail over time. While this was not a problem in practice, the lifespan and durability of the board can be increased by eliminating these connections and other points of fatigue. 2.5.2 Extensibility

The Launchpad did not expose all available GPIO on the microcontroller. At any given time, only 34 of the 43 GPIO could be used [50, 56]. This limited the ability to expand the platform with new peripherals or functionality. The typical workaround for this was to conjoin several MCUs and/or mainboards together with wires, which created challenges for maintaining signal and power integrity across the PCBs, often manifesting as weak or unreliable connections. Placing the microcontroller directly into a new design would grant access to these GPIO, which would consist of a 26% increase in interfacing capability without changing the part or requiring a port of the firmware.

30

2.5.3

Signal Integrity

The stacked arrangement of PCBs in the Preliminary design created interconnected ground planes in 3D space. This resulted in multiple paths (loops) for current to flow and therefore added noise caused by electromagnetic induction. Recall the Maxwell-Faraday Equation [57]:      (2.1)

 =     = - 


which states that a time-variant magnetic field, such as those produced by external radiators, will produce a spatially-variant electric field, i.e. noise. The effect of the noise is proportional to the size of ground loops. Thus, it is preferable to minimize loop areas as much as possible in order to mitigate the effects of external radiators on the circuit. While digital circuitry is generally immune to this noise, analog circuitry remains susceptible, and is not desirable for high speed or resolution signals. This is concurred by [58] and [59]. The stacked design is therefore not preferable for signal integrity. In addition, the stacked design adds challenges to controlling emissions to meet RF certification. The ability to add RF shielding is made less practical by the stacked design due to the additional height and volume of electronics. Another consideration is that by separating the ground planes, impedance is added, resulting in larger supply and ground fluctuations with changes in current than a continuous i.e. low-impedance ground plane since   =    for constant  . (2.2)

31

2.5.4

Power Architecture

The Preliminary design used a 20W monolithic switching regulator providing a single trimmable output between 5.0 and 5.5V. This was set to 5.4V to meet the minimum voltage requirements for logic on the motor drivers and system logic board. This was regulated down to 5V with an LDO on the logic board, and a 3V3 LDO on the Launchpad. This regulator provided all logic power for the system. During medical trials it was observed that the design was prone to resetting during high-torque events such as sit-to-stand, stand-to-sit and toe strikes, particularly for larger users. It has been shown [60] that the torque  for a 3 phase symmetrical brushless DC motor can be expressed as
2  = |2  | 

 =

(2.3)

where  ,  , and  are the back EMF of each phase, current of each phase and rotor speed, respectively. Since    , when  was maximum or changed rapidly, a high or rapidly changing current was observed on the primary DC bus as the motors attempted to maintain a mechanical steady state. This caused the primary DC bus voltage to spike or sag, which exceeded the line regulation capability of the 5.5V regulator which was supplied from the same bus. When the primary regulator output voltage fell below the minimum supply voltages of the downstream regulators and logic, the system lost state and reset. Sudden resets pose risks of user injury since the user does not expect a sudden stop during movement. In addition, it may be difficult for the user to maintain his/her balance in the position the device has stopped at, and the system must return to a known good state with the user inside the device.

32

2.5.5

Design Conclusions for Preliminary Design

A new platform integrating the modular components onto one PCB would solve the issue of mechanical reliability, increase signal integrity, and provide an opportunity to redesign the power architecture, add new functionality and reduce assembly complexity and size of the platform. This work is undertaken in Section 2.6. The differences between the two design approaches are outlined in Table 2.1. Modular/COTS
Mechanical Reliability Power Integrity Signal Integrity EMI Compliance Size Added connectors for internal interfaces increase possible points of failure Planes and regulators split across numerous PCBs. Inadequate line regulation with existing solution. Vulnerable to noise from external radiators due to ground loops from stacked arrangement. Large signal loops also behave as external rad Stacked arrangement adds difficulty for RF shielding. Constrained by design of COTS parts. Low upfront development costs. Large ongoing costs due to margins associated with intermediary parts.

Integrated
Limited to external connectors only Contiguous power plane and ability to place regulators where desired. Ground loops minimized via singular PCB arrangement. Easier to add in RF Shield on single-plane PCB. Arbitrary. Can choose smaller footprints. Limited primarily by assembly complexity. Large upfront development costs and turnaround times. Better value is obtained through amortizing costs over large production runs. Drop-in ready.

Remark
Integrated preferred. Integrated preferred.

Integrated preferred.

Integrated preferred.

Integrated preferred.

Cost

COTS preferred for prototyping; Integrated preferred for production

Assembly Extensibility

Requires component Integrated preferred for subassembly before system production. installation. Launchpad only exposes 34 All 43 GPIO made Integrated preferred. GPIO, high GPIO available; can use additional utilization means limited GPIO for expansion. extensibility
Table 2.1 Comparison of Modular vs Integrated designs

33

2.6 THE INTEGRATED DESIGN

In this section the Integrated Design is introduced, starting with the requirements. The power and logic subsystems of the board are then presented and discussed in detail. The fabrication-ready design is shown. A full schematic representation of the Integrated design is attached in Appendix C. 2.6.1 2.6.1.1 Design Requirements System Compatibility

The Integrated design must be mechanically and electrically compatible with the Preliminary design. This is necessary so that it can be fitted as a drop-in replacement for performance evaluation and comparison. 2.6.1.2 Sizing and Placement of Components

Due to the low production requirements of this design (3 units), hand-assembly needed to be feasible. Generally speaking, the costs of low-volume machine assembly are prohibitive. The components were therefore selected and laid out for easy hand-placement and reflow using the basic tools available in the lab: a microscope, an IR oven, a soldering iron and a hot air gun. This limited passive sizes to 0603 footprints or larger and restricted the use of BGAs, no-lead ICs or other fine-pitch components where possible. The two exceptions to this were the gyroscope and accelerometer which were unavailable in larger packages. Choosing hand-reworkable components also reduced the tolerance requirements for the PCB vendor, which in turn reduced the cost of the PCB.

34

Thermal reliefs were added to components connecting to large copper pours to ensure adequate reflow. This eliminated the main risk of having uneven copper pads, whereby during reflow one pad reflows before the other, causing the component to shift or lift off the board at an angle, in a process known as "tombstoning." Whereas the Preliminary design schematic and layout were performed in Eagle CAD 7.2, the schematic and layout of the integrated PCB were performed in Altium Designer 15. The decision to change the design tool was made based on the better ease-of-use and greater feature set of Altium, specifically the 3D modelling capabilities and online DRC. Altium's 3D modelling capability allowed the design to be integrated into Solidworks MCAD to verify that the boards were mechanically compatible with the system chassis. 2.6.1.3 Requirements Tables

The requirements for the Integrated design are summarized in Tables 2.2 to 2.6.

Device Requirements: ID DEV1 DEV2 DEV3 DEV4 DEV5 DEV6 Requirement The device shall perform stand-to-sit, sit-to-stand and walking motions The device shall communicate wirelessly to the device controller The device shall record performance data and transmit them to device controller The device shall monitor attitude and acceleration The device shall monitor the temperature of heat generating components The device shall be extensible and reconfigurable Origin Proposal Proposal Proposal Proposal Proposal Proposal Verification Method Design Design Design Design Design Design

Table 2.2: Device-level requirements for Integrated Design

35

Mechanical Requirements: ID MEC1 MEC2 MEC3 MEC4 MEC5 MEC6 MEC7 MEC8 Requirement The design shall be mechanically compatible with the existing device The design shall be implemented on single PCB The design shall be robust The design shall be designed to survive typical mechanical shocks The design shall be low cost The design shall be small The design shall be capable of being hand assembled The design shall use 10 mil trace-space layout rule Origin Proposal Proposal DEV1 DEV1, MEC3 Proposal Proposal MEC5 MEC5, MEC7 Verification Method Design Design Design, Test Design Design Design Design Design

Table 2.3: Mechanical Requirements for Integrated Design

Design Communication Requirements: ID Requirement Origin Verification Method Design, Test Design, Test Design, Test Design, Test Design, Test Design, Test Design, Test Design, Test Design, Test

COM1 The design shall communicate to host tablet using DEV2 Bluetooth 2.1 + EDR COM2 The Bluetooth 2.1 module shall support serial port profile DEV2 with virtual COM port at a minimum baudrate of 115,200bps COM3 The Bluetooth module shall be programmable in-situ COM1, MEC2 COM4 The Bluetooth module shall be factory resettable with an COM1, external jumper MEC3 COM5 The Bluetooth module shall advertise with a beacon COM1, when powered DEV2 COM6 The Bluetooth module shall radiate RF energy away from Proposal the user as much as possible COM7 The design shall communicate to the servomotor drivers MEC1 via single full-duplex RS-485 COM8 The RS-485 link shall sustain a minimum baudrate of COM7 921,600 bps COM9 The design shall be capable of operating the device using DEV6, local interface(s) MEC2,
Table 2.4: Communication Requirements for Integrated Design

36

Power Requirements: ID PWR1 PWR2 PWR3 PWR4 PWR5 PWR6 PWR7 Requirement The board shall have a power supply The power supply shall power all internal system components The power supply shall accept the nominal battery voltage (40-70VDC) The power supply shall output 3.3V Â± 100mV The power supply shall output 5.0V Â± 150mV The power supply shall output 12V Â± 2V with 400mA minimum ampacity The power supply shall provide a field-trimmable power independent supply rail between 3.3V and 9V Origin MEC2 MEC2 MEC2, PWR1 PWR2 PWR2 PWR2 DEV6 Verification Method Design Design Design Design, Test Design, Test Design, Test Design, Test

Table 2.5: Power Requirements for Integrated Design

Processing Requirements: ID CPU1 CPU2 CPU3 Requirement The microcontroller shall have sufficient onboard memory to store trajectory data The microcontroller shall be compatible with and use the existing code-base The microcontroller shall have an interface for coprocessor or FPGA extension Origin DEV1 DEV1 DEV6 Verification Method Design Design Design

Table 2.6: Processing Requirements for Integrated Design

37

2.6.2

Power Architecture

A new power architecture was developed for the Integrated design to resolve the regulator dropout issues observed in the Preliminary design. As per the requirements, the power subsystem would be integrated onto the PCB, providing regulated battery power for all system logic. Increasing the voltage of switching regulator output was necessary to prevent the voltage ripple at the input from affecting downstream regulators. The choice of voltage was a compromise between compatibility, flexibility, footprint and heat. 12V was chosen to provide sufficient input margin, as well as for compatibility with the motor drivers and general industry. This was fed into cascaded regulators for supplying logic. An adjustable power supply unit, the PPSU, is provided and further described in 2.6.2.2. The block diagram of the power architecture is shown in Figure 2.8, detailing each component powered by each rail.

Figure 2.8: Power architecture of Integrated Design

38

To drive the design of regulators for each rail, the worst-case current draw and power figures were considered for each component. This is tabulated in the power budget for the system in Table 2.7. In practice, the current consumption will be less due to the low duty cycle of some components; the average current consumption is expected to be 66-70% of the worst-case figure.
Peripheral Microcontroller Bluetooth IMU RS485 Transceiver LEDs and Buttons Miscellaneous 3.3V Rail Total Rail 3.3V 3.3V 3.3V 3.3V 3.3V 3.3V Current Draw 58.7 mA 50 mA 7 mA 20 mA 10 mA 20 mA 165.7 mA 20 mA 10 mA 20 mA 215.7 mA 100mA 250mA 565.7 mA Power 194 mW 165 mW 23 mW 66 mW 33 mW 66 mW 547 mW 282 mW 100 mW 50 mW 100 mW 1.08W 1.51 W 600mW 600mW 3W 6.79W 2.91W 9.70W

3.3V LDO Power Dissipation Buzzer 5V LED 5V Miscellaneous 5V 5.0V Rail Total 5.0 LDO Power Dissipation PPSU Rail Total (Adjustable) 6V typ. PPSU LDO Power Dissipation Motor Drivers 12V 12V Rail Total (Total System Current Consumption) 12V Converter Power Dissipation (Estimated 70% efficiency) Worst-Case Total Power Consumption:

Table 2.7: Power Budget Table for Integrated logic board.

Two key architectures of DC-DC converters exist: switched and linear. Linear dropout regulators (LDOs) are attractive for being low-cost monolithic solutions for providing supply rails. However, their convenience comes at tradeoff with their relatively poor efficiency compared to switching regulators. Switched converters, in comparison, require a larger footprint, but provide better efficiency, typically in the range of 60-90%. The heat dissipated by an LDO is the product of the output current times the difference between input and output voltages [61]:

39

 = ( -   ) 

(2.4)

Equation 2.4 is used to calculate  for each the regulators listed in Table 2.7. Using Equation (2.4), it can be shown that:             = = = = ( )   +  -   +               (2.5)

 =

Thus, efficiency degrades proportional to the span of the input and output voltages. LDOs are therefore not suitable for designs where large input variances are required. For a 3.3V LDO supplied by 5V and a 5V LDO supplied by 12V, the theoretical efficiencies are 66% and 42%, respectively. Given their relatively poor efficiencies, it is essential to consider the steady state regulator temperatures during design so that chip maximums are not exceeded. The temperature increase of the regulator T corresponds to the product of the dissipated power and junction-ambient coefficient listed in the datasheet: T =   (2.6)

This is added to the ambient temperature to get the final junction temperature T . Heat can be mitigated at the design stage through the placement of copper pours on the PCB, by selecting larger chip footprints, and with the application of a heatsink. For  greater than 12V, the tradeoff between heat and size makes a 5V buck converter design preferable.

40

2.6.2.1

Board Linear Regulators

Three LDOs were selected for supplying the 3.3V, 5.0V and Programmable supply rails. These were the LM3940IMPX-3.3 [62], LM340MP-5.0 [63], and LM317AEMP [64], respectively. Using Table 2.1 and Equation 2.4, alongside parameters found in each of the components' respective datasheets, the thermal performance of each LDO is presented in Table 2.8, showing the selected LDOs are within safe operating limits under worst-case operation. Rail 3.3V 5.0V Part LM3940IMPX-3.3 LM340MP-5.0  worst-case .282W 1.51W .600W  worstcase 59.3/ 62.1/ 59.6/ Die Max T worst-case (at 25 ambient) Temperature 41.7 125 118.7 60.7 150 125

PPSU LM317AEMP

Table 2.8: Heat analysis of LDO regulators of Integrated Design

2.6.2.2 Programmable Power Supply Unit (PPSU) As part of the design's overall philosophy of extensibility, a programmable power supply was added for powering legacy or future peripherals. The schematic representation of this PPSU is shown in Figure 2.9. To leave the application of the power supply as open ended as possible, the PPSU can be configured for operation at voltages between 0 and 10V with the combination of two resistors. In addition to the voltage flexibility granted by choosing to power it from the 12V rail, this topology provides isolation from the 3.3V and 5V logic rails. Should faults or noise occur on this rail, they will not affect the main system logic.

41

Figure 2.9: Schematic Design of PPSU

The voltage is set by the combination of R8 and R10 using the following relation: 10 ) + I (10 ) 8

V = 1.25 (1 +

(2.7)

Figure 2.9 shows the PPSU configured for a V of 5.5V. 2.6.2.3 Switching Regulator Texas Instruments LM5010 [65] is a 1A non-synchronous buck regulator with a maximum input voltage of 75V. The benefits to this regulator include thermal protection, an integrated n-channel switch, undervoltage lockout, and constant switching frequency over load and line variation [66]. While monolithic modules like the one in the Preliminary design exist for 12V, this regulator is able to supply 12V at a substantially lower cost with greater flexibility for part substitution, and, despite requiring approximately 10 external components for operation, the regulator is realized in approximately the same footprint. The schematic representation of the 12V regulator for the Integrated design is shown in Figure 2.10.

42

The voltage of the regulator is defined by the combination of feedback resistors R7 and R9. The enable pin is connected high with resistor R6, however this may be disconnected and controlled by external hardware.

Figure 2.10: Schematic of 12V Buck Converter in Integrated Design

Figure 2.11 shows that the efficiency of the LM5010 regulator at the worst-case current load of approximately 600mA is approximately 75% with a 60V supply.

Figure 2.11: Efficiency vs. Load Current and Vin curves for LM5010 regulator (adapted from [66])

43

2.6.3

Logic Architecture

The design changes to the logic for the integrated version are presented below.

2.6.3.1

MCU, Bluetooth and IMU

The microcontroller, Bluetooth and IMU modules were integrated onto the PCB as part of the requirement to design all electronics onto one board. To prevent any loss of functionality provided by the COTS modules, the schematic of each was analyzed and the matching functionality was included on the integrated design. The equivalent microcontroller to the Tiva C-series Launchpad is the TM4C123GH6PM, detailed below in Table 2.9. Specification Vendor Model Family Architecture Max Operating Frequency Dhrystone MIPS Performance Operating Voltage Max Current Consumption Package GPIO Value Texas Instruments TM4C123GH6PM Tiva TM4C123x ARM Cortex-M4 80 MHz 100 3.3V 58.7mA TQFP-64 43

Table 2.9: Microcontroller Specification [50]

The microcontroller takes advantage of all GPIO from its direct placement on the board. Two user buttons, two user LEDs and a reset button were added to maintain compatibility with the Launchpad. The primary purpose of these buttons was to provide means of interacting with the hardware without the control tablet, such as during unit testing. Two crystal oscillators, one operating at 16MHz and another at 32.768MHz, provide the same clocks to the integrated design as the Launchpad, obviating the need for any code changes.

44

The corresponding module on the RN42-XV Bluetooth module was the Roving Networks RN42, and the Sparkfun IMU fusion board used an Analog Devices ADXL345 and InvenSense ITG3200. To troubleshoot the Bluetooth functionality, two LEDs are provided to indicate the connection status and state (e.g. discoverable, command mode) of the module. As the module is permanently bonded to the board, to recover from misconfiguration, a jumper is provided to restore the factory default settings of the module. For each of the three modules, bypass capacitors were added as per vendor specification in order to maintain power integrity and a low-impedance power source path [67]. 2.6.3.2 Level Shifting Subsystem The Tiva operated on 3.3V logic; however, for several system peripherals, such as the servomotor drives, 5V logic was used. To interface between the two voltages, two level shifting ICs were chosen. For shifting from 5V down to 3V3, the TI SN74LVC4245A [68] octal bus transceiver was implemented; and for 3V3 up to 5V, the TI SN74LV4T125PWR [69] quadruple bus transceiver was implemented. Different chips were utilized due to requiring 6 outputs and 4 inputs, respectively; however, it is possible to also use the SN74LVC4245A for both. The SN74LV4T125PWR was attractive for its smaller TSSOP-14 package. Using the same chip for both purposes reduces the items on the Bill of Materials (BOM) and benefits larger production runs. 2.6.3.3 Expansion Port and Board Level Control Interface To allow for system extension and reconfiguration, several interfaces were included on the board as provisions for new peripherals. This is chiefly accomplished through a dedicated expansion port. Listed in Table 2.10, the expansion capabilities of the board include an 8-bit wide unbuffered port,
45

a dedicated I2C bus and a 3.3V UART console header for local interfacing. These pins may be programmed in firmware to take on any alternate functionality provided by the microcontroller, with the exception of the I2C bus due to the pull-up resistors; these may be used with open-drain logic or de-soldered for general purpose IO.
Connector Â­ Pin CN14-11 CN14-13 CN14-15 CN14-17 CN14-19 CN14-21 CN14-23 CN14-25 CN14-27 CN14-29 CN13-1 CN13-2 Function EXPN0 EXPN1 EXPN2 EXPN3 EXPN4 EXPN5 EXPN6 EXPN7 I2C1 I2C1 TTY TTY MCU Pin PA0 PA1 PD4 PD5 PE1 PF1 PF2 PF3 PB3 PB2 PE4 PE5 Alternate Function CAN ANALOG CAN1RX CAN1TX

UART UART0RX UART0TX UART6RX UART6TX UART7TX

SPI/I2C

MISC

USB0DM USB0DP AIN3 SSI1TX SSI1CLK SSI1FSS T0CCP1 T1CCP0 T1CCP1

(U5RX) (U5TX)

I2C2SCL I2C2SDA

CAN0RX CAN0TX

AIN9 AIN8

M0PWM5 M0PWM4

Table 2.10: Expansion Port and Console Header Signal Mappings

Hardware opportunities for this expansion port include:  Connection to slave microcontrollers or FPGAs for additional processing capability. FPGAs have been used in robotics [10, 70, 71] to eliminate computational bottlenecks.  Communication with additional motor axes via CAN bus or RS-485 via a UART to RS485 transceiver.  GPIO expansion, via slave microcontroller, FPGA, bus expander or direct connection. o This would allow, for example, EMG sensors for robotic control, such as in [7, 72]. o This would also allow for the device to be controlled by local buttons. One general observation about the existing exoskeleton platforms is the lack of redundant controls. The Ekso GT, ReWalk, ARKE, and HAL offer one primary means of

46

control, whether wired or wirelessly. This option would allow for simultaneous wired and wireless control options. o This could also be used to couple instrumented force-sensitive crutches, such as in [73], into the device control system.   Additional MEMS sensors. USB host or slave. o This would provide a high-speed general-purpose wired connection to control devices, human interaction devices, or for non-volatile data storage e.g. USB keys.


Volatile or non-volatile data storage, such as external flash memory.

2.6.3.4 JTAG The Launchpad contained a USB JTAG emulator using a second Tiva TM4C123GH6PM microcontroller [56]. This was used to program and debug the main microcontroller. Since the code for the JTAG MCU was not made available by Texas Instruments, an on-board debugger could not be included in the Integrated design; however, an external header on the Launchpad (Figure 2.12) enabled it to program and debug other targets.

Figure 2.12: JTAG port on Tiva C-Series Launchpad (adapted from [52])

47

It was therefore decided to reuse the Launchpad as a JTAG emulator for the Integrated Design. The full connection is shown in Figure 2.13. Since the Launchpad has regulated 5V and 3.3V rails available, these may be used to optionally supply power to the target board and program it without the main HVDC supply present. Similarly, an external power supply may also be used providing that all voltages are earth referenced. However, in order to avoid power supply contention, power must not be supplied to any rail already energized by an onboard regulator. In addition, the VDD jumper must be opened on the Launchpad to disable power to the Tiva on the Launchpad which prevents a target conflict between the Tivas on the Launchpad and controller board. A connection to TX and RX lines are not required; however, programs which use UART0 for debugging messages will not be able to communicate to the host. The JTAG connection is only necessary for programming and debugging. It may be disconnected during normal operation.

48

Figure 2.13: JTAG Connection to PCB

49

2.6.4 Block Diagrams Figure 2.14 shows the block diagram of the Integrated design, summarizing the onboard functionality.

Figure 2.14: System Block Diagram of Integrated Design

The system block diagram is updated with the Integrated design, shown in Figure 2.15, for comparison with the Preliminary design shown in Figure 2.9.

50

Figure 2.15: Block diagram of system with Integrated Design.

2.6.5

PCB Layout and Model

The PCB layout involved the placement of schematic components and routing of their interconnections. Figure 2.16a and b show a section of the PCB design in Altium as an example containing the microcontroller in 2D and 3D views, respectively. One convenient feature of Altium is its content vaults with premade components for use in designs. However, the usefulness of these vaults is typically limited to passive components and large manufacturers due to the sheer variability of components available. As expected, this design required the creation of custom footprints and models. PCB modelling was undertaken to verify proper dimensioning and fit for components. For ICs, Altium provides an IPC compliant footprint tool for the generation of parts using common packages such as SOIC, TSSOP, TQFP, QFN, etc.

51

For connectors and other parts, the footprints were generated manually and coupled with a vendorprovided 3D model of the part such as in Figure 2.16c. For non-IC parts which did not have vendorprovided CAD models available, the parts were modeled using basic extrusions such as the capacitor in Figure 2.16d.

(a)

(b)

(c)

(d)

Figure 2.16: (a) top left: 2D layout of Microcontroller; (b) example of 3D model of part provided in Altium Vault; (c) examples of 3d models of parts provided by part vendor, (d) example of simple self-modeled part

52

Figure 2.17 shows an isometric render of the finalized layout of the Integrated PCB. The PCB was designed using a standard 4-layer stackup using 1-oz copper on FR4. This is detailed in Appendix A. Four layers were chosen to provide large, low-impedance copper pours for the power and ground planes, and had the most attractive tradeoff between ease of layout and cost. FR4 was chosen due to its suitable thermal performance; while high Tg (glass transition temperature) FR4 materials exist (e.g. isola370), they were deemed unnecessary for the heat dissipation expected of the components. To minimize ohmic losses, the voltage regulators are clustered together, minimizing the distances between output-to-input, and, to provision for a heatsink, the LDOs are placed next to two mounting points. This is in contrast to the Preliminary design where regulators were on separate boards.

Figure 2.17: 3D Isometric view of Integrated Design showing components and system interfaces

53

The dimensions of the bare and populated PCBs are listed in Table 2.11. For populated PCB, the volume was measured as the smallest bounding box that would enclose the PCB. This is listed with the surface area in Table 2.12. Dimension X Y Z X Y Z Value 1250 (490 cutout) 800 (300 cutout) 1.59 12.50 8.00 13.50 Unit

Bare PCB Populated PCB

mm

Table 2.11: Dimensions of Integrated Design

Parameter Surface Area Volume

Value 8530 115200
Table 2.12: Surface Area and Volume of Integrated Design

Unit mmÂ² mmÂ³

2.7 SUMMARY
The operation of an exoskeleton was discussed and the Preliminary architecture for its operation was presented. The drawbacks to the design were discussed from power and signal integrity, extensibility and reliability perspectives, motivating the design for an integrated platform. The design of the integrated platform which remedies these deficiencies was introduced and modelled. In Chapter 3, this design is constructed and verified for operation.

54

3 FABRICATION AND TEST OF INTEGRATED DESIGN

3.1 INTRODUCTION
This chapter presents the steps taken to assemble and test a unit of the Integrated design and the verification process used at all stages of fabrication. This is done to prepare the boards for system installation and data collection discussed in Chapter 4. The results of unit tests will also be discussed.

3.2 VALIDATION METHOD
Three bare boards of the Integrated design were fabricated and one assembled for in-system testing. In order to ensure the proper functionality of the boards prior to placement in the system, the following testing sequence was devised: 1) Design Verification Â­ Verifying that the PCB meets the specification before it is manufactured 2) Vendor Selection Â­ Choosing the supplier for the PCB 3) Bare Board Inspection and Test Â­ Verifying that the bare PCBs were manufactured correctly 4) Assembly Â­ Placing and reflowing the components onto the PCB 5) Post Reflow Inspection and Test Â­ Verifying that the reflow was performed correctly, correcting faults 6) Unit Testing and Integration Â­ Verifying that subsystems work as designed and interconnecting them

55

7) Flashing Â­ Programming the PCB with the production firmware 8) System Integration Â­ Placing the PCB in the system for testing Ensuring that the board is operational is essential for the validity of the experimental data.

3.3 DESIGN VERIFICATION
Prior to manufacturing, the integrated PCB layout was checked for errors which could cause the design to fail, such as insufficient net and component clearances, overlaps and unrouted connections in a process known as the Design Rules Check (DRC). The DRC report and settings are tabled in Appendix A. Unlike Eagle, Altium provided online DRC which highlighted errors as they were made and routed traces according to the set DRC rules. This minimized the number of iterations required before the design had zero DRC errors. The DRC rules were configured to match the requirements for the student discount program of Advanced Circuits, the PCB vendor, in order to minimize rejection by the vendor's CAM department. Specifically, the minimum trace-space clearance was restricted to 10mil each and via sizing was restricted to 15mil minimum diameter with 5mil annular ring.

3.4 VENDOR SELECTION
Advanced Circuits were chosen as the PCB vendor as they were the lowest-cost ISO 9001-2008 fab which could manufacture low volume PCBs to IPC-A-600 Class 2 specification with turnaround times of less than two weeks.

56

3.5 BARE BOARD INSPECTION AND TEST
While the PCB vendor performed a 100% netlist electrical test for isolation and continuity on each board prior to shipment, an independent check of continuity and isolation for select power and signal nets was performed as an additional layer of diligence prior to assembly in order to eliminate manufacturer error should issues arise at later stages of fabrication. The continuity test was performed at an anti-static workstation with a Fluke 87-V multimeter. The bare boards are shown in Figure Figure 3.1 and the results of the tests are listed in Table 3.1.

(a)

57

(b)
Figure 3.1 a) Top side and b) Bottom side of the bare board.

Test Continuity Test on Power and Signal Nets Isolation Test on Ground and Signal Nets
Table 3.1: Results of electrical test on unpopulated PCBs

Result PASS PASS

58

3.6 PCB ASSEMBLY
Following bare board inspection, the boards were assembled. The following steps detail the method used for populating and reflowing each PCB. Assembly was performed at an anti-static workstation with a microscope, IR Reflow Oven (detailed in Appendix B), and PCB reworking tools. Custom stencils (supplied by OSH Stencil), generated alongside the board production files from Altium, were used to apply the solder paste to the pads. 1. The bare PCB was placed bottom-side up on the working surface and the stencil jig was secured tightly to the board edges. The jig was secured to the working surface using Kapton tape. The bottom-side was chosen first since it has a few small components. This approach minimized the risk of the small components falling off when the top-side was reflowed. 2. The bottom stencil was aligned with the PCB under a microscope and fastened to the jig with Kapton tape. 3. Room-temperature 63Pb-37Sn solder paste was spread onto the stencil with a disposable applicator ensuring even deposition on all pads. Note: Leaded solder was chosen for its lower reflow temperature in order to maximize the temperature safety margins to components during reflow. For RoHS compliance, an unleaded alloy paste such as SnAgCu could be substituted. The bare PCBs use an unleaded HASL finish. 4. The stencil was lifted to check the alignment of paste. If the paste was misaligned, the board was cleaned with isopropanol 97%, placed under a realigned stencil and the paste reapplied.

59

5.

Using tweezers and a microscope, the bottom-side SMD components were placed individually.

6.

The PCB was moved to an IR oven and reflowed using an unleaded solder profile. Appendix B describes the oven and the specific settings used.

7.

The PCB was removed from the oven and inspected for defects. The defects were reworked as necessary.

8.

The board was flipped over and steps 1-7 were repeated for top-side SMD components using the top-side stencil. Approximately 2mm height was added to the jig to compensate for the offset height of the bottom-side components. The jumpers connecting the output of each regulator were not populated at this time. These were left unconnected for testing and were applied once it was verified that the regulators were working properly.

9.

All through-hole components were manually soldered using tack flux, 63Pb-37Sn solder wire, and a soldering iron set to 500Â°F.

3.7 PCB POST-ASSEMBLY INSPECTION
The PCB was visually inspected under a microscope for defects that may have developed during reflow such as solder bridges and `tombstoning.' Several defects were found bridging the legs of various ICs together (Figure 3.2a) and one connector was pulled askew during the reflow (Figure 3.2b). These faults were corrected manually with a soldering iron. The PCB was free of tombstoning faults or un-reflowed components.

60

(a)

(b)
Figure 3.2 a) Various solder bridges are present across IC legs after reflow, b) A connector pulled askew during reflow.

Figure 3.3 shows the fully assembled boards. The boards closely resemble the models presented in Figure 2.17.

61

(a)

(b)

(c)
Figure 3.3 a) Assembled top side of PCB, b) Assembled bottom side of PCB, c) Close-up of IMU

62

3.8 PCB POST-ASSEMBLY ELECTRICAL TEST
After visual inspection, the PCB was tested again for isolation and continuity on all power nets and key signal nets with a Fluke 87-V DMM. This stage was done to detect any possible faults that may have been missed during visual inspection. This stage was critical to prevent damage to components when power applied. The test results are shown in Table 3.2. Test Continuity Test on Power and Signal Nets Isolation Test on Ground and Signal Nets
Table 3.2: Results of Post-assembly PCB testing

Result PASS PASS

3.9 UNIT TEST AND INTEGRATION
3.9.1 Initial Power On

At this stage, the assembled PCB was ready for initial power-on. The PCB was connected to the Launchpad as per Figure 2.13 with an external 150mA current-limited earth-referenced power supply providing 3.3V. The Launchpad was connected to a PC installed with two Texas Instruments Software SDKs: 1. Energia, an Arduino-like IDE for quick peripheral unit tests, and 2. Code Composer Studio V6 with TivaWare for advanced debugging and programming. A "blink" program was written in Energia to alternately flash the two User LEDs on the Device Under Test (DUT) every second. Figure 5.2 shows the DUT connected to the Launchpad and external 3V3 power supply running the program.

63

Figure 3.4: Initial programming of the microcontroller. The microcontroller is loaded with the blink program. The LED on the lower left of the board is illuminated and flashes with the adjacent LED.

The main oscillator of the microcontroller was probed using a Tektronix MSO2024B oscilloscope to verify that that the microcontroller was being driven from a correct frequency of   = 16MHz. 3.9.2 Power Supply Verification

Each regulator of the DUT was independently tested before their outputs were connected to their respective power planes on the PCB. This was done to prevent damage to downstream components in the event a regulator did not function as designed. In such case, the defective output could be supplied by an external supply through the external power header. Power was applied using a B&K Precision 9110 DC power supply through the external power header to the inputs of the regulators. For the 12V, 5V and 3.3V regulators, these voltages were 60.00V, 12.00V and 5.00V, respectively. The output voltage was measured without load using a Fluke 87-V DMM.

64

It was discovered during the test that a capacitor was needed for the output of the 12V0 buck converter to function properly. A 1 ohm radial resistor and 22uF capacitor were added in series to ground as shown in Figure 3.5.

Figure 3.5: Reworked Buck Converter

The buck converter was measured on the oscilloscope to verify that the ripple voltage  did not exceed 600mV (Nominal Â± 300mV), shown in Figure 3.6.

Figure 3.6: Output of 12V0 buck converter

65

All power supply tests and their results are summarized in Table 3.3. Test 12V0 rail is 12.0V Â± 300mV (unloaded) 12V0 rail is 12.0V Â± 300mV (500mA load) PPSU/5V5 rail is 5.5V Â± 100mV (unloaded) PPSU/5V5 rail is 5.5V Â± 100mV (150mA load) 5V0 rail is 5.0V Â± 150mV (unloaded) 5V0 rail is 5.0V Â± 150mV (100mA load) 3V3 rail is 3.3V + 100mV (unloaded) 3V3 rail is 3.3V Â± 100mV (150mA load)
Table 3.3: Summary of Power Supply Tests

Result PASS PASS PASS PASS PASS PASS PASS PASS

Voltage was applied using the external power header. Once each power supply was tested and validated, the DUT was powered down and jumpers were soldered to connect the regulator outputs to the logic of the DUT.

3.10 ADDITIONAL PERIPHERALS
3.10.1 Foot Sensors The foot sensors for the device were unit tested with firmware that illuminated a user LED when the corresponding sensor was occluded. This is shown in Figure 3.7.

66

(a)

(b)

(c)

(d)

Figure 3.7 Testing the foot sensors. The left and right LEDs on the board illuminate when their respective foot sensor is occluded. a) Both sensors open, b) Left sensor occluded, c) Right sensor occluded, d) Both sensors occluded.

The test results are summarized in Table 3.4. Test LED0 asserts only when left sensor is occluded LED1 asserts only when right sensor is occluded
Table 3.4: Summary of Foot Sensor Unit Test

Result PASS PASS

3.10.2 System Control It was also necessary to test the Emergency Stop and System Power LED functionalities before placement in-system. To test the Power LED, the LED was connected and the nominal input voltage was applied to the board. The voltage at the anode of the LED was observed on an
67

oscilloscope. The status of the LED was required to match the presence of input power to the board. To test the Emergency Stop, the button and relay were both connected to their respective points on the board and the resistance of the relay was measured for both states of the button. The results are listed in Table 3.5. Test Pressing the Emergency Stop deactivates motor power Releasing the Emergency stop reactivates motor power System power LED is on at all times when power is engaged System power LED turns off within 500 ms when power is disengaged
Table 3.5: Summary of System Control Unit Tests

Result PASS PASS PASS PASS

3.10.3 Bluetooth Configuration In the Preliminary design, the Bluetooth module was connected by a standard 10x2mm socket typically used by 802.15.4 radio modules and could therefore be programmed using any standard USB to 10x2 pin adapter or USB to TTL serial cable. In the integrated design, the Bluetooth system is assembled directly onto the PCB, necessitating that programming be done through the main microcontroller. A code was developed to emulate a serial terminal on the main microcontroller which configured the Bluetooth module over 115200 baudrate, 8N1 connection to use "ExoBoard" as SSID, set serial port profile, and use a PIN. Figure 3.8 shows the BT module configured and advertising on an Android smartphone.

68

Figure 3.8: Integrated Design advertising over Bluetooth

3.11 FLASHING
With the board's subsystems verified, the system firmware could be loaded onto the microcontroller. The unit was programmed over JTAG with the ARKE firmware from Code Composer Studio.

3.12 SYSTEM INTEGRATION
The board was now ready to be placed in the system. The Integration of the board into the system is further discussed in Chapter 4.

3.13 CONCLUSION
A unit of the Integrated design was produced and passed all unit tests. The produced unit was readied for experimentation and data collection.

69

4 EXPERIMENT
4.1 INTRODUCTION
This chapter presents the experimental and data collection methods for testing the Integrated design. The board is placed in-system and walking trials are performed to gather data. Data is saved from the system API and imported into MATLAB for post processing. The results are discussed in Chapter 5.

4.2 EXPERIMENTAL SETUP
The experimental setup involves the placement of the design in-system and configuring the control tablet for use. This is required to be done on a per-system or per-tablet basis. 1. The integrated design was placed in-system and all internal connections were wired. 2. The exoskeleton was powered on. 3. The tablet was powered on. 4. The tablet was paired with the new board using the Windows 8 Bluetooth pairing interface. Once the tablet was paired, the system was configured and ready for trials.

4.3 TRIAL PROCEDURE
The trial procedure describes the process for obtaining performance data from the system. The process follows the steps outlined in Figure 2.3. 1. The control application was started on the tablet and connected to the device. 2. A homing command was issued to the device. 3. Following homing, a "stand" command was issued to the device.

70

4. Operator control mode was initiated, and a walking sequence was initiated on the device. 5. After 40 steps, the walking sequence was terminated. 6. A "sit" command was issued. 7. Upon completion, the session was finished on the control tablet. 8. The device was powered off and the session data was saved and downloaded for analysis.

4.4 DATA COLLECTION AND POST PROCESSING
The following is a partial list of data sampled during walking sessions and logged to file by PatientProfile:       Sample time stamp (ms since power on) (Integer) Position of each axis (deg) (Float) Velocity of each axis (deg/s) (Float) Torque of each axis (Nm) (Float) Forward and side tilt angles (deg) (Float) Device status and flags (Bit Field/Integer)

Data was sampled at approximately 50Hz. In addition, the travel distance, and number of steps taken and session time were recorded. This data was saved locally on the tablet as a CSV file. This file was transferred to a local workstation for analysis in MATLAB. A script was developed to read and plot the time, position and velocity vectors in the API data. These files were inspected and filtered to determine regions of interest.

71

Figure 4.1: Workflow for collecting and processing walking session data

4.5 SUMMARY
This chapter provided the methodology for data collection and analysis of the performance of the Integrated design. Data was collected during walking trials and were used to compare with the one collected with the benchmark design. This is presented in Chapter 5.

72

5 EXPERIMENTAL RESULTS AND DISCUSSION
5.1 INTRODUCTION
This chapter is dedicated to the analysis and comparison of the Preliminary and Integrated designs. This chapter compares the performance and size of the two designs.

5.2 PERFORMANCE DATA
Figure 5.1 shows the random sampling of the device in operation with the Preliminary design. The waveforms for the sagittal joint angles and velocities are shown for each hip and knee. It can be observed that the waveforms shown in Figure 5.1 approximate the pathology-free gait as described in Figure 1.6. The time axis indicates the time in seconds since device is powered on. Since the device does not walk continuously, the area of interest is chosen to demonstrate four consecutive gait cycles. The analyses are then repeated for the Integrated design, and the results are shown in Figure 5.2. As it can be seen in the figure, the device recreates a similar gait cycle.

73

Figure 5.1: Joint angles and velocities of ARKE system using Preliminary Logic Board

74

Figure 5.2: Joint angles and velocities of ARKE system using Integrated Logic Board

75

5.3

SIZE ANALYSIS

To estimate the footprint reduction of the new design, the dimensions of the Preliminary boards were measured and recorded. The X and Y dimensions of each board were obtained from Eagle CAD. Since Eagle does not have any 3D modelling capability, the Z (height) dimension of each board was measured using a calibrated Mitutoyo 500-196-20 digital caliper and was recorded as the height between the tallest components on each side in order to be consistent with the measurements of the Integrated design reported in Table 5.1. Board Logic Board (Assembled) Power Board Dimension X Y Z X Y Z Value (mm) 82.55 64.77 24.28 49.21 39.69 16.67 Surface Area (mm2) 5346.76 1953.14 Volume (mm3) 129819 32559

Table 5.1: Dimensions of Preliminary Design

For surface area calculation, the dimensions of the modules were measured and listed in Table 5.2. Note that for the Bluetooth module, the X and Y dimensions are listed as the extents. However, since the board was not rectangular, the surface area is reflected as the actual area of the part as calculated from the datasheet. Board Tiva IMU Bluetooth Module Dimension X Y X Y X Y Value (mm) 63.50 50.80 15.24 16.51 24.40 29.90 Surface Area (mm2) 3225.80 251.61 603.28

Table 5.2: Dimensions of COTS modules

The total measurements for the Preliminary design are tallied up in Table 5.3.

76

Parameter Footprint Volume

Preliminary Design 11380.60 mm2 162378 mm3

Integrated Design 8530 mm2 115200 mm3

 - 2850.6 mm2 - 47178 mm3

% - 25.0 - 29.0

Table 5.3: Size comparison of Preliminary vs Integrated designs

The Integrated design achieves savings of 25% on total PCB area and 28% on PCB volume.

5.4 SUMMARY
This chapter compared the performance of the Integrated and the Preliminary designs in terms of functionality, size and cost. It was demonstrated that the Integrated design recreates the walking gait pattern while achieving a smaller size.

77

6 CONCLUSIONS AND FUTURE WORKS

6.1 CONCLUSIONS
The primary contribution of this thesis is a novel, compact, extensible hardware platform for fully assistive lower body exoskeletons. The integration of components onto one single PCB allowed the design to be represented in a 30% smaller space than the modular COTS-based prototype. The elimination of friction-fit connections and stacked boards increased signal integrity and mechanical robustness. Similarly, the elimination of COTS components allowed for expansion of functionality. The design and assembly of the hardware platform was documented and the design was verified using an existing clinical exoskeleton. It is shown through experimentation that the design is able to recreate a pathology-free gait in the sagittal plane and fulfill the basic requirements of a lower body exoskeleton, achieving the outlined objectives. Pending additional validation and burn-in, this design is suitable for future deployment to human trials. In the future, this design can be used to drive smaller, more lightweight robotics.

6.2 IMPROVEMENTS
While the design achieved its objectives, the reworked RC network added in Figure 3.5 was incorporated into the design following its release to manufacturing. This is shown as R38, C33 in Figure 6.1.

78

Figure 6.1: Addition of reworked RC network to PCB.

6.3 RECOMMENDATIONS AND FUTURE WORKS
The results of this study have produced a number of recommendations for future studies: 1. Thermal analysis using an imaging camera (e.g. FLIR) would provide insight into the heat performance of the board under normal operating conditions. This can be used to determine the effect of thermal fatigue on the design, and also to determine whether certain nets need additional width or layers need additional plating thickness.

2. Quantitative measurement on RF leakage and susceptibility of the boards would provide insight into the difference in EMI performance of the designs. Electronics must meet interference standards by Health Canada (US: FCC) before approval for sale. Of note, the specific absorption rate (SAR) limits of RF energy exposure must be below .08W/kg for

79

the whole body for frequencies ranging between 3kHz and 300GHz as defined by Health Canada in Safety Code 6 [74].

3. Similarly, the design should be analyzed for compliance with IEC60601:2013, the standard defining the basic safety and essential performance of medical electrical equipment. This is a requisite for licensure by the FDA or Health Canada for devices intended for home use [75].

4. Additional validation and testing is required to determine the safety and performance record, part of the risk assessment of the design, before human trials can begin. Further units should be assembled and burn-in tests should be performed. 5. Due to the varying delays between steps, software analysis could be advanced to overlay gait cycle on a normalized time basis, abstracting out the specific walking sequence used. 6. Via software, deep learning could be used on the API to track rehabilitation progress. 7. Using machine assembly, a more aggressive layout could be done with smaller passives such as 0402s, 0201s, and no-lead ICs/BGAs. 8. The Bluetooth PHY selected was not configured to encrypt communication, making it possible for an attacker to eavesdrop on communications or assert control via man-in-themiddle (MITM) attacks. Bluetooth Low Energy (BLE) provides Elliptic Curve DiffieHellman (ECDH) encryption as a core part of the specification which is effective at

80

thwarting these attacks [76]. Many off the shelf BLE modules are available such as the Cypress CY5676A [77]. BLE would also lower energy consumption demands.

9. A small battery, such as a 150mAh single-cell lithium ion pack, providing persistent power to the main microcontroller and select peripherals would be useful in case of faults with the main battery, or system diagnostics with the main power off. This can be automatically switched with a power mux such as the Texas Instruments' TPS2113A [78] or a diode.

10. The friction-lock connectors chosen for the board were prone to failure after only a few (<20) insertions. Failure is typically non-recoverable as the traces are lifted off the board. To increase reliability, positive-lock connectors should be chosen instead. As a stopgap measure, the connectors can be adhered using glue or epoxy to increase resilience.

11. Future designs should consider independent buck converters for each rail, especially if the power budget is increased with additional on-board logic. This would result in better power efficiency and prevent cascading failure in the event an upstream regulator fails. Alternately, a hybrid approach could be taken which reuses the 12V converter as a primary step-down voltage, then small footprint buck converters used for for the 5V (such as the LT1076-5 [79]) and 3.3V rails. 12. The application of conformal coating would increase environmental resistance and protect the electronics against corrosion, dust and moisture.

81

13. This design is not well suited for partially assistive gait rehabilitation due to the increased bandwidth and processing requirements required. To meet the suggested control loop latency of 1 ms on the feedback channel, additional dedicated RS-485 channels are needed. Alternatively, the servo drives could be substituted with Ethernet/EtherCAT capable models, such as in [80]. The MINDWALKER exoskeleton by Wang et al. is such an example, using a distributed EtherCAT based hardware architecture to implement impedance-control based control system or partial assistance [81].

82

APPENDIX A: PCB DRC RESULTS AND STACKUP
Table A.1 lists the full DRC output. The one un-routed signal indicated in the results was for a passive decoupling network for the MCU which was internally connected and therefore intentionally not routed on the PCB.

Warnings Total Rule Violations Clearance Constraint (Gap=8mil) (OnLayer('Power Plane') or OnLayer('Ground Plane')),(All) Modified Polygon (Allow modified: No), (Allow shelved: No) Net Antennae (Tolerance=0mil) (All) Silk primitive without silk layer Silk to Silk (Clearance=5mil) (All),(All) Silk To Solder Mask (Clearance=5.5mil) (IsPad),(All) Minimum Solder Mask Sliver (Gap=2mil) (Disabled)(All),(All) Hole To Hole Clearance (Gap=5mil) (All),(All) Hole Size Constraint (Min=15mil) (Max=250mil) (All) Height Constraint (Min=0mil) (Max=1000mil) (Preferred=500mil) (All) Width Constraint (Min=10mil) (Max=100mil) (Preferred=10mil) (All) Power Plane Connect Rule(Direct Connect )(Expansion=20mil) (Conductor Width=10mil) (Air Gap=10mil) (Entries=4) (All) Clearance Constraint (Gap=6mil) (InComponent('U?') or InComponent('ANT1')),(All)

Count 0 Count 0 0 0 0 0 0 0 0 0 0 0 0

0

83

Un-Routed Net Constraint ( (All) ) Short-Circuit Constraint (Allowed=No) (All),(All) Clearance Constraint (Gap=8mil) (All),(All) Minimum Annular Ring (Minimum=5mil) (All) Total Un-Routed Net Constraint ( (All) )

1 0 0 0 1

Un-Routed Net Constraint: Net NetC6_2 Between Pad U1-25 (1629.842,-2196.457mil) And Pad U1-56 (1629.842,-1753.543mil)
Table A.1: DRC Results (Adapted from Altium Designer Output)

A.1 PCB STACKUP
The full PCB stackup for the Integrated design is shown in Figure A.2.

Index Graphic 1 2 3 4 5 6 7 8 9 10 11 12 13

Layer Top Paste Top Overlay Top Solder Component Side 2116 x2 TOP Ground Plane Core Power Plane 2116 x2 BTM Solder Side Bottom Solder Bottom Overlay Bottom Paste Total Thickness:
Table A.2: PCB Stackup for Integrated Design

Thickness

0.40mil 1.40mil 8.00mil 1.42mil 40.00mil 1.42mil 8.00mil 1.40mil 0.40mil

62.43mil (Â±10%)

84

APPENDIX B: IR REFLOW OVEN

The T-962 (Fig. B.1a) is a basic infrared reflow oven with programmable reflow curves. The oven was modified from stock to improve thermal insulation and was flashed with third party firmware by Unified Engineering as per [82] using a standard USB to TTL UART cable. Due to inaccuracies of the thermocouple (biased 12 degrees warm) the default 63-37 reflow profile did not achieve sufficient temperature to reflow the boards. Satisfactory reflows were produced with the default "AMTECH SYNTECH-LF" profile.

(a)

(b)
Figure B.1 a) T-962 IR Oven, b) user interface showing reflow profile

85

APPENDIX C: SCHEMATICS
See attached pages.

86

1

2

3

4

MICROCONTROLLER U1A

3V3 U1C 37 VBAT VDD VDD VDD VDD VDDA VDDC VDDC GNDX GND 35 Y2M TM4C123GH6PMIR GNDA 3 GND GND GND GND 12 27 39 55

A C5 11 26 42 54 2 25 56 C9

1uF 6.3V 0603

100nF 6.3V 0603 100nF 6.3V 0603

A

C1

C2

C3

C4

ICDI_TX ICDI_RX 1K 5% 0603(1608) R1 GPIO_EXPN0 R2 GPIO_EXPN1 DRV_UV_STOP DRV_UV_WARN BTN_ESTOP1 BTN_ESTOP0 I2C_IMU_SCL I2C_IMU_SDA 17 18 19 20 21 22 23 24 PA0/CAN1RX/U0RX PA1/CAN1TX/U0TX PA2/SSI0CLK PA3/SSI0FSS PA4/SSI0RX PA5/SSI0TX PA6/I2C1SCL/M1PWM2 PA7/I2C1SDA/M1PWM3

10nF 6.3V 0603 10nF 6.3V 0603 GND 2.2nF 6.3V 0603 100nF 6.3V 0603

C6

C7

C8

100nF 6.3V 0603

1uF 6.3V 0603

RS485_DRV_RX RS485_DRV_TX I2C_AUX_SCL I2C_AUX_SDA M2PWM M3PWM M1PWM M4PWM

45 46 47 48 58 57 1 4 PB0/T2CCP0/U1RX/USB0ID PB1/T2CCP1/U1TX/USB0VBUS PB2/I2C0SCL/T3CCP0 PB3/I2C0SDA/T3CCP1 PB4/AIN10/CAN0RX/M0PWM2/SSI2CLK/T1CCP0 PB5/AIN11/CAN0TX/M0PWM3/SSI2FSS/T1CCP1 PB6/M0PWM0/SSI2RX/T0CCP0 PB7/M0PWM1/SSI2TX/T0CCP1

GND

B

GND 41 34 36

0R 0603 U1B R3 32 WAKE 40

OSC0

TCK TMS TDI TDO LED_USER0 LED_USER1 BTN_USER0 BTN_USER1

52 51 50 49 16 15 14 13

PC0/SWCLK/T4CCP0/TCK PC1/SWDIO/T4CCP1/TMS PC2/T5CCP0/TDI PC3/SWO/T5CCP1/TDO PC4/C1-/IDX1/M0PWM6/U1RTS/U1RX/U4RX/WT0CCP0 PC5/C1+/M0PWM7/PHA1/U1CTS/U1TX/U4TX/WT0CCP1 PC6/C0+/PHB1/U3RX/USB0EPEN/WT1CCP0 PC7/C0-/U3TX/USB0PFLT/WT1CCP1

B

/RST

38

RST

OSC1

33

HIB

XOSC0

XOSC1

TM4C123GH6PMIR 1 C11 C12 C13 Y2 2 ABM3-16.000 MHz-B2- T 10pF 10V 0603

TEMP1 TEMP2 SW_RFOOT_CLOSED/nOPEN RFOOT_CABLE_PLUG_DETECT GPIO_EXPN2 GPIO_EXPN3 BT_RX BT_TX

61 62 63 64 43 44 53 10

PD0/AIN7/I2C3SCL/M0PWM6/M1PWM0/SSI1CLK/SSI3CLK/WT2CCP0 PD1/AIN6/I2C3SDA/M0PWM7/M1PWM1/SSI1FSS/SSI3FSS/WT2CCP1 PD2/AIN5/M0FAULT0/SSI1RX/SSI3RX/USB0EPEN/WT3CCP0 PD3/AIN4/IDX0/SSI1TX/SSI3TX/USB0PFLT/WT3CCP1 PD4/U6RX/USB0DM/WT4CCP0 PD5/U6TX/USB0DP/WT4CCP1 PD6/M0FAULT0/PHA0/U2RX/WT5CCP0 PD7/NMI/PHB0/U2TX/WT5CCP1

AB26TRB 32.768KHz 24pF 10V 0603

2

Y1

1

C10

C GND GND

Y2M

TEMP3 GPIO_EXPN4 SW_LFOOT_CLOSED/nOPEN LFOOT_CABLE_PLUG_DETECT UART_TTY_RX UART_TTY_TX

9 8 7 6 59 60 28 29 30 31 5

PE0/AIN3/U7RX PE1/AIN2/U7TX PE2/AIN1 PE3/AIN0 PE4/AIN9/CAN0RX/I2C2SCL/M0PWM4/M1PWM2/U5RX PE5/AIN8/CAN0TX/I2C2SDA/M0PWM5/M1PWM3/U5TX PF0/C0O/CAN0RX/M1PWM4/NMI/PHA0/SSI1RX/T0CCP0/U1RTS PF1/C1O/M1PWM5/PHB0/SSI1TX/T0CCP1/TRD1/U1CTS PF2/M0FAULT0/M1PWM6/SSI1CLK/T1CCP0/TRD0 PF3/CAN0TX/M1PWM7/SSI1FSS/T1CCP1/TRCLK PF4/IDX0/M1FAULT0/T2CCP0/USB0EPEN TM4C123GH6PMIR

C

BUZZER_ON/nOFF GPIO_EXPN5 GPIO_EXPN6 GPIO_EXPN7 BT_nRST

3V3

/RST

R4 1K 5% 0603(1608) 1 SW1 2 1 2 TACT SW KDR2 Title GND Size A Date: File: 2 3

D

EXOSKELETON CONTROLLER
Number Revision

D

MASCPRJ01
4

A
1/13/2017 Sheet 1of 5 C:\Users\Bryan\Desktop\MCU (1).SchDocDrawn By: Bryan Bonnici

1

1 TRIMMABLE DRIVER LOGIC SUPPLY

2

3

4

12V POWER RAIL

BATTERY IN U2 13 VIN 12V0 3 2 4 D1 3 6K2 5% 0603(1608) VAUX R9 1K6 5% 0603(1608) C? 22uF 25V 1206 4 TAB GND FSV10100V ADJ R7 3 IN OUT R? 1R 5% 1206(3216) LM317AEMP 14 1 R10 820R 5% 0603(1608) 9 15 1 2 U3 2 1 R5 0R 0603 C18 VAUX C19 BST 11 RON/SD SS RTN SGND NC NC LM5010AMH/NOPB GND GND GND B NC NC DAP FB ISEN SW 10 6 5 8 7 VCC 12 12V0 GND C14 CAP 100nF 50V 0603(1608)

CN1

4.7uF 100V 100nF 100V 0603 C15 C16

A

2 1

A

43650-0224

R6

22nF 100V 0603

C20

100nF 50V 0603

GND R8 240R 5% 0603(1608)

B

GND

GND

5V, 3V3 POWER RAILS 5V0 0R 0603 U4 1 IN TAB LM340MP-5.0 GND CAP 100nF 50V 0603(1608) DRIVER LOGIC POWER VAUX 2 1 GND CN3 2 1 2P CONN 1.5MM SMT GND GND LM3940IMPX-3.3 GND GND CAP 100nF 50V 0603(1608) GND 2 TAB GND 0R 0603 C22 4 2 OUT IN OUT 4 3 R11 1 3 R12 C23 U5 3V3

POWER OUT CN2

12V0

C21

3V3 12V0 5V0

1 2 3 4 39544-3004 GND C

GND

GND

C

CAP 100nF 50V 0603(1608)

3V3 SYSTEM POWER LED

ESTOP

R13 5K1 5% 0603(1608)

BTN_ESTOP1

3

5V0

Q1 MMBF0201NLT1G

1

R15 100R 5% 0603(1608)

R14 CN6 150R 5% 0603(1608) 2 2 1 1 2P CONN 1.5MM SMT GND

2

3V3 RELAY CN4

R16 1M 5% 0603
ESTOP1

D

R17 5K1 5% 0603(1608) 4 3 2 1

GND

GND

BTN_ESTOP0

R18

5V0 ESTOP1 2 1

CN5 2 1 2P CONN 1.5MM SMT

Title

100nF 50V 0603

GND GND GND

82K 5% 0603

CAP 22nF 100V 0603(1608) C17 L1 1 2 SRR1280-470

ESTOP0 1K 5% 0603(1608)

4 3 2 1

EXOSKELETON CONTROLLER
Size A Date: File: 2 3 Number Revision

D

4P CONN 1.5MM SMT

MASCPRJ01
4

A
1/13/2017 Sheet 2of 5 C:\Users\Bryan\Desktop\Pwr (1).SchDoc Drawn By: Bryan Bonnici

GND

1

1 BT PHY

2

3

4

ACCELEROMETER

A RN42 Module RN42 8 9 3 11 1 GND SPI_MOSI PIO6 PIO7 RESET# SPI_SCK PCM_CLK PCM_SYNC PCM_IN PCM_OUT VDD GND
AIO1 GND PIO11 PIO10 PIO9 PIO8 GND AIO0

3V3 3V3 Factory Reset Jumper 3V3 ANT1 1K 5% 0603(1608) R21 JP1 SPI_MISO SPI_CS# PIO4 PIO5 PIO3 PIO2 USB_DUSB_D+ UART_CTS UART_RTS UART_TX UART_RX 24 23 22 21 20 19 18 17 16 15 14 13 BT_RX BT_TX PIO2 GND PIO5 2 3V3 3 R22 1K 5% 0603(1608) 4 GND 6 7 8 9 10 3V3 11 12 3V3 GND 5 GND BT_nRST GND 1 2 3

A

replace 4.7

12K 5% 0603(1608)

R19

R20

U6

I2C_IMU_SCL I2C_IMU_SDA

14 13 12 7

3V3 2 4 5

GND

10

C24 10nF 6.3V 0603

ADXL345TCCZ-EP

B

TSW-103-07-F-S

3V3

1 6

SCL/SCLK INT1 SDA/SDI/SDIO INT2 SDO/ALT ADDRESS CS RESERVED RESERVED NC GND VDD I/O GND VS GND

GND

B

GYROSCOPE

U7

35

29

34

33

32

31

28

C

30

1 VDD VLOGIC INT CPOUT REGOUT GND 18 C25 C26 C27 20 10

CLKIN

9

AD0

13 8 12

C

11

RESV_G

GND 3V3

GND 3V3 PIO5 Status LED (Mode) 33R 5% 0603(1608) APG1608CGKC/T D2 R23

I2C_IMU_SCL I2C_IMU_SDA

23 24

SCL SDA

100nF 6.3V 0603

GND

GND

GND

GND GND

2.2nF 50V 0603

ITG3200

3V3

100nF 6.3V 0603

PIO2

R24 33R 5% 0603(1608) D3 APG1608CGKC/T GND Title

Status LED (Connected)

C28 10nF 6.3V 0603

D

GND Size A Date: File: 2 3

EXOSKELETON CONTROLLER
Number Revision

D

MASCPRJ01
4

A
1/13/2017 Sheet 3of 5 C:\Users\Bryan\Desktop\RF_IMU.SchDocDrawn By: Bryan Bonnici

1

1

2

3

4

3V3 1 U8A CN7 8 SN74LV4T125PWR 13 U8D GND 5 M4PWM 5V0 5V0 U8E C29 14 VCC GND SN74LV4T125PWR GND 5V LOGIC LEVEL SHIFTER 5V0 U9 R29 2K2 5% 0603(1608) SW_LFOOT_PLUG_IN SW_LFOOT_IN SW_RFOOT_PLUG_IN SW_RFOOT_IN CN13 1 2 3 TSW-103-07-F-S GND GND GND GND GND UVOLT_WARN_IN UVOLT_STOP_IN 1 2 VCCA DIR GND LFOOT_CABLE_PLUG_DETECT SW_LFOOT_CLOSED/nOPEN RFOOT_CABLE_PLUG_DETECT SW_RFOOT_CLOSED/nOPEN 3V3 GND 7 GND 100nF 6.3V 0603 SN74LV4T125PWR SN74LV4T125PWR 6 PWM1_OUT 12 11 PWM3_OUT PWM2_OUT GND M1PWM SN74LV4T125PWR 4 U8B GND M2PWM 2 M3PWM 3 PWM0_OUT 9 GND 10 U8C

A

R25 R26 R27

1K 5% 0603

CN14

TEMP1 TEMP2 TEMP3

UVOLT_STOP_IN 1 UVOLT_WARN_IN 2 3 PWM3_OUT 4 5 PWM2_OUT 6 7 PWM1_OUT 8 9 PWM0_OUT 10 1 2 3 4 5 6 7 8 9 10

A

5V0 5V0 GPIO_EXPN0 GPIO_EXPN1 GPIO_EXPN2 GPIO_EXPN3 GPIO_EXPN4 GPIO_EXPN5 GPIO_EXPN6 GPIO_EXPN7 I2C_AUX_SDA I2C_AUX_SCL

1 3 5 7 9 11 13 15 17 19 21 23 25 27 29

2 4 6 8 10 12 14 16 18 20 22 24 26 28 30

10P CONN 1.5MM SMT

SFMC-115-02-S-D GND

3V3 3V3

B

R28

B

I2C_AUX_SCL I2C_AUX_SDA

CONSOLE HEADER

UART_TTY_RX UART_TTY_TX

3 4 5 6 7 8 9 10 11 12

A1 A2 A3 A4 A5 A6 A7 A8 GND GND

VCCB VCCB /OE B1 B2 B3 B4 B5 B6 B7 B8 GND SN74LVC4245A

24 23 22 21 20 19 18 17 16 15 14 13

DRV_UV_WARN DRV_UV_STOP

5V0

3V3

100nF 6.3V 0603

C32

C30

C

C

PIEZO BUZZER 5V0

RS485 TRANSCIEVER 3V3 RS485_DRV_RX RS485_DRV_TX 3V3 C31 100nF 6.3V 0603 Title GND GND Size A Date: File: 2 3 U10

120R 1% 0603(1608) R30 CN9

CN8 2 1 2 1 2P CONN 1.5MM SMT Q2 DNBT8105

1 2 3 4

R31 12K 5% 0603(1608)

VCC RX TX GND SN65HVD379

A B Z Y

8 7 6 5 R32 GND change direction of tx/rx arrow

1 2 3 4 5 GND 120R 1% 0603(1608)

1 2 3 4 5 5P CONN 1.5MM SMT

BUZZER_ON/nOFF

R33 1K 5% 0603(1608)

D

EXOSKELETON CONTROLLER
Number Revision

D

MASCPRJ01
1/13/2017 C:\Users\..\Interface (1).SchDoc 4

A
Sheet 4of 5 Drawn By: Bryan Bonnici

1

1

2

3

4

JTAG HEADER CN12

ICDI_TX ICDI_RX

A HTSS-104-01-G-D GND

1 3 5 7

2 4 6 8

TDO TDI TMS TCK

A

USER BUTTONS 3V3 R34 1K 5% 0603(1608)

Connectors: 1: Expansion (GPIO/I2C/ANA) 2: ESTOP 3: Power In 4: 12V/6V/5V/3V3 Term block 5: Relay 6: Left Foot Sw 7: Right Foot Sw 8: Temperature Headers 9: JTAG 10: PWM 11: RS485 12: TTY 13: UMC Power

BTN_USER1 3V3 R35 1K 5% 0603(1608) 1 SW3 2 1 2 TACT SW KDR2 GND

1 SW2 2 1 2 TACT SW KDR2 B

B

BTN_USER0

USER LEDS

APG1608CGKC/T D4

R36 LED_USER0 33R 5% 0603(1608) D5

C

R37 LED_USER1 33R 5% 0603(1608)

C

GND

FOOT SWITCH CONNECTORS

5V0

5V0 CN11 PE2 PE3 SW_RFOOT_IN SW_RFOOT_PLUG_IN 1 2 3 4 1 2 3 4 PD2 PD3 Title 4P CONN 1.5MM SMT GND Size A Date: File: 2 3

CN10

SW_LFOOT_IN SW_LFOOT_PLUG_IN

1 2 3 4

D

1 2 3 4

4P CONN 1.5MM SMT

EXOSKELETON CONTROLLER
Number Revision

D

GND

MASCPRJ01
1/13/2017 C:\Users\..\Interface2.SchDoc 4

A
Sheet 5of 5 Drawn By: Bryan Bonnici

1

REFERENCES
[1] H. I. Krebs and B. T. Volpe, "Robotics: A Rehabilitation Modality," Curr. Phys. Med. Rehabil. Reports, vol. 3, no. 4, pp. 243Â­247, 2015. [2] M. Talaty, A. Esquenazi, and J. E. Briceno, "Differentiating ability in users of the ReWalkTM powered exoskeleton: An analysis of walking kinematics," IEEE Int. Conf. Rehabil. Robot., 2013. [3] C. K. Thomas, E. Y. Zaidner, B. Calancie, J. G. Broton, and B. R. Bigland-Ritchie, "Muscle weakness, paralysis, and atrophy after human cervical spinal cord injury," Exp. Neurol., vol. 148, no. 0014Â­4886 (Print), pp. 414Â­423, 1997. [4] W. T. Phillips et al., "Effect of spinal cord injury on the heart and cardiovascular fitness," Curr. Probl. Cardiol., vol. 23, no. 11, pp. 641Â­716, 1998. [5] C. S. Fry, M. J. Drummond, H. L. Lujan, S. E. Dicarlo, and B. B. Rasmussen, "Paraplegia increases skeletal muscle autophagy," Muscle and Nerve, vol. 46, no. 5, pp. 793Â­798, 2012. [6] National SCI Statistical Center, "Spinal Cord Injury (SCI) facts and figures at a glance.," Birmingham, AL, 2015. [7] T. Anwar, A. Al Jumaily, and S. Member, "System Identification and Damping Coefficient Estimation from EMG based on ANFIS to Optimize Human Exoskeleton Interaction .," Fuzzy Syst. (FUZZ-IEEE), 2016 IEEE Int. Conf., pp. 844Â­849, 2016. [8] H. I. Krebs et al., "Robot-aided neurorehabilitation: A robot for wrist rehabilitation,"

92

IEEE Trans. Neural Syst. Rehabil. Eng., vol. 15, no. 1, pp. 327Â­335, 2007. [9] R. L. Harvey, "Improving poststroke recovery: Neuroplasticity and task-oriented training," Curr. Treat. Options Cardiovasc. Med., vol. 11, no. 3, pp. 251Â­259, 2009. [10] W. K. Lee and S. Jung, "FPGA design for controlling humanoid robot arms by exoskeleton motion capture system," 2006 IEEE Int. Conf. Robot. Biomimetics, ROBIO 2006, pp. 1378Â­1383, 2006. [11] M. H. Raibert, Legged Robots that Balance. Cambridge, MA: The MIT Press, 1986. [12] A. B. Zoss, H. Kazerooni, and A. Chu, "Biomechanical Design of the Berkeley Lower Extremity Exoskeletong (BLEEX)," IEEE/ASME Trans. Mechatronics, vol. 11, no. 2, pp. 128Â­138, 2006. [13] C. J. Walsh, D. Paluska, K. Pasch, W. Grand, A. Valiente, and H. Herr, "Development of a lightweight, underactuated exoskeleton for load-carrying augmentation," Proc. - IEEE Int. Conf. Robot. Autom., vol. 2006, no. May, pp. 3485Â­3491, 2006. [14] H. G. Kim, J. W. Lee, J. Jang, C. Han, and S. Park, "Mechanical design of an exoskeleton for load-carrying augmentation," 2013 44th Int. Symp. Robot. ISR 2013, 2013. [15] M. Fontana, R. Vertechy, S. Marcheschi, F. Salsedo, and M. Bergamasco, "The Body Extender," IEEE Robot. Autom. Mag., no. December, pp. 34Â­44, 2014. [16] J. Murtagh, "ReWalk: Robotic Exoskeletons for Spinal Cord Injury," CADTH issues Emerg. Heal. Technol., no. 141, 2015. [17] E. Strickland, "Good-bye, wheelchair," IEEE Spectr., vol. 49, no. 1, pp. 30Â­32, 2012. [18] Globe Newswire, "FDA Clears Parker's IndegoÂ® Exoskeleton for Clinical, Personal
93

Use," 2016. [Online]. Available: http://phx.corporateir.net/phoenix.zhtml?c=97464&p=irol-newsArticle&ID=2147571. [Accessed: 10-Aug2016]. [19] Brain Products, "Paralyzed man in mind-controlled exoskeleton kicks off FIFA World Cup 2014," 2014. [Online]. Available: http://pressrelease.brainproducts.com/fifa-worldcup-2014/. [Accessed: 30-Jul-2016]. [20] Globe Newswire, "FDA Clears Parker's IndegoÂ® Exoskeleton for Clinical, Personal Use," 2016. . [21] Ekso Bionics, "Ekso GTTM Robotic Exoskeleton Cleared by FDA for Use With Stroke and Spinal Cord Injury Patients," 2016. [Online]. Available: http://ir.eksobionics.com/pressreleases/detail/570/ekso-gt-robotic-exoskeletoncleared-by-fda-for-use-with. [Accessed: 31-Aug-2016]. [22] ReWalk, "ReWalk Gallery," 2016. [Online]. Available: http://rewalk.com/gallery-2/. [Accessed: 10-Sep-2016]. [23] L. Kratochwill, "Lightweight Robotic Exoskeleton Approved by FDA," Popular Science, 2016. [Online]. Available: http://www.popsci.com/indego-exoskeleton-gets-fda-approval. [Accessed: 10-Aug-2016]. [24] S. Charara, "This robotic exoskeleton helps patients to walk and it's getting smarter," Wareable, 2015. [Online]. Available: https://www.wareable.com/saves-theday/exoskeleton-paralysed-patients-ekso-bionics-gt-sarah-thomas. [Accessed: 09-Sep2016].

94

[25] "Ekso Bionics Holdings Inc (NASDAQ:EKSO): Today's Momentum Play," Insider Financial. [Online]. Available: https://www.insiderfinancial.com/ekso-bionics-holdingsinc-nasdaqekso-todays-momentum-play/117493/. [Accessed: 20-Oct-2016]. [26] J. Rueterbories, E. G. Spaich, B. Larsen, and O. K. Andersen, "Methods for gait event detection and analysis in ambulatory systems," Med. Eng. Phys., vol. 32, no. 6, pp. 545Â­ 552, 2010. [27] K. Suzuki, G. Mito, H. Kawamoto, Y. Hasegawa, and Y. Sankai, "Intention-Based Walking Support for Paraplegia Patients with Robot Suit HAL," Adv. Robot., vol. 21, no. 12, pp. 1441Â­1469, 2007. [28] M. Segar, "Back on his feet," Reuters, 2014. [Online]. Available: http://blogs.reuters.com/photographers-blog/2014/03/31/back-on-his-feet/. [Accessed: 02Jan-2017]. [29] M. Arazpour, S. W. Hutchins, and M. A. Bani, "The efficacy of powered orthoses on walking in persons with paraplegia," Prosthet. Orthot. Int., vol. 39, no. 2, pp. 90Â­99, 2015. [30] I. Benson, K. Hart, D. Tussler, and J. J. van Middendorp, "Lower-limb exoskeletons for individuals with chronic spinal cord injury: findings from a feasibility study," Clin. Rehabil., vol. 30, no. 1, pp. 73Â­84, 2016. [31] J. Kressler et al., "Understanding therapeutic benefits of overground bionic ambulation: Exploratory case series in persons with chronic, complete spinal cord injury," Arch. Phys. Med. Rehabil., vol. 95, no. 10, pp. 1878Â­1887, 2014.

95

[32] J. B. Nielsen, "How We Walk: Central Control of Muscle Activity during Human Walking," Neuroscientist, vol. 9, no. 3, pp. 195Â­204, 2003. [33] C. L. Vaughan, "Theories of bipedal walking: an odyssey," J. Biomech., vol. 36, pp. 513Â­ 523, 2003. [34] S. Shultz, P. Houglum, and D. Perrin, Examination of Musculoskeletal Injuries, Third Edit. Human Kinetics, 2009. [35] M. Iosa, A. Fusco, and F. Marchetti, "The Golden Ratio of Gait Harmony: Repetitive Proportions of Repetitive Gait Phases," Biomed Res. Int., 2013. [36] J. Loudon, M. Swift, and S. Bell, The Clinical Orthopedic Assessment Guide, Second Edi. Human Kinetics, 2008. [37] R. C. Schafer, Clinical Biomechanics: Musculoskeletal Actions and Reactions, 2nd Revise. Williams & Wilkins, 1987. [38] J. Ahn and N. Hogan, "Walking Is Not Like Reaching: Evidence from Periodic Mechanical Perturbations," PLoS One, 2012. [39] J. K. Moore, S. K. Hnat, and A. J. van den Bogert, "An elaborate data set on human gait and the effect of mechanical perturbations.," PeerJ, 2015. [40] Y. Iwashita, "Piecewise Polynomial Interpolations," OpenGamma, vol. 15, pp. 1Â­28, 2013. [41] M. Beckerleg and C. Zhang, "Evolving individual and collective behaviours for the Kilobot robot," 2016 IEEE 14th Int. Work. Adv. Motion Control. AMC 2016, pp. 263Â­268, 2016.

96

[42] J. Currie, M. Beckerleg, and J. Collins, "Software evolution of a Hexapod Robot walking gait," 15th Int. Conf. Mechatronics Mach. Vis. Pract. M2VIP'08, pp. 305Â­310, 2008. [43] Boston Dynamics, "BigDog Overview," Boston Dynamics. p. 22, 2008. [44] D. K. Yoon, S. Y. Kim, J. Cho, K. K. Lee, and B. J. You, "Development of a compact motor controller supporting EtherCAT for a dual-arm telepresence robot," 2014 11th Int. Conf. Ubiquitous Robot. Ambient Intell. URAI 2014, no. Urai, pp. 253Â­256, 2014. [45] S. Jorg, J. Tully, and A. Albu-Schaffer, "The Hardware Abstraction Layer - Supporting control design by tackling the complexity of humanoid robot hardware," Proc. - IEEE Int. Conf. Robot. Autom., pp. 6427Â­6433, 2014. [46] B. Siciliano, L. Sciavicco, and L. Villani, Robotics: Modelling, Planning and Control. Springer London, 2009. [47] T. R. Kurfess and J. S. Falcon, "Sensors and Actuators," in Robotics and Automation Handbook, Boca Raton, FL: CRC Press, 2005, pp. 240Â­242. [48] University of California Berkeley, "ME102 Lab 4: RC Servo." [Online]. Available: http://courses.me.berkeley.edu/ME102B/lab4.html. [Accessed: 10-Sep-2016]. [49] Bionik Laboratories, "ARKE Gen 2.0 User Manual Version 2." [50] Texas Instruments, "Tiva TM TM4C123GH6PM Microcontroller," Dallas, 2014. [51] Texas Instruments, "TI-RTOS: Real-Time Operating System (RTOS) for Microcontrollers (MCU)." [Online]. Available: http://www.ti.com/tool/ti-rtos-mcu. [Accessed: 01-Nov2016]. [52] Texas Instruments, "Getting Started with the TIVATM C Series TM4C123G LaunchPad,"
97

2016. [Online]. Available: http://processors.wiki.ti.com/index.php/Getting_Started_with_the_TIVA%E2%84%A2_C _Series_TM4C123G_LaunchPad. [Accessed: 06-Sep-2016]. [53] Roving Networks, "RN41XV & RN42XV Bluetooth Module." [54] Linear Technology, "RS485 Quick Guide," p. 1. [55] Texas Instruments, "RS-485 Reference Guide," Dallas, 2014. [56] Texas Instruments, "TivaTM C Series TM4C123G LaunchPad Evaluation Board User's Guide," Dallas, 2013. [57] M. N. O. Sadiku, Elements of Electromagnetics, 5th ed. New York, 2010. [58] D. M. Hockanson, X. Ye, J. L. Drewniak, T. H. Hubing, T. P. Van Doren, and R. E. DuBroff, "FDTD and experimental investigation of EMI from stacked-card PCB configurations," IEEE Trans. Electromagn. Compat., vol. 43, no. 1, pp. 1Â­10, 2001. [59] H.-H. Chou and Y.-S. Lee, "Experimental investigation and analysis of EMI in stacked I/O connectors of PCB," J. Electromagn. Waves Appl., vol. 30, no. 2, pp. 195Â­206, 2016. [60] C. Cham and Z. Bin Samad, "Brushless DC Motor Electromagnetic Torque Estimation with Single-Phase Current Sensing," vol. 9, 2014. [61] Texas Instruments, "Understanding the Terms and Definitions of LDO Voltage Regulators," Dallas, 1999. [62] Texas Instruments, "LM3940 1A Low-Dropout Regulator for 5V to 3.3V Conversion Output Voltage," Dallas, 2015.

98

[63] Texas Instruments, "LM340 , LM340A and LM7805 Family Wide VIN 1.5-A Fixed Voltage Regulators," Dallas, 2016. [64] Texas Instruments, "LM317A 1 % Accurate Three-Terminal Adjustable Regulator," Dallas, 2015. [65] Texas Instruments, "LM5010 High-Voltage 1-A Step-Down Switching Regulator," Dallas, 2016. [66] Texas Instruments, "LM5010 High-Voltage 1-A Step-Down Switching Regulator," Dallas, 2016. [67] A. Weiler and A. Pakosta, "High-Speed Layout Guidelines," Application Report, SCAA082, no. November. Texas Instruments, pp. 1Â­20, 2006. [68] Texas Instruments, "SN74LVC4245A Octal Bus Transceiver and 3 . 3-V To 5-V Shifter With 3-State Outputs," Dallas, 2015. [69] Texas Instruments, "SN74LV4T125 Single Power Supply Quadruple Buffer Translator GATE With 3-State Output CMOS Logic Level Shifter," Dallas, 2014. [70] R. Baldwin, S. Bobovych, R. Robucci, C. Patel, and N. Banerjee, "Gait analysis for fall prediction using hierarchical textile-based capacitive sensor arrays," 2015 Des. Autom. Test Eur. Conf. Exhib., pp. 1293Â­1298, 2015. [71] S. Schutz, K. Mianowski, C. Kotting, A. Nejadfard, M. Reichardt, and K. Berns, "RRLab Sea - A Highly Integrated Compliant Actuator with Minimised Reflected Inertia," in 2016 IEEE International Conference on Advanced Intelligent Mechatronics (AIM), 2016, pp. 4Â­ 9.

99

[72] T. Desplenter, J. Lobo-Prat, A. H. A. Stienen, and A. L. Trejos, "Extension of the WearME framework for EMG-driven control of a wearable assistive exoskeleton," IEEE/ASME Int. Conf. Adv. Intell. Mechatronics, AIM, vol. 2016Â­Septe, pp. 288Â­293, 2016. [73] M. Lancini, M. Serpelloni, S. Pasinetti, and E. Guanziroli, "Healthcare Sensor System Exploiting Instrumented Crutches for Force Measurement during Assisted Gait of Exoskeleton Users," IEEE Sens. J., vol. 16, no. 23, pp. 8228Â­8237, 2016. [74] Health Canada, "LIMITS OF HUMAN EXPOSURE TO RADIOFREQUENCY ELECTROMAGNETIC ENERGY IN THE FREQUENCY RANGE FROM 3 KHZ TO 300 GHZ - SAFETY CODE 6," 2015. [75] Health Canada, "List of Recognized Standards for Medical Devices," 2016. [Online]. Available: http://www.hc-sc.gc.ca/dhp-mps/md-im/standardsnormes/md_rec_stand_im_norm_lst-eng.php. [Accessed: 09-Dec-2016]. [76] Bluetooth SIG, "Security, Bluetooth Smart (Low Energy)," 2015. [77] Cypress Semiconductor, "CY5676A PRoCTM BLE 256KB Module with Bluetooth 4.2 Radio." [Online]. Available: http://www.cypress.com/documentation/developmentkitsboards/cy5676a-proc-ble-256kb-module-bluetooth-42-radio-0. [Accessed: 31-Aug2016]. [78] Texas Instruments, "TPS2113A - Autoswitching Power Mux," Dallas, 2012. [79] Linear Technology, "LT1076-5 - 5V Step-Down Switching Regulator," pp. 1Â­8. [80] Elmo Motion Control, "Gold Digital Servo Drives," 2016. [Online]. Available:

100

http://www.elmomc.com/products/gold-digital-servo-drives-main.htm. [Accessed: 09Dec-2016]. [81] S. Wang et al., "Design and Evaluation of the Mindwalker Exoskeleton," Ieee Trans. Neural Syst. Rehabil. Eng., vol. 23, no. 2, pp. 277Â­286, 2015. [82] UnifiedEngineering, "T-962 Improvements," GitHub. [Online]. Available: https://github.com/UnifiedEngineering/T-962-improvements. [Accessed: 31-Aug-2016].

101

GLOSSARY
0603 Â­ An SMD with a footprint measuring .006" x .003" 12V0 Â­ 12.0V 3V3 Â­ 3.30V 5V0 Â­ 5.0V A Â­ Amp or Ampere ARM Â­ Advanced RISC Machine, a family of microcontroller architectures BLDC Â­ Brushless DC BOM Â­ Bill of Materials C Â­ Capacitor CAD Â­ Computer Aided Design DC Â­ Direct Current DMM Â­ Digital Multimeter DOF Â­ Degree of Freedom DRC Â­ Design Rules Check FBE Â­ Full Body Exoskeleton FR4 Â­ A glass epoxy used as a common PCB material GPIO Â­ General Purpose Input Output I2C (or I2C) Â­ Inter-Integrated Circuit, a serial computer bus used for low speed peripherals IMU Â­ Inertial Measurement Unit, a device which measures forces and/or orientation. IO Â­ Input Output (see also GPIO) LUT Â­ Lookup Table Hz Â­ Unit of frequency JTAG Â­ Joint Test Action Group (also a common interface for programming microcontrollers) LED Â­ Light Emitting Diode MCU Â­ Microcontroller Unit MEMS Â­ Microelectromechanical systems MIPS Â­ Millions of Instructions Per Second, a unit of embedded performance P[X][#] e.g. PC4, PD5 Â­ A port identifier on a microcontroller PCB Â­ Printed Circuit Board PID Â­ Proportional Integral Derivative PWM Â­ Pulse Width Modulation R Â­ Resistor RX - Data Receive SCI Â­ Spinal Cord Injury SDK Â­ Software Development Kit SMD Â­ Surface Mount Device SPP Â­ Serial Port Profile TH Â­ Through Hole TX Â­ Data Transmit UART Â­ Universal Asynchronous Receiver Transmitter V Â­ Volt or Voltage VDD Â­ The positive power supply of a CMOS circuit

102

