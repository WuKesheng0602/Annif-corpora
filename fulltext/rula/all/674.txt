Ryerson University

Digital Commons @ Ryerson
Theses and dissertations

1-1-2003

De-noising the CN Tower lightning current signal using short term Fourier transform-based spectral substraction
Mohammed Jahirul Islam
Ryerson University

Follow this and additional works at: http://digitalcommons.ryerson.ca/dissertations Part of the Signal Processing Commons Recommended Citation
Islam, Mohammed Jahirul, "De-noising the CN Tower lightning current signal using short term Fourier transform-based spectral substraction" (2003). Theses and dissertations. Paper 188.

This Thesis is brought to you for free and open access by Digital Commons @ Ryerson. It has been accepted for inclusion in Theses and dissertations by an authorized administrator of Digital Commons @ Ryerson. For more information, please contact bcameron@ryerson.ca.

De-Noising The CN Tower Lightning Current Signal Using Short Term Fourier Transform-Based Spectral Subtraction

By

Mohammed Jahirul Islam (MSc. in Electronics and Computer Science, Shahjalal University of Science and Technology, Sylhet, Bangladesh, July 1997)

A Thesis Submitted in Partial Fulfillment of the Requirements for the Degree of Master of Applied Science in Electrical and Computer Engineering

School of Graduate Studies Ryerson University Toronto. ON, Canada August 2003

© Mohammed Jahirul Islam 2003

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

UMI Number: EC52885

INFORMATION TO USERS

The quality of this reproduction is dependent upon the quality of the copy submitted. Broken or indistinct print, colored or poor quality illustrations and photographs, print bleed-through, substandard margins, and improper alignment can adversely affect reproduction. In the unlikely event that the author did not send a complete manuscript and there are missing pages, these will be noted. Also, if unauthorized copyright material had to be removed, a note will indicate the deletion.

®

UMI
UMI Microform EC52885 Copyright 2008 by ProQuest LLC. All rights reserved. This microform edition is protected against unauthorized copying under Title 17, United States Code. ProQuest LLC 789 E. Eisenhower Parkway PO Box 1346 Ann Arbor, MI 48106-1346

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Abstract

,
I
i

f I

De-Noising The CN Tower Lightning Current Signal Using Short Term Fourier Transform-Based Spectral Subtraction

i '.
-i

I I
!
I
i

I

· s

i

I i

@Mohammed Jahirul Islam 2003 Master ofApplied Science in Electrical and Computer Engineering Ryerson University

The CN Tower is a transmission tower and it is not unexpected that recorded lightning current signals be corrupted by noise. The existence of noise may affect the calculation of current waveform parameters (current peak, 10-90% risetime to current peak, maximum steepness, and pulse width at half value of current peak). But accurate statistics of current waveform parameters are required to design systems for the protection of structures and devices, especially those with electrical and electronic components, exposed to hazards of lightning. Since more electrical devices are used nowadays, lightning protection becomes more important. So to determine accurate statistics of current waveform parameters, the interfering noise must be removed. In this thesis, we describe a technique for de-noising the CN Tower lightning current by modifying its Fourier Transform (FT) where a simulated current waveform (Heidler function) is used to represent the lightning current signal. The limitations of Discrete Fourier Transform (OFT) for removal of non-stationary noise signals, including the noise connected with CN Tower lightning current signals and its properties are discussed.

IV

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

The Short Term Fourier Transform (STFT) is explored to analyze non-stationary signals and to deal with the limitations of DFT. Last of all, an STFT-based Spectral Subtraction method is
I

developed to de-noise the CN Tower lightning current signal. In order to evaluate the Spectral Subtraction meth~ a simulated current derivative waveform (obtained by differentiating Heidler function) is artificially distorted by a noise signal measured at the CN Tower in the absence of lightning. The Spectral Subtraction method is then used to de-noise the distorted waveform. The de-noised waveform proved to be very close to the original simulated waveform. A signal-peak to noise-peak ratio (SPNPR) of the eN Tower lightning current signal is defined and calculated before and after the de-noising process. For example, for a typical measured current derivative signal, the SPNPR before de-noising is 7.27, and after de-noising it becomes 151.30. Similarly for its current waveform (obtained by numerical integration), the SPNPR before de-noising is 20.16 and it becomes 361.39 ·after de-noising. Statistics of current waveform parameters are obtained from the de-noised waveforms. The Spectral Subtraction method is also applied for de-noising the electric and magnetic field waveforms generated by lightning to the CN TowC?r which enables the calculation of their waveform parameters.

v

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Acknowledgements
I would like to express my deep gratitude and appreciation to my supervisor, Professor Ali M. Hussein for his invaluable guidance, encouragement and advice throughout my graduate studies. The financial support of Dr. Ali M. Hussein, School of Graduate Studies and the Electrical and Computer Engineering Department of Ryerson University, which made my study possible, are greatly appreciated. Special thanks go to Professor Sridhar Krishnan, Professor A. Anpalagan and Professor K. Raahemifar of the Electrical and Computer Engineering Department of Ryerson University,

and Professor W. Janischewskyj of the University of Toronto.
I would like to express my gratitude to Ms. Dawn Wright, Program Assistant of Electrical and Computer Engineering and Spatial Analysis Department, School of Graduate Studies, Ryerson University for her full-fledged support and encouragement. I would like to thank Mariusz Milewski, Petros Liatos, Kristopher Bitner and Ouarda Nedjah for their involvement in the Lightning Studies Project that enriched my experiences. Last, but not the least, I would like to express my sincere appreciation to my parents, wife and best friend, Niru and my son, Raeid, for their patience, continual support and understanding over the years of my graduate studies.

L

VI

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

I.
Table of Contents
List of Figures List of Tables
1 Introduction
1.1 Background 1.2 Motivations 1.3 Existing Solutions 1.4 Objective of Studies 1.5 Outline of the Thesis 1.1 1.7 1.9 1.11 1.12
IX XlV

1 Introduction to Non-Stationary Signal Analysis
2.1 Continuous Time Fourier Transforms (CTFT) 2.2 Discrete Fourier Transform (DIT) 2.3 Short Term Fourier Transform (STFf) 2.1 2.6 2.11

F

11

3 Formulation of the Algorithm
3.1 Spectral Subtraction Method 3.2 Heidler Function Revisited 3.1 3.7 3.23 3.27 3.38 3.44

I I

3.3 Formulation of the Proposed Algorithm 3.4 Implementation of the Proposed Algorithm 3.5 Results of the Proposed Method 3.6 Proposed Pre-Stroke Length of Lightning Signal

I
E

I I·
j

L'

Vll

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4 Obtaining Waveform Parameters 4.1 Definition of Wavefonn Parameters 4.2 Statistics of Current Wavefonn Parameters 4.3 Field Wavefonn Parameters 4.1 4.18 4.19 Fi@ FiiJ
Fi~

5

Conclusions
5.1 General Conclusions and Discussions 5.2 Original Contributions 5.3 Main Features 5.4 Future Work
5.1 5.3

Fi! Fil

5.4 5.5

Fij FiJ FiJ Fi:

Publications and Awards References Appendix

PI RI
Al

Fi Fi Fi Fi

Fi Fi

F

F
F
F

F
F
Vlll

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

List of Figures
Fig. 1.1: RID (Real Time Digitizer) connections at the CN Tower. Fig. 1.2: CN Tower lightning current derivative measuring system. Fig. 1.3: A typical lightning current derivative (dildt), File: F2Q50091.997 (1997). Fig. 1.4: The lightning current waveform of the signal shown in Fig. 1.3. Fig. 1.5: FFT of the CN Tower lightning current waveform of Fig. 1.4.

Fig. 2.1: Continuous time signal and its corresponding sampled signal. Fig. 2.2: Effect of different sampling rates. Fig. 2.3: Magnitude spectra of sampled waveforms shown in Fig. 2.2. Fig. 2.4: Windowing operation (Hanning window). Fig. 2.5: Magnitude spectra of different window functions Fig. 2.6: Overlapped frames using Hanning window. Fig. 2.7: Overlap Add procedure to reconstruct the signal. Fig. 2.8: Block diagram of STFT analysis! synthesis system.
~!
" "

Fig. 3.1: Block diagram of the overall Spectral Subtraction method. Fig. 3.2: Heidler function. Fig. 3.3: Distorted Heidler function. Fig. 3.4: FFT of distorted and original Heidler function. Fig. 3.5: Real part of the FFT. Fig. 3.6: Imaginary part of the FFT. Fig. 3.7: Modified and distorted FFT. Fig. 3.8: Modified and original FFT.
IX

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Fig. 3.9: De-noised and distorted Heidler function. Fig. 3.10: De-noised and original Heidler function. Fig. 3.11: Modified and distorted real part of the FFT. Fig. 3.12: Modified and distorted imaginary part of the FFT. Fig. 3.13: FIT of measured and de-noised CN Tower lightning current waveform. Fig. 3.14: Measured and de-noised CN Tower lightning current waveform. (File name: F2050091.997). Fig. 3.15: The proposed manual de-noising method. Fig. 3.16: Measured noise derivative and noise waveform at CN Tower. Fig. 3.17: Heidler Current and its derivative. Fig. 3.18: Distorted Heidler Current derivative and Heidler Current. Fig. 3.19: Comparison of distorted and de-noised (Using Spectral Subtraction) Heidler current derivative and Heidler current. Fig. 3.20: Comparison of de-noised and original Heidler current derivative. Fig. 3.21: Comparison of de-noised and original Heidler currents. Fig. 3.22: Segmented Signal into frames (1 ... 17). Fig. 3.23: The current waveform after de-noising the current derivative signal using different window sizes. File: 00363096.363. Fig. 3.24: The current waveform after de-noising the current derivative signal using different window sizes. File: 00363096.525. Fig. 3.25: The current waveform after de-noising the current derivative signal using different window sizes. File: 00363096.788. Fig. 3.26: Spectral Subtraction is applied on current derivative and de-noised current signal.

Fig. : Fig..

Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig Fig Fig Fig Fig

x

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Fig. 3.27: Spectral Subtraction is on current and de-noised current signal.

i!
i
i

Fig. 3.28: Comparison of de-noised current signals using Spectral Subtraction on current derivative and current. Fig. 3.29: New coil measured current derivative and its current waveform. Fig. 3.30: Old coil measured current derivative and its current waveform. Fig. 3.31: De-noised current derivatives. Fig. 3.32: Measured current derivative (New coil). Fig. 3.33: De-Noised current waveform Fig. 3.34: New coil current waveform. Fig. 3.35: Measured and de-noised di/dt using the proposed method. Fig. 3.36: Current waveforms from measured and de-noised di/dt. File: G0363096.363.

rent

Fig. 3.37: Measured and de-noised di/dt using the proposed method. File: G0363096.566. Fig. 3.38: Current waveforms from measured and de-noised di/dt. File: G0363096.566. Fig. 3.39: Measured and de-noised di/dt using the proposed method, File: G0363096.788. Fig. 3.40: Current waveforms from measured and de-noised di/dt. File: G0363096.788. Fig. 3.41: Spectrogram of measured di/dt. File: 00363096.363.

~ent

Fig. 3.42: Spectrogram of de-noised di/d!. File: 00363096.363. Fig. 3.43: Original and de-noised signals subtracting frame 2 and mean offrames 2:3

rent

Fig. 3.44: De-noised signals subtracting mean offrames 2:4, 2:5 and 2:6. Fig. 3.45: De-noised signals subtracting mean of frames 2:7, 2:8 and 2:9.

:rent

Fig. 3.46: De-noised signals subtracting mean offrames 2:10, 2:11 and 2:12. Fig. 3.47: De-noised signals subtracting mean of frames 2:13, 2:14 and 2:15.

nal.

Xl

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Fig. 4.1: Definitions of current derivative waveform parameters. Fig. 4.2: Definitions of current waveform parameters. Fig. 4.3: Measured and de-noised dildt. File: E0939244.931. Fig. 4.4: Expanded form of measured and de-noised dildt and its parameters. Fig. 4.5: Current waveform from measured and de-noised dild!. File: E0939244.931. Fig. 4.6: Expanded form of current waveform and its parameters. Fig. 4.7: Measured and de-noised dildt. File: E0939245.022. Fig. 4.8: Expanded form of measured and de-noised dildt and its parameters. Fig. 4.9: Current waveform from measured and de-noised dildt. File: E0939245.022. Fig. 4.10: Expanded form of current waveform and its parameters. Fig. 4.11: Measured and de-noised dildt. File: E0939245.073. Fig. 4.12: Expanded form of measured and de-noised dildt and its parameters. Fig. 4.13: Current waveform from measured and de-noised dildt. File: E0939245.073. Fig. 4.14: Expanded form of current waveform and its parameters. Fig. 4.15: Measured and de-noised dildt. File: £0939245.234. Fig. 4.16: Expanded form of measured and de-noised dildt and its parameters. Fig. 4.17: Current waveform from measured'and de-noised dildt. File: E0939245.234. Fig. 4.18: Expanded form of current waveform and its parameters. Fig. 4.19: Measured and de-noised dildt. File: E0939245.496. Fig. 4.20: Expanded fonn of measured and de-noised dildt and its parameters. Fig. 4.21: Current waveform from measured and de-noised dildt. File: E0939245.496. Fig. 4.22: Expanded fonn of current waveform and its parameters. Fig. 4.23: Measured and de-noised dildt. File: E0939702.021.
t

Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig. Fig.
~

I
J

xu

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Fig. 4.24: Expanded form of measured and de-noised di/dt and its parameters. Fig. 4.25: Current waveform from measured and de-noised di/dt, File: E0939702.021. Fig. 4.26: Expanded form of current waveform and its parameters. Fig. 4.27: Measured and de-noised di/dt. File: E0939705.211. Fig. 4.28: Expanded form of measured and de-noised di/dt and its parameters. Fig. 4.29: Current waveform from measured and de-noised di/dt. File: E0939705.211. Fig. 4.30: Expanded form of current waveform and its parameters. Fig. 4.31: Measured and de-noised electric field, frame length: 512. Fig. 4.32: Measured and de-noised electric field, frame length: 1024. Fig. 4.33: Measmed and de-noised electric field, frame length: 2048. Fig. 4.34: Measured and de-noised electric field, frame length: 3072. Fig. 4.35: Measured and de-noised magnetic field, frame length: 512. Fig. 4.36: Measured and de-noised magnetic field, frame length: 1024. Fig. 4.37: Measured and de-noised magnetic field, frame length: 2048. Fig. 4.38: Measured and de-noised magnetic field, frame length: 3072. Fig. 4.39: Measured and de-noised electric field, File: E0937718.741. Fig. 4.40: Measured and de-noised electric field, File: E0945656.601. Fig. 4.41: Measured and de-noised magnetic field, File: E0934418.741. Fig. 4.42: Measured and de-noised magnetic field, File: E0945656.601.

Xlll

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

List of Tables
Table 2.1: General properties of the DIT.

I I

I I

I

I

Table 2.2 Properties of some fixed window functions.

Table 3.1: SPNPR using different window sizes. File: G0363096.363. Table 3.2: SPNPR using different window sizes. File: G0363096.525. Table 3.3: SPNPR using different window sizes. file: G0363096.788.

I
I I
I t
!!!
~

Table 4.1: Waveform parameters and their statistics. Table 4.2: SPNPR using different window sizes. Table 4.3: Electric field waveform ~eters. File: E0934418.741. Table 4.4: Electric field waveform parameters. File: E0945656.60 1. Table 4.5: Magnetic field waveform parameters. File: E0934418.741. Table 4.6: Magnetic field waveform parameters. File: E0945656.601. Table 4.7: Field waveform parameters, May 09, 2002

J

XlV

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Chapter 1
Introduction
Lightning is one of the fascinating events of nature. Although the preliminary understanding of the lightning phenomenon was established by Benjamin Franklin early in the eighteenth century. it is still one of the major subjects in modem research [1]. The present research interest in the lightning area is mostly concerning ,on the protection of electrical and electronic components that are exposed to hazards of lightning such as those used in eledric power lines, telecommunication systems, aircrafts and spacecrafts. Since more sensitive electronic devices are used nowadays, lightning protection has become more important than ever. In the meantime the development of high
~

high quality measuring instruments and advanced

analysis methods make it possible to study lightning characteristics more precisely and efficiently.

1.1 Background
f
t

1
I

, 1

t

It is observed that tall structures receive more lightning strikes than plain ground. Traditionally

they are very useful in studying characteristics of lightning. The Toronto Canadian National (CN) Tower, with a height of 553 m, is the tallest manmade freestanding structure in the world. While the local lightning flash density in Toronto area is less than 2 flashes per square kilometer per year. the tower usually receives many tens of direct strikes during a lightning season. For example, during the summer of 1991. the CN Tower was hit with 72 flashes. 24 of

1.1

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

which occurred within 100 minutes in the early momma of July 7. Therefore, the CN Tower
pesen1S one of the best sites in the world to study the

liaJUnins phenomenon [2, 3].

IJptDiq Parameten MeasariDllDItrumeDtatioa
LiaJUning strikes to the CN Towel' have been monitmcl since 1978, t\\O years after its erection (3]. Successful simultaneous measurCments of significant parameters of CN Tower lightning s1rikes have been performed since the Sllmmel' of 1991 [2J. By the beginning of the summer of : 1991, five meas.uring .tiODl wen: operating to simultaneously measure seven of the most
j

importaDt lishtnins parameters eli:

i

f

The curmIt derivative measuring station is one of the five measuring stations, and it is installed t'
at the CN Tower.

I
Du
To~

A 4O-MHz Roaowaski coil, placed at the 474-m above ground level (AGL),

captures approximately 20'10 of the current derivative si~ it encircles one fifth of the Tower's
steel struetuJe. The coil is CODDeCted, via a tri-axial cable, to · 10-bit, 10-ns, computer

controlled double channel digitizer with segmented memory (Tektronix 710A) as shown in Fia.
. .. .

1.1, presently placed at the 403-m AGL. The digitizer has two cbannels and it provides a 10000t
sipal at ±O.4% accuracy and 200 MHz maximum samplins rate for a single channel operation
{

;:..:,'

~

100 MHz maximum sampling rate for both channels.
'.,

.

The

1.2

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

RID

,',

son
Terminator

BNC- TRIAX I-----'~_...,.........,: To Coil '---===~ "'"' ADAPTER

,

Figan 1.1: RID (Real Time Digitizer) Comectio~ at the CN Tower.

During the summer of 1997, a noise-protected current measuring system was placed at the

Tower. This system features 'a DeW Rogowaski coil surrounding the whole steel structure of tile
,: .,

Tower at_the S09-m AGL and is cormected to the recording station via an optical fiber link.
,

.

The lightning current derivative (dVdt) measurement system at CN Tower is shown in Fig. 1.2.

1.3

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Tower Tip (553 m) New Rogowski Coil (509 m)

AtYJ
,0" , -. . .

wave
...

Old Rogowski Coil (474 m)---"

Recording Instrumentation

·

I I
, ;;·
j

i

sho\\ 100 : resol is the

~
i

,

I

I

VHS
HSC
RSV

Fields

West

Figure l.2:

eN Tower lightning current derivative measuring system.
l.4

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

A typical current derivative waveform (recorded by the old coil) and its corresponding current waveform (obtained through time integration) of a CN Tower lightning stroke are, respectively, shown in Figs. 1.3 and 1.4. Each dildt record contains 16 kilobytes (kB) of data recorded at 100 MHz (10 ns resolution). In some cases the last 2 kB of data recorded at 20 MHz (50 ns resolution). The digitized data is transferred and stored in a computer at the same time. Fig. 1.5 is the magnitude spectrum of the lightning current waveform of Fig. 1.4.
40
D

30

}2O

1 I
10 0
U

I

-10

-20 -100

-50

0

.50

100

150

200

T"'I_J

Figure 1.3: A typicalljghtning current derivative (dildt), File: F2050091.997 (1997).

1.5

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

1.~
18

16
14 12

Tht
cur
rna,

I
U

~

_10

der
8

6
4

2
0

=100

-so

o

50 Tm.(u.)

100

150

200

Figure 1.4: The lightning current waveform of the signal shown in Fig. 1.3.

4

-1~--~--~--~--~--~~--~--~--~--~--~

o

20

40

80

80 100 120 Frequency [kHz]

140

160

180

200

Figure 1.5: FFT of the CN Tower lightning current waveform' of Fig. 1.4. 1.6

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

1.2 Motivations
The eN Tower itself is a transmission tower and it is not unexpected that recorded lightning current signals be corrupted by noise. From the waveforms Fig. 1.3 and Fig 1.4 and the magnitude response of the current waveform in Fig. 1.5, it is obvious that the measured curr~nt derivative and the current waveform is affected by various types of noise. These are as follows:

1. DCOjJset
There is a noticeable DC offset. in the typical dildt and current waveform and this interference is projected as a noticeable ramp after integration (Fig. 1.4). This offset may

be caused by the lightning charge to the measuring circuit.
2. High Frequency Noise
This type of noise does not have much effect on the waveforms with high peak values of

di/dt. h does make the waveform shape unclear and peaks indistinct. 3. Low Frequency Noise around 100 kHz
The interference oscillating around 100 kHz is normally slow in comparison with fastrising current waveforms. Nevertheless, with this interference present, it is hard to calculate the current waveform parameters (peak, maximum steepness and 10%- 90% risetime) [4].

4. ReflectiOns
The discontinuities of the tower's structure cause several reflections when the lightning' current is transmitted through the tower, It can be seen from the dildt (Fig. 1.3) and current waveform (Fig. 1.4) wavefonns that they have several distinct peaks after the first peak:. The peaks appearing after the first peak: are results of reflections from abrupt changes of the towers' structure. This is the reason why the absolute peak of current waveform is not considered as the injected current peak. However, for slow-rising injected current, the first

1.7

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

peak may not represent the injected current peak, because the injected current reaches its peak after the first reflection arrives [5].

1.31

Lightning current data collected at the eN Tower since 1991 are corrupted with noise. Because of these kind of noise, there have been serious limitations concerning the use of the CN Tower
current data captured during more than one decade (1991-2003). In order to determine statistics

I I
I
I
~

For th

backgJ
level' appeal

unkno

concerning current wavefonn parameters, these parameters (maxirnwn steepness, current peak,
10%- 90% risetime to current peak, absolute peak and pulse width) must be accurately determined. Cumulative statistics based on extensive data and accurate current waveform parameters are needed to help in the establishment of more sophisticated protective measures against lightning hazards. This major objective cannot be realized without de-noising the measured current signal.

The

fii

make~

attemJ

Amon of the

Most
currer The Ie

rneaSl
Interfc and i1

the ac

1.8

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

t

I

i

--

1.3 Existing Solutions
For the current derivative signal measured by the old Rogowski coil, the value of the usual background noise is about 50 m V [4]. However there were periods of time when the noise level was much higher, reaching up to 500 m V. The source of high amplitude noise that appears often has not yet been identified. The source of low frequency (100 kHz) noise is still unknown and the source of the high frequency noise is the broadcast antennas.

The noise embedded in a lightning waveform contains a broad spectrum of frequencies which makes it very difficult to eliminate without losing part of the lightning signal itself. To date attempts to de-noise CN Tower lightning current signals have not yielded satisfactory results.

Among different types of interference, DC offset is easy to remove by subtracting the average of the pre-stroke portion of the current derivative signal. Most of the high frequency noise is removed when the numerical integration of the recorded current derivative is performed to determine the current waveform. The low frequency noise is· difficult to remove using existing software filters because of its frequency modulated nature which lies within the wideband frequency response of the measured signal. Interference due to reflections is basically dependent on the structural discontinues of the tower and it is possible 10 remove using the transmission line model of the tower. So the low frequency noise, oscillating around 100 kHz is the dominant one that should be removed to get the accurate statistics of the lightning current waveform parameters.

1.9

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

In order to remove the interference from the lightning current signal adaptive filtering technique [7] has been tried to de-noise low frequency components and the success is limited.

1.4 0
Thema

Because, the proposed algorithm is more suitable for signal of unlimited length. Therefore, for 1 unlimited signal no difficulty is encountered in estimating and eliminating the interference; in ! such cases, the algorithm has enough time to identify the interference. However, signals with , limited length may be affected by unidentified inrerferences of short duration like . CN tower
~

i

~

1.

I

2.

I
1

3.

lightning current signals. In such cases, the algorithm loses its effectiveness in eliminating the ~ noise due to the fact that it lacks enough infonnation for proper identification of the noise.

.

1

i

It is evident from the limitations of the adaptive filtering technique that a new method needs to be devised to de-noise low frequency noise components around 100kHz. This thesis proposes a method of de-noising the CN Tower lightning current signal by applying STFT-based Spectral Subtraction. The proposed method takes the measured current derivative as its input and outputs the denoised current derivative that can be used to obtain the values of current derivative and current waveform parameters, w~ch eventually helps to design a protection systems to deal with hazards of lightning.

1.10

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

g

1.4 Objective of Studies
The main objectives of this thesis are:

L
r

1. To develop an appropriate method for de-noising the eN Tower lightning current signal.
1

2. To determine waveform parameters from the de-noised waveforms and establish a set
1

of statistics data. 3. To apply the proposed method for de-noising the electric and magnetic field signals generated by lightning strikes to the CN Tower and to obtain their waveform parameters.

1.11

j
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

I.S Outline of the Thesis
In chapter 2, Continuous Time Fourier Transform (CTFT), Aliasing and Nyquist theorem, Discrete Fourier Transform (DFT) and its properties are described to analyze the frequency components of a signal. Fast Fourier Transform (FFT) is a computational tool of Fourier

C]
Inl
IntlJ

transform. So FFT is used for the above purpose and the limitations ofDFT are described. For Disc non-stationary signal analysis, Short Term Fourier Transform (STFT) is suitable which is the

diife
advanced form of Fourier Transform. In this chapter STFT is also described. The properties

fom
and relative merits of various window functions are described in this chapter to select the best window for our problems.

2.1
In chapter 3, the STFT-based Spectral Subtraction is described. A simulated current waveform, called Heidler function, is used to model the lightning current signal. This function is basically used to propose the final method called STFT- based Spectral Subtraction method for denoising the CN Tower lightning current signal. This STFT- based Spectral subtraction method is formulated and implemented in this chapter. We compared the de-noised waveforms to those measured by the new coil. Results of the proposed method applied on the measured di/dt are also reported in this chapter.
In chapter 4, lightning current derivative and integrated current waveform parameters and t.heir

The
It de

ofa

The

statistics are obtained from the waveform de-noised by the proposed method. The proposed method is applied on the electric and magnetic field waveforms, generated by lightning strikes to the tower and their corresponding parameters are obtained in this chapter. Final Conclusions, including discussions, major contributions, main features and future work are reported in Chapter 5.

1.12

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Chapter 2
Introduction to Non-Stationary Signal Analysis
In this chapter, Continuous Time Fourier Transform (CTFf), Aliasing and Nyquist Theorem, Discrete Fourier Transform (DFT), its properties and pitfalls, Short Tenn Fourier Transfonn, different window functions, their properties and the relative merits that will eventually help to fonnulate the proposed method are descnbed.

2.1 Continuous Time Fourier Transform (CTFf)
The Fourier transform is used to transform a continuous time signal into the frequency domain. It describes the continuous spectrum of a nonperiodic time signal. The Fourier transform X(f) of a continuous time function x(t) can be expressed as

X(f)= Jx(t)e- J2Jrft dt
-00

00

(2.1)

The inverse transform is

00

x(t)

=

IX(f)eJ2nftdf
-00

(2.2)

2.1
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

2.1.1 Sampling and Aliasing
In many common situations in engineering a function x(t) is sampled When a function is evaluated by numerical procedures, it is always necessary to sample the function in some manner, because digital computers cannot deal with analogue, continuous functions (except by sampling them!). Often the function is not even explicitly defined, but only known as a series of values recorded on tape, data logger or computer.

I

Cor
inl inte re81
It i:

free the!

AID Converters

por

If the signal to be analyzed is analogue in nature then it must be converted into digital form, as it is sampled, by an analogue to digital (AID) converter.

Sampling
If delta is the time interval between consecutive sampl~s, then the sampled time data can be

pro
Iml thal

represented as

hl1 = h(nA)

n

= 0, ± 1,

±2 ...

ratc
phc

I \

1\

\

\
Time Time
.'
.'

Figure 2.1: Continuous time signal and its corresponding Sampled signal.

2.2
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

lr~
"'I

I
Consider an analogue signal x(t) that can be viewed as a continuous function of time, as shown in Fig. 2.1. We can represent this signal as a discrete time signal by using values of x(t) at intervals of nT, to form x(n) as shown. We are "grabbing" points from the function x(t) at regular intervals of time, T, , called the sampling period.
It is usual to specify a sampling rate or frequency Is rather than the sampling period. The

I
'/

frequency is given by Is

~

1ITs. where Is is in Hertz. If the sampling rate were high enough,

then the signal x(t) could be constructed from x(n) by simply joining the points by small linear portions. This approximates ' the analogue signal.

Aliasing and the Nyquist Theorem

One would expect that if the signal has significant variation then Ts must be small enough to provide an accurate approximation of the signal x(t). Significant signal variation usually implies that high frequency components are present in-the signal. It could therefore be inferred that the higher the frequency of the components present in the signal, the higher the sampling rate should be. If the sampling rate is not high enough to sample the signal' correctly then a phenomenon called aliasing occurs.

!,

2.3
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

i t
(8). 0.001 5 samplng rate

(b). 0.01 s samplng rate
1

1

0.5

i~

I

o
-0.5

:

!

I
o
0.2

-1

\~
0.4

\ II
v.
0.8

0.5

o
-0.5

~
~2

~

I ,
J

Freq

Whe:
occu

I
;

0.6

~

I
\
1

-1 V

o

'j ~

saml
J
O~ O~

OA

j

(C). 0.05 s S8fI1lIng rate.

(d). 0.1

s salJ1)lng rate

0.5

O~~
o
-0.5 -1

1~~~--~--~------~

o
-0.5

~.

~
0.8

L . - - - - ' - _ - ' - - - - - - ' -_ _ _ _ ',,----'

02

0.4

0.6

0.8

1

o

02

0.4

0.6

1

Figure 2.2: Effect of different sampling rates. The Fig. 2.2 shows the effect of different sampling rates when sampling the function cos(60t). The tenn aliasing refers to the distortion that occurs when a continuous time signal has frequencies larger than half of the sampling rate. The process of aliasing describes the phenomenon in which components of the signal at high frequencies are mistaken for components at lower frequencies. The Nyquist Sampling Theorem states that to avoid aliasing occurring in the sampling of a signal the sampling rate should be greater than or equal to twice the highest frequency present in the signal. This is referred to as the Nyquist Sampling Rate. free the: free

2.4
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Frequency Domain View ofSampling
When a continuous time signal is sampled, its spectrum will show the aliasing effect if aliasing occurs because regions of the frequency domain will be shifted by an amount equal to the sampling frequency.
(a). 8ampIIng FI'eCJ*ICY= 1000 Hz
~r---------~--------,

(b). Samplng Frequency: 100 Hz
400r---------~--------,

No Aliasing

400

No Aliasing

300

I

I

100
o~--------~--------~ -500 0 500
Frequency [Hz}
-~
o~------u-~u-------~

0

~

Frequency [Hz}
(d). San1Jing Frequency: 10 Hz
50r---------~--------,

(e). Samplng Frequency= 20 Hz
100r---------~--~----~

No Aliasing

Aliasing

80

40

-830
j20
20

~ a

0....
-10 -5 0 5 Frequency [Hz)

~
10

Figure 2.3: Magnitude spectra of sampled waveforms shown in Fig. 2.2. The magnitude spectra of the signals in Fig. 2.2 that were sampled at different sampling frequencies of 1000 Hz, 100

Hz. 20 Hz and

10

Hz. respectively are shown in Fig. 2.3. From

these figures it is clearly observed that if the sampling frequency is less than the Nyquist frequency, aliasing occurs.

2.5
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

2.2 Discrete Fourier Transform (DFT)
The Discrete Time Fourier Transform (DTFT) or simply Fourier Transform X(e itD ) of a discrete-time sequence x(n) is defined by and

X(e

JCO

)

= Lx(n)e-JQI

00

(2.3)

In case of finite length sequence x(n), 0 S n S N -I, there is a simple relation between the
sequence and its DTFT X(eidl).In fact for a length-N sequence. only N values of X(e i"'). called the frequency samples, at N distinct points.
(J)

The
The disc
out

=

(J)k

,OS k S N -1, are sufficient to

determine x(n) and hence, X(e i "'). uniquely. This leads to the concept of the Discrete Fourier Transform (OFT), a transform-domain representation that is applicable only to a fmite-Iength

COlI

sequence.
Whl

The simplest relation between a finite-length sequence x(n), defined for 0 S n S N -1, and its DTFT X(e
jtD )

effie
inte

is obtained by uniformly sampling X(e

1d1

)

on the

(J)

-axis between

App
OSkSN-I
(2.4)

The mw

Note thatX(Ic) is also a finite-length sequence in the frequency domain and is oflengthN The sequence X(Ic) is called the Discrete Fourier transform (DFT) of the sequence x(n). The Inverse discrete Fourier Transform (10FT) is given by

erro
Wh

x(n) =

-L X(k)e N
N-I
k=O

1

end
j2n1m/

/N
'

OSnSN-I

(2.5)

conl
COD1

Using the commonly used notation WN

=e

-12

%
N

we can rewrite Eq. (2.4) and (2.5) as

2.6
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

N-I

X(k)
and

= Lx(n:WN kn
n=O

t

O:s k SN-l

(2.6)

1 N-I

x(n)=-LX(k)WN kn N k=O '

OSn:SN-l

(2.7)

The Fast Fourier Transform
The Fast Fourier Transform (FFT) is simply a class of special algorithms which implement the discrete Fourier transform with considerable savings in computational time. It must be pointed out that the FFT is not a different transform from the DFTt but rather just a means of computing the DFT with a considerable reduction in the number of calculations required. While it is possible to develop FFT algorithms that work with any number of points maximum
t

efficiency of computation is obtained by constraining the number of time points to be an integer power of tw07 e.g. 1024 or 2048.

Approximation ofContinuo~ Time Transforms with the DFT
The approximations involved when using the. DFT in the analysis of continuous time systems must be carefully understood. There are problems that arise in the process that may lead to erroneous results unless proper precautions are taken. While the mathematical properties of the DFT are exact, the DFT is seldom of interest as the end goal. It is usually employed to transform data which may arise from either an actual continuous time process or perhaps a discrete time process which is being analyzed from a continuous time system approach. The DFT is usually used to approximate the Fourier

2.7

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Transform of a continuous time process, and it is necessary to understand some of the limitations inherent in this approach. There are two possible phenomena that result in errors between the computed and the desired transform [8, 9]. These two phenomena are (a) picket-fence effect, and (b) leakage.

The it lead t move allevi sprea To s\ conti

(a) Picket-Fence Effect: This effect is produced by the inability of the DFT to observe the
spectrum as a continuous function, since computation of the spectrum is limited to integer multiples of the fundamental frequency 21I / N (reciprocal of the sample length N). Observation of the spectrum with the DFT is analogous to looking at it through a sort of "picket-fence," since we can observe the exact behavior only at discrete points. The major peak of a particular component could lie between two of the discrete transform lines, and the peak of this component might not be detected without some addition processing. One procedure for reducing the picket-fence effect is to vary the number of points in a time period by adding zeros at the end of the original record, while maintaining the original record intact. This process artificially changes the period, which in turn changes the locations of the . spectral lines without altering the continuous form of the original spectrum. In this manner, spectral components originally hidden from view can be shifted to points where they can be observed. (b) Leakage: This problem arises because of the practical requirement that we must limit observation of the signal to a finite interval. The process of terminating the signal after a finite number of terms is equivalent to multiplying the signal by a window function. The net effect is a distortion of the spectrum. There is a spreading or leakage of the spectral components away from the correct frequency, resulting in an undesirable modification of the total spectrum.

2.8
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

,

I 1
The leakage effect cannot always be isolated from the aliasing effect because leakage may also lead to aliasing. Since leakage results in a spreading of the spectrum, the upper frequency may move beyond the Nyquist frequency, and aliasing may then result. The best approach for alleviating the leakage effect is to choose a suitable window function that minimizes the spreading. To summarize this section, the DFT algorithm can be used to approximate the transform of a continuous time function, subject to the following limitations and difficulties. 1. The signal must be band limited, and the sampling rate must be sufficiently high to avoid aliasing. 2.
If it necessary to limit the length of the signal for computational purposes, the

spectrum will be degraded somewhat by the leakage effect. Leakage is most severe when the simple rectangular window function is used. 3. Components lying between discrete freQuency lines are subject to error in magnitude due to the "picket-fence" effect. 4. The magnitude level may be different from that of the continuous-time transform due to the variation in definitions.

j

}

2.9

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

I

2.2.1 Discrete Fourier Transform Properties
There are a number of important properties of the DFf which are useful in digital signal processing applications [10]. These are tabulated in Table 2.1. Table 2.1: General properties of the DFf. Type of Property

2.3
Ades comp the si

Length-N Sequence
g(n) h(n). G(lc) H(lc)

N-pointDFT

subse its DI safel descTl

Linearity Circular time-shifting

ag(n) + fJh(n)

aG(k) + fiH(k) WNkonG(k)
.'

OFf
DFT
pritru

g((n -nO)N)

Circular frequency-shifting

WN -kon g(n)
G(n)
N-J

G((n-nO)N)

Duality N-point circular convolution

.

N{g(-k)N}
~

comp lnthi Fouri

L g(m)h((n - m) N)
m:={)

G(k)H(k)

The:
1
N-l

Modulation

g(n)h(n)

-LG(m)H((k-m)N) N_o
N-l

short
DFT~

Parseval's relation

1

N-l

ncO

I:lx(nt = -I:IX(kt N taO

(poss
ofle)
The:
wind

.
2.10
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.
~
~':. ~

.. -

2.3 Short Term Fourier Transform (STFT)
A description of a non-stationary signal in the frequency domain using a simple DFT of the complete signal will provide misleading results [10]. To get around the time-varying nature of the signal parameters, an alternative approach would be to segment the sequence into a set of subsequences of short lengths, with each subsequence centered at uniform intervals of time and its DFT computed separately. If the subsequence length is reasonably small, the signal can be safely assumed to be stationary for, practical purpOses. As a result, the frequency-domain description of a long sequence is given by a set of short-length OFTs, i.e., a time-dependent OFT that is called STFT. DFT based analysis/synthesis methods are very prevalent in signal processing literatures, primarily due to the existence of Fast Fourier Transform (FFT) algorithms, which allow the computation of the DFf to be performed in O(N log N), rather than O(N2} computations. In this section we present a particular Fourier based analysis method called the Short Term Fourier Transform (STFf) [11, 12]. The DFT operates on finite length (Length N) sequences. The STFT is a formulation that can represent sequences of any length by breaking them into shorter blocks, or frames, 'and applying the DFT to each block. Since we are using length N DFTs, we must take the frames length M
~

N. A frame is constructed by multiplying the

(possibly) infinite length sequence x(n} by a length M window w(n}. The resulting sequences oflength M can now be represented completely by length MDFTs.
The Short Tenn Fourier transfonn operates by windowing a signal. Let us define a length M

windowed frame of data by:
Xm (n) = x(n)w(n-

mS)

(2.8)

2.11

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Where m is the frame number and S is the "frame spacing" or "frame skip" number of samples advanced between frames. The windowing operation for a given frame is illustrated in the Fig. 2.4.

a

lao

2act

Jaa·

..aa

lact

loa

7act

laa

oaa

teUla

0.1
a~--~---L--~----~--~~~--~~~~--~--~

a

faa

2act

3aa

..00

lact

.oa

700

lOa

oaa

faoo

C.OI
o~----------------------~

a.

faa

lact

aaa

.aa

lact

eaa

7aD

laa

laa

laact

Figure 2.4: Windowing operation (Hanning window).

Now define the fixed-time-origin sequence
Xm(n) == x(n+mS)w(n)
(2.9)

where,
w(n) =0; n<O, n ~M
(2.10)

2.12
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

j\~

!

I

s
Then we can define the OFf of
r ,.

X m (n)
m

:
N-l

X

(k)

=L

Xm

(n)e-jtDj;n

(2.11)

n=O

This expression, a function of discrete frequency index t, and a frame index m, is the STFT of
i

x(n). Thus the STFf expresses a signal x(n) as a series ofDFfs of windowed frames of x(n).

It

I

Any time that S S N, it is possible to resynthesize x(n) from its STFf. In order to STFT synthesis using Overlap Add method, the windows and frame ·skip parameter (S) must be designed to meet the "Overlap Add (OLA) condition:"
00

~w(n-mS)=l
m=~

(2.12)

If the Overlap Add condition is met, then
00 00

x(n)=x(n)~w(n-mS)= ~xm(n-mS)
m=~ m=~

(2.13)

It is always best to design w(n) and S so that the STFf can be inverted using Overlap Add

method.

The problem with STFT is the fact that its roots go back to what is known as the Heisenberg
)

Uncertainty Principle. This principle originally applied to the momentwn and location of
moving particles, can be applied to time-frequency information of a signal. Simply, this principle states that one cannot know the exact time-frequency representation of a signal, i.e., one cannot know what spectral components exist at what instances of times. What one can

2.13

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

I ~ know are the time intervals in which certain band of frequencies exist. which is a resolution;
ill

\
.i

problem [13]. 2.3.1 Window Selection In the STFT analysis of non-stationary signals, the window plays an important role. Both the length and shape of the window are critical issues that need to be examined carefully. The function of the window w(n) is to extract a portion of the signal for analysis and ensure

I ,
i

·
~

the

TI
Rc

j

1 that the extracted section of x(n) is approximately stationary. To this end the window length M :

~

;

H

should be small, in particular for widely varying spectral parameters. A decrease in the window length increases the time-resolution property of the STFf, whereas the frequency-resolution· property of the STFT increases with an increase in the window length. A shorter window thus provides a wideband spectrogram while a longer window results in a narrowband spectrogram. The two frequency-domain parameters characterizing the DTFT of a window are its main lobe width A ML and the relative sidelobe amplitude
f.

As' . The fonner parameter determines the

1

ability of the window to resolve two signal components in the vicinity of each other, while the latter controls the degree of leakage of one component into a nearby signal component. It thus follows that in order to obtain a reasonably good estimate of the frequency spectrum of a timevarying signal, the window should be chosen to have a very small relative sidelobe amplitude with a length chosen based on the acceptable accuracy of the frequency and time resolutions. The considerations of narrow l'ilain lobe and very low amplitude sidelobes to avoid the "smearing" of the spectrum must be balanced against the OLA condition The windows with the very best frequency selectivity, including the Hamming window, the Kaiser window doesn't satisfy the OLA condition.

2.14
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

The three most common windows that meet the OLA condition are the rectangular window, the triangular window and Hanning window. The various window functions of length 2M+ 1 are listed below: Rectangular window is given by:
1,O~1 nl~M

) WR ( n
Hanning window is given by:

=

{

o,otherwise

(2.14)

wen) =

![1
2
'

+

cos( 2M 21l1l J] +1 '
2M +1 '
21l1l

-MSnSM',

(2.15)

Hamming window is given by

wen) = 0.54 + 0.46C9 S(

J

-MSnSM

(2.16)

Table 2.2 summarizes the essential properties of the above window functions. Table 2.2 Properties of some fixed window functions.
Type of window Main lobe width A ML Relative sidelobe level 13.3 dB 31.5 dB

Asl

Rectangular Hanning Hamming

4% (2M +1) 8%
If (2M

. + 1)

8% (2M + 1)

42.7 dB

2.15

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Magnitude Spectra ofDifferent Window Functions
To get the magnitude spectra of most commonly used window functions like Rectangular, Hamming and Hanning window a sinusoidal signal of frequency 25 Hz is windowed using different windows and their magnitude spectra is shown in Fig. 2.5.
SifIJsoIdII Sip (25 Hz) Mas;ritude Spectra (Rectarvur Window)
20.---~--~---------.

0.5

o

l-20
Q,

1-40
-80 0

-0.5
-1~~~~~~~~~~

o

0.4 0.6 0.8 Time [S] Mas,ntude Spectra [Harming Window]

0.2

10

202530 Frequency [Hz)

40

50

Mapude Spectra IHamng Window) 4

4r---~--~~~------~

2

iii :2-

0

J
10 20 ·25 30 40 50

-2 -4

10

20 25 30
F~[Hz)

40

50

Frequency [Hz)

Figure 2.5: Magnitude spectra of different window functions

Lightning current derivative (di/dt) is segmented and windowed such that in the absence of spectral modifications, if the synthesis segments are added together, the resulting overall system reduces to an identity that is the Overlap Add (OLA) condition to reconstruct a signal. To improve the frequency resolution, one must use a window with a very small main lobe width, and to reduce the leakage, the window must have a very small relative sidelobe level

2.16
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

.f

(

-Ii
'/

[10). The main lobe width can be reduced by increasing the length of the window. Considering these parameters for window selection, Hanning window of length 2048 with number of overlapping points 1024 is chosen for this application [9].

i

2.3.2 Choice ofFFT Length Once we have decided the window function w and a length M, we can compute the OFT of this frame. The size, N. of this OFf must be at least M with additional samples being produced via "zero-padding". There are several issues involved in choosing a good value for N. First, in order to take advantage of the computational efficiency of the FFT algorithm, it is recommended to take N to be a power of 2. Secondly, the visual display produced by the analysis will be represented by N samples of OFT. The last issue to be considered in choosing the FFT length is based on the fact that we may modify the STFI before performing the resynthesis (14).

2.3.3 Number ofOverlapping Points The decision for choosing overlap points is very application dependent. If the signal under analysis has rapid transients, then the analysis frame may require overlapping so that the overlapped portion contains the transients for better results. However, if the analysis is being performed with the ultimate goal of performing re-synthesis (with possible modifications), then there are more specific requirements. Usually, the length of overlapped points is half of the window width that is Ml2. The Fig. 2.6 shows the overlapped frames.

2.17

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

ll~

,,'I

Figure 2.6: Overlapped frames using Hanning window.
2.3.4 Signal Reconstruction

In STFT. the method that is used for reconstructing the signal is called Overlap Add Method. The overlap-add procedure showing the sum of three overlapping frames is shown is Fig. 2.7.

~

..:[
a

: taa
taa

10..-<.1...-

... ,
2aD

~"1 .. t!-81

:
eaa 7ao me eaa
tOO

]
taao
'DO

laa

.aa

lao

.~[
-C.Da

a

:

:;;:~ : laa 04aa lao laa
2QQ

ma

eaa

taaG

]

~

..:[
a

taa

aGa

:

.~
.. aa
SQQ

eaa

7QQ

eaa

eaa

taaG

]

..

~[
a

-C.Da

: toa

~I
2aD

laO

"ao

lao

eaa

700

:

]
ma eoo taDa

Figure 2.7: Overlap Add procedure to reconstruct the signal.

2.18
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

(
I
I
I
2.2.5 Overall System
In STFT, window type and size, length of FFT, length of overlapping points, etc. are basically

application dependent. Once all parameters are selected for windowing and FFT. the next

I "
'9

t

procedure is frequency domain modifications (problem dependent). Then using Overlap Add procedure, the signal can be reconstructed The overall system block diagram is shown in Fig. 2.8. Lightning Signal Modified Lightning Signal
At.

!
.~

!
~~
~

i

'"

~

Windowing
(Hanning)

"

Overlap Add Method
~

~,

FFT

.

IFFT

~

Frequency Domain Modifications (Spectral Subtraction)

/

Figure 2.8: Block diagram of SIFT analysis! synthesis system.

2.19

"1
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

{

-.

I , 1·· Ii
81i .il
fi:.",
~!

·1

"
!

(

Chapter 3
Formulation of the Algorithm
Formulation of the algorithm for reducing noise from the eN Tower lightning current signal is presented in this chapter. Development of the algorithm is presented after a brief review of the Spectral Subtraction method and Heidler function which is used to simulate the lightning current waveform. After reviewing all the relevant works, the final method! algorithm is

·' 1I it
~.

"'"'I 1 . '" 1 l
.<¥

-~

proposed and implemented in this chapter.

3.1 Spectral Subtraction Method
A stand-alone noise suppression algorithm is discussed in this section. This method is basically developed for reducing the spectral effects of additive noise from noisy signal. Spectral subtraction offers a computationally efficient, processor independent approach to digital signal analysis [15]. In this thesis, the STFT-based spectral subtraction is used to de-noise the Tower lightning current signal as well as electric field (E) and magnetic field (11).

eN

3.1.1 Assumptions
The following assumptions were used in developing the analysis: 1) The background noise is added to the pure signal. 2) The background noise environment remains locally stationary to the degree that the expected value of spectral magnitude prior to pure signal activity equals its expected value during pure signal activity.

3.1
~,... c~
-«I-

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

3) Significant noise reduction is possible by removing the effect of noise spectrum.

3.1.2 Additive Noise Model
It is assumed that a windowed noise signal urn) has been added to a windowed pure signal s(n), with their sum denpted by x(n) [15]. Then
x(n)= s(n)+u(n)
(3.1)

Taking the Fourier transform gives, .
(3.2)

Where
(3.3)

X(eJt») = Lx(n)e-Jim
n=O

N-I

(3.4)

x(n) = -

21t

l"JX{eJt»)eJimdOJ . .
-"

(3.5)

3.1.3 Spectral Subtraction Estimator
At a given frequency bin. the estimated magnitude of the pure signal s(n) is the combined magnitude of the pure signal and noise x(n). minus the estimated noise magnitude u(n). Unfortunately we do not know the correct phase of the noise signal so we subtract the magnitude and leave the phase of X(eij alone. The spectral subtraction filter H(eij is calculated by replacing the noise spectrwn

u(l,»; with spectra which can be readily measured.

The magnitude IU(ejt»~ of U(I'»; is replaced by its average value p(eJt») taken during noise

3.2
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

j

A

These substitutions result in the spectral subtraction estimator S(e

jdJ

) :

(3.6)

or

(3.7)

with

H(ejQ) = 1- p(e ) IX(ejQ)1

iriJ

(3.8)

p{e JOJ ) = E~U(eJOJI]

(3.9)

The average noise magnitude jJ(ejO)) is calculated by taking the average of noise frames in each frequency bins. Therefore the spectral error e(ejQ)) resulting from this estimator is given by

This is the formulation behind spectral subtraction method, yet a number of simple modifications are available to reduce the effects of spectral error. These include: 1) Magnitude averaging 2) Half-wave rectification.

3.3
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Magnitude Averaging

Since the spectral error equals the difference between the noise spectrum U and its mean local averaging of spectral magnitudes can be used to reduce the error. Replacing

jJ,

IX(e Jm )1

( 3.11)

Xj (eJf» ) = ith time-windowed transform of x(k)

gtves (3.12) The rationale behind averaging is that the spectral error becomes approximately (3.13) Where (3.14)

Thus, the sample mean of

IU(eJf» ~ will converge to p(eJOJ ) as a longer average is taken.

The obvious problem with this modification is that the signal is non-stationary, and therefore only limited time averaging is allowed.

Half-Wave Rectification

For each frequency binOJ where the noisy signal spectrum magnitude /X(e Jm )/ is less than the average noise spectrum magnitude p(e JOJ ), the output will be negative after subtraction that

3.4
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

doesn't have physical meaning. These negative outputs are set to zero. This modification can be simply implemented by half-wave rectification of H(d W). The estimator then becomes
(3.15)

where

(3.16)

Thus, the effect of half-wave rectification is to bias down the magnitude spectrum at each frequency
OJ

by the noise bias determined at that frequency. The bias value can, of course,

change from frequency to frequency as well as from analysis time window to time window. The advantage of half-wave rectification is that the noise floor is reduced by p(ejO). The disadvantage of half-wave rectification can exhibit itself in the situation where the sum of the noise plus signal at a frequency
OJ

is less than Jl(e jOJ ). Then the signal information at that

frequency is incorrectly removed, implying a possible decrease in intelligibility.

3.5

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Synthesis
After bias removal and half-wave rectification a time waveform is reconstructed from the modified magnitude. The overlapped data windows are added to form the output signal sequence. The overall system block diagram is shown in Fig. 3.1.

x(n)

Hanning Window

Compute Magnitude

Half-wave RectifY

1\

S(n)
Figure 3.1: Block diagram of the overall Spectral Subtraction method.

3.6
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

3.2 Heidler Function Revisited
Heidler function [16,17] is a simulation of a lightning current stroke signal. Initially, a simulated Heidler function is considered to study the frequency components of the signal. Heidler function is given by,

I0 O(t ) = 1 -

2a [ l+(tl'IY

-t (tl 'I )k e-t/ + (tl)k '3 e;
Ir
2

i

]

/r.

4

1+(tl'3Y

(3.17)

Where

a

=

0.92 k= .:I

10

=10 kA (Current Peak)

The Heidler function (Fig. 3.2) is used to propose the STFT-based Spectral Subtraction as a technique for de-noising the CN Tower lightning current waveform. Initially, we artificially added frequency modulated signal to Heidler function and tried to remove the noise from the distorted Heilder function using manually de-noised method. Then this method is applied to the CN Tower current data and the de-noised signal is obtained. But it is always appreciated to develop an automated method that will take measured didt as its input and outputs the denoised waveform. STrr-based Spectral Subtraction is one of the recommended methods. This method is applied to the derivative of the Heidler function, distorted by noise measured at the CN Tower during the absence of lightning.

3.7

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

12

10

8
~

<'

!

6

\

U

"'------

4

2

0~~0~---2~0-----4~0------60

80

100

120

140

160

180

Time [us]

Figure 3.2: Heidler function.

12.---,---- - , - - - -

10

8

4

2

-

OL-~O-----2~O-----4LO----~60-----8~O----~10~O~--~12~O--~1~4~O--~1~60~--~180
Time [us]

Figure 3.3: Distorted Heidler function.

3.8
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

As shown in Fig. 3.3, the Heidler function is distorted artificially by a frequency modulated signal (inoise) of carrier frequency (Ic) 100 kHz and modulating frequency (f"J 20 kHz.
ino;se

= sin(2ifc t + sin(2Jifm t »

[leA]

(3.18)

The idea behind taking the carrier frequency 100 kHz and modulating frequency 20 kHz is because the mentioned dominant low frequency noise is around 100 kHz. When the FFT of the distorted Heidler function and that of the original Heidler function are compared, a local peak around 100 kHz is observed (see Fig. 3.4).

.. Diluted Function
Origina'-Funcli~n

102L--_-----'---_ _ _-'--_ _~1-- I o 50 100 150 200

-L

I

_----'------

250

300

350

400

450

500

Frequency [kHz]

Figure 3.4: FFT of distorted and original Heidler function.

We then tried to de-noise the distorted Heidler function. In order to remove such a noise signal, the real and imaginary parts of the FFT of the distorted Heidler function are separated and a best fit with different order polynomial was used to replace a number of points in the vicinity of 100 kHz (see Figs. 3.5 and 3.6).

3.9

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

5000 Before Modification .. ... ... After Modification 4000 3000 2000

J

-!

1000 0
.............~

----------------~

-1000 -2000 -3000 -4000 20
L -_ _ _ _- L - -____L__

v
~---"--~------'-----.~

40

60

80

100

120

140

160

180

200

Frequency [kHz]

Figure 3.5: Real part of the FFT.

5000 4000
3000 2000

-----,----·---r-----,--··-,-----·--.·----·o=~___ · --'-=______. . L -_ _ _ _- ,

-

Before Modification After Modification

"!
~

1000

.~

o
,.,

., ......

.' ..., ..,

"

-2000

-3000
_4000~----~-------L------L_

____

~

20

40

60

80

______-L______ ____ ______ 100 120 140 160 180
~ ~

_ L _ _ _ _~

200

Frequency [kHz]

Figure 3.6: Imaginary part ofthe FFT.

3.10
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Then the modified real and imaginary parts were combined together to form the modified FFT of the distorted Heidler function (Fig. 3.7). In Fig. 3.8, the modified FFT is compared with the FFT of the original Heidler function.
10~'----'-----T-----.----'-----~----r----'--~~=====c==~
Diluted FFT Modified FFT

I

I

150

200 250 300 Frequency [kHz]

350

400

450

500

Figure 3.7: Modified and distorted FFT.
10' ~--~---~---Original FFT 1 ... .... lvfod;fied FFT

J

....

. . ..

.'.,..,.....

102L-__

~

____

~~

__

~

____

~

____

~

____

~

__

~

____

~

____

~

__

~

o

50

100

150

200

250

300

350

400

450

500

Frequency [kHz]

Figure 3.8: Modified and original FFT.

3.11

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Then the modified FFT is converted back to time-domain using Inverse Fast Fourier Transfonn (IFFT). The time-domain signal after de-noising as shown in Fig 3.9 and Fig. 3.10, are compared to distorted and original Heidler function, respectively.

12~'-----'-----'---~-----'----~----'r==~~~~~==~ Diluted Signal .. De-Noised Signal 1

J

10

~

8

~

....... <

6

r= ~ U

4

2

0

-

-2

0

20

40

60

80

100

120

140

160

180

Time [us]

Figure 3.9: De-noised and distorted Heidler function.

12r-~----~----~--~----~-----'----'Ir===~==~~~~ Original Signal De-Noised Signal 1

I
I

10

8

2

1
I

_:L-~I____ ~I_____~I____~I____~I____-LI____~I____~I____-L1____ j
o
M
~

60

80

100

1M

l~

160

180

Time [us]

Figure 3.10: De-noised and original Heidler function. 3.12
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

The same procedure that is discussed above was applied to an actual

eN

Tower lightning

current signal. The real and imaginary parts were separated from the FFT of the

eN Tower

lightning current signal and a best fit 1st order polynomial (straight line) was applied to the points surrounding 100 kHz frequency to modify. The real and imaginary parts of the FFT of the CN Tower lightning current signal (File name: F2050091.997) before and after modification are shown in the Fig. 3.11 and Fig. 3.12, respectively.

- - Before Modification ... ... A.ft~r Modification
4

3

1

o
-1
'---._---1.---.
I I I
~ _ _ ~_'---_-'

o

80

100

120

140

160

180

200

Frequency [kHz]

Figure 3.11: Modified and distorted real part of the FFT.

3.13

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Before Modification ... "" .. After Modification
4

3

o
_1L---~----~

____

~

__

~

____

~

____L -_ _
120

~

_ _ _ _ ~_ _ _ _~ _ _~

o

20

40

60

80

100

140

160

180

200

Frequency [kHz]

Figure 3.12: Modified and distorted imaginary part of the FFT.

The modified real and imaginary parts are combined together to form a complex vector that is the modified FFT. The modified FFT is then converted back to the time domain using IFFT. The frequency response (FIT) of the measured and de-noised

eN

Tower lightning current

signal and their time-domain signals are shown in the Fig. 3.13 and Fig. 3.14, respectively.

3.14
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4

3

a

_1L---~-----~-----L----~----~----~----~--~----~----~

a

20

40

60

80

100

120

140

160

180

200

Frequency [kHz]

Figure 3.13: FFT of measured and de-noised CN Tower lightning current waveform.

14
Measured ......... De-Noised

12

10

,......., 8
~

........
6
4

<

U

I

_2L---~-----L----~----~----L-

-20

·10

o

__

~

____- L_ _ _ _
50

~ _ _ _ _ ~ _ _~

10

20

30

40

60

70

80

Time [us]

Figure 3.14: Measured and de-noised CN Tower lightning current waveform. (File name:
F20S0091. 997).

3.1S

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

For the purpose of our studies a signal-peak to noise-peak ratio (SPNPR) is proposed. It is defined as the signal peak divided by 50% of the peak-to-peak noise during the time before the arrival of lightning current return stroke. This ratio reaches to 00 in the absence of noise. For the case discussed above, SPNPR before de-noising = 10.56 SPNPR after de-noising = 23.58 So, SPNPR is increased by more than 2 times in comparison to that before de-noising. We can also represent the method using a flow chart that is shown Fig. 3.15. For de-noising a CN Tower lightning current signal by manually modifying its FFT, the same flow chart is used only the Heidler function is replaced by the CN Tower lightning current signal [17].

3.16
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Heidler Function (Time-domain) Add a Frequency Modulated Signal,Jc = 100 kHz,/m = 20 Distorted Heidler Function
FFT

"

"
Frequency response of the distorted Heidler function

Real (FFT)

I Real Part I
Apply different order best fit polynomial

I Imaginary Part I

,

Imaginary (FFT)

I

Modified Real Part

I
Modified FFT

I Modified Imaginary Part I

"

~

IFFT

De-Noised Heidler Function

Figure 3.15: The proposed manual de-noising method.

3.17

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

From the calculated values of the SPNPR, before and after the de-noising procedure, it is shown that applying the manual proposed method to the CN Tower lightning current signal improves the SPNPR but the. success is still limited. The reason for not getting more satisfactory success in case of CN Tower lightning current signal is its frequency modulated nature. But in case of using Heidler function, only a narrow band frequency modulated noise is added, this particular band of frequency is easily removed by applying the manually de-noised technique. Since the CN Tower lightning current signal is composed of a frequency modulated 'noise, it is not easy to remove it in the frequency domain while keeping the original signal unchanged.

3.2.1 Assessment of Spectral Subtraction Method Using Distorted Heidler Function In order to simulate a current derivative waveform the Heidler function is differentiated numerically and artificially distorted by the noise signal measured at assumed the same noise embedded in

eN

Tower that is

eN

Tower lightning current derivative signal. The

Spectral Subtraction method is applied to the distorted Heidler current derivative for de-noising it. The noise signal measured at

eN Tower

in the absence of lightning and its numerically

integrated waveform is shown in Fig. 3.16. The Heidler function and its derivative is shown in Fig. 3.17. The distorted Heidler current derivative and the current waveform obtained by integration are shown in Fig. 3.18. The de-noised Heidler current derivative and its current
waveforms are compared with the distorted Heidler current derivative and current waveforms

that in Fig. 3.19.

3.18
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Measured Noise Derivative, File: 01129846.191
3r---~r----.-----.-----.-----r----.-----.-----.-----r----'

~6~0----~-L----_-20L-----OL-----2~0-----4~0-----60~----8~0-----100~----12~0----~140

Time [us]

0.5.-----.-----.-----.-----.-----.-----,-----.-----,-----,-----,

Measured Noise Cln'ent

o

I
-40

-0.5 -60

-20

0

20

40 Time (us]

60

80

100

120

140

Figure 3.16: Measured noise derivative and noise waveform.
6
4
Original Heidler Current

~
u

\,,---

I

2 0 -2 -60
I I I I I I I I I

-40

-20

0

20

40
Time [us]

60

80

100

120

140

Heidler Current Derivative

30

20

!! "CO

~

10 0 -10 -60

-40

·20

0

20

40
Time [us]

60

80

100

120

140

Figure 3.17: Heidler Current and its derivative.

3.19

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

30 20

Distorted Heidler Current Derivative

i t!

VI

10 0 -10 -60

'e

--40

o
20
40
Time (us)

-

-20

60

80

100

120

140

Distorted Heidler Current

6
4

1
8

it:

2

~J\/VVVVVV\/'v'\JV\/'V\./V\/

0

-2 -60

-40

-20

o

20

40 Time Ius]

60

80

100

120

140

Figure 3.18: Distorted Heidler Current derivative and Heidler Current.
Distorted Heidler Current Derivative
3Or-----~----~----~----~

De-Noised Heidler Current Derivative
30r-----~----~----~----~

o
-10~----~----~----~----~

o

-50

o

50

100

150

-10~----~----~----~----~

-50

0

50

100

150

Time (us]

Time (us]

Distorted Heider CuTent
6r-----------------------~

6r-----------------------,
4

De-Noised Heidler Current

o
~L-----~----~----~----~

-50

0

50

100

150

-~LO-----0~--~5~0----~10~0----~150
Time [us]

Time (us]

Figure 3.19: Comparison of distorted and de-noised (Using Spectral Subtraction) Heidler current derivative and Heidler current.

3.20
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Comparison of Heidler Current Derivative Waveforms

25

.r\~.

/ ... ,

I
I
I I
1

20 .

15

f , I ;
j

\

«
Q u

t
I

~

10 -

5

/

!

, !
I

i

-5
_10L-__________- L_ _ _ _ _ _ _ _ _ _ _ _ -1 -0.5 o

~

__________

~

____________

~

__________

~

0.5 Time [us]

1.5

Figure 3.20: Comparison of de-noised and original Heidler current derivative.
Comparison of Heidler Current Waveforms
6~--~----o---~----~--~----~---,~==~==~==~

... - De-noised Current ---- Original Current.

5
;

,
4
I

I

I

I

3

J

«
~

I

I

~ 21

8
o
-1

I I

---_._--- -'

I
____L __ _ _ _
5
~_ _ _ _~_ _ _ _~

I

_2L-----L-----~----~-----L----~----~--

-2

-1

0

2

3
Time [us]

4

6

7

8

Figure 3.21: Comparison of de-noised and original Heidler currents.

3.21

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

From the analysis of Figs. 3.19- 3.21, it is clearly evident that the Spectral Subtraction method gives us de-noised signal that is very close to the original Heidler current derivative and Heidler current. Since Spectral Subtraction method works exceptionally well for simulated Heidler current derivative, it is expected to also work well for CN Tower lightning current derivative waveforms. Accordingly, the STFT-based Spectral Subtraction method is appropriate for de-noising eN Tower lightning current waveforms.

I

I I
I I
I I

I

I

I I I I

I

I

I
3.22

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

3.3 Formulation of the Proposed Algorithm
In section 3.1, STFT-based spectral subtraction is discussed which is basically the chosen method for de-noising the CN Tower lightning current signal. The manually proposed denoising method is applied initially to an artificially distorted Heidler function as discussed in section 3.2. In section 3.2.1, to simulate a current derivative waveform, the Heidler function is differentiated numerically and distorted by the actual noise signal measured at CN Tower, and a de-noised signal is achieved by applying the Spectral Subtraction that is shown in section 3.2.1. From the successful recovery of original Heidler function from the distorted Heidler function motivated us to propose STFT-based Spectral Subtraction as our final method. In this section we will formulate the proposed method to de-noise the signals and the associated electric and magnetic fields.

eN

tower lightning current

Assumptions
The same assumptions that is discussed in spectral subtraction section of section 3.1 can be used making suitable for lightning current signal: 4) The noise is added to the lightning signal. 5) The noise remains locally stationary to the degree that the expected value of spectral magnitude prior to lightning (pre-stroke) activity equals its expected value during lightning activity. The rationale behind this assumption is that by observing the lightning current waveform even the magnitude response of lightning current it is found that noise is oscillating around 100 kHz during the pre-stroke portion and the lightning period. 6) Significant noise reduction is possible by removing the effects of noise spectrum.

3.23
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

The additive noise model, spectral subtraction estimator, magnitude averaging,

half~wave

rectification and so on that are discussed in section 3.1 are used to fonnulate the proposed method for this particular application. To formulate the method following subsections are used.

3.3.1 Input-Output Data Windowing Lightning current derivative (di, dt) is segmented and windowed such that in the absence of spectral modifications. if the synthesis segments are added together. the resulting overall system reduces to an identity according to the OLA condition. The data is segmented and windowed in such a way that if a sequence is separated into half overlapped data segments and each segment is multiplied by a Hanning window, then the sum of the windowed sequences generates the original signal. The window length is chosen 2048 points and the overlapping points is 1024 which equals one half of the window length.

3.3.2 Frequency Analysis The DFT of each data window is taken and the magnitude is computed. The FFT size is set equal to the window size of 2048. As correctly noted by Allen [12], spectral modification followed by inverse transforming can distort the time waveform due to temporal aliasing caused by circular convolution with the time response of the modification. Augmenting the input time waveform with zeros before spectral modification minimizes this aliasing. To take care of this temporal aliasing, 1024 zero points (half window) are added to a half of first and last segment of time domain signal [17]. The length of the lightning current derivative is 16 kB. Adding 2 kB, the total size is 18 kB (18432 sample points). If we divide the signal into its frame of length 2048 and overlapping points 1024 it looks like the Fig. 3.22.

3.24

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

1~f\~~/~~7~/~'f\~f\-'~rl\~'r~!,~(I~\,~!\~~/\~~

0.9!
0.8
0.7
:

I

I!

0.6

0.5
0.4

1

2

3

4

5

6

7

8

9

10 11

12

13 14

15 16

17

-

:i
I,

0.3

::~~ ~,\J- "'- - - -"-J ~ ~\I'~\~\, -.......lL.-...! 'V

)

\\1' \,

)---"-----'--"\1 \
1.4

o

0.2

0.4

0.6

0.8

1

1.2

1.6

1.8

2

x 10

4

Figure 3.22: Segmented Signal into frames (1... 17). First half (1 : 1024) of the first frame (frame 1) and second half (17409: 18432) of the last frame (frame 17) is zero padded for the ease of signal reconstruction.

3.3.3 Bias Estimation

The spectral subtraction method requires an estimate at each frequency bin of the expected value of the noise spectrum: (3.19) This estimate is obtained by averaging the magnitude spectrum during non-lightning activity.

IU(e

jaJ

)

of noise only measured

3.25

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

3.3.4 Bias Removal and Half-Wave Rectification
I\.

The spectral subtraction estimator S is obtained by subtracting the average noise magnitude spectrum p from the magnitude signal spectrum IXI. Thus

IS(k~ = IX(k~ - p(k),
or

k=O, . .. ,L-J

(3.20)

S(k) =H(k)X(k), H(k) = 1- p(k)

I\.

k=O, .. " L-J k=O, ... , L-J

(3.21) (3.22)

IX(k~'

Where, L = DFT buffer length. After subtracting, the differenced values having negative magnitudes are set to zero (half-wave rectification). These negative differences represent frequencies where the sum of lightning signal plus local noise is less than the expected noise.

3.3.5 Synthesis After bias removal and half-wave rectification a time waveform is reconstructed from the modified magnitude. The data windows are overlap-added to form the output lightning sequence as discussed in chapter 2. The modified magnitude is combined with the unmodified phase angle to formulate the complex form of the DFT for each frame. Taking Inverse Fast Fourier Transform (IFFT) of these frames, the time domain modified signal is reconstructed.

3.26

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

3.4 Implementation of the Proposed Algorithm
The STFT -based spectral subtraction to de-noise the CN Tower lightning current signal is described by a set of simple mathematical equations. It can be easily implemented in software in the form of a code written in a programming language like C/C++ or computational software like Matlab. This section presents the implementation of the proposed algorithm in software form using Matlab computational software.

Window Selection
There are three most commonly used window functions for signal segmentation. They are Hamming, Hanning and Boxcar window and the selection of window is basically application dependent. The properties of different windows are discussed in chapter 2. From this analysis, it is obvious that Hanning window is the best for this application.

Window Size (Frame Length) Selection
In STFT, window size plays an important role. Shorter windows gives high time resolution and larger window gives high frequency resolution. So there is a trade off between time resolution and frequency resolution. Therefore, we need to optimize the window size that will result in good time and frequency resolution. To solve the window size dilemma for the CN Tower lightning current derivative and lightning current signal application, we tried the STFT -based spectral subtraction for different window sizes calculated the resulting SPNPR values in each case. We compared these SPNPR values to select optimal window size. Window lengths of 512, 1024, 2048, and 3072 points were tried

3.27
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

for the current derivative (di dl) and for the current signal (obtained by integration). A comparison of the resulting SPNPR values are shown in Table 3.1- 3.3 for different di dt files. Table 3.1: SPNPR using different window sizes. File: G0363096.363.
Signal peak-to-noise peak ratio (SPNPR) Frame Size (Points) di/dt Current (i) Comments

I
Original (Full Lenbrth) 512 1024
,

7.27 383.25 717.85 151.30 39.60

I
I

20.16 347.45 1057.17 361.39 39.59

Measured Signal 3rd Highest SPNPR Highest SPNPR 2nd Highest SPNPR Lowest SPNPR

I
I
I

I

2048 3072

r' .
6

,
u,__

I
-.J

,-

Comparison of CUlTent Signals for different window size
T

'!,I"
.~~
\

m

T-

T·

_CC~=t:a1b~4
Frame Length: 2048 Frame Length: 3072

5

~
:
,

!,

; i ~A.

!I

i"\.~l_
~<,:::

~

_

Frame Length: 512

__ .. ~~ame

Length: 1024

2

o
-1~1

"<;;/~-::;J
I

i

i

-60

____~----~----~I----~------~----~____~____~____~ -40 -20 0 20 40 60 80 120 100
Time [us]

Figure 3.23: The current waveform after de-noising the current derivative signal using different window sizes. File: G0363096.363.

3.28

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Table 3.2: SPNPR using different window sizes. File: G0363096.525.

SPNPR Frame Size (Points)
Original (Full LenbJfh) 512 1024 2048 3072

di/dt
5.75 274.88 179.20 51.72

Current (i)
10.38 1530 409 57.30 18.04

Comments
Measured Signal Highest SPNPR 21\0.1 Highest SPNPR 3m Highest SPNPR Lowest SPNPR

n.72

i

I
Frame Length: 512 -- -- Frame Length: 1024 -- Frame Length: 2048 Frame Length: 3072

I

Comparison of Current Signals For Different Window Size; File: G0363096.525
5~--~---,----,----,----,-----~~c===~~~

4'

- - Original Signal

3

C 2 CI)

o

:>

t:

Original Signal

a

-1~----~----~----~--~----~------~----L-----~--~

-60

-40

-20

o

20 40 Time [us]

60

80

100

120

Figure 3.24: The current wavefonn after de-noising the current derivative signal using different window sizes. File: G0363096.525.

3.29

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Table 3.3: SPNPR using different window sizes. File: G0363096.788.

SPNPR Frame Size (Points)
Original (Full Length) 512 1024 2048 3072

dildt
9.48 646.05 246.68 147.95

Current (i)
15.64 226.76 522.59 951.20 23.09
,

Comments
Measured Signal 3 Highest SPNPR 2
nd
ftl

Highest SPNPR

Highest SPNPR Lowest SPNPR
!

I I -_.

34.16

Comparison of Current Signals for Different Window Size, File G0363096.788
8~---,-----~----.-----~---,------~==~====c===~ - - FrameLength:S12 - ...- Frame Length: 1024 Frame Length: 2048 7 Frame Length: 3072 " - Original Signal

6 -

5

rl
<3

.....

-.~-

3~

".,"""',

\., . , .---. .~, .,

J

..... \:..:,-c..-;;;~~-;:'<':~~!'.,;".J>.~.,::- -"
/'

t

FL: 2048

~L: 3072

1~
i

~

&;ginal Signal

~[~ ~~~~_7_~'_~_;~~_~'_?&_~_'~_/~~ ~I----~-- ~ ~I ~I ~J
____ ____
__ ____ ____ ____

'.j

~

-60

-40

-20

0

20

40

60

80

100

120

Time [us)

Figure 3.25: The current waveform after de-noising the current derivative signal using different window sizes. File: G0363096.788.

3.30

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

From Tables 3.1-3.3, it is observed that it is really difficult to say which size is the best. To solve this problem if we take a look at the de-noised current waveforms (Figs. 3.23-3.25), it is evident that the 2048 window size is the best in all aspects although sometimes its SPNPR is lower than the SPNPR values obtained with 512 or 1024-point window sizes. But this is the only window size for which the de-noised current signal follows the original signal tail and SPNPR is better in comparison with other cases. So, considering SPNPR and the shape of the signal, 2048 window size gives the best result in this particular application. It is also worth mentioning here that to determine the SPNPR the signal level is taken to be the absolute peak in case of di 'dt and the first peak in case of current.

Spectral Subtraction on diMt or Current

The current derivative (didt) is measured at the

eN tower whereas the current waveform

is

derived from the di dt through time integration. We can apply spectral subtraction to either
di/dt .signal or the current signal. In each case a different result is observed. So there is an

optimization between these two options. To get the better result Spectral Subtraction was tried both in di'dt and current signal. It was found out that using Spectral subtraction process on the
di,'dt signal gives a better result than using it on the current. This is shown in Figs. 3.26- 3.28.

3.31

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Original Signal and De-Noised Signal using Spectral Subtraction on di/dt File: G0363096.494

4.5
4

Spectral Subtraction is on di/dt

3.5

3

li,\.
f ,)
il.' \

~1 ,1
1

1/'.

« .!!E..
c:
<1>

2.5 2
1.5

'r 'w \

,.

De-noised Current Signal

\.- ".II! V\1'\

I-A

·
I
0"

I:

U

::>

'", \ ,..... '1I

~

\1\ -!\J\j~\
Original Current Signal

05t
01

r
80

_0.5Lt--__~~____~____
-60 -40 -20

vv~./\~
_ L_ _ _ _ _ _LI_ _ _ _

~

______

~

_ _ _ __ L_ _ _ _ _ _LI _ _ _ _

~

____

~
140

0

20

40 Time [us]

60

100

120

Figure 3.26: Spectral Subtraction is applied on current derivative and de-noised current signal.
Original Signal and De-Noised Signal Using Spectral Subtraction on Current File: G0363096.494

,;

Spectral Subtraction is on Current Signal

t,

i,' ~ !f)

o

1"~

i . ,
1.5

I

~,

Original Current Signal

t
~ De-Noised Current Signal

0.5

o
_O.5L_____
-60
~

____

~

______L __ _ _ __ L_ _ _ _
0 20

~

_ _ _ _ _ _ _ _ _ _ _ __ L_ _ _ _ _ _

L_____

~

____

~

-40

-20

40 Time [us]

60

80

100

120

140

Figure 3.27: Spectral Subtraction is on current and de-noised current signal.

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Comparison of De-Noised Currents Using Spectral Subtraction on dildt and Current File: G0363096.494

4.5
4
3.5

3
2.5

~

=.

c

0

~ ::l

2
1.5

Spectra)

Subtraction is on Current

1

0.5

-0: '- - - '~_._.~._- -_- _'_ _-./:_'"_-'-__-'---__-'--___-'--___'-----_--'__--"-__-'1
-60

...~"7"\:

-40

-20

o

20

40 Timelusj

60

80

100

120

140

Figure 3.28: Comparison of de-noised current signals using Spectral Subtraction on current derivative and current. From the figures (Fig. 3.26- 3.28), it is obvious that spectral subtraction on di dl gives better result than that on current in the point of wave shape and peaks .

oJ. :J.)

.., ..,..,

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

3.4.1 Evaluation of the Proposed Method Based on Data from the Noise-Protected Current Measurement System
A current derivative signal (D0777188.213),simultaneously measured by both the new, noiseprotected, coil and the old coil on April 07, 1999 is shown in Figs. 3.29 and 3.30, respectively. The corresponding currents obtained by numerical integration are also shown. The Spectral Subtraction method is applied on the dj,/dt signal measured by the old coil. The de-noised diidt waveform is compared with the new coil dildt waveform in Figs. 3.31 and 3.32, respectively. In Figs. 3.33 and 3.34 the corresponding currents are also compared. Waveform peaks measured by the two coils are slightly different because of calibration problems. Furthermore, for the new coil current waveform the ground reflection arrives a little later than for the old coil because the new coil is located 35 meters above the old coil.

The results shown in Figs. 3.31-3.34 points out to the success of the Spectral Subtraction . method in de-noising the eN Tower lightning current signals.

3.34

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

20~------r------r------.------.-------.------r------'------~

Measured Current Derivative (New Coil). File: DOn7188.213 (April 07199)

15

-~U40~----~------~------~----~L-----~------~----~3~O~----~40

Current Waveform (New Coil). File: 00777188.213
8~------~-----'-------'-------'------'------'-------'-------n

6

1 (3 2

~4

o~--------------------------~

-40

-30

-20

-10

o
Time [us]

----L

10

20

30

40

Figure 3.29: New coil measured current derivative and its current wavefonn.
Measured Current Derivative (Old Coil). File: D07n188.213 (April 07199)

20
15

i
~ ~

10

5
0 -5

.,.

,...,..

-40

-30

-20

-10

o
Time [us)

10

20

30

40

8n--------------,-------.-------.------,------.,-------.-------n
6

Current Waveform (Old Coil). File: 00777188.213 (April 07199)

~4

~2
-40
-30
-20

C

-10

o
Time [us)

10

20

30

40

Figure 3.30: Old coil measured current derivative and its current wavefonn. 3.35
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

De-Nolsed Current Derivative, Rle: 00777188.213 (April 07199)
20~------~~-------'---------.---------'---------r--------,

15

10

i

'iii

'6

~

5

(

0

J Vw~1
I

'\ \
2
Time [us]

\
I

-5

-

-1

0

3

4

5

Figure 3.31: De-noised current derivatives.
Measured Current Derivative (New Coil), File: 00777188.213 (April 07199)
20~------~---------'--------~-------------------r--------,

15

u;

10

3
'i5

~

5

O~·~

-5

-1

0

2
Time [us)

3

4

5

Figure 3.32: Measured current derivative (New coil).

3.36

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

De-Noised Current Waveform

8
7

6
5

~

..
3
2

iI::
~

()

i

1

I I I

0

I
0

I

-1

-5

5
Time [us)

10

15

20

I
I

Figure 3.33: De-Noised current waveform
Current Waveform (New ColI), File: 00777188.213 (April 07199) 8

7

I
r

!
(

I

6

5

<' ~
C

4

I I I

~
~

()

3
2

I
I
I

1

0

-1

-5

0

5 Time [us)

10

15

20

Figure 3.34: New coil current waveform.

3.37
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

3.6 Results of the Proposed Method
According to the success of the STFT-based Spectral Subtraction method with parameters Hanning window of size 2048 and 1024 overlap points, it is decided to applying it on the measured current derivative., Using these parameters, we applied the proposed method on measured di/dt and then integrate the de-noised di/dt to derive the current waveforms. The denoised dildt and current waveforms are shown in Figs. 3.35-3.40.
Measured Current Derivative (dildt) Jul 03/1999. 17:31 :36.3 out of 8 Stroke (5). File: G0363096.363
20

15

~ 10

lit

~

5
0

-5

"
-40 -20 0

Wit

..
20
40 Time (us] 60 80 100 120 140

-60

De-Noised Current Derivative

20
15

;;; ~ 10
'5

~ 5
0

JJ, 'II'
-40 -20 0 20 40 Time [us)

-5

-60

60

80

100

120

140

Figure 3.35: Measured and de-noised di'dt using the proposed method.

3.38
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Current Wavefonn from Measured difdt. File: G0363096.363
8.-----,-----,-----,-----,-----~----,,----_,----_.----_.----_,

6

o
~6~O------4~O------2~O----~O----~20------4~O-----6LO-----8LO----~1~OO~--~1~2~O--~1~40

Time (us]

8
6

---,'------,-----,-----,-----,-----,-----,------,----_,--

Current Waveform from De-Noised dildt

o
~60~----~~O-----.2~0----~O----~20~--~4~0----~60L---~80~--~1~00~.--~1~2~0--~1~40
TIme (us]

Figure 3.36: Current wavefonns from measured and de-noised didt. File: G0363096.363.
MeaSU"'ed Current Der1vative (di/dt). JuJ 03/1999. 17:31 :36.6 out of 8 Stroke (s). File: G0363096.566

30
20

~
~

Vi

10 0 -10 -60

J,
'IT'
-40 -20 0 20 40 Time (us] 60 80 100 120 140 De-Noised Current Derivaive

30
20
Vi

!! '6
0 -10

~

10

U.
-40 -20 0

Pr'"

,
20 40 Time (us]

I

,
80

I

I

-60

60

100

120

140

Figure 3.37: Measured and de-noised di/dt using the proposed method. File: G0363096.566.

3.39
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Current Waveform from Measured dildt. File G0363096.566 8 6

~

4

i

()

2 0
-2 -60
~
---LI

-40

-20

0

20

40 nme[us)

60

80

100

120

140

Current Waveform from De-Noised dildt 8 6

~ 4
C

8

~ 2
0 -2

-60

-40

-20

0

20

40
Time [us]

60

80

100

120

140

Figure 3.38: Current wavefonns from measured and de-noised di/dl. File: G0363096.566.
Measured Current Derivative (diIdt), Ju 0311999.17:31:36.8 out of 8 Stroke (5) File: G0363096.788 25

20
7ii15

~ 10
~
5 0

'6

It
-40 -20 0

-5 -60

rr'
20 40 Time [us]

60

80

100

120

140

De-Noised Current Derivative 25

20
7ii15

~ 10
~
5
0
I

'1:J

11

rr
I I I I I I

-5 -60 .

-40

-20

0

20

40 nme[us]

60

80

100

120

140

Figure 3.39: Measured and de-noised di/dt using the proposed method. File: G0363096.788.
3.40
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

CUTent Wavefonn from Measured di/dt. File: G0363096.788

I:l

6

~ 4

~

C

:2
0

-2

-60

-40

-20

0

20

40 Time [us]

60

80

100

120

140

CUTent Waveform from De-Noised dildt

8

6

14

i u

::lI

2
0

-2 -60

-40

-20

0

20

40 TIme [us]

60

80

100

120

140

Figure 3.40: Current waveforms from measured and de-noised diidt. File: G0363096.788.

Short Term Fourier Transform Response

3D mesh plot of time, frequency and amplitude responses were constructed from the measured current derivative and the de-noised current derivative which are shown in Fig. 3.41 and 3.42 From Figs. 3.41-3.42, the improvement of the signal (di/dt) after applying the proposed spectral subtraction method is clearly demonstrated.

I I

I
I
I

I
( j

3.41
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

STFT Response of Measured diidt, File: G0363096.363

700
600

500
~4oo c
lLL

"l:I

0

~300

III

CI

I-

Cl)2OQ

100 0 5 1.5

Frequency [kHz]

o

0

Time (us]

Figure 3.41: Spectrogram of measured dildt. File: 06363096.363.

3.42

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

STFT Response of D&-Noised dildt. File: G0363096.363

700
600 500
4)

"0

£l400

6. .,

::t 300
LL.

l-

I-

flJ200

100
0

5
1.5

Frequency (kHz)

o

0

Time [us]

Figure 3.42: Spectrogram of de-noised di,dt. File: G0363096.363.

3.43
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

3.7 Proposed Pre-Stroke of Lightning Signal
The pre-stroke portion of the recorded lightning current derivative is 40.96
jIS. jIS

(-40.96

jIS

to 0

4 kB -4096 points). By analyzing the recorded noise signal at the eN Tower, it is found

that the proposed method shows better result with respect to the SPNPR and signal shape in time domain if the pre-stroke portion is 81.92
jIS

(-81.92

jIS

to 0 f../S. 8 kB- 8192 Points) rather

than 40.96 f../S. The following figures (Figs. 3.45-3.49) provides a comparison of de-noised signals taking only frame 2 and then mean of frames 2:3,2:4,2:5, ... ,2: 13,2: 14 and 2: 15. The 1st half of the first frame (1:1024) and 2nd half oflast frame (17409: 18432) contain only zeros, that's why we didn't take the mean of first and last frame.

100 60 80 De-noised dIIdt, Mean of frame 2 and 3 is subtracted

20

40

-,

Pt

,

_an

f

.

,
120

,

·
,
-20
0

A

:

,
20

,
40

,
60

,
80

100

120

140

Figure 3.43: Original and de-noised signals subtracting frame 2 and mean of frames 2 and 3

3.44

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Mean of frame 2.3 and 4 is subtracted 5

0

...
I I I I I I

lit

-5 5

-60

-40

-20

20 40 60 80 0 Mean of frame 2.3.4 and 5 is subtracted

100

120

140

0

.....--------------

·
20 40 60 Mean of frame 2 :6 is subtracted 80 100

lit

-5 -60 5

-40

-20

0

120

140

0

...
-40
-20 0 20 40 60 80 100

lit

-5 -60

120

140

Figure 3.44: De-noised signals subtracting mean of frames 2:4. 2:5 and 2:6.
Mean of Frame 2:7 is subtracted

5

0

...
-40
-20

~

I
0
20 40 60 Mean of frame 2:8 is subtracted 80 100 120 140

,-5
5

-60

I
I I

0

...
-40
-20 0 20 40 60 Mean of frame 2:9 is subtracted 80 100

...
120 140

I
I I
I

-5
5

-60

0

...
~

I
·
I

-5 -60

-40

-20

0

20

40

60

80

100

120

140

I I I I
j

Figure 3.45: De-noised signals subtracting mean of frames 2:7, 2:8 and 2:9.

3.45
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Mean of Frame 2:10 is subtracted

5

0

...
-40
-20 0 80 40 60 20 Mean of Frame 2:11 Is subtracted 100

..
120 140

-5 5

-60

0

..
-40
-20

-.--_.- ...

_.-.----

·
100 120 140

-5 5

-60

0

60 80 20 40 Mean of Frame 2:121s subtracted

0

....
-40

---- ... ---~----.-------

·
60 80 100 120 140

-5

-60

-20

0

20

40

Figure 3.46: De-noised signals subtracting mean of frames 2: 10, 2:11 and 2:12.
Mean of Frame 2:13 is subtracted

5

0

...
-40 -20 0 80 20 40 60 Mean of FRame 2: 14 is sUbtracted 100

...
120 140

-5 -60

5

0

...
-40
-20 0 20 40 60 80 Mean of Frame 2:15 is subtracted 100 120 140

-5 5

-60

0

....
I I I I I I

·
-20 0 20 40 60

-5

-60

-40

80

100

120

140

Figure 3.47: De-noised signals subtracting mean of frames 2:13, 2:14 and 2:15.

3.46
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

From the Figs. 3.43-3.47. it is obvious that the de-noised signal quality is improved when the mean of more frames of noise part is subtracted from the original signal. From the analysis, it is obvious that the mean of frames 2:7 and after, the improvement (de-noising) is very close to each other. So, we recommend to record at least 113 (6 kB for our case instead of 4 kB) of the whole record as pre-stroke portion.

3.47
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Chapter 4
Obtaining Waveform Parameters
Statistical data of the current waveform parameters of CN Tower strokes is determined [18] from the measured di/dt waveforms that are contaminated by various kinds of noise. The obtained data inaccurately represents the injected current waveform parameters because instrumentation noise, environmental interference and structural discontinuities of the tower contaminate the measurements. In order to study the characteristics of lightning impact on tall structures, analysis should represent the waveform parameters of the injected current to such structures. In this chapter, the waveform parameters both of current derivative (dj,idt) and current are obtained from denoised waveforms after applying the proposed de-noising method.

4.1 Definition of Waveform Parameters
In this thesis, the following waveform parameters are obtained from the de-noised waveforms using the proposed de-noising technique.

Parameters deduced from the current derivative (di/dt) waveforms:
1. Maximum Steepness of the Current (di/dtimaxJ

This parameter is defined as the rise from the base level to the maximum peak in the di/dt waveform. 2. 10%- 90% Risetime to Maximum Current Derivative (TctJ This is the time for dildt waveform to rise above base level from 10% to 90% of the peak value.

4.1

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

The definition of these parameters is shown in Fig. 4.1.
Current Derivative Waveform Parameters

25
Peak

Td

20

90%

15

\
I

\
I

5
10%

\
.~

\ f1

o

r-

~~
Base Level

~\ \v)

1\
'

\
,

\,

I \ I \J~
1\ '\
\.,/.!

i

\/\..J

I

I

-5

,

\~---,\!/
1.5 2
2.5

-2

-1.5

-1

-0.5

o

0.5 Time [us]

3

Figure 4.1: Definitions of current derivative wavefonn parameters. Parameters deduced from the current waveforms: 1. Current Peak (/peaJr) This parameter is defined as the rise from the base level to the first peak value of the current wavefonn. 2. 10%- 90% Risetime of Current Wavefonns (T) This is the time for current to rise above the base level from 10% to 90% of the peak value The definition of these current wavefonn parameters is shown in Fig. 4.2.

4.2
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Current Waveform Parameters
8

7
First Peak
6

T

I

90%

I(~j

I\J"/\

~~

5
~4 C

8

~

3
2

(
100.4

!

I
Base Level

o
-1 -5

o
Time Ius]

5

10

Figure 4.2: Definitions of current waveform parameters. There are other waveform parameters that are also used to characterize a lightning current signal which are not indicated in the Figs. 4.1 and 4.2.

4. Time to Half Value o/Current
It is defined as the time when the current decays to half value of the first peak.

5. Impulse Charge
It is defined as total charge calculated from the integration of the current waveform. Several researchers obtained the di,dt and current waveform parameters from noisy waveforms. But the measured di/dt records on May 09, 2002 were too much contaminated by noise and it became difficult to determine those parameters. The proposed de-noising method is applied on the May 09, 2002 data files. The obtained waveform parameters are shown in Figs. 4.3-4.30. 4.3

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Mey 0912002. 10:54:06. 1 cU of 8 Stroke(s). Mee.....ed Current OerilllltlW (dllcl) File: E0939244.931
~~--~----~--~r----r----~--~----~----~---r----.

20

15

1 I

10

o
-5

5

-1~L----~~O~--~_20~--~O~--~20~--~~~--~OO~---~~--~100~--~1~20=---~1~
Time [us)

o.NoIsed cIJdt
~~--~-----r----or----.-----.----.r----.-----r----.-----'

20

I

i

15
10

o
-5
-1~~---~~O-----_~~--~0~---20J-----~~--~OO~---OO~----1oo~---1~~~--~1~

5

Time [us]

Figure 4.3: Measured and de-noised dild!. File: E0939244. 93 1.
MeesIXed Ctnent OerivatM (di/cl) (Expanded)

30

I

.i
78

20
10 0 -10 -3

-2

-1

Time [us)

o

2

3

4

5

Oe-Noised dlk.I (Expanded)
30

20

I

i

eese Level: 0 MBlCIrrun Steepness: 20.55 kA/us 10'16 Risetlme=: 0.53 us 90'16 Rlsetlme: 0.9185 us 10'16-90".4 Risetlme: O.38B5 us

10

0 -10 -3

-2

-1

TlmeCus)

o

2

3

4

5

Figure 4.4: Expanded fonn of measured and de-noised di/dt and its parameters.
4.4

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

MeaIU'ad ClnwC wawrorm. FI..: E0939244.931
10 5

1

0

J_~
-15

-20

-80

-20

0

20

40

80

80

100

TIme[u.)

120

140

10
5

o.NotMd c.n.t wav.ronn

I:

0

r
-40

5-1:
-1e

-20

-eo

-20

0

20

40 'T'IrM Ius)

80

eo'

100

120

140

Figure 4.5: Current waveform from measured and de-noised dild!. File: E0939244.93 I .

..
1
2
0
-2

a

I

-4 Tlme[usl
5
10

..
!
2

8r---------------------------------r---------------------------------r---------------------------~

J _:r----

FntPeak5.~~~ 10416 RI. . TIme ~J!! 90'16 RI .. TIme:. us 10'W1- 8O'J6 RI. . Time: 0.173 UII ~. PeM: 6.8127 IrA

s... LewI: -2.32 IrA

~5~----------------------------~O~------------------------------5~-------------------------J10 TIme 'usJ

Figure 4.6: Expanded form of current waveform and its parameters.
4.5

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

I'M)' 08t'2002, 2

ext ot e &troh(.).....1CAd CWrwl o.tMCIve (dIcI) FIr. BJ838245.022

30 20

1 I

'0 0

-10

-~

-20

0

210

nm.r.-.
D.NoIMdcUI

40

80

80

100

120

140

30

20

1 I

10

0

-10

~.
-..0 -20

-2$0

0

20

40
11rn./u.)

eo

eo

100

120

140

Figure 4.7: Measured and de-noised dVdt. File: E0939245.022.
M. .and Current DerfvIIIve (cI.tI) CE'xPMdId). FilIi: E0938245.022

3O~----T-----~----~----~----~------'-----'-----'

-~3~-----~2------~'-.-----0~----~'----~2----~3~----4~--~5

nme[")
3O.-----.-----,-----~----~-----,~~L~~~:=O-----r----~

20

I

1

'0

&m6 RI. . nm.: 0.5138 UI 1~ SI096 RtN 11,.,.: 0.6838 ..

MuIrnm 6teepr. . .: 19.78 kAA.i n RI8e TIme: -G.1! UI

I

I

0,......-'----...-.....___....._-----

I
I
I I

-10

I
j Figure 4.8: Expanded form ofmeas~ and cfe..noised di/dt and its penmteters. 4.6
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

I

Meeand o.r.nt W8Yeforrn, File: E09382411.022

2!

20

1 15 )1:
0

~
25
20

-..0

-20

0

20

40
nrnelUl)

80

SO

100

120

140

o.NoIMd CWNr1f wawram

115

)1:
0
-5 -60
-40

-20

0

20

TIme Ius)

40

60

80

100

120

140

Figure 4.9: Current waveform from measured and de-noised di/dt. File: E0939245.022.
20

15

J

:I

10 5

?to
20

-8

-8

-2

nrne(U8]

o

2

4

8

8

10

15 i10

j

5

0

~o

-2

0 TIme(wJ

2

8

8

10

Figure 4.10: Expanded form of current waveform and its panuneters.

4.7

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

May 0812002. 3 eM

~~--~----~--~----~----~--~----,-----.---~----,

of' FIle: E08382"5.073 M...,., CUIrWIt 0ertv8IMt
8Iroke(s).

(cIJdI).

o
-1~~--~----_~~--~~---~~---~L----~~--~~-----100~---i~~--~1~
1"Ime [u.)

o.NoIIed elM
~.---~----~--~----~----~--~----'---__r - - - - r - - - - '

o
-1~~--~-----~~--~O-----~~---~~---~~--~~~--~'00~--~'~~--~'~ TIme (ue)

Figure 4.11: .Measured and de-noised dildl. File: E0939245.073.
Muand CWrM DartvatMt (dIIdt) (Expended). FIlII: E093924S.0?3
~r-----~----~----~------~----~----~----

__

r---~

20

10

-1~3~----_~2------_1'!-------:'-----~----~-------'---~..L------'

J:t-----____-----as

o.-NoIMd cIIdt (Expendtld) ~r-----~---~-----'----~--r~--~L~~~:O~---~--~ 20 Mulnvn steepness: 24.58 kMM 1~ AI_ nrn.: 1.5844 ue is so.. RI. . nme: 1.7248 us 2' 10. 8096 RI.. Time: O.130S ue & 10

-1~3~-----~2-------1.L-----...J.O------..L.1------'2------3-'------'4------.J

S

TImelU8)

Figure 4.12: Expanded form of measured and de-noised dildt and its parameters.
4.8

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

,e
10

M_-.nc:t C\mIrt w.v.t'onn. FI..: E0831245.073

]

I:

5

0
-5

..;eo

-20

0

20

40 Tlme(u.)

eo

80

100

120

140

OM. 111_ eur.It w.wt'orm
12
10

J

I.
4
2
0

8

-~

r
-40
-20

0

20

40 l1me(u.)

eo

80

100

120

140

Figure 4.13: Current waveform from measured and de-noised dild!. File: E0939245.073.
1Sr---~----'-----r----'-----r----r---_'--~_r----~--~

10

J ,------0
-~~O----~--~~---~~----~2-----0~--~2----~4-----L----~,----~,0

I

5

r ... ru.1
De-Notlied CWIWIt WeYwfonn (Expended)
12r---~r_=~~~any_--_,----_r----T_--~----_r----~--~

1

o

I

a

FInIt PWIB: 5.7085 IrA 1~ RI. . TIme: -3.4 III eo..RlseTlnw:1.7_ ..

J:
2

101J1,. ~ R_ TlmI: $.1585 III AbdIte PIIIIk 6.21 IrA

o~------------------
-~~O----~--~~---~~----~2-----0~--~2----~4~---8~--~----~'0

TIme (us)

Fisure 4.14: Expanded form of current waveform and its parameters.

4.9

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

M~ 08J2002...

out of 8 StroIce(8). M...ured ewr.nt 0ertwtIW (ctIdt)
File: E0838246.234

~~--~----~---'-----r----~--~----~---.,----r----,

20

-1$o~--~-----20~--~0----~20~---~~--~~~---~~---'~OO~--~120~--~'~ 'l'Ir.- (\8)

o.NoiMdcMI
~,---~----~---'-----r----~--~----~---.'----r----'

20

I

i

_ 15

10

o
J,5

5

-1$o~--~-----20~--~O----~20~---~~---~~--~~~--~'00~--~'20~--~'~ TIn. (us)

Figure 4. IS: Measured and de-noised dVdt. File: E0939245.234.
Meuured CurTent DertvIiINIa (cIlIA) (EIIpended), FIle: E0939245.234 ~'-----~-----r----~------~----~-----r-----'----~
20

-1~~----_~2------_~'----~O------~'----~2------3~----~4------J5

TlmelusJ
~r-----'-----~-----'------~~~~o=~rr-----.------'

20

MUImum

I

i

.... 15
10
5
o~----~~~~--~

1m6- ~ RiM TIme: 0.4117 ua

1eM RI8e ~ RI8e

nme: o.~ Ia nm.: 0.8161 U8

at......: 18.S2251rMa

-5
-10.~----~----~----~------~----~----~----~~--~
"oil

-2

-1

0

nnw (us)

1

2

3

4

5

Figure 4.16: Expanded form of measured and de-noiseddVdtand its parameters.
4.10

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

M. ...-ed QnM Wawfon'n. File: E0838245.234
20

15
110

]

5
0

-s

-80

-40

-20

0

20

40
TIme rue)

60

eo

100

120

140

o.NaiMd ewr..I w.wfonn
20

15

J

1,0
s
0

r
-40

a

.

~

-20

0

20

40
TIme(ue)

eo

eo

100

120

140

Figure 4.17: Current waveform from measured and de-noised dildt. File: E0939245.234.

1S
10

J

I

S
0

-:'0
15
10

-8

-4

-2

0 Tnne(us)

2

4

8

8

10

Oe-NoIHd Q.rrent W8wform (ElcpencIed)

J

i

s.. L.ewI: 025 IrA Fnt PeM: 8.85 IrA 1M(. At-. TIme: -4.085 . . eo.6 R", TIme: 0.9688 · 1'"" so.. RiM 111M: 5.0538 · ~. Pale 9.5665 IrA

o~--------------~
nnw(usJ

5

~~O----~--~~----4~--~4-----0~--~2----~----8~--~8----~'0

Fipe 4.1B: Expanded form of current waveform and its parameters.

4.11

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

May 0812002. I o j of I SroIaI(a). Meaw'ed CInent o.rtwItIW . F1..: E083824e.488

30 20

1,0

I

0 -10

~

-40

-20

0

20

TIme",.
o.NoIMc:I c:MI

40

80

80

100

1~

140

25 20

-5
-1$o~---_~~----~~--~O-----~~---~~---80~---80~---'~OO~---'~~--~1~
Timef~J

Figure 4.19: Measured and de-noised di/dt. File: E093924S.496.

30
20

I

~

10

0
-10 -3

-2

-1

o

Time (us)

1

2

3

4

5

De-Na-d elM (ExpMdId)

25
20

18.0181rMJS 1eM RIM TIiIw: -0.1254 us 90" Rt. TImr. 0.4034 us 1~ ~ RIle T1mr. 0.5288 ~

Lewl:G MaJdnUn

a.erx-:

-5
-1~3~-----~2-------1~----~O------1~----~2------:3~---~"------!5

Time r~J

Figure 4.20: Expanded form of measured and de-noised tli/dt and its parameters. 4.12

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

M....-ed ewr.nt Wtlveforrn, FI,,: E0838246.o481

10
5

I

J

0
-5

-10

-eo

-40

-20

0

20

40 Tlmelu.j

80

ao

100

120

140

o.NatMd ewr.nt W8w1'onn

10

5

J

I

0

~
-40

"'-

-5

-10 -fJO

-20

0

20

40 1Ime(u.)

80

80

100

120

140

Figure 4.21: Current waveform from measured and de-noised di/dt. File: E093924S.496.

10

5

J

~

0

-5

-10 -10

-2

0 TIme (wJ

2

4

8

8

10

De-Noised o.r.nt Wewtonn (Expended)

10

5

J

i

0

-5

Lew!: -0.4 k-' Firat PeaIr: 3.68 k-' 1096 RI_ nnw: -0.075 '-9O'Ho RI_ nme: 0.5-44 .... 1~ 90'* RI. . Time: 0.819 UI AbsoUe pea: 4.26 k-'

-10 -10

-8

-8

-4

-2

0
Time (us)

2

8

8

10

Figure 4.22: Expanded form of current waveform and its parameters. 4.13

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

~

·
I

otnoo2. M. . . . . CwNnt DetIwttvw (eMI) FIle: E0t38702.021

i: 10
-2

1.0
e
8

-<to

-20

0

20

TIme I"')

40

eo

10

100

120

140

10
-2

I:

·
-40

~.
..n
-20 0 20

..
TIme(W)

,.
eo

I

,

b

,$
100

~

1.0

40

eo

120

140

Figure 4.23: Measured and de-noised di/dt, File: E0939702.021.

-2

~3
8

-2

-1

0

Time (us)

1

2

3

.

5

o.NoIsed a.Tent DerMIIIw (exp.nded)

8

I; '0
-2

LeIIWI:O.51rA Mufrrun 8tftpc....: 4.8 ~ 1'"' RIse TIme: -1.888 us ~ RI_ TIme: 0.57 us 1~ 804J6 RI8I TlIne: 2.538 us

~3

-2

-1

0

1
TIm. (us]

2

3

..

Figure 4.24: E~ fOIlD of measured and de-noised di/rlt and its parameters.

4.14

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

MH"" CWrMI Wwlform (ecp.nded), FIle: E08S8702.021

20
Hi

)

1 '0
~
~', ~~

....,-..: \.
.....,

:';',

0
-5

-10

~

-40

-20

0

20

40 Tlmelw)

60

80

100

120

140

o.NoitIIId CWIWII wawbm (e.p..t.d)
20

1S

i: 10

J

e
0

-5
-40

-1~

-20

0

20

40 Time Ia.J

60

80

100

120

140

Figure 4.25: Current waveform from measured and de-noised di/dl, File: E0939102.021.

15

0r--__

-5L---~--~~=c==~--~--~----~--~--~--~
-10
-8 -4 -2 0 TImela.] 2 ..

8

10

o.NoIMd CUrwIt w.wtcnn (ElIpwIdIId)

20

15

J

i,o
5
0
oS

FIrIt Peek 14.804 IrA 109' RI. . TIme: -1.385 a. QOIJi RI.. Time: 3.588 UIi ' 1~ 9OIJ6 AI.. Time: 4.951 u. ~ Peek: 15.8134 leA

ea.. LtMII:o

-10

-4

-2

0
TIme Ius)

2

4

8

8

10

Figure 4.26: Expanded form of current waveform and its parameters.

4.15

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

MIIy 0812002, M. . . . . CImIft DertvaIIve (dJdt)

file: E0840702.211
e~------r-------~--~-------~---'----~---·----~--~----'

.
-2
140

e~--~-----r----~--~~--~----~----~--~-----r--~

.

-20

o

20

40 11me lue)

10

eo

100

120

140

Figure 4.27: Measured and de-noised di/dl. File: E093970S.211.
Mea.nd cunn DIIrIvIItIIIW (cthi) (~. FIll: E0845702.211

-2
-2
-1

8

..

1
0
-2

i2

-!3

-2

-1

o

1

2

3

5

Time fusJ

Figure 4.28: Expended form of measured and de-noised di/tlt and its parameters.
4.16

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Mea"" o.r.rt waveform, File: E0945702.21 t

25
20

1 15

] 1:
0

·5

.:eo

-40

·20

0

20

40

TlmelusJ
De-NotMd a.r.nt

eo

eo

100

1:i1O

140

Z5
20

wawrorm

J

1 15
1:
0

r
·40

20

·5

.:eo

·20

0

l1me(usJ

40

eo

80

100

120

140

Figure 4.29: Current waveform from measured and de-noised di/dt. File: E093970S.211.
........ CurI'8N WIrwefcnn (&p.IIdacI). FIle: E08457Q2.21 t

10r----.----,,----.----.----_.----.---~r_--_.----._--_.

8

-2

0
Time (ue]

2

·

8

10

10~--~----,-----.----.-----r----~~r=~~T.r----~--~

De-NCIIsed CUnInt wevwrorm

<ec:-Ided)

8

Fht PeM: ".123 IrA. 1'"' R_ TIme: -6.28 us 9m6 RIM TIme: 0.38 us 10K- 801)6 RI_ TIme: 5.88 ue AbI....t. Peek: 4.21 kA

o
~~----8~--~a~---~------~----L---~----~----~--~----~

·10

_

-2

0

2

..

S

8

10

TIme (ue)

Figure 4.30: Expanded form of current waveform and its parameters.
4.17

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4.2 Stadstics of Current Waveform Parameters
The de-noised current derivative and current waveforms pll'BIDeterS and their statistics can be

tabulated in the following tables for the files recorded on May 09, 2002 at the CN Tower.
Table 4.1: Waveform Parameters and their Statistics.

. FiJeName

Current Derivative (d1/dt)

CurreBt WaveronD Parameten

Parameten
Maximum Steepness
(kA/JIS) E0909244.931 E0909245.022 E0909245.073 E090924S.234 E090924S.496 E0909702.021 E090970S.211 20.55 19.78 24.59 18.6225 19.016 4.6 3.4746 0.3885 0.6639 0.1305 0.4117 0.5288 2.538 0.444 5.92 6.92 5.7095 8.65 3.68 14.804 4.123 0.973 0.646 5.1585 5.0538 0.619 4.951
5.66

10ro- 900A

First PeaK
(lA)

100A-90%

Absolute Peak
(14)

Rise Time (ps)

Rise Time (J'f)

6.8127 7.51 6.21 9.5665 4.26 15.9134 4.21

MeaD

15.80

0.73

7.12

3.30

7.78

4.18

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4.3 Field Waveform Parameters
STFT-based spectral subtraction is applied on lightning generated magnetic (H) and electric fields (E) that are measured at the University of Toronto, 2 km north from the CN Tower. The electric and magnetic field waveforms, generated by CN Tower lightning strikes, are mostly corrupted by high frequency noise components. When the proposed method is applied on E and H fields, it became easier to obtain the waveform parameters from the de-noised signal. In this application a Hanning window is used. Since the frame length is application dependent, we tried different window lengths to select the appropriate window length and compared their SPNPR as it was done with lightning current derivative and current waveforms. The following table gives the comparison ofSPNPR ofE and H fields resulting from different window sizes. Table 4.2: SPNPR using different window sizes.

SPNPR Frame Size (Points)
Original (Full Length) 512 1024 2048 3072

E
9.52 104.53 224.30 35.60 22.43

H

Comments
Measured Signal 2nd Highest SPNPR Highest SPNPR 3m Highest SPNPR Lowest SPNPR

2.93 32.39 51.51 11.11 7.18

From the above table, it is clear that window size 1024 (1 kB) gives the best SPNPR. Therefore, we used this size in this application. Using Hanning window of different sizes, after applying the STFT-based spectral subtraction on electric field (E) files that were measured at the University of Toronto and the de-noised signal waveforms (E) are shown in Figs. 4.31-4.34.

4.19

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Measured Electric Field (E). May 09.2002, File: E0934418.741 100 0 -·100

~

W

·200
·300 -400 -60

SPNPR: 9.52

-40

-20

0

20

40 Time [us)

60

80

100

120

140

De-Noised Electric Field. Frame Length: 512 100 0 --100
W

~

-200

SPNPR: 104.53

-300 -400
-60 -40 -20 0 20 40 TIme Ius) 60 80 100 120 140

Figure 4.31: Measured and de-noised electric field. Frame length: 512.
MellSU"ed Electric Field, May 09, 2002. File: e0934418.741

100 0
~-100

W

~

-200
-300

SPNPR: 9.52

-400

-60

-40

-20

0

20

40 Time [us)

60

80

100

120

140

De-Noised Electric Field, Frame Length: 1024 100 0

i

~

-100

W·200

SPNPR: 224.30

-300 -400 -60
·40 -20 0 20 40 Time [us) 60 80 100 120

140

Figure 4.32: Measured and de-noised electric field. Frame length: 1024.

4.20

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

M08SU1"ed Electric Field, May 09,2002, File: E0934418.741 100
0

~ -100
w -200
-300 -400 -60 120 140

SPNPR: 9.52

-40

-20

0

20

40 TIme (us]

60

80

100

De-Noised Electric Field, Frame Length: 2048 100

a
~ -100
W

-200 -300 -400 -60
-40 -20 0
20

SPNPR: 35.60

40 TIme (us)

60

80

100

120

140

Figure 4.33: Measured and de-noised electric field. Frame length: 2048,
MeaSlrod Electric Field, May 09,2002, File: E0934418.741 100

a

~ W -200
-300
-400

--100

SPNPR: 9.52

-60

-40

-20

a

20

40 TIme Ius]

60

80

100

120

100 0

De-Noised Electric Field, Frame Length: 3072

W

~

--100

-200 -300
-400 -60
-40 -20 0 20

SPNPR: 22.43

40

60

80

100

120

TIme (us]

Figure 4.34: Measured and de-noised electric field. Frame length: 3072. 4.21
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

When the STFT -based spectral subtraction is applied on the magnetic field (H), the de-noised waveforms are shown Figs. 4.35-4.38 for different frame lengths:
Measured Magnetic Field (H), May 09, 2002, File: E0934418.741 0.6 ,0.4

~ i:"

SPNPR: 2.93
0.2 0

-0.2 -60

-40

-20

0

20

40 Time [us)

60

80

100

120

140

De-Noised Magnetic Field, Frame Length: 512 0.6 0.4

SPNPR: 32.39

i:"

~

0.2 0
I I

-0.2 -60

-40

-20

0

20

40 Time [us)

60

80

100

120

140

Figure 4.35: Measured and de-noised magnetic field. Frame length: 512.
Measured Magnetic Field, May 09,2002, File: E0934418.741

o.6,---.---.--_.~-_.--~----~----~---~----~-----.

SPNPR: 2.93
o
-O·?S.'O;:;:-----=4':::-O-----=2'::-O----!0'-------='20----'-40-,---S...J..- - -.l.- - --'-OO---1-'-20---1 1 140 0 80

Time [US)
0.6,---.,---.-~~~~~~~~~~~~~~~--,---r--~

De-Noised Magnetic Field, Frame Length: 1024

0.4

~ z:

SPNPR: 51.51

0.2

o

-0·?S·~O------:4';;-O---~2';;-O--~O:------=20--::----!40=-----6...J..0---8.l.0---1-'-OO---12.L0--....J140
Time [us)

Figure 4.36: Measured and de-noised magnetic field, Frame length: 1024. 4.22

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

0.6~----~----~----~----'------r-----r-----r-----'-----'-----'

Measured Magnetic Field. May 09.2002. File: E0934418.741

0.4
:I:

~ 0.2
o

SPNPR: 2.93

~'~~0------4~0------2~O----~0----~20----~4~0-----6~0----~6~0----~1~00~--~1~20~--~140
Time [us]
De-Noised Magnetic Field, Frame Length: 2048 0.6.-----.-----.-----.-----,------,-----.-----,-----,-----,-----,

0.4

~ ~

SPNPR: 11.11

0.2

o
-0.~LO------4~O------2~O-----~0----~20------4~O-----60~----8~O-----1~OO~---1~20----~140

Time [us]

Figure 4.37: Measured and de-noised magnetic field, Frame length: 2048.
MeaSUl"ed Magnetic Field. May 09.2002. File:

0.6
0.4

E0934418.741

:I:

~

SPNPR: 2.93

0.2
0

-0.2

-60

....0

-20

0

20

40

60 3072

80

100

120

Time [us]

0.6

Oe-Noised Magnetic Field. Frame Length:

0.4

I I

SPNPR: 7.18

0.2

0

-0.2 -60

....0

-20

0

20

40

60

80

100

Time [us]

120

Figure 4.38: Measured and de-noised magnetic field, Frame length: 3072. 4.23

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

It is evident from the above figures and SPNPR values, the frame length 1024 gives the best result for both E and H fields .. When the proposed method is applied on E and H field measured on May 09, 2002, the denoised waveforms and their corresponding parameters are shown below:
Electric Field Parameters
May 0912002,10:54:04, Measured Electric (E) Field, File: E0934418.741 100 0

.
2:.

-100

w -200
-300

-400 -60

-40

-20

0

20

40 TIme [us]

60

80

100

120

140

De-Noised E Field

100 0

~ w -200
-300

~

-100

ltv \)
U
0 -40 -20 20 40 Time [us]

-400 -60

60

80

100

120

140

Figure 4.39: Measured and de-noised electric field. File: E0937718.741. Table 4.3: Electric field waveform parameters. File: E0934418.741.
Maximum Steepness (V/m/ps) Peak (V/m)
J0%- 90% Rise

Pulse Width (ps)

Time (ps)

-58.06

-368.102

3.635

11.673

4.24

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

May 0912002, Measured Electric Field, File: E0945656.601

SOO
400
300

w

~

200
100 0 -100 -60 ·40

·20

0

20

40 TIme [us)

60

SQ'

.100

120

140

De-Noised E Field

SOO
400
300

! w

200

100
0 -100 -60
-20
JI

ltv
0
20

-v

.
80

TIme [us)

40

60

100

120

140

Figure 4.40: Measured and de-noised electric field. Time: 12.40:56. File: E0945656.601. Table 4.4: Electric field wavefonn parameters. File: E0945656.601.
Maximum Steepness (VIm!ps) Peak (VIm) 10%- 90% Rise Time (ps) Pulse Width (ps)

46.73

404.285

1.336

3.2774

4.25
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Magnetic Field Parameters
May 09J2oo2, Measured Magnetic(H) Field, File: E093«18.741

0.5 0.4

I :c

0.3 0.2
0.1 0 -0·10

...

;'"
"

-

,:"

o

20

40 TIme [us)

60

80

100

120

140

~Noised

H Field

0.5
0.4

i :c

0.3
0.2

0.1

0
-0.1
-60

-40

-20

0

20

40 Time (us]

60

80

100

120

140

Figure 4.41: Measured and de-noised magnetic field, File:. E0934418.741. Table 4.5: Magnetic field waveform parameters. File: E0934418. 741.
Maximum Steepness (Aim!JiS) Peak (Aim) 10%- 90% Rise Time (JiS) Pulse Width (JiS)

0.05

0.412

5.3234

19.45 .

l

4.26

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

May 0912002, Measured Magnetic (H) Field, Rle: E0945S5S.S01 0.8 O.S

i ::r:

0.4 0.2 0 -0.2 -60 -20 0 20
40 nme[us)

-40

60

80

100

120

140

De-Noised H Field 0.8 0.6

! ::r:

0.4 0.2 0 -0.2 -SO -40
JI

~~
20
40 Time [us] SO

--.Iv- ·
80
100 120 140

-20

0

Figure 4.42: Measured and de-noised magnetic field, File: E0945656.601. Table 4.6: Magnetic field waveform parameters. File: E0945656.601.
Maximum Steepness (Aim; JiS) Peak (A/m) 10%- 90% Rise Time (JiS) Pulse Width (JiS)

0.07

0.6092

1.33

2.1431

From the above de-noised waveforms it is obvious that the proposed de-noising method makes it possible to obtain the field waveform parameters. The summary of the parameters obtained from the de-noised field waveforms are tabulated in Table 4.7.

4.27

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Table 4.7: Field wavefonn parameters, May 09,2002

Field Name

File Name Maximum Steepness (Vlmlps) -58.06
46.73

Parameters Peak (Vim) 10%-90% Risetime (PS) 3.635 -368.102
404.285 1.336

Pulse Width
(PS)

Electric Field (£)

E09344] 8.741 E0945656.601

11.673 3.2774

(Almlps)
Magnetic Field (H) E09344] 8.741 E0945656.60] 0.05 0.07

(Aim)
0.412 0.6092

(ps)
5.3234 1.33

(ps)
19.45 2. ]431

4.28
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Chapter 5
Conclusions
In this thesis we proposed an STFT -based Spectral Subtraction de-noising algorithm to minimize the effect of the unwanted interferences from the lightning current derivative signals measured at the CN Tower. We successfully applied the proposed method for de-noising the current derivative signals as well as the electric and magnetic field signals generated by lightning strikes to the CN Tower. This chapter presents the conclusions of the thesis and discusses directions of future work.

5.1 General Conclusions and Discussions.
In chapter 3 we delineated the suppression of quasi-periodic interferences. DC offset, high frequency and low frequency noise in recorded CN Tower lightning current derivative waveforms were removed or substantially minimized. In the summer of 1997, a new Rogowski coil was installed and was connected to the recording station through an optical fiber link, which renders the above types of noise almost insignificant. However, current derivative signals captured by the old Rogowski coil are important for the derivation of extensive statistics that are of interest to scientists working in the area of lightning protection. Aside from the limited data captured by the new Rogowski coil, it has been showing deterioration in its performance during the last several years. That is why de-noising the signals recorded by the old Rogowski coil is important. Heidler function is used to model the lightning current measured at the CN Tower, as described in chapter 3. The derivative of the Heidler function is artificially distorted by an actual noise 5.1

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

derivative signal, measured at the

eN Tower in the

absence of lightning. Then the Spectral

Subtraction method is used to remove the added noise. The proposed method gives better output when it is applied on the current derivative (di dt) signals rather than the current signals, as discussed in chapter 3. A new measure, signal-peak to noise-peak ratio (SPNPR) for analyzing the CN Tower lightning current signal is defined and calculated before and after the de-noising process. For example, for a typical measured eN Tower lightning current derivative signal, the SPNPR before de-noising was found to be 7.27, and after de-noising it became 151.30. Similarly for its current waveform (obtained by numerical integration), the SPNPR before de-noising was 20.16 and it became 361.39 after denOIsmg. A de-noised old coil current derivative waveform compares well with the simultaneously measured new noise-protected coil current derivative waveform. Furthermore, the current waveform, obtained by numerical integration of the de-noised current derivative waveform, proved close to that of the new coil. The current parameters obtained from the de-noised waveforms are reported in chapter 4. These parameters will assist in designing systems for protection from the hazards of the lightning discharge. It always proved difficult to even make an estimate of the waveform parameters for low level lightning current derivative and current waveforms obtained through the old coil (e.g., signals captured on May 09, 2002). However, applying the proposed method facilitated the determination of these parameters. When the Spectral Subtraction method was applied to a noise signal measured in the absence of lightning, it was found that allocating one third of the record to the pre-stroke lightning portion helps to characterize the noise signal and eventually de-noising it, as described in chapter 3.

5.2
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

5.2 Original Contributions
Original contributions of this thesis can be summarized as follows: I. The successful application of STFT-based Spectral Subtraction method forde-noising non-stationary noise, such as the noise embedded in the signal and its associated electric and magnetic fields. 2. Using Heidler function to simulate the lightning signal. 3. Simulating the noisy current signal by a combination of the derivative of Heidler function and a measured noise file in the absence of lightning. 4. Identification of future work.

eN Tower lightning current

5.3
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

5.3 Main Features
In conclusion, the main features of the proposed method are summarized as:

1. Capability of analyzing signals of non-stationary nature: The algorithm is
essentially a signal processing tool which is capable of analyzing non-stationary signals.

2. Capability of de-noising the signals of non-stationary noise: The core method
directly decomposes the signal into segments and estimates the average noise spectrum during the non-lightning period. The average noise spectrum is then subtracted from the signal to obtain the de-noised wavefonn.

3. Simplicity of the algorithm and programming: The algorithm is easy to implement
using Matlab programming software.

5.4
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

5.4 Future Work
More work is needed to improve and expand the area of application of the proposed de-noising method to reach following goals:

1. Noise cancellation witbout affecting tbe peak and rate of rise: The method should
work in such a way so that the peak and rate of rise of both the current derivative and current waveforms remain completely intact. The proposed method was found to very slightly affect the peak and rate of rise which is of concern.

2. Calculating tbe pulse widtb and tbe total cbarge introduced by lightning:
Reflections should be estimated and cancelled out from the lighting current signals which will help in calculating the current pulse width and the total impulse charge generated by lightning.

3. Electromagnetic interference source identification: A major research trend in electromagnetic compatibility (EMC) engineering is the application of signal processing in interference characterization, source identification and EMI mitigation. Characterization of interferences is useful as it helps in the identification of potential sources within or outside a system, tracing noise and interference and suppression or mitigation of the interferences [7, 19]. The proposed method, by virtue of its ability to decompose a signal into segments while tracking its time variations, is expected to be applicable in the area of interference analysis and cancellation.

5.5

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Pu blications and Awards
During the span of the thesis, the published papers and received awards are as follows:

[pI] M.l Islam and AM. Hussein, "De-noising the CN Tower Lightning Current Signal by Modifying Its Fast Fourier Transform", CAGE Club Student Conference on High Voltage

Engineering and Applied Electrostatics, University of Western Ontario, London, ON, August
20,2002. Note: Received Best Graduate Student Paper Award.

[p2] M.l Islam and A.M. Hussein, "A Novel Technique for De-noising the CN Tower Lightning Current Signal by Modifying Its Fast Fourier Transform", International Signal

Processing Conference (ISPC) , 2003, Paper# 287, pp. 1-5, Dallas, TX, USA, March 31- April
3,2003.

[p3] M.J. Islam and AM. Hussein, "Frequency Analysis of CN Tower Lightning Current Signals Using Short Term Fourier Transform", International Conference for Upcoming

Engineers (ICUE) , Paper# 2, Maxwell Session, pp. 1-4, Ryerson University, Toronto, ON,
May 1-2,2003. Note: Received Best Graduate Student Paper Award.

[p4] M.J. Islam and AM. Hussein, "De-Noising the CN Tower Lightning Current Signal Using
Short Term Fourier Transform-Based Spectral Subtraction", in preparation to submit to

Journal ofApplied Signal Processing (fhe European Associationfor Signal Processing).

PI

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

References
[1] M.A Uman, The Lightning Discharge, Academic Press, Inc., 1987. [2] AM. Hussein, W. Janischewskyj, J.S. Chang, V. Shostak, W. Chisholm, P. Dzurevych, and Z.I. Kawasaki, "Simultaneous Measurement of Lightning Parameters for Strokes to the Toronto CN Tower," Journal ofGeophysical Research-Atmosphere, vol. 100, DO. 5, pp. 8853-8861, May 1995. [3] W. Janischewskyj, AM. Hussein, V. Shostak,1. Rusan, J.x. Li and J.S. Chang, "Statistics of Lightning Strikes to the Toronto CN Tower (1978-1995)," IEEE Trans. Power Delivery, vol. 12, no. 3, pp. 1210-1221, July 1997. [4] P. Dzurevych, "Measurement and Analysis of Lightning Strokes to the CN Tower in Toronto", MASc. Thesis, Electrical and Computer Engineering Department, University of Toronto, ON, 1993.

[5] J.R. Barrat, "Influence of Reflections within Instrumental Towers on the measurement of
Lightning Current ", BASe. Thesis, University of Toronto, Toronto, ON, Dec., 1995. [6] A Obaid, "Improving the SNR oflightning Records Captured at the eN Tower using Linear Filtering Techniques ", BASe. Thesis, University of Toronto, Toronto, ON, Apr., 1993. [7] AK. Ziarani, "Extraction of Non-Stationary Sinusoids", PhD thesis. Electrical and

Computer Engineering, University of Toronto, Tomoto, ON, December, 2002.
[8] AA Girgis, F.M. Ham, "A Quantitative Study of Pitfalls in the FFT", IEEE Transactions

on Aerospace and Electronic Systems, vol. 16, no. 4, pp. 434-439, 1980. [9] M.J. Islam, A.M. Hussein, "Frequency Analysis of CN Tower Lightning Current Signals
Using Short Term Fourier Transform", International Conference for Upcoming Engineers

(ICUE), Paper# 2, Maxwell Session, pp. 1-4, Ryerson University, Toronto, ON, May 1 and
2,2003.

Rl

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

[10] S.K. Mitra, Digital Signal Processing: A Computer- Based Approach, Second Edition, New York: McGraw-Hill, 2001. [11] J.B. Allen, " Short Term Spectral Analysis, Synthesis, and Modification by Discrete Fourier Transform", IEEE Transactions On Acoustics, Speech and Sig. Processing, vol. ASSP- 25(3), pp. 235-238, 1977. [12] lB. Allen, L.R Rabiner, "A Unified Approach to Short Time Fourier Analysis and Synthesis", IEEE Transactions On Acou..;;tics, Speech and Sig. Processing, vol. 65, pp. 1558-1564, 1977. [13] http://engineering.rowan.edul-polikar/-wavelets [14] http://cnmat. berkeley. edul-alanlMS-htmIIMSv2. html [15] S.F. Boll, "Suppression of Acoustic Noise in Speech Using Spectral Subtraction", IEEE
Transactions on Acoustics, Speech, and Signal Processing, vol. ASSP-27, no. 2, pp. 113-

120, April 1979. [16] F. Heidler, "Lightning Electromagnetic Impulse", Theorie und Messungen, Thesis
dissertation, Fakultljl der Elektrotechnik, Universitat der Bundeswehr, MOnchen, 1987.
[17] M.l. Islam, AM. Hussein, "A Novel Technique for De-Noising the CN Tower Lightning

Current Signal by Modifying Its Fast Fourier Transform", International Signal Processing
Conference (ISPC), Paper# 287, pp. 1-5, Dallas, TX, USA, April 31- May 3, 2003.

[18] I. Rusan, "eN Tower Lightning Parameters", MASc. TheSis, University of Western Ontario, London, ON, May 1996. [19] G. Antonini, A Orlandi, "Wavelet packet-based EM! signal processing and source identification", IEEE Transactions on Electromagnetic Compatibility, vol. 43, no. 2, pp. 140-148,2001.

R2
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Appendix
Spectral SUbtraction Implementation Code in Matlab:

% signal is the variable that contains the dc removed di/dt

i2=signal;
% Half of window length Zero is inserted in front and back end

il=[zeros{l,1024),i2,zeros{l,1024)]i w=hanning(2048)i % Hanning window of size 2048 for segmentation
k=li

% Segmenting the signal into frames of length 2048 each one

for n=1:1024:1ength(il)-2047 sp(k,n:n+2047)=fft(w.*il(n: (n+2047))); % FFT of each frame abs_sp(k,n:n+2047)=abs(sp(k,n:n+2047)); % Magnitude of FFT angle_sp(k,n:n+2047)=angle(sp(k,n:n+2047)); % Phase angle
k=k+li

end s=size (sp) ; %Bias Estimation test_abs=(abs_sp(2,1025:3072)+abs_sp(3,2049:4096)) ./2; k=l; % Subtraction only magnitude in Frequency domain for n=1:1024:length(il)-2047 abs_sp(k,n:n+2047)=abs_sp(k,n:n+2047)-test_abs; k=k+l; end

Al

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

% Half Wave Rectification

for k=l:s(l) for n=l:length(il) if(abs sp(k,n)<O) abs sp(k,n)=Oi 'end end

% Signal Reconstruction Using Overlap Add Method

x_hat=zeros(l,length(il))i j=sqrt(-l)i
k=li

for n=1:1024:length(i1)-2047 x hat(:,n:n+2047)=x hat(:,n:n+2047)+real(ifft(abs_sp(k,n:n +2047) .*exp(j*angle_sp(k,n:n+2047)))); k=k+l; end
% Ignoring the zeros that was inserted in front and back end

no_dc_sigl=x_hat(1025:length(i1)-1024); % De-Noised dildt
% Integration of dildt

integ_sig1=zeros(1,length(signal));
% dt1 is the initial time step in ps that is 0.01

integ_sigl=cumsum(no_dc sigl)*dtl: % De-noised Current

A2
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

