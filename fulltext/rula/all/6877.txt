ALL-DIGITAL  TIME-TO-DIGITAL CONVERTER WITH BI-DIRECTIONAL GATED DELAY LINE TIME INTEGRATOR

by

Parth Parekh Bachelor of Engineering, Electronics and Communication Engineering, Gujarat Technological University, Gujarat, India, 2014

A project report presented to Ryerson University in partial fulfillment of the requirements for the degree of Master of Engineering in the program of Electrical and Computer Engineering

Toronto, Ontario, Canada, 2017 © Parth Parekh. 2017

AUTHOR'S DECLARATION FOR ELECTRONIC SUBMISSION OF A PROJECT

I hereby declare that I am the sole author of this project. This is a true copy of the project, including any required final revisions. I authorize Ryerson University to lend this project to other institutions or individuals for scholarly research. I further authorize Ryerson University to reproduce this project by photocopying or by other means, in total or in part, at the request of other institutions or individuals for scholarly research. I understand that my project may be made electronically available to the public.

ii

ABSTRACT

All-Digital  Time-to-Digital Converter with Bi-Directional Gated Delay Line Time Integrator © Parth Parekh, 2017 Master of Engineering Electrical and Computer Engineering Ryerson University

This report presents a low-power time integrator and its applications in an all-digital firstorder  time-to-digital converter (TDC). Time-to-Digital Converter (TDC) that map a time variable to a digital code is the most important building blocks of time-mode circuits. The time integrator is realized using a bi-directional gated delay line (BD-GDL) with time variable to be integrated as the gating signal. The integration of the time variable is obtained via the accumulation of the charge of the load capacitor and the logic state of gated delay stages. Issues affecting the performance of the time integrator and TDC are examined. The all-digital first-order  TDC utilizing the time integrator was designed in using IBM 130 nm 1.2 V CMOS technology and analysed using Spectre ASP from Cadence Design Systems with BSIM4 models. A sinusoid time input of 333 ps amplitude and 231 kHz frequency with an oversampling ratio 68 was digitized by the modulator. The TDC provides first-order noise-shaping and a SNR of 34.64 dB over the signal band 48.27 ~ 231 kHz while consuming 293.8 W. Key words - Time-mode circuits,  time-to-digital converters, Voltage-to-time converter (VTC), Bi-Directional gated delay line (BD-GDL), Bi-directional gated delay cell (BD-GDC)

iii

ACKNOWLEDGEMENTS First and foremost, I would like to express my gratitude towards my supervisor, Professor Fei Yuan, for his invaluable advice, countless constructive ideas, continuous support, motivation and feedback throughout my graduate study. I would also like to thank my colleague, Young Jun Park, for his wonderful collaboration and support with CAD tools. Finally, and most importantly, I would like to thank my parents for their continuous love, support and encouragement that they gave me throughout my graduate studies. This journey would not have come to a successful completion without their motivation which has helped me to push my boundaries at every stage of this beautiful journey.

iv

Table of Contents
Author's Declaration Abstract Acknowledgements List of Tables List of Figures List of Abbreviations ii iii iv vii viii xi

1. Introduction ..................................................................................................................................1 1.1 Motivation .............................................................................................................................1 1.2 Overview of time-mode signal processing ............................................................................2 1.3 Current literature on time-mode circuits ...............................................................................3 1.4 Outline ...................................................................................................................................4 2. Building Blocks of Time-mode Circuits and Applications..........................................................7 2.1 Building Blocks of Time-mode Circuits ................................................................................7 2.1.1 Voltage-to-time Converters .............................................................................................7 2.1.2 Time-to-digital Converters ..............................................................................................8 2.1.3 Digital-to-time Converters.............................................................................................13 2.1.4 Time Amplifiers ............................................................................................................13 2.1.5 Time Quantizers ............................................................................................................16 2.2 Applications .........................................................................................................................17 2.3 Summary ..............................................................................................................................17

v

3. Proposed work: All-Digital  TDC using Bi-Directional Gated Delay Line Time Integrator ........................................................................................................................................................18 3.1 Differential Voltage-to-time Converter ...............................................................................18 3.2 Bi-Directional Gate Delay Cell ...........................................................................................19 3.3 Bi-Directional Gated Delay Line ........................................................................................22 3.4 Single-ended Bi-Directional Time Integrator ......................................................................23 3.5 All-digital first order single-bit  TDC with single-ended BD-GDL time integrator ......25 3.6 Summary .............................................................................................................................27 4. Design Considerations ...............................................................................................................28 4.1 Nonlinearity .........................................................................................................................28 4.2 Inner-stage mismatch ..........................................................................................................28 4.3 Inter-stage mismatch ...........................................................................................................29 4.4 PVT effect ...........................................................................................................................29 4.5 Threshold voltage mismatch ................................................................................................29 4.6 Charge injection and clock feedthrough ..............................................................................29 5. Design Specification and Simulation results .............................................................................31 6. Conclusion .................................................................................................................................61 7. Future work ................................................................................................................................62 Appendix A (MATLAB Code) ......................................................................................................63 References ......................................................................................................................................65

vi

List of Tables
Table 5.1 Performance Comparison OF  TDCs .......................................................................32 Table 5.2 Breakdown of the power consumption of  TDC with single-ended BD-GDL time integrator .......................................................................................................................................32

vii

List of Figures
Fig. 2.1 Voltage-to-time converter using voltage controlled delay cell .........................................7 Fig. 2.2 (a) Direct-counter TDC. The counter starts at START=1 and stops at STOP=1. 1 and 2 are quantization errors with 1; 2  Tc. The input in the time domain is represented by: Tin = nTc + 1+ 1. (b) Direct-counter TDC with pulse stretching5.1 Performance Comparison OF  TDCs ........................................................................................................................................................10 Fig. 2.3 Delay-line TDCs (w/o counter). The delay of kth delay cell is given by k =  + k where  is nominal value of the delay and k is the random deviation of the delay from . When the counter is added, it becomes a direct-counter TDC with gate-delay interpolation .......................11 Fig. 2.4. Vernier delay line TDC ..................................................................................................13 Fig. 2.5 (a) RS-latch time amplifier (b) RS-latch time amplifier with an improved input range .15 Fig. 2.6. DDL-based time amplifier proposed by Rashidzadeh et al. [33] ...................................16 Fig. 3.1 Differential voltage-to-time converter ..............................................................................19 Fig. 3.2 Spectrum of Differential voltage-to-time converter ........................................................20 Fig. 3.3 Comparison of Spectrum of Differential VTC and Single-ended VTC ..........................21 Fig. 3.4 Bi-Directional Gated Delay Cell .....................................................................................22 Fig. 3.5 Bi-directional gated delay line. When Tin is positive, the forward direction is enabled, and Tin is negative, the reverse direction is enabled ............................................................................23 Fig. 3.6 Signal propagation in bi-directional gated delay line. The bold lines highlight the path that the signal propagates. Gating signals are not shown for brevity ..................................................24 Fig. 3.7 (A) Digital-to-time converter [8], (B) Edge Alignment block [44] .................................26 Fig. 3.8 All-digital first-order  TDC with a single-bit time quantizer [43] ..............................26 viii

Fig. 4.1 (a) Residual voltage nonlinearity. (b) Inner-stage mismatch ..........................................30 Fig. 5.1 All-Digital Delta-Sigma TDC test bench ........................................................................33 Fig. 5.2 All-Digital Delta-Sigma TDC .........................................................................................34 Fig. 5.3 Differential VTC ..............................................................................................................35 Fig. 5.4 Voltage Controlled Delay Unit (VCDU) .........................................................................36 Fig. 5.5 Digital-to-time Converter (DTC) .....................................................................................37 Fig. 5.6 T-Feedback ......................................................................................................................38 Fig. 5.7 Buffer1 for T-Feedback ...................................................................................................39 Fig. 5.8 Buffer2 for T-Feedback ...................................................................................................40 Fig. 5.9 2x1 MUX for DTC ..........................................................................................................41 Fig. 5.10 Tin-Block .......................................................................................................................42 Fig. 5.11 T-offset ..........................................................................................................................43 Fig. 5.12 XOR2 Gate ....................................................................................................................44 Fig. 5.13 AND2 Gate ....................................................................................................................45 Fig. 5.14 DEMUX for RS and LS signals ....................................................................................46 Fig. 5.15 Edge Alignment Block ..................................................................................................47 Fig. 5.16 NAND2 Gate .................................................................................................................48 Fig. 5.17 Inverter ...........................................................................................................................49 Fig. 5.18 OR2 Gate .......................................................................................................................50 Fig. 5.19 Buffer for T-offset .........................................................................................................51 Fig. 5.20 30-stages Bi-Directional Gated Delay Line (BD-GDL) ................................................52 ix

Fig. 5.21 Closer look of BD-GDL ................................................................................................53 Fig. 5.22 Bi-Directional Gated Delay Cell (BD-GDC) ................................................................54 Fig. 5.23 Gated Delay Cell ...........................................................................................................55 Fig. 5.24 D-Flip Flop ....................................................................................................................56 Fig. 5.25 2x1 MUX2 for Tin-Block ..............................................................................................57 Fig. 5.26 Transient Response of Delta Sigma TDC ......................................................................58 Fig. 5.27 Transient Response [Dout and Vin] ..............................................................................59 Fig. 5.28 Spectrum of all digital delta sigma TDC .......................................................................60

x

List of Abbreviations
ADC BD-GDC BD-GDL BW CMOS DAC DEM DFF DLL DTC FFT FIR FOM GRO IIR LSB MASH OTA Analog-to-Digital Converter Bi-directional gated delay cell Bi-directional gated delay line Bandwidth Complementary Metal Oxide Semiconductor Digital-to-Analog Converter Dynamic Element Matching D Flip-Flop Delay-Locked-Loop Digital-to-time converter Fast Fourier Transform Finite-impulse-response Figure-of-merit Gated Ring Oscillator Infinite-impulse-response Least Significant Bit Multi-stage Noise Shaping Operational trans conductance amplifier xi

OSR PD PFD PLL PSD PVT PWM SAR SNDR SNR SQNR TDC VCO VCDU VTC XOR 

Over Sampling Ratio Phase Detector Phase Frequency Detector Phase-Locked Loop Power Spectral Density Process (supply-)Voltage Temperature Pulse Width Modulation Successive Approximation Register Signal-to-Noise-and-Distortion Ratio Signal-to-Noise Ratio Signal-to-Quantization-Noise Ratio Time-to-Digital Converter Voltage-Controlled Oscillator Voltage-controlled delay unit Voltage-to-Time Converter Exclusive OR Delta-sigma

xii

xiii

1. Introduction
This chapter examines the motivation of this project by reviewing time-mode signal processing and important building blocks for time-mode signal processing. The key building blocks of timemode circuits includes time-to-digital converters (TDCs), Digital-to-time converters (DTCs), time amplifiers and time quantizers. A detailed review on these building blocks and applications will also be discussed in this chapter.

1.1

Motivation

The rapid scaling of CMOS technology and improvement in the intrinsic delay of digital circuits has resulted in sharp increase of time resolution and the continuous reduction of voltage resolution. As a result, CMOS analog circuits are continuously losing the benefits of specialized and processcontrolled components which are critical to the performance of these circuits. In addition, voltagemode systems also cope with a rapidly decreasing voltage headroom, that is, the difference between the given supply voltage of a circuit and the minimum supply voltage of the circuit required for MOS transistors to operate in saturation region. The shrinking voltage headroom not only limits the maximum achievable signal-to-noise ratio (SNR), it also signifies that the effect of the nonlinear characteristics of MOS devices subsequently reduces the dynamic range of voltagemode circuits. Further, technology scaling raises the thermal noise floor quantified by kT/C where k is Boltzmann's constant, T is temperature in Kelvin, and C is the minimum capacitance. As a result, the accuracy of voltage-mode circuits, loosely defined as the ration of the minimum detectable voltage, typically set by thermal noise floor, to the maximum available voltage headroom, scales poorly with technology. Furthermore, current-mode circuits achieve low voltage swing by lowering the impedance of the nodes. This low-impedance gives rise to large branch 1

currents. As a result, current-mode circuits typically consume more power. Hence, they are suitable for applications where speed rather than power consumption is most critical. Therefore, the performance of both circuits does not scale well with technology due to their limitations. As a result, time-mode signal processing where information is represented by the time difference between occurrence of two digital events rather than the nodal voltages or branch currents of electric networks offer viable and technology friendly way to reduce scaling-induced performance degradation of mixed-mode systems.

1.2

Overview of time-mode signal processing

Time-mode approaches where information is represented by the difference between the time instants at which digital events take place rather than the nodal voltages or branch currents of electric networks. The time difference between the rising edges of the two digital signals is directly proportional to the amplitude of the analog signal. Since time-mode circuits perform analog signal processing in the digital domain, not only the performance of these circuits scales well with technology, but also offer several attractive characteristics including full programmability, lowpower consumption and high-speed operation. The detrimental effect of technology scaling on the performance of voltage-mode and current -mode analog signal processing disappears in time-mode circuits. Time-mode circuits are less sensitive to interferences such as cross talk, switching noise and substrate coupling, which have a severe impact on the performance of voltage-mode and current-mode circuits. Although time-mode signal processing has a number of advantages over voltage-mode and current-mode counterparts, there are some challenges that need to be overcome in order for time-mode circuits to be deployed in broad range of applications. The intrinsic gated delay of the digital circuits benefits from technology scaling, device mismatch arises mainly from process spread deteriorates with technology scaling. In order to minimize the effect of device 2

mismatch, minimum sized unit delay cells should be avoided. This inevitably has a detrimental effect on the speed and subsequently on the resolution of time-mode circuits. Time-mode circuits mostly built upon delay cell, such as static CMOS inverters and current-starved CMOS inverters, the propagation delay of these delay cell is a strong function of supply voltage fluctuation. For time-mode circuits, delay-locked loops (DLLs) are widely used to minimize the effect of process, supply and temperature (PVT) variations on the delay of the delay lines. Although DLLs can be used to stabilize the delay of the delay lines, it is difficult to use them to minimize the effect of PVT on the delay of the logic gates that are often part of time-mode circuits and control the operation of time-mode circuits. Time-mode circuits have also been used in audio [12], medical imaging [13], instrumentations [14], infinite-impulse-response (IIR) filters [15], finite-impulseresponse (FIR) filters [16], and anti-imaging filters [17], frequency synthesizers [18, 19]. Despite these developments, there are very few literatures that offer a comprehensive analysis of the principles and design techniques of CMOS time-mode circuits for mixed-signal processing. Therefore, the principles and design techniques of the building blocks for time-mode circuits are provided in the next few chapters as part of this report.

1.3

Current Literatures on Time-mode Circuits

Time-mode signal processing, where information is represented by the time difference between the occurrence of digital events, offer a viable and technology friendly means to combat scalinginduced difficulties encountered in mixed-mode systems.  modulators are perhaps one of the most widely used mixed-mode systems. Li et al., showed that an input voltage can be digitized using a voltage-to-time converter (VTC) followed by a time-to-digital converter (TDC) [1]. Itawa et al., demonstrated that an input voltage can be digitized using a voltage-controlled oscillator (VCO). The number of the oscillation cycles of the oscillator recorded using a counter provides 3

the digital representation. The continuity of the phase of the oscillator yields the desired first-order noise-shaping of quantization noise [2]. Hovin et al., showed that first-order noise-shaping can also be obtained from first-order phase differentiators [3]. Straayer et al., showed that gated ring oscillators (GROs) also possess first order noise-shaping obtained by freezing the residual phase of one sampling phase and passing it over to the next phase [4]. Konishi et al., demonstrated that the floating output state of GROs during the absence of the gating signal can be replaced with another oscillation state to minimize the detrimental effect of charge leakage and charge redistribution [5]. The main drawbacks of reported  modulators with a GRO/SRO quantizer include poor scalability and excessive power consumption arising mainly from the use of operational trans conductance amplifier (OTA) loop filters for a large loop gain. Many efforts were made to replace OTA-based active filters with time-mode filters such that entire modulators are realized digitally. Taillefer and Roberts proposed a ring oscillator voltage-to-time integrator that performs both voltage-to- time conversion and time integration [6]. Ali-Bakhshian and Roberts introduced a time memory cell consisting of two switched delay units (SDUs) that can store a time variable indefinitely and reading out the stored time variable upon a read command so that time integration is possible [7]. The time-difference accumulator proposed by Hong et al., consists of two back-to-back connected time adders realized using four gated delay cells [8], [9]. Kim et al., showed that a gated delay line functions as a time register with the gating signal consisting of the time variable to be stored and a trigger signal [10], [11].

1.4

Outline

This report presents all-digital time-mode integrator realized using a bi-directional gated delay line with the time variable to be integrated as the gating signal. The integration of the time variable is obtained via the accumulation of the charge of the load capacitor and the logic state of the delay 4

stages. The report is organized as follows: Chapter 2: Building Blocks of Time-mode Circuits and Applications of Time-mode Signal Processing, Chapter 3: Proposed work: All-Digital  TDC using Bi-Directional Gated Delay Line Time Integrator, Chapter 4: Discussion, Chapter 5: Design Consideration and Simulation Results, Chapter 6: Conclusion, Chapter 7: Future work.

5

2. Building Blocks of Time-mode Circuits and Applications
2.1 Building Blocks of Time-mode Circuits
A complex analog circuit is typically constructed from a set of building blocks such as commonsource amplifiers, common-gate amplifiers, common-drain amplifiers, cascode amplifiers, and differentially configured amplifiers. Similarly, time-based signal processing systems are made of a set of building blocks that perform tasks such as interfacing with voltage-mode and current-mode circuits, time amplification, time quantization, time-to-digital and digital-to-time conversion.

2.1.1 Voltage-to-time Converters
One of the key building blocks of time-mode systems for processing analog signals is voltage-totime converters (VTCs) that map a voltage to time variable with its value directly proportional to the amplitude of the voltage. A VTC serves as a gateway bridging between voltage-mode and timemode domains. The most important performance indicators of VTCs are linearity, bandwidth and conversion gain. As time-mode circuits are digital circuits, the linearity of time-mode system is largely dominated by that of its VTC. A large and constant conversion gain over a large input voltage range is highly desirable. The bandwidth of VTC, on the other hand, determines the maximum frequency of the input that time-mode circuits can process. Since MOSFETs are highly nonlinear devices, the design of VTCs with a large conversion gain over a large input range, low power consumption, and a high conversion speed is rather challenging. VTCs are typically implemented using a voltage-controlled delay unit (VCDU) with a reference signal with which the

6

input signal is compared from a timing ring voltage-controlled oscillator (VCO) whose frequency is constant. A voltage can be mapped to a time variable using the VCDU as shown in Fig. 2.1. The VCDU consists of a current-starved inverter, that is, a static inverter with its charging or discharging current controlled by a current source, a load capacitor, and a static inverter. The load capacitor should be linear and its capacitance should be much larger as compared with the capacitances of the transistors such that the effect of the nonlinearity of the device capacitances is negligible as compared with that of the load capacitor. The current-starved inverter is clocked by a periodic signal CLK that presets the VCDU prior to a conversion operation. In the pre-charge phase where CLK is low, the load capacitor charges to VDD and the output of static inverter is set to logic-0. In the following discharge phase where CLK = 1, the load capacitor is discharged by the current of M3 whose value is set by the input voltage Vin at the end of the pre-charged phase.

Fig. 2.1 Voltage-to-time converter using voltage controlled delay cell. The voltage of the gate of M3 is kept unchanged during the discharge phase and so is the discharging current of the load capacitor. As a result, the voltage of capacitor C decreases linearly 7

with time. When Vo1 drops below the threshold voltage VT of the following static inverter, Vo2 will be set to logic-1. The value of resultant time variable Tin, which measured from the time instant at which CLK = 1 to the time instant at which Vo1 crosses the threshold voltage of the inverter. An additional transistor M4 is added in parallel with M3 to improve the linearity of time variable Tin. To further improve the linearity, a differentially configured VTC consisting of two identical VTCs can be used, which will be discussed in later chapters.

2.1.2 Time-to-Digital Converters
TDCs map a time variable to a digital code. TDCs are perhaps the most important building blocks of time-mode circuits. The deployment of TDCs in nuclear science research dates to 1970s [20,25]. The application of TDCs has extended well beyond nuclear science to digital storage oscillators [21,22], laser range finder [23], and digital frequency synthesizers [24]. Similar to analog-todigital converters, the performance of TDCs is quantified by a number of parameters such as SNR and SNDR for noise shaping TDCs, and differential nonlinearity (DNL) and integral nonlinearity (INL) for sampling TDCs. To compare the performance of different architectures, the amount of power consumption per conversion step of TDCs is the most widely used figure-of-merit (FOM).

A. Direct-Counter TDC
A direct-counter TDC is basically a counter that quantizes a time-difference variable by counting the number of the cycles of a reference clock whose period Tc is much smaller as compared with the time-difference Tin to be measured, as shown in Fig. 2.2(a). These TDCs have a dynamic range upper-bounded by the size of the counter. In addition, they provide a superior linearity as the linearity is only affected by the stability of the frequency of the reference clock. The quantization errors 1 and 2 are due to the misalignment of the rising edges of START, STOP, and that of the reference clock. Clearly, 0  1, 2  Tc. The resolution of direct-counter TDCs is set by the period 8

of the reference clock. The higher the frequency of the reference clock, the better the resolution, and the smaller the quantization error. This, however, is at the cost of high power consumption and a deteriorating crosstalk. Direct-counter TDCs are therefore preferred only if Tin is large simply due to their ease of implementation. To minimize the quantization error of direct-counter TDCs, Chen et al. showed that the quantization errors 1 and 2 can be first stretched much larger than Tc and then digitized by the reference clock, yielding a significantly reduced quantization error, as shown in Fig. 2.2(b) [22]. Pulses T1 and T2 are generated at the rising edge of START and STOP, respectively with their falling edge aligned with the next rising edge of the reference clock. Pulse stretching starts with the assertion of a reset (RST) command that brings the voltage of C1 and C2 to VDD. The discharge of C1 and C2 is controlled by J1 and J2, respectively. Since J1 = N J2 and C2 = M C1 with M, N > 1, the discharge of C1 is much faster than that of C2. The discharge process is initiated by T1. Vo is set to HIGH and will remain HIGH until Vc2 = Vc1. Since Vc2 drops much slower, it will take k cycles of CLK before Vc1 = Vc2 occurs. The number of cycles needed is recorded by the counter incremented by CLK. The content of the counter therefore provides the digital representation of the quantization errors 1. The same process is followed when quantizing 2. To determined k, from Vc1 = Vc2 where Vc1 and Vc2 are the voltage drop of C1 and C2 from VDD, respectively and noting  Vc1 = (J1=C1) T1 and Vc2 = (J2=C2) Tc k, we arrive at k = M N (T1=Tc) or equivalent T1= k Tc = M N T1. T1 is the stretched version of T1. It is evident that T1 is stretched by M N times. The dual-slope of the preceding pulse stretching approach makes it less sensitive to the effect of PVT. This approach, however, suffers from a speed penalty due to the slow discharge of C2. The need for a voltage comparator and two constant current sources also makes it less attractive in digital-oriented designs.

9

Fig. 2.2 (a) Direct-counter TDC. The counter starts at START=1 and stops at STOP=1. 1 and 2 are quantization errors with 1; 2  Tc. The input in the time domain is represented by: Tin = nTc + 1+ 1. (b) Direct-counter TDC with pulse stretching.

B. Delay-Line based TDC
To reduce quantization error without sacrificing speed or deploying analog circuitry, the delayline TDC shown in Fig. 2.3 (without the counter) with a START signal propagating through the delay line and a STOP signal disabling D Flip-Flops (DFFs) can be used. The dynamic range of delay-line TDCs is from 00...0 to 11...1, thermometer coded. Clearly, the upper bound of the dynamic range of delay-line TDCs is set by the length of the delay line while the lower bound is set by the delay of the delay stages. Since the resolution is limited by the delay of the delay cells, the performance of delay-line TDCs scales well with technology [26]. The linearity of delay-line TDCs is determined by the mismatch of the delay of the delay stages and worsens when the number of delay stages is large, simply due to the accumulation of delay mismatch-induced error. To minimize the effect of PVT on the delay of delay cells and error accumulation along the delay line, a delay-locked loop (DDL) is typically employed, as shown in Fig. 2.3 [27]. If the delay of each 10

delay stage is  and the number of delay stages is N, then in the lock state, START and XN are phase-aligned, i.e. XN lags START by Tc where Tc is the period of START. Since START and XN are phase-aligned, we have  = Tc = N where  is the delay of the delay stages. Clearly  is only affected by Tc and N, and is not subject to the effect of PVT. Note that since the DLL locks to the input signal in this configuration, delay-line TDCs do not need a reference clock. It should also be noted that TDCs with DLLs locked to a reference rather than the input was also proposed [28]. In this approach, two identical delay lines, one locked to the reference and the other processes the input, are needed. The key advantage of this approach is that the delay of the dual delay lines is only determined by the reference clock and is independent of the input.

Fig. 2.3 Delay-line TDCs (w/o counter). The delay of kth delay cell is given by k =  + k where  is nominal value of the delay and k is the random deviation of the delay from . When the counter is added, it becomes a direct-counter TDC with gate-delay interpolation. 11

C. Vernier Delay-Line TDC
High-resolution TDCs can be obtained using Vernier delay lines where START and STOP signals whose time difference is to be measured propagate in two separate delay lines of the same length but different delays, as shown in Fig. 2.4 [29, 30]. The delay line in which START propagates thereafter called START-line has a slightly longer delay as compared with that of STOP-line, i.e. 1 > 2. Since the delay of START-line is larger, STOP signal propagating in STOP-line will catch START signal in START-line if the lines are long enough and the time difference between START and STOP signals is not overly large. When this occurs, time-to-digital conversion is completed and the resultant digital code is given at the output of the DFFs. The time at which a catch-up occurs is determined from Tcatch = N1 = N2 + Tin where N is the number of the delay stages of the Vernier delay lines and Tin is the time difference between START and STOP. For a given Tin, the number of the delay stages is determined from N = T = (1 - 2). Clearly, the dynamic range of Vernier delay line TDCs is upper-bounded by the length of the lines and lower-bounded by 1 2. Although theoretically, if 1 - 2 is sufficiently small and Vernier delay lines are sufficiently long, the resolution of Vernier delay line TDCs can be made arbitrarily small. In reality, it is limited by the finite length of Vernier delay lines and the mismatch of the delay of the delay cells. Vernier delay line TDCs suffer from a large hardware cost due to the need for two long delay lines and a finite dynamic range upper-bounded by the length of the delay lines, especially when 1 - 2 is small. The performance of Vernier delay line TDCs can be improved using two-level Vernier lines with the coarse Vernier lines having a large delay difference c and the fine Vernier lines having a small delay difference f where the subscripts c and f signify "coarse" and "fine", respectively [31]. Although the dynamic range is improved, the complexity of the TDC is also significantly increased. To minimize the effect of PVT on Vernier delay line TDCs, DLL-stabilized Vernier delay line TDCs shown in Fig. 2.4 (with dotted sections) can be utilized [30]. The transition edge 12

Fig. 2.4. Vernier delay line TDC. of XN is phase-aligned with START such that N1 = T1 where T1 is the period of START from which we have 1= T1=N. Clearly this configuration does nothing to minimize the effect of PVT on STOP-line. To minimize the effect of PVT on the delay of STOP-line, another DLL can be utilized, as shown in Fig. 2.4.

2.1.3 Digital-to-Time Converters
DTCs map a digital code to a time variable. A digital-to-time operation is needed in applications such as time-mode successive approximation TDCs. A DTC assumes a similar role as that to a digital-to-analog converter in voltage-mode successive approximation analog-to-digital converters (ADCs) or multibit  modulators to establish negative feedback.

2.1.4 Time Amplifiers
Similar to a voltage amplifier that amplifies a voltage, a time amplifier amplifies a time variable. Time amplification is needed in application such as the precision measurement of the width of a narrow pulse where the pulse width is often too small to be quantized accurately. Time amplification can also be employed for accurately quantizing the output of TDC-based phase 13

detectors near the lock state to establish a precision phase lock. Time amplifiers play vital role in improving the resolution of time-mode circuits. For the high-speed time digitization, the bandwidth of time amplifiers is also a great of importance.

A. Regenerative Time Amplifier
Time amplifiers that are based on the metastability of SR-latches were proposed by Abas et al., [32] and are shown in Fig. 2.5(a). These time amplifiers utilize the re-generative mechanism of the SR-latch to expend narrow pulses [34, 35]. A key advantage of RS-latch time amplifiers is their fast response and ability to amplify a small-time difference. The main drawback of these time amplifiers is that the gain of the amplifiers is set by the characteristics of the latch and is strongly subject to the effect of PVT. Another notable drawback of these time amplifiers is small input range due to the positive feedback mechanism and poor gain nonlinearity. The SR-latch time amplifier proposed by Lee and Abidi and shown in Fig. 2.5(b) improves the input range of the generic SR-latch time amplifiers by inserting two delay units with delay  to generate an unbalanced re-generation mechanism. A drawback of Lee-Abidi time amplifier is that the time mismatch of the buffer delays might be significant once the input time difference to be amplified is small, introducing a negligible error. This drawback can be removed by using unbalanced active charge pump load proposed in [36].

B. DLL-based Time Amplifier
The DLL-based time amplifier proposed by Rashidzadeh et al., and shown in Fig. 2.6 uses a closed-loop approach to amplify time while minimizing the effect of PVT on the delay [33, 37]. The two periodic inputs of identical period T are fed to two delay lines of the same number of delay stages N but different stage delays. The phase of the waveform at nodes A and B is aligned using the DLL that adjusts the delay of delay line 1 such that in1 + 21/T = in2 + 22/T from 14

which we have 1 - 2 = 2/T =T (1 - 2). The output of the time amplifier is given by Tout = (N - 1) (1 - 2).

Fig. 2.5 (a) RS-latch time amplifier (b) RS-latch time amplifier with an improved input range. Since the DDL must be settled in order to amplify the time difference, the deployment of this type of time amplifiers for high-speed applications is rather difficult. The mismatch of the delay of the delay stages, which is not corrected by the DLL, will also affect the accuracy of the amplifier especially when in1 - in2 is small.

C. Charge-pump Time Amplifier
Time amplification can also be accomplished by first charging a pair of capacitors with two digital signals whose time difference is to be measured and then sensing the difference of the voltage of the capacitors [38, 39]. The need for constant current sources and voltage comparators of this 15

approach, however, undermines the very reason why time-mode approaches are wanted in the first place. The time amplifier proposed by Kim et al., in [40] utilizes a primitive logic operation to achieve a 3.75 ps resolution in 65 nm CMOS. Since the implementation is completely open-loop, its performance is subject to the effect of PVT.

Fig. 2.6. DDL-based time amplifier proposed by Rashidzadeh et al. [33].

2.1.5 Time Quantizers
A single bit voltage quantizer maps a voltage to a Boolean variable by comparing it with a reference voltage. Similarly, a single bit time quantizer maps a time variable to a Boolean output by comparing it with a time reference. Time quantizers can be realized using a time comparator with the time reference with which the input compares coming from a voltage controlled oscillator (VCO) of a constant frequency. To conduct the multibit quantization of a time variable, the time variable can be used as a gating signal to activate or deactivate a multistage ring oscillator of a constant oscillation frequency, as known as gated ring oscillator (GRO). Since the number of the oscillation cycles of the oscillator and the output of each stage of the oscillator uniquely correspond to the duration of the gating signal, a multibit time quantizer can be constructed. GRO-based multibit time quantizers offer the intrinsic advantage of first-order noise shaping. In addition, as compared with voltage-mode multibit quantization, which requires a total of 2N voltage comparators where N is the number of quantization bits, VCO based multibit time quantization

16

offers the advantage of low-power consumption, fast quantization resulting in a large over sampling ratio (OSR), good linearity, first -order noise-shaping and all-digital realization.

2.2 Applications
The key applications of time-based signal processing include analog-to-digital converters, alldigital phase locked loops (PLLs), all-digital frequency synthesizers, and time-based temperature sensors.

2.3 Summary
In this chapter, the key building block of time-mode circuits including VTCs, TDCs, DTCs, time amplifiers and time quantizers and applications of time-mode signal processing were briefly examined. It can be concluded that the current-starved VTC, regenerative time amplifier, GRObased TDC can be used to realize all-digital time-mode circuits since they offer the advantage of low-power consumption, simple architecture and require small area.

17

3. Proposed work: All-Digital  TDC using BiDirectional Gated Delay Line Time Integrator
This chapter presents a new all-digital time-mode integrator realized using a bi-directional gated delay line with the time variable to be integrated as the gating signal. The integration of the time variable is obtained via the accumulation of the charge of the load capacitor and the logic state of the delay stages. The differential VTC implemented using two identical voltage controlled delay units (VCDUs) is discussed in Section 3.1. Section 3.2 examines the bi-directional gated delay cell (BD-GDC). The bi-directional gated delay line (BD-GDL) implemented using BD-GDCs is investigated in Section 3.3. Section 3.4 looks into how BD-GDL function as a time integrator. Other key building blocks required for all-digital  TDC are analyzed in Section 3.5. The alldigital first order single-bit  TDC is discussed in Section 3.6. The chapter is summarized in Section 3.7.

3.1 Differential Voltage-to-time converter
A differentially configured VTC consisting of two identical single-ended VTCs generates the gating signal which is a sinusoidal time signal from a sinusoidal voltage signal using a sampling clock, as shown in Fig. 3.1. Since the capacitor voltage Vc drops with time in a nonlinear fashion due to the dependence of the current following through the output resistor of transistors M1 and M2 on Vc, single-ended VTCs exhibit a high degree of nonlinearity. The differentially configuration of the VTC ensures that even-order harmonics are adequately suppressed. Fig. 3.2 plots the spectrum of the output of the differential VTC. Fig. 3.3 shows the comparison of the spectrum of single-ended VTC and differential VTC.

18

Fig. 3.1 Differential voltage-to-time converter. Diode-Connected M3 and M4 improve the linearity.

3.2 Bi-Directional Gate Delay Cell
Consider the bi-directional gated delay cell shown in Fig. 3.4. The rising edge of a digital signal propagates from node 1 to node 2 (forward) if gating signal Tin is positive or from node 2 to node 1 (backward) if Tin is negative. The per-stage delay in both directions is identical. Consider the case where the signal propagates from node 1 to node 2. Node 1 and node 2 are initialized to VDD and 0 V, respectively. When Tin [j] > 0, the capacitor connected to node 2 will be charged and the variation of capacitor voltage denoted by V2 will be proportional to the duration of Tin [j]. Similarly, if Tin [j] < 0, the capacitor connected to node 1 will be discharged and the variation of capacitor voltage denoted by V1 will be proportional to the duration of Tin [j]. The gating signal Tin [j] can therefore be represented by the voltage variation of the load capacitors. Consider that Tin is a train of pulses Tin [j], k = 1, 2, ..., K, that can be either positive or negative. If Tin [j] is positive, the load capacitor is charged and the resultant voltage increment is proportional Tin [j]. If Tin [j] is negative, the load capacitor is discharged and the resultant voltage decrement is also proportional Tin [j]. We therefore have j=1 Tin, k = j=1 kj Vc, j. If Vc exceeds the threshold voltage 19

Fig. 3.2 Spectrum of Differential voltage-to-time converter 20

Fig. 3.3 Comparison of Spectrum of Differential VTC and Single-ended VTC 21

of the next delay stage, the signal will propagate to the next stage. The bi-directional gated delay cell thus performs the accumulation (integration) of Tin by means of charge accumulation and the change of the logic state of the delay stages.

Fig. 3.4 Bi-Directional Gated Delay Cell.

3.3 Bi-Directional Gate Delay Line
A bi-directional gated delay line performs the same task as up-down counter does, but the key difference between them is that BD-GDL can do that withholding load capacitor residual voltage Vc. This is essential to noise-shaping when BD-GDL is used as an integrator. If the load of a BDGDC is another identical BD-GDC whose threshold voltage is VT, GDL = VDD / 2, the voltage range of the load capacitor is only 0 ~ VT, GDL, limiting the number of Tin [j] pulses that can be summed up. Although one can use a large load capacitor to handle a long train of positive or negative pulses, like what a charge pump does, in order to quantify the voltage of the load capacitor so as to yield the output of the time integrator, a voltage-to-time converter is needed, contradicting our goal to perform time-mode integration in digital domain only. An alternative is to cascade multiple identical BD-GDCs to form a BD-GDL, as shown in Fig. 3.5. Load capacitance Ck is formed by device capacitances only such that no explicit capacitors are needed. When the voltage of the gated 22

delay stage exceeds VT, GDL, the output of the driven gated delay stage will be toggled. The use of the gated delay line allows us to perform time accumulation over a large range set by the length of the delay line. The BD-GDL used in this work has 30 stages. In order to handle both positive and negative time variables encountered in time-mode  modulators, the left-half-side nodes from node M in Fig. 3.5 are initialized to VDD and those in the right-half side from node M are initialized to ground. It is important to note that the left-most gated delay cell is connected to VDD while the right-most gated delay cell is grounded to ensure that "1" always propagates rightwards when Tin > 0 and "0" always propagates leftwards when Tin < 0.

Fig. 3.5 Bi-directional gated delay line. When Tin is positive, the forward direction is enabled, and Tin is negative, the reverse direction is enabled.

3.4 Single-ended Bi-Directional Time Integrator
The single-ended bi-directional gated delay line (BD-GDL) can function as a time integrator if the time variable to be integrated is the gating signal. To demonstrate that, consider a 5-stage BDGDL. As shown in Fig. 3.6, consider a train of 5 pulses, Tin [k] where k = 1, 2, ..., 5 with Tin [1] = 1.2 , Tin [2] = 1.5 , Tin [3] = -1.1 , Tin [4] = 0.7 , and Tin [5] = -2.5  where  is the per-stage delay. Assume V1n = V2n = VM = 1 and V1p = V2p = 0 initially. Further assume if Tin = , signal "1" will propagate through one delay stage, i.e., the averaged rate of change of the output voltage of 23

gated delay cells is VT, GDL / . With Tin [1] = 1.2 , logic-1 at node M propagates through one stage in the forward direction and charges C1p to 0.2 VT, GDL. Similarly, with Tin [2] = 1.5 , the signal continues to propagate through 2-stage and charges C2p to 0.7 VT, GDL. When Tin [3] = -1.1 

Fig. 3.6 Signal propagation in bi-directional gated delay line. The bold lines highlight the path that the signal propagates. Gating signals are not shown for brevity.

arrives, the forward gated delay line is disabled while the reverse gated delay line is activated. Since V3p = 0, the charge of C2p is discharged. The same for V1p. It becomes evident that the bidirectional gated delay line performs the accumulation (integration) of Tin [k]. To digitize the result of the time integration, D-flip flops (DFFs) can be deployed at the output of each gated delay stage. The output of the time integrator is a thermometer code in the form 1...10...0 with the left-most 0 specifying the vanishing location of the node M. It becomes apparent that the maximum quantization error of the time integrator, denoted by max, is . The actual quantization error, 24

denoted by k, is preserved in the form of the voltage of the load capacitor Vc, k of the stage whose right-adjacent stage has an output of 1. Utilizing the relation between VT, GDL and , we arrive at  =
, ,

.

3.5 All-digital first order single-bit  TDC with single-ended BD-GDL time integrator

In this section, we utilize the preceding time integrator to construct an all-digital first-order  TDC with a single-bit time quantizer. To construct the time quantizer, we notice that the output of the bi-directional gated delay line time integrator is a thermometer code. If the output of the time integrator is larger than , V1p will be set to 1, otherwise, it will be set to 0. Note that  Tin smaller than  cannot be detected. It, however, is preserved by the residual voltage of the load capacitor and can be further processed using a MASH architecture. This observation reveals that the output of the delay stage that is right-connected to node M provides the single bit quantization of the output of the integrator. The minimum quantization noise is per-stage delay. The addition/subtraction of feedback time Tfb, approximately 1.2Tin ~ 1.5 Tin, to/from Tin are performed using a single-bit digital-to-time converter (DTC) and a time adder shown in Fig. 3.7(A). The multiplexers are controlled by the output of the time quantizer Dout. If Dout > 0, meaning =1 Terr [j] > 0, Tfb is subtracted from Tin aiming at generating Terr [j + 1] < 0. Otherwise, it is added to Tin to generate Terr [j + 1] > 0. The resultant Terr along with its polarity are connected to the | Tin |block where the absolute value of Tin is obtained. Since Terr can be quite small, a time offset Toff = 200 ps is added such that the duration of the gating signal exceeds per-stage delay. The polarity of Terr is determined using a DFF whose output is 1 if Terr > 0 and 0 otherwise, and determines the direction of propagation. Also, the deployment of the AND2 gate ensures that integration is carried out only during IN1 = 1. The de-multiplexer, controlled by "Sign" signal, following to the AND2 25

gate determines the right-propagation signal and left-propagation signal. The edge aligners, as  are completely out of shown in Fig. 3.7(B), ensure that the right-propagation signal RS and  phase. The same also goes for the left-propagation signal LS and   .

Fig. 3.7 (A) Digital-to-time converter [8], (B) Edge Alignment block [44].

Fig. 3.8 All-digital first-order  TDC with a single-bit time quantizer [43].

26

The right and left propagation signals generated by edge aligners are fed to single ended BD-GDL. The output of DFF connected to the node M of the BD-GDL provides a time-quantized feedback pulse. Furthermore, the input of the modulator is a sinusoidal time signal, generated using the differential VTC detailed earlier. The design specification and simulation results are attached in Chapter 5.

3.6 Summary
In this chapter, the function of all the key building blocks for all-digital  TDC including differential VTC, bi-directional gated delay cell, bi-directional gated delay line, digital-to-time converter, | Tin |-block, edge aligner was briefly investigated. It can be concluded that the singleended BD-GDL can function as a time integrator if the time variable to be integrated is the gating signal. Also, it is evident that single-ended VTC exhibits a high degree of nonlinearity as compared with differential VTC. The differential configuration of the VTC ensures that even-order harmonics are adequately suppressed. Furthermore, the output of DFF connected to the node M of the BD-GDL provides a time-quantized feedback pulse.

27

4. Design Consideration
In this chapter, some issues critical to the performance of the TDC are examined.

4.1 Nonlinearity
The integration of Tin is obtained by means of the accumulation of the charge of the load capacitor and the logic state of the delay stages. If we neglect the variation of per-stage delay caused by process spread, BD-GDLs will be linear over different stages. The relation between Tin and residual voltage Vc, however, is nonlinear. To illustrate this, let Tin [j] be identical for j = 1, 2, 3, .... Consider the charging process of the load capacitor and neglect the drain source voltage VDS of the gated PMOS transistor. Using the pinch-off condition, one can show that the charging PMOS transistor will operate in saturation if 0  Vc  VT and triode if VT  Vc  VT, GDL. In both cases, the relation between Tin and Vc is nonlinear, as shown in Fig. 4(a). This is because for 0  Vc  VT, the charging current is (VDD - Vc)-dependent while for VT  Vc  VT, GDL, Vc rises with time exponentially with time constant RpC where Rp is the channel resistance of the charging PMOS transistor.

4.2 Inner-stage mismatch
Gated delay cells in both forward and reverse directions should be identical such that if  Tin = 0,  Vc = 0 will follow, as illustrated in Fig. 4(b). Should a mismatch between forward and reverse gated delay cells exists,  Vc  0 even though  Tin = 0. Similar to delay-line TDCs, per-stage delay mismatch in either forward or reverse directions gives rise to the nonlinear characteristics of the time integrator.

4.3 Inter-stage mismatch
28

The range of the time integrator is set by both per-stage delay and the number of the delay stages. Inter-stage mismatch deteriorates once the number of the delay stages is exceedingly large. In order for the time integrator to have a large range without employing a large number of delay stages, the per-stage delay can be gradually increased when moving away from the middle node of the delay line. This is particularly true for  TDCs as  Terr is zero ideally in the steady state, the per-stage delay of stages distance away from the middle node can be made large without affecting the performance of the modulator.

4.4 PVT effect
Per-stage delay of BD-GDLs is subject to the effect of PVT (process, voltage, and temperature). If one wants to have a precision value of the gain of the time integrator, BD-GDLs need to be calibrated. The per-stage delay of BD-GDL can be calibrated using a delay-locked loop approach similar to those used for calibrating delay-line TDCs.

4.5 Threshold voltage mismatch
The threshold voltage of gated delay cells, denoted by VT, GDL, and that of the quantizing DFF, denoted by VT, DFF, should be identical. If VT, GDL < VT, DFF, V1p will be set to 1 before Dout = 1. Otherwise, Dout will be set to 1 before V1p = 1. The variation of the time instant at which Dout = 1 affects when time error signal Terr = Tin ­ Tfb is generated subsequently the transient behaviour of the TDC.

4.6 Charge injection and clock feed-through
The load capacitor is isolated from gated MOS switching transistors by either a PMOS or a NMOS transistor. The effect of charge injection from the switching transistors and clock feed-through from the gating signal Tin to the load capacitor is therefore minimized. 29

Fig. 4.1 (a) Residual voltage nonlinearity. (b) Inner-stage mismatch.

30

5. Design Specifications and Simulation Results
This chapter presents the design of time-mode all-digital  modulator including all the building blocks used in the design. The all-digital first order single-bit  TDC with single-ended BD-GDL time integrator is designed in an IBM 130 nm 1.2 V CMOS technology and analysed using Spectre ASP from Cadence Design Systems with BSIM4 device models. The BD-GDL has a total 30 stages with per-stage delay 60 ps. The outputs of the 15 stages on the left of node M are initialized to 1.2 V while and those on the right of node M to 0 V. A sinusoid time signal Tin (t) of frequency 231kHz and amplitude 333 ps is fed to the TDC. Tin (t) is generated from a 231kHz sinusoidal voltage signal of amplitude 100 mV fed to a clocked differential voltage-to-time converter with external load capacitors of 50 fF and clock frequency 33.33 MHz [42]. The minimum quantization noise is per-stage delay. The addition/subtraction of feedback time Tfb, is approximately 1.2Tin ~ 1.5 Tin, to/from Tin. Fig 5.26 shows the transient response of the output of each block in  TDC. The transient response shown in Fig. 5.27 depicts the change in the digital output "Dout" of  TDC with respect to the analog input signal "Vin". Fig.5.28 shows the spectrum of the proposed  TDC obtained using FFT analysis with 2048 samples and a Hanning window. First-order noiseshaping is evident. Furthermore, the large harmonics are present in the spectrum of the all-digital first-order single-bit  TDC due to the nonlinear characteristics of the single-ended BD-GDL time integrator. The stage at which the output of the time integrator is quantized is stage 2 on right from the middle node. The  TDC offers a SNR of 34.64 dB over frequency band 48.27~231 kHz with OSR of 68 and consumes 293.8 W. In Table 5.1, the performance of recently published time-mode  TDCs is compared with this work. In Table 5.2, breakdown of the power consumption of  TDC.

31

Table 5.1 Performance Comparison of  TDCs. Ref. Tech. (nm) [4] [6] [45] [8] [43] This 130 180 130 32 130 130 VDD (V) 1.5 1.8 1.2 1.0 1.2 1.2 1 MHz 400 kHz 100 kHz 100 kHz 231 kHz 231 kHz 25 348 250 50 54 68 1 8.7(*) 11 4.4 10.8 6.0595(*) BW OSR Res. (ps) PWR (mW) 2.2-2.1 0.78 1.7 0.25 0.0046 0.2938 1st 1st 3rd 1st 1st 1st Order

*This is the effective number of bits Table 5.2 Breakdown of the power consumption of  TDC with single-ended BD-GDL time integrator. Block DTC for quantization Time integrator Tin-Block Differential VTC Other blocks Total Single-ended (W) 137.6 45.52 12.25 85.65 12.78 293.8

32

Fig. 5.1 All-Digital Delta-Sigma TDC test bench 33

Fig. 5.2 All-Digital Delta-Sigma TDC 34

Fig. 5.3 Differential VTC 35

Fig. 5.4 Voltage Controlled Delay Unit (VCDU) 36

Fig. 5.5 Digital-to-time Converter (DTC)

37

Fig. 5.6 T-Feedback

38

Fig. 5.7 Buffer1 for T-Feedback

39

Fig. 5.8 Buffer2 for T-Feedback

40

Fig. 5.9 2x1 MUX for DTC

41

Fig. 5.10 Tin-Block

42

Fig. 5.11 T-offset

43

Fig. 5.12 XOR2 Gate

44

Fig. 5.13 AND2 Gate

45

Fig. 5.14 DEMUX for RS and LS signals 46

Fig. 5.15 Edge Alignment Block 47

Fig. 5.16 NAND2 Gate 48

Fig. 5.17 Inverter 49

Fig. 5.18 OR2 Gate

50

Fig. 5.19 Buffer for T-offset

51

Fig. 5.20 30-stages Bi-Directional Gated Delay Line (BD-GDL) 52

Fig. 5.21 Closer look of BD-GDL

53

Fig. 5.22 Bi-Directional Gated Delay Cell (BD-GDC) 54

Fig. 5.23 Gated Delay Cell

55

Fig. 5.24 D-Flip Flop

56

Fig. 5.25 2x1 MUX2 for Tin-Block

57

Fig. 5.26 Transient Response of Delta Sigma TDC 58

Fig. 5.27 Transient Response [Dout and Vin] 59

Fig. 5.28 Spectrum of all-digital delta sigma TDC 60

6. Conclusion
A BD-GDL time integrator with applications in an all-digital first-order single-bit  TDC were presented. The time integrator consists of a bi-directional gated delay line with the time variable to be integrated as the gating signal. The accumulation of time variables is performed via the accumulation of the charge of the load capacitor and logic state of the gated delay stages. Issues critical to the performance of the time integrator and modulator were examined. The simulated spectrum of the TDC contains large harmonics arising from the nonlinear characteristics of the BD-GDL, signifying the need for differential BD-GDLs. A fully differential BD-GDL time integrator inspired by dual-slope ADCs is currently being developed, aiming at suppressing the detrimental effect of the nonlinearities of the BD-GDL. The proposed  TDC features all-digital realization, ultra low power consumption, and the preservation of quantization noise while possessing first-order noise-shaping. The preservation of quantization noise in the residual voltage of load capacitors is critical as it opens the door for the deployment of MASH architectures to achieve high-order noise-shaping. With a sinusoid time input of frequency 231kHz with OSR 68 and amplitude 333 ps, the  TDC exhibits first-order noise-shaping and provides a SNR of 34.64 dB over frequency band 48.27~231 kHz while consuming 293.8 W. First order noise shaping is also achieved.

61

7. Future Work
As examined earlier, the large harmonics, both even and odd-order, are present in the spectrum of the all digital first-order single-bit  TDC with single-ended BD-GDL time integrator. These harmonics arise due to the nonlinear characteristics of the single-ended BD-GDL time integrator. In order to suppress even-order harmonic tones within the signal band and further improve SNR without sacrificing the benefit of all-digital implementation, it is appealing to design a differential bi-directional time integrator and replace it with single-ended BD-GDL time integrator. Furthermore, the output of the single-ended BD-GDL is a thermometer code 1...10...0 with the left most "0" specifying the node at which propagating "1" vanishes. The BD-GDL is therefore not only a time integrator but also a multi-bit quantizer. Therefore, using that as a motivation, an architecture for all-digital first order multi-bit  TDC with single-ended BDL time integrator can be developed which help us to reduce the noise floor.

62

Appendix A
The MATLAB code required to plot the FFT spectrum and calculate important parameter of  TDC is attached as following: %****************************************************% % Project: All-Digital Delta Sigma TDC using % % Bi-Directional Gated Delay Line Time Integrator % % % % %

% Author: Parth Parekh % Date: August 15, 2017

%*****************************************************% clear all; close all; clc; data = csvread('Dout.csv',1,0); %Loading the raw data saved from the cadence Time = data (:, 1); Wave = data (:, 2); Wave = Wave-mean(Wave); % remove DC offset order = 1; nLev = 2; % since I'm using 1 bit slice Nfft = 2^11; % Total number of samples fs = 33.33E6; % sampling frequency bin = 15; % Number of FFT bins fin = ((bin)/Nfft) *fs % fin should be linked to fs. OSR = round(fs/(2*fin)) t = [0: Nfft-1]; 63

n =1:2048; spec2 = fft (Wave (1: end-0). *hann (length (Wave (1: end-0))))/(Nfft*(nLev-1)/4); %spec2 should have 2048 values. Therefore, if the recorded data is longer than 2048, user should be specifying the range which has 2048 samples. fftout2 = abs(spec2); fftout2dbv = 20*log10(fftout2); Sig_Power2 = fftout2(bin+1); s2 = norm (fftout2(bin: bin+2)); % Since Hanning window is used, the effective bin number should be bin +/- 1. Harm_Power2 = sum (fftout2(1: bin-1)); n2 = norm (fftout2(1: bin-1)); SNR2 = 20*log10(s2/n2) % Signal-to-Noise Ratio ENOB = (SNR2-1.76)/6.02 % Effective number of bits f = 0:(fin/fs)/Nfft:(fin/fs)/2; % Normalized frequency f/fs) plot (f (1: Nfft/2+1), fftout2dbv (1: Nfft/2+1), 'r') % Plotting the FFT grid on;

64

References
[1] G. Li, Y. Tousi, A. Hassibi, and E. Afshari, "Delay-line-based analog-to-digital converters," IEEE Trans. Circuits Syst. II, vol. 56, no. 6, pp. 464­468, June 2009. [2] A. Iwata, N. Sakimura, M. Nagata, and T. Morie, "The architecture of delta sigma analog-todigital converters using a voltage-controlled oscillator as a multi-bit quantizer," IEEE Trans. Circuits Syst. II., vol. 46, no. 7, pp. 941­945, Jul. 1999. [3] M. Hovin, A. Olsen, T. Lande, and C. Toumazou, "Delta-sigma modulators using frequencymodulated intermediate values," IEEE J. Solid-State Circuits, vol. 32, no. 1, pp. 13­22, Jan. 1997. [4] M. Straayer and M. Perrott, "A 12-bit, 10-MHz bandwidth, continuous-time ADC with a 5bit, 950-MS/s VCO-based quantizer," IEEE J. Solid-State Circuits, vol. 43, no. 4, pp. 805­814, Apr. 2008. [5] T. Konishi, K. Okumo, S. Izumi, M. Yoshimoto, and H. Kawaguchi, "A 61 dB SNDR 700 m second-order all-digital TDC with low-jitter frequency shift oscillator and dynamic flipflops," in Symp. VLSI Circuits Dig. Tech. Papers, 2012, pp. 190­191. [6] C. Taillefer and G. Roberts, "Delta-sigma A/D converter via time-mode signal processing," IEEE Trans. Circuits Syst. I, vol. 56, no. 9, pp. 1908­ 1920, Sept. 2009. [7] M.Ali-Bakhshian and G. Roberts, "A digital implementation of a dual-path time-to-time integrator," IEEE Trans. Circuits Syst. I, vol. 59, no. 11, pp. 2578­2591, Nov. 2012. [8] J. Hong, S. Kim, J. Liu, N. Xing, T. Jang, J. Park, J. Kim, T. Kim, and H. Park, "A 0.004 mm2 250 W TDC with time-difference accumulator and a 0.012 mm2 2.5 mW bang-bang digital PLL using PRNG for low-power SoC applications," in IEEE Int'l Conf. Solid-State Circuits Dig. Tech. Papers, 2012, pp. 240­242. [9] S. Kim, Time domain algebraic operation circuits for high performance mixed-mode system. MS Thesis, Korean Advanced Institute of Science and Technology, 2010. [10] K. Kim, Y. Kim, W. Yu, and S. Cho, "A 7b 3.75 ps resolution twostep time-to-digital converter in 65 nm CMOS using pulse-train time amplifier," IEEE J. Solid-State Circuits, vol. 48, no. 4, pp. 1009­1017, April 2013. [11] K. Kim, W. Yu, and S. Cho, "A 9 bit, 1.12 ps resolution 2.5 b/stage pipelined time-to-digital converter in 65nm CMOS using time-register," IEEE J. Solid-State Circuits, vol. 49, no. 4, pp. 1007­1016, April 2014. [12] B. Yousefzadeh and M. Sharifkhani, "An audio band low voltage CT- modulator with VCO-based quantizer," in Proc. IEEE Int'l Conf. Electronics, Circuits Syst., 2011, pp. 232-235. [13] B. Swann, B. Blalock, L. Clonts, D. Binkley, J. Rochelle, E. Breading, and K. Bald- win, "A 100-ps time-resolution CMOS time-to-digital converter for positron emission tomography imaging applications," IEEE J. Solid-State Circuits, vol. 39, no. 11, pp. 1839-1852, Nov. 2004. 65

[14] E. Raisanen-Ruotsalainen, T. Rahkonen, and J. Lostamovaara, "An integrated time-to-digital converter with 30-ps single-shot precision," IEEE J. Solid-State Circuits, vol. 35, no. 10, pp. 15071510, Oct. 2000. [15] M. Guttman and G. Roberts, "Sampled-data IIR filtering using time-mode signal processing circuits," in Proc. IEEE Int'l Symp. Circuits Syst., 2009, pp. 2285-2288. [16] V. Ravinuthula, Time-Mode circuits for analog computations. PhD Dissertation, University of Florida, 2006. [17] S. Aouini, K. Chuai, and G. Roberts, "Anti-imaging time-mode filter design using a PLL structure with transfer function DFT," IEEE Trans. Circuits Syst. I, vol. 59, no. 1, pp. 66 -79, Jan. 2012. [18] T. Tokairin, M. Okada, M. Kitsunezuka, T. Maeda, and M. Fukaishi, "A 2.1-to-2.8-GHz lowphase-noise all-digital frequency synthesizer with a time-windowed time-to-digital converter," IEEE J. Solid-State Circuits, vol. 45, no. 12, pp. 2582-2590, Dec. 2010. [19] C. Hsu, M. Straayer, and M. Perrott, "A low-noise wide-BW 3.6-GHz digital  fractionalN frequency synthesizer with a noise-shaping time-to-digital converter and quantization noise cancellation," IEEE J. Solid-State Circuits, vol. 43, no. 12, pp. 2776-2786, Dec. 2008. [20] T. Yoshiaki and A. Takeshi, "Simple voltage-to-time converter with high linearity," IEEE Trans. Instrumentation and Measurement, vol. 20, no. 2, pp. 120-122, May 1971. [21] K. Park and J. Park, "20 ps resolution time-to-digital converter for digital storage oscillator," in Proc. IEEE Nuclear Science Symp., vol. 2, 1998, pp. 876-881. [22] P. Chen, C. Chen, and Y. Shen, "A low-cost low-power CMOS time-to-digital converter based on pulse stretching," IEEE Trans. Nuclear Science, vol. 53, no. 4, pp. 2215-2220, Aug. 2006. [23] C. Chen, P. Chen, C. Hwang, and W. Chang, "A precise cyclic CMOS time-to-digital converter with low thermal sensitivity," IEEE Trans. Nuclear Science, vol. 52, no. 4, pp. 834-838, Aug. 2005. [24] P. Chen, C. Chen, C. Tsai, and W. Lu, \A time-to-digital-converter-based CMOS smart temperature sensor," IEEE J. Solid-State Circuits, vol. 40, no. 8, pp. 1642-1648, Aug. 2005. [25] D. Porat, "Review of sub-nanosecond time-interval measurements," IEEE Trans. Nu-clear Science, vol. NS-20, pp. 36-51, Sept. 1973. [26] R.Staszewski, S. Vemulapalli, P. Vallur, J. Wallberg, and P. Balsara, "13 V 20 ps timeto-digital converter for frequency synthesis in 90 nm CMOS," IEEE Trans. Circuits Syst. II., vol. 53, no. 3, pp. 220-224, Mar. 2006. [27] S. Henzler, S. Koeppe, W. Kamp, and D. Schmitt-Landsiedel, "90 nm 4.7 ps-resolution 0.7LSB single-shot precision and 19 pJ-per-shot local passive interpolation time-to-digital converter with on-chip characterization," in IEEE Int'l Solid-State Circuits Conf. Dig. Tech. Papers, 2008, pp. 548-635. 66

[28] N. Xing, J. Woo, W. Shin, H. Lee, and S. Kim, "A 14.6 ps resolution, 50 ns input-range cyclic time-to-digital converter using fractional difference conversion method," IEEE Trans. on Circuits Systems I, vol. 57, no. 12, pp. 3064-3072, December 2010. [29] C. Ljuslin, J. Christiansen, A. Marchioro, and O. Klingsheim, "An integrated 16-channel CMOS time to digital converter," IEEE Trans. Nuclear Science, vol. 41, no. 4, pp. 1104-1108, August 1994. [30] P. Dudek, S. Szczepanski, and J. Haeld, "A high-resolution CMOS time-to-digital converter utilizing a Vernier delay line," IEEE J. Solid-State Circuits, vol. 35, no. 2, pp. 240-247, Feb. 2000. [31] G.Li and H. Chou, "A high resolution time-to-digital converter using two-level Vernier delay line technique," in Proc. IEEE Nuclear Science Symp. Conf. Record, 2007, pp. 276-280. [32] A. Abas, A. Bystrov, D. Kinnimnt, O. Maevsky, G. Russell, and A. Yakovlev, "Time difference amplifier," IEE Electronics Letters, vol. 38, no. 23, pp. 1437-1438, November 2002. [33] R.Rashidzadeh, R. Muscedere, M. Ahmadi, and W. Miller, "A delay generation technique for narrow time interval measurement," IEEE Trans. Instrumentation and Measurement, vol. 58, no. 7, pp. 2245-2252, July 2009. [34] M. Oulmane and G. Roberts, "CMOS time amplifier for femto-second resolution timing measurement," in Proc. IEEE Int'l Symp. Circuits Syst., 2004, pp. 509-512. [35] B. Tong, W. Yan, and X. Zhou, "A constant-gain time-amplifier with digital self-calibration," in Proc. IEEE Int'l ASIC Conf., 2009, pp. 1133-1136. [36] A. Alahmadi, C. Russell, and A. Yakovlev, "Time difference amplifier design with improved performance parameters," IET Electronics Letters, vol. 48, no. 10, pp. 562-563, May 2012. [37] C. Lin and M. Syrzycki, "Pico-second time interval amplification," in Proc. IEEE Int'l SoC Design Conf., 2010, pp. 201-204. [38] B. Dehlaghi, S. Magierowski, and L. Belostotski, "Highly-linear time-difference amplifier with low sensitivity to process variations," IET Electronics Letters, vol. 47, no. 13, pp. 743-745, June 2011. [39] H. Kwon, J. Lee, J. Sim, and H. Park, "A high-gain wide-input-range time amplifier with an open-loop architecture and a gain equal to current bias ratio," in Proc. IEEE Asian Solid-State Circuits Conf., 2011, pp. 325-328. [40] K. Kim, Y. Kim, W. Yu, and S. Cho, "A 7b, 3.75 ps resolution two-step time-to-digital converter in 65nm CMOS using pulse-train time amplifier," in Symp. VLSI Circuits Dig. Tech. Papers, 2012, pp. 192-193. [41] M.Lee and A. Abidi, "A 9B, 1.25 ps resolution coarse-fine time-to-digital converter in 90 nm CMOS that amplifies a time residue," IEEE J. Solid-State Circuits, vol. 43, no. 4, pp. 769-777, April 2008. [42] F. Yuan, CMOS Time-Mode Circuits and Systems: Fundamentals and Applications. New York: CRC Press, 2015. 67

[43] Y.Park and F.Yaun, "Low-power all digital delta-sigma tdc wwith bi-directional gated delay line time integrator," in IEEE Mid-west Symp. Circuits and Systems, Accepted. 2017.ent document. [44] S. Chung, K. Hwang, W. Lee, and L. Kim, "A high resolution metastability-independent twostep gated ring oscillator TDC with enhanced noise shaping," in Proc. IEEE Int'l Symp. Circuits Syst., 2010, pp. 1300­1303. [45] Y. Cao, P. Leroux, W. D. Cock, and M. Steyaert, "A 1.7 mW 11b 1-1-1 MASH  time-todigital converter," in IEEE Int'l Solid-State Circuits Conf. Dig. Tech. Papers, 2011, pp. 480­481.

68


