Ryerson University

Digital Commons @ Ryerson
Theses and dissertations

1-1-2003

Post-mission misalignment angle calibration for airborne laser scanners
Wendy Anne Dillane
Ryerson University

Follow this and additional works at: http://digitalcommons.ryerson.ca/dissertations Part of the Civil and Environmental Engineering Commons Recommended Citation
Dillane, Wendy Anne, "Post-mission misalignment angle calibration for airborne laser scanners" (2003). Theses and dissertations. Paper 139.

This Thesis is brought to you for free and open access by Digital Commons @ Ryerson. It has been accepted for inclusion in Theses and dissertations by an authorized administrator of Digital Commons @ Ryerson. For more information, please contact bcameron@ryerson.ca.

NOTE TO USERS

This reproduction is the best copy available.

®

UMI
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

POST-MISSION MISALIGNMENT ANGLE CALIBRATION FOR AIRBORNE LASER SCANNERS

by
Wendy Anne Dillane, B. Eng Ryerson Polytechnic University, 2001

A thesis presented to Ryerson University

in ,partial fulfillment of the requirement for the degree of Masters of Applied Science in the Program of Civil Engineering

Toronto, Ontario, Canada, 2003 © Wendy Anne Dillane 2003

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

UMI Number: EC52881

INFORMATION TO USERS

The quality of this reproduction is dependent upon the quality of the copy submitted. Broken or indistinct print, colored or poor quality illustrations and photographs, print bleed-through, substandard margins, and improper alignment can adversely affect reproduction. In the unlikely event that the author did not send a complete manuscript and there are missing pages, these will be noted. Also, if unauthorized copyright material had to be removed, a note will indicate the deletion.

®

UMI
UMI Microform EC52881 Copyright 2008 by ProQuest LLC. All rights reserved. This microform edition is protected against unauthorized copying under Title 17, United States Code. ProQuest LLC 789 E. Eisenhower Parkway PO Box 1346 Ann Arbor, MI 48106-1346

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Ryerson University requires the signatures of all persons using or photocopying this thesis. Please sign below, and give address and date.

iii

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Abstract
An Airborne Laser Scanning (ALS) system operates by locating returned laser pulses

independently from all others. Locating the returned laser pulses requires knowing precisely for each laser pulse, the aircraft position (e.g. GPS), the attitude of the aircraft (e.g. lMU), the scanner angle when the laser pulse left the sensor, and the slant range to the terrain surface for that pulse. One of the most critical errors in ALS systems is the angular misalignment between the scanner and the IMU, which is called the misalignment or boresight error. This error must be addressed before an ALS system can accurately produce data. The purpose of this thesis was to develop and test a method of estimating the small misalignment angles between the laser scanner and the com bined GPSIIMU solution for position and attitude. This method is semi-automated, requires no ground control and does not re-sample the ALS data in order to match the overlapping strips of data. A computer program called Misalignment Estimator was developed to estimate the misalignment angles using a least squares adjustment. The method was tested using a data set located at the Oshawa airport and provided by Optech. The misalignment angles were estimated to be -0.0178 degrees, -0.0829 degrees and 0.0320 degrees, for roll, pitch and heading respectively. The estimation of the misalignment angles was considered to be successful. Further research into autom ated point matching is recommended.

iv

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Acknowledgment
I would like to express much gratitude towards my advisor, Dr. M. Chapman, P. Eng., OLS. His patience and guidance were extremely beneficial throughout my research. Also, I want to thank Jim Green and Patrick Spencer from Optech, Toronto, for their time and efforts in acquiring data for my project. In addition, I would like to thank Michael Leslar and many other graduate students who kept me on my toes throughout the classes and thesis work. Lastly, I would like to thank Dad, Mom, James and Rob for their undying love and support. Your faith in me is the root of my faith in myself. Thank-you.

v

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Table of Contents Title page ............................................................................................................................. i Author's declaration ............................................................................................................ ii Borrower's Page ................................................................................................................. iii Abstract .............................................................................................................................. iv Acknowledgment ................................................................................................................ v Table of Contents ............................................................................................................... vi List of Tables ................................................................................................................... viii List of Figures .................................................................................................................... ix 1.0 1.1 1.2 2.0 2.1 INTRODUCTION .................................................................................................. 1 Purpose .............................................................................................................. 1 Thesis Outline ................................................................................................... 2 AIRBORNE LASER SCANNERS ......................................................................... 4 Fundamentals of Airborne Laser Scanners ....................................................... 4 2.1.1 Basic Airborne Laser Scanner Relations and Formulas ......................... 7 2.2 Components of an Airborne Laser Scanning System ....................................... 8 2.2.1 Laser Scanner .......................................................................................... 9 2.2.1.1 Laser Ranging Unit ............................................................................ 9 2.2.1.2 Control and Processing Unit ............................................................ 13 2.2.2 Global Positioning System .................................................................... 14 2.2.3 Inertial Measurement Unit .................·.................................................. 17 2.2.4 IMU and GPS Data Integration ............................................................. 19 2.3 System Errors .................................................................................................. 21 2.3.1 Atmospheric Errors ............................................................................... 21 2.3.2 Scanner Errors ....................................................................................... 23 2.3.3 Position and Attitude Accuracy ............................................................ 30 2.3.4 GPS Errors ............................................................................................ 31 2.3.4.1 Cycle Slip Correction ....................................................................... 32 2.3.5 Misalignment Error ............................................................................... 33 2.4 Airborne Laser Scanner Data Applications .................................................... 35 2.4.1 .Filtering methods for DEM Generation ................................................ 36 2.4.1.1 Linear Prediction for Filtering ......................................................... 37 2.4.1.2 Filtering Using Adaptive TIN models ............................................. 39 2.4.2 Laser Scanning Applications for Forestry ............................................ 41 2.4.3 Laser Scanning Mapping of Coastal Zones .......................................... 45 THE MISALIGNMENT CALIBRATION PROBLEM ....................................... 48 3.1 3.2 Pre-Flight Calibration ..................................................................................... 48 Methods of Misalignment Calibration ............................................................ 50 3.2.1 Manual Misalignment Calibration ........................................................ 50 3.2.2 Semi-automated Misalignment Calibration .......................................... 51 3.3 Semi-automated Misalignment Estimation Methodology .............................. 52 3.3.1 The Misalignment Estimator Program .................................................. 56 vi

3.0

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

3.4 4.0 4.1 4.2

Simulations ..................................................................................................... 58 3.4.1 Pseudo Data Set .................................................................................... 58 EXPERIMENTATION AND RESULTS ............................................................. 62

Oshawa Airport Data Set ................................................................................ 62 Data Fusion ..................................................................................................... 65 4.2.1 Data Interpolation ................................................................................. 65 4.2.2 Angle Conversion ................................................................................. 68 4.2.2.1 Coordinate Systems and Angles Used in Inertial Navigation .......... 68 4.2.2.2 Coordinate Systems and Angles Used in Photogrammetry ............. 71 4.2.2.3 Conversion from Attitude and Heading Angles to Photogrammetric Angles ................................................................. 73 4.2.3 Data Matching ........................................................................................ 74 4.3 Experimentation .............................................................................................. 79 4.3.1 Estimation and Accuracy of Misalignment Angles .............................. 86 4.4 4.5 4.6 Summary ......................................................................................................... 91 Conclusions ..................................................................................................... 92 Recommendations ........................................................................................... 93

SUMMARY, CONCLUSIONS AND RECOMMENDATIONS ..................................... 91

References Appendix A Misalignment Estimator Source Code Appendix B Sample Input File

Vll

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

List of Tables

2.1 2.2 3.1 4.1 4.2 4.3 4.4 4.5 4.6 4.7

Common Errors in GPS (EI-Rabbany, 2000) ............................................................ 31 Applications of ALS Data .......................................................................................... 35 Outputs and Results for Pseudo Data Set .................................................................. 60 ATLM 3025 Specifications (Copyright 2002, Optech Incorporated) ........................ 64 Outputs and Results for Point Grouping 1 ................................................................. 80 Outputs and Results for Point Grouping 2 ................................................................. 82 Outputs and Results for Point Grouping 3 ................................................................. 84 Outputs and Results for Point Grouping 4 ................................................................. 85 Estimated Standard Deviations and Residuals for In-lab Calibration Angles ........... 90 Estimated Misalignment Error ................................................................................... 90

viii

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

List of Figures
2.1 Four Typical Scanning Mechanisms .......................................................................... 10 2.2 Scan Patterns for Typical Scanning Mechanisms ...................................................... 11 2.3 Relative Positioning Used with Aerial Remote Sensing ............................................ 15 2.4 The Onboard Inertial Measurement Unit.. ................................................................. 18 2.5 GPSIIMU Integration Scheme (Sun, 1994) .............................................................. 21 2.6 Atmospheric Refraction ............................................................................................. 23 2.7 Scan Angle Encoder ................................................................................................... 24 2.8 "Bow Tie", the Visible Effects of Encoder Latency on Derived Ground Points ....... 25 2.9 Scan Mirror Components ........................................................................................... 27 2.10 Velocity and Acceleration oft~e Scan Mirror ......................................................... 27 2.11 Sensor "Smile" or Strip Bowing of Scanner Torsion Error ..................................... 29 2.12 Satellite Geometry Above the Horizon .................................................................... 32 2.13 Misalignment Errors ................................................................................................ 34 2.14 The Adaptive TIN Model (Axelsson, 2000) ............................................................ 41 2.15 Differences between discrete return and full waveform Lidar data ......................... 43 2.16 Laser Scanning Bathymetry Principle ..................................................................... 46 3.1 Flowchart of Misalignment Estimation Adjustment Process ..................................... 56 3.2 The Digital Photographs used to create the Pseudo Data seL ................................... 59 3.3 Layout of Pseudo Laser Scanner Points ..................................................................... 59 4.1 Layout of Laser Scanner Strips of Oshaw a Airport ................................................... 63 4.2 Example of POS Data Interval and Cubic Spline ...................................................... 67 4.3 The Fixed Body Coordinate System used in Navigation ........................................... 69 4.4 The Navigation Coordinate System and Euler Angles (\II,~, 9) ................................ 70 4.5 Image Coordinate System .......................................................................................... 71 4.6 Earth Centered Coordinate System and Rotation Angles (0), ~, K) ........................... 72 4.7 Matching Intensity Images ......................................................................................... 75 4.8 Aerial Photography of the Oshawa Airport ............................................................... 76 4.9 Layout of Matched Points .......................................................................................... 77 4.1 0 Flowchart for Matching the ALS Points and Fusing the Data Sets Process ............ 78 4.11 Adjustment Affect on Z Residuals ........................................................................... 81 4.12 Layout of Point Grouping 2 ................ :.................................................................... 82 4.13 Layout of Point Grouping 3 ..................................................................................... 83 4.14 Layout of Point Grouping 4 ..................................................................................... 85 4.15 Point Grouping 1 and X - Y Residuals ofthe First Iteration ................................... 87 4.16 Point Grouping 1 and X - Y Residuals of the Sixth Iteration .................................. 88 4.17 Point Grouping 1 and Z Residuals of the First Iteration .......................................... 88 4.18 Point Grouping 1 and Z Residuals of the Sixth Iteration ......................................... 89

IX

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

1.0

Introduction

Since the late 1970's, Airborne Laser Scanners (ALS) have been used for accurate detennination ofterrain elevations. These early systems were complex and could obtain accurate elevation data. However, without the technology to detennine the position and orientation of the sensor, ALS was not a cost-effective method for terrain elevation data acquisition over large areas.

Over the last few years, ALS technology has been improved with the developments of Global Positioning System (GPS) and airborne Inertial Measurement Units (IMU). ALS has now become a cost-effective and efficient method for terrain data acquisition. An alignment calibration process for the GPS position of the sensor and the orientation parameters between the IMU and the laser scanner is required to assure reliable accurate data sets from the ALS system.

1.1

Purpose

The objective of this project was to develop a method of estimating the small misalignment angles between the laser scanner and the Inertial Measurement Unit (lMU) using overlapping data strips. This method can be used to calibrate an ALS system after it has been installed in an aircraft. The concept of calibrating the alignm ent angles is to model and estimate the small misalignment angles between the sensors and adjust the data to compensate for the misalignment.

1

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Optech Ltd., develops, manufactures and sells advanced ALS systems. It has an accurate method of calibrating the misalignment angles between the laser scanner and IMU in the lab prior to the installation of the system in an aircraft, but does not offer a standard method of post-mission calibration. There are established methods of misalignment estimation used by the industry; most are manual trial and error approaches that are known to be tedious and time consuming. Other methods involve semi-automated estimation, but these require
grou~d

control and/or re-sampling of the ALS data. Overall,

the purpose of this thesis is to develop and test a method of estimating the small misalignment angles between the laser scanner and the IMU. The method is semiautomated, requires no ground control and does not re-sample the ALS data in order to match the overlapping strips. As such, Optech could offer their custom ers a postinstallation calibration possibility.

1.2

Thesis Outline

In Chapter 2, the major concepts of Airborne Laser Scanning are discussed. The components of an ALS system, the laser scanner, the GPS and IMU, are described. Additionally, ALS system errors and data applications are reviewed.

In Chapter 3, the misalignment calibration problem is described. The underlying theory and mathematical models are discussed. Also, the method of estimating the misalignment angles is presented.

2

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

In Chapter 4, test data and the treatment and fusion ofthe ALS system data is presented. The experimentation with the proposed method is described. In addition, the resulting estimated misalignment angles and their accuracy are discussed.

In Chapter 5, the thesis is summarized and conclusions are drawn from the research work. Also, recommendations are made concerning potential future research.

/

3

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

2.0

Airborne Laser Scanners

Airborne Laser Scanning (ALS) systems are used to measure, by some means, the distance between the sensor and the illuminated spot on the ground. Laser scanning involves the act of deflecting a ranging beam off an object surface, in a certain pattern, so that the object surface is sampled with a high point density (Wehr and Lohr, 1999). Lasers are used as the ranging beam because high-energy pulses can be realized in short intervals and their comparatively short wavelengths can be highly collimated using small apertures. When lasers with high pulse repetition rates were available, laser-scanning systems could then obtain a range image, which is known as laser radar. There are two commonly used acronyms used to identify laser radar: LIDAR (Ught Detection d,nd Ranging) and LADAR (LAser Detection d,nd Ranging) (Wehr and Lohr, 1999).

2.1

Fundamentals of Airborne Laser Scanners

Laser scanners utilize opto-mechanical scanning assemblies and are active sensing systems using a laser beam as the sensing carrier. There are two optical beams that must be considered when designing an ALS; the emitted laser beam and the received portion of that beam (WeIt and Lohr, 1999). The laser scanner only measures the line of site vector from the laser scanner aperture to a point on the earth surface.

There are two major ranging principles for laser range measurement. In order to obtain a range measurement from a laser, the transmission must be modulated (Wehr and Lohr, 1999). Currently there are two methods of modulating a laser beam. The first one is

4

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

pulsed ranging which is most popular and direct. Units that employ this method are referred to as Pulse Lasers. With pulse modulation the transmitter generates a rectangular pulse with widths of IOns to 15 ns (Wehr and Lohr, 1999). Measurement is determined by the time-of-flight ofa light pulse. This is achieved by measuring the traveling time (tL) between the emitted and received pulse.
1L;;:: 2R / c

(Eq. 2.1)

where R is the distance between.the ranging unit and the object surface c is the speed of light The second type of method of modulating a laser beam is the phase difference method, which must use a laser that continuously emits light at a set frequency. These units are called Continuous Wave (CW) lasers. For this method the phase difference between the transmitted and the received signal backscattered from the object surface is measured (Wehr and Lohr, 1999).

(Eq.2.2)
where

q, is the phase difference between the transmitted and received signal
T is the period of the signal n is the number of full wavelengths included in the distance from the laser
\
'

transceIver to receIver. Theoretically, the pulse system is able to achieve an 85 times higher accuracy than the CW system, but achieving higher accuracy requires very high technical efforts and sophisticated processing methods (Wehr and Lohr, 1999). On the other hand, by using CW systems, sub-centimeter level accuracy can be easily achieved by using a higher frequency (Wehr and Lohr, 1999). In current ranging laser systems, mostly solid-state

J

.

.

5

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

pulsed lasers are used. This is related to the commercial availability of pulse lasers, rather than based upon any technical advantages.

The scanning process has a few key param eters; the laser footprint, the swath width and the laser point density. The laser footprint (Ad mainly depends on the divergence of the laser beam (y) (Wehr and Lohr, 1999). ALinstantaneously = (h / cos (~inst))
2

*Y

(Eq.2.3)

where

~inst

is the instantaneous scan angle

h is the flying height At a flying height of 500 metres, a typical laser footprint on the ground would be 30 em in diameter. The swath width (SW) mainly depends on the scan angle ( ~). SW = 2 h tan ( ~ / 2)

(Eq. 2.4)

The laser point density is of particular interest for survey tasks. Point spacing across flight direction mainly depends on either the pulse repetition frequency for a pulse laser, or on the measurement ratti for a CW laser (Wehr and Lohr, 1999). Along the flight direction, the point spacing is determined by the ground speed of the aircraft and the period of one line scan.

The scan pattdn on the ground not only depends on the laser scan pattern, but also the flying direction, speed, and the terrain topography (Wehr and Lohr, 1999). The points along a line are usually scanned in equal angle steps, but their spacing on the ground is not constant.

6

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

2.1.1

Basic Airborne Laser Scanner Relations and Formulas
(~R)

Range (R) and Range Resolution R= c(t/2);
~R

ofa Pulse laser:

= c(~t/2)

(Eq.2.5)

Time (t) is measured by a time interval counter relative to a specific point on the pulse, like on the leading edge, where the signal voltage has reached a predeterm ined threshold value (Baltsavias, 1999). A possible error occurs if the voltage magnitudes of the transmitted and received pulses are adjusted to the same value before they are sent to the time interval counter. An example of this occurs, if the received pulse amplitude is too low then the measured time will be too long and if the received pulse amplitude is too high then the measured time will be too short (Baltsavias, 1999). As long as the range resolution is significantly small so that the highest range accuracy can be achieved and small enough to permit accuracy investigations through repeated measurements, then it is not considered as important (Baltsavias, 1999).

Maximum unambiguous range depends on various factors, including the maximum range of the time interval counter and the pulse rate. To avoid confusion in the pulses arriving at the time interval counter, usually no pulse is transmitted until the echo of the pervious pulse has been received (Baltsavias, 1999). This does not limit the maximum achievable range. Maximum range is potentially limited by laser power, beam divergence, target reflectivity, detector sensitivity and atmospheric transmission. Best range performance is achieved when the atmosphere is cool, dry and clear and at night (Baltsavias, 1999).

7

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Accuracy of range is dependent on the ability to select the same relative position on the transmitted and received pulse in order to measure the time interval and is limited by noise, signal strength, sensor sensitivity and reproducibility of the transmitter pulse (Baltsavias, 1999). It is also important that the accuracy by which fixed time delays in the system are known and the accuracy of the time interval counter is known. Detectors should have a large response at the wavelength to be detected. Also, very little noise should be added to the system by the detector, and should have a sufficient speed of response (Baltsavias, 1999).

2.2

Components of an Airborne Laser Scanning System

There are three major components of an Airborne Laser Scanning System. These components are the laser scanner, the Global Positioning System (GPS) and the Inertial Measurement Unit (IMU). The latter two combine to make the Positioning and Orientation System (POS), which is an essential component of an ALS system. Since the laser scanner only measures the line-of sight vector from the laser scanner aperture to a point on the earth surface and records this distance and the respective scanning angles, the 3-D position of these, points can only be computed if the position and orientation of the laser system is known with respect to a coordinate system. This means that a Position and Orientation System, (POS), consisting of a differential GPS (DGPS) and IMU, must support the laser system. Geocoding of the laser scanner measurements requires an accurate synchronization of the IMU, GPS and the laser scanner data. During postprocessing, the synchronization on the basis of one second time intervals enables the determination and correction of possible time errors between the highly stable GPS time and the local time of the laser's computer (Wehr and Lohr, 1999).

8

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

In order to deliver the accurate 3-D position of the laser points, three data sets are needed: the pas data; the laser distance measurements and their respective scan angles; and finally the calibrated data and mounting parameters between the pas and ALS. The calibrated data and mounting parameters include the three mounting angles of the laser scanner frame, omega, phi, kappa (0),
~,

K), with respect to the platform-fixed coordinate

system, usually with the origin at the IMU; the position of the laser scanner with respect to the IMU; and finally, the IMU's.position and orientation with respect to the GPS antenna center (Wehr and Lohr, 1999).

2.2.1

Laser Scanner

Laser scanners have three key elements: the laser ranging unit, the opto-mechanical scanner and the control and processing unit.

2.2.1.1 Laser Ranging Unit
The laser ranging unit is comprised of the emitting laser and the electro-optical receiver. A laser uses coherent light for measurements. Laser stands for Light Amplification by ,S.timulated Emission of Radiation and uses a highly directional optical light beam and is highly consistent in space and time. The level of consistence is very dependent on the type of laser. Gas and solid-state lasers offer higher consistency than sem iconductor lasers (Wehr and Lohr, 1999). The typical size of the transmitting and receiving apertures are 8 to 15 cm. These apertures are mounted so that the transmitting and receiving paths share the same optical path to ensure that objects' surface points illuminated by the laser are always in the field of view (FaV) of the optical receiver. The

9

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

narrow divergence of the laser beam defines the instantaneous field of view (lFOV), which typically ranges from 0.3 to 2 mrad (Wehr and Lohr, 1999). The IFOV is a function of the transmitting aperture D and the wavelength of the laser light A. Due to the very narrow IFOV of the laser, the optical beam has to be directed across the flight direction in order to obtain area coverage (Wehr and Lohr, 1999).

The opto-mechanical scanner is the mechanism that directs the emitted laser towards the ground. There are four typical scanning mechanisms: Oscillating mirror, Palmer scanner, Fiber scanner and rotating polygon. These mechanisms are shown in Figure 2.1. Figure 2.2 shows the scan patterns produced by each scanning mechanisms.

.-----1-I
I

I

-

t

Oscillating Mirror

Palmer Scanner

~
Fiber Scanner

:~~;;:
~-

........ -.

~::::::::::

..............-....

.

Rotating Polygon

Figure 2.1 Four Typical Scanning Mechanisms

10

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

direction offligbl

direction of flight

UscllaUng MUlor scan patten 'idirectional scan direction of /light

Palmer Scanner scanpatte:n nutating mirrors

direction of flight

JL

-

Fiber Scanner scan pattem parallel line scan

Rohling Polygon lean pattEm upidirectional scan

Figure 2.2 Scan Patterns for Typical Scanning Mechanisms The Oscillating Mirror scanning mechanism incorporat~s a mirror that is rotated back and forth. This mechanism produces a zigzag-line (bi-directional scan) and companies such as Optech, Lieca Geosystems and TopEye have adopted this type of scanning mechanism (Morin,2002). An advantage of this type ofmechanism is that the mirror is always pointed at the ground, allowing continuous data collection. Also, the scan rate and the mirror's field of view can generally be controlled by the user. Another advantage is that oscillating mirrors can be integrated with the real-time output of the IMU, allowing the scanner to compensate for roll-type errors, which cause the edges of scans to be wavy
(Morin, 2002). Disadvantages are numerous, including the changing velocity and

acceleration of the mirror, which causes torsion between the mirror and the angular encoder. Corrections for such errors are required (Morin, 2002). The changing velocity causes the scan points to be unequally spaced on the ground and the point density is
11

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

greater at the edges of scan lines as the mirror slows down, than at the nadir (Morin, 2002).

The second type of scanning mechanism is Palmer Scanner (nutating mirror). This scanning mechanism produces an elliptical scan pattern. The optical beam of the laser ranging unit hits the deflecting mirror, whose rotating axis is mounted so that the scanner shaft and the laser beam form an angle of 45 degrees (Wehr and Lohr, 1999). Also, the mirror is inclined by 7 degrees. This angle causes a nutation of the mirror when the scanner shaft is turning. Due to the elliptical scan, most of the measured points on the ground are scanned twice, once in the forward view; and once in the backward view (Wehr and Lohr, 1999). The redundant information is useful to calibrate the scanner and the POS in terms of the pitch angle is concerned.

A Fiber Scanner scanning mechanism produces parallel-line scans. The transmitting and receiving optics are identical, which is advantageous. An identical fiber line array is mounted in the focal plane of the receiving and transmitting lens. By means oftwo rotating mirrors, each fiber in the transmitting and receiving path is scanned sequentially and synchronously (Wehr and Lohr, 1999). These mirrors relay the light either from the central fiber to one of the fiber within the fiber array or vice-versa. The array transm its the pulse at a fixed angle onto the ground. The advantages of fiber scanners are, due to the small aperture of the fibers, only small moving mechanical parts are required; and high scanning speeds can be achieved, up to 630 Hz. This allows high pulse rates resulting in overlapping footprints (Wehr and Lohr, 1999). The disadvantage is that

12

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

current technology only allows for a field of view that is sm aller than a rotating mirror, therefore, covering less ground in a scan line (Morin, 2002).

The final type of scanning mechanism is a Rotating Polygon or constant velocity-rotating mirrors. This scanning mechanism produce parallel line (unidirectional) scans. The mirror is rotated in one direction by a motor and the angle measured either directly from the motor or from an angular encoder directly mounted to the mirror (Morin, 2002). The advantage ofthis scanning mechanism is that the mirror(s) is moved at a constant velocity, which means no acceleration type errors in the angle observations as with an oscillating mirror. The disadvantage of such a mechanism is that the mirror is not always pointing at the ground, therefore, not always collecting observations. Also, the field of view is less than an oscillating mirror's (Morin, 2002).

2.2.1.2 Control and Processing Unit
The control and processing unit regulates and monitors the emitted laser beam and the received portion of that beam (Wehr and Lohr, 1999). This component of a laser scanner records the line-of-sight vector and the respective scanning angles. This unit is also synchronized with and supported by a POS. Geocoding ofthe laser scanner measurements requires an accurate synchronization of the IMU, GPS and the laser scanner data. In order to provide this, timing is controlled by an internal clock, which is synchronized with GPS time by the use of the Pulse per Second (PPS) signal generated by the GPS receiver internal clock (Morin, 2002). Each measurement is tagged with a

13

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

value from the internal clock. The tags are then referenced to the PPS and each combined range and angle measurement is assigned a GPS time tag (Morin, 2002).

2.2.2

Global Positioning System

Global Positioning System (GPS) is a one-way, all-weather positioning and timing system that provides continuous worldwide coverage (EI-Rabbany, 2000). With the advent ofGPS and the existence ofa complete satellite constellation, GPS has made it possible to determine accurate time, position and velocity for a moving platform, in this case an aircraft. GPS is nominally composed of twenty-four satellites evenly spaced in six orbital planes. These orbits are nearly circular and have an altitude of about 20 200

Ian above the earth (Cosandier, 1999). The parent reference datum for GPS is WGS84.

The basic idea of positioning by using GPS is as follows. The GPS satellites send signals that are picked up by the GPS receiver. The receiver analyses the satellite signals to determine the distances to the satellites and interprets the navigation message to obtain the locations ofthe GPS satellites in space (EI-Rabbany, 2000). The process of

computing the position of the receiving GPS antenna is based on the principle of spatial trilateration, given by Equation 2.6.

p

= [ ( Xs -Xr / + ( Ys - Yr ) 2 + ( Zs - Zr ) 2] 0.5

(Eq.2.6)

where p is the distance between the antenna and the satellite.
Xs,

Ys,

Zs

is the satellite position in an Earth-centered, Earth-fixed frame. is the receiver'S antenna position in an Earth-centered, Earth-fixed frame.

Xr, Yr, Zr

14

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

An additional clock tenn is added to account for drift in quartz oscillators, which are employed in GPS receiver designs (Cosandier, 1999).

The GPS positioning mode used in the operation of the system under consideration is called Relative Positioning. Relative Positioning consists of two GPS receivers tracking the same satellites simultaneously to detennine the relative coordinates. Figure 2.3 shows the use of Relative Positioning for detennining the position of the remote receiver's antenna, which is mounted near the laser scanner.

Remote receiver and, antenna

Flight Path
I

I

'I

Base

Station

---;;;p\\'-

.___~

Figure 2.3 Relative Positioning Used with Aerial Remote Sensing

For Relative Positioning, the satellite coordinates X s, Ys, and Zs, the distances between the antennas and the satellites and the base station coordinates X b, Y b, and Zb, must be known in order to detennine the relative coordinates, X r, Y r, and Zr, of the onboard remote antenna.

15

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

The GPS signal structure has five components: Ll, L2, CIA-code, P-code and navigation message. Ll and L2 are two carrier frequencies that all GPS satellites transmit.

The Course Acquisition - Code (CIA-code) is transmitted on the Ll frequency only and each satellite is assigned a unique code. The Precision - Code (P-code) is transmitted on both the Ll and L2 frequencies. This code is 266 days long and sent at a rate of 10.23

Mb/s. Each satellite is assigned a unique one-week segment of this code. The final
component ofthe signal structure is the navigation message, which is transmitted on both the Ll and L2 frequencies. Within the message is orbital information called the ephemeris, clock data and almanac, which contains future orbit information, etc (EIRabbany, 2000). GPS receivers are classified by their receiving capabilities. A Single Frequency receiver has access to the Ll frequency, while a Dual Frequency receiver has access to both Ll and L2. The Dual Frequency receivers are the most accurate receiver type and can produce geodetic quality measurements (EI-Rabbany, 2000).

The distance between a receiver and a satellite can be calculated in two ways. The first method is called Pseudo-Range measurement. The satellites and the receiver generate the same code, at the same time. The receiver measures the time offset (.M) between the code of the satellite and the code of the receiver and multiplies this by the speed oflight to find the pseudorange of the satellite to the receiver (El-Rabbany, 2000). The second method is called Carrier Phase measurements. The initial phase measurement is ambiguous by an integer number of cycles. This ambiguity remains constant with time, as long as the receiver remains locked on the signal. Resolving the am biguities is the key for

16

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

centimeter level accuracy and this can be done in real time or through post-processing (EI-Rabbany, 2000).

2.2.3

Inertial Measurement Unit

An Inertial Measurement Unit (IMU) is comprised of triads of accelerometers and gyros

that measure incremental velocities and angular rates. Hutton et aI. (circa 1997) explain that these are numerically integrated by a strapdown navigator to produce geographically referenced positions, velocities and attitudes. This system is also known as an Inertial Navigation System (INS). In order to produce accurate position and attitude, the accelerometers and gyros in the IMU must be of high quality with low noise and drift. Typically, IMUs are comprised of force rebalance or integrated silicon accelerometers and either Fiber Optic Gyros (FOG), Ring Laser Gyros (RAG) or Dry Tuned Gyros (OTI). The IMU used in the system under investigation is small and lightweight, and is mounted directly on the laser scanner, as shown in Figure 2.4. This ensures the best possible accuracy with minimized flexure between the IMU and the laser scanner. This is a key feature in airborne scanning where the highest possible accuracies are required (Hutton et aI., circa 1997).

17

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Flight Path IMU

mOlmted on laser ~_--,~:i:~~~_-'. scanner

Ori entati on Angles

Figure 2.4 The Onboard Inertial Measurement Unit

In general, an IMU consists of three gyroscopes and three accelerometers. The gyroscopes are used to sense angular velocity
(J)ibb

that describes the rotation of the b-

frame with respect to the i-frame and is coordinated in the b-frame, where the b-frame is a fixed body coordinate frame and the i-frame is a properly defined inertial reference frame and can be considered as being non-accelerating and non-rotating. The accelerometers are used to sense specific force f b in the b-frame. The angular velocities
(J)ibb,

are integrated in time to provide orientation changes of the body relative to its initial

orientation. The specific force measurements f b are used to derive body acceleration which, after double integration with respect to time, give position differences relative to an initial position (EI-Sheimy, 1996). The specific force measurements f b and the angular velocities (J)ibb can be used to determine all parameters required for trajectory determination by solving the following system of differential equations shown in Equation 2.7.

18

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

-----------

(Eq.2.7)

where:

n-I

is the scaling matrix, obtained through the integration process using the

implied reference ellipsoid gm is the gravity vector, normally approximated by the normal gravity field W is Earth rotation and assumed to be known with sufficient accuracy (EI-Sheimy, 1996)

In practice, due to the double integration of the IMU acceleration data, the timedependent position errors will quickly exceed the
accura~y

specifications for many

trajectory determination applications. In order to correct these error within the m ultisensor mapping system, a Kalman filter is used. A Kalman filter processes measurements that match the IMU solution with GPS data to obtain estim ates of the significant errors in the IMU data. The Kalman filter uses the complementary nature of these error characteristics to calibrate the inertial navigation errors and aiding sensors with respect to each other (Hutton et aI., 1997 circa).

2.2.4

IMU and GPS Data Integration

It is known that an IMU alone cannot achieve highly accurate position, velocity and

attitude information, while GPS alone cannot provide highly accurate attitude (Sun,

19

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

1994). When IMU and GPS data are integrated, the position, roll, pitch and heading measurements can be highly accurate.

Two filters: a centralized filter or a decentralized filter, can integrate GPS and IMU. A centralized filter integrates GPS carrier phase measurements with IMU gyro and accelerometer output. A decentralized filter integrates IMU output and GPS output from their separate filters to a master filter. Generally, a centralized filter produces a tighter integration (Sun, 1994).

The integration procedure using a centralized filter is as follows (Sun, 1994): to begin with, the IMU prediction is performed at an interval given by the IMU data until the IMU time tag and GPS time match, then the GPS double difference carrier phase is computed. The double difference carrier phase is compared with the predicted values based on the IMU predicted position. If the difference is larger than a threshold, then a cycle slip has been detected and is, subsequently, corrected. After the correction of the double difference carrier phase data, the predicted values are used to update the IMU in a centralized Kalman filter. The position and attitude information output from the update are based upon the final GPS/IMU integration result (Sun, 1994). This process is repeated for the entire GPS and IMU data stream. The GPS/IMU integration scheme is shown in Figure 2.5.

20

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

----

---

----

--------------

~

IMU data

GPS data
,~

~

Kalman Filter prediction equation

ComQuted double difference phase and phase rate
.... 1/
"-

r-<r.,-

~
...

GPS time-tag?

Check for cycle slip

Kalman Filter update equation

~

Figure 2.5 GPSIIMU Integration Scheme (Sun, 1994)

2.3 2.3.1

System Errors Atmospheric Errors

The most important systematic atmospheric error relates to the atmospheric refraction of the laser signal. Simply·stated, the laser signal is refracted, or bent, as it moves through the atmosphere. The refraction is a function of wavelength, attitude, scan angle and atmospheric conditions. Atmospheric refraction can be modeled by using a standard atmospheric model.

I

I

21

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

~a.

= K ·tan a.

(Eq.2.8)

where a. is the recorded scan angle K is the atmospheric correction value And ~a. is the defraction angle

K - (241OH 2410H - H2 -6H +250 - H2 -6H +250 H

(h)) x 10-6

(Eq.2.9)

where h is the elevation of the ground about the datum
H is the elevation of the scanner above the datum

Clearly, the amount of deflection

(~a.)

is proportional to the scan angle and the amount of

defraction reaches a maximum at the edge of the scan and zero for nadir scans. The commercial airborne ALS system manufactures' atmospheric refraction models are mostly proprietary, but they are very similar to the above standard atmospheric model used in photogrammetry (Morin, 2003).

In addition to the angle correction, as seen in Figure 2.6, the distance the pulse travels along the curved ray path is different from the theoretical ray path and must be adjusted accordingly.

22

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Laser head

Tangent to refracted ray at the laser head

H

~/
, ......- .. --.-- Actual ray path

h
Datwn

Figure 2.6 Atmospheric Refraction

Another atmospheric error that must be considered is that the received power of the range signal can be reduced by poor atmospheric conditions. Dust and smoke in the atmosphere can cause small amounts of energy to reach the receiver as backscatter and therefore complicate target identification. These random errors can mostly be reduced by proper mission planning and eliminated with filtering during post-processing (Morin, 2003).

2.3.2

Scanner Errors

One of the most noticeable errors in laser scanning is the measurement of the scan mirror rotation angle. The primary factor that influences errors in the measurement of the scan mirror rotation angle is the method of measurement. A controlling device called a galvanometer sets the mirror's position. The galvanometer itself can measure the scan

23

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

mirror rotation directly, but this method of measurement does not offer the highest accuracy. Such measurement systems have shown accuracies of approximately 0.02 degrees, while another method, the use of a separate angle-encoding device, allows measurement accuracies of approximately 0.001 degrees (Morin, 2003). This can improve the laser point accuracy from decimeter to centimeter accuracy (Morin, 2003). A typical angle encoder consists of a glass disc with regular etch m arks and a small laser which accurately measures the et~h marks. The basic components of an angle encoder are shown in Figure 2.7.

Laser Mirror

~

. Encoder Reader

Figure 2.7 Scan Angle Encoder

The angle encoder should be precisely mounted perpendicular to the scan mirror's rotation angle to eliminate projection errors with the glass etches. If the encoder is not mounted precisely, then the projection error must be modeled or calibrated to ensure the highest accuracy from the angle encoder (Morin, 2003).
24

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Another scanner error that affects the accuracy of the angular encoder is a tim ing delay in the control unit itself. The error that is created by this tim e delay is not a physical error, like an angle encoder error, but a systematic error that is found in the derived ground points. This timing delay error or encoder latency error occurs when the control unit does not respond quickly enough thus causing a delay between when the range measurement is recorded and when the scan angle is recorded. The delay causes the scan angle to be recorded or registered to an incorrect angle (Morin, 2003).

Even though the latency error is a systematic error, the effects of this error are visible within the derived ground points. Because an oscillating mirror comes to a stop at the edges of the FOV, the recorded scan angles are quite close in magnitude to one another and, therefore, have a minimal error. Also, as the scan approaches the nadir, slant range shortens and the visible error minimizes again. This creates a visual pattern called a "bow tie" in the derived points on the ground (Morin, 2003). Figure 2.8 illustrates how the error grows between the edge of the FOV and nadir and again from nadir to the edge oftheFOV.

Edge ofFOV

v=O

-..
·· ·
·

Nadir

t
·
FOV

Corrected Scan · ·

. .. . .

Figure 2.8 "Bow Tie", the Visible Effects of Encoder Latency on Derived Ground Points.

25

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Encoder latency error can be as high as 15 microseconds and for a system operating at 45° FOV and a 20 Hz scan rate, 15 microseconds oflatency delay could cause up to a 0.027 degree angular difference (Morin, 2003).

A latency error can be corrected by manually changing the magnitude of the latency value. When the "bow tie" pattern disappears from the derived points, the latency value has been determined. Once determined, the value can be applied to all other data sets, because it is a constant function of the control unit.

In addition, scanner torsion is another source of scanner error. Scanner torsion is caused by the changes in velocity and acceleration of the oscillating scanner mirror. Due to the nature of the oscillating scan pattern, the mirror is repeatedly accelerated and decelerated in order to reverse its direction. The scan mirror is attached to the drive motor and the angle encoder disc by a lever, as shown in Figure 2.9. The drive motor rotates the lever to move the mirror.

26

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Scan Mirror Drive Motor Angle Encoder Disc

Figure 2.9 Scan Mirror Components

The mirror and the encoder have mass thus they have momentum. Figure 2.1 0 illustrates the velocity and acceleration of the scanner mirror and encoder at pivotal points, point A, Band C when the mirror is moving counter-clockwise ..

A

y=O a=max

B y=max a=O

c

y=O a=-max

Figure 2.10 Velocity and Acceleration of the Scan Mirror

27

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

At point A, the mirror is stopped to reverse direction, so the velocity at this point is zero, but the applied force required to reverse the direction of the mirror means the acceleration is at a maximum (Morin, 2003).

At point B, halfway through the scanner's FOV, the mirror is moving at its fastest. Therefore, velocity is at its maximum, immediately before the mirror starts to slow down in order to reverse direction at the. edge of the FOV. Because the mirror is about to slow down the acceleration is at zero (Morin, 2003).

At point C, the mirror has once again come to a stop in order to reverse direction, therefore, velocity equals zero. In order to stop, the mirror must have a maximum negative acceleration or maximum deceleration at this point.

Because of the large acceleration forces needed to move the mirror across the FOV between 15 to 50 times a second, the lever undergoes torsion. The torque applied by the drive motor causes torsion or a twisting of the lever. The overall effect of the torsion is that the encoder lags behind the mirror, which, itself, lags behind the position of the drive motor (Morin, 2003).

The difference in angular position between the scan mirror and the encoder causes misregistrations of the observed distances. Over flat terrain, the range measurement at the mirror position will be shorter than the range measured at the encoder. Thus, an incorrect shorter range is recorded at the encoder position. The difference between the

28

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

true range and the measured distance increases proportionally with the scan angle, the FOV and the scan rate (Morin, 2003). The observable effect in the data is strip bowing, commonly known as sensor "smile" as shown in Figure 2.11.

Misregistered Points
---L~----~==~=-~~-=~~~----~~--Trueground

Figure 2.11 Sensor "Smile" or Strip Bowing of Scanne~ Torsion Error

If the encoder is located closer to the drive motor on the lever than the mirror, the "smile" becomes a "frown", with registered distances being too long (Morin, 2003).

This angular error can be modeled using the equations for momentum and torque, but a simple correction model can also be applied by modeling the parabolic smile, i.e.: (Eq.2.10) where 130 is the encoder angle c is an angle correction constant.

29

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

A negative value of c will bring in the encoder, aligning the mirror and encoder and flatten out the bowing or "smile" (Morin, 2003). Trial and error can be used to determine c the angle correction constant.

2.3.3

Position and Attitude Accuracy

Position accuracy depends mainly on the quality of the differential GPS (OGPS) postprocessing. Through the integration ofGPS with IMU, GPS errors are smoothed and achieve typical accuracies of 5-15cm (Baltsavias, 1999). The derived accuracies also depend on GPS satellite constellation during flight, the distance of ground reference stations from the aircraft; and the accuracy of offsets and misalignment between the GPS and IMU and the IMU and laser scanner.

Attitude accuracy depends on the quality ofthe IMU data, the IMU interpolation error, the method of postprocessing, and the integration with the GPS. The effect of attitude errors on the 3D accuracy increases with the flying height and the scan angle. Possible time misregistration errors between the different sensors can have a ruinous effect on the position and attitude accuracy (Baltsavias, 1999). Orientation, position and range are required to be recorded at the same time. If there is a time offset between any or all of the sensors and this is not known, it Will cause systematic errors. A small time offset between range and rotation angles can cause large errors in the 3D accuracy for a turbulent flight. The accuracy of the transformation from WGS84 to the local coordinate system and corrections for geoid undulations is also another consideration (Baltsavias, 1999).

30

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

2.3.4

GPS Errors

Cycle slips are discontinuities in GPS carrier phase observations caused by tern porary signal loss. This error is caused by obstructions, radio interference, severe ionosphere and/or.high receiver dynamics. Other errors and biases ofGPS relate to the atmosphere, the satellite and the receiver (EI-Rabbany, 2000). Table 2.1 outlines these errors, their causes and ways of correcting or preventing them. Table 2.1 Common Errors in GPS (EI-Rabbany, 2000) Error Cause Broadcast Ephemeris - result of improper Errors prediction of satellite positions Satellite Clock Error - the clocks are highly accurate, but not perfect Correction or Prevention -"Precise Ephemeris" can be applied during postprocessing - remove through differencing between two receivers - applying satellite clock correction (in navigation message) - removed through differencing between two satellites - careful site and antenna selection

Receiver Clock Error - receiver clocks less accurate then the satellite clocks Multipath Error - when the satellite signal arrives at the antenna through different paths (causes problems in solvin~ the ambi~uities) Antenna Phase Centre - ~he point at which the Variations signal is received is generally not the physical centre of the antenna - a good system should have Receiver - result of the limitations Measurement Noise of the receiver's electronics a minimum noise level Ionosphere Delay - the region between 50 km - can be removed or reduced and 1000 km above the Earth speeds up the carrier phase the same amount that it slows down the Ipseudorange Tropospheric Delay - the region between 50 km and the Earth's surface, affect the height component more then the vertical

""
31

:1

j~
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

',I

Satellite geometry is another source of error in GPS. Bad satellite geometry enlarges the area of uncertainty for positioning. Such poor satellite geometry can be prevented by using the signal for satellites that are 10° above the horizon (EI-Rabbany, 2000). The area of good geometry above the horizon is shown in Figure 2.12. Overall, the errors in GPS can be removed, prevented or modeled, except for cycle slips that must be dealt with by compensating for them with other GPS data or with other navigation sensor data, such as IMU data.

Area of Good Elevation

Figure 2.12 Satellite Geometry Above the Horizon

2.3.4.1 Cycle Slip Correction
The occurrence of cycle slips is an important remaining problem in GPS carrier phase positioning. A cycle slip is a change of ~ VN (double difference carrier phase ambiguity) by an unknown integer number from one epoch to the next due to blockage of the signal path or signal noise (Sun, 1994). There several of ways to detect and correct cycle slips.

32

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Since an IMU has a very good short-tenn stability, it can be used to detect GPS carrier phase cycle slips in a number of seconds, depending on the perfonnance of the IMU (Sun, 1994).

When using the IMU to correct for cycle slips, the IMU is used to predict the position of the aircraft at the measurement epoch base on the last epoch. The double difference carrier phase can then be computed ,from this prediction. A threshold has to be given to detennine the presence of a cycle slip. This threshold should be sm aller than 0.5 cycles in order to reliably detect small cycle slips, but this threshold may need to be less stringent in order to avoid the incorrect detection of cycle slips (Sun, 1994).

2.3.5

Misalignment Error

A critical error in ALS systems is the angular misalignment between the scanner and the IMU, which is called the misalignment or "Boresight" error. This error must be addressed before an ALS system can accurately produce data. The magnitude and orientation of the errors induced by this misalignment are a function of several parameters, such as, flying height, scan angle, and flight direction. The components of the misalignment error (roll, pitch and heading) are illustrated in Figure 2.13.

33

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Misalignment Roll Error

Misalignment Pitch Error

Misalignment Heading Error

\

\

,
\

8\ \

\
\

·

Mis-registered Point caused by misalignment error

Figure 2.13 Misalignment Errors

The misalignment between the laser scanner and the IMU causes each laser point observation to be registered with an incorrect aircraft attitude, resulting in an incorrect point position. The roll error, shown in Figure 2.13, causes a slant range to be incorrectly registered compared to the orientation of the aircraft. The elevation difference tends to increase with larger scan angles. The pitch error also results in a laser slant range to be incorrectly registered compared to the orientation of the aircraft. As the slant range is longer, the entire strip tends to be pushed down .. The heading error induces a skewing in each scan line.

Unlike an image, a misalignment error affects each observation and cannot be modeled by observing the induced errors in position of the control points. These errors are correlated with flying direction. In order to correct these errors, they must be

34

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

decorrelated. Observing targets taken from different flying directions accomplishes this. This is the underlying principle of the automatic misalignment estimation model.

2.4

Airborne Laser Scanner Data Applications

There are several applications for airborne laser scanner data. ALS is an accurate, fast and versatile measurement system, which can complement or even replace other existing geo-data acquisition technologies (Wehr and Lohr, 1999). The advantages of using ALS data are the ease of data acquisition, the increased ability to determ ine surface elevations in difficult areas and the expeditious data delivery. Also, the processed data is "digitallyready" for GIS applications. Table 2.2 shows a variety of ALS data applications. Table 2.2 Applications of ALS Data
Mapping using ALS Data Corridors, such as roads, railway tracks, pipelines and waterway landscapes Electrical transmission lines and towers Flood and drainage pattern mapping Rapid mapping and damage assessment after natural or other disasters Wetlands Coastal areas and hydrographic surveys in depths up to 60m DTM and DEM Generation Forested areas Urban areas Wetlands Measurement Coastal areas, dunes, tidal flats and determ ination of coastal change and erosion Volume calculations for open pit mining Snow and ice cover, i.e. glacier monitoring Derivation of vegetation parameters, i.e. tree height, crown diameter, tree density, biomass estimations Modeling 3-D city models, i.e. animation, planning relay antenna locations for wireless communications

35

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

ALS data has attributes, such as high point collection density; registration of multiple echoes; and amplitude or intensity registration, that increase the value of the data and make ALS data uniquely proficient for the above applications (Axelsson, 2000). The high point collection density provides more accuracy in diverse landscapes. The point density is dependent on flying height, platform velocity, the sensor's field of view (FOV) and the sampling frequency of the scanner (Axelsson, 2000). The required point density varies according to the end user's application and mission planning is very important. The ability of ALS sensors to register multiple echoes of the returning pulses is how these sensors are able to collect points through vegetation and even below water surfaces. Also, this capability can be used to identify rapidly changing elevations (Axelsson, 2000). In the case of Lidar-based systems, the ability of the sensor to register the return pulse's amplitude or intensity allows the data to be viewed as an image, based on the points' x, y and intensity values. This allows for quick object i~entification such as separating pavement from grassland (Axelsson, 2000).

2.4.1

Filtering methods for DEM Generation

In order for the raw or unedited ALS data to be used for the applications mentioned previously, such as digital elevation models (DEM) or digital terrain models (DTM), the data must be filtered. Filtering involves the processing of the data to remove unwanted data, such as blunders and undesired objects, like vegetation or buildings. There are several filtering methods for each type of application.

36

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

2.4.1.1 Linear Prediction for Filtering
In the course of processing airborne laser scanner data to generate a digital terrain model (DTM), filtering is applied to the data in order to remove the height values of vegetationhorizons and buildings. Lohmann (2000), presents an approach to filtering laser scanner data called linear prediction and applies this method to different data sets.

Linear prediction is a statistical interpolation method and is based on the correlation of neighboring points, expressed in the covariance function. The covariance between two points, Pi and Pk depends on their spacing. If the points are close to each other then the covariance will be high. Initially, a polynomial of a very low degree or a moving plane is created for the data in order to define a trend function. The moving plane is defined by three unknown coefficients ao, aI, and a2

(Eq. 2.1la) (Eq.2.1lb)
The result is the residual vector ~, which contains the centered points of measurement Zi. These values describe the deviations of the sample points from the trend functions.

The predicted values

Ui

are estimated from the residuals

~

and the described covariance

information contained in C using a least squares adjustment. The interpolated surface for another point, Pj , is given by
U·
'}

= cT col Z

-- -

(Eq.2.12)

37

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

1.0
C=
C(P2~)
C(Pn~)

C(~P2)

C(~Pn)

1.0
C(PnP2)

C(P2Pn)

1.0

Z.

z=

Z2

Zn

Pj = ao + a/Xj + a2Yj + Uj where cT the covariance between the point to be interpolated and the measurements C the covariance matrix z the vector of centered measurements Note: All measurements are weighted equally. Lohmann (2000) uses a program called DTMCOR in order to apply linear prediction to the data sets. Within the program, the user defines two t-olerance factors. The first one is in respect to the moving plane. Any height values that are above the given tolerance are excluded as outliers. This is repeated iteratively until no more heights are rejected. The second tolerance factor checks the difference between the centered measured value Z and the predicated value,
Uj,

calculated by the software. If the residuals are bigger than the

tolerance these points are also rejected. Lohmann (2000) found that the method of linear prediction was very good for forested areas but that large buildings can cause problems. Also, the linear prediction was not well suited for undulating terrain because it results in too much smoothing.

38

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

2.4.1.2 Filtering Using Adaptive TIN models
Axelsson (2000), presents an approach to filtering laser scanner data using adaptive Triangular Irregular Network (TIN) models. This method of filtering was specifically designed to generate DEMs for complex and discontinuous ground surfaces, like dense cities and complex construction sites.

This filtering algorithm is based on a TIN. The TIN is a vector data structure for representing geographical information that is modeled as a continuous field that uses tessellated triangles of irregular shape, based on Delaunay triangulation (Burrough and McDonnell, 1998). Delaunay triangulation is a method of graphing obtained by joining pairs of points whose polyhedra are Thiessen divisions of the plane. Thiessen polygons are a tessellation of the plane such that any given location is assigned to a tile according to the minimum distance between the location and a single previously sam pled point (Burrough and McDonnell, 1998). Tessellation is the process of dividing an area into smaller, contiguous tiles with no gaps in between them (Burrough and McDonnell, 1998).

Because this method is designed for complex and discontinuous ground surfaces, a high point density of greater than 1 point per m 2 is needed (Axelsson, 2000). The high point density enables structures and break lines to be accurately identified and modeled.

Before the TIN is created, statistics are collected from the entire data set. The parameters for the initial TIN densification are found using histograms of surface normal angles and elevation differences to identify median values (Axelsson, 2000). These parameters are

39

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

the distance to the TIN facets and angles to the nodes. The identified median values are used to estimate the parameter thresholds (Axelsson, 2000).

The next step of the algorithm is selecting the seed points to create a sparse TIN. The seed points are selected within a user-defined grid, the size of which is based on the largest type of structure (Axelsson, 2000). Once the sparse TIN is created, its density is then increased using an iterative process. One point at a tim e is added to each TIN facet or tile, ifit meets the criteria based on the threshold parameters. With each iteration, new threshold parameters are calculated using only the points in the current TIN (Axelsson, 2000).

The method described so far is satisfactory for simple, continuous surfaces. However, discontinuous surfaces that this algorithm was designed to deal with, have edges that could easily be cut off because the threshold values are quickly exceeded with these edges (Axelsson, 2000). So, to avoid the edge cut-offs, the TIN facet circum venting the point representing the edge and the surrounding area are examined. Mirroring the point that exceeds the threshold, to the closest node point, achieves this goal. The deviation from that TIN facet is calculated. If the mirrored point meets the criteria based on the threshold parameters, in the mirrored position, then the original point is accepted (Axelsson,2000). Clearly, the acceptance of this point and others like it within the same iteration adjusts the threshold parameters for the next iteration, allowing more edge identifying points to be accepted by the TIN algorithm. The iterative process is stopped when no more points are added to the TIN surface (Axelsson, 2000). Figure 2.14 shows

40

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

the adaptive TIN model. In Figure 2.14, box 1 shows the TIN with the edge cut off; box 2 shows an edge point being tested for the TIN model; box 3 shows a mirror of the edge point being tested; and box 4 shows the accepted edge point in the new TIN model.

2

......

----.
.... ---o

......----.
d> d

...

3
0 c ........

~> d...,.

d<d
1
lUI

-

....

-_-.;:. -=,_~ ~.O,<: :J I·
0

-.

..........

True Surface - - - TIN Surface

· Points used in TIN o Points yet to be tested for TIN

[!] Point being examined for TIN ~ Mirrored point

Figure 2.14 The Adaptive TIN Model (Axelsson, 2000)

2.4.2

Laser Scanning Applications for Forestry

The ability to remotely sense both the total quantity and spatial organization of forest biomass would provide a way to meet the need for forest inventory. Traditional optical sensors are only capable of providing detailed information on the horizontal distribution and limited vertical distribution of vegetation in forests (Lefsky et aI., 1999). Airborne laser scanning systems are capable of providing both horizontal and vertical information with the horizontal and vertical sampling dependent on the type of ALS used and its configuration (Lima et aI., 2003). Forest attributes such as canopy height can be directly retrieved from Lidar data. Direct retrieval of canopy height provides opportunities to

41

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

model aboveground biomass and canopy volume. Access to the vertical nature of forest ecosystems also offers new opportunities for enhanced forest monitoring, management and planning (Lima et aI., 2003).

Laser scanning systems are able to directly measure the vertical structure of a forest because the scanners employ multiple measurements of both distance and the amount of energy reflected from the many surfaces of the forest (Lefsky et aI., 1999). The height and intensity returns are recorded from both the vegetation and the soil, from the top of the canopy to the ground.

Laser scanning used in forestry applications can be categorized as either 'discrete return' systems or 'full waveform' systems and differ from one another with respect to how they vertically and horizontally sample a canopy's three-dimensional structure (Lima et aI., 2003). Figure 2.15 depicts both discrete return data and full waveform data.

42

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Full Lidar

wave""'"

,

,,
I

, \, , I I
I'

.".

Discrete :return. Lidar

I I

I ,

I I I
I

" \
I

.=-----=-

I~~~~

I I ~~'f-~ib

·

I ,

I

cJ
Figure 2.15 Differences between discrete return and full waveform Lidar data (Lima et aI., 2003) The vertical sampling of Lidar systems relates to the number of range samples recorded for each emitted laser pulse. The horizontal sampling is determined by the area of the footprint and the number of such footprints, or 'hits', per unit area (Lima et aI., 2003).

I

I

I

A requirement for calculating canopy heights, using both discrete return and full waveform scanner data, is the ability to identify some ground reference level below the canopy. In the case of discrete return Lidar data, canopy height estimates are calculated by taking the difference between those Lidar returns not classified as ground and a surface representative of the terrain. This representative surface is typically interpolated from remaining returns after the point cloud has been filtered using a vegetation rem oval algorithm (Lima et aI., 2003). For full waveform Lidar data, canopy heights can be

43

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

calculated by converting the elapsed time difference between the peaks of the two most prominent modes in the amplitude waveform into range (Lima et aI., 2003).

Lidar-generated canopy profile area is a significant variable in estimating gross merchantable timber volume. One approach is to use tree height measurements to accurately derived stand biomass and gross-merchantabie volume by indirectly modeling (Lima et aI., 2003). This principle ,can use discrete return data. Another approach is to transfonn the wavefonn, for full wavefonn Lidar data, into a canopy height profile and then, using a threshold, classify the profile into four zones (Lima et aI., 2003): (i) empty, which includes no canopy or ground material; (ii) elements in the uppennost 65% of the canopy closure; (iii) area of the remaining elements not included in the uppermost 65% or empty zone; and (iv) open gap volume. Subsequently, total volume for each of the four zones for the entire area of study can be calculated for a-set ofwavefonn s in a study plot (Lima et aI., 2003).

Another forest management strategy is to identify different types of tree stands within a forest. There are three different types of stands to be considered, young stands, mature stands and old-growth stands. Young stands have dense canopies and little variability in tree size. Therefore, the resulting scanner data would reflect a packed, mono-layer canopy (Lefsky et aI., 1999). Old-growth stands have large live trees, high diversity of tree diameter, high diversity of species and the presence of large standing snags (dead trees) and fallen logs. The resulting scanner data would reflect high diversity oftree

44

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

heights and the presence of multiple canopy layers (Lefsky et aI., 1999). Matures stands have attributes of which lie between the other two types of stands.

2.4.3

Laser Scanning Mapping of Coastal Zones

Traditional hydrographic surveys of coastal zones employ acoustical techniques operated from launch-type vessels or the use of el ectronic distance measuring devices (Irish and Lillycrop, 1999). These traditional methods are considered slow and provide low-density measurements of the surveyed area. In the 1970' s, the first generation airborne lidar bathymetry system was developed. This greatly increased the ability to accurately map coastal zones (Irish and Lillycrop, 1999).

Bathymetry is the measurement of sea depths. Airborne lidar bathymeter measures water depths by using a laser pulse that travels to the air-water interface where a portion of the energy is reflected back to the receiver (Irish and Lillycrop, 1999). These are the surface returns. The remaining energy transmits through the water and reflects off the sea bottom. These are the bottom returns. This is shown in Figure 2.16.

45

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Receiver and Timing System

Transmitter

Pulse Reflection fromSurfuce ~

1
t
"

Separation time, t

Return Pulse

~

..;--C, \

t\\ \
\

T
\ \

L., Transmitted
Pulse

\

Pulse Reflection / from Bottom

\ \ \

Figure 2.16 Laser Scanning Bathymetry Principle

The depth of the water is calculated using the tim e difference between the surface return and the bottom return (Irish and Lillycrop, 1999). The speed of light through water is taken into account during this calculation. The maximum detectable depth is limited by refraction, scattering and absorption, which reduce the strength of the bottom return. Water clarity and bottom type are also major limiting factors for depth detection (Irish and Lillycrop, 1999). Laser scanner bathymeters can collect through depths up to 60 m, which is 3 times the visible depth (Irish and Lillycrop, 1999).

46

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

In 1994, the US Anny Corps of Engineers developed an airborne lidar bathymetry system called SHOALS (Scanning Hydrographic Operational Airborne Lidar System). This system employs laser scanner technology to remotely collect accurate, high-density measurements of both bathymetry and topography in coastal regions (Irish and Lillycrop, 1999). The SHOALS system uses a scanning, pulsed infrared (1064 nm) and blue-green (532 nm) laser transmitter. The infrared frequency was selected to optimize air-water interface detection. The blue-green.frequency was selected to optimize water penetration, up to 60 m (Irish and Lillycrop, 1999). The blue-green frequency is also employed to measure topographic elevations. This is unlike most topographic laser scanner systems that use an infrared frequency. The system typically operates at a very low altitude of 200 m and the speed of 60 mis, resulting in a swath width of 110m. The survey rate is approximately 16 km 21h, which is several times faster then conventional fathometer survey rates (Irish and Lillycrop, 1999). The SHOALS system also employs a geo-referenced down-look video camera to obtain approximate positions of coastal structures, navigation aids and other objects of interest. The types of projects that the SHOALS system has been used for include mapping maintained channels and harbours, coastal structures, the creation of nautical charts and monitoring on- and off-shore coastal erosion (Irish and Lillycrop, 1999).

47

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

3.0

The Misalignment Calibration Problem

An ALS works by locating laser hits independently from all others. Locating the laser
hits requires knowing precisely for each laser shot, the aircraft position from GPS, the attitude of the aircraft from IMU, the scanner angle when the laser pulse left the sensor, and the slant range to the ground for that pulse (Smith, 2002). A frequent problem with ALS data is that it shows systematic shifts in elevation and horizontal position when compared to other data sources and systematic differences between overlapping data from the same sensor (Morin, 2003). These types of system atic errors are largely due to calibration of the sensors. The most offending parameters are the alignment angles, omega, phi, kappa, between the positioning and orientation sensors and the laserscanning sensor (Morin, 2003). The concept of calibrating the alignm ent angles is to identify the small misalignment angles between the sensors and to adjust the data to compensate for the misalignment.

3.1

Pre-Flight Calibration

An important step in collecting accurate ALS data is ensuring proper preflight calibration and initialization of the integrated sensors. The laser range finder and the offsets between scanner and the navigational sensors must be calibrated. Also, the GPS and IMU need to be initialized.

The laser range finder can be calibrated on the ground for its zero-bias and the variable receiver bias. Receiver bias is commonly known as "range walk" and is caused by

48
:.

l
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

changes in the intensity versus pulse detection (Morin and El-Sheimy, circa 2002). In order to calibrate these biases while the platform is stationary, the laser is directed to a fixed target on the ground. The distance to the target is measured with either a steel tape or an independent electronic distance measurement (EDM) system. By varying the power of the emitted laser, from the detector threshold to saturation, a curve can be established to model the apparent range based on receiver power. This curve can then be used in post processing to compensate for the receiver biases (Morin and El-Sheimy, circa 2002).

The offset between the systems can also be measured with a steel tape or through a total station survey. The measurement should be made to within 1-3 em to minimize the offset error impact on the data (Morin and El-Sheimy, circa 2002). Any uncorrected errors in the offsets will be propagated as a bias onto the target coordinates. It should be noted that the effect of errors in the offset are minimal compared to errors in the sensors' alignment angles.

The navigation sensors must be initialized as per manufacture's specifications. For DGPS, this involves setting up near a reference base station and determining the integer ambiguities (Morin and El-Sheimy, circa 2002). It should be noted that in-flight precautions must be taken so the integer ambiguities are not lost. Avoiding large flight dynamics, like sharp turns and sudden dives, does this. As for the IMU, it needs to be initialized in order to detect and establish the local level frame (Morin and El-Sheimy, circa 2002).

49

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

3.2

Methods of Misalignment Calibration

There are different methods of calibration of the alignment between the positioning and orientation sensors and the laser-scanning sensor. The most common method is a simple manual adjustment of the misalignment angles. This method is practical, but also time consuming, biased prone, and can require ground control (Smith, 2002). Another method of calibrating the misalignment angles is called semi-automatic boresight misalignment determination (Toth, 2002). This method can be less time consuming and requires no ground control.

3.2.1

Manual Misalignment Calibration

Manual misalignment calibrations are generally a simple trial and error approach, where the operator interactively changes the misalignment angle to reach some best-fit with respect to some known surface. There are two types ofmanual calibration techniques, relative and absolute. The relative calibration is performed without ground control and looks for self-consistency within the data. This technique matches data with data from adjacent swaths and matches data from crossing flight lines. The absolute calibration is performed using ground control and compares the absolute location oflaser points or features identified by laser points to accurate reference data (e.g. ground control) (Sm ith, 2002).

In order to match and compare laser reference points for accuracy evaluations for horizontal positions building edges are used due to the sudden change in elevation. For

50

)
Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

accurate vertical positions, control points on a flat surface, such as a parking lot, are used to compare the elevation of all the laser points in the area (Smith, 2002).

The methodology used by Optech for roll and pitch calibration, for post installation of an ALS system, is to use scanning passes over building in opposite directions. The roll and pitch error shows IIp as displacement in the position of the edge of building that is direction dependent (Smith, 2002). By flying over the building in each direction four times, the average results are the roli and pitch offsets. Horizontal positioning accuracy calculations are performed by using building edge points to determine x, y position accuracy, applying roll, pitch, and scanner scale error corrections and then uses the building to evaluate the accuracy of positions of building edges (Smith, 2002).

3.2.2

Semi-automated Misalignment Calibration

The basis of this method is to estimate the unknown misalignment angles between the positioning and orientation sensors and the laser-scanning sensor. This is done using the horizontal and vertical discrepancies between overlapping strips, possibly without the use of ground control and without manually manipulating the data (Toth, 2002).

The effectiveness of this method depends heavily on the point density of the ALS points and the overall terrain characteristics of the overlapping area. Smoothly rolling terrain is ideal for test areas because it exhibits limited surface undulations while the horizontal and vertical discrepancies between overlapping strips can still be identified (Toth, 2002).

51

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

(
l

f i

A frequently used technique for matching the data is to interpolate the ALS points into a regular grid. The discrepancies then can be determined by surface matching of the selected regions within the overlap or by profile matching of man-made objects. Once the surface differences are known, a least squares adjustment can be performed for the unknown misalignment angles (Toth, 2002).

3.3

Semi-automated Misalignment Estimation Methodology

For this research, a semi-automated misalignment estimation technique is developed so that semi-automated misalignment calibration can be achieved after an ALS system is installed in an aircraft. Optech currently provides an in-lab calibration of the misalignment angles, but only uses a manual misalignment estimation method for post installation flight calibration.

This method does not require any ground control and is based on using two overlapping strips of ALS data that have been flown in different directions. The point differences for the separate strips over the same area are considered as observations and an adjustment is formulated to determine the misaligrnrient angles.

Based on the observed

diff~rences

in matched laser ground points, the misalignment

angles are iteratively adjusted to reduce the surface discrepancies in object space using the least squares adjustment method of estimation. The coordinates of a laser point are a function of the exterior orientation of the laser sensor and the laser range vector (Toth, 2002)". The mathematical model that represents the relationships between the

I '
52

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

observations, which are the exterior orientation of the laser sensor and the laser range vector, and the derived quantities, which are the misalignment angles (Anderson and Mikhail, 1998). Equation 3.1 describes these relationships:

(Eq.3.1)

where rM,k is the 3D coordinates of point K in the mapping frame rM,INS is the 3D INS coordinates in the mapping frame

R:!vs

is the rotation matrix between the INS frame and the mapping frame, measured by the GPSIINS

R~s

is the boresight matrix between the laser frame and the INS frame is the 3D object coordinates in the laser frame is the boresight offset component (Toth, 2002)

rL bINS

The objective is to eliminate the surface differences by estimating the correct rotation angles between the INS and the laser scanner. Since the boresight-offset components are mostly negligibly small and also are not amplified by object distance, they are ignored in this investigation.

By rotating the range vector by the correct boresight angles ( R~NS) the correct ground

coordinates can be calculated using Equation 3.2.

53

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

(Eq.3.2)

Where

[

~:

corr

is the corrected ground coordinates in the mapping frame
]

R:!vs

is the rotation matrix between the INS frame and the mapping frame, measured by the GPS/IMU

[~:r
l~:

is the range vector in the laser system

r
=

is the laser frame coordinates in the mapping frame at the time of measuring the

ground point The rotation matrix between the INS frame and the mapping frame is given by:

RJ~s

l

cos$ COSK cosO) sinK + sinO) sin$ COSK sinO) sinK - cos sin$ COSK

- cos$ sinK cosO) COSK - sinO) sin$ sinK sinO) COSK + coso) sin$ sinK

sin$ ] -sinO) cos$ cosO) cos$

54

PROPERT'.' :F
RYERSON l!(~l'JcJ\C~' ,'y L:f;:

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

The unknown boresight misalignment angles can be found using least squares adjustment with the condition that the squared sum of the differences between the corrected coordinates of the matched virtual points in the different strips is a minimum.

For two overlapping ALS strips, the boresight angles can be found using the "fact that the matched virtual points in the two strips should have the same coordinates. Equation 3.3, expresses the differences between the corrected coordinates (Toth, 2002).

Clearly, this equation is non-linear. It is rather difficult and often impractical to seek a least squares solution of non-linear equations (Mikhail, 1976). This im plies that some type of linearization must be used to achieve acceptable equations for processing. A Taylor's Series expansion is often used as a means oflinearization, where only the zero and first order terms are'used and all other higher-order terms are neglected. When applying a series of expansions, a set of approximate values for the unknowns, in this case, for the misalignment angles, must be chosen. Close approximations of the unknown values are important because they allow for rapid and accurate convergences
(Mikhail, 1976). In this case, it is acceptable to employ initial estimates of 0 degrees

because it is commonly accepted that the misalignment angles are generally less than 3 degrees in value (Toth, 2002).

55

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

With this type ofleast squares adjustment, the solution delivers an updated approximation vector, which is then applied to the current estimation vector. The updated vector of approximations is then used again to formulate the zero and first order terms of the linearized equations. The least squares adjustment is used to obtain another updated approximation vector and so on. This iterative process continues until the last values of the update approximation vector are insignificantly small (Mikhail, 1976). Figure 3.1 is a flowchart of the misalignment estimation adjustment process.

/

Position of tho Aircraft Xa, Ya, Za at night line 11 point Xa, Ya, Za at night line 21 point Attitude of tho Aircraft OJ,.,. at night line point
11

/

/ /

La ·· r Range Vector. X, Y, Z of pointl flight line 1 X, Y, Z of point I flight line 2

/

/

...... ' at night line 21 point

Estimate. of Bore.lght Angl.s

/

/

J I
No

Lln ·· rlzatlon of Non-Linear ObseNalion Equation

I
·1

1

Least Square Adjustment fO. ,Boe Bro,B

If the updates 10 the approximates are signflcanlly small. YES If not. Approximates are used to update the Estim ates 01 the Boreslght Angles
Ye.

·
I

Bor ·· lght Angl ··

oro, S+, OJ<

Figure 3.1 Flowchart of Misalignment Estimation Adjustment Process

3.3.1

The Misalignment Estimator Program

The Misalignment Estimator program created in this investigation is a program that calculates estimates of the misalignment angles between the IMU and the laser scanner. The input required for this program is the range vectors ofmatched points of two

56

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

overlapping ALS point clouds, the sensor platform orientation data, position and attitude of each point, and estimates of the boresight angles. The range vectors of the matched points are derived as raw data from the ALS. This data has been processed in order to find matching points within the two data sets and remove points that are considered unmatched (i.e. have no corresponding point in the other data set). The position data of the aircraft when each of the points was collected is determined by the GPS output and is interpolated during post-flight proce,ssing. Also, the attitude data of the aircraft when each point was collected is determined by the IMU output and is interpolated during postflight processing. The user can provide initial estimates of the misalignment angles between the ALS and the IMU, but the program has default initial estimates of zero. Estimates of zero can be assumed because these angles are differentially small.

The program was written using Microsoft Visual Basic. The program allows the user to select the input files to be used by the program. The input files have the user-defined estimates of the boresight misalignment angles contained in the first record, then the matched observed point data follow, one record per line. There are no headers for the point data. A sample input file is found in Appendix B. The records of the observed points must be in the same order in both input files, since this is how the program matches the corresponding points as matched points.

The observed point data is formatted as follows: point number, ground Easting, ground Northing, ground elevation, air Easting, air Northing, altitude, omega, phi, kappa, x-range

57

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

vector, y-range vector, z-range vector, and intensity. The program can also run using roll, pitch, and heading, if needed, but available code changes are required. The output of the program is the calculated approximates of the boresight angles for each iteration of the program and the final boresight misalignment angles calculated by the program. Also, the residuals and other statistics can be outputted. The source code of the Misalignment Estimator is given in Appendix A.

3.4

Simulations

In order to help develop the Misalignment Estimator program and test the model of the misalignment estimation method, a pseudo data set was created. This pseudo data set was used for all development and testing. This type of data set was used because of the lack of "system noise" and the ability to induce known misalignment errors within the test data for controlled testing.

3.4.1

Pseudo Data Set

The pseudo data set was created by collecting the image coordinates of 50 tie points between two overlapping digital photographs. The two overlapping photographs are shown in Figure 3.2.

58

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Figure 3.2 The Digital Photographs used to create the Pseudo Data set The interior orientation parameters, exterior orientation and the GPS exposure station coordinates were known for the photographs so ground coordinates could be calculated for the tie points. Using the tie points' ground coordinates to represent laser scanner hits on the ground, two strips of matching pseudo laser scanner points were created. The layout of the pseudo laser scanner data is shown in Figure 3.3.
I~---

Layout of Pseudo Laser Scanner Points
I
I
I ·

Location of Matching Points

2304130 2304125

8' 2304120
'-'

= 2304115 :c ... '" 0 z 2304110
2304105
2304100

bfI

_._---_.

· · · ·· · · · · · · · · · · · · · · · · · · · · · · · ·
,---

.--- .
--- -

.-- · --. ·

· ·· · · · · · · · · · ·
--

.
763720

763685

763690

763695

763700

763705

763710

763715

Easting (ft)

Figure 3.3 Layout of Pseudo Laser Scanner Points

59

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Each point had ground positions (Easting, Northing, and elevation), scanner positions in the air (Easting, N?rthing, and elevation) and scanner orientation (omega, phi and kappa). Using the ground and air positions and orientation data, range vectors in the x, y and z direction were calculated for each point in both strips. Applying a rotation to the calculated range vectors for each point induced the misalignment error. The induced misalignment errors were +3.00 degrees for omega, phi and kappa.

The misalignment program was able to converge within eight iterations. The results of the program are seen in Table 3.1. Table 3.1 Outputs and Results for Pseudo Data Set Misalignment error (Degrees) Omega Phi Kappa
3.0000 3.000(] 3.0000

Estimated Residuals of Ground Coordinates metres) Standard Deviations Iteration I AveraJ;!;e RMS Iteration 8 AveraJ;!;e RMS
0.2517 0.7031 0.5717

dx

0.32 0.09 -0.38

0.01 0.02 0.01

dx

0.00 0.00 0.00

0.00

dy dz

dy dz

O.O(] O.O(]

Clearly, the misalignment program successfully estimated the induced misalignment errors in the orientation angles, omega, phi and kappa. The estimated standard deviations of the misalignment angles show the estimated measure of dispersion. The residuals of the ground coordinates of the pseudo laser hits show that the program did adjust and indeed improve the ground coordinates residuals from an average 0.32 m in the X direction, 0.09 m in the Y direction, and -0.38 m in the Z direction in the first iteration, to no significant residuals in the eighth iteration. Root-mean-square (RMS) is the square root of the arithmetic mean of the squares of the deviation of observed values from their arithmetic mean. These values can be used as a means to check the precision ofthe mean

60

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

values. The smaller the root-mean-square value the more precise the mean is stated. The RMS errors for X, Y and Z after the eighth iteration are reported to be insignificant also, which indicates a successful estimation ofthe misalignment error.

With the success of the estimation of the misalignment errors, using the Misalignment Estimator program in the controlled assessment situation, the model and methodology are considered to be sound and prepared for testing using actual ALS data.

61

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4.0

Experimentation and Results

The previous chapter reviewed the theoretical considerations ofperfonning the misalignment estimation calibration of the ALS system and described testing the method and results of controlled testing. This chapter describes the use of the Misalignm ent program with the actual ALS data, located at the Oshawa airport data set. The associated data manipulation and interpolation is discussed. Angles ofmisalignment, between the IMU frame and the laser scanner frame, are produced and examined. Also, the accuracy and results of the misalignment estimation will be discussed.

4.1

Oshawa Airport Data Set

Data for this thesis was collected over the Oshawa Airport, Ontario, Canada. The scanned area includes two runways, adjoining taxiways and aircraft hangers. For this airport the terrain is generally flat, with minor undulations. The ALS data was collected in two strips, the first being flown from North-West to South-East at an altitude of approximately 1980 metres and the second being flown from the North-West to the South- West, at an altitude of approximately 1120 metres. The layout of the strips, the overlapping area and matched scanner points are illustrated in Figure 4.1.

62

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4866200 4866000 4865800 4865600 4865400 4865200 4865000 4864800 17668000
strip 1 flight

N
0

r t

h
n
g (m)

17668400

17668800

17669200

17669600

17670000

Easting (m)

11t11!1:~1
·

Strip 1 Strip2

·

Area of Overlaping Strips Area of Overlap used for Matching Points · Matched Points

r1 l:iJ

Figure 4.1 Layout of Laser Scanner Strips of Oshaw a Airport Each strip recorded approximately 600,000 laser returns. The scanner that was used is an Optech AL TM 3025 Airborne Laser Terrain Mapper. The scanner is supported by a Novatel Millennium GPS receiver and an Applanix - Optech custom position orientation system. The specifications of the AL TM 3025 are described in Table 4.1.

63

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Table 4.1 ATLM 3025 Specifications (Copyright 2002, Optech Incorporated) IALTM 3025 Sp_ecifications Operating altitude Range resolution Scan angle Swath width Scan frequency Horizontal accuracy ~levation accuracy !Position Orientation System Kips receiver 185 - 3,000 m nominal lcm Variable from 0 to +1- 20 degrees Variable from 0 to 0.72 x altitude o- 70 Hz, depending on scan angle e.g., 40 Hz at +1- 20 degrees) :Setter than 1/2,000 x altitude 15 cm at 1,200 m 35 em at 3,000 m IApplanix - Optech custom 1N0vatel Millennium

The navigation solution for the ATLM 3025 uses differential GPS data collected from a base station. The lever arm between the GPS and IMU would have been entered as a parameter in the processing software. The offsets between the IMU and the laser scanner have very minor effect on accuracy of the laser scanner data and, therefore, are not considered in the calibration.

The data from the test flight was delivered as three separate files, all in ASCII format. The first data file is the ALS point file that contains GPS tim e, the last pulse: Easting, Northing, elevation, intensity, the first pulse: Basting, Northing, elevation, intensity, and scanner angle (degrees) values of each observed point. The second data file is the GPS aircraft position file that contains GPS time, Basting, Northing, and elevation. The third data file is the IMUaircraft orientation file that contains the record counter, GPS tim e, Roll, Pitch and Heading.

64

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4.2

Data Fusion

The data set that was used to test the method purposed, was attainted in three separate files. One was the INS file that contained the attitude and heading data and the GPS tim e of each measurement record. Another one was the GPS file that contained the position data for the test data and the GPS time of each record. The final one was the ALS file that contained the ALS pulse records and the GPS time of each pulse. Because GPS data had previously been interpolated to the INS sampling rate by the POS software, the two data sets are easily matched by GPS time records. The ALS file, on the other hand, has a much higher sampling rate than the position and orientation data and interpolations of both the GPS positioning data and the INS data need to be com pleted for each ALS pulse record. It is very important to note that each ALS, INS, and GPS record includes a GPS time-tag. This GPS time-tag is the only reference that allows for the separate data sets to be interpolated into one data set.

4.2.1

Data Interpolation

In order to interpolate the position of the sensor from the GPS positioning data, linear
interpolation is used. This method is applied because the GPS positioning data proved to have a linear character over short (1 sec) time intervals, when the double difference of consecutive records was checked. Equation 4.1 is solved using the two GPS position records, which are acquired immediately before the ALS pulse time and immediately afterward.

65

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

X ALS = (X2 - XI) Y ALS = (Y2 - YI) ZALS = (Z2 - ZI)

* (ti I ~t) + XI

(Eq.4.1a) (Eq.4.1b) (Eq.4.1c)

* (tJ~t) + Y I

* (ti I ~t) + ZI

where X ALS , YALS and ZALS are the interpolated easting, northing and elevation position of the scanner when the ALS pulse was recorded.
XI, Y I and ZI are the positions measured immediately before the ALS pulse time. X2, Y2 and Z2 are the positions measured immediately after the ALS pulse time.
ti is the time of the ALS pulse minus the time of XI.
~t

is the difference in time between XI and X 2.

In order to interpolate the orientation angl es of the sensor from the INS orientation angles, a cubic spline interpolation is applied to the data set. Cubic' spline interpolating is used because the angle data proved to have a non-linear trend, when the double differences of consecutive records were checked. The approach of a cubic spline interpolator is to divide the data set into intervals and construct a different approxim ating polynomial for each interval. Figure 4.2 show an example of the POS data interval and an applied cubic spline interpolation.

66

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

1.825 1.82
+-------_._------

----~

. . . -----I . . . . ··------1

= <
~

!:lA)

1.815 1.81 1.805

-----.,-----.---------------1

·_----1
__ . _ _ _ _ _

!

1.8 .t------,-----,------~,---. 0
2

.-

--T--

.J

I

3
Time (s)

4

5

Figure 4.2 Example ofPOS Data Interval and Cubic Spline The interval of four records are chosen by using the two INS records whose times are directly before the ALS pulse time and the two records directly after. Generally four constants are used to ensure sufficient flexibility in the cubic spline. Equations 4.2 to 4.5 are used to interpolate the orientation angles at the time of the Lidar pulses.

(Eq.4.2) roi+1 - a o + al t i+1 + a2 t i+1 + a3 t i+1
_ 2 3

(Eq.4.3) (Eq.4.4)

ro i+3 = ao + al t i+3 + a2 t i+3 + a3 t i+3

2

' 3

(Eq.4.5)

where ro is the orientation angle
a o a) a2 and a3 are the variables of the polynomial

t is the time recorded of the angle measurement i denotes the record number within the chosen interval

67

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

This set of equations is solved in tenns of the variables a o at a2 a3. Once the variables of the cubic polynomial are known, then the time record of the ALS pulse is substituted into the polynomial and the interpolated orientation angle is calculated. This is com pleted for all three ofthe orientation angles for every ALS pulse record used within the data set.

4.2.2

Angle Conversion

Direct georeferencing of scanner data is accomplished by means ofGPS assisted INS. Special attention must be focused on the angular data delivered by the INS and on the transfonnations that must be applied to convert the data into a photogrammetry compatible coordinate system.

Today's inertial referencing systems are fixed with respect to a body coordinate frame that coincides with the principal axes of the aircraft. An INS detennines the heading, roll and pitch of an aircraft in the navigational coordinate frame. This coordinate frame and the angles, heading, roll and pitch (\If
~

8) do not comply with coordinate frame and

angles used in photogrammetry. Therefore, in order to use the INS data, it is necessary to apply transfonnations to bring the INS data into the correct coordinate frame and angle fonnat.

4.2.2.1

Coordinate Systems and Angles Used in Inertial Navigation

Inertial navigation is based on the continuous integration of the accelerations measured by the INS accelerometers. These accelerations are measured in a fixed body coordinate

68

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

system (b-system) as shown in Figure 4.3. The axes of this orthogonal frame are the INS sensor axes.

xb : along, postive forward yb: across, positive to the right Zb: vertical. postive down
body system (b.system)

Figure 4.3 The Fixed Body Coordinate System used in Navigation

The INS provides the roll, pitch and heading angles of the INS fixed body fram e with respect to the local level navigation coordinate frame (Hutton and Savina, 2000). The navigation coordinate system (n-system) differs from the fixed body coordinate system, where x D : northward, yD: eastward and ZD: vertical in the direction of the plumb line (Baumker and Heimes, 2001). This frame is the local level frame that is tangent to the

geoid over which the sensor is navigating (Hutton and Savina, 2000). In order for the INS accelerations to be in.tegrated into the navigation coordinate frame, a transformation is performed. This transformation is performed by a rotation matrix, which includes three rotations of the Euler angles (\jJ <I> 8).

69

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Roll (j)

Pitch e

Heading 1.J1
North xb

East

Figure 4.4 The Navigation Coordinate System and Euler Angles (\jJ,~, e)

These angles and the rotation matrix are continuously updated by means of gyro measurements recorded by the INS. The roll, pitch, and heading angles are used to transform a vector from the body coordinate frame into the navigation frame. The transformation matrix itself is calculated by three consecutive rotation matrices as seen in Equations 4.6a and 4.6b, and results in an orthogonal transformation matrix (Baumker and Heimes, 2001). -SIn\jJ COS\jJ OJ [COSO O· 0 I -sinO

o

o o

Si~O J.[~
cose

o
cos~ sin~

0

(Eq.4.6a) cos\jJ . cose cos\jJ . sinO . sin~ - sin\jJ . cos~ sin\jJ . sinO . sin~ + cOS\jJ . cos~ cosO ·sincj> cos\jJ . sine . cos~ + sin\jJ . sin~J sin\jJ . sinO· coscj> - cOS\jJ . sincj> cosO ·coscj> (Eq. 4.6b) The matrix of Equation 4.6 describes the Euler sequence of clockwise rotations required to bring the navigation frame into alignment with the body frame (Hutton and Savina,

C; =

sin\jJ· cosO [ -sinO

2000).

70

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4.2.2.2 Coordinate Systems and Angles Used in Photogrammetry
In comparison, the body coordinate system used in inertial navigation is similar to the image coordinate system (i-system) used in photogrammetry, which is referenced to the scanner sensor (Baumker and Heimes, 2001). Its x-axis points towards the direction of flight, y-axis points towards the left and the z-axis points upwards as seen in Figure 4.5.

Figure 4.5 Image Coordinate System

The photogrammetric angles; omega, phi, kappa (ro,cj>,K) are defined as the sequence of rotations that relate this frame to the object coordinate system. The Earth centered coordinate system (E-system) is fixed to the reference ellipsoid. Its origin is at the centre of the ellipsoid, with it x-axis pointing through the equator and the Greenwich meridian, its y-axis along the equator and the +90 degree meridian, and z-axis through the North Pole (Hutton and Savina, 2000) as seen in Figure 4.6.

71

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

ND~

_. _. t+z-alds

/

//:
I

~

+90defj1;Meridian

/
GreenWiCh!
____

/i
.-,'

,/ l
I

\ '"

\

M e r i d i i : J -"
Equator
~
f ,
:

I
CD

10
.... -,,-' 1
I

l--- -....... - - - ....
--.

\+X~XI~~" \"

I --/
1

+y~axis

Rotation Angles

~~/

/ .

Figure 4.6 Earth Centered Coordinate System and Rotation Angles (00, $, K) The matrix in Equation 4.7, describes the sequence of clockwise rotations required to bring the image frame into alignment with the Earth centered frame. cos$ COSK
C~

=
[

cosoo sinK + sinoo sin$ COSK sinoo sinK - cosoo sin$ COSK

- cos$ sinK sin$ ] cosoo COSK - sinoo sin$ sinK - sinoo cos$ (Eq. 4.7) sinoo COSK + cosoo sin$ sinK cosoo cos$

If the transformation matrix above is known, then the orientation angles: omega, phi, and kappa can be computed as follows (Baumker and Heimes, 200 I): $

=arctan

~C;3 +C;3
C33
(Eq.4.8)

c '3

00

-C2_3 =arctan __

-C'_2 K = arctan __ CII

72

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4.2.2.3 Conversion from Attitude and Heading Angles to Photogrammetric Angles Previously, the focus has been on the individual treatment of the rotation and transformation matrices and the corresponding rotation angles used in navigation and photogrammetry. Now the conversion from attitude and heading angles to photogrammetric angles will be examined.

In order to directly solve for omega, ·phi, and kappa from roll, pitch, and heading the following equation (4.9) must be applied (Hutton and Savina, 2000): (Eq.4.9) where C; (4) ,9,'11 ) is the direction cosine matrix defining the Euler sequence of clockwise rotations required to bring the navigation frame into alignment with the body frame, as seen in Equation 4.6.

where C; is the direction cosine matrix defining the relative orientation of the local level navigation coordinate frame with respect to the Earth centered coordinate frame and is defined in terms of the latitude (A) and longitude (I) as (Hutton and Savina, 2000): - sin A. cos 1 -sinl - cos A. cos -sinAsinl cosl - COSA sinl [
COSA.

l]
(Eq.4.10)

C;

=

o

- sin A

where

C;b

is the direction cosine matrix defining the relative orientation of the scanner

frame with respect to the INS fixed body frame (Hutton and Savina, 2000). C;bis defined in terms of the fixed mounting angles between the INS and the laser scanner (ex, e y,

e z).

73

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

co~y co~ z
C = sinE> x sinE> y cosez - cose x sinez [ sine x sinE>y cosez + sinE> x cosez
I

b

cosey sinez sinE>x sinE> y sinE>z + cosex cosez cosex sinE>y sinE>z - sinex cosez

-sinE> sinE>x

co~

]
y

cosex cosey

(Eq.4.11)
The mounting angles are constant because the INS is rigidly mounted to the scanner. These angles are determined once during installation (Hutton and Savina, 2000). The mounting angles bring the scanner frame into alignment with the INS fixed body frame. The succession of rotations is described as a clockwise rotation about the scanner frame z-axis by angle E>z, then a clockwise rotation about the once rotated scanner frame y-axis by angle E>y, and finally, a clockwise rotation about the twice rotated scanner frame xaxis by angle E>x (Hutton and Savina, 2000).

The final transformation matrix is C; , which is dependent upon the local mapping frame defined by the project (Hutton and Savina, 2000).

4.2.3 Data Matching
In order to use this method of misalignment angles estimation, points from one of the overlapping strips of laser scanner data must be matched with points corresponding to the same area in the second strip of laser scanner data.

In other methods of misalignment estimation, the laser scanner is re-sampled over a regular grid or a TIN is created to produce a surface, which eases the point matching process. For this project, the data was not resampled in order to maintain the integrity of

74

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

the data. Instead, the easting, northing and intensity data of the laser points were used to create an intensity image. A program called Point Cloud Data 3-D Adjuster and Analyzer (Fidera, 2003) was used to display the intensity images of the overlapping scanned areas. This program also had the ability to deliver the Easting and Northing position of selected data points.

The overlap area of the laser scanner data was divided into 16 blocks, each measuring 125 x 162.5 metres on the ground. Matching points were collected at the corners of runways and taxiways intersections and at the ends of runways painted markers. These locations were chosen because the vast difference in the reflectivity of grassland, reflective paint and asphalt made identification very easy. Figure 4.7 shows matching intensity images used to identify matching observed laser scanner points. Figure 4.8 gives an aerial photograph of the Oshawa airport, specifically the overlap area. These two figures clearly shows the detail available in the laser scanner intensity images.

Strip 1

Strip 2

Figure 4.7 Matching Intensity Images

75

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Figure 4.8 Aerial Photography of the Oshawa Airport

In all, 56 matching points were identified. The points are spread over the area of overlap and chosen for the distinct intensity changes clearly seen in both images. Figure 4.9 depicts the horizontal layout of the 56 points.

76

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Layout of Matched Points

4865800 4865700
0

0

.
cJl 0 0

ell

g
Z
0

4865600
0

v
0

0
0

0 0

.Iii

00

4865500 4865400 4865300 4865200 4865100 17668400

0

0

0

-= 1::

o

0

0

0

0

a

0

n

n

0 0
0

0 0

0
00

0

0

a 0

o

~

Va
0 0 0 0
0

17668600

17668800
Easting (m)

17669000

17669200

Figure 4.9 Layout of Matched Points Once the ALS points were matched and the INS and GPS data were interpolated to fit the matched points, the range vectors needed to be calculated. Each point had ground positions (Easting, Northing, and elevation), scanner positions in the air (Easting, Northing, and elevation) and scanner orientation (omega, phi and kappa). Using the ground and air positions and orientation data, range vectors in the x, y and z direction were calculated for each point in both strips.

A simple flow chart of the process matching the ALS points and of fusing the data sets into input files for the program Misalignment Estimator is shown in Figure 4.10.

77

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

I

ALS Point Data for Strip 1

I

I

ALS Point Data for Strip 2

I

Divide ALS points within overlapping region into 16 blocks. Display points as 16 Intensity Images

Divide ALS points within overlapping region into 16 blocks. Display points as 16 Intensity Images

Using the Intensity Images, manually Match ALS points from Strip 1 to points from Strip 2.

I
II

GPS Data for Strip 1

I

II
!

Matched ALS points from Strip 1

·
J

I

I

MatchedALS points from Strip 2

+

II
~

GPSDatafor Strip 2

I

I
I

Interpolate GPS Data for Strip 1 to fit Matched ALS points from Strip 1 Using Linear Interpolation

Interpolate GPS Data for Strip 2 to fit Matched ALS points from Strip 2 Using Linear Interpolation

IMU Data for Strip 1

/

I
/
IMU Data of Strip 2 Interpolate IMU Data for Strip 2 to fit Matched ALS pOints from Strip 2 Using Cubic Spline Interpolation

Interpolate IMU Data for Strip 1 to fit Matched ALS points from Strip 1 Using Cubic Spline Interpolation

Using ALS ground poSition GPS air positions IMU orientation data range vectors in the x, y and z direction were calculated for each point in strip 1

r

1
Using ALS ground position GPS air positions IMU orientation data Range Vectors in the x, y and z direction were calculated for each point in strip 2

(

Input File for Misalignment Estimator for Strip 1 Including: ALS ground position GPS air positions IMU orientation data Range Vectors

(

Input File for Misalignment Estimator for Strip 2 Including: ALS ground position GPS air positions IMU orientation data Range Vectors

)

Figure 4.10 Flowchart for Matchmg the ALS Pomts and Fusmg the Data Sets Process

78

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4.3

Experimentation

In order to explore the dynamics of the overlapping strips of ALS data from the Oshawa airport data set and the collected matched points, the program, Misalignment Estimator, was run with several different groupings of matched points. Input files are created for each grouping of matched points and a priori observation standard deviations of 5.78 cm are applied to the least squares adjustment. A standard deviation of 5.78 cm was chosen because it has been shown that the precision ofmanually measuring discrete points in a raster image is 0.289 pixels or laser footprint units in this case (Chapman, 2003). 20 cm is the size of the instantaneous laser footprint oflaser scan strip 2, multiplied by 0.289 equals 5.78 cm. The adjustment quickly converged within 6 iterations for all of the groupings of matched points. The four most significant points groupings are be reviewed. A brief description of the four significant groupings, summary of the outputted estimated misalignment angles, their accuracy, and the residuals and then the final results of the testing follows.

Point Grouping 1 Point grouping 1 includes all 56 matched points and its layout was shown in Figure 4.9. The points are spread across the overlap area to provide a thorough representation of points within the overlap. Table 4.2 shows the resulting misalignment angles and statistical information for running Misalignment Estimator with point grouping 1.

79

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Tabl e 42 0 utputs and Resu Its fior P' omt Groupmg 1
Estimated Residuals of Ground Coordinates metres} Misalignment error Standard (Degrees) Deviation Iteration 1 Average RMS Iteration 6 Average Roll -0.0178 0.0136 dx dx 0.03 2.44 2.90 dy Pitch dy -0.0829 0.0136 2.61 3.04 -0.00 Heading 0.0320 0.0435 dz dz 0.10 0.00 0.18
RMS

1.56 1.52 0.34

The estimated standard deviations of the misalignment angles show the estimated measure of dispersion and are of an acceptable size. The residuals of the laser hits' ground coordinates show that the program did adjust and, indeed, improved the ground coordinates residuals from an average 2.44 m in the X direction, 2.61 m in the Y direction in the first iteration to an average 0.03 m in the X direction, 0.00 m in the Y direction in the sixth iteration. The ground coordinates residuals in the Z direction were adjusted from 0.00 m to 0.10 m. Even though the resulting residual in the Z direction increases with the adjustment, this is an excepted result of the .adjustment because of the larger correction and reduction of the X and Y residuals and is due to the minimizing effect of the least square adjustment. Furthermore, due to the geometry of matched laser points, changes in the X and Y positions of points have strong influences on the Z components. Figure 4.11 depiCts the adjustment effect on the Z position of matched points. The RMS errors for X and Y direction after the sixth iteration are smaller than the RMS errors after the first iteration, which shows that the adjustm ent improved the residuals.

80

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

/ "''';:''',",,,,,,.

Laser Platform strip 1 ___ laser path before the adjusbnent laser path after the adjusbnent
w misalignment an&le

X and Z residuals before the adjusbnent X'and ~' residuals after the adjusbnent

Figure 4.11 Adjustment Affect on Z Residuals

Point Grouping 2 Point grouping 2 includes 50 of the original 56 points. The six points that were removed were found have gross outlying residuals due to the manual measurement/identification errors. This grouping is similar to point grouping 1 and the points are spread across the overlap area to provide a thorough representation of points within the overlap. Figure 4.12 shows the layout ofthe points of grouping 2.

81

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

c-------.--.--.-----

Layout of Point Grouping 2 4865800 4865700 S 4865600 '-" gp 4865500 ~ 4865400 4865300 4865200 4865100

T

+*t+

it-

-:\:-

LiT

++ ++ + +

Z

++ + +-* ~+ ++'*+ ofiFT+ +++++

17668400

17668600

17668800 Easting (m)

17669000

17669200

Figure 4.12 Layout of Point Grouping 2 Table 4.3 shows the resulting misalignment angles and statistical information of running Misalignment Estimator with grouping 2. Table 4.3 Outputs and Results for Point Grouping 2
Residuals of Ground Coordinates metres) Estimated Misalignment error Standard (Degrees) Deviation Iteration 1 AveraRe RMS Iteration 6 Average RMS -0_0075 0.0140 0.03 1.16 !Roll dx 2.29 1.15 dx dy dy -0.00 1.08 lPitch -0.0870 0.0140 2.72 1.12 !Heading -0.0531 dz 0.08 0.28 0.0451 dz -0.01 0.16

The estimated standard deviations of the misalignment angles are of acceptable size. The residuals of the laser hits' ground coordinates show that the program did adjust and, indeed, improved the ground coordinates residuals from an average 2.29 m in the X
direction, and 2.72 m in the Y direction in the first iteration to an average 0.03 m in the X

direction and -0.00 m in the Y direction in the sixth iteration. The ground coordinates residuals in the Z direction were adjusted from 0.01 m to 0.08 m. As stated for point grouping 1, this is an excepted result of the adjustment. The RMS errors for X and Y 82

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

direction after the sixth iteration are similar or smaller than the RMS errors after the first iteration, which shows that the adjustment improved the residuals and that the ground point locations of matching points are closer than in the first point grouping. Overall, the most evident change in the results of this grouping is found in the estimated roll misalignment error. This could be a result of rem oving points that heavily affect the roll solution.

Point Grouping 3 Point grouping 3 includes 35 of the original 56 points. The 21 points that were rem oved were found to have outlying residuals. This grouping is similar to point grouping 1 in that it has points that are spreading across the overlap area to provide a thorough representation of points within the overlap region. Figure 4.13 shows the layout of the points of grouping 3.
~-------------------------------------------------------

Layout of Point Grouping 3 4865800 4865700

8' gp
'-'

'"
~

4865600 4865500 4865300 4865200 4865100 17668400
"

,.. )I(~X

)I(

x
x~

-

~ 4865400

xxxx

~

}{)(xx x xx ~x 'x

Xx--

17668600

17668800 Easting (m)

17669000

17669200

____________________ ~~_~ ________ J

Figure 4.13 Layout of Point Grouping 3

83

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Table 4.4 shows the resulting misalignment angles and statistical infonnation of running Misalignment Estimator with grouping 3.

Table 4.4 Outputs and Results for Point Grouping 3 Residuals of Ground Coordinates metres) Estimated lMisalignment error Standard (Degrees) Deviation Iteration 1 Average RMS Iteration 6 Average dx 0.03 -0.0068 0.0154 dx lRoll 2.26 1.010 dy Pitch dy -0.01 -0.0883 0.0154 2.79 0.908 Heading -0.0404 0.0503 dz 0.12 dz 0.00 0.171

RMS
1.03 0.86 0.27

The estimated standard deviations of the misalignment angles are of acceptable size. The residuals of the laser hits' ground coordinates show that the program did adjust and, indeed, improved the ground coordinates residuals from an average 2.26 m in the X direction, and 2.79 m in the Y direction in the first iteration to an average 0.03 m in the X direction, and -0.01 m in the Y direction in the sixth iteration. The ground coordinates residuals in the Z direction were adjusted from O.OOm to 0.12 m. As stated for point grouping 1, this is an excepted result of the adjustment. The RMS errors for X and Y direction after the sixth iteration are similar or smaller than the RMS errors after the first iteration, which shows that the adjustment improved the residuals and that the ground point locations of matching points are closer than in the first point grouping. Overall, the most evident change in the results of this grouping is again found in the estim ated roll misalignment error. This could be a result ofremoving points that heavily affect the roll solution.

84

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Point Grouping 4 Point Grouping 4 is made of20 matched points that are found in the centre of the overlapping area. This grouping is chosen because of the high density ofmatched points within a relatively small area, 100 x 500 metres. The points were not filtered for outliers. Figure 4.14 show the layout of point grouping 4.

Layout of Point Grouping 4 4865700 - , - - - - - - - - - - - - - - - - - - - - , x 4865600 + - - - - - - - - - - - - - - - - - - - 1

5 4865500 + - - - - - - - - - - - - - - - - - - .§ 4865400 +----------x~x=---~..,,~·,---x-------1
i3:.;.:x
~

...--

4865300 4865200

---..P----~--------cI

x~x
17668600 17668800 Easting (m) 17669000 17669200

4865100 - t - - - - - , - - - - - - , - - - - - - - ; - - - - - l 17668400

Figure 4.14 Layout of Point Grouping 4

Table 4.5 shows the resulting misalignment angles and statistical information of running Misalignment Estimator with grouping 4.

Table 4.5 Outputs and Results for Point Grouping 4
Estimated Residuals of Ground Coordinates metres) Misalignment error Standard (Degrees) Deviation Iteration 1 Average RMS Iteration 6 Average RMS 0.00 1.72 dx -0.0202 0.0177 dx 8.26 1.010 ~oII dy -0.00 1.45 dy -0.0755 0.0177 ~itch 10.03 0.941 dz 0.04 0.09 0.0859 ~eading -0.0622 dz 0.49 0.467

85

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

The estimated standard deviations of the misalignment angles are larger than for the other groupings but still of acceptable size. The residuals of the laser hits' ground coordinates show that the program did adjust and, indeed, improved the ground coordinates residuals from an average 8.26 m in the X direction, 10.03 m in the Y direction, and 0.49m in the Z direction in the first iteration to an average 0.00 m in the X direction, -0.00 m in the Y direction and 0.04 m in the Z direction in the sixth iteration. These are clearly large improvements but it probably says more abut the errors in the original ground coordinates of the laser hits. The RMS errors for X and Y direction after the sixth iteration are larger than the RMS errors after the first iteration. This shows that the adjustm ent did not actually improve the residuals. While the estimated misalignment angles are very similar to the angles of the first grouping, the accuracy of the residuals stand out as very poor and do not support the solution of the adjustment. This could be the result of having points only from the centre of the overlap.

4.3.1

Estimation and Accuracy of Misalignment Angles

In order to determine which grouping is the best representation of the Oshawa airport data set, the outputs and the statistical information must be examined. To begin with, the laser hit ground coordinate residuals for the four groupings are examined. Compared to the other groupings, Point Grouping 1 has the most consistent improvement in the RMS errors of the ground coordinate residuals. This means that the precision of the ground coordinate residuals was greatly increased by the adjustment. The improvement of the residuals of Point Grouping 1 can be seen in Figures 4.15 to 4.18. By com paring Figures 4.15 and 4.16, the improvement of the X and Y residuals is very evident. By comparing

86

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Figures 4.17 and 4.18 it is evident that even though the average of the Z residuals was increased, the overall effect on the Z residuals is minimal.

Point Grouping 1 and X - Y Residuals
(first iteration, scaled by a factor of 20)

j ~ a~
1.1 · 11=--+
y

I

I

'"
.'!!
x

~II.I

11. I l~ TIJ:~ Ll

J!

11k

-

~

Figure 4.15 Point Grouping I and X - Y Residuals of the First Iteration

87

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

,-------------------~--

---------------

Point Grouping 1 and X - Y Residuals
(sixth iteration, scaled by a factor of 20)

-k~ '---1'
,
"'11- ~

-~~--

r
III

--~
~-,

~

-et-

.,.

It

.. ,

~

U

~

~-----

11,-:;:'~ ~ tt ~~:.
x

-.:6
-=:§..J.

--

-~

Figure 4.16 Point Grouping 1 and X - Y Residuals of the Sixth Iteration
Point Grouping 1 and Z Residuals
(first iteration, scaled by a factor of 50)

T

·

T

f'
T

T

I f
Z

. 1t\

,...
T

·

IT

TTT

W'

... ....
. . W'
W'

+ ..

--

..

....
+

A .. A

.. ......
·
A

...

....

... ...
~

.. -i ...

~

. ...

~~-----------~-

~----

Figure 4.17 Point Grouping 1 and Z Residuals of the First Iteration

88

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

- - - - - --------

-------- -- ----- - -------------- ------

--~

---~-----------;

Point Grouping 1 and Z Residuals
(sixth Iteration, scaled by a factor of 50)

f----l-r--

~----I---~---~~--------------------.~--~

1'-... . .
.....

_\

I f
Z

I-I----;;;;---------- _______________________.1;=1_1_ _--1
TTy

I-----------------~-

-

..

-------- -..-.----. .- - - - - & - - - - - - - - . . . A. ...

4-

~-------------------- ________ --=_&-=:."'-'.=----________-"'.l."'--- A _ _ _
~----------- --------'y"--------".'-- ------------~----

a. .....

..:"''''

...--

_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _----1

Figure 4.18 Point Grouping 1 and Z Residuals of the Sixth Iteration

Of the different point groupings, Point Grouping 1 has the smallest estimated standard deviations for the estimated misalignment angles. Because Point Grouping 1's estimated standard deviations are the smallest, it shows that the dispersion of the data for the misalignment angles is the least of the point groupings.

With the data set provided by Optech, the in-lab calibrated misalignment angles were provided for roll and pitch. The magnitude to theses angles are roll: 0.0280 degrees, and pitch: 0.0810 degrees. The magnitude of the estimated angles for Point Grouping 1 in roll and pitch are 0.0178 and 0.0829 degrees respectively. These are closer to the given calibrated angles than any of the other groupings. The in-lab calibrated misalignment angles were tested to find the estimated standard deviations for roll and pitch and to

89

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

examine the residuals of the ground coordinates as a result of these angles. The results of this testing is shown in Table 4.6 Table 4.6 Estimated Standard Deviations and Residuals for In-lab Calibration Angles
Estimated Standard Deviation [Roll !Pitch Residuals (m)

I
I

0.0136 0.0136

dx dy

Average RMS 0.03 1.51 -0.00 1.52

Comparing the average residuals of the ground coordinates of the matched laser points and the RMS of the residuals of both the in-lab and post-mission estimated misalignment errors for roll and pitch, shows that both sets of angles have the sam e overall effect on the point grouping. The estimated standard deviation ofthe in-lab calibrated misalignment errors was found to be very similar to those of the post-mission estimated misalignment errors. This comparison reveals that the post-mission estimated misalignment error angles are just as reliable as the in-lab calibration angles.

Overall, Point Grouping 1 proves to provide the best representation of the Oshawa airport data set. This point grouping performed well because of the large area of coverage and large number of points. The estimated misalignment errors of the Oshawa airport data set are shown in Table 4. 7 Table 4.7 Estimated Misalignment Error Degrees Minutes of Arc Roll Pitch
Headin~

-0.0178 -0.0829 0.0320

-1.07

-4.98 1.92

90

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Summary, Conclusions and Recommendations 4.4 Summary

An Airborne Laser Scanning system operates by locating laser hits separately from all others. Locating the laser hits involves knowing precisely for each laser shot, the aircraft position (GPS), the attitude of the aircraft (IMU), the scanner angle when the laser pulse left the sensor, and the slant range to the ground for that pulse. One of the most crucial errors in ALS systems is the angular misalignment between the scanner and the IMU, which is called the misalignment error. This error must be dealt with before an ALS system can produce accurate data.

The purpose of this research has been to make available and test a method of estimating the small misalignment angles between the laser scanner and the IMU. This method is semi-automated, requires no ground control and does not re-sample the ALS data in order to match the overlapping strips of data.

A computer program called Misalignment Estimator was developed to estimate the misalignment angles using a least squares adjustment. The method was tested using a data set of the Oshawa airport provided by Optech. The adjustment's outputs provide a means to evaluate the grouping of matched ALS points and the precision of the estimated misalignment angles.

91

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4.5

Conclusions

Based on the investigation completed and the results obtained from the Misalignment Estimator program, the following conclusions can be made: · The developed method of estimating the misalignment angles is based on the differences observed between two overlapping ALS data strips. The results of applying this method, both in the simulation and real data sets, are convincing. · The proposed method for integrating the GPS data set and ALS data set and the purposed method for integrating the IMU data set and ALS data set, in order to be used as inputs for the Misalignment Estimator program, have been continned to be excellent methods of data integration. · The program, Misalignment Estimator developed to provide a means of estimating the misalignment error of an ALS system after the system has been installed in an aircraft, does succeed and provides acceptable estimates of misalignment errors. · Of the point groupings used as input for the Misalignment Estimator program, Point Grouping 1 provided the best representation ofthe Oshawa airport ALS data set. · For the Oshawa airport data set, the estimated roll misalignment error was found to be -0.0178 degrees, the estimated pitch misalignment error was found to be -0.0829 degrees, and the estimated heading misalignment error was found to 0.0320 degrees. Furthennore, the roll and pitch error estimates were found to be as reliable as the in-lab misalignment calibration error angles provided by Optech.

92

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

4.6

Recommendations

The following recommendations are proposed for future studies: · The residuals of the measured laser hits' ground coordinates suggest that matching of the laser points of the overlapping strips could be improved. Furthermore, the proposed method of estimating the misalignment angles of ALS systems might be improved upon if a better point matching procedure was developed. · Of the point groupings, Point Grouping 1, the group with most points over the largest area, was found to represent the ALS data the best. The estim ation of the misalignment angles might be improved if a larger area of overlap and more matching points are used. · The scope of this thesis was to only test the Misalignm ent Estimator program using a single simulation and a single actual ALS data set. Further testing with other data sets would confirm the ability of the program and the validity of the methodology. · The program, Misalignment Estimator is designed based on the differences observed between two overlapping ALS data strips. The program may be able to provide better estimations of the misalignment angles if the program was able to utilize three or more overlapping strips of ALS data.
· The program, Misalignment Estimator, is designed only to model the

misalignment angle errors, the program could be expanded to include modeling of other ALS system errors such as scan angle errors or encoder latency errors in order to provide a more robust calibration of the ALS system.

93

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

References

Anderson, J.M, and Mikhail, E.M., 1998, Surveying: Theory and Practice. WCBlMcGraw Hill. Axelsson, P. 2000. DEMGenerationfrom Laser Scanner Data using Adaptive TIN Models. International Archives of Photogram me try and Remote Sensing. Vol. XXXIII, Part B4, Amsterdam. pp. 110 - 117. Baltsavias, E. P., 1999. Airborne Laser Scanning:Basic Relations and Formulas. ISPRS Journal of Photogram me try & Remote Sensing. Vol. 54, pp. 199 - 214. Baurnker, M. and Heimes, F.J., 2001. New Calibration and Computing Methodfor Direct Georeferencing ofImage and Scanner Data Using the Position and Angular Data ofa Hybrid Inertial Navigation System. FH Bochum University of Applied Science. Burrough, P., McDonnell, R., 1998. Principles of Geographical Infonnation Systems. Oxford University Press, New York. Chapman, M.A., 2003 Softcopy versus Analytical Photogrammetry: A Coming ofAge, manuscript under preparation. Cosandier, D. 1999. Generating a Digital Elevation Model and Orthomosaicfrom Push broom Imagery. Ph.D. Thesis, University of Calgary, Department of Geomatics Engineering. Calgary, Alberta. EI-Rabbany, A. 2000. CVL650 Physical and Satellite Geodesy Course Notes. Ryerson Polytechnic University, Department of Civil Engineering. Toronto, Ontario. EI-Sheimy, N. 1996. The Development of VISTA T - A Mobile Survey System For GIS Applications. Ph.D. Thesis, UCGE Reports. No. 20101. Calgary, Alberta. Fidera, A., 2003. Point Cloud Data 3-D Adjuster and Analyzer. Graduate Project. Ryerson University, Toronto, Ontario. Hutton,1. and Savina, T. 2000. Computation ofPhi Omega Kappafrom Roll Pitch and Heading. Technical Note, Applanix Corporation, Markham, Ontario. Hutton, J., Savina, T., and Lithopoulos, E. circa 1997. Photogrammetric Applications of Applanix's Position and Orientation System (POS). Applanix Corporation, Markham, Ontario. Irish, 1. and Lillycrop, W.J. 1999. Scanning Laser Mapping of the Coastal Zone: The SHOALS system. ISPRS Journal of Photogram metry & Remote Sensing. Vol. 54, pp. 123 - 129.

94

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Lefsky, M., Cohen, W., Acker, S., Parker, G., Spies, T., and Harding, D. 1999. Lidar Remote Sensing of the Canopy Structure and Biophysical Properties ofDouglas-Fir Western Hemlock Forests. Remote Sensing Environment. Vol. 70~ pp. 339 - 361. Lima, K., Treitza, P., Wulderb, M., St-Ongec, B., and Floodd, M. 2003. Lidar Remote Sensing ofForest Structure. Progress in Physical Geography. Vol. 27, 1. pp. 88 -106. Lohmann, P. 2000. Approaches to the Filtering ofLaser Scanner Data. International Archives of Photogram metry and Remote Sensing. Vol. XXXIII, Part B, Amsterdam. pp. 540 - 547. Mikhail, E.M. 1976. Observations and Least Squares. Dun-Donnelley. pp. 101-120. Morin, K. 2003. Calibration ofAirborne Laser Scanners. M. Sc. Thesis, UCGE Report No. 20179. Morin, K., EI-Sheimy, N. circa 2002. A Comparison ofAirborne Laser Scanning Data Adjustment Methods. Department of Geomatics Engineering, The University of Calgary Canada. Smith, R. 2002. Calibration Procedures for the Optech ALTM Presented to the Digital Camera and LIDAR Product Characterization Workshop. Stennis Space Flight Center Sun, H. 1994. GPSIINS Integrationfor Airborne Applications. Ph.D. Thesis, UCGE Reports. No. 20069. Calgary, Alberta. Toth, C.K. 2002. Calibrating Airborne Lidar Systems. Proceeding ofISPRS Commission II Symposium, Integrated Systems for Spatial Data Production, Custodian and Decision Support. Vol. 35, part 2, pp. 475-480. Wehr, A., Lohr, U. 1999; Airborne Laser Scanning-An Introduction and Overview. ISPRS Journal of Photogram metry & Remote Sensing. Vol. 54, pp. 68 - 82.

95

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Appendix A
Source code for Misalignment Estimator program.

Form
Sub commandl_clickO Dim filenumin 1 As Integer Dim filenumin2 As Integer Dim filenumout As Integer Dim filepath As String, input file As String Dim outputfile As String Dim counter As Integer Dim counterl As Integer Dim counter2 As Integer Dim ii As Integer Dim I As Integer Dim iter As Integer Dim pointnum As Integer Dim intensity As Integer Dim ygrd As Double Dim xgrd As Double Dim zgrd As Double Dim yair As Double Dim xair As Double Dim zair As Double Dim y 1grd As Double Dim xlgrd As Double Dim zlgrd As Double Dim ylair As Double Dim xlair As Double Dim zlair As Double Dim y2grd As Double Dim x2grd As Double Dim z2grd As Double Dim y2air As Double Dim x2air As Double Dim z2air As Double

96

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Dim omega As Double Dim phi As Double Dim kappa As Double Dim omega I As Double Dim phil As Double Dim kappal As Double Dim omega2 As Double Dim phi2 As Double Dim kappa2 As Double Dim pi As Double Dim strip I arrO As Double Dim strip2arrO As Double Dim xrange As Double Dim yrange As Double Dim zrange As Double Dim xrange 1 As Double Dim yrange I As Double Dim zrangel As Double Dim xrange2 As Double Dim yrange2 As Double Dim zrange2 As Double

Dim a As Double 'constants ofINS Rotation Matrix Dim b As Double Dim c As Double Dim d As Double Dim e As Double Dim f As Double Dim g As Double Dim h As Double Dim i As Double Dim Al As Double Dim bI As Double Dim cI As Double Dim dl As Double Dim el As Double Dim fl As Double

97

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Dim g 1 As Double Dim h I As Double Dim il As Double Dim A2 As Double Dim b2 As Double Dim c2 As Double Dim d2 As Double Dim e2 As Double Dim f2 As Double Dim g2 As Double Dim h2 As Double Dim i2 As Double Dim rOo, rOI, r02, rIO, rll, r12, r20, r21, r22 As Double

Dim xcomb As Double 'reps [xgrd - (a*xrange + b*yrange + c*zrange) - xair] Dim ycomb As Double Dim zcomb As Double Dim xcomb I As Double Dim ycombl As Double Dim zcomb I As Double Dim xcomb2 As Double Dim ycomb2 As Double Dim zcomb2 As Double Dim domega As Double 'reps delta omega, delta phi and delta kappa Dim dphi As Double Dim dkappa As Double Dim dw As Double 'omega for estimation and iteration Dim dp As Double Dim dk As Double Dim w_ arrO As Double Dim a_arrO As Double 'the design matrix Dim n_arr(3, 3) As Double 'from TransposeATA_Arrays! Dim u_arr(3) As Double Dim x_arr(3) As Double Dim dumw, dump, dumk As Double Dim dumw2, dump2, dumk2 As Double

98

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Dim sumk, angk As Double

'open strip #1 input file filenuminl = FreeFile filepath = App.Path inputfile = Textl.Text Open filepath + "\" + inputfile For Input As filenuminl Input #filenuminl, dumw, dump, dumk

counterl = 0 Do Input #filenuminl, pointnum, xgrd, ygrd, zgrd, xair, yair, zair, omega, phi, kappa, xrange, yrange, zrange, intensity counterl

= counterl + 1

Loop While Not EOF(filenuminl) Close #filenuminl ReDim striplarr{counterl - I, 12) Open filepath + "\" + inputfile For Input As filenuminl Input #filenuminl, dumw, dump, dumk For i = 0 To counterl - 1 Input #filenuminl, pointnum, xgrd, ygrd, zgrd, xair, yair, zair, omega, phi, kappa, xrange, yrange, zrange, intensity striplarr(i, 0) = pointnum strip 1arr(i, I) = xgrd striplarr(i, 2) = ygrd striplarr(i, 3) = zgrd striplarr(i, 4) = xair strip 1arr(i, 5) = yair striplarr(i, 6) = zair strip 1arr(i, 7) = om ega strip 1arr(i, 8) = phi striplarr(i, 9) = kappa strip 1arr(i, 10) = xrange striplarr(i, 11) = yrange

99

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

striplarr(i, 12) = zrange Next i Close #filenuminl 'open strip #2 input file filenumin2 = FreeFile filepath = App.Path inputfile = Text2.Text Open filepath + U\U + inputfile For Input As filenum in2 Input #filenumin2, dumw2, dump2, dumk2 counter2 = 0 Do Input #filenum in2, pointnum, xgrd, ygrd, zgrd, xair, yair, zair, omega, phi, kappa, xrange, yrange, zrange, intensity counter2 = counter2 + 1 Loop While Not EOF(filenumin2) Close #filenumin2 ReDim strip2arr(counter2 - 1, 12) Open filepath + U\U + inputfile For Input As filenum in2 Input #filenumin2, dumw2, dump2, dumk2 For i = 0 To counter2 - 1 Input #filenumin2, pointnum, xgrd, ygrd, zgrd, xair, yair, zair, omega, phi, kappa, xrange, yrange, zrange, intensity strip2arr(i, 0) = pointnum strip2arr(i, 1) = xgrd strip2arr(i, 2) = ygrd strip2arr(i, 3) = zgrd strip2arr(i, 4) = xair strip2arr(i, 5) = yair strip2arr(i, 6) = zair strip2arr(i, 7) = om ega strip2arr(i, 8) = phi strip2arr(i, 9) = kappa

100

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

strip2arr(i, 10) = xrange strip2arr(i, 11) = yrange strip2arr(i, 12) = zrange Next i

Close #filenumin2

I
I t
f i

i

I

filenumout = FreeFile filepath = App.Path outputfile = Text3.Text

1
I

,

Open filepath + "\" + outputfile For Output As filenum out pi = Atn(1)

---------------------------------------------

*4

,--------------------------------------------dw = 0# * pi / 180 dp = 0# * pi! 180 dk = 0# * pi / 180 ReDim a_ arr(3 * (counterl), 3) As Double ReDim w_arr(3 * (counterl)) As Double For iter = 0 To 5 Print #filenumout, iter 'Calculating Boresight Angles

I

I
1
1
i

f

i
I

1

'****** ****** ****** ****** ******
, below is within iteration 'sumk= 0 'rotation matrix for misalignment estimates rOo = Cos(dp) * Cos(dk) rOl = -Cos(dp) * Sin(dk) r02 = Sin(dp) rIO = (Cos(dw) * Sin(dk» + (Sin(dw) * Sin(dp) * Cos(dk» rll = (Cos(dw) * Cos(dk)) - (Sin(dw) * Sin(dp) * Sin(dk» rl2 = -Sin(dw) * Cos(dp) r20 = (Sin(dw) * Sin(dk)) - (Cos(dw) * Sin(dp) * Cos(dk) r21 = (Sin(dw) * Cos(dk») + (Cos(dw) * Sin(dp) * Sin(dk») r22 = Cos(dw) * Cos(dp)

I t

101

I

. t

J.;j

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

For ii = 0 To counterl - I xlgrd = striplarr(ii, I) ylgrd = striplarr(ii, 2) zlgrd = strip I arr(ii, 3) xlair = striplarr(ii, 4) ylair= striplarr(ii, 5) zlair= striplarr(ii, 6) omegal = strip 1arr(ii, 7) * pi /180 'going from deg to rad! phi I = strip I arr( ii, 8) * pi / 180 kappal = strip I arr(ii, 9) * pi /180 xrangel = striplarr(ii, 10) yrangel = striplarr(ii, II) zrangel = striplarr(ii, 12) 'constants of INS Rotation Matrix using Omega Phi Kappa 'AI = Cos(phil) * Cos(kappal) 'b I = -Cos(phi I) * Sin(kappa I) 'cl = Sin(phi I) 'dl = (Cos(omegal) * Sin(kappal» + (Sin(omegal) * Sin(phil) * Cos(kappal» 'el = (Cos(omegal) * Cos(kappal» - (Sin(omegal) * Sin(phil) * Sin(kappal) 'fl = -Sineomega I) * Cos (Phi I ) 'gl = (Sin(omegal) * Sin(kappal» - (Cos(omegal) * Sin(phil) * Cos(kappal» 'hI = (Sin(omegal) * Cos(kappal» + (Cos(omegal) * Sin(phil) * Sin(kappal» 'il = Cos(omegal) * Cos(Phil) 'constants of INS Rotation Matrix using Roll Pitch Heading Al = Cos(Phil) * Cos(kappal) bl = (Sin(omegal) * Sin(phil) * Cos(kappal» - (Cos(omegal) * Sin(kappal» cl = (Cos(omegal) * Sin(phil) * Cos(kappal» + (Sin(omegal) * Sin(kappal» d I = Cos(phil) * Sin(kappa I) el = (Sin(omegal) * Sin(phil) * Sin(kappal» + (Cos(omegal) * Cos(kappal» fl = (Cos(omegal) * Sin(phil) * Sin(kappal» - (Sin(omegal) * Cos(kappal» g I = -Sin(phi I ) hI = Sin(omegal) * Cos(Phil) il = Cos(omegal) * Cos(Phil) xrange = rOo * xrange I + rO I * yrange 1 + r02 * zrange 1 yrange = rIO * xrangel + rll * yrangel + rI2 * zrangel zrange = r20 * xrange 1 + r21 * yrange 1 + r22 * zrange 1 'xcomb gives the transformed coordinates for strip I

102

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

xcombl = (AI * xrange + bl * yrange + cl * zrange) ycom bl = (dl * xrange + el * yrange + fl * zrange) zcom b I = (g I * xrange + hI * yrange + i I * zrange xcombl = xcombl + xlair ycom b I = ycomb 1 + y 1air zcombl = zcombl + zlair x2grd = strip2arr(ii, 1) y2grd = strip2arr(ii, 2) z2grd = strip2arr(ii, 3) x2air = strip2arr(ii, 4) y2air = strip2arr(ii, 5) z2air = strip2arr(ii, 6) omega2 = strip2arr(ii, 7) * pi /180 phi2 = strip2arr(ii, 8) * pi /180 kappa2 = strip2arr(ii, 9) * pi / 180 xrange2 = strip2arr(ii, 10) yrange2 = strip2arr(ii, 11) zrange2 = strip2arr(ii, 12)

'going from deg to rad!

'constants of INS Rotation Matrix using Omega Phi Kappa , A2 = Cos(Phi2) * Cos(kappa2) 'b2 = -Cos(phi2) * Sin(kappa2) , c2 = Sin(phi2) 'd2 = (Cos(omega2) * Sin(kappa2» + (Sin(omega2) * Sin(phi2) * Cos(kappa2» 'e2 = (Cos(omega2) * Cos(kappa2» - (Sin(omega2) * Sin(phi2) * Sin(kappa2» , f2 = -Sin( omega2) * Cos(Phi2) 'g2 = (Sin(omega2) * Sin(kappa2» - (Cos(omega2) * Sin(phi2) * Cos(kappa2» 'h2 = (Sin(omega2) * Cos(kappa2» + (Cos(omega2) * Sin(phi2) * Sin(kappa2» 'i2 = Cos(omega2) * Cos(Phi2) 'constants of INS Rotation Matrix using Roll Pitch Heading A2 = Cos(phi2) * Cos(kappa2) b2 = (Sin(omega2) * Sin(phi2) * Cos(kappa2» - (Cos(omega2) * Sin(kappa2» c2 = (Cos(omega2) * Sin(phi2) * Cos(kappa2» + (Sin(omega2) * Sin(kappa2» d2 = Cos(phi2) * Sin(kappa2) e2 = (Sin(om ega2) * Sin(phi2) * Sin(kappa2» + (Cos(omega2) * Cos(kappa2» f2 = (Cos(omega2) * Sin(phi2) * Sin(kappa2» - (Sin(omega2) * Cos(kappa2» g2 = -Sin(phi2) h2 = Sin(om ega2) * Cos(phi2) i2 = Cos( om ega2) * Cos(Phi2)

103

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

xrange3 = rOo * xrange2 + rO 1 * yrange2 + r02 * zrange2 yrange3 = rIO * xrange2 + rII * yrange2 + rl2 * zrange2 zrange3 = r20 * xrange2 + r21 * yrange2 + r22 * zrange2 xcomb2 gives the transformed coordinates for strip 2 xcomb2 = (A2 * xrange3 + b2 * yrange3 + c2 * zrange3) + x2air ycomb2 = (d2 * xrange3 + e2 * yrange3 + f2 * zrange3) + y2air zeom b2 = (g2 * xrange3 + h2 * yrange3 + i2 * zrange3) + z2air
I

xeom b = xeomb 1 - xeomb2 yeom b = yeomb 1 - yeomb2 zcomb = zeombI - zcomb2

l=ii*3 'Partial derivatives a_arr ( ) 'd(omega) a_arr(l, 0) = bI * «-Sin(dw) * Sin(dk) + Cos(dw) * Sin(dp) * Cos(dk» * xrangel + (-Sin(dw) * Cos(dk) - Cos(dw) * Sin(dp) * Sin(dk» * yrangel - (Cos(dw) * Cos(dp» * zrangeI) + el * «Cos(dw) * Sin(dk) + Sin(dw) * Sin(dp) * Cos(dk» * xrangel + (Cos(dw) * Cos(dk) - Sin(dw) * Sin(dp) * Sin(dk» * yrangel - (Sin(dw) * Cos(dp» * zrangeI) - (b2 * «-Sin(dw) * Sin(dk) + Cos(dw) * Sin(dp) * Cos(dk» * xrange2 + (Sin(dw) * Cos(dk) - Cos(dw) * Sin(dp) * Sin(dk» * yrange2 - (Cos(dw) * Cos(dp» * zrange2) + e2 * «Cos(dw) * Sin(dk) + Sin(dw) * Sin(dp) * Cos(dk» * xrange2 + (Cos(dw) * Cos(dk) - Sin(dw) * Sin(dp) * Sin(dk» * yrange2 - (Sin(dw) * Cos(dp» * zrange2» a_arr(l + 1,0) = el * «-Sin(dw) * Sin(dk) + Cos(dw) * Sin(dp) * Cos(dk» * xrangel + (-Sin(dw) * Cos(dk}- Cos(dw) * Sin(dp) * Sin(dk» * yrangel - (Cos(dw) * Cos(dp» * zrangel) + f1 * «Cos(dw) * Sin(dk) + Sin(dw) * Sin(dp) * Cos(dk» * xrangel + (Cos(dw) * Cos(dk) - Sin(dw) * Sin(dp) * Sin(dk» * yrangel - (Sin(dw) * Cos(dp» * zrangel) - (e2 * «-Sin(dw) * Sin(dk) + Cos(dw) * Sin(dp) * Cos(dk» * xrange2 + (-Sin(dw) * Cos(dk) - Cos(dw) * Sin(dp) * Sin(dk» * yrange2 - (Cos(dw) * Cos(dp» * zrange2) + f2 * «Cos(dw) * Sin(dk) + Sin(dw) * Sin(dp) * Cos(dk» * xrange2 + (Cos(dw) * Cos(dk) - Sin(dw) * Sin(dp) * Sin(dk» * yrange2 - (Sin(dw) * Cos(dp» * zrange2» a_arr(l + 2,0) = hI '" «-Sin(dw) '" Sin(dk) + Cos(dw) '" Sin(dp) '" Cos(dk)) '" xrangel + (-Sin(dw) * Cos(dk) - Cos(dw) * Sin(dp) * Sin(dk» * yrangel - (Cos(dw) * Cos(dp» * zrangel) + il * «Cos(dw) * Sin(dk) + Sin(dw) * Sin(dp) * Cos(dk» * xrangel + (Cos(dw) * Cos(dk) - Sin(dw) * Sin(dp) * Sin(dk» * yrangel - (Sin(dw) * Cos(dp» * zrangeI) - (h2 * «-Sin(dw) * Sin(dk) + Cos(dw) * Sin(dp) * Cos(dk» * xrange2 + (-Sin(dw) * Cos(dk) - Cos(dw) * Sin(dp) * Sin(dk» * yrange2 - (Cos(dw) *

104

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Cos(dp» * zrange2) + i2 * «Cos(dw) * Sin(dk) + Sin(dw) * Sin(dp) * Cos(dk» * xrange2 + (Cos(dw) * Cos(dk) - Sin(dw) * Sin(dp) * Sin(dk» * yrange2 - (Sin(dw) Cos(dp» * zrange2» 'd(phi)

*

a_arrO, 1) = Al * (-Sin(dp) * Cos(dk) * xrangel + Sin(dp) * Sin(dk) * yrangel + Cos(dp) * zrangel) + bl * (Sin(dw) * Cos(dp) * Cos(dk) * xrangel - Sin(dw) * Cos(dp) * Sin(dk) * yrangel + Sin(dw) * Sin(dp) * zrangel) + c1 * (-Cos(dw) * Cos(dp) * Cos(dk) * xrangel + Cos(dw) * Cos(dp) * Sin(dk) * yrangel - Cos(dw) * Sin(dp) * zrangel) - (A2 * (-Sin(dp) * Cos(dk) * xrange2 + Sin(dp) * Sin(dk) * yrange2 + Cos(dp) * zrange2) + b2 * (Sin(dw) * Cos(dp) * Cos(dk) * xrange2 - Sin(dw) * Cos(dp) * Sin(dk) * yrange2 + Sin(dw) * Sin(dp) * zrange2) + c2 * (-Cos(dw) * Cos(dp) * Cos(dk) * xrange2 + Cos(dw) * Cos(dp) * Sin(dk) * yrange2 - Cos(dw) * Sin(dp) * zrange2» a_arrO + 1, 1) = dl * (-Sin (dp) * Cos(dk) * xrangel + Sin(dp) * Sin(dk) * yrangel + Cos(dp) * zrangel) + el * (Sin(dw) * Cos(dp) * Cos(dk) * xrangel - Sin(dw) * Cos(dp) * Sin(dk) * yrangel + Sin(dw) * Sin(dp) * zrangel) + fl * (-Cos(dw) * Cos(dp) * Cos(dk) * xrangel + Cos(dw) * Cos(dp) * Sin(dk) * yrangel - Cos(dw) * Sin(dp) * zrangel) - (d2 * (-Sin(dp) * Cos(dk) * xrange2 + Sin(dp) * Sin(dk) * yrange2 + Cos(dp) * zrange2) + e2 * (Sin(dw) * Cos(dp) * Cos(dk) * xrange2 - Sin(dw) * Cos(dp) * Sin(dk) * yrange2 + Sin(dw) * Sin(dp) * zrange2) + f2 * (-Cos(dw) * Cos(dp) * Cos(dk) * xrange2 + Cos(dw) * Cos(dp) * Sin(dk) * yrange2 - Cos(dw) * Sin(dp) * zrange2» a_arrO + 2, 1) = gl * (-Sin (dp) * Cos(dk) * xrangel + Sin(dp) * Sin(dk) * yrangel + Cos(dp) * zrangel) + hI * (Sin(dw) * Cos(dp) * Cos(dk) * xrangel - Sin(dw) * Cos(dp) * Sin(dk) * yrangel + Sin(dw) * Sin(dp) * zrangel) + il * (-Cos(dw) * Cos(dp) * Cos(dk) * xrangel + Cos(dw) * Cos(dp) * Sin(dk) * yrangel - Cos(dw) * Sin(dp) * zrangeI) - (g2 * (-Sin(dp) * Cos(dk) * xrange2 + Sin(dp) * Sin(dk) * yrange2 + Cos(dp) * zrange2) + h2 * (Sin(dw) * Cos(dp) * Cos(dk) * xrange2 - Sin(dw) * Cos(dp) * Sin(dk) * yrange2 + Sin(dw) * Sin(dp) * zrange2) + i2 * (-Cos(dw) * Cos(dp) * Cos(dk) * xrange2 + Cos(dw) * Cos(dp) * Sin(dk) * yrange2 - Cos(dw) * Sin(dp) * zrange2» 'd(kappa) a_arret, 2) = Al * (-Cos(dp) * Sin(dk) * xrangel - Cos(dp) * Cos(dk) * yrangeI) * «Cos(dw) * Cos(dk) - Sin(dw) * Sin(dp) * Sin(dk» * xrangel + (-Cos(dw) * Sin(dk) - Sin(dw) * Sin(dp) * Cos(dk» * yrangeI) + c1 * «Sin(dw) * Cos(dk) + Cos(dw) * Sin(dp) * Sin(dk» * xrangel + (-Sin(dw) * Sin(dk) + Cos(dw) * Sin(dp) * Cos(dk» * yrangeI) - (A2 * (-Cos(dp) * Sin(dk) * xrange2 - Cos(dp) * Cos(dk) * yrange2) + b2 * «Cos(dw) * Cos(dk) - Sin(dw) * Sin(dp) * Sin(dk» * xrange2 + (-Cos(dw) * Sin(dk)-

+ bI

Sin(dw) * Sin(dp) * Cos(dk» * yrange2) + c2 * «Sin(dw) * Cos(dk) + Cos(dw) * Sin(dp) * Sin(dk» * xrange2 + (-Sin(dw) * Sin(dk) + Cos(dw) * Sin(dp) * Cos(dk» * yrange2»

105

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

a_arrO + 1,2) = dl * (-Cos (dp) * Sin(dk) * xrangel - Cos(dp) * Cos(dk) * yrangel) + el * «Cos(dw) * Cos(dk) - Sin(dw) * Sin(dp) * Sin(dk» * xrangel + (Cos(dw) * Sin(dk) - Sin(dw) * Sin(dp) * Cos(dk» * yrangeI) + fl * «Sin(dw) * Cos(dk) + Cos(dw) * Sin(dp) * Sin(dk» * xrangel + (-Sin(dw) * Sin(dk) + Cos(dw) * Sin(dp) * Cos(dk» * yrangel) - (d2 * (-Cos(dp) * Sin(dk) * xrange2 - Cos(dp) * Cos(dk) * yrange2) + e2 * «Cos(dw) * Cos(dk) - Sin(dw) * Sin(dp) * Sin(dk» * xrange2 + (Cos(dw) * Sin(dk) - Sin(dw) * Sin(dp) * Cos(dk» * yrange2) + f2 * «Sin(dw) * Cos(dk) + Cos(dw) * Sin(dp) * Sin(dk» * xrange2 + (-Sin(dw) * Sin(dk) + Cos(dw) * Sin(dp) * Cos(dk» * yrange2» a_arrO + 2, 2) = gl * (-Cos (dp) * Sin(dk) * xrangel - Cos(dp) * Cos(dk) * yrangel) + hI * «Cos(dw) * Cos(dk) - Sin(dw) * Sin(dp) * Sin(dk» * xrangel + (Cos(dw) * Sin(dk) - Sin(dw) * Sin(dp) * Cos(dk» * yrangel) + il * «Sin(dw) * Cos(dk) + Cos(dw) * Sin(dp) * Sin(dk» * xrangei + (-Sin(dw) * Sin(dk) + Cos(dw) * Sin(dp) * Cos(dk» * yrangel) - (g2 * (-Cos(dp) * Sin(dk) * xrange2 - Cos(dp) * Cos(dk) * yrange2) + h2 * «Cos(dw) * Cos(dk) - Sin(dw) * Sin(dp) * Sin(dk» * xrange2 + (Cos(dw) * Sin(dk) - Sin(dw) * Sin(dp) * Cos(dk» * yrange2) + i2 * «Sin(dw) * Cos(dk) + Cos(dw) * Sin(dp) * Sin(dk» * xrange2 + (-Sin(dw) * Sin(dk) + Cos(dw) * Sin(dp) * Cos(dk» * yrange2»

, Alternate Partial derivatives 'a_arr(l, 0) = (el * yrangel - bI * zrangel) - (e2 * yrange2 - b2 * zrange2) 'a_arrO, I) = (AI * zrangel - el * xrangel) - (A2 * zrange2 - e2 * xrange2) 'a_arr(l, 2) = (bl * xrangel - Al * yrangel) - (b2 * xrange2 - A2 * yrange2) 'a_arrO + 1,0) = (fl * yrangel - el * zrangel) - (f2 * yrange2 - e2 * zrange2) 'a_arr(l + I, I) = (dl * zrange 1 - fl * xrangeI) - (d2 * zrange2 - f2 * xrange2) 'a_arr(l + 1,2) = (el * xrangel - dl * yrangel) - (e2 * xrange2 - d2 * yrange2) 'a_arr(l + 2, 0) = (il * yrangel - hI * zrangel) - (i2 * yrange2 - h2 * zrange2) 'a_arr(l + 2, I) = (gl * zrangel - il * xrangel) - (g2 * zrange2 - i2 * xrange2) 'a_arr(l + 2,2) = (hI * xra ngel - gl * yrangel) - (h2 * xrange2 - g2 * yrange2)
I

applying priori observation standard deviations
I

stddev = 0.0578

assumed Laser footprint: 20em *0.289 = 5.78em

a_arr(l, 0) = a_arr(l, 0) / stddev a_ arr(l, 1) = a_ arret, 1) / stddev a_arr(l, 2) = a_arr(l, 2) / stddev a_arr(l + 1,0) = a_arr(l + 1,0) / stddev a_arrO + I, I) = a_arr(l + 1, 1) / stddev a_arrO + 1,2) = a_arr(l + 1,2) I stddev

106

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

a_arr(l + 2,0) = a_arr(l + 2,0) / stddev a_arr(l + 2, I) = a_arr(l + 2, I) / stddev a_arr(l + 2, 2) = a_arr(l + 2, 2) / stddev

w_ arr(l) = xcorn b w_arr(l + 1) = ycorn b w_arr(l + 2) = zcorn b

Print #filenurnout, ii, xcornbl, ycornbl, zcornbl, xcornb2, ycornb2, zcornb2, w_arr(l), w_arr(l + 1), w_arr(l + 2)" a_arr(l, 0), a_arr(1, I), a_arr(l, 2), a_arr(l + 1,0), a_arr(l + I, I), a_arr(l + 1,2), a_arr(l + 2,0), a_arr(l + 2, 1), a_arr(l + 2, 2) w_ arr(l) = xcorn b / stddev w_ arr(l + 1) = ycorn b / stddev w_arr(l + 2) = zcorn b / stddev Next ii

Call TransposeATA_Arrays(a_arrO, counterl

* 3,3, n_arr(»

Call TransposeATB_Arrays(a_arrO, w_arrO, counterl

* 3, 3, u_arr())

dw = dw - x_arr(O)' changed sign dp = dp - x_ arr(l) , changed sign dk = dk - x_arr(2)' changed sign

Print #fi1enurn out, "angles", dw

* 180 / pi, dp * 180 / pi, dk * 180 / pi

'End If Next iter Close #fi1enurnout End Sub

Modules

107

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Public Sub TransposeATA_Arrays(a_matrixO As Double, maxrows As Integer, maxcols As Integer, n_matrixO As Double) Dim row, col, sol As Integer

For row = 0 To maxcols - 1 For col = 0 To maxcols - 1 n_matrix(row, col) = 0# For sol = 0 To m axrows - 1 n_m atrix(row, col) = n_matrix(row, col) + a_matrix(sol, row) col) Next sol Next col Next row End Sub

* a_matrix(sol,

Public Sub TransposeATB_Arrays(a_matrixO As Double, bO As Double, maxrows As Integer, maxcols As Integer, u_ vectorO As Double) Dim row, col As Integer Dim i As Integer, j As Integer
'V

= flag

For row = 0 To maxcols - I u_vector(row) = 0# For col = 0 To maxrows - I u_ vector(row) = u_vector(row) + a_m atrix(col, row) Next col col = 1 Next row End Sub

* b(col)

Public Sub Inverse_Arrays(n_matrixO As Double, u_vectorO As Double, maxcolsl As Integer, xO As Double) Dim sum As Double Dim k, i, j, n As Integer Dim flag As Integer ReDim work(maxcolsl) As Double, b(maxcolsl) As Double

108

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

flag = 1 n = maxcolsl - 1 Fori = 0 To n Forj = i To n sum = n_matrix(i.j) For k = i-I To 0 Step -I sum = sum - n_matrix(i. k) * n_matrixG. k) Nextk Ifi = j Then If sum <= 0# Then Message = "choldc failed" ButtonsAndlcons = vbQKOnly + vbExc1am ation Title = "ERROR MSG." MsgBox Message. ButtonsAndIcons. Title Else work(i) = Sqr(sum) End If Else n_m atrixG. i) = sum / work(i) End If Nextj Next i

Fori = 0 To n sum = u_vector(i) For k = i-I To 0 Step-l sum = sum - n_ matrix(i. k) Nextk x(i) = sum / work(i) Next i For i = n To 0 Step-l sum = x(i) For k = i + 1 To n sum = sum - n_matrix(k. i) Nextk x(i) = sum / work(i) Nexti

* x(k)

* x(k)

flag = I If flag = 1 Then Fori= 0 Ton n m atrix(i. i) = 1# / work(i) For j = i + 1 To n

109

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

sum =0# For k = i To j - 1 sum = sum - n_matrix(j, k) Nextk n_ m atrix(j, i) = sum / work(j) Nextj Next i End If

* n_matrix(k, i)

Debug.Print n_matrix(O, 0), n_matrix(O, I), n_matrix(O, 2) Debug.Print n_matrix(l, 0), n_matrix(l, 1), n_matrix(l, 2) Debug.Print n_matrix(2, 0), n_matrix(2, I), n_matrix(2, 2)
End Sub

llO

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

Appendix B Sample input file for Misalignment Estimator Program
Intial A(!(!roximates of the Misalil!!!!!!ent Angles

Jl
0

Jl
0 606 804.3

Jl
0

IS
11 22 13 U 15 26 27 2' 29
30

661.7 418.3 41U
404.6

101.1

1035

551.5 38H 391.5
391

/977.16 1978.9 197Ul 1978.74 1978.74 197'.36 1978.59
1978.5J 1971.42

99.44 99.26

975.4 977.7
960.1 980.1 990.6

0.140' 0.3804 0.5003 0.6057 0.6053 0.6549 0.7539 0.102J 0.847 -0.101 -O.3J4 -0.059

1.1/43 1.4599
1.4909

-143.514 -148.386 -/48.16
-/48.105 -148.106 -147.117

832.5 869 886 919.3 916.1 941.' 975.4 921 935.1 95606 919.4
904.9

99.0'
98.84 98.68 98.65 96.43 98.19 97.56
97.6J

1.5193 1.5191
1.607

393,4
401.6

397.9 417
409.1 414.1

387.9 376.7
J68.1

984.1 915.9 988.8 965.1 963
96U

1.5617 1.5769 1.595 1.357
1.3499 1.3691 1.230' 1.3567

-147.775
-147.603 -147.307

422.1 157.4
350.9

329.4 314.7 317.5 213./ 2".7 261.4
261.2

1979.14 1979.31 1979.16
1960.1' 1979,69

-/46.74 -14'.79 -148.681
-149.J85 -149.101 -/49.103 -149.271

31 31
3J

97.4 95.97 97.27 97.26 97.2 96.99
97.09 97.01 97.01

363.9 155./
315.J

911.6
950.1 950.1

-1.929
-1.058 -1.058

34 35 36 37
31

917.6
901.5 611.7

315.3 292.6 271.5 271.5 269.9
110.9

1979.69 1979.92
1960.13 1960.IJ 1980.14 1910.5

1.3587
I.3J25

252
150

942 934,4 934.4
93J.9 920.1

-1.459 -1.749 -1.749 -1.767
-1.145

1.2771 1.1772
1.2705 1.2015

-/49.367 -149.367 -149.367 -/49.356

665.3
"'.1 867.1

241.1 214.3

19

11'

11'

11'

11'

11'

11'

11'

11'

11'

11'

151.01111 170.926676 158.015721 140.6165" 130.374432 117.131673 1I1.J69911 107.054425 91.798019 95.269J777

-111.67117
-138.9407 -116.02175 -14.119611 -64.513117 -40.116642

-1671.2561
-/674.1319 -1175.1419 -1675.'019

-/876.5177 -1676.5277
-1677.0259 -/177.7719

-41.947466
-19.52111 10.3606165 8.5'JJ9761 17.5176061

-1678.7393
-1179.9305 -/880.0191 -1880.3'44 -1881.1219 -1880.3327 -1880.2792 -/880.1617 -1880.6746 -1880.7077 -1660.5557 -1881.0749

86.8142513
78.566096 69.1517941 97.1148622 8'.719456 91.1074202 97.1512101 95.18$3327

35.7973662
94.131/911 3M5U076 47.2J17252 5/.6210997 47.3197905 50.8604261 61.6162036

87.1471157 93.5124775

57.6629796

11

11'
X range

11'
Y range

11'
Z range

1t

[]
III

Reproduced with permission of the copyright owner. Further reproduction prohibited without permission.

