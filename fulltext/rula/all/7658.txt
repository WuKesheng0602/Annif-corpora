SURFACE-CONSTRAINED CONTINUOUS-TIME EXTENDED KALMAN FILTER: OPTIMAL ESTIMATION OF A STATE OF A CONSTRAINED DYNAMIC SYSTEM ­ BALL-ROVER ROLLING ON A KNOWN SURFACE

by

Maksims Demjanenko Bachelor of Science, York University (2012)

A thesis presented to Ryerson University in partial fulfillment of the requirements for the degree of Master of Applied Science in the program of Aerospace Engineering

Toronto, Ontario, Canada, 2018 © Maksims Demjanenko 2018

AUTHOR'S DECLARATION FOR ELECTRONIC SUBMISSION OF A THESIS

I hereby declare that I am the sole author of this thesis. This is a true copy of the thesis, including any required final revisions, as accepted by my examiners. I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research. I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research. I understand that my thesis may be made electronically available to the public.

ii

SURFACE-CONSTRAINED CONTINUOUS-TIME EXTENDED KALMAN FILTER: OPTIMAL ESTIMATION OF A STATE OF A CONSTRAINED DYNAMIC SYSTEM ­ BALL-ROVER ROLLING ON A KNOWN SURFACE Maksims Demjanenko Master of Applied Science, Aerospace Engineering, Ryerson University, Toronto (2018)

ABSTRACT

The Surface-constrained Continuous-time Extended Kalman Filter (SCEKF), derived in thesis, contains a novel approach for handling surface or equality constraints, in which the surface-constrained CEKF is the projection of the unconstrained CEKF onto the set of state estimate rates that satisfy the constraints. The filter is used for optimal estimation of a state of a ball rolling on a known surface with uneven elevation. The state consists of surface contact point and geometrical center positions, attitude and angular velocity of the ball. The dynamics of the ball is affected by "unknown" to the filter disturbances, due to off-center point mass and variable wind. Thesis includes derivations of the SCEKF and the constraint dynamics of a rolling ball. The numerical computation results show that the surface-constrained filter can produce an accurate state estimate of the rolling ball and demonstrate that the estimate is significantly better than that produced by unconstrained filter.

iii

ACKNOWLEDGEMENTS

I am very thankful to my supervisor Dr. Anton de Ruiter, for all the provided help, guidance and advice, which enabled me to develop and complete this thesis successfully.

iv

DEDICATION

Dedicated to my parents Larisa and Aleksandr, who inspired me to learn.

v

TABLE OF CONTENTS

Author's Declaration for Electronic Submission of a Thesis Abstract Acknowledgements Dedication List of Tables List of Figures 1 Introduction 1.1 1.2 General Description of Kalman Filtering . . . . . . . . . . . . . . . . . . Surface-Constrained Kalman Filtering . . . . . . . . . . . . . . . . . . .

ii iii iv v viii ix 1 1 4 5 5

2 Surface-constrained Continuous-time Extended Kalman Filter 2.1 2.2 Surface-constrained Continuous-time Linear Kalman Filter . . . . . . . .

Surface-constrained Continuous-time Extended Kalman Filter . . . . . . 19 25

3 Dynamics of a Ball Rolling on a Known Surface 3.1 3.2 3.3 3.4 3.5 3.6

Surface and Ball Parameters . . . . . . . . . . . . . . . . . . . . . . . . 25 Ball-Surface Contact Condition . . . . . . . . . . . . . . . . . . . . . . . 27 Kinetic and Potential Energies . . . . . . . . . . . . . . . . . . . . . . . 30 No-Slip Condition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33 Lagrange's Equations of Motion . . . . . . . . . . . . . . . . . . . . . . 36 Equations of Motion Summary . . . . . . . . . . . . . . . . . . . . . . . 48

vi

4 Surface-constrained Continuous-time Extended Kalman Filter for a Ball Rolling on a Known Surface 4.1 4.2 52 Surface Constraints for a Rolling Ball . . . . . . . . . . . . . . . . . . . 52 Surface-Constrained Kalman Filter for a Rolling Ball . . . . . . . . . . . 54 59

5 Results and Analysis: Optimal Estimate of the State of a Rolling Ball 5.1 5.2 5.3

General Computational Settings . . . . . . . . . . . . . . . . . . . . . . 60 First Set of Results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 64 Second Set of Results: Increased Disturbance Due to Point Mass . . . . . 74 85 89

6 Conclusions References

vii

LIST OF TABLES

2.1 2.2 3.1

Surface-Constrained Continuous-time Linear Kalman Filter . . . . . . . . 18 Surface-Constrained Continuous-time Extended Kalman Filter . . . . . . 24 Equations of Motion of the Ball Rolling on a Surface Without Slipping . . 51

viii

LIST OF FIGURES

3.1 4.1 5.1 5.2

Ball rolling on a surface. . . . . . . . . . . . . . . . . . . . . . . . . . . 26 Ball center and reference point position. . . . . . . . . . . . . . . . . . . 57 The surface on which the ball is rolling. . . . . . . . . . . . . . . . . . . 60 Unconstrained CEKF estimate for surface contact point position of the rolling ball (red) and true, surface contact point position (blue), shown in three dimensions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 65

5.3

Unconstrained CEKF estimate for surface contact point position of the rolling ball (red) and true, surface contact point position of the rolling ball (blue). Side view ( xz -plane) and top view ( x y -plane). . . . . . . . . . . . 66

5.4

Surface-constrained CEKF estimate for surface contact point position of the rolling ball (red) and true, surface contact point position (blue), shown in three dimensions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 66

5.5

Surface-constrained CEKF estimate for surface contact point position of the rolling ball (red) and true, surface contact point position of the rolling ball (blue). Side view ( xz -plane) and top view ( x y -plane). . . . . . . . . . 67

5.6

True, x y -plane position components of the contact point (and the geometric center) of the rolling ball. . . . . . . . . . . . . . . . . . . . . . . . . . . 67

5.7 5.8

Components of the true angular velocity of the rolling ball. . . . . . . . . 68 Error in the Unconstrained CEKF estimate for surface contact point position of the rolling ball. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69

5.9

Error in z coordinate of the Unconstrained CEKF estimate for surface contact point position of the rolling ball. . . . . . . . . . . . . . . . . . . 69

ix

5.10 Error in the Surface-constrained CEKF estimate for the surface contact point position of the rolling ball. . . . . . . . . . . . . . . . . . . . . . . 70 5.11 Error in z coordinate of the Surface-constrained CEKF estimate for surface contact point position of the rolling ball. . . . . . . . . . . . . . . . . . . 70 5.12 Error in the Unconstrained CEKF estimate for the geometric center position of the rolling ball. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 71 5.13 Error in z coordinate of the Unconstrained CEKF estimate for the geometric center position of the rolling ball. . . . . . . . . . . . . . . . . . . . . . . 72 5.14 Error in the Surface-constrained CEKF estimate for the geometric center position of the rolling ball. . . . . . . . . . . . . . . . . . . . . . . . . . 72 5.15 Error in z coordinate of the Surface-constrained CEKF estimate for the geometric center position of the rolling ball. . . . . . . . . . . . . . . . . 73 5.16 Error in the Unconstrained CEKF estimate for the angular velocity of the rolling ball. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 73 5.17 Error in the Surface-constrained CEKF estimate for the angular velocity of the rolling ball. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 74 5.18 Unconstrained CEKF estimate for the surface contact point position of the rolling ball (red) and true, surface contact point position (blue), shown in three dimensions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75 5.19 Unconstrained CEKF estimate for surface contact point position of the rolling ball (red) and true, surface contact point position of the rolling ball (blue). Side view ( xz -plane) and top view ( x y -plane). . . . . . . . . . . . 76 5.20 Surface-constrained CEKF estimate for the surface contact point position of the rolling ball (red) and true, surface contact point position (blue), shown in three dimensions. . . . . . . . . . . . . . . . . . . . . . . . . . 76 5.21 Surface-constrained CEKF estimate for surface contact point position of the rolling ball (red) and true, surface contact point position of the rolling ball (blue). Side view ( xz -plane) and top view ( x y -plane). . . . . . . . . . 77

x

5.22 True, x y -plane position components of the contact point (and the geometric center) of the rolling ball. . . . . . . . . . . . . . . . . . . . . . . . . . . 77 5.23 Components of the true angular velocity of the rolling ball. . . . . . . . . 78 5.24 Error in the Unconstrained CEKF estimate for the surface contact point position of the rolling ball. . . . . . . . . . . . . . . . . . . . . . . . . . 79 5.25 Error in z coordinate of the Unconstrained CEKF estimate for the surface contact point position of the rolling ball. . . . . . . . . . . . . . . . . . . 80 5.26 Error in the Surface-constrained CEKF estimate for the surface contact point position of the rolling ball. . . . . . . . . . . . . . . . . . . . . . . 80 5.27 Error in z coordinate of the Surface-constrained CEKF estimate for the surface contact point position of the rolling ball. . . . . . . . . . . . . . . 81 5.28 Error in the Unconstrained CEKF estimate for the geometric center position of the rolling ball. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 82 5.29 Error in the Surface-constrained CEKF estimate for the geometric center position of the rolling ball. . . . . . . . . . . . . . . . . . . . . . . . . . 82 5.30 Error in z coordinate of the Surface-constrained CEKF estimate for the geometric center position of the rolling ball. . . . . . . . . . . . . . . . . 83 5.31 Error in the Unconstrained CEKF estimate for the angular velocity of the rolling ball. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 84 5.32 Error in the Surface-constrained CEKF estimate for the angular velocity of the rolling ball. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 84

xi

Chapter 1 Introduction
In order to get estimates of such parameters as position, velocity and orientation of a moving system as accurate as possible, based on a set of noisy measurements, for the purpose of navigation for example, it is necessary to process the measurements in such a way as to reduce the error in the estimates as much as possible. One way to process noisy measurements, is to use Kalman filtering - a mathematical method for optimal, or best possible estimation using available noisy data. The overview of Kalman filtering is given in the next section.

1.1

General Description of Kalman Filtering

The Kalman filter is a system state estimation algorithm based on probability theory and statistics. It combines the modelled state of a system with the measured state, to produce the state estimate that is, in general, more precise than the estimate based on the measurements only. It was initially developed by several authors around 1960. The filter is named after Hungarian-born American engineer and mathematician Rudolf E. Kalman, who published a paper on the subject in 1960 [1] [2]. The motivation for the Kalman filter comes from the fact that any system model is an approximation with modelling errors and there could be a number of unforeseen disturbances that are hard to model in advance; any measurements have errors associated with the measurement technique, measuring device, etc. A direct way of calculating a state of a system using a system model or measurements can lead to an estimate that has a significant uncertainty. The Kalman filter accounts for the various uncertainties and

1

produces an optimal (best possible, for which the errors are minimized) estimate of system state parameters [3]. All the available state measurements can be used by the filter, but their effect on the state estimate is weighted according to their uncertainty. In general, even considerably corrupted measurements can improve the estimate (as long as their uncertainty is known fairly well). The Kalman filter is a recursive estimation algorithm, which means that only the estimate from the previous time step is required in order to compute the new estimate [3]. The filter produces the highest precision estimates when it is applied to linear system models for which the system and measurement noise are white (noise frequencies are uncorrelated and have equal amplitude across the noise spectrum) and Gaussian (the probability distribution of noise frequency values, has Gaussian profile) [4]. In its original form, Discrete-time Kalman Filter produces state estimates in discrete time steps and deals with systems described by linear unconstrained models [1]. Using the current optimal, system state estimate, the state model is used to predict the state of the system after a time step. The measurement taken after a time step is used to correct the prediction, so that the new optimal estimate of the system state is obtained. Then, the algorithm is repeated recursively [4]. Continuous-time Kalman Filter is the limiting case of the discrete-time Kalman filter, for which the time steps become infinitely small. In practice, the continuous-discrete-time Kalman filter is often used, for which the state is modelled by a continuous time function, while the measurements are taken in discrete time intervals. As in the case of Discrete-time Kalman Filter, this filter is for linear system models [5]. The Extended Kalman Filter is used to estimate the state of the systems that are described by nonlinear models. The nonlinear model of a system is linearized (represented by a combination of linear terms, commonly produced using Taylor series approximation) around the estimate produced by the Kalman filter, while the estimate is based on the linearized model [6]. The Unscented Kalman Filter is a type of nonlinear Kalman filter that that can be used to solve highly nonlinear systems, for which the first order linearization that the extended Kalman filter uses, may not be accurate enough or may not be possible at all in the cases where the system model function is not differentiable [5]. The Constrained Kalman Filter deals with the cases in which system states have to 2

satisfy constraints [5]. For example, a rocket moving in an open space is a case of an unconstrained motion. It is not confined to follow a particular path and its velocity components, can be determined independently. On the other hand, a roller coaster cart is constrained to move on the roller coaster track and the components of its velocity are not independent of each other. A number of Kalman filter types can handle state estimate constraints. Usually, a given type of the constrained filter is suitable for a certain type of constraints, such as norm constraints (for the state estimate vectors that have norm requirements), or linear and nonlinear equality constraints (for when the state estimates have to satisfy specific equality relations). For example, a well known method employed for attitude estimation problems - Multiplicative Extended Kalman Filter (MEKF) is a norm-constrained filter [5]. The MEKF formulation uses quaternion. The norm of the quaternion, by definition, must satisfy the unit constraint. During the computation, the division of the quaternion estimate by its norm ensures that this constraint is satisfied [5] [7]. In some methods, the Kalman gain is optimally constrained in order to obtain state estimates that satisfy constraints [8]. In the reference [9] such method is used to solve a system state estimation problems with linear equality and inequality constraints. Kalman filter can be constrained by projecting the unconstrained system state estimates onto the constraint surface. This approach is used for linear equality constraints in [9] [10] and for nonlinear equality constraints in [11]. In [9] [12] [7], the discrete-time filter is considered and it is demonstrated that optimally constraining the gain (in order to satisfy norm constraints) leads to constrained Kalman estimate which is the orthogonal projection of the unconstrained estimate onto the constrained set. In [13] [14], the continuous-time filter is considered and it is shown that the optimal constrained gain (that accounts for norm constraints) leads to the projection of the unconstrained Kalman filter onto the allowed set of state estimate rates. Another way to enforce constrains is to define them as pseudo-measurements and then include them in the Kalman filter. The pseudo-measurements are used for introducing linear equality constraints into Kalman filter in [15] [16].

3

1.2

Surface-Constrained Kalman Filtering

The Kalman filtering can be difficult to apply to a case of a dynamic system constrained to move on a surface, especially if the surface is uneven and the motion is affected by disturbances. In this thesis the Surface-constrained Continuous-time Extended Kalman Filter (SCEKF) is derived and applied to a ball-rover moving on a known, uneven surface, with its motion affected by such (unknown to the filter) disturbances as off-center point mass embedded within the ball and time-varying wind force (which varies both in direction and magnitude). In practice, it can be a wind-driven tumbleweed-type rover, such as the proposed spherical, robotic, tumbleweed Mars rover [17]. In a general sense, surface-constrained means constrained to the surfaces that are defined by constraints and exist in constraint space. In the application used in the thesis, the system is constrained to a physical surface. The constrained Kalman filter derived in the thesis is unique in the approach taken for equality (surface) constraints. In this approach, finding the optimal, constrained Kalman gain leads to geometric interpretation in which the constrained state estimate rates are orthogonal projections of the unconstrained state estimate rates onto the space defined by the state estimate rates that satisfy constraints. The SCEKF can handle both linear and nonlinear equality constraints. The pseudo-measurements method [15] can be applied to the type of the state estimation problems that the SCEKF can handle. However it does not enforce the constraints as strictly as the SCEKF, potentially leading to less precise system state estimates. In this method, the constraint expressions are used in Kalman filter as perfect measurements, or pseudo-measurements. Having no error, the perfect measurements may lead to singularity issues in the Kalman filter estimation algorithm. To overcome this problem, some noise is added to the pseudo-measurements, which means that the constraints can not be satisfied exactly [7].

4

Chapter 2 Surface-constrained Continuous-time Extended Kalman Filter
In this chapter the Surface-constrained Continuous-time Extended Kalman Filter (SCEKF) used in this thesis, will be developed. As the naming of the filter indicates, it is for surface-constrained, continuous-time, nonlinear systems. In the first part of this chapter, surface-constrained continues-time linear Kalman filter will be derived. Then, it will be extended to nonlinear systems, thus becoming Surface-constrained Continuous-time Extended Kalman Filter.

2.1

Surface-constrained Continuous-time Linear Kalman Filter

The linear, continuous-time, system model is specified as x(t ) = A(t )x(t ) + B (t )u(t ) + w(t ) ,
.

(2.1)

where x(t )  Rnx is the system state vector, u(t )  Rnu is the known control input vector, w(t )  Rnx is the zero-mean white noise process vector (which appears due to the state modelling errors) with autocovariance E w(t )w( )T = Q(t )(t -  ) , (2.2)

5

where E {} is the expectation operator, Q(t ) is the process noise covariance matrix and (t -  ) is the Dirac Delta function, which implies that the noise values at a time t and  are not related that is E w(t )w( )T = 0 if t  . The matrices A(t ) and B (t ) as well as the vector u(t ) are assumed to be piecewise continuous. The linear, continuous-time measurement model is expressed as y (t ) = C (t )x(t ) + v (t ) , (2.3)

where y (t )  Rny is the system state measurement vector, v (t )  Rny is the zero-mean white noise process vector (consequence of the measurement modelling errors) with autocovariance E v (t )v ( )T = R(t )(t -  ) , (2.4)

where R(t ) is the measurement noise covariance matrix. The matrix C (t ) is assumed to be piecewise continuous. Furthermore, it is assumed that w(t ) and v (t ) are independent. For convenience, the time dependence is omitted from the notation, however it is assumed that all the variables can depend on time. The linear state estimate rate equation is expressed as ^ = Ax ^ + Bu + K (y - C x ^) , x
.

(2.5)

^ is the state estimate and K is the optimal gain matrix. The estimate error is where x defined as ~ =x-x ^, x therefore,
. .

(2.6)

~ =x - x ^, x substitution of (2.6) and (2.7) into (2.5) gives x-x ~ = A(x - x ~ ) + Bu + K [y - C (x - x ~ )] ,
. .

.

(2.7)

(2.8)

6

substituting (2.1) into the above equation get ~ = -A(x - x ~ ) - Bu - K [y - C (x - x ~ )] + Ax + Bu + w x ~ - Bu - Ky + KCx - KC x ~ + Ax + Bu + w = -Ax + Ax ~ - Ky + KCx + w , = (A - KC )x using (2.3) in the last expression leads to ~ = (A - KC )x ~ - KCx - Kv + KCx + w , x or
. . .

(2.9)

(2.10)

~ = (A - KC )x ~ + w - Kv , x

(2.11)

which is the estimate error rate equation. The estimate error covariance matrix is defined as ~x ~T , P =E x this expression satisfies the following error covariance rate equation [5], P = (A - KC )P + P (A - KC )T + Q + KRK T
.

(2.12)

(2.13)

The state vector has the form x = col i=1,...,m {xi } , (2.14)

where xi  Rnx, i for i = 1, ..., m , is in general a column vector. The state estimate vector ^ is partitioned in the corresponding manner, x ^ = col i=1,...,m {x ^i } , x ^ i  Rnx, i for i=1,...,m . with x (2.15)

7

^ i for i = 1, ..., m - 1 It is assumed that (2.15) includes constrained state estimates x ^ m . The constrained state estimates have to satisfy and unconstrained state estimates x equality, surface constraints, defined as ^i ) = 0 , gi (x i = 1, ..., m - 1 , (2.16)

where the expression (2.16) represents the surfaces (in constraint space) to which the system state is constrained. The functions gi are continuously differentiable on these surfaces. Differentiating the constraints (2.16) with respect to time produces ^ i )  gi (x ^i ) d x ^i d gi (x = ^ i dt dt x ^i dx ^i ) = 0, = Gi (x dt where ^i ) = Gi (x

(2.17) i = 1, ..., m - 1 ,

^i )  gi (x , ^i x

(2.18)

is the constraint Jacobian matrix. It is assumed that the surfaces (2.16) are regular, hence the constraint surface gradients, which are the rows of the Jacobian (2.18), are linearly ^i ) independent and Gi (x ^ /dt can have values other 0. The state estimate rate vectors d x ^ /dt must be in the null-space of Gi (x ^ i ). than zero, therefore equation (2.17) shows that d x ^ i /dt , which are given by (2.5), are continuous, so if the state The state estimate rates  x ^ i are initially anywhere on the constraint space surfaces (2.16) and if (2.17) is estimates x satisfied (the constraint space surfaces do not change with time), then (2.16) has to be true at all times and the state estimates remain on the surfaces at all times. In accordance with the partitioning format of the state vector (2.16), the matrices used in the estimate rate equation (2.5) are partitioned in the following way,    A1     .  A=  . . ,     A m       B1     .  B= . . ,     Bm       K1     .  K= . . ,     K m   

(2.19)

8

   P11 · · · P1m     .  . .. . P = . . . .  = P1 · · ·     Pm1 · · · Pmm   

Pm ,

(2.20)

   Q11 · · · Q1m     .  . ... . Q=  . . .  = Q1 · · ·     Qm1 · · · Qmm   

Qm

(2.21)

Now the state estimate rate equation (2.5) can be written in a partitioned form as ^ i = Ai x ^ + Bi u + Ki (y - C x ^) x ^ + Bi u + Ki y ~, = Ai x where ~ = y - Cx ^, y is the state measurement estimation error. Substituting (2.22) into (2.17) gives the following constraint equations, ^ i )[Ai x ^ + Bi u + Ki y ~] = 0 , Gi (x i = 1, ..., m - 1 (2.24) (2.23) i = 1, ..., m ,
.

(2.22)

It can be noted, that the only adjustable parameter that the i th estimator (2.22) and the i th constraint (2.24) depend on, is the partitioned gain Ki . By following the standard Kalman filtering approach [5] the optimal gain K is found by minimizing the cost function J , that is, by minimizing the function that quantifies the deviation of the state estimate from the true state,
. 1 J = trace[P ] , 2

(2.25)

while at the same time making sure that the constraints (2.24) are satisfied.

9

In accordance with the partitioning format of the error covariance P (2.20), the cost function (2.25) can be written as 1 J= 2
m i =1 .

trace[P ii ]

(2.26)

Using the partitioned matrices (2.19), (2.20) and (2.21), the estimate error covariance rate equation (2.13) can be partitioned in the following way, P ii = (Ai - Ki C )Pi + PiT (Ai - Ki C )T + Qii + Ki RKiT ,
.

i = 1, ..., m (2.27)

Each P ii in (2.27), as well as each constraint in (2.24) depends only on the gain Ki . Hence, the gain Ki is selected in such a way as to minimize the cost function J (which is a function of P ii ) while at the same time satisfying the constraints (2.24). Furthermore, the minimization of the cost function J can be carried out by minimizing m cost functions Ji , where each Ji corresponds to a Ki , P ii pair,
. 1 min Ji = trace[P ii ] , Ki 2 . .

.

(2.28)

this equation should satisfy the i th constraint from (2.24), ^ i )[Ai x ^ + Bi u + Ki y ~] = 0 Gi (x (2.29)

For the equations (2.28), (2.29), i = 1, ..., m - 1. The unconstrained cost function that is being minimized is for i = m ,
. 1 min Jm = trace[P mm ] Km 2

(2.30)

10

The gain Ki represents the constrained gain as it has to satisfy the constraint equation (2.29). Taking the derivative of the cost function Ji with respect to the gain Ki gives the following result,  Ji = -PiT C T + Ki R ,  Ki i = 1, ..., m (2.31)

If all the state estimates were unconstrained, then  Ji / Ki = 0 and the equation (2.31) could be expressed as K i , unc = PiT C T R-1, where, as follows from (2.30), Km = Km,unc (2.33) i = 1, ..., m , (2.32)

The error covariance matrix P is symmetric, hence it can be written that    K1,unc     .  T -1  . .  = P C R = Kunc ,     Km,unc    here Kunc is the optimal Kalman gain matrix for the entire unconstrained system. In order to find the gains Ki that minimize the cost functions Ji (2.28) subject to the constraints (2.29), the Lagrangian method is used. First, the corresponding Lagrangians are written as ^ i )[Ai x ^ + Bi u + Ki y ~] , Li = Ji + T i Gi (x where i  Rng, i are Lagrange multipliers. i = 1, ..., m , (2.35)

(2.34)

11

Next, the derivative of the Lagrangians with respect to the minimization variable Ki , are computed,  Li  Ji  ^ i )[Ai x ^ + Bi u + Ki y ~]} , = + T {Gi (x i  Ki  Ki  Ki using equation (2.31) , the following expression for the derivative is obtained,  Li ~T = -PiT C T + Ki R + GT i i y  Ki (2.37) (2.36)

The application of Lagrange multipliers to solve the given constrained minimization problem, requires the gradients (with respect to Ki ) of the constraints (2.29) to be linearly independent [18]. To check the linear independence, the rows of the constrained Jacobian Gi are indexed with j , so that the j th row of Gi is denoted by Gi, j . In this notation, the j th constraint in (2.29) can be written as ^ i )[Ai x ^ + Bi u + Ki y ~] = 0 , Gi, j (x j = 1, ..., ng,i (2.38)

Taking the gradient of the above expression with respect to Ki gives ~T , GT i, j y j = 1, ..., ng,i (2.39)

It is assumed in (2.16) that the constraint surfaces gi are regular, hence the matrices Gi (2.18), composed of the gradients of gi , have full row-rank, that is, the rows Gi, j are linearly independent. The following equation which includes (2.39) ,
ng, i

~T = 0 ,  j GT i, j y
j =1

(2.40)

where  j is a real number, is written in accordance with the standard way of checking whether vectors are linearly independent [20] , which states that if the summation is zero 12

only in the case when all  j are zero, then the vectors must be linearly independent. As noted above Gi, j are linearly independent, thus for (2.40) to hold true, all  j must be zero, which implies that the constraint gradients are linearly independent. The required condition for a minimum of the Lagrangians is  Li / Ki = 0, so the next step in the Lagrangian method is to set the derivative of the Lagrangians (2.37) equal to zero, which gives ~T = 0 , -PiT C T + Ki R + GT i i y which can be written as ~T R-1 = 0 , -PiT C T R-1 + Ki + GT i i y substituting (2.32) into the above equation gives ~T R-1 , Ki = Ki,unc - GT i i y i = 1, ..., m - 1 , (2.42) i = 1, ..., m - 1 , (2.41)

using this expression in the constraint equations (2.29) leads to ^ i )[Ai x ^ + Bi u + (Ki,unc - GT ~T R-1 )y ~] = 0 , Gi (x i i y which can be written as ~T R-1 y ~] = 0 , Gi [i - GT i i y where ^ + Bi u + Ki,unc y ~, i = Ai x i = 1, ..., m - 1 , (2.44) i = 1, ..., m - 1 , (2.43) i = 1, ..., m - 1 ,

where i is the unconstrained Kalman filter that would be used for the system state estimation if there were no constraints.

13

Now, the equation (2.43) is solved for the Lagrange multipliers, which leads to
-1 i = [Gi GT i ] Gi

i , T ~ R -1 y ~ y

i = 1, ..., m - 1 ,

(2.45)

and since due to assumed regularity, Gi has full row-rank (all the rows of this matrix are linearly independent), the Lagrange multipliers (2.45) are unique. Before using the Lagrange multipliers i in equation (2.43) to get the constrained gains Ki , it will be verified whether Ki minimizes the Lagrangians (2.35) (and therefore minimizes the cost function J while simultaneously satisfying the constraint equation (2.29)), that is, whether the extremum of Li found by setting the first-order derivative of Li with respect to Ki (2.37) equal to zero, is indeed the minimum. The sufficient condition for this is that the second-order derivative of Li with respect to Ki is positive-definite for all possible directions of Ki (such directions that satisfy the constraint equations) [18]. To compute second-order derivative, or the Hessian of the Lagrangians Li the gain Ki is written in a vector form. If j th row of Ki is designated as kiT , j so that  T   ki,1     .  Ki =  . . ,    T  ki,ng, i   

(2.46)

then, the vector form of Ki can be defined as a column vector in the following way,    ki,1     .  . = .      ki,ng, i   

ki,v ec

(2.47)

Now the derivative of the Lagrangians Li with respect to Ki (2.37) can be vectorized by using (2.47) in place of Ki ,  T  Rki,1     .  . =  .  + T ,     Rki,ng, i    14

 Li  ki,v ec

(2.48)

~T in a vectorized form which is independent of ki,v ec . where  is the term -PiT + GT i i y Now, the Hessian of the Lagrangian Li can be computed as follows,  T  Rki,1      .  =  . .    ki,v ec    Rki,ng, i    = diag {R, ..., R}

 2 Li  ki2 ,v ec

(2.49)

The resulting Hessian is a diagonal matrix. This matrix is positive-definite, because R has been assumed to be positive-definite. Therefore, it is verified that Ki minimizes the Lagrangians (2.35) and thus the cost function (2.28) while satisfying the constraints (2.29). It can be seen from (2.28) and (2.27) that cost functions Ji depend on Ki and since the last term of (2.27) produces matrix that in its main diagonal has squared elements of Ki , the Ji are strictly convex. All the required Ki that satisfy (2.28) should also satisfy the constraints (2.29), so the required set of Ki is a convex set. Therefore Ki given by (2.42) which includes i given by (2.45) is a global minimizing solution to the constrained problem specified by (2.28) and (2.29). Using similar approach, it can be shown that the unconstrained gain Km (2.33) is the global minimizing solution for the unconstrained minimization problem (2.31). Now that it has been shown that the gains Ki (2.42) together with the Lagrange multipliers i (2.45) minimize the cost function (2.28) where Ki is subject to constrained (2.29), i can be substituted into Ki to give the following equation for the constrained minimizing gain,
T -1 Ki = Ki,unc - GT i [Gi Gi ] Gi

~T R-1 i y , ~ ~T R-1 y y

i = 1, ..., m - 1

(2.50)

Substituting the above result into the partitioned state estimate rate equation (2.22) leads to the following constrained state estimate rate equation,

15

^ i = Ai x ^ + Bi u + Ki y ~ x
T -1 ^ + Bi u + (Ki,unc - GT = Ai x i [Gi Gi ] Gi

.

~T R-1 i y ~ )y ~T R-1 y ~ y (2.51)

T -1 ^ + Bi u + Ki,unc y ~ - GT = Ai x i [Gi Gi ] Gi i

= i -

T -1 GT i [Gi Gi ] Gi i

T -1 = (1nx, i ×nx, i - GT i [Gi Gi ] Gi )i

= i i , where

i = 1, ..., m - 1 ,

T i = 1nx, i ×nx, i - GT i Gi Gi

-1

Gi ,

i = 1, ..., m - 1

(2.52)

and ^ + Bi u + Ki,unc y ~, i = Ai x as defined in (2.44). i is the unconstrained state rate vector expression which could be used in the unconstrained state estimate rate (differential) equation to get estimates of i = 1, ..., m - 1 unconstrained state vectors (which together with the state vector solution to i = m unconstrained state estimation problem, would give the estimate of the complete unconstrained state vector). In accordance with the preceding derivation, multiplication of i by i leads to the constrained state estimate rate equation (2.51). In terms of geometric interpretation, it can be demonstrated that the matrix i orthogonally projects the vector i onto the null-space of the constraint Jacobian Gi . If the projection i i is a vector in the null-space of Gi , then it should satisfy Gi i i = 0. This can be verified using (2.52) as follows,
T Gi i i = Gi 1nx, i ×nx, i - GT i Gi Gi T = Gi i - Gi GT i Gi Gi -1 -1

i = 1, ..., m - 1 ,

Gi i (2.53)

Gi i

= Gi i - 1nx, i ×nx, i Gi i = 0, i = 1, ..., m - 1

16

Next, in order to demonstrate that i orthogonally projects i onto the null-space of Gi , first, it can be noted that the projection i i and the projected vector i satisfy the following geometric vector subtraction relationship, i - (i - i i ) = i i , or i = i i + (i - i i ) , i = 1, ..., m - 1 (2.54) i = 1, ..., m - 1 ,

If the matrix i orthogonally projects the vector i onto the null-space of the constraint Jacobian Gi , then the vector (i - i i ) should be orthogonal to the null-space of Gi . Using i expression (2.52), it can be written that
T i - i i = i - i - GT i Gi Gi T = GT i Gi Gi -1 -1

Gi i i = 1, ..., m - 1

Gi i ,

(2.55)

Now, let a be a vector in the null-space of Gi , so that Gi a = 0, then
T aT (i - i i ) = aT GT i Gi Gi -1

Gi i Gi i (2.56)

= (Gi a)T Gi GT i = 0,

-1

i = 1, ..., m - 1 ,

and since a can be any vector in the null-space of Gi , the vector (i - i i ) is orthogonal to the null-space of Gi . In accordance with earlier discussion, as long as i i satisfies (2.17), the corresponding ^ i is on the constraint surfaces (2.16). state estimate x Using (2.34), in (2.50) the expression for the entire (rather than partitioned, as in (2.50)) constrained Kalman gain matrix is obtained,  T -1 coli=1,...,m-1 GT i [Gi Gi ] Gi i K = Kunc -   0nx, m ×1    T -1  y  ~ R y T -1 ~ ~ R y 

(2.57)

The resulting surface-constrained continuous-time linear Kalman filter is summarized in table 2.1. 17

Table 2.1: Surface-Constrained Continuous-time Linear Kalman Filter Estimator Constrained state estimate rate equation: . ^ i = i i , x i = 1, ..., m - 1 The unconstrained term of the constrained state estimate rate equation: ^ + Bi u + Ki,unc y ~, i = Ai x i = 1, ..., m - 1 State measurement vector: ~ = y - Cx ^ y (2.51) (2.44) (2.23)

The term that enforces constraints in the state estimate rate equation:
T -1 i = 1nx, i ×nx, i - GT i [Gi Gi ] Gi ,

i = 1, ..., m - 1

(2.52)

Constraint Jacobian matrix: ^i )  gi (x ^i ) = Gi (x , ^i x

i = 1, ..., m - 1

(2.18)

Unconstrained state estimate rate equation: . ^ m = Am x ^ + Bm u + Km,unc y ~ x Gains The optimal Kalman gain matrix for the entire unconstrained system: Kunc = P C T R-1 Constrained Kalman gain matrix: K = Kunc -
T -1 coli=1,...,m-1 GT i [Gi Gi ] Gi i 0nx, m ×1

(2.34)

~T R-1 y ~T R-1 y ~ y

(2.57)

Covariance Propagation Error covariance rate equation: . P = (A - KC )P + P (A - KC )T + Q + KRK T (2.13)

18

2.2

Surface-constrained Continuous-time Extended Kalman Filter

Now, by taking the linear filter, obtained in the previous section, and extending it to nonlinear systems, the surface-constrained Continuous-time Extended Kalman Filter will be developed. Instead of the linear system consisting of the state (2.1) and the state measurement (2.3), the following nonlinear system will be used for the extended filter development, x(t ) = f (x, t, u, w) , y (t ) = h(x, t, v )
.

(2.58) (2.59)

It assumed that the functions f and h are continuously differentiable with respect to x, w and v , continuous in u and piecewise continuous in t . The zero-mean white noise processes w and v are assumed to be defined in the same way as in the previous section. Also, as in the previous section, the constraints (2.29) are applied to the system state, partitioned in the following manner,    f1 (x, t, u, w)      . . f (x, t, u, w) =   .     fm (x, t, u, w)  

(2.60)

In accordance with the standard assumptions used in the derivation of the extended ^ is assumed to be close to the true state x and the noise Kalman filter, the state estimate x processes w and v are assumed to be small [6]. Then, the nonlinear system equations (2.58) and (2.59) can be approximated by linearization, using first-order, multi-variable Taylor series expansions, x  f (x ^, t, u, 0) +
.

f x

^,t,u,0 x

(x - x ^) +

f w h v

w,
^,t,u,0 x

(2.61)

^, t, 0) + y  h(x

h x

^,t,0 x

(x - x ^) +

v
^,t,0 x

(2.62)

19

The matrices that appear in (2.61) and (2.62) are defined as Fx = f x ,
^,t,u,0 x

Hx =

h x

,
^,t,0 x

w =

f w

,
^,t,u,0 x

v =

h v

,
^,t,0 x

(2.63)

also the following vectors are defined, ~ = f (x ^, t, u, 0) - F x x ^, u ¯ = h(x ^, t, 0) - H x x ^ y (2.64)

With the above definitions, the equations (2.58) and (2.59) can be written in linear approximation form as x = f (x ^, t, u, 0) + F x x - F x x ^ + w w , leading to x = Fx x + u ~ + w w and ^, t, 0) + H x x - H x x ^ + v v , y = h(x
. .

(2.65)

¯ = H x x + v v , y = y - y

(2.66)

~, given in (2.64), is a known input in the linearized system specified by equation where u (2.65). Next, the matrix F x is partitioned as    F x ,1     .  Fx =  . . ,     F x , m   

20

which, in accordance with (2.64) leads to   u ~   1  .  ~i =  . u . ,     u ~   m

~ can now be written as so that u

~ i = fi (x ^, t, u, 0) - F x,i x ^, u

i = 1, ..., m - 1

(2.67)

Now, the surface-constrained, continuous-time linear Kalman filter, developed in the previous section, can be applied to the linear system defined by the equations (2.65) and (2.66). The right hand side of the system state estimate equation can be written as ^+u ~ i + Ki,unc (y - H x x ^) i = F x,i x ^, t, u, 0) + Ki,unc (y - h(x ^, t, 0)) = fi (x ^, t, u, 0) + Ki,unc y ~, = fi (x where ~ = (y - h(x ^, t, 0)) y is the measurement estimate error. The estimator structure corresponding to (2.68), for a gain K can be written as ^ = Fx x ^+u ~ + K ( y - H x x ^) , x or substituting (2.66), as ^ = Fx x ^+u ~ + K (H x x + v v - H x x ^) x ^+u ~ + K (v v + H x x ~) , = Fx x ~ =x-x ^ is the estimation error. where x
. .

(2.68)

i = 1, ..., m - 1 ,

(2.69)

(2.70)

(2.71)

21

Now, using (2.65) and (2.71), the estimation error rate can be stated as follows, ~ =x - x ^ x ~ + w w - F x x ^-u ~ - K (v v + H x x ~) = Fx x + u ~ + w w - K v v = (F x - KH x )x (2.72)
. . .

Then, as per the estimate error covariance matrix definition from the previous section, ~x ~T }, the estimate error covariance rate can be written as P = E {x
T T P = (F x - KH x )P + P (F x - KH x )T + w QT w + K v Rv K .

(2.73)

As in the previous section, the Kalman gain K is selected by minimizing the cost function
. 1 J = trace[P ] , 2

while enforcing the constraints. In the partitioned form, the derivative of the cost function with respect to gain is  Ji T = -PiT H x + Ki v RT v,  Ki for the unconstrained case Ji is minimized when
T -PiT H x + Ki,unc v RT v = 0,

i = 1, ..., m ,

(2.74)

i = 1, ..., m ,

that is
T -1 Ki,unc = PiT H x (v RT v) ,

i = 1, ..., m ,

and since P is symmetric,
-1 T Kunc = P H x (v RT v)

(2.75)

22

In consequence of equation (2.74) having term v RT v instead of R, as in the equation (2.31) (which is a part of the Lagrangian gradients (2.37)), the Lagrangian method leads to the following constrained gain equation for the extended Kalman filter,  T -1 coli=1,...,m-1 GT i [Gi Gi ] Gi i K = Kunc -    0nx, m ×1   T T -1  y  ~ (v Rv ) y T ~  ~T (v Rv )-1 y 

(2.76)

The surface-constrained continuous-time extended Kalman filter is summarized in table 2.2.

23

Table 2.2: Surface-Constrained Continuous-time Extended Kalman Filter Estimator Constrained state estimate rate equation: . ^ i = i i , x i = 1, ..., m - 1 The unconstrained term of the constrained state estimate rate equation: ^, t, u, 0) + Ki,unc y ~, i = fi (x i = 1, ..., m - 1 Measurement estimate error: ~ = y - h(x ^, t, 0) y The term that enforces constraints in the state estimate rate equation: T -1 i = 1nx, i ×nx, i - GT i = 1, ..., m - 1 i [Gi Gi ] Gi , Constraint Jacobian matrix: ^i )  gi (x ^i ) = Gi (x , ^i x (2.51) (2.68) (2.69) (2.52)

i = 1, ..., m - 1

(2.18)

Unconstrained state estimate rate equation: . ^ m = fm (x ^, t, u, 0) + Km,unc y ~ x Gains The optimal Kalman gain matrix for the entire unconstrained system:
T -1 Kunc = P H x (v RT v)

(2.75)
-1 ~T (v RT y v) -1 ~ ~T (v RT y v) y

Constrained Kalman gain matrix: T -1 coli=1,...,m-1 GT i [Gi Gi ] Gi i K = Kunc - 0nx, m ×1 Covariance Propagation

(2.76)

Error covariance rate equation: . T T P = (F x - KH x )P + P (F x - KH x )T + w QT w + K v Rv K Jacobian Matrices Icluding dynamics Jacobian F x and measurement Jacobian H x : Fx = f x ,
^,t,u,0 x

(2.73)

Hx =

h x

,
^,t,0 x

w =

f w

,
^,t,u,0 x

v =

h v

^,t,0 x

(2.63)

24

Chapter 3 Dynamics of a Ball Rolling on a Known Surface
In this chapter, the equations of motion for a ball (with embedded off-center point mass) rolling on a known surface without slipping, under influence of external force, will be derived. First, the surface equation, the ball parameters, as well as the external force, will be defined. Then, the constraint for the contact point between the ball and the surface as well as constraint for the geometric center of the ball, will be formulated. Next, the no-slip condition, constraint will be specified. These will be followed by formulation of the kinetic and potential energies as well corresponding Lagrangian. Finally, the above results will be employed in Lagrange multiplier method, which will be used to find the constrained Lagrange's equations of motion for the rolling ball.

3.1

Surface and Ball Parameters

In the following derivation it is assumed that the ball is rolling without slipping on a surface. The description of the relevant reference frames and vectors, shown in figure 3.1, will be given next. In the figure 3.1, the symbol I indicates inertial reference frame, b indicates the reference frame of the ball, c the contact point between the ball and the surface, m a point ì bI , indicates mass embedded within the ball. The two-symbol superscript, such as in r ì extends from the location indicated by the second symbol to the location that the vector r 25

z ^b m r mb x ^b g (rI ) = 0 z ^ r bI Fb y ^b ^ Rn

fb

r cI y ^

FI 0 x ^

Figure 3.1: Ball rolling on a surface. indicated by the first symbol, which is in the given case from the origin of the inertial frame to the center of the ball. The surface is specified in the the global, inertial coordinate frame FI which is defined by the set of Cartesian basis vectors, ì T = [x ^, y ^, ^ z]T , F I (3.1)

ì T , is a vectrix [22], the type of a vector with the reference frame's unit the 3 × 1 vector F I vectors as its components. The surface is given by the following expression, g (r I ) = 0 , (3.2)

ì T rI , ì=F where r I = ( x, y, z ) is a point on the surface, the position of that point is given by r I and g : R3  R (the function g takes coordinates from 3D real coordinate space and outputs real 1D space coordinates) as well as g  C 3 (g is three times continuously differentiable). The body-fixed, ball reference frame Fb has its origin at the geometric center of the ball and is defined as ì T = [x ^b, y ^b, ^ F zb ]T b (3.3)

26

The ball has uniform density, mass M and radius R, and so its moment of inertia is given by 2 M R2 Ib = 1, 5 (3.4)

where 1 is a 3 by 3 identity matrix. A point mass m is embedded within the ball at a position ì T r mb ì mb = F r b b (3.5)

mb = ( x mb, y mb, z mb ). An external force f ìb from the geometric center of the ball, where rb b b b

is acting at the geometric center of the ball, this force is given by ìb = F ìTfb f I I (3.6)

3.2

Ball-Surface Contact Condition

As shown in figure 3.1, the point of contact of the ball in the inertial reference frame is ì T r cI , and the position of the ball's geometric center in the inertial frame ì cI = F given by r I I ì T r bI . The center and the contact point must satisfy the following ì bI = F is given by r I I equation, ^ ì bI = r ì cI + Rn ì, r where ^ ìTn ì =F n I ^I (3.8) (3.7)

ì cI , pointing upward. As is the unit vector normal to the surface g at the point of contact r the contact point is on the surface, it must satisfy equation (3.2),
cI g rI =0

(3.9)

27

By definition the gradient g is perpendicular to g , thus ^I = n
cI / r  g rI I cI / r  g rI I

(3.10)

is the unit normal vector, which is assumed to be pointing in upward direction. If initially, ^ I is pointing downward, the sign of g (r I ) can be changed to the opposite. In terms of n vector coordinates equation (3.7) can be written as ^I r IbI = r IcI + Rn (3.11)

Surface contact constraint (3.9) and ball center constraint (3.11) equations are holonomic (relations between coordinates) constraints that have to be satisfied. The inertial velocity of the contact point of the ball is given by
. cI ìT r ì cI = F v I , I

(3.12)

the inertial velocity of the center of the ball is
. bI ìT r ì bI = F v I , I

(3.13)

where, r I is obtained from (3.11), r I = r I +R n ^I
. bI . cI .

. bI

(3.14)

Differentiating (3.10) with respect to time gives
. cI / r d /dt  g r I cI / r -  g r cI / r  g rI I cI / r  g rI cI / r d /dt  g r I

^I = n

2

,

cI )/ r , u[x(t )] =  g r cI / r , x(t ) = r cI , then let f {u[x(t )]} =  g (r I I I

d x . cI = rI , dt

28

cI . cI d u  u d x  2 g rI r , = = dt  x dt  r  rT I T

cI / r cI  g rI  2 g rI . cI df  f u dx r = = , cI / r dt  u  x dt  r  rT I  g rI

hence ^ I= n
.

1
cI )/ r  g (r I

cI  2 g rI

 r  rT

rI -
T cI  2 g rI

. cI

g 2 cI )/ r r  g (r I 1 which leads to ^ I= n
.

cI rI

cI / r  g rI

g

cI rI

/ r

 r  rT

rI ,

. cI

1 g
cI rI

/ r

1-

1
cI  g rI

cI  g rI 2 r / r

cI  g rI r

T

cI  2 g rI

 r  rT

rI

. cI

(3.15)

Substituting (3.15) into (3.14) gives
. bI . cI rI = rI

+

R g
cI rI

/ r

1-

1
cI  g rI

cI  g rI 2 r / r

cI  g rI r

T

cI  2 g rI

 r  rT

rI ,

. cI

using the unit normal vector expression (3.10) in the above equation, gives r I =r I + or r I = A r IcI r I ,
. bI . cI . bI . cI

R
cI / r  g rI

cI cI ^ I rI ^ I rI 1-n n

T

cI  2 g rI

 r  rT

rI ,

. cI

(3.16)

29

where A r IcI =1+ R
cI / r  g rI

1-

cI ^ I rI n

cI T ^ I rI n

cI  2 g rI

 r  rT

(3.17)

Constraint equation (3.16) is non-holonomic (velocity-dependent) representation of the holonomic, ball center constraint equation (3.11). Similarly, differentiating holonomic surface constraint equation (3.9) with respect to time, produces the non-holonomic surface constraint,
cI  g rI r T

rI = 0

. cI

(3.18)

3.3

Kinetic and Potential Energies

It is assumed that CbI  SO (3) (the set of all three-dimensional rotation matrices) is the rotation matrix mapping coordinates from the inertial frame F I to the ball reference frame Fb . Furthermore, CbI completely describes the attitude of the ball in the inertial reference frame. The angular velocity vector of the ball can be written as ì T w bI , ì bI = F w b b (3.19)

ì bI , which hence, the ball rotates about the axis lying along the angular velocity vector w points from the origin of the inertial frame to the center of the ball. Equation (3.19) defines the angular velocity in the body-fixed coordinate system of the ball. The rotational kinematics of the ball satisfy Poisson's equation [22],
bI C bI = - wb . ×

CbI ,

(3.20)

bI )× is the angular velocity skew-symmetric matrix. where (wb

30

The kinetic energy of the ball (the translational kinetic energy plus the rotational kinetic energy) is given by the following equation, Tb =
. bI 1 M rI 2 T . bI rI

+

1 bI T bI  Ib b 2 b

(3.21)

It can be seen from figure 3.1 and equation (3.5), that the point mass m, embedded within the ball, has inertial position specified by ì T r bI + C T r mb ì mI = r ì bI + r ì mb = F r I I bI b (3.22)

ì T (specified Taking the derivative of (3.22) with respect to time and noting that neither F I
mb (specified in figure 3.1) are time dependent, gives the following in equation 3.1) nor rb

equation for the inertial velocity of the point mass,
T . bI mb ìT r ì mI = F v , I + C bI rb I .

using (3.20) leads to
. bI ìT r ì mI = F v I - I bI b × T

CbI
× mb rb bI b

mb rb

. bI T bI ìT r =F I + CbI b I . bI T mb ìT r =F I - CbI rb I

(3.23)

×

Using the inertial velocity expression (3.23), the kinetic energy for the point mass can be written as follows,

31

× × . bI . bI 1 T mb bI T mb bI r I - CbI Tm = m r I - CbI rb b rb b 2 . bI T . bI 1 rI = m rI 2 × × . bI T T 1 1 mb T mb bI bI - m r I CbI rb rb b - m CbI b 2 2 × × 1 T mb bI T mb bI + m CbI rb b CbI rb b 2 × . bI T . bI . bI T T 1 1 mb bI bI r I - m r I CbI rb b - m b = m rI 2 2 T

T

T

rI

. bI

(3.24)

T

mb rb

×

mb bI rb b

×

Combining the kinetic energy of the ball (3.21) and the kinetic energy of the embedded mass (3.24) gives the expression for the total kinetic energy,

T = Tb + Tm =
. bI T . bI 1 bI T 1 bI r I + b M rI Ib b 2 2 × T × × . bI T T . bI T . bI 1 1 mb bI bI mb mb bI r I - m r I CbI rb b - m b rb + m rI rb b 2 2 × . bI T . bI . bI T T 1 mb bI r I - m r I CbI rb b = ( M + m) r I 2 × × 1 bI T mb bI mb + b rb b Ib - m rb 2 × . bI T . bI . bI T T 1 bI T 1 bI mb bI r I - m r I CbI = ( M + m) r I rb b + b Jb b , 2 2 (3.25)

where
mb Jb = Ib - m rb × mb rb , ×

(3.26)

is the resulting moment of inertia of the ball and point mass, about the geometric center of the ball.

32

ì I direction, causing It is assumed that the gravitational force is acting in the negative z acceleration g . Hence the gravitational potential energy for the ball is ì bI · z ìI Vb = M g r
bI = M g rI T

(3.27)

e3

where e3 = [0, 0, 1]T . The potential energy for the point mass is defined in a similar manner and with the use of (3.22), ì mI · z ìI Vm = m g r
bI = mg r I T mb e3 + mg rb CbI e3 T

(3.28)

The combination of (3.27) and (3.28) gives the total gravitational potential energy, V = Vb + Vm = ( M + m )g
bI rI T

e3 + mg

mb rb

T

(3.29) CbI e3

Using the total kinetic energy equation (3.25) and the total gravitational potential energy equation (3.29), the Lagrangian for the ball and point mass system can be written in the following way, L =T -V
. bI 1 = ( M + m) r I 2 T . bI rI T

- m rI

. bI T

T mb bI CbI rb b + T

×

1 bI  2 b

T

bI Jb b

(3.30)

bI - ( M + m )g r I

mb e3 - mg rb CbI e3

3.4

No-Slip Condition

The no-slip condition requires that the inertial velocity (with respect to the surface) of the instantaneous point of contact is zero. It should be noted, that the instantaneous 33

point of contact has a fixed location on the ball, hence it rotates with the ball and should satisfy the non-slip condition when it becomes instantaneously in contact with the surface and its position vector relative to the center of the ball coincides with the position vector ^ ì (figure 3.1). Therefore, the inertial velocity of the instantaneous point of contact is - Rn different from the inertial velocity of the point of contact between the ball and the surface, given by equation (3.12) (this point is not fixed on the ball, but exists between the ball and the surface only, hence for example, if the ball is stationary but spinning with slipping, then the ball's center velocity is zero, the velocity of the point of contact between the ball and the surface is zero, however the velocity of the instantaneous point of contact is non-zero). Equation (3.7) can be rearranged to express the inertial position of the instantaneous point of contact between the ball and the surface,
cI ^ ìinst ìbI - Rn ì, r =r

(3.31)

where the subscript inst is used in order do indicate the instantaneous point of contact and ìcI . to distinguish it from the point of contact between the ball and the surface r The no-slip condition is satisfied when the vector sum of the inertial velocity of the ball center and the inertial velocity of the instantaneous point of contact relative to the ball center, is equal to zero, that is d cb d bI ì, ì + ì r r =0 dt dt inst (3.32)

cb is the position of the instantaneous point of contact relative to the center of the ìinst where r

ball in the coordinate system of the ball. Using equation (3.31) and applying transport theorem [21], the inertial velocity of the instantaneous point of contact can be expressed as, d cb cb ì ì bI × r ìinst r =w , dt inst (3.33)

34

according to the above description, at the moment of contact with the surface, the position ^ ìcb = - Rn ì, vector of the instantaneous point of contact relative to the center of the ball, is r
inst

thus d cb ^ ì ì bI × n ì, r = -R w dt inst substituting (3.34) into (3.32) leads to the following no-slip condition equation, d bI ^ ì, ì - Rw ì bI × n ì =0 r dt (3.35) (3.34)

ìbI which indicates that for no-slip, the magnitude of the velocity of the ball's center d /dt r should be equal to the magnitude of the velocity of a point on the surface of the ball ^ ì bI × n ì , located in the direction perpendicular to  ì bI . This equation can be expressed Rw as d bI ^ ì = - Rn ì ×w ì bI , r dt ìb = CbI F ìI (as per rotation now, using equations (3.8), (3.13), (3.19) and the relationship F matrix definition from section 3.3), the above equation can be written as
. bI ìTr ìT ^I × F I I = -R F I n

ìI CbI F

T

bI wb ,

which leads to
T bI r I = -R n ^× I CbI b . bI

(3.36)

Equation (3.36) is an additional non-holonomic (velocity-dependent) constraint that must be satisfied.

35

3.5

Lagrange's Equations of Motion

As a first step, the rotation matrix CbI (which is mapping coordinates from FI to Fb , as described in section 3.3) is parameterized by itself, following the approach given in [19], the parameter is defined as    c1      p =  c2  ,      c3    derivative of the parameter p satisfy kinematic relationships,
bI b = S (p) p .

(3.37)

T . As shown in [19] the angular velocity and the time where ci is the i th column of CbI

(3.38)

and
bI p = (p) b , .

(3.39)

as well as a non-holonomic constraint (p) p = 0 ,
.

(3.40)

where matrices S (p) , (p) and (p) are parametric functions. Matrix (p) has full row-rank. Moreover, reference [19] provides the following identities (which will be used in the Lagrange's method), (p)(p) = 0 , S (p)(p) = 1 ,  CbI v (p) = CbI v p T for any v  R3 , as well as
. bI  b bI (p) = - b × Tv  CbI

(3.41)

×

,

p T

T × (p) = -CbI v ,

(3.42)

S (p) -

 pT

(3.43)

36

The generalized coordinates are specified as  bI  r I     cI  q = r I      p  

(3.44)

The non-holonomic (velocity-dependent) constraints, which have to be satisfied are specified by (3.16), (3.36) and (3.40). The first two equations can be written as follows: ball center inertial velocity constraint (3.16) ,
cI r I - A rI rI = 0 , . bI . cI

(3.45)

no-slip condition constraint (3.36),
T bI r I + Rn ^× I CbI b = 0 . bI

(3.46)

Now, the three non-holonomic constraints can be expressed in matrix form, W q = 0, where   W 1      W = W 2  ,     W 3   
.

(3.47)

(3.48)

37

and W1 = 1 W2 = 1 W3 = 0
cI - A rI

0 (3.49)

0 0

T ^× Rn I CbI S (p)

(p)

cI is invertible (non-singular), so that the matrix W (3.48) has It is assumed that A r I

full row-rank. Thus, the constraints can be introduced in Lagrange's equations using the Lagrange multiplier method.
bI , Using the generalized coordinates specified by (3.44) and virtual displacement r I

the virtual work W associated with the force f IbI given in (3.6) (and shown in figure 3.1) can be written as
bI T b ¯, f I =  qT f W =  r I

(3.50)

where the generalized external force is specified as  bI  f I     ¯=  f  0       0    Now, the Lagrange's equations of motion can be written as follows, d L L ¯ + W T 1 + W T 2 + W T 3 , =f . - 1 2 3 dt  q q (3.52)

(3.51)

where 1 , 2 and 3 are Lagrange multipliers, which are vectors with appropriate dimensions. Using the Lagrangian L specified by (3.30), the derivatives in the right hand side of (3.52) can be found. First, the components of  L / q are calculated.
.

38

L rI
. bI

=


. bI

rI 1 bI + b 2

. bI 1 ( M + m) r I 2 T

T . bI rI

- m rI

. bI T

T mb bI CbI rb b T

×

bI bI Jb b - ( M + m )g r I ×

T

mb e3 - mg rb CbI e3

(3.53)

T mb bI rb b , = ( M + m) r I -mCbI

. bI

L rI
. cI

= 0,

(3.54)

substituting equation (3.38) into the Lagrangian L and then taking the partial derivative with respect to p , leads to L mb T . = mS (p) rb p
× bI CbI r I + S (p)T Jb b . bI .

(3.55)

Differentiating (3.53), (3.54) and (3.55) with respect to time, in order to evaluate d /dt ( L / q ), and using (3.20), leads to
.

× .T .. bI d L mb bI T mb r b - m CbI rb r = ( M + m ) - m C I bI b . dt  r bI I T = ( M + m) r I + m CbI .. bI .. bI bI b × T ×

× . bI b × . bI b

mb bI T mb rb b - m CbI rb ×

(3.56)

T bI = ( M + m) r I - m CbI b

×

mb bI T mb rb b - m CbI rb

× . bI b ,

d L . cI = 0 , dt  r I

(3.57)

39

× . . bI d L T mb mb CbI r I + mS (p)T rb . = mS (p) rb dt  p × .. bI .

× .

C bI r I

. bI . bI

mb bI + mS (p)T rb CbI r I + S (p)T Jb b + S (p)T Jb  b mb bI = S (p)T m rb CbI r I + Jb b mb mb + S (p)T m rb CbI r I - m rb × .. bI × bI b × . × . bI

(3.58)
. bI . bI

CbI r I + Jb  b

Next, the  L / q term of the Lagrange's equations of motion (3.52) will be evaluated, by taking the required derivatives of the Lagrangian L (3.30), L = - ( M + m)g e3 , bI  rI L = 0, cI  rI
. bI  L =- m rI p p T ×

(3.59)

(3.60)

T mb bI CbI rb b +

 1 bI  p 2 b

T

bI Jb b

-

T  mb mg rb CbI e3 p T  CbI mb rb T bI Jb b × T bI b . bI rI

= -m

 pT
bI  b

+m

bI  b

T

 pT
T mb rb ,

mb CbI r I rb

×

. bI

+

 pT

 CbI e3 - mg  pT

which can be rearranged as

bI  b L = p  pT

T

mb bI m rb CbI r I + Jb b -m

×

. bI

T  CbI

 pT

mb bI rb b

×

T

rI

. bI

- mg

 CbI e3  pT

T mb rb

(3.61)

40

Now all the components of the Lagrange's equations of motion (3.52) are specified. The right hand side components are given by (3.56) - (3.61) and the left hand side components
bI (the first component of are given by (3.49), (3.51). The Lagrange's equations for r I

equation (3.52), where (3.49), (3.51), (3.56) and (3.59) have been used) are as follows, d L L - bI = fIb + 11 + 12 + 03 , . bI dt  r  rI I which leads to
T bI ( M + m) r I - m CbI b .. bI × mb bI T mb rb b - m CbI rb × × . bI b

=

f Ib

- ( M + m)g e3 + 1 + 2

(3.62)

cI (the second component of equation (3.52), The Lagrange's equations of motion for r I

where (3.49), (3.51), (3.57) and (3.60) have been used) are given by, d L L cI = 0 - A rI . cI - cI dt  r  r I I which leads to
cI 0 = -A r I T T

1 + 02 + 03 ,

1

(3.63)

cI ) is non-singular (invertible, with non-zero determinant), hence It is assumed that A(r I

1 = 0 (since if there exists 1

0 such that 0 = -AT 1 , then A must be singular).

bI , given in (3.62), can be written as Therefore, the Lagrange's equations for r I

T bI ( M + m) r I - m CbI b

.. bI

×

mb bI T mb rb b - m CbI rb

×

× . bI b =

f Ib - ( M + m)g e3 + 2 (3.64)

The Lagrange's equations of motion for p (the third component of equation (3.52), where (3.49), (3.51), (3.58) and (3.61) have been used) are as follows,

41

× . . bI L d L mb bI = S (p)T m rb CbI r I + Jb b . - dt  p p mb mb + S (p)T m rb CbI r I - m rb bI  b T × . bI × .. bI × bI b ×

CbI r I + Jb  b
mb rb T × bI b

. bI

. bI

-

 pT

m

mb rb T

bI CbI r I + Jb b +m

T  CbI

T

 pT

rI

. bI

+ mg

 CbI e3  pT

mb T T ^× rb = 0 + 01 + R n I CbI S (p) 2 + (p) 3 ,

which can be written as

mb mb S (p)T m rb CbI r I - m rb

×

.. bI

×

bI b

×

CbI r I + Jb  b +m
T  CbI

. bI

. bI T bI b

+ S (p) -

.

bI  b

T

 pT
T

m

mb rb

×

. bI CbI r I

+

bI Jb b

 pT

mb rb

×

rI

. bI

(3.65)

 CbI e3 + mg  pT

mb T ^× rb = - RS (p)T CbI n I 2 + (p) 3

Multiplying (3.65) by (p)T (which appear in identities (3.41), (3.42) and (3.43)), gives
T

S (p)(p) + S (p) -
.

mb mb m rb CbI r I - m rb bI  b T ×

×

.. bI

×

bI b

×

CbI r I + Jb  b

. bI

. bI

 pT

(p)
×

bI mb m rb CbI r I + Jb b T

. bI

+m

T r mb  bI  CbI b b

 pT
T

(p) r I

. bI

+ mg

T T  CbI e3 mb × ^  ( p ) r = - R S ( p )  ( p ) C n  +  ( p )  ( p ) 3 , bI 2 I b  pT

42

mb )× and  bI are kept fixed in the the differentiation with respect to p in the third where (rb b

term on the right-hand side of the above equation, applying identities (3.41), (3.42) and (3.43) to this equation gives the following result,
mb mb m rb CbI r I - m rb bI + b × × . bI × .. bI × bI b ×

CbI r I + Jb  b

. bI

. bI

mb bI m rb CbI r I + Jb b × × mb r I - mg (CbI e3 )× rb ^× = - RCbI n I 2 . bI

(3.66)

+m

mb bI rb b

Thus the Lagrange multiplier 3 has been eliminated. Equation (3.66) can written as
mb bI m rb CbI r I +Jb  b + b × .. bI . bI × bI Jb b ×

+m

bI b

×

mb rb

×

mb - rb

×

bI b

+

mb bI rb b

×

×

CbI r I

. bI

(3.67)

mb ^× - mg (CbI e3 )× rb = - RCbI n I 2

Using the identities a× b× = baT - aT b 1 and (a× b)× = baT - abT , in the second term on the left-hand side in (3.67) leads to
mb bI m rb b T bI b T mb bI mb rb 1 - b rb T . bI T

-
T

+

mb bI rb b 1

T

bI mb + b rb

mb bI - rb b

CbI r I = 0 ,

hence, equation (3.67) can be expressed as
mb bI m rb CbI r I +Jb  b + b × .. bI . bI × bI Jb b - mg CbI e3 × mb ^× rb = - RCbI n I 2 (3.68)

43

Now the remaining Lagrange multiplier 2 will be eliminated. In order to do this, equations (3.64) and (3.68) (both have 2 ) are assembled in a single vector form as

×  T r mb   .. bI  -mCbI  ( M + m)1   rI  b   + ×    . bI  mb C m r b   b  J bI b     b     f I - ( M + m) g e3    1  +  2 , ×    mb C e × - m g r b   ^ - R C n bI 3 bI I     

× ×  T  bI mb  bI  r -m CbI b b b     = ×   bI bI   b Jb b  

(3.69)

which can be written in compact form as  .. bI   rI   ¯ M  . bI  + fnon = fext + W 2 ,  b   

(3.70)

where the definition of each term can be inferred from (3.70) and fnon , fext are nonlinear and external forces respectively. Using the no-slip condition (3.36), the following expression can be specified,  . bI   rI    =  r cI , p  bI , I b  bI   b    where  T - R n  ^× I CbI   =    1  

(3.71)



cI rI ,p

(3.72)

It can be clearly seen that ¯ =0 T W (3.73)

44

Taking the derivative with respect to time of (3.71), gives  .. bI  .  rI  . bI cI bI   =  r cI , p  +  rI , p b b I  . bI   b    Substitution of (3.74) into (3.70) results in
. bI bI ¯ 2 , M   b +M   b + fnon = fext + W .

(3.74)

multiplying both sides of the above equation by T and using (3.73), eliminates the remaining Lagrange multiplier, 2 , and leads to
bI T M   b +T M  b + T fnon = T fext . bI .

(3.75)

Now each term of (3.75) will be evaluated. Differentiating (3.72), gives
.× .T   T - Rn - R n ^ I CbI ^× C bI  I   =     0   .× T  T + Rn bI × C - R n  ^ I CbI ^× b bI I  =     0   .×   T - Rn T bI ×  - R n ^ I CbI ^× I CbI b  , =    0   .

(3.76)

where substitution of (3.20) has been made. The time derivative of the unit normal is given by (3.15), ^ I= n
.

1
cI )/ r  g (r I

cI  g rI 1- cI )/ r 2 r  g (r I

1

cI  g rI r

T

cI  2 g rI

 r  rT

rI ,

. cI

45

using (3.10), (3.15), (3.16) and (3.36) in the above equation, gives ^I = n
.

1
cI / r  g rI

^ In ^T 1-n I 1- ^ In ^T n I

cI  2 g rI

 r  rT

cI A rI

-1 . bI rI

=-

R
cI / r  g rI

cI  2 g rI

(3.77) A
cI -1 × T bI ^ I CbI b , rI n

 r  rT

equation (3.77) can be simplified using (3.17), ^I = - n
.

R g
cI rI

/ r

^ In ^T 1-n I
-1

cI  2 g rI

 r  rT

cI A rI

-1

T bI ^× n I CbI b

cI cI = - A rI - 1 A rI cI = A rI -1

T bI ^× n I CbI b

(3.78)

T bI ^× -1 n I CbI b ,

using (3.69), (3.70), (3.72) and (3.76), the terms in (3.75) can be expressed as follows,

 M

T

. bI b

= -R

T T ^× n I CbI

  ( M + m )1 1  ×  mb C m r b bI 
×

× T r mb  -mCbI  b    Jb 

 T - R n  . bI ^× CbI I     b   1  
×

mb C = RCbI n ^× bI I ( M + m) + m r b

T mb ^× -mRCbI n I CbI rb

+ Jb

 T - Rn  ^× I CbI  . bI    b   1  
× . bI

T mb T ^× ^× ^× CbI Rn = - RCbI n I CbI I ( M + m ) Rn I CbI - m rb T mb ^× - mRCbI n I CbI rb

×

+ Jb  b

T ^× ^I ^× = Jb - ( M + m) R2 CbI n In I CbI - mR CbI n mb - mR rb ×

×

mb rb

×

^I CbI n

×

b , (3.79)

. bI

46

bI mb C T M  b = RCbI n ^× bI I ( M + m) + m r b .×  T - Rn T bI - R n ^ I CbI ^× I CbI b    0  .× ×

.

×

T mb ^× -mRCbI n I CbI rb

×

+ Jb

 bI   b  
×

T T bI ^× ^ I CbI ^× ^× = - RCbI n - RCbI n I ( M + m) R n I ( M + m) R n I CbI b mb T mb T bI ^ I CbI ^× - m rb CbI R n - m rb CbI R n I CbI b T bI mb ^× ^ I CbI = -( M + m) R2 CbI n b + mR rb I n .× × × .× × × bI b

^I CbI n

.

×

bI b ,

(3.80)
× ×  T  bI mb  bI  r -m CbI b b b     1  ×   bI bI   b Jb b   × mb bI bI rb b + b × × bI Jb b ,

T T fnon = - R n ^× I CbI

T

(3.81)

bI ^ I )×  b = -mR(CbI n

 fext = - R
T

T T ^× n I CbI

  b  fI - ( M + m) g e3   × 1   mb C e  -mg rb bI 3   

(3.82)
×

mb b ^× CbI e3 = RCbI n I f I - ( M + m)g e3 - mg rb

Equation (3.75) can be written as
bI T M   b = - T M  b - T fnon + T fext . bI .

(3.83)

Substituting expressions (3.79) to (3.82) into (3.83) gives dynamic equation for a ball with off-center point mass, rolling without slipping on a surface,
. bI ~ ~ ~  M b = fnon + fext ,

47

solving for angular acceleration of the ball leads to
. bI ~ ~ ~ -1 (f b = M non + fext ) ,

(3.84)

~ is the generalized mass matrix or the combined moment of inertia of the ball where M and the embedded point mass, which varies due to rotation of the point mass about the ball's geometric center,
T ~ = Jb - ( M + m) R2 CbI n ^× ^× ^I M In I CbI - mR CbI n × mb rb × mb - mR rb ×

^I CbI n

×

,

(3.85) ~ the term f non represents the nonlinear forces that arise to the rotation of the ball and the point mass, ~ ^I f non = mR CbI n
mb - mR rb × × bI b × . mb bI bI rb b - b × bI b , × × bI T bI ^× ^ I CbI Jb b + ( M + m) R2 CbI n b I n .×

^I CbI n

(3.86)

~ext represents an external force f b (other than gravity) that acts on the geometric finally f I center of the ball, as well as force due to gravity g acting on the ball and the point mass in e3 = [0, 0, 1]T direction,
b mb ~ext = RCbI n ^× f CbI e3 I f I - ( M + m)g e3 - mg rb ×

(3.87)

3.6

Equations of Motion Summary

It is evident from (3.84) to (3.87) and (3.10), (3.78) that the dynamic equation depends
cI , as well as angular velocity  bI . Thus, on the ball's attitude CbI , contact point position r I b cI for complete description of the motion of the ball, the kinematic equations for CbI and r I

are required in addition to the dynamic equation (3.84). The kinematics for CbI is given by Poisson's equation (3.20),
bI C bI = - wb . ×

CbI ,

48

for computational simplicity, the rotation matrix CbI is parameterized by the unit quaternion q  S3 (a member of a 3-manifold in 4D space) with vector part   R [22] ,      q=       By definition, the unit quaternion must satisfy the unit-norm constraint, qT q - 1 = 0 (3.89)  R3 and scalar part

(3.88)

The parameterization of CbI is accomplished in the following way [22] , CbI = 2 -
. T

1+2

T

- 2 ×,

(3.90)

where the right hand side of the above equation is the quaternion rotation operator [23] , now C bI can be represented by [22] , .    q=  . ,     
.

(3.91)

where
.

=

1 2
.

×

bI +  1 b ,

(3.92)

= -

1 2

T

bI b

(3.93)

cI is specified by the non-slip condition (3.36) together with the The kinematics for r I

contact condition (3.16), so that from (3.36),
T bI r I = - Rn ^× I CbI b , . bI

49

and from (3.16), r I = A r IcI r I ,
. bI . cI

cI , combining the two above expressions, gives the kinematic equation for r I . cI

r I = - RA-1 r IcI n ^ I r IcI

×

T bI CbI b

(3.94)

The state vector for the rolling ball can be expressed as   x1      x = x2  ,     x3    where x1 =
bI , r cI rI I T T T bI . , x2 = q, x3 = b

(3.95)

The dynamic model for the rolling ball is given by the time derivative of the state vector (3.95), .  x1    . .  x = x2  ,   .  x3    where x1 =
.

(3.96)

rI

. cI T

, rI

. bI T T

, x2 = q , and x3 =  b , are the equations of motion

.

.

.

. bI

summarized in the table 3.1.

50

Table 3.1: Equations of Motion of the Ball Rolling on a Surface Without Slipping The ball contact point kinematic equation of motion:
cI cI T bI r I = - R A-1 r I ^ I rI n CbI b . cI ×

(3.94)

The ball center kinematic equation of motion:
T bI r I = - Rn ^× I CbI b . bI

(3.36)

The ball attitude kinematic equation of motion: q= where
. . .



.

,

(3.91) (3.92) (3.93)

1 bI = ( × + 1) b , 2 . 1 bI  = - T b 2

The angular velocity dynamic equation of motion:
. bI bI cI cI ~ ~ ~ -1 q , r cI f b = M non b , q , r I + fext q , r I I

(3.84)

51

Chapter 4 Surface-constrained Continuous-time Extended Kalman Filter for a Ball Rolling on a Known Surface
The surface-constrained continuous-time extended Kalman filter derived in chapter 2, can be applied to various surface-constrained dynamic systems. The derivation in chapter 3, provides dynamics formulation for a particular dynamic system - a ball rolling without slipping on a known surface. Now the terms in the surface-constrained filter can be defined using the rolling ball dynamics, to produce a surface-constrained continuous-time extended Kalman filter specific to a ball rolling on a known surface. Based on the rolling ball dynamics formulation, section 4.1 of the current chapter defines the constraints for use in the Kalman filter, while section 4.2, specifies the measurements used for optimal estimation and defines all the terms of the filter.

4.1

Surface Constraints for a Rolling Ball

The ball is rolling on a known surface, which can be represented by the following function, z = f ( x, y ) , such that g ( x, y, z ) = g (r I ) = z - f ( x, y ) = 0 , (4.1)

52

where r I = [ x, y, z]T is the position vector of a point in inertial reference frame FI - the coordinate system where the surface is defined, as shown in figure 4.1. It follows from chapter 3, that there are three constraint equations in the ball dynamics. First states that the contact point of the ball must stay on the surface. Hence, if the contact
cI vector, which extends from the inertial frame's origin to point position is specified by r I

the point of contact (figure 4.1), then it follows from (4.1) that it must satisfy
cI g (r I )=0

(4.2)

The second ensures that ball center point stays the radius away from the contact point, in the direction of positive normal to the surface. If the ball's geometric center position is
bI vector, which extends from the origin of the inertial frame to the center of specified by r I

the ball (figure 4.1), the positive unit normal vector (pointing upward) at the ball-surface
cI is n ^ I and the radius of the ball is R, then the ball center position must contact point r I

satisfy
bI cI ^I , rI = rI + Rn bI cI ^I = 0 rI - rI - Rn

(4.3)

The third constraint has to do with the definition of a unit quaternion. The rotation matrix which maps the coordinates from inertial frame to the frame attached to the ball, and which specifies the inertial attitude of the ball, is given by CbI . It is represented by the unit quaternion q = [ T , ] (with the vector part and the scalar part ) as CbI = (2 -
T T

)1 + 2

T

- 2

×

,

(4.4)

the quaternion must satisfy the unit length constraint, qT q =
T

+ 2 = 1 , (4.5)

qT q - 1 = 0

53

Surface constraints (4.2) and (4.3) can be expressed as   cI )   g (r I     ~1 =  g ,    bI  cI - Rn ^ I r I - r I   and quaternion constraint as ~2 = qT q - 1 , g (4.7)

(4.6)

the constraints can be combined in a vector as   g ~1   ~= g   g ~  2

(4.8)

4.2

Surface-Constrained Kalman Filter for a Rolling Ball

The system model (3.96), has the following structure, .    x1  f1      . .    f (x, t ) = x = x2  = f2      .    x3  f3     

(4.9)

The error covariance rate equation (2.73) is given by,
T T P = (F x - KH x )P + P (F x - KH x )T + w QT w + K v Rv K , .

54

setting w = v = I (where I is identity matrix) leads to P = (F x - KH x )P + P (F x - KH x )T + Q + KRK T
.

(4.10)

The terms included in the above equation are described next. The dynamics Jacobian is defined in expression (2.63), Fx = f x (4.11)

^,t,u,0 x

The constrained Kalman gain K (2.76) is for the system model (3.96) in which component 1 (ball position vectors) and component 2 (quaternion vector) are constrained while component 3 (ball angular velocity vector) is unconstrained, as shown in chapter 3. The corresponding constraint Jacobian (2.18) is represented by, G1 and G2 , hence the constrained Kalman gain expression becomes,  T  -1 G1 [G1 GT ] G 1 1  1   y   ~T R-1 -1 T K = Kunc - GT [G G ] G2 2  T -1  2 2 2 y ~ R y ~     01 x 3   The unconstrained Kalman gain (2.75),
T -1 Kunc = P H x (v RT v) ,

(4.12)

has v = I (where I is identity matrix), so that
T -1 Kunc = P H x R

(4.13)

The measurement Jacobian is defined in expression (2.63), as Hx = h x ,
^,t,u,0 x

(4.14)

55

where h(x) vector components come from two measurement models representing two kinds of measurements being used. The first measurement model represents the ranges measured in the inertial reference frame FI from the location of the geometric center of
bI to four, fixed, known reference points or beacons, with locations specified by the ball r I RI )  R3 , as indicated in figure 4.1, (r I i

bI RI h1,i (x) = r I - (r I )i , bI RI yi = r I - (r I )i + vi ,

i = 1, 2, 3, 4 , i = 1, 2, 3, 4 ,

(4.15) (4.16)

where yi are the modelled range measurements and vi are zero-mean white noise processes with autocovariance defined by equation (2.4). The second measurement model represents two unit vector measurements that indicate the attitude or the orientation of the ball, h2,i (x) = C (q )siI , yi = C (q )siI + vi, i = 1, 2 , i = 1, 2 , (4.17) (4.18)

where C (q ) is the rotation matrix which maps coordinates from the reference frame FI to the reference frame Fb and is expressed in terms of the unit quaternion q as defined in equation (4.4), siI  S 2 are known unit reference vectors and vi are zero-mean white noise with autocovariance specified by equation (2.4). With the above definitions the measurement vector can be expressed as
T T T y = [ y1, y2, y3, y4, y1 , y2 ] ,

(4.19)

while h(x) can be expressed as
T T T h = [hT 1 , h2 ] = [ h1,1, h1,2, h1,3, h1,4, h2,1, h2,2 ] T T

(4.20)

The measurement noise covariance matrix is R, defined in (2.4) and the process noise covariance matrix is Q, defined in (2.2).

56

zb Fb xb g (rI ) = 0 z rbI I rRI I yb

Reference point (beacon)

FI
0

y

x

Figure 4.1: Ball center and reference point position. The figure shows the surface g , the inertial reference frame FI , the reference frame of the ball Fb , the position vector of the bI and the reference point position r RI . center of the ball r I I

The constraint Jacobian matrix elements G1 and G2 are given by G1 = ~1 g ,  x1 G2 = ~2 g ,  x2 (4.21)

~1 and g ~2 come from (4.6), (4.7) and x1 and x2 are specified in (3.95). where g The measurement estimate error (2.69), is given by ~ = y - h(x ^) , y (4.22)

^ ) are the predicted measurements that are based here y are the true measurements, and h(x ^ and with the structure given by (4.20). on current state estimate vector x As defined by equation (2.68), the unconstrained part of the constrained state estimate rate equations for the rolling ball, is ^, t, u, 0) + Ki,unc y ~, i = fi (x where the equations of motion f1 = [r I , r I ~ is given by (4.22). specified by (4.13) and y
. bI T . CI T T ]

i = 1, 2 ,
.

(4.23)

and f2 = q are from (3.96), Ki,unc are

57

The f3 =  b equation of motion is unconstrained and as it is shown in the table 2.2, that the corresponding angular velocity optimal estimate rate equation is as follows, ^ 3 = f3 (x ^, t, u, 0) + K3,unc y ~ x
.

. bI

(4.24)

The constraints for the constrained elements of the state of the rolling ball (3.96) are specified by the equation (4.6) (constraints on position coordinates) and the equation (4.7) (quaternion constraint). The optimal estimate for these state elements is obtained by projecting the corresponding unconstrained state estimate rate equations i (4.23), onto the set of state estimate rates that satisfy the constraints. This is achieved by using the projector,
T i = I - GT i [Gi Gi ] Gi , -1

i = 1, 2 ,

(4.25)

where G1 and G2 are given in (4.21). The optimal state estimate rate equations for the constrained elements of the state, are as follows, ^ i =  i i , x
.

i = 1, 2 ,

(4.26)

where the term i projects the vector i onto the null-space of Gi , this space coincides with the tangent space of the surface corresponding to (4.6) and (4.7). In order to switch off the constraints in the above constrained filter algorithm, for comparative testing of the filter performance with and without the constraints, the constraint terms in the equations (4.12) and (4.25) (those involving Gi ) have to be removed.

58

Chapter 5 Results and Analysis: Optimal Estimate of the State of a Rolling Ball
In this chapter the computational results that include the unconstrained and surfaceconstrained continuous-time, extended Kalman filter state estimates as well as the true state of the ball rolling on a known surface, are displayed and analyzed (the unconstrained filter is obtained by removing constraining terms from SCEKF). The computations were performed using MATLAB software. The figures given below, in the sections 5.2, 5.3, show how the estimate of the state of the ball rolling on a known surface, obtained using surface-constrained, continuous-time, extended Kalman filter (or surface-constrained CEKF), as well as unconstrained CEKF, compare to the true state of the ball generated using ball dynamics. This allows comparison between the surface-constrained and the unconstrained filter. The dynamics of the rolling ball is subjected to disturbances, which are "unknown" to the SCEKF. These disturbances are nonlinear force due to the point mass embedded within the ball, and external force in the form of the time-varying aerodynamic drag force due to wind acting at the geometric center of the ball. Two sets of results were generated. The time-varying wind field was kept the same for both the sets, while the embedded point mass was placed closer to the geometric center of the ball for the first set and placed at the surface of the ball for the second set. As summarized in section section 4.1, the constrained state components are ball's surface contact point position, geometric center position and attitude. The accuracy of the estimates of the ball's contact point and the geometric center positions, gives a good indication of the SCEKF filter performance and these state estimates are included in

59

the results. According to [24] the attitude can be determined in a deterministic manner based on the existing vector measurements without filtering, hence the results for attitude produced by the surface-constrained and unconstrained CEKF are similar and rather accurate. Due to this similarity, the attitude comparison is not included in the results. The angular velocity dynamic equation of motion (3.84), is unconstrained, however it depends on the constrained contact point position, thus the results include the angular velocity estimates. The settings for the surface, the ball and the dynamic disturbances, used for generation of the results, are stated next.

5.1

General Computational Settings

The 3D surface on which the ball is rolling, has square border in x y -plane, with the side length of 40 m. The difference between the highest and the lowest point of the surface, along the z -direction, is 0.4 m. The surface is specified by the following equation,

2 2 2 2 1 1 x y f ( x, y ) = - e- ( x /30) - ( y /30) + e- ( x /15) - ( y /15) sin + sin 2 20 2 2

,

(5.1)

where { x | - 20 m  x  20 m } and { y | - 20 m  y  20 m } while all the scalar values have appropriate units of meter so that z = f ( x, y ) is in meter s. The surface defined by equation (5.1) is shown in figure 5.1.

z (m) y (m) x (m)
Figure 5.1: The surface on which the ball is rolling, defined by equation (5.1). The z-scale is stretched, for the purpose of surface-curvature illustration. 60

The radius of the ball is set to 0.1 m, the mass of the ball is set to 0.4 k g , the density of the ball is assumed to be uniform. The disturbances to the dynamics of the rolling ball, which are "unknown" to the SCEKF, are nonlinear force due to the point mass embedded within the ball, and external force in the form of the time-varying aerodynamic drag force due to wind acting at the geometric center of the ball. According to chapter 3 derivation, the nonlinear and external forces appear in the angular velocity rate equation of motion (3.84) ,
. bI ~ ~ ~ -1 (f b = M non + fext ) ,

~ ~ where the force terms f non and fext are given by (3.86) and (3.87). The point mass is located at a distance away from the geometric center of the ball, measured in the ball's body-fixed coordinate system, as shown in figure 3.1. The point mass value is set to 0.04 k g . It is placed on the x -axis of the body-fixed coordinate system. The time-varying wind velocity vector at the point of the geometric center of the ball, is given by     vw, x    0. 9 m/ s         t , vw = vw, y  = 0.75 cos 30 s m/ s           vw, z    -0.12 m/s     (5.2)

where vw, x, vw, y, vw, z are the x, y, z components of the velocity vector. The wind velocity components were selected to be large enough to produce significant disturbance, yet not so large as to force the ball outside the surface boundary. The aerodynamic drag force f Ib acting on the geometric center of the ball is specified in the following way [25] ,
2 f Ib (vrel, t ) = - k vrel

=-

1 vrel CD  A vrel · vrel , 2 vrel

(5.3)

where k is the aerodynamic drag coefficient for the given physical object (ball), vrel = r I - vw is the relative velocity - the difference between the velocity of the geometric center of the ball r I (3.16) and the wind velocity vw (5.2), CD is the aerodynamic drag coefficient for the given geometric shape (sphere),  is the density of air, A is the reference 61
. bI . bI

area for which k is determined (such as the surface area of the ball). Assuming the drag coefficient for a sphere at a low Reynolds number (low air flow speed) CD = 1.0 [26], the density of air at sea level  = 1.2 k g /m3 [27], and knowing that the reference area of the ball (the surface area) is A = 4 R2 = 4  (0.1 m)2 , leads to the following result for the ball's aerodynamic drag coefficient, k= 1 CD  A 2 1 = 1.0 (1.2 k g /m3 ) 4 (0.1 m)2 2 N = 0.075 2 2 m /s

(5.4)

The range measurements (4.16) are made with respect to four fixed beacons with x , y , z coordinates specified by position vectors [-15, 15, 20]T m, [-15, -15, 5]T m, [15, 15, 10]T m and [15, -15, 15]T m. The x , y , z coordinates of the unit reference vectors used for attitude measurements (4.18), are given by the following vectors, [1, 0, 0]T , [0, 1, 0]T . The x , y , z coordinates of the initial surface contact point position of the ball are [-10,-10, -0.361]T m. The initial angular velocity of the ball is [ x,  y, z ]T = [5.73, 0, 0]T deg /s. From the equation (2.2), the process noise covariance matrix is Q = E wwT , where w is the zero-mean white noise process vector corresponding to the system model vector (3.96), x= for the dynamic equation w=
.

rI
. bI b

. cI T

, rI

. bI T

,q ,

.T

errors in the kinematic equations for

. cI . bI rI , rI

b

. bI .

T T

. For the initial settings, the

and q are set to zero, while the errors

are given non-zero value, so the noise process vector is

T ]T , where Q ¯3 Q proc [0T proc is a tuning parameter selected to give a better ×1 10×1, w

filtering performance and w ¯ is a random noise process with unit covariance. The resulting initial process noise covariance matrix is given by   010×10 010×3   ,    03×10 I3×3   

Q = Q proc

(5.5)

where Q proc = 0.52 . The first ten elements of the main diagonal indicate the same zero 62

variance in the noise values of the components of the kinematic equations, while the last three elements of the main diagonal indicate the same variance, equal to Q proc , in the noise values of the components of the dynamic equation. All of the off-diagonal elements are zero, indicating no covariance between the noise values of the different components of the system model vector. From the equation (2.4), the measurement noise covariance matrix is R = E vvT , where v is the zero-mean white noise process vector corresponding to the measurement
T , yT ]T . The assumed initial error in a range model vector (4.19), y = [ y1, y2, y3, y4, y1 2

measurement is 0.1 m and in the attitude measurement it is 1 deg = (1 ×  /180) rad . This leads to the following initial measurement noise covariance matrix,  2  0.1 I4×4  04×6  R=    2  06×4 (1 ×  /180) I6×6    From the equation (2.12), the estimate error covariance matrix is ~x ~T , P =E x ~ is the estimate error defined by (2.6) as x ~ = x-x ^ . The estimate error where x corresponds to the system state vector (3.95), x =
cI , r bI , q T ,  bI rI I b T T T T

(5.6)

. The

assumed standard deviation of the initial range measurement error is 1 m. The assumed standard deviation of the angular velocity error is 0.01 rad /s. The initial error for the  quaternion is 0.1, this value was determined by tuning the filter. Thus, the initial estimate error covariance matrix is specified as   I6×6 0 6 ×4 06×3      P = 04×6 0.1I4×4 04×3      03×6 03×4 0.012 I3×3   

(5.7)

63

5.2

First Set of Results

In this section as well as in section 5.3, in order to compare the unconstrained CEKF to the surface-constrained CEKF, the unconstrained filtering plots for a particular state component are followed by the surface-constrained filtering plots for the same component. Each such group of plots is supplemented by the corresponding analysis. All of the filtering estimation errors presented in the plots, are generated by subtracting estimate state values produced by Kalman filter, from the true state values calculated using ball dynamics. For this, first set of the results, the point mass is located at the distance of 0.0125 m from the geometric center of the ball. As follows from section 5.1, the combined mass of the ball and the point mass is 0.44 k g , hence the magnitude of the force of gravity on the ball with the embedded point mass, is Fg = (0.44 k g )(9.81 m/s2 ) = 4.32 N . Computational output for equation (5.3) indicates that for the first set of results, the magnitude of aerodynamic drag force due to the time-varying wind f Ib , which contributes to ball's dynamics disturbance due to external ~ext given by (3.87), reaches f b = 0.1181 N , or about 2.7 % of Fg . Equation (3.86) force f
I

can be used to determine the magnitude of the nonlinear force due to the embedded point ~ mass, which contributes to the disturbance due to f non . Computational output indicates that the magnitude of the nonlinear force due to the point mass goes up to 0.1436 N , or about 3.3 % of Fg . Therefore for the given set of results, the disturbance to the ball's dynamics caused by the nonlinear force due to the embedded point mass, reaches the same order of magnitude as does the disturbance caused by the aerodynamic drag force due to the time-varying wind. It can be seen from figures 5.2 and 5.3 that the state estimate produced by the unconstrained CEKF is significantly less precise than the estimate produced by the surfaceconstrained CEKF, shown in figures 5.4 and 5.5. In particular, in the unconstrained case, xz -plane, parts of the estimate contact point trajectory lie both rather far below as well as above the surface (the distance between the unconstrained estimate and the surface reaches 0.142 m below the surface and 0.120 m above the surface), while in the surface-constrained case the estimate is much better constrained to the surface. In the x y -plane, the surfaceconstrained filter also produces a significantly better estimation, as the constrained estimate follows the true trajectory much more closely than the unconstrained filter. However, there

64

is an evident error towards the end of the trajectory, along the x direction, in the constrained case. This can be attributed to the fact that the ball is slowing down and changing direction due to the climb, and the filter is relying more on the noisy measurements rather than the dynamics model, for the position estimation. Figure 5.6, which displays the change in the contact point position as a function of time, indicates that the ball travels most of its trajectory, during the initial 50 seconds or so. The first 50 seconds also correspond to the highest angular velocity, figure 5.7.

Estimate True

z (m) y (m) x (m)
Figure 5.2: Unconstrained CEKF estimate for surface contact point position of the rolling ball (red) and true, surface contact point position (blue), shown in three dimensions.

65

Estimate True

Estimate True

z (m)

-0.5 -1 -20 -20 -20 x (m)

0 x (m)

20 20

Figure 5.3: Unconstrained CEKF estimate for surface contact point position of the rolling ball (red) and true, surface contact point position of the rolling ball (blue). The left plot shows the side view ( xz -plane) and the right plot shows the top view ( x y -plane) of the figure 5.2.

y (m)

0

Estimate True

z (m) y (m) x (m)
Figure 5.4: Surface-constrained CEKF estimate for surface contact point position of the rolling ball (red) and true, surface contact point position (blue), shown in three dimensions.

66

Estimate True

Estimate True

z (m)

20 x (m)

y (m)
-20 -20 x (m)
15 10 True Position (m) 5 0 -5 -10 -15 0 50 100 150 Time (s) 200 250 x y

Figure 5.5: Surface-constrained CEKF estimate for surface contact point position of the rolling ball (red) and true, surface contact point position of the rolling ball (blue). The left plot shows the side view ( xz -plane) and the right plot shows the top view ( x y -plane) of the figure 5.4.

Figure 5.6: True, x y -plane position components of the contact point (and the geometric center) of the rolling ball.

67

1000 True Angular Velocity (deg/s)
x y

500

z

0

-500

0

50

100

150 Time (s)

200

250

Figure 5.7: Components of the true angular velocity of the rolling ball.

The error in the unconstrained filter estimates of the ball's contact point position coordinates, shown in figures 5.8 and 5.9, indicate that the maximum magnitude of error in x coordinate of the contact point is 10.99 m, while for the most part of the time interval, the error magnitude is close to 6 m. The magnitude of the error in y coordinate is within about 1 m. The magnitude of the error in z coordinate (figure 5.9) reaches 0.17 m. The error in the surface-constrained filter estimates of the contact point position coordinates, are shown in figures 5.10 and 5.11. The maximum magnitude of the error in x coordinate of the contact point is 3.50 m and for the most part of the time interval the error magnitude is less than 1 m. The magnitude of the error in y coordinate is within about 0.6 m. The magnitude of the error in z coordinate (figure 5.11) goes up to 0.08 m (for a single spike and stays considerably lower most of the time). Hence, the approximate error reduction in the constrained case is 3 to 6 times for x coordinate, 1.7 times for y coordinate and at least 2.1 times for z coordinate. This error reduction leads to a significantly better overall estimation of the contact point position, by the surface-constrained filter.

68

Contact Point Position Estimation Error (m)

15

10

x y z

5

0

-5

0

50

100

150 Time (s)

200

250

Figure 5.8: Error in the Unconstrained CEKF estimate for surface contact point position of the rolling ball. There appears to be little variation in error in the z coordinate estimate, as its scale is much smaller than that of the errors in estimates of x and y coordinates. To emphasize the variation, figure 5.9 shows only the error in the z coordinate estimate.

Contact Point Position Estimation Error (m)

0.2

0.1

0

-0.1

-0.2

0

50

100

150 Time (s)

200

250

Figure 5.9: Error in z coordinate of the Unconstrained CEKF estimate for surface contact point position of the rolling ball.

69

Contact Point Position Estimation Error (m)

1 0 -1 -2 -3 -4 x y z

0

50

100

150 Time (s)

200

250

Figure 5.10: Error in the Surface-constrained CEKF estimate for the surface contact point position of the rolling ball. Figure 5.11 shows the error in the estimate of the z-coordinate separately.

Contact Point Position Estimation Error (m)

0.04 0.02 0 -0.02 -0.04 -0.06 -0.08 0 50 100 150 Time (s) 200 250

Figure 5.11: Error in z coordinate of the Surface-constrained CEKF estimate for surface contact point position of the rolling ball. Comparing figures 5.12, 5.13 with figures 5.8, 5.9 shows that in the unconstrained case the position coordinates of the center of the ball do not follow the ball's contact point position coordinates closely. This is most evident upon comparison of the x -coordinates, which for the most part of the time interval, differ by over 5 meters. This is due to the 70

fact that the ball center position constraint (4.3) is not enforced in the unconstrained case. However, it can be noted that the estimation errors in the x and y components of the ball center position in the unconstrained case (figure 5.12) are overall smaller than in the surface-constrained case (figure 5.14). The magnitude of the error in z-component of the ball center position in the unconstrained case (figure 5.13) is over 0.02 m for the greater part of the time interval, while in the surface-constrained case (figure 5.15) the magnitude of the error is within 0.01 m most of the time. Hence for the z-component of the ball center position, the surface-constrained filtering provides some overall improvement in estimation accuracy. Comparison of the surface-constrained ball center position estimation errors shown in figures 5.14, 5.15 to the surface-constrained contact point position estimation errors shown in figures 5.10, 5.11, indicates that (unlike in the unconstrained case) these errors are similar, hence as expected, the ball center position constraint is enforced in the surface-constrained case.

Ball Center Position Estimation Error (m)

0.5

x y z

0

-0.5

-1

0

50

100

150 Time (s)

200

250

Figure 5.12: Error in the Unconstrained CEKF estimate for the geometric center position of the rolling ball. Figure 5.13 shows the error in the estimate of the z coordinate separately.

71

Ball Center Position Estimation Error (m)

0.06 0.04 0.02 0 -0.02 -0.04 -0.06 0 50 100 150 Time (s) 200 250

Figure 5.13: Error in z coordinate of the Unconstrained CEKF estimate for the geometric center position of the rolling ball.

Ball Center Position Estimation Error (m)

1 0 -1 -2 -3 -4 x y z

0

50

100

150 Time (s)

200

250

Figure 5.14: Error in Surface-constrained CEKF estimate for the geometric center position of the rolling ball. Figure 5.15 shows the error in the estimate of the z coordinate separately.

72

Ball Center Position Estimation Error (m)

0.1 0.05 0 -0.05 -0.1

0

50

100

150 Time (s)

200

250

Figure 5.15: Error in z coordinate of the Surface-constrained CEKF estimate for the geometric center position of the rolling ball. The magnitudes of errors in angular velocity estimates produced by the unconstrained and surface-constrained CEKF (figures 5.16, 5.17) appear to vary in about the same range. Dependence of angular velocity equation of motion (3.84) on constrained contact point position, does not produce overall estimation improvement in the given case. This result is expected to some extent, since the angular velocity itself, does not have constraint.
Angular Velocity Estimation Error (deg/s) 40 20 0 -20 -40
x y z

0

50

100

150 Time (s)

200

250

Figure 5.16: Error in the Unconstrained CEKF estimate for the angular velocity of the rolling ball.

73

Angular Velocity Estimation Error (deg/s)

40 20 0 -20 -40 -60

x y z

0

50

100 Time (s)

150

200

250

Figure 5.17: Error in the Surface-constrained CEKF estimate for the angular velocity of the rolling ball.

5.3

Second Set of Results: Increased Disturbance Due to Point Mass

For the results given in this section, the point mass is placed at the surface of the ball, in order to increase the disturbance to the ball's dynamics, due to influence of nonlinear ~ force f non (3.84). Computational output shows that for the second set of results, the magnitude of the aerodynamic drag force due to the time-varying wind, reaches fIb = 0.1351 N , or about 3.1 % of Fg . While the magnitude of the nonlinear force due to the embedded point mass, reaches 1.217 N , or about 28 % of Fg . Thus for this set of results, the maximum disturbance to the ball's dynamics caused by the nonlinear force due to the embedded point mass, is an order of magnitude greater than the maximum disturbance caused by the aerodynamic drag force due to the time-varying wind. Supporting the results in section 5.2, the figures 5.18 and 5.19 demonstrate that the state estimate produced by the unconstrained CEKF is noticeably less precise than the estimate produced by the surface-constrained CEKF, shown in figures 5.20 and 5.21. In the unconstrained case, xz-plane, most of the estimate contact point trajectory lies above the 74

surface (the distance between the unconstrained estimate and the surface reaches 0.074 m above the surface). In the surface-constrained case the estimate stays on the surface. In the x y -plane, the unconstrained filter contact point position estimate, for the most part is far from the true trajectory, while the surface-constrained estimate follows the true trajectory closely. The largest error in the surface-constrained contact point position estimate, is near the beginning of the trajectory, where the estimate noticeably oscillates. According to the true x y -plane contact point position graph in figure (5.22) and true angular velocity components graph in figure (5.23), the dominant angular velocity components initially are  y and z and as the point mass is located on the x -axis, it causes greater disturbance to the ball's dynamics in the initial part of the trajectory. As stated in the beginning of the chapter, this disturbance is "unknown" to the SCEKF, hence the filter must be relying more on the noisy measurements, rather than the dynamics model, leading to the oscillating estimate. Within the first 100 seconds,  y and z components diminish and  x component becomes dominant, the point mass disturbance decreases and so does the estimate oscillation. It can be noted in the first set of the results (section 5.2), where the point mass is located closer to the ball's center, the surface-constrained contact point position estimate undergoes much less of the initial oscillation.

Estimate True

z (m) y (m) x (m)
Figure 5.18: Unconstrained CEKF estimate for the surface contact point position of the rolling ball (red) and true, surface contact point position (blue), shown in three dimensions.

75

Estimate True
y (m)

Estimate True

z (m)

20 x (m)

-20 -20 x (m)

Figure 5.19: Unconstrained CEKF estimate for surface contact point position of the rolling ball (red) and true, surface contact point position of the rolling ball (blue). The left plot shows the side view ( xz -plane) and the right plot shows the top view ( x y -plane) of the figure 5.18.

Estimate True

z (m) y (m) x (m)
Figure 5.20: Surface-constrained CEKF estimate for the surface contact point position of the rolling ball (red) and true, surface contact point position (blue), shown in three dimensions.

76

Estimate True
y (m)

Estimate True

z (m)

20 x (m)

-20 -20 x (m)

Figure 5.21: Surface-constrained CEKF estimate for surface contact point position of the rolling ball (red) and true, surface contact point position of the rolling ball (blue). The left plot shows the side view ( xz -plane) and the right plot shows the top view ( x y -plane) of the figure 5.20.

15 10 True Position (m) 5 0 -5 -10 -15 0 100 200 Time (s) 300 400

x y

500

Figure 5.22: True, x y -plane position components of the contact point (and the geometric center) of the rolling ball.

77

1500 True Angular Velocity (deg/s)
x

1000 500 0 -500 -1000

y z

0

100

200 Time (s)

300

400

500

Figure 5.23: Components of the true angular velocity of the rolling ball.

Figure 5.24 shows that for the given case of the increased point mass disturbance, the error in the unconstrained estimates of x and y coordinates of the contact point position increase significantly in the second half of the 500-second interval. For the unconstrained case, the magnitude of the error in x coordinate estimate reaches 11.64 m in the time interval. The magnitude of the error in y coordinate estimate reaches 7.91 m, in the time interval. The magnitude of the error in z coordinate of the unconstrained contact point position estimate (figure 5.25) increases somewhat towards the end of the time interval and reaches 0.215 m. In the surface-constrained case, the magnitude of the error in the estimates of the x and y coordinates of the contact point position (figure 5.26) decreases in general in the second half of the 500-second interval (unlike in the unconstrained case, as described above). The magnitude of the error in the x coordinate reaches 2.30 m early in the time interval. The magnitude of the error in the y coordinate reaches 0.64 m. The values of the largest errors are considerably lower than in the unconstrained case, 5.1 times lower for x coordinate and 12.4 times lower for y coordinate. The magnitude of the error in the surface-constrained estimate of the z coordinate of the contact point position tend to become smaller in the second half of the tested time interval. The magnitude of the surface-constrained filtering error in z coordinate reaches 0.055 m in the beginning of the time interval, which is 3.9 times smaller than the largest magnitude of the error in the z 78

coordinate in the unconstrained case. The overall convergent behaviour of the contact point position estimate errors in the surface-constraint case is an improvement over the overall divergent behaviour of the errors in the unconstrained case. No obvious divergent or convergent behaviour in the magnitudes of the errors in the surface contact point estimates, was observed in the first set of results given in section 5.2, in the considered time interval, which was two times shorter in section 5.2 then in this section.

Contact Point Position Estimation Error (m)

15 10 5 0 -5 -10 x y z

0

100

200 Time (s)

300

400

500

Figure 5.24: Error in the Unconstrained CEKF estimate for the surface contact point position of the rolling ball. Figure 5.25 shows the error in the estimate of the z coordinate separately.

79

Contact Point Position Estimation Error (m)

0.2 0.1 0 -0.1 -0.2 -0.3

0

100

200 Time (s)

300

400

500

Figure 5.25: Error in z coordinate of the Unconstrained CEKF estimate for the surface contact point position of the rolling ball.

Contact Point Position Estimation Error (m)

3 2 1 0 -1 -2

x y z

0

100

200 Time (s)

300

400

500

Figure 5.26: Error in the Surface-constrained CEKF estimate for the surface contact point position of the rolling ball. Figure 5.27 shows the error in the estimate of the z coordinate separately.

80

Contact Point Position Estimation Error (m)

0.04 0.02 0 -0.02 -0.04 -0.06

0

100

200 Time (s)

300

400

500

Figure 5.27: Error in z coordinate of the Surface-constrained CEKF estimate for the surface contact point position of the rolling ball. Figure 5.29 shows that the magnitudes of the error in the coordinates of the unconstrained estimate for the geometric center position of the ball, increase towards the end of the 500-second time interval, where the maximum error in x coordinate is 0.40 m, in y coordinate it is 0.23 m and in z coordinate it is 0.38 m (yet remains quite small before that, reaching 0.151 m for x coordinate at 170 th second). As in the first set of results in section 5.2, the errors in the components of the unconstrained estimate for the geometric center position of the ball (figure 5.28), do not follow closely the errors in the components of the unconstrained estimate for the surface contact point position (figures 5.24, 5.25), since the ball center position constraint (4.3) is not enforced in the unconstrained case. The errors in the surface-constrained estimates of the ball center position coordinates (figures 5.29, 5.30) are analogous to the errors in the surface-constrained estimates of the contact point coordinates (figures 5.26, 5.27), indicating that just as in section 5.2 the ball center position constraint (4.3) is enforced in the surface-constrained filtering. As stated above, the maximum error in the unconstrained estimate for the geometric center position of the ball is 0.40 m in x coordinate, 0.23 m in y coordinate and 0.38 m in z coordinate. For comparison, the maximum error in the surface-constrained estimate for the ball's geometric center position is 2.30 m in x coordinate, 0.63 m in y coordinate and 0.055 m in z coordinate. So, although in the surface-constrained filtering the estimate of 81

the ball center position is much more consistent with the corresponding surface contact point position, than in the unconstrained filtering, the later provides the more precise estimate for the x and y coordinates (but not the z coordinate) in the given case (as it has been also observed in the section 5.2).
Ball Center Position Estimation Error (m)

1

x y z

0.5

0

-0.5

0

100

200 Time (s)

300

400

500

Figure 5.28: Error in the Unconstrained CEKF estimate for the geometric center position of the rolling ball.
Ball Center Position Estimation Error (m)

3 2 1 0 -1 -2

x y z

0

100

200

300 Time (s)

400

500

Figure 5.29: Error in the Surface-constrained CEKF estimate for the geometric center position of the rolling ball. Figure 5.30 shows the error in the estimate of the z coordinate separately.

82

Ball Center Position Estimation Error (m)

0.04 0.02 0 -0.02 -0.04 -0.06

0

100

200

300 Time (s)

400

500

Figure 5.30: Error in z coordinate of the Surface-constrained CEKF estimate for the geometric center position of the rolling ball.

Figures 5.31 and 5.32 show that similar to the first set of results (in section 5.2), there is no significant difference in the range of magnitudes of errors in angular velocity estimates produced by the unconstrained and surface-constrained CEKF (there is a relatively small improvement in the  x component, which is more centered around zero in the surfaceconstrained case). This shows that for the given system and testing cases, the angular velocity estimation error is not particular sensitive to the surface-constrained filtering.

83

Angular Velocity Estimation Error (deg/s)

150 100 50 0 -50 -100 -150 0 100 200 Time (s) 300 400 500
x y z

Figure 5.31: Error in the Unconstrained CEKF estimate for the angular velocity of the rolling ball.

Angular Velocity Estimation Error (deg/s)

150 100 50 0 -50 -100 -150 0 100 200 Time (s) 300 400 500
x y z

Figure 5.32: Error in the Surface-constrained CEKF estimate for the angular velocity of the rolling ball.

84

Chapter 6 Conclusions
In this thesis, the Surface-constrained Continuous-time Extended Kalman Filter (SCEKF) has been developed and used for estimation of the state of a dynamic system - a ball rolling on a known surface, subject to disturbances caused by the drag force due to the time-varying wind and nonlinear force due to the point mass embedded within the ball away from the ball's geometric center. The Surface-Constrained CEKF filtering results have been compared to the Unconstrained CEKF filtering results, which demonstrated that overall the surface-constrained filtering produced significantly better state estimates and successfully enforced the required constraints. The SCEKF is derived in chapter 2. First, the surface-constrained linear Kalman filter is developed in section 2.1. This section begins with the required definitions for such filter components as the linear system state model, the measurement model, the process noise and the measurement noise covariance matrices, the state estimate rate equation, the error and the covariance rate equations, the surface constraints expression and the constraint Jacobian matrix. Next, the optimal Kalman gain is found by minimizing the cost function (that quantifies the deviation of the state estimate from the true state), that is, the gain that gives the minimum of the cost function is found. The gain itself is subject to surface constraints. This constrained optimization problem is solved by using Lagrange multipliers method. Finding the constrained Kalman gain leads to geometric interpretation, in which constrained state estimate rates are orthogonal projections of the unconstrained rates onto the constrained estimate rates space. In section 2.2, the linear surface-constrained Kalman filter developed in section 2.1, is modified to accommodate nonlinear system models, hence it becomes extended surface-constrained Kalman filter. This modification is accomplished by first, defining nonlinear system and measurement models, then linearizing them using 85

first-order Taylor series approximation. After that, the linear Kalman filter from section 2.1 is applied to the linearized system. In chapter 3 the equations of motion for a ball, with embedded off-center point mass, rolling on a known surface without slipping, under influence of external force, are derived. The surface equation, the ball parameters and the external force are defined, at first. Then, the constraint for contact point between the ball and the surface, the ball center position constraint and the no-slip condition for the ball, are specified. These are followed by definitions of the kinetic and potential energies as well as corresponding Lagrangian for the ball and point mass system. Finally, the Lagrange's equations of motions are formulated and evaluated, which leads to the set of equations of motion for the rolling ball. In chapter 4, the SCEKF derived in chapter 2 is combined with the constrained ball dynamics obtained in chapter 3, to produce the SCEKF that can be used to for optimal estimation of the state of the rolling ball. The chapter also specifies the measurement models used for the optimal estimation (range measurements to four fixed beacons with respect to the geometric center of the ball and unit vector measurements that indicate the attitude of the ball). The SCEKF for the ball rolling on a known surface is implemented using MATLAB software and plotted computational results are presented and analyzed in chapter 5. The plots provide comparison between the state estimate produced by the surface-constrained continuous-time extended Kalman filter, the state estimate produced by the unconstrained continuous-time extended Kalman filter (the SCEKF in which constraining terms are not used) and the true state calculated using ball dynamics. Two sets of results are generated. The same drag force disturbance to the ball dynamics due to variable wind field is used for both the sets, while the nonlinear force disturbance due to the point mass embedded in the ball, is different, as the mass is placed closer to the geometric center of the ball for the first set (section 5.2) and at the surface of the ball for the second set (section 5.3). These disturbances are "unknown" to the filter, hence it does not have the exact ball dynamics, which makes the state estimation more difficult. The results focus on the ball's state estimates, such as surface contact point position, geometric center position and angular velocity (excluding attitude, which is accurate and similar in both the unconstrained and constrained case, since it can be determined based on measurements, without filtering [24], as mentioned in the beginning of this chapter). 86

Overall, the results demonstrate that the estimate of the state of the rolling ball, produced by the surface-constrained CEKF is significantly better than that produced by the unconstrained CEKF. The results show that the surface-constrained filter constrains the estimated surface contact point trajectory to the surface more successfully than the unconstrained filter. The contact point estimation produced by the unconstrained filter appears comparably far below and above the surface (reaching the distance of 0.142 m below and 0.120 m above the surface in the first set of results, and reaching the distance of 0.074 m above the surface in the second set of results, which can be compared to the 0.1 m radius of the ball), while in the surface-constrained case the estimation remains on the surface, having much smaller error. The errors in the estimate of the ball surface contact point position, produced by the surface-constrained filter are a number of times smaller than the errors in the estimate produced by the unconstrained filter (in section 5.2, the surface-constrained error is about 3 to 6 times smaller for the x coordinate of the contact point position, about 1.7 times smaller for y coordinate and at least 2.1 times smaller for z coordinate). The difference in the contact point estimation accuracy becomes larger when the disturbance to the ball's dynamics becomes greater and the unconstrained filtering error increases more than the surface-constrained filtering error, as can be seen by comparing the contact point estimation errors in section 5.2 to those in section 5.3, with more disturbance (in section 5.3, where the unconstrained contact point estimation error noticeably increases towards the end of the tested time period and the largest errors produced by the constrained and the unconstrained filter are compared, the surface-constrained error is 5.1 times smaller for x coordinate, 12.4 times smaller for y coordinate and 3.9 times smaller for z coordinate). For both the sets of the results (for the two disturbance settings) the errors in the x and y coordinates of the estimate of the ball center position are actually smaller in the unconstrained case than in the surface-constrained case, however the error in z coordinate is smaller in the surface-constrained case. Moreover, in the unconstrained case, the changes in the ball center position do not follow closely the changes in the contact point position, as the ball center constraint is not enforced. On the other hand the changes in the surface-constrained estimate of the ball center position follow closely the estimate of the contact point position showing that the ball center constraint is properly enforced. Both the section 5.2 and 5.3 sets of the results show that there is no significant 87

difference between the unconstrained and the surface-constrained estimates of the angular velocity, which is consistent with the expectation, since the angular velocity equation is not constrained in the ball dynamics. The results indicate that the SCEKF can produce good estimates of a state of a dynamic system most of the time. However, the surface-constrained estimation curves show an evident increase in the estimation error during some of the filtering intervals. This is where the filter is likely relying more on the measurements (which leads to sharp changes in estimation curve), rather than system dynamics model (which leads to smooth changes in estimation curve) . This behaviour can be attributed to the increased difference between the ball dynamics known to the filter and the actual ball dynamics, in these time intervals. Investigating the source of such errors and finding the ways to minimize them can be a way to further develop optimal estimation using the SCEKF.

88

References
[1] R. E. Kalman, A New Approach to Linear Filtering and Prediction Problems, Transactions of the ASME - Journal of Basic Engineering, 1960, 82, pp. 35-45. [2] H. W. Sorenson, Least-Squares Estimation: From Gauss to Kalman, IEEE Spectrum, July 1970, 7, pp. 63-68. [3] P. S. Maybeck, Stochastic Models, Estimation and Control: Volume 1, Academic Press, Inc., New York, NY USA, 1979, pp. 1-16. [4] R. M. Rogers, Applied Mathematics in Integrated Navigation Systems, 3rd Ed., American Institute of Aeronautics and Astronautics, Reston, VA USA, 2007, p. 184. [5] J. L. Crassidis, J. L. Junkins, Optimal Estimation of Dynamics Systems, Second Edition, CRC Press, Boca Raton, FL USA, 2012, pp.168-184, pp. 192-202, pp. 407-411, pp. 452-460. [6] D. Simon, Optimal State Estimation: Kalman, H Infinity, and Nonlinear Approaches, John Wiley and Sons, Inc., Hoboken, NJ USA, 2006, pp. 400-425. [7] R. Zanetti, M. Majji, R. H. Bishop, D. Mortari, Norm-Constrained Kalman Filtering, AIAA Journal of Guidance, Control, and Dynamics, 2009, 32(5), pp. 1458-1465. [8] D. Simon, Kalman Filtering with State Constraints: A Survey of Linear and Nonlinear Algorithms, IET Control Theory and Applications, 2010, 4(8), pp. 1303-1318. [9] N. Gupta, R. Hauser, Kalman Filtering with Equality and Inequality State Constraints, August 2007, http://arxiv.org/abs/0709.2791, pp. 1303-1318. [10] D. Simon, T. L. Chia, Kalman Filtering with State Equality Constraints, IEEE Transactions on Aerospace and Electronic Systems, 2002, 38(1), pp. 128-136. 89

[11] C. Yang, E. Blasch, Kalman Filtering with Nonlinear Constraints, IEEE Transactions on Aerospace and Electronic Systems, 2009, 45(1), pp. 70-84. [12] A. de Ruiter, J. Forbes, Discrete-Time SO(n)-Constrained Kalman Filtering, AIAA Journal of Guidance, Control and Dynamics, 2017, 40(1), pp. 28-37. [13] J. R. Forbes, A. H. J. de Ruiter, D. E. Zlotnik, Continuous-Time Norm-Constrained Kalman Filtering, Automatica, 2014, 50(10), pp. 2546-2554. [14] A. de Ruiter, J. Forbes, Continuous-Time Kalman Filtering on the Orthogonal Group O(n), International Journal of Robust and Non-linear Control, 2017, (in press, DOI: 10.1002/rnc.3744). [15] P. W. Richards, Constrained Kalman Filtering Using Pseudo-Measurements, IEE Colloquium on Algorithms for Target Tracking, May 1995, pp. 75-79. [16] L.-S. Wang, Y.-T. Chiang, F.-R. Chang, Filtering Method for Nonlinear Systems with Constraints, IEE Proceedings - Control Theory and Applications, 2002, 149(6), pp. 525-531. [17] J. R. Forbes, T. D. Barfoot, C. J. Damaren, Dynamic Modeling and Stability Analysis of a Power-Generating Tumbleweed Rover, Multibody System Dynamics, December 2010, vol. 24, pp. 413-439. [18] J. Nocedal, S. J. Wright, Numerical Optimization, Springer-Verlag, Inc., New York, NY, USA, 1999, pp. 315-359. [19] A. de Ruiter, J. Forbes, General Identities for Parameterizations of SO(3) with Applications, ASME Journal of Applied Mechanics, 81 (7), 2014, doi: 10.1115/1.4027144. [20] H. Anton, C. Rorres, Elementary Linear Algebra: Applications Version, John Wiley and Sons, Inc., Hoboken, NJ USA, 2000, p. 222. [21] A.H.J. de Ruiter, C.J. Damaren, J.R. Forbes, Spacecraft Dynamics and Control - An Introduction, John Wiley and Sons, Inc., West Sussex, United Kingdom, 2013. [22] P. C. Hughes, Spacecraft Attitude Dynamics (2nd ed.), Dover Publications, Mineola, NY USA, 2004, p. 8, pp. 17-18, p. 24, p. 26. 90

[23] J. B. Jia, Quaternion and Rotation: Com S 477/577 Notes, Iowa State University, Ames, IA USA, 2016, web.cs.iastate.edu/ cs577/handouts/quaternion.pdf [24] F. Landis Markley, John L. Crassidis, Fundamentals of Spacecraft Attitude Determination and Control), Springer, New York, NY USA, 2014, pp. 184-186. [25] The Drag Equation Glenn Research Center, NASA, 2015, https://www.grc.nasa.gov/www/k-12/airplane/drageq.html [26] Drag of a Sphere NASA, 2015, https://www.grc.nasa.gov/www/K-12/airplane/dragsphere.html [27] Air Properties Definitions Glenn Research Center, NASA, 2015, https://www.grc.nasa.gov/ www/k-12/airplane/airprop.html

91

