IMPROVING SOFT TISSUE IMAGING WITH VOLUME-OF-INTEREST CONE-BEAM CT

by

Christopher Huynh Bachelor of Science, University of Toronto, 2015

A thesis presented to Ryerson University

in partial fulfillment of the requirements for the degree of Master of Science in the program of Biomedical Physics

Toronto, Ontario, Canada, 2018 © Christopher Huynh, 2018

Author's Declaration

AUTHOR'S DECLARATION FOR ELECTRONIC SUBMISSION OF A THESIS

I hereby declare that I am the sole author of this thesis. This is a true copy of the thesis, including any required final revisions, as accepted by my examiners.

I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research.

I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

I understand that my thesis may be made electronically available to the public.

ii

IMPROVING SOFT TISSUE IMAGING WITH VOLUME-OF-INTEREST CONE-BEAM CT

Christopher Huynh Master of Science, 2018 Biomedical Physics Ryerson University

Abstract
Current cone-beam CT systems acquire full field-of-view projections in which x-ray scatter degrades the contrast of soft-tissue in the reconstructed images. The objective of this work was to simulate volume-of-interest (VOI) imaging, which reduces scatter and dose to the patient through beam collimation, to investigate the improvements in soft-tissue visibility on the Gamma Knife Icon. The results indicated that as field size decreased, contrast and noise increased, leading to only modest improvements in the contrast-to-noise ratio when using the same initial photon fluence. A reconstruction framework called the interior virtual method was adapted to suppress truncation-induced artifacts and noise in the VOI image. In this framework the projection data were extrapolated using a cosine function, an intermediate image was reconstructed analytically, and virtual projections of the intermediate image were created for iterative reconstruction. The framework supports high quality VOI reconstruction and can allow clinicians to optimize dose for soft-tissue visualization.

iii

Acknowledgements
My supervisors Dr. Mark Ruschin and Dr. William Song have provided an excellent environment of positive reinforcement and resources conducive to my learning and growth as a researcher, of which I am thankful for. Dr. Song always had my best interests at heart. It was apparent that he was as eager for my success as I was, within and beyond the scope of my project. Dr. Ruschin was a very patient and accommodating mentor. He recognized my strengths and weaknesses and invested a lot of time towards my improvement. I wish to especially thank Dr. Sayed Masoud Hashemi, who introduced me to many interesting topics and for teaching me many interesting and practical skills. He was quickest to understand my most complicated problems, from my shortest and crudest of explanations. His work ethic was a primary source of inspiration. I am thankful for my co-supervisor Dr. James Grafe, who provided patient explanations to things that should have been obvious to me. He expanded my understanding of clinical medical physics and the role of the medical physicist in this world. I thank my group members Dr. Hakan Nordstrom, Dr. Markus Eriksson, Dr. James Mainprize, Dr. Young Lee, and Vladimir Grouza, for their weekly constructive feedback and sharp critique. Lastly I would like to thank Sunnybrook and Ryerson and its faculty members, particularly Dr. Yuan Xu, who introduced me to the field of medical imaging.

iv

Table of Contents

Author's Declaration ............................................................................................ ii Abstract ................................................................................................................. iii Acknowledgements ............................................................................................... iv Table of Contents .................................................................................................. v List of Tables ...................................................................................................... viii List of Figures ....................................................................................................... ix 1 Introduction .................................................................................................... 1 1.1 Motivation ..................................................................................................... 1 1.1.1 Gamma Knife Stereotactic Radiosurgery ............................................... 1 1.1.2 Image Guidance with CBCT................................................................... 2 1.2 Cone-Beam CT Scatter Reduction ................................................................ 3 1.3 Volume-of-Interest Imaging .......................................................................... 5 1.4 Truncated Projection Data Reconstruction .................................................... 7 1.5 Iterative Reconstruction Algorithms ............................................................. 9 1.6 Summary, Aim and Structure ...................................................................... 10 1.6.1 Summary ............................................................................................... 10 1.6.2 Aim of this Work .................................................................................. 11 1.6.3 Structure of this Work........................................................................... 11 2 Methods......................................................................................................... 12 2.1 Icon Cone-Beam CT .................................................................................... 12 2.2 Synthetic Projection Simulation .................................................................. 14 2.2.1 Overview of Workflow ......................................................................... 14 2.2.2 Virtual Head Phantom .......................................................................... 15 2.2.3 X-ray Propagation ................................................................................. 18 2.3 Monte Carlo Simulation .............................................................................. 19 2.3.1 Phase Space ........................................................................................... 19 2.3.2 Flood Image Simulation........................................................................ 20 2.3.3 Scoring Scatter Energy Fluence ............................................................ 21 2.3.4 Dose Measurements .............................................................................. 22
v

2.4 Scatter Distribution De-noising and Up-sampling ...................................... 23 2.5 Forward Projection Operation ..................................................................... 24 2.6 Backprojection Operation ............................................................................ 25 2.7 Polychromatic Projection ............................................................................ 27 2.7.1 Material Length Projection ................................................................... 27 2.7.2 Poisson Noise Generation ..................................................................... 28 2.7.3 Projection Point Spread Function Blurring ........................................... 29 2.8 Noise Power Spectrum Calculation ............................................................. 30 2.9 FDK Reconstruction .................................................................................... 32 2.9.1 Standard FDK ....................................................................................... 32 2.9.2 Cosine Edge Extrapolation ................................................................... 33 2.10 Iterative Reconstruction............................................................................. 34 2.10.1 OS-SART with TV Regularization ..................................................... 34 2.10.2 Iterative Virtual Method ..................................................................... 37 2.11 VOI Contrast, Noise, and SPR Measurements .......................................... 39 3 Results ........................................................................................................... 40 3.1 Scatter Photon Energy Spectrum ................................................................. 40 3.2 De-noising and Up-sampling Monte Carlo ................................................. 42 3.3 Noise Matching in Synthetic Projections .................................................... 44 3.4 FDK VOI Truncation Cupping Artifact Compensation .............................. 46 3.5 VOI Image Quality ...................................................................................... 47 3.6 VOI Iterative Reconstruction ...................................................................... 49 3.7 Iterative Virtual Method .............................................................................. 51 3.8 VOI Dose ..................................................................................................... 52 4 Discussion and Conclusions ........................................................................ 56 4.1 Discussion.................................................................................................... 56 4.2 Future Work................................................................................................. 60 4.3 Conclusion ................................................................................................... 62 Appendix .............................................................................................................. 63 A.1 Trilinear Interpolation................................................................................. 63 A.2 Bilinear Interpolation .................................................................................. 63 A.3 Cone-Beam Parker Weights ....................................................................... 64

vi

A.4 Interior Reconstruction ............................................................................... 64 A.5 IVM Image Quality .................................................................................... 65 References ............................................................................................................ 67

vii

List of Tables

Table 2-1: The atomic composition of the materials used in the virtual head phantom. The values in the table are the mass fractions of the corresponding atomic element. ..................................................................................................... 18

Table 2-2: The frequency cut-offs for de-noising results from Monte Carlo. ...... 24

Table 3-1: The contrast and CNR values of the tumor for the images shown in Figure 3-12. .......................................................................................................... 52

viii

List of Figures

Figure 1-1: An example of an image reconstructed with truncated projection data. The image should be uniform but a bright ring around the FOV exists instead, along with a cupping in the image values. The units of the image are the units of the reconstructed attenuation coefficient, mm-1. The window shown here is [0, 0.09] mm-1, whereas a typical CBCT window is [0, 0.04] mm-1, meaning that the values are inaccurate. .............................................................................................. 8

Figure 2-1: a) The 3 coordinate systems are shown at a 30º rotation. The distance between the origins of the systems is 210 mm. b) The geometry of the Icon beam and detector, as seen by an observer looking down on the plane of rotation. c) The geometry of the Icon beam and detector, as seen by an observer on the plane of rotation. Circles with an X indicate that the direction points into the page while circles with a dot indicate that the direction points out of the page. ..................... 13

Figure 2-2: An overview of the synthetic projection data workflow. .................. 16

Figure 2-3: A synthetic projection of the Catphan 503, shown with a very narrow window. The blue box shows the selection of a uniform (as uniform as possible) region in which the NPS was calculated. .............................................................. 31

Figure 2-4: Visualization of the iterative virtual method. .................................... 38

Figure 3-1: The energy spectra of the scatter photons. The energy spectrum was plotted for each pixel, shown as a grey envelop. The average energy spectrum was plotted in black. Top: Simulation performed at a rotation angle of 180º. Middle: Simulation performed at a rotation angle of 135º. Bottom: Simulation performed at a rotation angle of 90º. ...................................................................................... 41

Figure 3-2: Top left shows the raw Monte Carlo calculated scatter energy fluence for a full-field beam. Top right shows the de-noised scatter energy fluence. Bottom shows the difference image. ..................................................................... 42

ix

Figure 3-3: Top left shows the raw Monte Carlo calculated scatter energy fluence for a 6 x 6 cm2 beam. Top right shows the de-noised scatter energy fluence. Bottom shows the difference image. ..................................................................... 43

Figure 3-4: The 1D NPS along the -direction of the non-blurred and blurred synthetic projections, and the real projections of the Catphan 503. The PSF shown in Section 2.7.3 was used. The shape of the NPS and the area under the NPS of the synthetic data better approximate the real data after blurring. ........................ 44

Figure 3-5: Comparison of the 2D NPS of synthetic data with and without blurring and real data. ........................................................................................... 45

Figure 3-6: Full FOV FDK reconstruction of the synthetic projections. Dashed blue circle indicates the position of the VOI. (Window = [0.017, 0.027] mm-1) .. 46

Figure 3-7: Left is a close-up of the VOI region shown in Figure 3-6. Middle is the VOI reconstructed with cosine extrapolation and FDK. Right is the VOI reconstructed with exponential extrapolation and FDK. All images are shown with a window width of 0.006 mm-1. However, left has a window of [0.0186, 0.0246] mm-1, middle has a window of [0.0205, 0.0265] mm-1, and right has a window of [0.0142, 0.0202] mm-1. ....................................................................... 47 Figure 3-8: Image quality of the VOI as a function of field size. The 22 x 22 cm2 field size represents the full FOV.......................................................................... 48

Figure 3-9: The scatter-to-primary ratio as a function of field size. .................... 49

Figure 3-10: Iterative reconstruction of the VOI using noiseless and scatter-less synthetic projections. The image shown is the result after 400 iterations. The regularization strength used was  = 0.005 and  = 0.996. The window was [0.0186, 0.0246] mm-1. .......................................................................................... 50

Figure 3-11: Line profiles of the image across the dashed line in Figure 3-10 showing the progress of the iterative reconstruction at the 100th, 200th, 300th, and 400th iteration. ....................................................................................................... 50

x

Figure 3-12: Left is the FDK-reconstructed image under a full FOV beam. Middle is the 6 cm FOV VOI image reconstructed with FDK and cosine extrapolation. Right is the VOI reconstructed with IVM after 25 iterations. The regularization strength used was  = 0.002 and  = 0.993. All images were displayed with a window width of 0.006 mm-1. Left has a window of [0.0159, 0.0219] mm-1, middle has a window of [0.0180, 0.0240] mm-1, and right has a window of [0.0180, 0.0240] mm-1. ....................................................................... 51

Figure 3-13: Monte Carlo calculated dose distributions for field sizes between 2 cm to 22 cm (full). Top 6 are axial views and bottom 6 are sagittal views. ......... 53

Figure 3-14: The dose as a function of field size for a few regions of interest. ... 54

Figure 3-15: The average dose to the patient under a certain field size over the average dose to the patient under the full field. ................................................... 55

xi

1

Introduction

1.1 Motivation
1.1.1 Gamma Knife Stereotactic Radiosurgery Modern gamma knife radiation units consist of 192 cobalt-60 sources situated around the patient. The gamma radiation emitted by these sources is collimated to produce beams that intersect at a focal point, forming a sphere of concentrated radiation with a diameter as small as 4 mm [1]. The many beam directions allow for the delivery of highly concentrated radiation dose to disease targets while minimizing collateral dose to nearby healthy tissues. When compared to the gantry and couch of a linear accelerator (LINAC), the components of a gamma knife have fewer moving parts. LINAC radiotherapy treatments deliver radiation to an added margin around the disease to account for the uncertainties of treatment delivery, which include the mechanical uncertainties of the treatment machine. As gamma knife stereotactic radiosurgery (SRS) strives for a higher precision, this additional margin is often not used [2]. The resulting gamma knife dose distribution contains precise and steep gradients around the target disease. To ensure treatment efficacy, it is imperative that the disease is stably aligned with the radiation focal point with submillimeter precision. As a part of the treatment workflow, patients can be positioned and immobilized by surgically screwing a metal frame onto the head and fixing the frame to the patient bed. The position of the skull and the brain can be inferred by knowing the fixed position of the frame. However, the use of the frame is invasive and must be worn from the time of treatment planning until treatment delivery, causing much discomfort to the patient. Furthermore, the frame is non-idealistic
1

for fractionated gamma knife treatments, where the patient would need to wear the frame over a span of several days, or have the frame re-applied each day [3] [4]. The newly Health Canada approved Gamma Knife Icon consists of a gamma knife radiation unit with an integrated cone-beam CT (CBCT) system that can perform online image-guidance and support frameless (i.e. mask-based) treatments. Various studies have shown that the components of the Icon have errors and propagated errors of less than a millimeter [1] [2] [5] [6] [7]. An alternative to the rigid frame is the use of a thermoplastic mask. Thermoplastic masks offer a non-invasive, frameless approach, but at the cost of accuracy and stability [8]. Under the frameless workflow, acquisition of a cone-beam CT is recommended for precise determination of the patient position.

1.1.2 Image Guidance with CBCT A CBCT, as opposed to fan-beam CT, uses a longitudinally expanded field and a large area flat panel detector to acquire volumetric projection data in a single rotation. Metastatic brain tumors, a common target for gamma knife SRS, have x-ray attenuation properties similar to normal soft tissues, which results in poor tumor contrast from x-ray-based imaging methods. Contrast resolution is further impaired by the cupping and streaks that arise from scatter and beam hardening, and the higher levels of noise in the image. Consequently, the patient bony anatomy is used as a surrogate for the tumor in the image registration between the online CBCT and the planning image. The image registration produces a transformation matrix that is used to move the patient into the planned position through translations of the couch [9]. Between the time the planning image was acquired and treatment delivery, the tumor may change shape, size and position for various reasons, such as natural growth or edema-induced displacement. Between fractions, the tumor may also reduce in size and be shifted due to loss of surrounding tissue mass. A study tested the reliability of using the skull as a surrogate for soft-tissue registration and the results suggested that the error of automatic skull registration could be

2

greater than 1 mm [9]. This error is higher than the mechanical uncertainties of the Icon gamma knife. To minimize time-induced tumor displacement, treatment planning and delivery on the gamma knife are conducted on the same day. However, soft tissue and tumor visualization would provide greater confidence in tumor targeting and normal tissue sparing. In addition, to prevent a potential loss in precision for lengthy fractionated gamma knife treatments, it would be desirable to verify the tumor itself on the CBCT. The contrast-to-noise ratio (CNR) on a CBCT can be improved by correcting the cupping artifacts caused by scatter and beam hardening. Other methods like dual energy CBCT can extend existing levels of contrast [10]. The current clinical standard for CBCT image reconstruction is the Feldkamp-DavisKress (FDK) reconstruction algorithm [11], which is a filtered backprojection (FBP) extended to the cone-beam geometry with additional weightings. However, the FDK algorithm suffers from artifacts when the projection data does not meet certain requirements, such as an insufficient number of projection views and the need for the projection to cover the patient laterally. It also has limited ability to control the noise level in the reconstructed image. Iterative reconstruction algorithms with regularization are an attractive alternative because of their relaxed data requirements, being able to reconstruct low-noise images with fewer projections [12] and at a lower mAs [13].

1.2 Cone-Beam CT Scatter Reduction
Scatter in the projection data causes artifacts in the reconstructed image such as cupping, streaks and inaccurate CT numbers. An increase in the projection scatter-to-primary ratio (SPR) will decrease the contrast and CT number accuracy in the image [14]. These effects significantly deteriorate image quality, especially when the imaging task is to resolve soft tissue. Many methods have been proposed to address the scatter problem [15], either by trying to reject or reduce the scatter signal, or by estimating and removing the scatter signal after data acquisition. Some of these methods will be discussed in the following paragraphs.
3

It is known that increasing the air gap between the patient and the detector will decrease the amount of scatter received. Scatter photons arising from photon interactions within the patient diverge from the point of interaction. An increased distance between the patient and the detector will increase the portion of the scattered photons that will miss the detector. This method is limited by physical space and detector size restrictions. Typical LINAC-mounted CBCT systems feature a rotation axis-to-detector distance (ADD) of around 50 cm [16]. The ADD on the Icon CBCT is only 21 cm due to the space limitations of making additions to a pre-existing design of the gamma knife [17]. Anti-scatter grids can be placed over the detector to reduce the SPR but will also decrease both the total number of scatter and primary photons, and thus raising the level of noise. To maintain a constant CNR, imaging dose may need to be increased by up to a factor of 2.5 [18]. Both air gap and anti-scatter grid methods reduce scatter after the imaging beam has already passed through the patient, which are not optimal for saving dose to the patient. Filters and collimators can be placed before the patient to reshape the profile of the beam and reduce scatter. The beam often faces more attenuation near the centre of the patient, resulting in a relatively lower primary signal. On the other hand, the scatter signal is usually greater near the centre, resulting in an overall higher SPR in the centre of the projection. A bowtie filter is a filter placed before the patient that is thinner near the centre and thicker towards the lateral sides. This has the effect of equalizing the level of attenuation and level of beam hardening across the beam. It also reduces dose to the patient and scatter from the patient. The primary near the centre of the projection is relatively unchanged while the scatter is reduced, resulting in an overall lower SPR. The Icon CBCT has a built-in bowtie filter that was optimized to produce a flat response at the detector when a 180 mm cylindrical water phantom is scanned [17]. Although bowtie filters offer many benefits, designs have been optimized primarily to reduce the dynamic range of the detector [19] [20], leaving scatter reduction as a secondary benefit. The optimization of a bowtie filter towards minimizing the

4

SPR to a region-of-interest (ROI) would result in the bowtie filter completely attenuating the parts of the beam outside the ROI. The aforementioned methods reduce the scatter during data acquisition but do not eliminate it completely. Monte Carlo methods estimate the scatter distribution after data acquisition and subtract it from the projections [21]. Though it is computationally expensive to estimate the scatter with good statistics, many simplifying approximations can be made to improve computation times without significant loss in accuracy. It has been shown through Monte Carlo simulation that the scatter distribution in CBCT projections contain mainly low spatial and angular frequencies [22] [23]. The noise can be removed from raw simulation data by filtering out the frequencies above a certain known cut-off. Monte Carlo scatter results can be scored at lower resolutions and then interpolated to higher resolutions after the frequency filtration. Though good resemblance to the true scatter distribution is expected, some aspects of the simulation differ from reality. The accuracy of segmentation in the patient object and the low number of different materials and densities can contribute to the error. Furthermore, the estimated scatter distribution from Monte Carlo [24] and other methods [25] [26] is smooth, and subtraction from the projection data will result in noisier corrected data. Noise suppression after scatter correction has been proposed [27] but such methods would further increase the image processing times. These scatter correction methods take action after data acquisition and, unlike collimator and filter methods, do not have the ability to reduce radiation to the patient.

1.3 Volume-of-Interest Imaging
The basis of volume-of-interest (VOI) imaging is to acquire projection data, only, of a pre-determined VOI. Doing so can reduce scatter and improve the contrast in the reconstructed image while making optimal use of dose to the patient. Research has been conducted on CBCT VOI imaging for over a decade [28] [29] [30] [31] [32]. The objective of these studies was to increase the image
5

quality inside the VOI, while sacrificing quality, or information altogether, outside the VOI. While the clinical application, focus of study, and technical approaches of these studies were varied, they all involved reducing the beam size such that it no longer irradiated the entire patient object. Different methods were proposed to address the projection data truncation problem, which arises when the beam does not transversely cover the entire patient object for all angles. The truncation artifact often appears in FDK-reconstructed images as a bright, circular border which extends image value inaccuracies to the centre of the image. Early VOI imaging approaches used filters to reduce the fluence in the parts of the beam that would not project the VOI [28] [29] [33]. This is similar in effect to the bowtie filter, without the curved profile to compliment the patient shape. Chityala et al. demonstrated with simulation of added noise that a filterbased VOI can be reconstructed with FDK with minimal artifacts while reducing dose to the object [28]. Real projections under a beam filter were acquired and various projection processing methods were tested, including equalizing the signal at the edge of the ROI, smoothing the region outside the ROI, and setting the region outside the ROI to a constant [29]. Also with a filter approach, Chen et al. used simulation to test the feasibility of VOI imaging for cone-beam breast CT [33]. Monte Carlo was used to calculate SPR and dose reductions offered by VOI. VOI methods later transitioned to the use of collimators [31] [34] [35], which completely blocked the beam outside the VOI, bringing about greater improvements in scatter reduction. To deal with data truncation, VOI projections were combined with low mAs full-field projections, forming composite projections [31] [30]. It was shown that although contrast increased in the VOI, noise also increased in the VOI, which led to only modest improvements in CNR [31]. This was consistent with an earlier study [14] which showed that noise increases as SPR decreases. The effect of increased noise in the collimated scan was explained by the decreased scatter photon count in the total incident quanta (the primary photon count remains the same). Since the total dose received by the patient from the VOI scan would be lower, it was justified to use a greater mAs to offset the increased noise. Parsons and Robar used higher mAs for the VOI scan
6

so that the dose to the VOI matched the dose to the VOI in the full FOV scan [34], which improved the CNR in the VOI. They also developed a dynamic iris aperture that can track non-isocentric VOIs, along with the required controlling software. Instead of acquiring a low mAs full-field set of projections, they opted to extrapolate, using an exponential function, the boundaries of the VOI projection data to 0 to mitigate the truncation artifact. Later their studies led to the integration of tube current modulation (TCM), which is the modulation of mAs as a function of projection angle to equalize the average signal-to-noise ratio (SNR), with VOI imaging to further improve the CNR [35]. It was determined that the CNR improvement from TCM alone was marginal compared to the CNR improvement from VOI collimation.

1.4 Truncated Projection Data Reconstruction
While a subset of the literature focused on measuring CNR improvements and dose reductions achievable from the VOI technique, another subset of the literature focused on the development of algorithms that can handle the reconstruction of truncated projection data. Truncated data reconstruction can lead to three main artifacts: cupping, a bright ring around the image, and an offset throughout the image (see Figure 1-1). Different algorithms have different projection data requirements, making some algorithms better suited to handle the so-called interior problem, which is when the projection data does not transversely encompass the object. In the FDK algorithm, the projection data is filtered by a ramp filter before backprojection. This step can produce bright edges in the projection data if there is truncation, which would appear in the reconstructed image as a bright ring. FDK is a filtered backprojection, which is derived with the use of the Fourier slice theorem [36], and is based on the idea that the spectrum of frequencies in the projection data is a line in the 2D frequency spectrum of the object. When the projection data is transversely incomplete, the frequency spectrum of the

7

Figure 1-1: An example of an image reconstructed with truncated projection data. The image should be uniform but a bright ring around the FOV exists instead, along with a cupping in the image values. The units of the image are the units of the reconstructed attenuation coefficient, mm-1. The window shown here is [0, 0.09] mm-1, whereas a typical CBCT window is [0, 0.04] mm-1, meaning that the values are inaccurate.

projection will change, which changes the 2D frequency spectrum of the reconstructed image, causing inaccurate reconstructed image values. As mentioned in the previous section, low mAs full-field projections can be acquired to avoid artifacts from data truncation, but doing so requires a second scan, and the information outside of the VOI may not be of interest. To reduce the magnitude of the truncation artifact with only data from a single scan, various extrapolation methods have been implemented, such as extrapolation using an exponential function [37], projection estimation from water cylinder data [38], and data filling from prior CT images [39]. Other analytic algorithms have demonstrated success with interior reconstruction, if some prior information about the object is known. It has been shown that the backprojection of the derivative of the projection data is the Hilbert transform of the image [40] [41] (also called the Hilbert image). To recover the image, the inverse Hilbert transform is performed on the Hilbert image. This method has been called differentiated backprojection (DBP) [40] [42], backprojection-filtration (BPF) [43] [44], or sometimes neither [41] [45] [46]. However, the Hilbert transform convolves the function with a global kernel, and therefore the Hilbert image must be known everywhere, which is not the case when only truncated projection data are available. Instead, the truncated Hilbert
8

transform can be solved if a sub-region along a specific line (PI-line) is provided as prior knowledge [45]. Such a method can reconstruct a VOI with accurate attenuation coefficients. An algorithm that does not require prior knowledge and can reconstruct a VOI is the approximated truncation robust algorithm for computed tomography (ATRACT). The ATRACT algorithm [47] replaces the ramp filter step of FDK with the Laplacian followed by residual filtering. Doing so effectively extrapolates the missing projection data in the Laplacian domain to 0. This algorithm does not produce the bright ring artifact but does require heuristic rescaling to reconstruct accurate attenuation coefficients.

1.5 Iterative Reconstruction Algorithms
The methods and algorithms in the previous subsection do not innately incorporate regularization methods for noise reduction. Generally a CT image can be approximated to be piecewise constant or piecewise polynomial [48], as is the image model of all total variation minimization problems. Iterative reconstruction algorithms incorporate regularization methods to improve convergence rates and reduce noise [49]. Iterative reconstruction algorithms also have milder projection data requirements, being able to reconstruct an image at a quality similar to FDK but with fewer projections [50] and at a lower dose [13]. The ramp filtering step from FDK is not required in iterative reconstruction, and with total variation regularization the truncation-induced ring artifact can be removed. In each iteration, the forward projection and backprojection operation is performed, which is computationally expensive for the data and image sizes required for clinical tasks. Though this type of algorithm was discovered 80 years ago [51], practical implementation has been infeasible until recent advances in computing power. The algorithm models the data acquisition process as a large system of linear equations [36], and to find the solution to the system of linear equations is to reconstruct the image. In the case of VOI imaging, there often exists more variables to solve for than there are equations, leading to an underdetermined
9

system with an infinite number of solutions. However, studies show evidence that the interior problem can be solved by minimizing the combination of data fidelity and total variation (TV) [48] [52] [53], with minimal cupping and offset artifacts. The reduction in truncation artifact can be explained heuristically: the truncation artifact can be regarded as a `ghost' function that is non-existent in the measured projection data and induces higher TV in the image. It is believed that the ghost function cannot survive the TV minimization [46] [52]. A recent study [42] has proposed the use of virtual projections in a framework (called the iterative virtual method) that allows them to reconstruct underconstrained datasets (truncated, few-view, and low-dose projection data). Their framework was demonstrated with 2D parallel beam projection data under various underconstrained conditions. Instead of the standard space-based forward projectors (ray-driven, voxel-driven, distance-driven, separable footprints, etc.), they used their previously proposed forward gridding projector (FGP) [54], which is Fourier-based with re-gridding. It was shown that edge padding with the boundary data is able to remove the cupping artifact caused by truncation, but the reconstructed image is a constant away from the truth. Different acquisition geometries were also tested for robustness, such as different size FOVs and nonisocentric FOVs.

1.6 Summary, Aim and Structure
1.6.1 Summary Characterization of VOI imaging has been published with hardware technologies such as dynamic collimation [34] and TCM [35]. These studies quantified the image quality improvements obtainable through the use of real beam collimation. Other studies focused on developing algorithms, such as DBP [45], ATRACT [47] and compressed sensing based interior tomography [42] [52] [55], that can reconstruct stable and accurate attenuation coefficients, without the use of a real collimator, and therefore contrast improvements from scatter reduction were not considered.
10

1.6.2 Aim of this Work There is a role for soft-tissue visualization and ideally direct tumor visualization in frameless stereotactic radiosurgery. The aim of this work is to quantify the CNR improvements achievable in VOI CBCT, with the practical objective of soft tissue visualization in head CBCT. Firstly, the standard FDK algorithm with edge extrapolation is used to establish a baseline for VOI image quality from a non-iterative reconstruction approach. Reconstruction is performed on synthetic projection data, which were created from a combination of Monte Carlo and analytical simulation to emulate the effects of reduced scatter from beam collimation. Secondly, the iterative framework with virtual projections is adapted to reconstruct the image with TV regularization and the effects on softtissue contrast and noise are examined. Artifacts from both reconstruction algorithms are compared. Lastly, Monte Carlo is used to quantify the dose distributions under the different VOI geometries, allowing for considerations of optimal mAs usage.

1.6.3 Structure of this Work Chapter 1 introduces the clinical motivation behind this work and justifies the research of VOI CBCT imaging. The key relevant papers in the literature are reviewed. Chapter 2 will go through the methods and algorithms used in this work, without discussing the specific structures of experiments. Chapter 3 will mention specific details and parameters of each experiment or trial and then show the results. Chapter 4 will discuss the significance of the results and make relevant comparisons to similar works in the literature, which will then lead to a discussion of future work and a summary. The Appendix contains a collection of information that did not belong in the main body.

11

2

Methods

2.1 Icon Cone-Beam CT
The simulation experiments were conducted in conformity with the geometry of the Icon CBCT, which is defined here. The source and detector rotate in a circular orbit around the patient. Let the right handed Cartesian fixed coordinate system (, , ) represent the image or patient space, where the unit  points in the posterior vector   points in the anatomical superior direction,   points in the anatomical left direction. The origin of the (, , ) direction, and  system, , is located at the intersection of the axis of rotation and the plane defined by the orbit of the source. A rotating coordinate system (  ,   ,   ) can be defined in terms of the fixed coordinate system  = (cos  , sin  , 0)   = (- sin  , cos  , 0)   = (0,0,1)  (2 - 1) (2 - 2) (2 - 3)

Where positive  is a counter-clockwise rotation from the -axis. Let the projection or detector space be represented by (, , ), which can be described relative to the rotated system (  ,   ,   ), where the -axis is antiparallel to the   axis and the -axis is parallel to the   -axis. The origin of the rectangular (, ) coordinate system, , which is a moving origin, is the point on the detector plane  and   that forms the shortest distance with the source. The cross product of  always points towards the patient; call this direction   . The angle  is also the  and - angle between   . For increasing angles, the rotated coordinate system can be viewed as counter-clockwise rotations of the source and detector. Refer to Figure 2-1a. By these definitions, the actual Icon system performs a scan with
12

a)

b)

c)

Figure 2-1: a) The 3 coordinate systems are shown at a 30º rotation. The distance between the origins of the systems is 210 mm. b) The geometry of the Icon beam and detector, as seen by an observer looking down on the plane of rotation. c) The geometry of the Icon beam and detector, as seen by an observer on the plane of rotation. Circles with an X indicate that the direction points into the page while circles with a dot indicate that the direction points out of the page.

13

decreasing angles, and would appear to rotate counter-clockwise when the observer is at the position of the patient's feet looking towards the head. As mentioned previously, the geometry of the Icon is slightly different from the CBCT units on LINAC systems, such as the XVI CBCT on the Elekta Synergy. The detector is positioned closer to the axis of rotation, having an ADD of 210 mm (compared to an ADD of 500 mm on the XVI), which relatively increases the signal SPR [22]. On the other hand, the Icon has a built-in aluminum bowtie filter that is approximately 3 mm at the centre and increases up to 30 mm laterally, which relatively reduces the SPR. The x-ray tube focal spot is situated at a source-to-axis distance (SAD) of approximately 790 mm, making the source-todetector distance (SDD) of the system approximately 1000 mm. The beam projects a space that is largely located in positive , i.e. the bottom of the detector sits around  = -1 mm and the top of the detector sits around  = 264 mm. The detector contains 780 x 720 pixels with a pixel resolution of 0.368 mm; the detector is around 287 mm by 265 mm. This creates a fan angle,  , of approximately 16º and a cone angle,  , of approximately 30º. See Figure 21b and 2-1c. The system natively reconstructs a 224 x 224 x 224 mm3 volume with isotropic voxels of width 0.5 mm. The centre of the bottom-most axial slice sits at  = 0 and the centre of the reconstructed volume sits on the axis of rotation. The system utilizes a half scan, rotating and acquiring projections relatively equiangularly through an angular distance of  +  . The system natively scans at 90 kVp but configurations can be altered to scan between a range of 70-120 kVp [17].

2.2 Synthetic Projection Simulation
2.2.1 Overview of Workflow The data acquisition process can be simulated analytically and through Monte Carlo to create synthetic projections. Doing so allows for the economical investigation of effects from beam collimation and VOI reconstruction. The artifacts and effects from different phenomena such as scatter, beam hardening,
14

and noise can be separated and studied independently, which would not be possible with real projection data. The workflow for producing synthetic projection data is comprehensive but effectively models the major physical processes of data acquisition, such as beam collimation, primary photons, scatter photons, noise, and blurring. This workflow is shown in Figure 2-2. Generally, the scatter signal is calculated through Monte Carlo, the primary signal is calculated analytically, the two components are combined and Poisson noise is added, and finally the projections are convolved with a point spread function. These steps will be described in detail in the following sections.

2.2.2 Virtual Head Phantom A patient head CT was used to create a virtual head phantom, which was then used for the creation of synthetic projection data. A slice of this phantom is shown in Figure 2-2. A virtual head phantom has more realistic anatomical structures when compared with virtual head phantoms defined by ellipses and rectangles, and also have scatter distributions with greater complexities. The patient head CT was resized and translated to an approximate Icon patient position and then segmented using image value intervals so that a segment was created for each of air, soft tissue, and bone. An 8 mm sphere was inserted on the axis of rotation close to where ventricles normally would be, to serve as a low contrast object in the VOI (an image of the phantom can be seen in Figure 3-6). In this case the level of contrast of the object could represent a tumor with injected contrast agent. The atomic composition in terms of weight fractions and the mass density of each material is shown in Table 2-1. The composition for air was defined from the pdcompos.p08 file from the PENELOPE 2008 Monte Carlo software package. The composition for brain is the ICRP defined brain composition [56]. The tumor composition was the ICRP defined brain composition but with added calcium. Although here calcium was added instead of a contrast agent, the object effectively had similar attenuation properties. For simplicity, the composition of bone used was pure hydroxyapatite, a common

15

Figure 2-2: An overview of the synthetic projection data workflow.

mineral found in bone. To represent a good average between cortical and trab16

ecular bone, a mass density of 1.20 g/cm3 was used. The data in Table 2-1 were used to define the phantom materials in Monte Carlo. A Matlab function called `xraymu' from Aprend Technology [57] was used to calculate the attenuation coefficients for each material. Xraymu uses x-ray attenuation data from NIST Report 5632 [58]. A mass weighted average was used to calculate the attenuation coefficients for each material (brain, tumor, and bone), which is shown in Eq. (2-4).   () =   ( ) ()   


(2 - 4)

Where the summation is over all the atomic elements in the material,  is the mass density, and () () is the mass attenuation coefficient as a function of energy,  . Eq. (2-5) defines the mass fraction (values shown in Table 2-1).  =      (2 - 5)


Where  is the number of atoms per molecule of the material and  is the atomic mass. Avogadro's number would normally appear in both the numerator and denominator and is therefore not shown. The attenuation coefficients calculated from Eq. (2-4) were used during polychromatic projection (see Section 2.7).

17

Table 2-1: The atomic composition of the materials used in the virtual head phantom. The values in the table are the mass fractions of the corresponding atomic element.

Element, Z H, 1 C, 6 N, 7 O, 8 Na, 11 Mg, 12 P, 15 S, 16 Cl, 17 Ar, 18 K, 19 Ca, 20 Fe, 26 Zn, 30

Air  = 0.0012 g/cm3 1.24E-4 7.55E-1 2.32E-1 1.28E-2 -

Brain  = 1.03 g/cm3 1.11E-1 1.25E-1 1.33E-2 7.38E-1 1.84E-3 1.50E-4 3.54E-3 1.77E-3 2.36E-3 3.10E-3 9.00E-5 5.00E-5 1.00E-5

Tumor  = 1.04 g/cm3 1.04E-1 1.18E-1 1.24E-2 6.91E-1 1.72E-3 1.41E-4 3.31E-3 1.66E-3 2.21E-3 2.90E-3 6.31E-2 4.68E-5 9.37E-6

Bone  = 1.2 g/cm3 2.01E-3 4.14E-1 1.85E-1 3.99E-1 -

2.2.3 X-ray Propagation It is known that the fluence, , defined here to be the number of photons per unit area, of an x-ray beam decreases as it propagates through space (not considering the divergence of the beam), and can be modeled by the standard law of exponential attenuation, () = 0  - 0 (
  ) 

(2 - 6)

The attenuation coefficient,  , is a property of the matter that the x-ray beam passes through and can be interpreted as the probability of x-ray photon interaction with matter per unit length. This is clear when Eq. (2-6) is written in its differential form
18

 = -() 

(2 - 7)

In radiography or CT, it is not possible to measure the fluence along the path,  , but rather only at the detector. The position of a polychromatic point source in the (  ,   ,   ) coordinate system can be defined as   () = -  detector plane (or point  as described in Section 2.1) is   (0,0, ) =   then be described as  + (-  ) +    (, , ) =   (2 - 10)  and   change as a function of . Then the direction Note that the unit vectors  of an x-ray is  (, , ) =   (, , ) -  () | (, , ) -  ()| (2 - 11) (2 - 9) (2 - 8)

Where  is the source-to-axis distance. The position of the centre of the

Where  is the axis-to-detector distance. Any point on the detector plane can

The length of the path that an x-ray propagates through is (, , ) = | (, , ) -  ()| Eq. (2-6) can then be rewritten for cone-beam geometry. (, , ) = 0  - 0 (+)


(2 - 12)



(2 - 13)

0 (, , ) is the fluence in the absence of any attenuating matter, i.e.  = 0. That is the essential meaning of 0 , but using Eq. (2-13) to define 0 would mean that it is being defined in terms of itself, so it will be defined qualitatively in Section 2.3. This derivation will be continued in Section 2.7, where more than one photon energy, scatter, noise, and blurring will be considered.

2.3 Monte Carlo Simulation
2.3.1 Phase Space Previous work has been done by the Research and Development Team at Elekta to simulate and create phase space files for the Icon system using Monte
19

Carlo. The Monte Carlo software used was called Pegasos, an Elekta-owned and developed system. Pegasos is based on Penelope, a well-known and validated Monte Carlo system developed at the University of Barcelona for doing electronpositron-photon transport in arbitrary materials and complex geometries. Pegasos features a graphical user interface called Hermes. Simulations were executed on a CPU cluster. A phase space file was used as an x-ray source for subsequent Monte Carlo simulations, and contained a list of photons with information of position, direction, energy, statistical weight, and scatter count number to be able to distinguish scattered particles from non-scattered particles. A CAD drawing of the Icon x-ray tube and the bowtie filter was used to simulate the phase space. For this simulation, a beam of 90 keV electrons was directed towards the anode and underwent interactions (e.g. bremsstrahlung and hard collisions) that produced xray photons. The photons that crossed a plane 14 cm away were recorded, creating the 90 kVp phase space. 346,180,000 photons were recorded this way; let this number be represented by  (the number of photons in the phase space). The creation of the phase space was crucial, as it served as a source for both subsequent Monte Carlo and analytical simulations.

2.3.2 Flood Image Simulation All Monte Carlo simulations henceforth were conducted using the 90 kVp phase space as the source. All components of the simulation (e.g. source, phantom, detector plane, rotation trajectory) were set up in the Icon CBCT positions described in Section 2.1. A simulation was conducted with no phantom present and  photons were transported. Phase space information was recorded at the detector plane. This detector phase space was processed in Matlab by first binning the photons into 1 keV wide bins, with bin centres ranging from 10 keV to 89 keV. Then the photons in each energy bin were binned by position, into 58 x 53 square bins 5 mm in width. Each bin/pixel was multiplied by the statistical weight of the photon and divided by the area of the pixel. Then the data was smoothed and up-sampled by the method described in Section 2.4, to the native

20

resolution of the Icon. This data, called the flood image, represents the photon fluence that reaches the detector when  photons are used for simulation and there is no object in the FOV. This is the 0 that is used for Eq. (2-13), and is a function of 0 (, , ). Note that 0 does not change as a function of angle .

2.3.3 Scoring Scatter Energy Fluence The realistic effects of beam collimation on scatter reduction can be accurately produced by using Monte Carlo to simulate the scatter signal under different sizes of collimation. The virtual head phantom was imported into Monte Carlo as voxels and materials were assigned to the corresponding segments. When simulating for scatter energy fluence, 3 photons were used. A 287 x 265 fluence plane with pixels 1 mm wide was used to score the energy fluence of scattered photons. The simulation was repeated for 30 different angles of the beam. Instead of rotating the source and fluence plane, the phantom was rotated instead to achieve the same effect. Such a set of simulations represented the limit of practicality, taking around 4 hrs to complete on the CPU cluster. To later generate realistic noise, it is necessary to know the scatter photon count as a function of , , , and  . For 80 energy bins, and to maintain similar photon statistics, the simulation time could increase by a factor of 80. Furthermore, it is impractical to store this information as it would take around 56 GB per simulated Icon scan. This data can be stored at a lower resolution and then up-sampled when it is needed, but that would be too computationally expensive. Instead, the number of scatter photons in each energy bin were calculated by assuming that the scatter photon energy spectrum was the same everywhere on the detector. Under this assumption, only photon energy fluence would need to be scored through Monte Carlo, making efficient use of storage and computation. Consider that the total photon energy fluence measured at a single pixel, , is  =   


(2 - 14)

21

Where the summation is over the energy bins,  is the photon energy of that bin, and  is the scatter photon fluence of that bin. Let   be equal to   =  


(2 - 15)

Then  =    


  

=     


(2 - 16)

Where  is the spectrum of scatter photons. Rearranging Eq. (2-16) for   ,   = Then finally multiplying Eq. (2-17) by   =    =       (2 - 18)     (2 - 17)

The scatter photon fluence at each energy bin can be calculated from the Monte Carlo computed (, , ). As discussed, it is impractical to store or compute  for every pixel. To overcome this practical limitation, an average  was used for every pixel. The assumption that  does not vary as a function of detector position was supported by a simulation of the virtual head phantom where the scatter photons (only) were scored in a phase space. With a binning method similar to the one described in Section 2.3.2, the energy spectrum of the scatter photons was analyzed (see Section 3.1). After the assumption was justified, a spectrum plane was used in subsequent simulations to only measure the average scatter photon spectrum of the whole detector area, to obtain  () for that scan simulation.

2.3.4 Dose Measurements Pegasos accounts for the attenuation coefficients assigned to the virtual phantom and uses a dose box to score the energy absorbed throughout the simulation. The energy absorbed was divided by the mass density of the material to arrive at the dose. A dose box was scored for each simulation, i.e. each angle, and the results were summed in Matlab to find the total dose distribution of the
22

scan. The total simulated dose was then upscaled to the correct number of projection angles and multiplied by  (see Section 2.7.2 for the definition of  ). Since 3D dose data would be scored for each angle, the data size of the results would increase rapidly for large box sizes. For this experiment, low resolution dose information was sufficient; a 56 x 56 x 56 voxels dose box with voxel width of 4 mm was used. The dose data for different collimator sizes was compared using the integral dose fraction    =  ,  , (2 - 19)

Where the summation is over all the voxels of the virtual phantom.

2.4 Scatter Distribution De-noising and Up-sampling
The scatter energy fluence scored from Monte Carlo is orders of magnitude noisier than reality and requires de-noising before use. As discussed previously, it has been shown that the scatter distribution from typical CBCT scans contain mostly low spatial and angular frequencies [22] [23]. The denoising and up-sampling method used in this work was adapted from [23] [24]. The raw scatter photon energy fluence,  (, , ), is first 3D Fourier  ( ,  ,  ). The full spectrum contains, e.g. 287 x 265 x 30 transformed to  points. The positive and negative sides of the spectrum are then zero padded so that the number of points is equal to the up-sampled size, e.g. 780 x 720 x 334 points. Then the spectrum is filtered by the 3D Butterworth filter, ( ,  ,  ), of the up-sampled size. Then the data is transformed back to the space domain. The 3D Butterworth filter is ( ,  ,  ) =
1
2 ) 1+(( , 2 3 2 2 2 2 ) +( ) ) +( , ,

(2 - 20)

This filter has a value of 1 for the DC frequency and decreases as  ,  , and  increases. The `width' of this filter is controlled by the cut-off frequencies , , , , and , . The cut-off frequencies were determined heuristically and are

23

shown in Table 2-2. This same method was used to de-noise and up-sample the flood image.
Table 2-2: The frequency cut-offs for de-noising results from Monte Carlo.

Catphan 503 Virtual Head Phantom Flood Image

, (mm-1) 0.030 0.032 0.028

, (mm-1) 0.030 0.032 0.014

, (rad-1) 8/ 8/ -

2.5 Forward Projection Operation
The forward projection operation in CT is the calculation of the integral in Eq. (2-13), rewritten here


 ) (, , ) =  ( + 
0

(2 - 21)

For discrete data, this integral can be evaluated in many different ways with varying levels of accuracy. Generally, the higher the accuracy, the more computationally expensive it is. The forward projection is used many times repeatedly in iterative reconstruction algorithms and its accuracy and efficiency is important for fast convergence rates. For this work a ray-driven forward projector is used, similar in idea to [59]. The first step is to start in the rotated coordinate system (  ,   ,   ) and the detector coordinate system (, , ). A line is connected in thought from the  are not calculated source to a pixel on the detector at (, ). The vectors  and  explicitly, but rather the proportionality of similar triangles is used to find the set of points (  ,   ,   ) that lie on this line. A loop is made over each of the   planes, e.g.   = -111.75 mm,   = -111.25 mm,   = -110.75 mm, ...,   = 111.75 mm, to find the values   and   that lie on the line and the   plane. Eq. (2-22) and (2-23) are true from the proportionality of similar triangles.    +   =-      +   =  
24

(2 - 22) (2 - 23)

Where  is the source-to-detector distance. The second step is to convert the set of points on the line in terms of (  ,   ,   ) back to the fixed coordinate system (, , ) so that the array holding the object can be referenced. Let  () be the rotation matrix that rotates the  and  axes about the -axis counter-clockwise. cos   () = [- sin  0 sin  cos  0 0 0] 1 (2 - 24)

The points on the line in terms of (, , ) are then just    [] =  (-) [  ]    (, , ) by 0   1 [  ] = ([] - [0 ])   0  (2 - 26) (2 - 25)

The set of points in terms of (, , ) are then converted to the matrix indices

Where (0 , 0 , 0 ) is the position of the most negatively positioned image voxel and  is the width of an image voxel. So the forward projection can then be written as (, , ) =    (, , )
 

(2 - 27)

Where  (, , ) is the trilinearly interpolated  value at (, , ) and  is the pathlength 2 +  2 + ( )2  =   The interpolated  (, , ) is shown in the Appendix. (2 - 28)

2.6 Backprojection Operation
The backprojection operation is the calculation of the integral
2

(, , ) =  (, , )
0

(2 - 29)

25

It is unclear what is happening in this integral until the variables  and  are written in terms of , , and . Furthermore, the backprojection operation does not model any physical process, but rather appears in reconstruction algorithms as a result of using the Fourier slice theorem [36], inverting the Radon transform [40] [60], or as the transpose of the forward projection matrix [36]. This integral alone does not necessarily reconstruct an image; filtering or weights are needed. Eq. (2-29) merely shows that the idea of the backprojection is to integrate projection values over a range of projection angles. Many ways exist, also, to evaluate Eq. (2-29) for discrete data. It is important that it is computed accurately and efficiently for image reconstruction. A voxel-driven backprojection is used in this work. A loop over each voxel in the image is performed. The position of each voxel is then rotated by     [ ] =  () []    Or   =  cos  +  sin    = - sin  +  cos    =  (2 - 31) (2 - 32) (2 - 33) (2 - 30)

The voxel-driven idea is to imagine a line that connects the source with the image voxel. Then, using the proportionality of similar triangles again, the point on the detector that is hit by the line is  = -   =     +   (2 - 34) (2 - 35)

  +  

Eq. (2-29) can now be rewritten with Eq. (2-34) and (2-35) to get an equation for backprojection under cone-beam geometry.


(, , ) =   (- 
0

  ,   , )    +   +  

(2 - 36)

Like for the forward projector,  and  were converted to array indices

26

1 0   [ ]= ([ ] - [ ])  0  

(2 - 37)

Where (0 , 0 ) is the position of the most negatively positioned projection pixel and  is the width of a projection pixel. The voxel-driven backprojection can now be written discretely as (, , )    (, )


(2 - 38)

Where  has been interpolated using bilinear interpolation (See the Appendix). The forward and backprojection operations were written in CUDA C to be executed mainly on the GPU using texture memory. Texture memory is designed to be able to efficiently perform 3D linear interpolations and offers a tremendous reduction in computation times. However it only performs linear interpolation when reading pixel/voxel values and therefore it is most practical for these algorithms to loop over the pixels/voxels of the output array. For example, the ray-driven forward projector loops over and writes to the projection pixels, which do not require interpolation, and each ray reads image values stored on texture memory, which need to be interpolated. The voxel-driven backprojector loops over image voxels, which do not require interpolation, and reads projection values stored on texture memory, which need to be interpolated. Texture memory could not be exploited this way for voxel-driven forward projectors and ray-driven backprojectors.

2.7 Polychromatic Projection
2.7.1 Material Length Projection Discussion here will continue from Section 2.2.3, now that the scatter generation and forward and backward projections have been discussed. Eq. (2-13) describes the fluence at a detector pixel for photons of a single energy. To do the forward projection the virtual phantom array can just be filled with the attenuation coefficients of a certain energy using Eq. (2-4). However, the virtual phantom would need to be refilled with attenuation coefficients for each energy bin and
27

forward projected each time. Instead, it is faster to find the total path length of a certain material, e.g.  ,  , and  . To do this, the virtual head phantom was forward projected only 3 times, once for each of the materials brain, tumor, and bone. For example, during the forward projection of the brain, the voxels containing brain were set to a value of 1, and all other voxels are set to 0. Then Eq. (2-27) would calculate  (, , ). The forward projection of each material is shown in Figure 2-2. This is efficient because  does not change as a function of energy, and it is fast for xraymu to compute the vector of attenuation coefficients for each material,  (). Eq. (2-13) can be rewritten with the new exponent


(, , ) = 0 exp (-




 () (, , )) (2 - 39)

Let Eq. (2-39) be equal to  (, , , ): the number of primary photons of a certain energy that hit a certain detector pixel per unit area. Now  needs to be added with  (, , , ), the number of scatter photons per unit area. From de-noising and up-sampling the raw Monte Carlo scatter energy fluence,  (, , ), to get the processed scatter energy fluence (, , ), Eq. (2-18) can be used to get  (, , , ). The total of both primary and scatter fluence incident on the detector is then 1  (, , , ) =  (, , , ) +  (, , , ) 3 (2 - 40)

The scatter fluence is divided by 3 because 3 times as many photons from the phase space were used for the scatter simulation (Section 2.3.3) than for the flood image simulation (Section 2.3.2).

2.7.2 Poisson Noise Generation Poisson noise was generated in Matlab using the `imnoise' function. The mean used for the Poisson distribution was  , the total photons at the pixel  (, , , ) =  (, , , ) 2  (2 - 41)

28

 is the fluence (from both primary and scatter) that results from using  photons in the simulation, but does not represent the actual level of fluence from a real scan.  is a factor to rescale  to get a realistic number of photons hitting the detector, and was determined by comparing noise power spectra of real and synthetic Catphan projections (see Section 2.8). For completeness,  was 5 x 103. Let the tilde represent that the number of photons is Poisson distributed. After noise generation the units were converted back   (, , , ) =   (, , , )   2  (2 - 42)

Assume that the signal produced by the detector is linearly proportional to the fluence reaching the detector for photon energies under 100keV. Then the signal can be written as   (, , , ) (, , , ) =  (2 - 43)

Where  is a proportionality constant. The tilde is not used for  but it is understood that there is noise in  . Since the beam is polychromatic, as are the simulations using phase space sources, the signal should be an integration over energy   (, , , )  (, , ) =   (2 - 44)

To find the signal when there is no object in the FOV, Eq. (2-39) to (2-44) can be used in the case that  = 0, there is no scatter, and there is no noise. 0 (, ) =  0 (, , )  (2 - 45)

2.7.3 Projection Point Spread Function Blurring When a photon hits the detector, more than just conversion to an electric signal occurs. The photon is propagated through a scintillating material that causes the spread of a ray of photons. This spread is difficult to model, as it depends on the direction of the incident ray and its energy. Almost all primary photons that are absorbed by a pixel will have hit the detector from the same angle of incidence. On the other hand, scatter photons that are absorbed by a pixel
29

hit the detector from many different angles of incidence. Furthermore, the object is in constant rotational motion with respect to the source and detector, so the attenuation coefficients picked up by the ray are blurred. The beam of photons produced by the x-ray tube can be traced back to originate from a focal spot rather than a single point, as described by the position of the point source,  , in Eq. 213. Therefore the forward projector does not account for the fact that the point source exists in many different locations. These are all blurring effects that have not yet been accounted. For practicality, a single, radially symmetric point spread function (PSF) was used to represent all the effects mentioned above. The point spread function model used in this work was adapted and simplified from Mikael Kordel's thesis [61]. Through trying a range of PSF parameters and comparing the real and simulated noise power spectrum (NPS) of a Catphan 503 phantom, the best matching point spread function used was
0.0013 0.0039  h(u , v)  0.0062  0.0039  0.0013 0.0039 0.0213 0.0565 0.0213 0.0039 0.0062 0.0565 0.6271 0.0565 0.0062 0.0039 0.0213 0.0565 0.0213 0.0039 0.0013 0.0039  0.0062  0.0039 0.0013 

Though not shown in the equation, the PSF was convolved simply with the signal in Eq. (2-44).

2.8 Noise Power Spectrum Calculation
Real projections of Catphan 503 scanned with the Icon CBCT were acquired. Synthetic projections of Catphan 503 were created by using a structural model of the Catphan. The objective was to compare the noise in the uniformity module of the Catphan, CTP486. The Catphan contains over 15 materials and inclusion of all materials would result in massive memory use for Eq. (2-39) as well as Monte Carlo. Since Monte Carlo was used only to generate the scatter distribution, only 3 materials were assigned: the uniformity material in CTP486, and two filler materials. It was assumed that not assigning materials to the smaller
30

objects of the Catphan would not significantly affect the scatter. The same 3 materials were used to calculate the primary fluence, since the cylinders in the sensitometry module and the bars in the line pair module did not interfere with the forward projection of the uniformity module. To evaluate both the level of noise and the blurring, the noise power spectrum of the data was calculated. The following formula was used to calculate the NPS    , )]|2  |[(, ) -  ( ( ,  ) =  

(2 - 46)

Where  and  are the number of pixels on the projection. The mean of the  , ), was approximated by calculating the mean of pixels in a flat signal,  ( region. The NPS was calculated for a 50 x 50 pixel region near the centre of the Catphan in the uniformity module that was as uniform as possible (see Figure 23). This was repeated for 60 projections to get a good average NPS. A range of PSF parameters and  values were searched to find the PSF and  value that made the best match between real and synthetic NPS. The NPS-matching  was found to be 5 x 103, and the best matching PSF is shown in Section 2.7.3. After this initial verification of the synthetic data with Catphan 503, the same  and PSF was used for all subsequent simulations.

Figure 2-3: A synthetic projection of the Catphan 503, shown with a very narrow window. The blue box shows the selection of a uniform (as uniform as possible) region in which the NPS was calculated.

31

2.9 FDK Reconstruction
2.9.1 Standard FDK An image of the scanned object can be reconstructed by the data collected; that is, a map of the attenuation coefficients can be reconstructed. From the signal collected, an integral of the attenuation coefficients can be written 0 (, )  ) = (, , ) ln =  ( +  (, , )
0 

(2 - 47)

Let the projection data be denoted in short by (, , ). It is not necessary to know  in Eq. 2-44 and 2-45 since it will cancel out in Eq. 2-47. Note that the reconstructed attenuation coefficients will not be a function of any single energy, but rather an average from the spectra in the acquisition beam. From the projection data, the integral of the attenuation coefficients is known, the purpose of the reconstruction algorithm is to find the location of the attenuation coefficients. FDK is the clinical standard for CBCT reconstruction because of its accuracy, ease of computation, and robustness. The first step is to multiply the projection data with the cosine weights,   ,   (, ) =   + 2 +  2 The CBCT systems that use a half scan ( +  ) will have some redundant data at the beginning and end of the scan [62]. To prevent rays from being doublecounted, the projections are multiplied by the cone-beam Parker weights [63],  , shown in the Appendix. The weighted data are then filtered by the ramp filter multiplied by a Hamming window. ( ) = | | (0.54 + 0.46 cos ( The weighted and filtered data is  (, , ) = ()  ( (, , )  (, )(, , ))
32
2

(2 - 48)

| | )) ,

(2 - 49)

(2 - 50)

The ramp filter in Eq. (2-50) is shown in the space domain but is often applied in the frequency domain. Using Eq. (2-36), the last step is to back project with an additional weighting [36]
+

(, , ) 


0

2      ( )  (- ,  , )    +    +    +  

(2 - 51)

2.9.2 Cosine Edge Extrapolation To reconstruct truncated projections, the edges were transversely extrapolated with a cosine function as a preprocessing step. The extrapolation is performed in the transverse direction, which is the same direction as the ramp filtering. For data with  pixels in the full FOV, consider the acquisition of VOI data from pixels 1 to 2 (inclusive), where 1 < 1 < 2 <  . Data extrapolation is done to fill in the pixels from pixel 1 to 1 - 1 and 2 + 1 to  . On the left side of the projection, the extrapolated values are ( ) = (1 ) cos2 (  ( - 1 )) 2(1 - 1)  (2 - 52)

On the right side of the projection, the extrapolated values are   - 2 ( ) = (2 ) cos2 ( ) 2  - 2

(2 - 53)

This extrapolation makes the data continuous at the truncation boundary. The frequency of each cosine function was chosen such that the extrapolation reaches 0 at the edge of the detector. However, different frequencies can be used, or the same frequency can be forced for both sides of the projection. Generally the extrapolation can be performed for frequencies 1 and 2 ( ) = (1 ) cos 2 (1 ( - 1 )) ( ) = (2 ) cos2 (2 ( - 2 )) For the left and right side of the projections respectively. (2 - 54) (2 - 55)

33

2.10 Iterative Reconstruction
2.10.1 OS-SART with TV Regularization The x-ray forward projection can be modelled by a large system of linear equations. To see a good explanation of this, refer to Chapter 7 of [36]. Instead of referring to the image as (, , ), let  represent a vector of dimension      (or the number voxels,  in the reconstructed image). Let  represent a vector of dimension      (the number of projected pixels,  ). Then  =  (2 - 56)

Where  is an    matrix that represents the forward projection operation, and  is the projected data. For this section, let  represent the index of the projection pixel and  represent the index of the image voxel. In theory, an image is reconstructed by finding  that minimizes the data error norm. The reconstructed image can be regularized by also minimizing the total variation of the image. This is a powerful technique that can remove noise from the image and `fill in' data in few-view CT [12]. The definition of the total variation used in this work is the 1 -norm of the gradient-magnitude image [12]. The total variation is minimized using gradient descent; that is, the gradient with respect to . (+1) = () -  ()   (2 - 57)

Where  is a parameter that is used to control the strength of the regularization and  is a normalization for the gradient. Let the total variation of an image be represented by   , then the gradient of the total variation with respect to  is [12]    = 


      

(2 - 58)

Where    is the unit vector of the  -th voxel. For this paragraph only, regard  instead as an array in 3D space. Let  represent the  -th voxel in the x-direction,  represent the -th voxel in the y-

34

direction, and  represent the -th voxel in the z-direction. Then Eq. (2-58) can be written discretely as [12] ,, = - - - 3,, - -1,, - ,-1, - ,,-1 (,, - -1,, )2 + (,, - ,-1, )2 + (,, - ,,-1 )2 +  +1,, - ,, (+1,, - ,, )2 + (+1,, - +1,-1, )2 + (+1,, - +1,,-1 )2 +  ,+1, - ,, (,+1, - -1,, )2 + (,+1, - ,, )2 + (,+1, - ,+1,-1 )2 +  ,,+1 - ,, (,,+1 - -1,,+1 )2 + (,,+1 - ,-1,+1 )2 + (,,+1 - ,, )2 +  (2 - 59) Where  is a small constant to prevent the evaluation of a singularity. An image is reconstructed by the following equation  = argmin{ - 2 2 +   } (2 - 60)

Where  is the acquired projection data. For minimization of the data fidelity term, the ordered subset simultaneous algebraic reconstruction technique (OSSART) [64] is used. Dividing the projection data into subsets increases the convergence rate when compared to using all projections in one iteration. In regular SART the image is updated with (+1) = () +  ( - () ) Where  (row-sum) is an    diagonal matrix whose entries are , = 1  , 1  , (2 - 62) (2 - 61)

 (column-sum) is an    diagonal matrix whose entries are , = (2 - 63)

 represents the backprojection operation and  is a relaxation parameter. In OS-SART the set of projection data are divided into subsets and Eq. (261) cycles through each subset. In the case of the Icon projection data set, the 334 projections were divided into 25 subsets with 13 projections in each subset, leaving 9 projections unused. A 26th subset with 9 projections in it could be used,
35

but for simplicity, the size of each subset was kept the same. This procedure implies that the forward projection matrix, , back projection matrix,  , inverse row-sum matrix, , inverse column-sum matrix, , and the measured projections, , will be unique to each subset of projections. Let  represent the subset number,  represent the total number of subsets, and  represent the iteration number, then  = mod(,  ) (+1) = () +     ( -  () ) (2 - 64)

Eq. (2-61) can be rewritten to acknowledge the current subset in the iteration (2 - 65)

From an implementation standpoint, none of the subset dependent matrices require re-computation except for  . To alleviate computational burden, in this work  =   (2 - 66)

For all  , which should be a close approximation, given  is not too large. In this work, one iteration is counted after one subset is used, since the computational costs of Eq. (2-61) and Eq. (2-65) are similar. The algorithm contains a few hyperparameters, ,  (which were already mentioned),  ,  ,  , - , and  .  and  are the relaxation rates. After each respective iteration,  and  are updated by    ×     ×  (2 - 67) (2 - 68)

Following the algorithm in [52],  = 1, and is not relaxed ( = 1). The regularization strength and its relaxation rate are varied depending on the reconstruction, and will be specified correspondingly in the Results section. Since the OS-SART step never relaxes, after many iterations when  is sufficiently low, noise will be reintroduced into the image. To control the level of noise,  is always reduced to a minimum of  , which was 0.000033. Note that in some reconstructions this point was never reached. - and  are the number of iterations for each of the minimization steps. The structure of the algorithm is summarized below

36

1. Iterate outer loop - times 2. 3. 4. 5. 6. End In this work  = 5. Lastly, the normalization for the gradient in Eq. (2-57), , was equal to the max of the image divided by the max of the gradient of total variation. End Do OS-SART (Eq. (2-65)) Iterate inner loop  times Do TV minimization (Eq. (2-57))

2.10.2 Iterative Virtual Method The method in Section 2.10.1 can reconstruct a VOI with accurate attenuation coefficients near the centre of the image, but towards the border there still exists an erroneous cupping in the image values (Figure 3-10). Although this cupping is not as severe as in VOI images reconstructed with raw FDK, it does reduce the size of viable FOV, especially when looking at soft tissue. Evidence shows (Figure 3-11) that the cupping exists, but seems to disappear as the number of iterations increases; therefore either the algorithm is unable to remove the cupping artifact, or it can but takes too long to satisfactorily remove it. It is likely that the cupping is caused by the incomplete projection information; the measured projection data contains line integrals of the space before and after the VOI, but integrals of that space are missing at different angles. On the other hand, VOI FDK reconstruction with cosine extrapolation shows a resilience against the cupping artifact (Figure 3-7) when compared to other methods like exponential extrapolation [37]. The iterative virtual method (IVM) [42] was adapted for VOI reconstruction, which is outlined in Figure 2-4. IVM was originally proposed by [42] and demonstrated for 2D data, but will be described and demonstrated here

37

Figure 2-4: Visualization of the iterative virtual method.

with cone-beam data. IVM is a framework that starts by reconstructing a VOI image with an analytical algorithm; which can be FDK with cosine extrapolation, ATRACT, or DBP. The second step is to zero the voxels outside of the VOI. The third step is to forward project the reconstructed VOI to make a set of virtual projections. Lastly, iterative reconstruction is performed using the analytically reconstructed image as the initial solution and the virtual projections in place of
38

the measured projection data. The benefit is that the virtual projections will contain line integrals of the reconstructed VOI only and will not introduce any cupping, while the TV regularization will remove noise. In the case of initial reconstruction with FDK or ATRACT, the offset in the image will carry over to the virtual projections. This could, in theory, be corrected by starting a separate reconstruction with OS-SART to find the correct value of the image and using that to adjust the FDK or ATRACT reconstructed image. In this work IVM was implemented with cosine-extrapolated FDK as the analytical reconstruction and OS-SART with gradient TV descent as the iterative reconstruction.

2.11 VOI Contrast, Noise, and SPR Measurements
Using the virtual phantom created from a CT patient, VOI synthetic projections were created and reconstructed using FDK and IVM. The position of the VOI centre lies on the axis of rotation so that the position of the collimator was fixed. A range of collimator sizes was used to produce the following square field sizes at isocentre: 22 x 22 cm2 (no collimator), 12 x 12 cm2, 8 x 8 cm2, 6 x 6 cm2, 4 x 4 cm2, and 2 x 2 cm2. The contrast of the tumor was measured by  =  -  (2 - 69)

For each field size. An average of pixels was taken. The noise of the image was calculated by considering the pixels of the brain close to the tumor. The CNR calculated was  =  -   (2 - 70)

The SPR (scatter energy fluence/primary energy fluence) on the projections was measured by taking the average scatter signal and the average primary signal in a 50 x 50 x 334 pixel region in the projection of the VOI. It was averaged over all the projection angles, hence the dimension of 334.

39

3

Results

3.1 Scatter Photon Energy Spectrum
Phase space information of the scattered photons from the virtual head phantom were recorded and analyzed. From binning (binning method described in Section 2.3.2) the results from the recorded phase space, the scatter photons were separated into 80 energy bins. The 2D Butterworth filter was used to de-noise the spatial frequencies. Figure 3-1 displays the energy spectrum envelop (grey), which consists of all 58 x 53 individual spectra for each detector element, as well as the average energy spectrum (in black). The 3 different plots represent the results at 3 different rotation angles, 180º, 135º, and 90º. Despite the irregular shape of the human head, the energy spectrum of the scatter photons did not vary much as a function of detector pixel position as indicated by the narrow envelop, nor as a function of rotation angle. This supports the assumption that an average scatter photon energy spectrum can be used to accurately perform calculations of Eq. (2-18), which would lead to accurate scatter noise levels. The 3 simulations were done with a full field beam. It is expected that this assumption would hold if the simulation were repeated with a collimated beam.

40

 = 180°

 = 135°

 = 90°

Figure 3-1: The energy spectra of the scatter photons. The energy spectrum was plotted for each pixel, shown as a grey envelop. The average energy spectrum was plotted in black. Top: Simulation performed at a rotation angle of 180º. Middle: Simulation performed at a rotation angle of 135º. Bottom: Simulation performed at a rotation angle of 90º.

41

3.2 De-noising and Up-sampling Monte Carlo
The Monte Carlo calculated scatter distributions were de-noised using the 3D Butterworth filter and up-sampled by Fourier interpolation. The cut-off frequencies used were shown in Table 2-2. Figure 3-2 shows the raw scatter energy fluence, the processed scatter energy fluence, and the difference image from a full-field beam. The scatter distribution is shown for a simulation at a rotation angle of around 155º. The filtering was able to remove the noise without changing the shape of the low frequency scatter distribution, which is apparent in the relatively flat but noisy difference image. v

u

Figure 3-2: Top left shows the raw Monte Carlo calculated scatter energy fluence for a full-field beam. Top right shows the de-noised scatter energy fluence. Bottom shows the difference image.

42

Figure 3-3 shows the results for the simulation repeated but with a beam collimator that produces a field size of 6 x 6 cm2 at isocentre. v

u

Figure 3-3: Top left shows the raw Monte Carlo calculated scatter energy fluence for a 6 x 6 cm2 beam. Top right shows the de-noised scatter energy fluence. Bottom shows the difference image.

The image range shown in Figure 3-3 is about 4 times smaller than the range shown in Figure 3-2, which indicates that the max scatter signal was around 4 times lower when the 6 x 6 cm2 collimated beam was used. The de-noising works well even with the sharp cut-off from the collimated beam.

43

3.3 Noise Matching in Synthetic Projections
It was necessary to find the scaling factor,  , to establish a realistic level of noise in the synthetic projections as well as to scale the Monte Carlo calculated dose to the correct amount. The width and shape of the point spread function had an effect on both the level of noise and the type of noise. It was desirable to have correlated noise in the reconstructed image, as it would have an effect on object visibility and the TV denoising process. To find a good estimation for  , the NPS of synthetic and real projections of the Catphan 503 were calculated respectively and compared. If the synthetic projections were not blurred, the level of noise would be higher, and  would be underestimated as a consequence after noise matching, which would then increase the error when scaling the Monte Carlo calculated dose. Figure 3-4 shows the 1D NPS for rows (-direction) of synthetic projection data and real data. The data used was in the form /0 ; before performing the natural logarithm. The 0 frequency data point is not shown since it was just 0.

Figure 3-4: The 1D NPS along the -direction of the non-blurred and blurred synthetic projections, and the real projections of the Catphan 503. The PSF shown in Section 2.7.3 was used. The shape of the NPS and the area under the NPS of the synthetic data better approximate the real data after blurring.

44

The NPS of the synthetic projection data before blurring was relatively flat, which was expected of uncorrelated noise. The first frequency point was higher possibly due to the fact that the background was not perfectly flat (see Figure 2-3). After blurring, the area under the NPS was reduced, indicating a reduction in noise in the projection data as expected. The shape of the NPS of the synthetic data was also closer to the NPS of the real data after blurring. Figure 3-5 shows the 2D NPS of the synthetic and real data.

Figure 3-5: Comparison of the 2D NPS of synthetic data with and without blurring and real data.

Again, it can be seen that the 2D NPS was flat when PSF blurring was not used. There appears to be a higher correlation in the -direction of the real data that was
45

not seen in the synthetic projections. This could be a result of the blurring caused by the movement of the source and detector during data acquisition, which was not taken into consideration by the radially symmetric PSF used in the modelling.

3.4 FDK VOI Truncation Cupping Artifact Compensation
The truncation-induced artifacts in the reconstructed image were examined by reconstructing a set of noiseless and scatter-free synthetic projections of the virtual head phantom. The synthetic projections were manually truncated according to a VOI of a certain size and at a certain position. Cosine extrapolation of the truncated projection data before FDK reconstruction was used to reduce the magnitude of the cupping artifact in the reconstructed VOI image. The method was compared to extrapolation with an exponential function [37]. Figure 3-6 shows the full FOV reconstruction of the synthetic projection data, with the dashed blue circle indicating the position of the VOI. Since the reconstructed image is a map of attenuation coefficients, each pixel of the image has units of mm-1, not to be confused with the unit of frequency, which is also mm-1. y

x

Figure 3-6: Full FOV FDK reconstruction of the synthetic projections. Dashed blue circle indicates the position of the VOI. (Window = [0.017, 0.027] mm-1)

46

Figure 3-7 shows the comparison between using cosine extrapolation and exponential extrapolation to reconstruct truncated projections using FDK. The diameter of the FOV was 6 cm. All images are shown with a window that is 0.006 mm-1 wide, but the centres of each of the windows are different, indicating that there is an offset error in the reconstructed VOI images when compared to the ground truth on the left.

Figure 3-7: Left is a close-up of the VOI region shown in Figure 3-6. Middle is the VOI reconstructed with cosine extrapolation and FDK. Right is the VOI reconstructed with exponential extrapolation and FDK. All images are shown with a window width of 0.006 mm-1. However, left has a window of [0.0186, 0.0246] mm-1, middle has a window of [0.0205, 0.0265] mm-1, and right has a window of [0.0142, 0.0202] mm-1.

The FDK reconstruction with cosine extrapolation appears to be more resilient against the cupping artifact, though the left side of the image was still brighter than it should be. These images can be compared with Figure 1-1, where no extrapolation was used.

3.5 VOI Image Quality
This section quantifies the effect of reducing the field size on the image quality. Synthetic VOI projections were created using the whole workflow (i.e. including scatter, noise, and blurring) at a constant  . The projections were reconstructed with cosine extrapolation and FDK. In the absence of scatter and noise, the ground truth contrast of the tumor object was 0.0026 mm-1. Figure 3-8 shows the contrast, noise, and CNR of the tumor as a function of field size. Figure 3-9 shows the average SPR in a small centre region of the projections as a function of field size. As the field size decreased, the scatter from the object was
47

reduced and the SPR decreased. The reduced SPR increased both the contrast and the noise in the image. As a result, the CNR increased only marginally. The CNR at full FOV was 1.72 while the CNR at a FOV of 6 cm was 1.90, resulting in a CNR improvement factor of 1.10 (later seen in Figure 3-12 and Table 3-1).

Figure 3-8: Image quality of the VOI as a function of field size. The 22 x 22 cm2 field size represents the full FOV.

48

Figure 3-9: The scatter-to-primary ratio as a function of field size.

Since the CNR improvements were marginal, the visibility of the tumor in the FDK reconstructed VOI images was very similar between the different field sizes.

3.6 VOI Iterative Reconstruction
This section shows the reconstruction of the synthetic VOI projections using OS-SART and TV regularization. An initial image of 0 was used for the reconstruction. As mentioned before, the projections were divided into 25 subsets with 13 projections in each subset. They were divided such that the projections in a subset were as angularly separated as possible. First the reconstruction was performed on a set of noiseless and scatter-less projections to assess the ability of the algorithm to handle the truncation artifacts. Figure 3-10 shows the reconstructed VOI image after 400 iterations. This image can be compared with the images in Figure 3-7. The cupping in the iteratively reconstructed VOI image appears to be worse than the FDK reconstructed images with edge extrapolation. The iteratively reconstructed image was perfectly smooth because of the TV regularization, whereas the high frequency artifacts of the forward and back projection operation can be seen in the FDK images. The image was displayed with the same window as the FDK-reconstructed `ground truth' image (Figure 37 left), indicating that the attenuation coefficients exist without the offset error.
49

Figure 3-10: Iterative reconstruction of the VOI using noiseless and scatter-less synthetic projections. The image shown is the result after 400 iterations. The regularization strength used was  = 0.005 and  = 0.996. The window was [0.0186, 0.0246] mm-1.

Figure 3-11 shows line profiles across the image along the dashed line in Figure 3-10 at the 100th, 200th, 300th, and 400th iteration.

Figure 3-11: Line profiles of the image across the dashed line in Figure 3-10 showing the progress of the iterative reconstruction at the 100th, 200th, 300th, and 400th iteration.

The cupping artifact appeared near the beginning of the reconstruction process and lingered up until at least the 400th iteration, although the magnitude of cupping was reduced as the number of iterations increased. It is possible that as the number of iterations approaches a large number, the cupping artifact will disappear.

50

3.7 Iterative Virtual Method
Since it was either difficult or impossible to remove the cupping artifact with the iterative algorithm from the previous section, the iterative virtual method was adopted for a more accurate and faster reconstruction. The ability of FDK with cosine extrapolation to reduce the truncation-induced cupping artifact was combined with the de-noising ability of TV regularization. Figure 3-12 shows a comparison between the non-VOI and VOI image (6 cm FOV), and a comparison between FDK with cosine extrapolation and IVM. The offset correction was not used. Here synthetic projections with noise, scatter, and blurring were used.

Figure 3-12: Left is the FDK-reconstructed image under a full FOV beam. Middle is the 6 cm FOV VOI image reconstructed with FDK and cosine extrapolation. Right is the VOI reconstructed with IVM after 25 iterations. The regularization strength used was  = 0.002 and  = 0.993. All images were displayed with a window width of 0.006 mm-1. Left has a window of [0.0159, 0.0219] mm-1, middle has a window of [0.0180, 0.0240] mm-1, and right has a window of [0.0180, 0.0240] mm-1.

The left image is the FDK-reconstruction of full FOV projections. This represents the image quality achievable if the phantom were scanned in reality with the Icon CBCT. The middle image is the FDK with cosine extrapolation reconstruction of VOI projections. The image on the right is the IVM reconstruction, which is essentially a continuation of the middle image but with de-noising. The de-noising is fast when compared to full iterative reconstruction from an image of 0, so a weaker regularization strength was used, and only 25 iterations were performed. All the images were shown with a window width of 0.006 mm-1. The FDK full FOV reconstruction had lower reconstructed attenuation coefficients (compared to Figure 3-7 left), which was expected since scatter reduces the image values. The
51

attenuation coefficients in the middle were also incorrect, but due to both cupping from scatter and the offset error from data truncation. The window for the image on the right is the same as the window for the middle image. This is because the errors were carried over to the virtual projections. It can be seen that the FDK VOI image has higher contrast and higher noise compared to the FDK full FOV image. There also appears to be a bit of cupping in the FDK VOI image, despite the use of cosine extrapolation. The difference between Figure 3-12 and Figure 3-7 was that scatter and noise was added. This cupping carried over to the IVM image, where much of the noise was removed while the contrast remained the same. It is arguably easier to delineate the tumor in the IVM image than the FDK images. Although the noise was removed, the tumor in the IVM image was not perfectly circular, as it was defined to be. This was a result of the noise structures being similar in intensity to the tumor in the FDK reconstructed image, and then being merged with the tumor during TV regularization. Table 3-1 lists the contrast and CNR of the tumor for the 3 different images.

Table 3-1: The contrast and CNR values of the tumor for the images shown in Figure 3-12.

Contrast (mm-1) CNR

Ground Truth 0.0026 -

FDK-Full FOV 0.0015 1.72

FDK-VOI 0.0021 1.90

IVM-VOI 0.0021 12.84

3.8 VOI Dose
The dose delivered to the patient because of image guidance was reduced due to the smaller beam in VOI imaging. The dose was calculated by Monte Carlo simulation of the virtual head phantom with the materials and densities listed in Table 2-1. Axial and sagittal views of the dose distributions for several different field sizes are shown in Figure 3-13. As discussed previously, the Icon beam begins by projecting the patient from a little below the left ear, and then rotates over the patient's face, and ends a little below the right ear. The beam itself is also slightly angled towards the anatomical superior direction. The dose absorbed by
52

the virtual head phantom ranged between 0 to 20 mGy, where the parts of the head far from the beam received 0 while the bone received around 20 mGy. It can be seen from the sagittal views that the dose mainly originates from the primary photons of the 90 kVp beam. Anything outside of the shape of the beam is dose originating from scatter photons, although there appears to be very little of it.

Figure 3-13: Monte Carlo calculated dose distributions for field sizes between 2 cm to 22 cm (full). Top 6 are axial views and bottom 6 are sagittal views.

53

The dose in a few regions of interest were plotted as a function of field size, shown in Figure 3-14.

Figure 3-14: The dose as a function of field size for a few regions of interest.

The frontal bone region was a region of the bone between the eyes and was chosen because it was irradiated, at least from the front, for all of the field sizes. The chosen region inside the VOI was always irradiated for all field sizes. The region in the hindbrain was irradiated during the full FOV scan but not irradiated for any other field size. Figure 3-15 shows the integral dose fraction, which was the average dose of a scan under a certain field size over the average dose of a scan using the full field. From Figures 3-14 and 3-15, information is available for the optimization of dose usage for VOI imaging.

54

Figure 3-15: The average dose to the patient under a certain field size over the average dose to the patient under the full field.

55

4

Discussion and Conclusions

4.1 Discussion
The synthetic projections used in this work were able to produce the effects of reduced SPR when smaller and smaller field sizes were used. This was strongly indicated in Figure 3-9 and was similar to Figure 7 in [34], though different system geometries and calculation methods were used. This allowed for the assessment of change in image contrast and noise as a function of field size, which were the main benefits of using a collimated beam. Although the synthetic projections were not at the same level of complexity as real data, it is expected that the results of using a collimator would be similar if the simulations were repeated in reality. Certain physical processes were difficult to simulate and were either omitted or approximated. For example the electron beam used in the simulation of the phase space was a parallel beam uniform in energy, although in reality that would have been a simplification of the electric field in a real x-ray tube. The response of the detector to photons involves a cascade of interactions. For example, x-ray photons that reach the detector undergo interactions that produce optical photons and the optical photons further convert to electric charges. These processes are stochastic in nature and would contribute to the noise in the final signal, but it has been assumed in this work that these additional noises were negligible compared to the x-ray photon noise. Using Eq. (2-18) to estimate the number of scatter photons per energy bin would also contribute to a small error in the noise of the projection. In reality, the point spread function would change depending on the position, angle of incidence, and energy of the photon. This

56

would be difficult to apply for the scatter photons since phase space information (position, direction, energy) would need to be saved, resulting in large disk space usage. It is expected that not modelling these processes and effects would produce only very minor errors in the synthetic projections, and would not affect large scale results such as contrast and the level of noise. The truncation-induced cupping artifact was difficult to remove completely using cosine extrapolation (see Figure 3-12). However, reconstruction with the IVM framework produced images (Figure 3-12 right) with less cupping than OS-SART and TV regularization alone (figure in A.4). It is possible that after a sufficient number of iterations, OS-SART and TV regularization would be able to reduce the cupping so that it is reduced to the same degree as in IVM, however this would take at least 6 times longer than IVM given the large number of iterations required (at least 400 iterations were performed in the case of Figure 3-11). There was an asymmetry in the cupping for both reconstruction algorithms; the cupping in the horizontal direction was worse than the cupping in the vertical direction. This may be due to a combination of effects: the asymmetric shape of the head phantom, the cosine extrapolation better approximating the projection of the phantom at some angles than others, and certain voxels being updated more than others due to the half scan protocol. Depending on the size and contrast of the structures within the VOI, the visibility of the structures may not be affected by the cupping artifact. For IVM, a 5 mm margin could be added around the VOI so that the cupping artifact would not interfere with the structures of interest. It was shown that cosine extrapolation removed the cupping artifact almost completely for projections without scatter and noise (Figure 3-7) but worked more poorly for projections with scatter and noise (Figure 3-12 right). Edge extrapolation remains a heuristic method that may not necessarily perform well for all different types of VOIs. For example, it was shown for 2D data that extrapolation with a constant was able to remove the cupping artifact almost completely [42], but that was not true for cone-beam data. OS-SART with TV regularization may be a more robust and appealing alternative if the computation times can be reduced.
57

The results in Section 3.5 quantified the image quality improvements achievable for a VOI positioned near the ventricles in the brain, reconstructed using FDK. The noise levels in the FDK reconstructed images depended on the reconstruction filter used. As mentioned before, the ramp filter was multiplied by a Hamming window, which reduces the noise and spatial resolution of an image when compared to the unmodified ramp filter. The same image quality metrics in Figure 3-8 (contrast, noise, and CNR) were calculated for the IVM reconstructed images, but were not shown and compared with Figure 3-8 in the main body. The comparison is shown in A.5. Total variation regularization is able to completely remove the noise in an image but also reduces the spatial resolution and the contrast. For the VOI images of the virtual head phantom, the noise was significantly removed while the contrast was only slightly reduced, resulting in high CNR values for all field sizes, e.g. a CNR of 12.84 as recorded in Table 3-1. The results suggested that CNR is a poor indicator for visibility for TV regularized images, with seemingly arbitrary behaviour for different field sizes. The absolute dose values reported in Section 3.8 were the raw Monte Carlo calculated dose values scaled to the correct number of projection angles and scaled by the factor  . The error in the dose is proportional to the error in the factor  . As mentioned previously, a PSF too broad would overestimate  , while a PSF too narrow would underestimate  . It was difficult to quantify the match between the NPS of the synthetic and real projection data so the error in  was difficult to estimate. However, the dose values can be reliably compared relative to each other for different field sizes. Parsons and Robar [34] investigated the image quality improvements from VOI while maintaining a constant dose to the VOI for different collimator sizes. A more aggressive approach would be to match the average dose of the VOI scan to the average dose of the full field scan. For example, by considering Figure 3-15 the mAs could be increased by a factor of 5 for the 6 cm FOV scan and the dose to the frontal bone would still be less than 25 mGy (from considering Figure 3-14). The contrast of the tumor used in this version of the virtual phantom was relatively high compared to the contrast of the soft tissues in the brain, (e.g. the
58

contrast between white and grey matter or the contrast between brain and cerebrospinal fluid) and does not fully demonstrate the utility of VOI imaging, since the tumor was still quite visible in the full FOV scan. The contrast of the tumor was 0.00257 mm-1 in the absence of scatter, and the noise for the average Icon CBCT scan was around 0.0009 mm-1 (seen in Figure 3-8), making the contrast of the tumor comfortably higher than the level of noise. Preliminary work has been done with a second virtual head phantom with a lower contrast object of 0.00019 mm-1. A first set of full FOV synthetic projections with scatter and noise was reconstructed with FDK and the object was not visible. A second set of full FOV synthetic projections without scatter but with noise was reconstructed with FDK and the object was not visible. A third set of full FOV synthetic projections with scatter but without noise was reconstructed with FDK and the object was visible (although at a lower contrast because of the scatter). These results were expected, since the image viewing window can be made arbitrarily narrow to resolve anything in the absence of noise. These three sets of projections were also reconstructed iteratively with OS-SART and TV minimization. In the first two sets, the noise was removed but the low contrast object itself was also removed. In the third set, the object survived the TV minimization in the absence of noise. These results suggest that for structures to survive the TV minimization, they have to be above a certain minimum CNR (the CNR of the FDK reconstructed image). This is supported by the following observations. Recall from Figure 3-8 that CNR increases as the field size decreases. In the contrast figure in A.5, after the regularization from IVM the contrast of the object decreased along with the noise. However, the drop in contrast was greater for the objects which initially had lower CNR after FDK reconstruction, and for the 4 cm and 6 cm field sizes where the CNR was higher than the others, the contrast barely dropped at all. This phenomenon may be explained by considering the usual progression of image reconstruction with OS-SART and TV minimization. OS-SART starts by reconstructing a blurry, low spatial resolution image and increases the spatial resolution after each iteration. TV minimization removes noise very quickly, then starts to slowly erode the edges of structures, until the structures sink into the
59

background completely. For structures above a minimum CNR, they survive the TV minimization by OS-SART increasing the spatial resolution faster than TV minimization can erode the edges.

4.2 Future Work
The results of the present simulation work indicate that VOI imaging improves image contrast. These results will be validated in the future with the acquisition of real projection data. Also, there are two aspects of this work that would benefit from additional investigation. The first is the ability of low contrast objects to survive the regularization process, and the second is the robust elimination of the truncation-induced cupping artifact. In general, any object can be visualized with confidence if the CNR is high enough (and there is minimal interference from artifacts). It is hypothesized that the minimum CNR to visualize an object in the FDK reconstruction regime is higher than the minimum CNR required for an object to survive the TV regularization in the iterative reconstruction regime. In the case that this is true, iterative reconstruction would be able to save imaging dose delivered to the patient while offering comparable levels of image quality. After determining the minimum CNR required for an object to survive the TV regularization, VOI imaging can be optimized to achieve that minimum CNR, either by increasing the contrast by using a smaller collimator, or by reducing the noise by increasing the mAs, which was afforded by the reduced dose from the collimated beam. This may or may not require the integral dose fraction of the VOI scan to be greater than 1, since at this point the minimum CNR required is unknown. It is likely that the minimum CNR required can change depending on the speed parameters controlling OS-SART and TV minimization,  ,  ,  ,  , and  . To assist in the survival of low contrast objects against the TV regularization, the definition of total variation was redefined in [65] to include a penalty for edges, i.e. parts of the image with large gradients, which was called edge-preserving total variation regularization. Adapting this method may be
60

beneficial to the goals of this work since it may assist in increasing the aforementioned minimum CNR required. The components of the IVM framework can easily be replaced by other algorithms that can improve the overall image quality. Statistical iterative reconstruction algorithms have been developed for the purpose of CBCT soft tissue visualization [66] [67] and may be worth considering as a replacement for OS-SART and TV, since TV would not be needed for truncated reconstruction in IVM. ATRACT may be a good replacement for FDK with cosine extrapolation in the IVM framework, since ATRACT can eliminate the truncation-induced cupping artifact [47]. DBP may also be a suitable replacement, although it requires that a sub-region be known prior to reconstruction. Prior information might be obtainable for the Icon CBCT, because in some treatment workflows, a full FOV CBCT is acquired for treatment planning. However, the scatter signal in the full FOV projections is different than the VOI projections, so the reconstructed attenuation coefficients would not be exactly the same. For VOI reconstruction with OS-SART and TV directly, if it is true that the cupping artifact can be eliminated as the number of iterations approaches infinity, then a deep convolutional neural network may be integrated into the algorithm to improve the rate of convergence. The objective would be for the network to learn what the non-truncated reconstructed image should look like (no cupping) when provided with a reconstruction of the VOI with cupping. Regardless of the algorithms used, the reconstructed images of an iterative algorithm with regularization should be compared fairly to analytically reconstructed images, since the noise is completely removed in the former. Studies in the literature [66] [67] have made fair CNR comparisons by matching the spatial resolution of the two types of images, which has yet to be included in this work. The spatial resolution of the iterative algorithms can be controlled by the regularization strength,  , and relaxation rate,  . The spatial resolution of analytical algorithms can be controlled by applying low-pass filters with different cut-off frequencies.

61

4.3 Conclusion
Progress has been made towards the objective of soft tissue visualization for image-guided gamma knife radiosurgery. Results indicate that collimation of the image-guidance beam on the Icon gamma knife to reduce the portion of the patient being irradiated can reduce scatter and improve the contrast of a reconstructed VOI. The IVM reconstruction framework has been adapted for truncated data reconstruction and noise suppression, producing promising VOI images that could be superior to results published in literature, once a fair comparison is completed. Soft tissue visualization through high quality VOI images can improve the accuracy of gamma knife radiosurgery, which currently relies on the bony anatomy to deduce the position of the tumor. This is particularly important for fractionated gamma knife treatments, where the dose is prescribed in fractions over several days, during which the tumor can change in shape, size, and position. Visualization of soft tissue and the tumor itself will improve confidence in the treatment and reduce the likelihood of misalignment of the tumor, thus reducing the risk of radiation to normal tissues. Contrast and noise of the VOI and dose delivered to the patient have been mapped as a function of field size, which provides a useful reference for future work. Preliminary work has begun on VOI reconstruction of a lower contrast virtual head phantom that will help realize the role of VOI imaging in radiation therapy.

62

Appendix
A.1 Trilinear Interpolation
Following the derivation in Section 2.5, the interpolated  (, , ) using trilinear interpolation is  (, , ) = (1 - )(1 - )(1 - )(, , ) + (1 - )(1 - )( + 1, , ) + (1 - )(1 - )(,  + 1, ) + (1 - )( + 1,  + 1, ) + (1 - )(1 - )(, ,  + 1) + (1 - )( + 1, ,  + 1) + (1 - )(,  + 1,  + 1) + ( + 1,  + 1,  + 1) Where   = ()   = ()   = ()  =  =  =  -    -    -  

A.2 Bilinear Interpolation
Following the derivation in Section 2.6, the interpolated  (, ) using trilinear interpolation is (, ) = (1 - )(1 - )(, ) + (1 - )( + 1, ) + (1 - )(,  + 1) + ( + 1,  + 1) Where   = ()   = ()  =  -  

63

 =

 -  

A.3 Cone-Beam Parker Weights
Following the discussion in Section 2.9 about the Parker weights. The Parker weights are shown here.  (, , )   sin2 (( ) ) 4  /2 -  = 1   +  -  sin2 (( ) ) 4  /2 +   0 <   < (   - 2  )  (   - 2  ) <   < ( - 2  )  ( - 2  ) <   < ( +    )

{ Where

  =

 1 +  2  2   

  = tan-1

  =  2 +  2  is the rotation angle of the source and detector.  is the azimuthal angle of the ray.

A.4 Interior Reconstruction
Reconstruction similar to Figure 3-10 was performed (OS-SART with TV regularization,  = 0.005 and  = 0.996, 400 iterations), except synthetic projections with scatter, noise, and blurring were used. The image window was [0.0170, 0.0230] mm-1. The image is visually similar to Figure 3-10.

64

A.5 IVM Image Quality
The following plots show the contrast, noise, and CNR comparison between FDK and IVM. It is the addition of IVM image quality to the plots in Figure 3-8. The regularization strength used was  = 0.002 and  = 0.993. 25 iterations were performed.

65

66

References

[1] "Position accuracy analysis of the stereotactic reference defined by the CBCT on Leksell Gamma Knife Icon," Elekta, 2015. [2] W. Li, Y.-B. Cho, S. Ansell, N. Laperriere, C. Menard, B.-A. Millar, G. Zadeh, P. Kongkham, M. Bernstein, D. A. Jaffray and C. Chung, "The use of cone beam computed tomography for image guided gamma knife stereotactic radiosurgery: Initial clinical evaluation," International Journal of Radiation Oncology Biology Physics, vol. 96, no. 1, pp. 214-220, 2016. [3] T. K. Jee, H. J. Seol, Y.-S. Im, D.-S. Kong, D.-H. Nam, K. Park, H. J. Shin and J.-I. Lee, "Fractionated gamma knife radiosurgery for benign perioptic tumors: Outcomes of 38 patients in a single institute," Brain Tumor Research and Treatment, vol. 2, no. 2, pp. 56-61, 2014. [4] K. Zhao, X. Liu, D. Liu, Y. Li, Z. Zhang, Y. Lin, Y. Zhang and D. Xu, "Fractionated gamma knife surgery for giant pituitary adenomas," Clinical Neurology and Neurosurgery, vol. 150, pp. 139-142, 2016. [5] I. AlDahlawi, D. Prasad and M. B. Podgorsak, "Evaluation of stability of stereotactic space defined by cone-beam CT for the Leksell Gamma Knife Icon," Journal of Applied Clinical Medical Physics, pp. 1-6, 2017. [6] Y. Lee, "What's all the fuss about GK?," Sunnybrook Health Sciences Centre, 2017. [7] M. Ruschin, P. T. Komljenovic, S. Ansell, C. Menard, G. Bootsma, Y.-B. Cho, C. Chung and D. Jaffray, "Cone beam computed tomography image guidance system for a dedicated intracranial radiosurgery treatment unit," International Journal of Radiation Oncology, vol. 85, no. 1, pp. 243-250, 2013. [8] L. Masi, F. Casamassima, C. Polli, C. Menichelli, I. Bonucci and C. Cavedon, "Cone beam CT image guidance for intracranial stereotactic treatments: comparison with a frame guided set-up," Int. J. Radiation Oncology Biol. Phys., vol. 71, no. 3, pp. 926933, 2008. [9] M. Guckenberger, K. Baier, I. Guenther, A. Richter, J. Wilbert, O. Sauer, D. Vordermark and M. Flentje, "Reliability of the bony anatomy in image-guided stereotactic radiotherapy of brain metastases," International Journal of Radiation Oncology Biology Physics, vol. 69, no. 1, pp. 294-301, 2007. [10] D. G. Kovacs, L. Rechner, A. K. Berthelsen and M. C. Aznar, "Dual Energy Cone Beam Computed Tomography for Image Guided Radiation Therapy," International Journal of Radiation Oncology, vol. 96, no. 2, p. E689, 2016.

67

[11] L. A. Feldkamp, L. C. Davis and K. J. W, "Practical cone-beam algorithm," Journal of the Optical Society of America A, vol. 1, no. 6, pp. 612-619, 1984. [12] E. Y. Sidky and X. Pan, "Image reconstruction in circular cone-beam computed tomography by constrained, total-variation minimization," Physics in Medicine and Biology, vol. 53, pp. 4777-4807, 2008. [13] A. K. Hara, R. G. Paden, A. C. Silva, J. L. Kujak, H. J. Lawder and W. Pavlicek, "Iterative Reconstruction Technique for Reducing Body Radiation Dose at CT: Feasibility Study," American Journal of Roentgenology, vol. 193, no. 3, pp. 764771, 2009. [14] J. H. Siewerdsen and D. A. Jaffray, "Cone-beam computed tomography with a flatpanel imager: Magnitude and effects of x-ray scatter," Medical Physics, vol. 28, no. 2, pp. 220-231, 2001. [15] E.-P. Ruhrnschopf and K. Klingenbeck, "A general framework and review of scatter correction methods in x-ray cone-beam computerized tomography. Part 1: Scatter compensation approaches," Medical Physics, vol. 38, no. 7, pp. 4296-4311, 2011. [16] K. Srinivasan, M. Mohammadi and J. Shepherd, "Applications of linac-mounted kilovoltage Cone-beam Computed Tomography in modern radiation therapy: A review," Polish Journal of Radiology, vol. 79, pp. 181-193, 2014. [17] "Design and performance characteristics of a Cone Beam CT system for Leksell Gamma Knife Icon," Elekta. [18] S. Schafer, J. W. Stayman, W. Zbijewski, C. Schmidgunst, G. Kleinszig and J. H. Siewerdsen, "Antiscatter grids in mobile C-arm cone-beam CT: Effect on image quality and dose," Medical Physics, vol. 39, no. 1, pp. 153-159, 2012. [19] S. S. Hsieh and N. J. Pelc, "The feasibility of a piecewise-linear dynamic bowtie filter," Medical Physics, vol. 40, no. 3, 2013. [20] S. S. Hsieh, D. Fleischmann and N. J. Pelc, "Dose reduction using a dynamic, piecewise-linear attenuator," Medical Physics, vol. 41, no. 2, 2014. [21] P. Watson, E. Mainegra-Hing, N. Tomic and J. Seuntjens, "Implementation of an efficient Monte Carlo calculation for CBCT scatter correction: phantom study," Journal of Applied Clinical Medical Physics, vol. 16, no. 4, 2015. [22] G. Jarry, S. A. Graham, D. J. Moseley, D. J. Jaffray, J. H. Siewerdsen and F. Verhaegen, "Characterization of scattered radiation in kV CBCT images using Monte Carlo simulations," Medical Physics, vol. 33, no. 11, pp. 4320-4329, 2006. [23] G. J. Bootsma, F. Verhaegen and D. A. Jaffray, "Spatial frequency spectrum of the x-ray scatter distribution in CBCT projections," Medical Physics, vol. 40, no. 11, 2013.

68

[24] G. J. Bootsma, F. Verhaegen and D. A. Jaffray, "Efficient scatter distribution estimation and correction in CBCT using concurrent Monte Carlo fitting," Medical Physics, vol. 42, no. 1, pp. 54-68, 2015. [25] K. Schorner, M. Goldammer and J. Stephan, "Comparison between beam-stop and beam-hole array scatter correction techniques for industrial x-ray cone-beam CT," Nuclear Instruments and Methods in Physics Research B, vol. 269, pp. 292-299, 2011. [26] J. H. Siewerdsen, M. J. Daly, B. Bakhtiar, D. J. Moseley, S. Richard, H. Keller and D. A. Jaffray, "A simple, direct method for x-ray scatter estimation and correction in digital radiography and cone-beam CT," Medical Physics, vol. 33, no. 1, pp. 187197, 2006. [27] L. Zhu, J. Wang and L. Xing, "Noise suppression in scatter correction for cone-beam CT," Medical Physics, vol. 36, no. 3, pp. 741-752, 2009. [28] R. Chityala, K. R. Hoffmann, D. R. Bednarek and S. Rudin, "Region of Interest (ROI) Computed Tomography," Proc SPIE Int Soc Opt Eng, vol. 5368, no. 2, pp. 534-541, 2004. [29] R. Chityala, K. R. Hoffmann, S. Rudin and D. R. Bednarek, "Region of interest (ROI) computed tomography (CT): Comparison with full field of view (FFOV) and truncated CT for a human head phantom," Proc SPIE Int Soc Opt Eng, vol. 5745, no. 1, pp. 583-590, 2005. [30] H. Yu, Y. Ye, S. Zhao and G. Wang, "Local ROI Reconstrucction via Generalized FBP and BPF Algorithms along More Flexible Curves," International Journal of Biomedical Imaging, vol. 2006, pp. 1-7, 2006. [31] C.-J. Lai, L. Chen, H. Zhang, X. Liu, Y. Zhong, Y. Shen, T. Han, S. Ge, Y. Yi, T. Wang, W. T. Yang, G. J. Whitman and C. C. Shaw, "Reduction in x-ray scatter and radiation dose for volume-of-interest (VOI) cone-beam breast CT-a phantom study," Physics in Medicine and Biology, vol. 54, no. 21, pp. 6691-6709, 2009. [32] D. Parsons, M. T. R. Stevens and J. L. Robar, "Current modulated volume-ofinterest imaging for kilovoltage intrafraction monitoring of the prostate," Medical Physics, vol. 44, no. 4, pp. 1479-1493, 2017. [33] L. Chen, C. C. Shaw, M. C. Altunbas, C.-J. Lai, X. Liu, T. Han, T. Wang, W. T. Yang and G. J. Whitman, "Feasibility of volume-of-interest (VOI) scanning technique in cone beam breast CT-a preliminary study," Medical Physics, vol. 35, no. 8, pp. 3482-3490, 2008. [34] D. Parsons and J. L. Robar, "An investigation of kV CBCT image quality and dose reduction for volume-of-interest imaging using dynamic collimation," Medical Physics, vol. 42, no. 9, pp. 5258-5269, 2015.

69

[35] D. Parsons and J. L. Robar, "Volume of interest CBCT and tube current modulation for image guidance using dynamic kV collimation," Medical Physics, vol. 43, no. 4, pp. 1808-1817, 2016. [36] A. C. Kak and M. Slaney, Principles of Computerized Tomogrpahic Imaging, IEEE Press, 1988. [37] J. L. Robar, D. Parsons, A. Berman and A. MacDonald, "Volume-of-interest conebeam CT using a 2.35 MV beam generated with a carbon target," Medical Physics, vol. 39, no. 7, pp. 4209-4218, 2012. [38] J. Hsieh, E. Chao, J. Thibault, B. Grekowicz, A. Horst, S. McOlash and T. J. Myers, "A novel reconstruction algorithm to extend the CT scan field-of-view," Medical Physics, vol. 31, no. 9, pp. 2385-2391, 2004. [39] K. J. Ruchala, G. H. Olivera, J. M. Kapatoes, P. J. Reckwerdt and T. R. Mackie, "Methods for improving limited field-of-view radiotherapy reconstructions using imperfect a priori images," Medical Physics, vol. 29, pp. 2590-2605, 2002. [40] F. Noo, R. Clackdoyle and J. D. Pack, "A two-step Hilbert transform method for 2D image reconstruction," Physics in Medicine and Biology, vol. 49, pp. 3903-3923, 2004. [41] Y. Zou and X. Pan, "Exact image reconstruction on PI-lines from minimum data in helical cone-beam CT," Physics in Medicine and Biology, vol. 49, pp. 941-959, 2004. [42] F. Arcadu, F. Marone and M. Stampanoni, "Fast iterative reconstruction of data in full interior tomography," Journal of Synchrotron Radiation, vol. 24, pp. 205-219, 2017. [43] L. Yu, Y. Zou, E. Y. Sidky, C. A. Pelizzari, P. Munro and X. Pan, "Region of interest reconstruction from truncated data in circular cone-beam CT," IEE Transactions on Medical Imaging, vol. 25, no. 7, pp. 869-881, 2006. [44] C. C. Shaw, Cone Beam Computed Tomography, Taylor and Francis Group, 2014. [45] Y. Ye, H. Yu, Y. Wei and G. Wang, "A general local reconstruction approach based on a truncated Hilbert transform," International Journal of Biomedical Imaging, vol. 2007, pp. 1-8, 2007. [46] G. Wang and H. Yu, "The meaning of interior tomography," Physics in Medicine and Biology, vol. 58, pp. R161-R186, 2013. [47] Y. Xia, H. Hofmann, F. Dennerlein, K. Mueller, C. Schwemmer, S. Bauer, G. Chintalapani, P. Chinnadurai and J. Hornegger, "Towards clinical application of a Laplace operator-based region of interest reconstruction algorithm in C-arm CT," IEEE Transactions on Medical Imaging, vol. 33, no. 3, pp. 593-606, 2014.

70

[48] J. Yang, H. Yu, M. Jiang and G. Wang, "High-order total variation minimization for interior tomography," Inverse Problems, vol. 26, 2010. [49] S. Hashemi, W. Y. Song, A. Sahgal, Y. Lee, C. Huynh, V. Grouza, H. Nordstrom, M. Eriksson, A. Dorenlot, J. M. Regis, J. G. Mainprize and M. Ruschin, "Simultaneous deblurring and iterative reconstruction of CBCT for image guided brain radiosurgery," Physics in Medicine and Biology, vol. 62, no. 7, 2017. [50] H. Yu and G. Wang, "A soft-threshold filtering approach for reconstruction from a limited number of projections," Physics in Medicine and Biology, vol. 55, pp. 39053916, 2010. [51] S. Kaczmarz, "Angenaherte auflosung von systemen linearer gleichungen," Bull. Acad. Pol. Sci. Lett. A, vol. 6, pp. 355-357, 1937. [52] H. Yu and G. Wang, "Compressed sensing based interior tomography," Physics in Medicine and Biology, vol. 54, pp. 2791-2805, 2009. [53] H. Yu, G. Wang, J. Hsieh, D. W. Entrikin, S. Ellis, B. Liu and J. J. Carr, "Compressive sensing-based interior tomography: Prelimininary clinical application," Journal of Computer Assisted Tomography, vol. 35, no. 6, pp. 762-764, 2011. [54] F. Arcadu, M. Nilchian, A. Studer, M. Stampanoni and F. Marone, "A forward regridding method with minimal oversampling for accurate and efficient iterative tomographic algorithms," IEEE Transactions on Image Processing, vol. 25, no. 3, pp. 1207-1218, 2016. [55] L. Ritschl, F. Bergner, C. Fleischmann and M. Kachelrieb, "Improved total variation-based CT image reconstruction applied to clinical data," Physics in Medicine and Biology, vol. 56, pp. 1545-1561, 2011. [56] ICRP, "Composition of BRAIN (ICRP)," [Online]. Available: https://physics.nist.gov/cgi-bin/Star/compos.pl?matno=123. [Accessed 21 10 2016]. [57] B. Alvarez, "AprendTech-Home," Aprend Technology, 31 7 2010. [Online]. Available: http://www.aprendtech.com/OverView.html. [Accessed 1 9 2016]. [58] J. H. Hubbell and S. M. Seltzer, "X-ray mass attenuation coefficients," NIST, 1996. [59] P. M. Joseph, "An improved algorithm for reprojecting rays through pixel images," IEEE Transactions on Medical Imaging, Vols. MI-1, no. 3, pp. 192-196, 1982. [60] J. Radon, "Uber die Bestimmung von Funktionene durch ihre Integralwerte langes bestimmter Mannigfaltigkeiten," Ber. Verb. Sachs. Akad. Wiss. Leipzig, Math.-Nat. Kl., vol. 69, pp. 265-277, 1917. [61] M. Kordel, A Physical X-Ray Scintillator Detector Model for CBCT Imaging Applications, Stockholm, 2014. 71

[62] D. L. Parker, "Optimal short scan convolution reconstruction for fanbeam CT," Medical Physics, vol. 9, no. 2, pp. 254-257, 1982. [63] D. Yang and R. Ning, "FDK Half-Scan with a Heuristic Weighting Scheme on a Flat Panel Detector-Based Cone Beam CT (FDKHSCW)," International Journal of Biomedical Imaging, vol. 2006, pp. 1-8, 2006. [64] G. Wang and M. Jiang, "Ordered-subset simultaneous algebraic reconstruction techniques (OS-SART)," Journal of X-Ray Science and Technology, 2003. [65] Z. Tian, X. Jia, K. Yuan, T. Pan and S. B. Jiang, "Low dose CT reconstruction via Edge-preserving Total Variation Regularization," Physics in Medicine and Biology, vol. 56, no. 18, pp. 5949-5967, 2011. [66] A. S. Wang, J. W. Stayman, Y. Otake, G. Kleinszig, S. Vogt, G. L. Gallia, A. J. Khanna and J. H. Siewerdsen, "Soft-tissue imaging with C-arm cone-beam CT using statistical reconstruction," Physics in Medicine and Biology, vol. 59, pp. 1005-1026, 2014. [67] H. Dang, J. W. Stayman, A. Sisniega, J. Xu, W. Zbijewski, X. Wang, D. H. Foos, N. Aygun, V. E. Koliatsos and J. H. Siewerdsen, "Statistical reconstruction for conebeam CT with a post-artifact-correction noise model: application to high-quality head imaging," Physics in Medicine and Biology, vol. 60, pp. 6153-6175, 2015.

72

