A SINGLE-PHASE DC-AC DUAL-ACTIVE-BRIDGE BASED RESONANT CONVERTER FOR GRID-CONNECTED PHOTOVOLTAIC APPLICATIONS

by

Marcos F´ elix Aguirre B.Eng.(Hons) in Electrical Engineering, University of Ontario Institute of Technology, Oshawa, Canada, June 2015

A thesis presented to Ryerson University in partial fulfillment of the requirements for the degree of Master of Applied Science in the program of Electrical and Computer Engineering.

Toronto, Ontario, Canada, 2018

© 2018 Marcos F´ elix Aguirre

Author's Declaration for Electronic Submission of a Thesis
I hereby declare that I am the sole author of this thesis. This is a true copy of the thesis, including any required final revisions, as accepted by my examiners. I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research. I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research. I understand that my thesis may be made electronically available to the public.

ii

Abstract
A SINGLE-PHASE DC-AC DUAL-ACTIVE-BRIDGE BASED RESONANT CONVERTER FOR GRID-CONNECTED PHOTOVOLTAIC APPLICATIONS Marcos F´ elix Aguirre Master of Applied Science Electrical and Computer Engineering Ryerson University, Toronto, Canada, 2018

In the wake of the global energy crisis, the integration of renewable energy resources, energy storage devices, and electric vehicles into the electric grid has been of great interest towards replacing conventional, fossil-fuel-dependent energy resources. This thesis presents the circuit topology and a control strategy for a 250-W single-phase gridconnected dc-ac converter for photovoltaic (PV) solar applications. The converter is based on the dual active bridge (DAB) kernel employing a series-resonant link and a high-frequency isolation stage. For interfacing the 60-Hz ac grid with the 78-kHz resonant circuit, the converter utilizes a four-quadrant switch array that functions as an ac-ac stage. Therefore, a bipolar low-frequency voltage source, that is the grid voltage, is used to synthesize a symmetrical high-frequency voltage pulse-train for the resonant circuit. Thus, soft switching and the use of a compact ferrite-core transformer have been possible. Then, a fast current-control loop ensures that the converter injects a sinusoidal current in phase with the grid voltage, while a relatively slower feedback loop regulates the converter dc-side voltage, that is, the PV array voltage, at a desired value. To simulate the converter and to design the controllers, the thesis also presents nonlinear large-signal and linearized small-signal state-space averaged models. The performance of the converter is assessed through simulation studies conducted using the aforementioned averaged models, a detailed topological model in the PLECS software environment, and a prototype.

Keywords: Photovoltaic, PV, Microinverter, Dual Active Bridge, Phase-shift Modulation, High Frequency Transformer. iii

Acknowledgments
I would like to express my gratitude to Dr. Amirnaser Yazdani for his excellent supervision throughout the course of this research project. He has shared knowledge, passion, dedication and friendship. I also wish thank my parents, Enrique and Vilma, and Emily for all the support they have given me during the course of the years. Finally, would like to thank my grandfather Manuel. His tenacity and determination are my role models.

iv

Contents
Author's Declaration Abstract Acknowledgments List of Figures List of Tables List of Appendices Convention for Notations Nomenclature List of Abbreviations 1 Introduction 1.1 1.2 Background and Motivation . . . . . . . . . . . . . . . . . . . . . . . . . 1.1.1 1.2.1 1.2.2 1.2.3 1.3 1.3.1 1.3.2 1.3.3 1.4 1.5 Development of PV Solar Systems . . . . . . . . . . . . . . . . . . Central Inverters . . . . . . . . . . . . . . . . . . . . . . . . . . . String Inverters . . . . . . . . . . . . . . . . . . . . . . . . . . . . Micro-Inverters . . . . . . . . . . . . . . . . . . . . . . . . . . . . Four-quadrant Switch Full-bridge Converter . . . . . . . . . . . . Half-wave Cycloconverter . . . . . . . . . . . . . . . . . . . . . . High Efficiency Half-wave Cycloconverter . . . . . . . . . . . . . . PV Integration Methods . . . . . . . . . . . . . . . . . . . . . . . . . . . ii iii iv viii xi xii xiii xiv xv 1 2 2 5 6 7 9 10 11 12 13 15 16

Micro-Inverters State of the Art . . . . . . . . . . . . . . . . . . . . . . .

Thesis Objectives and Scope . . . . . . . . . . . . . . . . . . . . . . . . . Literature Review Pertinent to Thesis Objective . . . . . . . . . . . . . . v

1.5.1 1.5.2 1.5.3 1.6

Dual Active Bridge Converter . . . . . . . . . . . . . . . . . . . . Single Phase-Shift Modulation . . . . . . . . . . . . . . . . . . . . Dual Phase-Shift Modulation . . . . . . . . . . . . . . . . . . . .

16 18 22 27 28 30 32 35 36 39 42 43 45 48 50 52 53 53 55 58 58 59 60 61 61 64 64 68 74 79 84 85 85

Thesis Outline . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

2 Mathematical Model 2.1 Large-Signal Model of Converter . . . . . . . . . . . . . . . . . . . . . . . 2.1.1 2.1.2 2.1.3 2.2 2.3 Analysis of Resonant Tank . . . . . . . . . . . . . . . . . . . . . . Analysis of Converter Input Power Balance . . . . . . . . . . . . . Analysis of Converter Output Power Balance . . . . . . . . . . . .

Steady-State and Small-Signal Models . . . . . . . . . . . . . . . . . . . Summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

3 Control Scheme and Compensator Design 3.1 3.2 3.3 3.4 dc-link Voltage Control Design . . . . . . . . . . . . . . . . . . . . . . . . Transfer Function Development . . . . . . . . . . . . . . . . . . . . . . . Control to Output Current Transfer Function . . . . . . . . . . . . . . . Current Compensator Design . . . . . . . . . . . . . . . . . . . . . . . . 3.4.1 3.4.2 3.4.3 Transfer Function . . . . . . . . . . . . . . . . . . . . . . . . . . . Frequency Response . . . . . . . . . . . . . . . . . . . . . . . . . Open- and Closed-Loop Analysis . . . . . . . . . . . . . . . . . . Bandwidth, Gain Margin and Phase Margin . . . . . . . . . . . . Step Response . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3.5 Summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

4 Converter Model and Control Strategy Verification 4.1 Mathematical Model Verification . . . . . . . . . . . . . . . . . . . . . . 4.1.1 4.1.2 Steady-State Model Verification . . . . . . . . . . . . . . . . . . . Small-Signal and Large-Signal Model Verification . . . . . . . . . Case 1: dc Side Fed by a Current Source . . . . . . . . . . . . . . Case 2: dc Side Loaded by a Resistor . . . . . . . . . . . . . . . . 4.2 4.3 4.4 Control Strategy Verification . . . . . . . . . . . . . . . . . . . . . . . . . Converter Characterization . . . . . . . . . . . . . . . . . . . . . . . . . . Summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

5 Conclusions and Future Work 5.1 Conclusions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . vi

5.2

Future Work . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

86

A Fundamental Frequency Fourier Coefficient of a Three-level Square Waveform B Elements of State-Space Matrices C Mathematical Model Extension for DPS Modulation D Mathematical Model Extension for Converter Rectifier Operation with Resistive Load under SPS Modulation E MATLAB Scripts for Mathemathical Model Bibliography

87 89 93

99 101 108

vii

List of Figures
1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 Evolution of global annual solar PV installed capacity [1]. . . . . . . . . . Evolution of global total solar PV installed capacity [1]. . . . . . . . . . . Global PV power cumulative capacity scenarios until 2020 [2]. . . . . . . Scenarios for global solar PV rooftop and utility-scale segment development [1]. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Cumulative installed PV capacity in Canada [3]. . . . . . . . . . . . . . . Typical centralized PV generator integration using a central inverter. . . Typical centralized PV generator integration using string inverter. . . . . Typical rooftop PV generator integration using a string inverter and dc optimizers. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Typical rooftop PV generator integration using micro-inverter. . . . . . . 2 3 3 4 5 6 7 8 9 10 10 11 12 13 14 16 17 18 20 21 22 22 23 24

1.10 Typical multi-stage dc-ac conversion using a high frequency link. . . . . . 1.11 Typical single-stage dc-ac conversion using a high frequency link. . . . . 1.12 Circuit diagram of the dc-dc isolated and series resonant DAB converter. 1.13 DAB based dc-ac converter topology using four-quadrant switches presented in [4], [5] and [6]. . . . . . . . . . . . . . . . . . . . . . . . . . . . 1.14 DAB based dc-ac converter topology using a half-wave cycloconverter presented in [7] . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1.15 DAB based dc-ac converter using the high efficiency half-wave cycloconverter presented in [8­10]. . . . . . . . . . . . . . . . . . . . . . . . . . . 1.16 dc-dc DAB converter topology. . . . . . . . . . . . . . . . . . . . . . . . . 1.17 DAB converter simplified circuit. . . . . . . . . . . . . . . . . . . . . . . 1.18 Gating pulse sequence for SPS modulation. . . . . . . . . . . . . . . . . . 1.19 Nomogram of output voltage versus output current using SPS [11]. . . . 1.20 SPS modulation at ZVS soft-switching operation where nv1 > v2 . . . . . 1.21 SPS modulation at ZVS soft-switching operation where nv1 < v2 . . . . . 1.22 SPS modulation at hard-switching operation where nv1 > v2 . . . . . . . . 1.23 SPS modulation at hard-switching operation where nv1 < v2 . . . . . . . . 1.24 Gating pulse sequence for DPS modulation. . . . . . . . . . . . . . . . . viii

1.25 Nomogram of output voltage versus output current usign DPS modulation [12]. Section A shows the soft-switching operation under SPS modulation. Section B shows the extended soft-switching region operating under DPS modulation. Operation in the remaining sections exhibit hard-switching commutation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1.26 DPS modulation at ZVS soft-switching operation where nv1 > v2 . . . . . 1.27 DPS modulation at ZVS soft-switching operation where nv1 < v2 . . . . . 2.1 2.2 2.3 2.4 3.1 3.2 3.3 3.4 3.5 3.6 3.7 3.8 3.9 dc-ac DAB based converter topology. . . . . . . . . . . . . . . . . . . . . Simplified equivalent circuit of the dc-ac DAB converter under SPS modulation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Circuit diagram for power flow analysis. . . . . . . . . . . . . . . . . . . Simplified circuit for power flow analysis. . . . . . . . . . . . . . . . . . . Proposed converter control strategy concept. . . . . . . . . . . . . . . . . dc-link voltage control design. . . . . . . . . . . . . . . . . . . . . . . . . Detailed proposed converter control strategy. . . . . . . . . . . . . . . . . Bode plot for Gig (s). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Bode plot for Gig (s). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Current control feedback loop block diagram. Bode plot for Ki (s). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

25 26 26 31 32 35 36 44 46 47 50 51 52 54 55 56 57 58 61 63 65 66 67 68 69 71 71

Frequency response for Li (s). . . . . . . . . . . . . . . . . . . . . . . . . Frequency response for Ti (s).

3.10 Nyquist diagram for Ti (s). . . . . . . . . . . . . . . . . . . . . . . . . . . 3.11 Step for Ti (s). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4.1 4.2 4.3 4.4 4.5 4.6 4.7 4.8 4.9 Converter with dc side fed by a current source. . . . . . . . . . . . . . . . Steady-state model verification. Waveforms for vpv , ig , vr and rr . . . . . . Small-signal and large-signal model case 1 verification method. . . . . . . Case 1 Small- and large- signal model verification. Waveforms of vpv , ig , vr and rr for a phase-shift step change of 10%. . . . . . . . . . . . . . . . Case 1 PLECS switched, small- and large- signal model verification. Waveforms of vpv , ig , vr and rr for a phase-shift step change of 10%. . . . . . . Large-Signal Model Verification Open Loop Test. . . . . . . . . . . . . . Large-Signal Model Experimental Verification Method. . . . . . . . . . . Converter Prototype Disassembled. . . . . . . . . . . . . . . . . . . . . . Converter Prototype Assembled. . . . . . . . . . . . . . . . . . . . . . . . ix

4.10 Case 2 Small- and large- signal model verification. Waveforms of vpv , ig , vr and rr for a phase-shift step change of 5%. . . . . . . . . . . . . . . . 4.11 Oscilloscope capture of vpv and ig for a phase-shift step change of 5%. . . 4.12 Oscilloscope capture of vr and ir for a phase-shift step change of 5%. . . 4.13 Closed loop test. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4.14 Control strategy verification. Closed-loop waveforms for vpv , ig , vr and rr . 4.15 Control strategy verification. Closed-loop waveforms for vpv , ig , vr and rr zoomed at t = 0.5s. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4.16 Open loop converter characterization. . . . . . . . . . . . . . . . . . . . . 4.17 Power analyzer screenshot for converter characterization at vpv = 20.5V and vg = 150V . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4.18 Efficiency and output power versus PV voltage when vg = 120V. . . . . . 4.19 Efficiency and output power versus PV voltage when vg = 135V. . . . . . 4.20 Efficiency and output power versus PV voltage when vg = 150V. . . . . .

72 73 73 74 77 78 79 80 81 82 83

x

List of Tables
3.1 3.2 4.1 4.2 4.3 4.4 4.5 Electrical Characteristics for CanadianSolar CS6P-265 PV Panel [13] . . Simulation converter parameters . . . . . . . . . . . . . . . . . . . . . . . Steady-state Model Verification Test Parameters Case 1 test parameters . . . . . . . . . . . . . . Case 2 test parameters . . . . . . . . . . . . . . Experimental Converter Parameters . . . . . . . Control strategy test parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 48 49 61 64 68 70 75

xi

List of Appendices
Appendix A: Fundamental Fourier Coefficient of a Three-level Square Waveform . 87 Appendix B: Elements of State-Space Matrices . . . . . . . . . . . . . . . . . . . 89 Appendix C: Mathematical Model Extension for DPS Modulation . . . . . . . . . 93 Appendix D: Mathematical Model Extension for Converter Rectifier Operation with Resistive Load under SPS Modulation . . . . . . . . . . . . . . . . . . . . 99 Appendix E: MATLAB Scripts for Mathematical Model . . . . . . . . . . . . . . 101

xii

Convention for Notations
For clarity and consistency, the following is used in this thesis.
 Circuit parameters are denoted by upper-case letters, for example, C , Lr .  Instantaneous voltages and currents, and variables and signals are denoted by lower-

case letters, for example, i, vpv , vr , etc.
 Real and Reactive powers are denoted by upper-case letters, for example, Ppv , Pin ,

Qin , Pg , Qg , etc.
 Converter gating pulses are denoted by the upper-case letter G, for example, G1 ,

G2H , G2L , etc.
 Subscript in denotes a converter input terminal variable.  Subscript out denotes a converter output terminal variable.  Subscript r denotes a converter resonant variable.  Subscript g denotes a grid-side variable.

xiii

Nomenclature
vpv vr vout vg ipv ir iin iout ig Ppv Pin Pout Pg R Lout Cout Cpv  Ki (s) Kv ( s) Gig (s) Gvpv (s) Gvpv ig (s) RDS (on) PV generator terminal voltage Resonant capacitor voltage Output voltage of the converter ac-grid voltage PV generator output current Resonant inductor current Converter input current Converter output current ac-grid current PV generator active power Converter input active power Converter output active power active power delivered to the ac-grid Equivalent series resistance Output filter inductance Output filter capacitance PV generator terminal (input) capacitor Phase-shift angle between input and output bridge Transfer function of the current compensator Transfer function of the voltage compensator Converter phase-shift to grid current transfer function Converter phase-shift to PV generator voltage transfer function Converter PV generator voltage to grid current transfer function MOSFET Drain-Source on Resistance

xiv

List of Abbreviations
ANSI APAC CG DAB DG DPS EPIA FPGA HF IC IEA IEEE LV MEA MOSFET MPP MPPT MV P&O PFC PI PLECS PLL PV PVPS PWM RoW SPS ZCS ZVS American National Standards Institute Asia-Pacific Centralized Generation Dual Active Bridge Distributed Generation Dual Phase-Shift European Photovoltaic Industry Association Field-Programmable Gate Array High Frequency Incremental Conductance International Energy Agency Institute of Electrical & Electronics Engineers Low Voltage Middle East and Africa Metal Oxide Field Effect Transistor Maximum Power Point Maximum Power Point Tracking Medium Voltage Perturb and Observe Power Factor Correction Proportional-Integral Piecewise Linear Electrical Circuit Simulation Phase-locked Loop Photovoltaic Photovoltaic Power Systems Programme Pulse-Width Modulation Rest of World Single Phase-Shift Zero Current Switching Zero Voltage Switching

xv

Chapter 1 Introduction
In the wake of a global energy crisis, the integration of renewable energy resources, energy storage devices and electric vehicles into the electric grid, has been of great interest to replace conventional, fuel-dependent resources. Thus, the demand, generation and integration of distributed PV systems has increased in many countries around the world [1­3]. Due to the dc nature of this technology, much research has been conducted in the field of power electronics and dc-ac converters to overcome the associated technical issues and perform such integration with minimum power losses [14]. This chapter presents an overview of the development of PV solar systems around the world and different PV integration methods.

1

Chapter 1. Introduction

1.1
1.1.1

Background and Motivation
Development of PV Solar Systems

According to the Photovoltaic Power Systems Programme (PVPS) of the International Energy Agency (IEA) and the SolarPower Europe's Global Market Outlook for Solar Power 2017 annual reports, over 76 GW of additional grid-connected PV solar capacity have been installed worldwide in 2016 [1, 2]. This figure represents an increase of about 50% compared to the 51 GW installed in 2015 and a 90% increased to the 40 GW installed in 2014. Figure 1.1 and Figure 1.2 show the global annual and total solar PV installed capacity respectively.

Figure 1.1: Evolution of global annual solar PV installed capacity [1].

While conservative predictions indicate that the world PV capacity will double in the next several years for a total of 623 GW other, more favourable forecasts predict that the world PV capacity will triple reaching 935 GW in 2021 [2]. Figure 1.3 shows an annual prediction for the cumulative grid-connected PV solar system's installed capacity until 2021. Grid-connected PV solar systems can be group into two categories: Distributed Generation (DG) and Centralized Generation (CG). PV Distributed Generation systems are often small generation units located near the load such as residential, commercial or in2

1.1. Background and Motivation

Figure 1.2: Evolution of global total solar PV installed capacity [1].

Figure 1.3: Global PV power cumulative capacity scenarios until 2020 [2].

3

Chapter 1. Introduction dustrial rooftops. The advantages of these types of generation units, is a reduced capital investment. Furthermore, the power losses related to transmission are reduced due to the proximity between the generation and load units. The main disadvantage of this type of generation is that bidirectional power flow can occur at the bus-feeder level due to the intermittent nature of PV sources, making DG units more difficult to control. PV Centralized Generation or utility-scale systems are large generation units that are frequently located far away from the loads in places where sun irradiation is maximized. These types of generation units require large capital investments compared to DG, and may require the construction of new transmission lines to deliver the power from the station to the loads. Therefore, transmission losses are increased when compared to DG units. The main advantage of CG units is that the power flow is unidirectional and the power control can be achieved with relative ease. Nonetheless, both types of PV generation strategies are being installed. Figure 1.4 show possible growth scenarios for global solar PV rooftop and utility scale units until 2021. In Canada, over 2600 M W of PV generation have been installed up until 2016 [3]. Since the launch of the Feed-in-Tarif (FIT) and microFIR program in Ontario in 2009, rooftop photovoltaic (PV) solar energy has become an important and growing market [15]. Figure 1.5 shows the cumulative total and distributed PV Capacity in Canada.

Figure 1.4: Scenarios for global solar PV rooftop and utility-scale segment development [1].

4

1.2. PV Integration Methods Total 2,500 2,000 MW 1,500 1,000 500 0 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 Distributed

Figure 1.5: Cumulative installed PV capacity in Canada [3].

1.2

PV Integration Methods

PV generation systems are commonly integrated to the medium-voltage (MV) and lowvoltage (LV) distribution lines via power electronic converters. While utility-scale PV systems are generally connected to MV lines via a central inverter or multiple string inverters, lower power rooftop systems are connected to the LV or MV depending on the specific application. For rooftop industrial and commercial systems, string inverters are frequently employed to interface the PV generation at the MV distribution level. In rooftop residential applications, micro-inverters or string inverters are used to interconnect the PV generation at the LV distribution level. In the following sections, the principal characteristics of central inverters, string inverters and micro-inverters will be described.

5

Chapter 1. Introduction

1.2.1

Central Inverters

In some PV systems where large voltage and power levels are required, individual PV panels can be connected in series to form a string. To further increase power and reach utility-scale levels, multiple PV strings are connected together to form PV arrays. To integrate such PV arrays into the grid, high-power central inverters can be used. Since central inverters can perform Maximum Point Power Tracking (MPPT) at only one connection point, the use of central inverters is recommended when temperature, solar irradiation, and orientation are consistent across the whole array. Figure 1.6 shows the integration of a large PV system using a central inverter. Comparatively with other type of inverters, central inverters are usually the most economical option in terms of price per output watt, but they require higher installation cost and have a larger footprint. Furthermore, this type of solution is not recommended for systems with different PV cell angles and, or orientations.

Figure 1.6: Typical centralized PV generator integration using a central inverter.

6

1.2. PV Integration Methods

1.2.2

String Inverters

For utility-scale projects multiple string inverters can be used to replace a central inverter and offer a modular solution. This approach can provide a better performance when the PV string's arrangement have different inclination angles, orientation and, or when partial shading effects occur. This is due to string inverter's capabilities to operate at MPPT condition for each individual string, rather than operating at the global MPPT of the PV array. Moreover, in case of inverter failure, only a smaller portion of the power generation is compromised, and since no fans are required to cool the inverter, maintenance costs are reduced compared to central inverters. On the contrary, an increased number of inverter connections are necessary. Figure 1.7 shows a typical integration of a utility-scale PV system using string inverters.

Figure 1.7: Typical centralized PV generator integration using string inverter.

In addition, string inverters are commonly found in smaller PV systems such as rooftop applications, where one or few inverters are required. This configuration provides a centralized approach for such integration, where all the PV panels are grouped into one or few strings. This solution provides the most economical option in terms of price per output watt, but string inverters for rooftop applications are particularly propense to partial shading effects of nearby trees and buildings. To avoid such reduction of output power, additional dc-dc converters, also called "dc optimizers", are installed underneath each PV panel to achieve MPPT operation. This in turn increases the overall cost of the system. Another aspect of the string inverter approach is that if there is an inverter failure the whole system fails. Figure 1.8 shows a typical integration of a rooftop PV 7

Chapter 1. Introduction system using a string inverter and multiple dc optimizers.

Figure 1.8: Typical rooftop PV generator integration using a string inverter and dc optimizers.

8

1.2. PV Integration Methods

1.2.3

Micro-Inverters

Micro-inverters are popular in rooftops' PV systems where the PV panels are located facing different directions, or where there is a high chance of partial shading such as densely urban residential or commercial applications. Micro-inverters are installed underneath each PV panel, where both dc-ac conversion and MPPT operation is achieved at each panel. This solution is the most expensive in terms of price per output watt, but it maximizes the overall output power of the system. In addition, the micro-inverter approach provides the most modular and reliable solution, where in case of failure, only the affected module shuts down, without compromising the energy production of nearby PV panels. Depending on the application, or as mandated by local grid codes, rooftop PV systems may be required to be interfaced via an isolation transformer. Therefore, to promote its adoption and reduce installation costs, many micro-inverters offer built-in galvanic isolation [16, 17]. In recent years, there have been many technological improvements in the area of low-power dc-ac converters, offering higher efficiencies and reduced power losses [4­10, 14, 18­20, 20­30].

Figure 1.9: Typical rooftop PV generator integration using micro-inverter.

9

Chapter 1. Introduction

1.3

Micro-Inverters State of the Art

Photovoltaic interconection requirements have traditionally been addressed by two-stage converter topologies [14, 18­20]. However, single-stage converter topologies are preferred as they typically offer higher efficiencies than their multi-stage counterparts due to reduced component count. A number of single-stage converters using high frequency (HF) links, have been proposed in the literature for low-power (50-400 W) PV applications [6­10, 20­22, 24­30]. Figure 1.10 and 1.11 show the block diagrams of typical multi-stage and single-stage dc-ac conversion units using high frequency links. A considerable fraction of such single-stage converters is based on the dual active bridge (DAB) dc-dc converter topology [31]. The isolated DAB converter is a topology where two active bridges are connected via a HF link. This converter offers soft switching operation, albiet not over its entire output power range [11]. To extend the power range over which soft switching exists and to grant dc-ac conversion functionalitiy to the DAB converter topology, different methods have been proposed in the literature [4­10, 23­29]. Figure 1.12 shows the circuit diagram of the series resonant dc-dc isolated DAB converter.

Figure 1.10: Typical multi-stage dc-ac conversion using a high frequency link.

Figure 1.11: Typical single-stage dc-ac conversion using a high frequency link.

10

1.3. Micro-Inverters State of the Art

Figure 1.12: Circuit diagram of the dc-dc isolated and series resonant DAB converter.

1.3.1

Four-quadrant Switch Full-bridge Converter

The DAB based dc-ac converter topology presented in [4], [5] and [23], utilizes a fourquadrant full-bridge converter at the output side providing integration to the host acgrid. The four-quadrant switch realization is achieved by connecting two back-to-back semiconductor switches. While in [4] a Space Vector Modulation is proposed and an statespace mathematical model, soft-switched ZVS/ZCS commutations are obtained only at some operating conditions. To further increase efficiency by achieving soft-switching conditions over a larger operating range, a new modulation is proposed in [23]. The phase-shift modulation proposed in this paper employs a Dual Phase-Shift (DPS). The first control phase-shift,  , is between the switching legs of the input bridge to produce a three-levelled squared waveform. This control angle follows the amplitude variations of the grid voltage to increase the soft-switching range of the converter. The second phase-shift, , is relative to the input and output bridges and used to control the power transfer. Furthermore, simple largeand small-signal mathematical models are derived along with a digital control scheme. Finally, a 200 W prototype was built to verify the proposed modulation and digital control. The efficiency achieved during the soft-switching region was  85 %. In [6] the DPS modulation was used, and a resonant tank connected in series between the active bridges was discussed to increase the power transfer capabilities of the converter by decreasing the overall reactance of the circuit. While a steady-state model is derived, it does not include the effects of the  phase-shift on the power transfer controlled by the  phase shift. In addition, no large- or small-signal models are developed, therefore no control strategy is presented. Moreover, while only open-loop simulation results are shown, no closed-loop simulation or experimental verification were conducted. Figure 1.13 shows the circuit diagram for the four-quadrant converter topology presented 11

Chapter 1. Introduction in [6] with the addition of an output filter composed by Cout and Lout

Figure 1.13: DAB based dc-ac converter topology using four-quadrant switches presented in [4], [5] and [6].

1.3.2

Half-wave Cycloconverter

The DAB based dc-ac converter topology presented in [27], discuses the substitution of the output bridge by a half-wave cycloconverter that integrates the converter with the acgrid. This paper proposed a Single Phase-Shift (SPS) modulation between the input and output bridges with one control angle  that regulates the power transfer. Furthermore, a instantaneous power control is proposed, but no in-depth mathematical model is derived. While the discussed modulation and control are verified through simulations and a 210 W prototype, the soft-switching range is narrower than in the modulation proposed in [23]. The half-wave cycloconverter discused in [27] was proposed earlier in [7, 24­26]. In [7, 24­26], the modulation used to operate the converter is the same DPS modulation as proposed in [23], mentioned in Section 1.3.1 and further described in Section 1.5.3. Such modulation has the benefit of an increased soft-switching operating region in comparison to the SPS modulation used in [27]. Similarly to [6], a series connected resonant tank is added to further increase the overall converter efficiency. While steady-state power flow analysis is presented in this paper, no large- or small-signal models are developed. The proposed converter control strategy requires both a phase-locked loop (PLL) and a look-up table, which results in a difficult implementation. In this paper, the proposed control scheme is validated through simulations and experimental results using a 100 W prototype. Figure 1.14 shows the circuit diagram for the half-wave cycloconverter 12

1.3. Micro-Inverters State of the Art topology presented in [7, 24­26].

Figure 1.14: DAB based dc-ac converter topology using a half-wave cycloconverter presented in [7]

1.3.3

High Efficiency Half-wave Cycloconverter

The DAB based dc-ac PV converter topology proposed in [8,10] employs a novel half-wave cycloconverter to integrate the converter with the ac-grid. While the equivalent conduction resistance of the proposed cycloconverter is 1.5RDS (on) , the converter topologies are described in Sections 1.3.1 and 1.3.2 are 4RDS (on) and 2RDS (on) respectively. Therefore, this novel cycloconverter topology is cabaple of achieving higher efficiency levels. This paper employs a DPS modulation where two phase-shifts are used to operate the converters under a wide soft-switching range. The first control phase-shift,  ,is between the switching legs of the input bridge to produce a three-levelled squared waveform following the amplitude variations of the grid voltage and increases the soft-switching range. The second phase-shift, , is relative to the input and output bridges and used to control the power transfer. As opposed to the modulation schemes analyzed so far, the switching frequency is not fixed. Therefore, it can also be varied to change the impedance of the resonant tank and control the power transfer. Even though a mathematical model has been derived, the proposed control strategy to minimized power losses is computationally intensive and requires an FPGA. Furthermore, while open-loop dc-dc experimental results were conducted, no dc-ac or closed-loop experimental verification was performed. In [28], the work presented in [8­10] is further developed. In this paper, a series-connected energy buffer using a smaller capacitor is proposed to replace large electrolytic input 13

Chapter 1. Introduction capacitors. Similar to [8­10], a mathematical model has been derived, but the proposed control methodology to minimized power losses is computationally intensive.

Figure 1.15: DAB based dc-ac converter using the high efficiency half-wave cycloconverter presented in [8­10].

14

1.4. Thesis Objectives and Scope

1.4

Thesis Objectives and Scope

As it can be observed from the literature review conducted in Section 1.3, most of the DAB based dc-ac converters employ similar phase-shift modulations techniques to control power transfer. While some authors utilize a single phase-shift (SPS) modulation with a unique variable to control the power transfer, others implement a dual phase-shift (DPS) modulation with two variables to control power transfer and widen the soft-switching operating region of the converter. Due to the challenge of developing mathematical models for resonant converter topologies, many of the models derived in the literature only consider the steady-state conditions of the system thus, neglecting the dynamics. While many of these models are largely incomplete, other authors opt to approach this challenge with a different perspective. Such new approaches to simplify the analytical models, have lead to the execution of computational demanding algorithms when controlling the converter and cannot be implemented using traditional control strategies. This thesis is focused on the development of detailed analytical models to unify the mathematical analysis of series-resonant DAB based converters, using either SPS, or DPS modulation techniques. For such task, non-linear and linear state-space scalable models will be developed based on the four-quadrant switch full-bridge dc-ac DAB based converter described in Section 1.3.1. Moreover, this thesis attempts to develop a design procedure of such converters for PV applications and a control scheme strategy that can be implemented with ease using traditional control strategies. The specific objectives of this thesis are described below:
 To derive accurate steady-state, large- and small-signals state-space models consid-

ering the RDS (on) of the switches.
 To develop a methodology for the converter design and dimensioning of the com-

ponents.
 To developed an effective control strategy that can be implemented using traditional

analogue and digital control approaches.
 To validate the accuracy and effectiveness of the mathematical and the proposed

control strategy using simulation models and experimental results.

15

Chapter 1. Introduction

1.5
1.5.1

Literature Review Pertinent to Thesis Objective
Dual Active Bridge Converter

The DAB converter is an isolated switching converter that can perform bidirectional power transfer between two voltage sources. It is constituted by two active full-bridge converters linked by a high frequency transformer. The power flow between the sources can be controlled by adjusting the phase-shift relative to the gating pulses of the left and right bridges. This converter topology has been first proposed in [31] and further analized in [11]. Figure 1.16 shows the circuit diagram of the dc-dc DAB converter.

Figure 1.16: dc-dc DAB converter topology.

The principle of operation of the DAB is based on the commutation of the switches Q1 -Q8 . The semiconductor switches Q1 -Q4 are modulated to produce a high-frequency square or quasi-square waveform at the terminal v1 from the input voltage available with amplitude Vin . Similarly, the switches Q5 -Q8 are modulated to produce a high-frequency square waveform at the terminal v2 . For power transfer analysis, the DAB converter can be simplified with the equivalent circuit diagram shown in Figure 1.17. Equation 1.1 shows the expression of the active power transfer of the DAB converter as a function of the voltage levels, the phase-shift between the bridges and the series inductor. P = where, XL = 2f L (1.2) |nv1 1 ||v2 1 | sin() XL (1.1)

16

1.5. Literature Review Pertinent to Thesis Objective f is the frequency of the square waveforms,  is the angle difference between the voltages nv1 and v2 and nv1 1 and v2 1 are the fundamental harmonic component of the voltages nv1 and v2 respectively.

Figure 1.17: DAB converter simplified circuit.

Depending on the relative phase-shift between the gating signals S1 , S2 and S3 , the DAB converter can be operated with two distinct modulation strategies. In the first modulation strategy, SPS, one phase-shift is required. In this mode of operation, the gating signals S1 and S2 are in-phase, and the gating signal S3 is phase-shifted relative to S1 with an angle . An in-depth description and analysis of the SPS modulation is conducted in Section 1.5.2. For the second modulation strategy, DPS, two distinct phase-shifts are required. In this alternative mode of operation, the gating signals S1 and S2 are phase-shifted relative to each other with an angle  . The second phase-shift is relative to the gating signals S1 and S3 creating an angle . An in-depth description and analysis of the DPS modulation is conducted in Section 1.5.3.

17

Chapter 1. Introduction

1.5.2

Single Phase-Shift Modulation

In the SPS modulation, the gating signals S1 and S2 are in-phase and the gating signal S3 is phase-shifted relative to S1 with an angle . Therefore, the resultant voltages nv1 and v2 are square waveforms. Figure 1.18 shows the graph of the gating signals S1 to S3 and the phase-shift angle . The main advantage of the SPS modulation is its simplicity and its ease of implementation, because the averaged active power can be directly regulated by the phase-shift angle .

Figure 1.18: Gating pulse sequence for SPS modulation.

18

1.5. Literature Review Pertinent to Thesis Objective Considering that the power transfer occurs mainly at the fundamental frequency level, the effect of all other harmonics can be neglected. Therefore, the coefficient of the fundamental frequency can be obtained by performing a Fourier series expansion.

For power transfer analysis, the expression for the average active power provided in Equation 1.1 can be re-written as shown in Equation 1.3.

P =

v1

1

v2 1 sin() XL

(1.3)

As indicated earlier, the SPS modulation is very popular due to its simplicity. Nonetheless, this modulation strategy exibits inner circulating current flowing through the transformer when the voltages nv1 and v2 have different magnitudes producing, in turn, reactive power [32, 33]. Another undesired consequence of the SPS modulation, is that the circulating current can lead to high conduction losses, reducing the overall efficiency of the converter [31].

As expressed in Section 1.3, the DAB converter can operate at soft-switching conditions. In [11], an in-depth study of the DAB converter is presented where the boundaries and soft-switching operating conditions are summarized in Figure 1.25. The bold curves enclose the region of operation of the DAB converter under soft-switching conditions. As stated in [11], such nomogram is very useful in asserting, rather quickly, if an operating point is within the soft-switching region or not. 19

Chapter 1. Introduction

Figure 1.19: Nomogram of output voltage versus output current using SPS [11].

where, d(pu) = Io (pu) = R= Vout nVin nIo Vin XL (1.4) (1.5) (1.6)

d(pu) Io (pu)

20

1.5. Literature Review Pertinent to Thesis Objective For ZVS soft-switching operation in both bridges, the inductor current zero crossing, i , must occur within the time interval where the voltages nv1 and v2 have opposite polarities [12, 34­37]. Therefore, 0 < |i | < ||. Figure 1.26 and 1.27 show two scenarios where soft-switching conditions are achieved.

Figure 1.20: SPS modulation at ZVS soft-switching operation where nv1 > v2 .

However, the converter may also lose such condition when the voltage conversion ratio, d, deviates from unity [12, 34], as shown in Figure 1.19. Therefore, the operation of DAB based dc-ac converter under constant soft-switching conditions can be difficult in practical applications such as PV interconnection, where the voltage of the PV panel changes with the sun irradiance and ambient temperature. Moreover, the magnitude of the host ac-grid voltage is also time-varying, increasing even further the difficulty of softswitching operation. As consequence, the DAB based converters operating under SPS modulation suffer from lower energy conversion efficiencies due to its high conduction losses and hard switching operation [35]. Figure 1.22 and 1.23 show two scenarios where the converter operates under undesirable hard-switching conditions.

21

Chapter 1. Introduction

Figure 1.21: SPS modulation at ZVS soft-switching operation where nv1 < v2 .

Figure 1.22: SPS modulation at hard-switching operation where nv1 > v2 .

1.5.3

Dual Phase-Shift Modulation

To extend the range of operation under soft-switching conditions several modulation methods based on a dual phase-shift (DPS) have been proposed in the literature [11, 12, 22

1.5. Literature Review Pertinent to Thesis Objective

Figure 1.23: SPS modulation at hard-switching operation where nv1 < v2 .

23, 32­34]. In the DPS modulation, the gating signals S1 and S2 are phase-shifted with an angle  producing a three-level square waveform at the terminals of the transformer, nv1 . Moreover, the gating signal S3 is phase-shifted relative to S1 with an angle of  producing a square waveform at the bridge terminal v2 . Figure 1.24 shows the graph of the gating signals S1 to S3 and the phase-shift angles  and . Similar to the power transfer analysis of Section 1.5.2 only the fundamental frequencies of v1 and v2 are considered. Under the DPS modulation, the coefficient of the fundamental frequency of the three-level square waveform can be obtained by performing the Fourier series expansion as shown in Appendix A. Therefore, for power transfer analysis, the expression for the average active power provided in Equation 1.1 can be re-written as shown in Equation 1.7. n v1 v2 1 sin() cos( ) XL

P =

1

(1.7)

The addition of a third level in the voltage v1 , can be used to extend the soft-switching operating region. By analyzing Equation ??, the voltage conversion ratio, d can be regulated closer to unity by controlling the phase-shift,  . 23

Chapter 1. Introduction

Figure 1.24: Gating pulse sequence for DPS modulation.

4 v2 Vout  d= = 4 nVin nv1 cos( )  Since,

(1.8)

d1 then, 4 4 v2  nv1 cos( )   24

1.5. Literature Review Pertinent to Thesis Objective Solving for  ,   arccos v2 nv1 , 0  | |   2 (1.9)

Moreover, with the value of  obtained from Equation 1.9, the inductor current zero crossing, i , can be controlled such that 0 < |i | < ||. Figure 1.26 and 1.27 show two scenarios where soft-switching conditions are achieved under DPS modulation. In [12], an in-depth study of the DAB converter under DPS modulation is presented. The operating boundaries for soft-switching commutation conditions are summarized in Figure 1.25. Section A of the nomogram shows the soft-switching operation under SPS modulation, and Section B shows the extended soft-switching region operating under DPS modulation. Operation in the remaining sections exhibit hard-switching commutation.

Figure 1.25: Nomogram of output voltage versus output current usign DPS modulation [12]. Section A shows the soft-switching operation under SPS modulation. Section B shows the extended soft-switching region operating under DPS modulation. Operation in the remaining sections exhibit hard-switching commutation.

25

Chapter 1. Introduction

Figure 1.26: DPS modulation at ZVS soft-switching operation where nv1 > v2 .

Figure 1.27: DPS modulation at ZVS soft-switching operation where nv1 < v2 .

26

1.6. Thesis Outline

1.6

Thesis Outline

The remainder of this thesis is organized as follows:
 Chapter 2 presents the large-signal, steady-state and small-signal state-space mod-

els of the series-resonant DAB based dc-ac converters under the SPS modulation. The magnitude of the resonant voltage, resonant current, input voltage and output current are calculated using the mathematical model. This analytical model, is, in the opinion of the author, a way to unify the analysis of the DAB based converters via a traditional approach rather than evaluating the power losses or the instantaneous power delivery using phasorial analysis. An extended mathematical model for the DPS modulation is presented in Appendix B. Furthermore, chapter 2 presents a design methodology and component sizing strategy.
 Chapter 3 proposes an effective control strategy and derives the input to output

transfer functions of the converter. In addition, this chapter presents candidate compensators to control both output current and input voltage quantities to control power transfer and to implement effective MPPT algorithms.
 Chapter 4 presents the simulated and experimental results to validate the proposed

mathematical model and control strategy.
 The conclusion and future work is presented in Chapter 5.

27

Chapter 2 Mathematical Model
The development of an appropriate mathematical model is central to the process of control design. Different models may be required for different stages of the control design. However, even for a specific stage of the design procedure several different models can be used, each with their own intrinsic model characteristics. Therefore, several trade-offs are involved in selecting from among different models. For instance, the steady-state model presented in [6] functions well in simulating the open-loop behaviour of the DAB based converter, but does not provide a good basis for determining a closed-loop controller. The model presented in [7] is based on power flow analysis, and similar to the previous case, it does not provide a dynamic modelling of the power circuit. The lack of dynamic modelling often leads to the implementation of unpractical and difficult close-loop control strategies with limited operating range. For instance, in [7,24­26] a single-phase Phase-locked Loop (PLL) and a look-up table are used to operate the converter only at predefined conditions. On the other hand, complex models for power circuits may predict open-loop behaviour more accurately, but may be analytically more complex and less useful in generating simple candidate control designs [38]. For example, in [8, 10, 28, 30] the proposed model is based on power flow analysis and the adopted control strategy requires the implementation of computational demanding algorithms to calculate the phase-shifts and time delays between the bridges. Regardless of the modelling choice, an over-simplified model may miss crucial aspects of system behaviour and therefore lead to unsatisfactory controllers [38]. Therefore, for the effective and systematics modelling of power circuits, several methods have been proposed in the literature based on switched, averaging, and state space models [39­46].

28

State-space models provide a general and powerful foundation for dynamic modelling compared to other modelling approaches such as switched and averaging models. In fact, state-space models include both switched and average models as special cases, but go considerably further. This modelling technique provides good performance when analyzing, simulating, and controlling both steady-state behaviour and perturbations away from it. State-Space modelling focuses on the variables that are central to describing the dynamic evolution of a system. Such variables are called state variables, whose values and interrelationship defines the state of the system. State variables summarize those aspects of the past that are important for the future. Such aspects are associated with the memory mechanism or the energy storage mechanisms of the system. For electrical circuits, the natural state variables are the currents of flux linkages in inductors and the voltages or charges on capacitors [38]. In addition to the state variables, other variables i.e, the inputs and outputs, are of interest when describing a dynamic system. The inputs to the system are the external signals that sets the electrical circuit in action. Such inputs are the waveforms of voltage and current sources that drive the power circuit and the gating signals that modulate the controlled switches. Some other inputs may be control variables that can be commanded to operate the circuit in a desired manner, whereas other inputs may be disturbances that cannot be directly or indirectly controlled. These governing laws are embodied in the state-space model [38]. The outputs of the system are either measured quantities of those whose values are of interest, even if not measured. The instantaneous values of the desired outputs can be modeled as a function of the system state and the inputs at that instant. In the context of electrical circuits, typical outputs may be the voltages and/or currents associated with selected elements [38].

29

Chapter 2. Mathematical Model

2.1

Large-Signal Model of Converter

The derivation of the state-space model of the DAB based converter shown in Figure 2.1 consists of three parts. The first step consists of the development of a large-signal model to understand and predict the dynamic operation of the converter at any conditions. The second and third steps consists of developing a steady-state model, a small signal model to understand the behaviour of the converter when small perturbations drive the converter away from a quiescent operating point. The steady-state and small signal models are key for the development of the control design. As mentioned in the previous section, the state variables of a state-space model are the quantities that store energy in the system. In electrical circuits, the natural state variables are the currents in the inductors and the voltages across the capacitors. Therefore, the following quantities are of special interest: vpv , ir , vr , vout and ig .

30

2.1. Large-Signal Model of Converter

31
Figure 2.1: dc-ac DAB based converter topology.

Chapter 2. Mathematical Model

2.1.1

Analysis of Resonant Tank

To reduce the analysis complexity of the converter's resonant tank under the SPS modulation, the voltages v1 and v2 can be replaced by square wave sources. Consequently, the converter diagram shown in Figure 2.1 can be replaced by the simplified equivalent circuit shown in Figure 2.2.

Figure 2.2: Simplified equivalent circuit of the dc-ac DAB converter under SPS modulation.

The current and voltage of the resonant inductor are related as dvr = ir dt In addition, it is possible to apply KVL around the mesh to obtain Cr Lr dir = nv1 - v2 - vr - Rir dt (2.1)

(2.2)

Since power transfer is made possible mostly by fundamental harmonic components, the voltages v1 and v2 can be approximated by their first harmonic components as v1  v1 = 4 vpv cos(t + )  (2.3)

1

4 |vout | cos(t) (2.4)  Let voltage vr and current ir be expressed as linear combination of orthogonal sinusoidal components with time-varying coefficients as discussed in [47], as shown in Equations (2.5) and (2.6). v2  v2
1

=

vr = v (t) cos(t) + v (t) sin(t) 32

(2.5)

2.1. Large-Signal Model of Converter

ir = i (t) cos(t) + i (t) sin(t) Then, using trigonometric relations, one finds

(2.6)

v ^r =

2 + 2 v v

(2.7a) (2.7b)

v = arctan

v v

^ i r =

2 i + i2

(2.8a) (2.8b)

i = arctan

i i

where^denotes the peak value of the corresponding variables. Substitution of (2.5) and (2.6) into (2.1), yields (2.9). Cr d [v cos(t) + v sin(t)] = i cos(t ) + i sin(t) dt (2.9)

Expanding (2.9) and equating the corresponding orthogonal terms of the two sides of the expanded equation, one finds i dv = - v  dt Cr dv i = + v  dt Cr Substitution of (2.3) through (2.6) into (2.2) gives (2.10)

(2.11)

Lr

d 4n 4 [i cos(t) + i sin(t)] = vpv cos(t + ) - |vout | cos(t) dt   -v cos(t) - v sin(t) - i R cos(t) - i R sin(t).

(2.12)

which, through a process similar to the one used for deriving Equations (2.10) and (2.11), yields di 1 4 = nvpv cos() - |vout | - v - i R - i  dt Lr  33 (2.13)

Chapter 2. Mathematical Model

di 1 4n = - vpv sin() - v - i R + i  dt Lr 

(2.14)

Equations (2.10), (2.11), (2.13) and (2.14) represent the expressions for the state variables of the resonant quantities. In the next two subsections, the dynamic equations for vpv and ig are derived.

34

2.1. Large-Signal Model of Converter

2.1.2

Analysis of Converter Input Power Balance

The analysis of the input bridge is of great importance to understand and control the converter such that the maximum power is transferred from the PV into the grid using MPPT algorithms. Figure 2.3 shows the equivalent circuit for power flow analysis at both input and output terminals.

Figure 2.3: Circuit diagram for power flow analysis.

The power balance principle applied at the input bridge requires that vpv iin = nv1 ir (2.15)

where the averages are taken over one switching cycle. Therefore, assuming that vpv is constant over one switching cycle, one can rewrite Equation (2.15) as vpv iin = nv1 ir Substituting for v1 and ir from 2.3 and 2.6 one can find vpv iin = which can be simplified as vpv iin = 4n 1 1 vpv i cos() - i sin()  2 2 2n i cos() - i sin()  (2.18) 4n vpv cos(t + ) i cos(t) + i sin(t)  (2.17) (2.16)

iin = Then, one can write

(2.19)

35

Chapter 2. Mathematical Model

Cin

dvpv = ipv - iin dt

(2.20)

which substituting (2.19), can be rewritten as dvpv 1 2n = ipv - i cos() - i sin() dt Cin  (2.21)

2.1.3

Analysis of Converter Output Power Balance

A similar power flow analysis can be performed at the output of the converter. The output filter composed by Cout and Lout has the objective to filter out the high frequency harmonics due to the switching, therefore it does not affect the dominant dynamics of the converter and can be neglected. Power flow analysis at the converter output should be performed to describe the relationship between the output current and the resonant current. The circuit diagram for power flow analysis of Figure 2.3 can be replaced, if ignoring the output filter, by the simplified circuit diagram shown in Figure 2.4.

Figure 2.4: Simplified circuit for power flow analysis.

vout iout = v2 ir

(2.22)

Assuming that vout is constant over one switching cycle, one can rewrite (2.22) as vout iout = 4 |vout | cos(t) i cos(t) + i sin(t)  (2.23)

iout =

4 |vout | cos(t) i cos(t) + i sin(t)  vout 36

(2.24)

2.1. Large-Signal Model of Converter

iout =

2 |vout | i  vout

(2.25)

iout =

2 i sgn(vout ) 

(2.26)

If the effect of the output filter is ignored,

vout v = vg and

(2.27)

iout = ig Otherwise, dvout = iout - ig dt dig = vout - vg dt

(2.28)

Cout

(2.29)

Lout

(2.30)

1 2 dvout = i - ig dt Cout  1 dig = vout - vg dt Lout Therefore, if the output filter is ignored the state vector can be written as,  v    v     x=  i     i  vpv Otherwise, if the effect of the output filter is considered, 37 

(2.31)

(2.32)

(2.33)

Chapter 2. Mathematical Model

 v    v       i x=   i    v   pv  vout



(2.34)

In the subsequent sections of this thesis the effect of the output filter will be ignored.

38

2.2. Steady-State and Small-Signal Models

2.2

Steady-State and Small-Signal Models

For the purpose of control design, the large-signal model developed in Section ?? should be linearized about an operating point of the converter. The static characteristics of power electronic circuits often depend non-linearly on the control variables, and their dynamic characteristics are even more likely to do so. With linear or nonlinear feedback control, the closed-loop system is typically also nonlinear. Assessing stability and designing controllers with nonlinear models are usually difficult. The most common, systematic and generally successful approach to these tasks is lineariztion. In other words, the nonlinear model is replaced by linear models that approximately describe small deviations or perturbations from nominal operation point, or quiescent point of a system. Linear models are far easier to analyze than nonlinear ones. Linearized models, also called small-signal, are crucial to evaluating the stability of a nominal operating condition [38]. To that end, let each variable be decomposed into a nominal component (steady-state component) and a small perturbation from the nominal value (small-signal component). Then, x(t) = X + x ~(t) (2.35)

where uppercase letter X denotes the steady-state component of x(t), while x ~(t) denotes a small-signal component. To determine the state-space components, the derivatives in the state-space equations (2.10),(2.11),(2.13),(2.14), (2.21) and (2.31) are set to zero, to yield Ai - Bv  = 0 Cr Bi + Av  = 0 Cr 1 4 (nVpv cos() - Vout ) - Av - Ai R - Bi  = 0 Lr  1 4 - nVpv sin() - Bv - Bi R + Ai  = 0 Lr  Ipv - 2n [Ai cos() - Bi sin()] = 0  2 Ig - Ai = 0  (2.36) (2.37) (2.38) (2.39) (2.40) (2.41)

where each variable is replaced with its steady-state component. 39

Chapter 2. Mathematical Model Due to the symmetrical operation of the converter when vout > 0 and vout < 0, the rest of the mathematical derivation assumes that the polarity of vout is positive. The small-signal model of the converter is then given by

dx ~ = Ax ~ + Bu ~ dt y ~ = Cx ~

(2.42a) (2.42b)

where A is the state matrix, B is the input matrix, and C is the output matrix; variable y ~ is the output of interest. In this particular system there are three inputs: , vg and ip v , and two outputs: ig and vpv . Therefore, the state-space model of the converter can be expressed as:

dx ~ ~ + Bv g v ~ = Ax ~ + B  ~ g + Bipv ipv dt ~ ~ i g = C ig x ~ v~ pv = Cvpv x where,   ~v ~  v    x ~= ~i    ~  i  v~ pv  and,   ~v ~  v   dx ~ d    = ~ i  dt dt  ~  i  v~ pv 

(2.43a) (2.43b) (2.43c)

(2.44)

(2.45)

The state matrix A can be calculated by taking the partial differentiation of each state equation with respect to each state variable. Alternatively, the state matrix can be thought as the Jacobian matrix in power systems. 40

2.2. Steady-State and Small-Signal Models

 a11  a21  A= a31  a41 a51

a12 a22 a32 a42 a52

a13 a23 a33 a43 a53

a14 a24 a34 a44 a54

 v  v      v a15     a25   v     i a35   =  v   a45       i   a55  v   vpv  v 

 v v v  v  i v i  v  vpv  v

 v i v  i  i i i  i  vpv  i

 v i v  i  i i i  i  vpv  i

  v vpv   v    vpv    i   vpv   i    vpv    vpv   vpv

(2.46)

The input matrices B , Bvg and Bipv are formulated as the partial differentiation of each state equation with respect to the inputs vg , ipv and control variable .

   
v

          v  b 1       b2            i  B =  = b   3         i  b4        b 5      v  pv 

(2.47)

Bv g

  v      vg    v  bvg 1      v  bvg 2   g        =  i  = b v 3 g    vg      i  bvg 4        v  bvg 5  g   vpv    vg 41

(2.48)

Chapter 2. Mathematical Model

Bipv

  v       ipv v    bipv 1       bipv 2   ipv        = i = b i 3 pv    ipv      i  bipv 4        i  bipv 5  pv    vpv    ipv

(2.49)

The mathematical derivation for the entries of the state matrix A, the input matrices B , Bvg and Bipv have been included in Appendix B. For the two outputs of interest, vpv and ig , the output matrices CV pv and CIg are given by CV pv = 0 0 0 0 1 2 0 0  (2.50)

CIg = 0 0

(2.51)

The outputs of the system can be calculated as the addition of the steady-state magnitude and the small-signal perturbation.

~ ig = Ig + i g vpv = Vpv + v~ pv

(2.52) (2.53)

2.3

Summary

This chapter presented an averaged large-signal state-space model for the DAB-based resonant converter under SPS modulation. Moreover, to facilitate the task of control design, the large-signal model was linearized about a steady-state operating point. The developed models will be used in the next chapter for designing the current- and dc-link voltage controllers. The methodology presented in this chapter can also be applied when the converter is operated under DSP modulation. Such mathematical model extension has been presented in Appendix C. Furthermore, Appendix D presents an extension of the mathematical model when the DAB-based converter under SPS modulation is used as a rectifier. 42

Chapter 3 Control Scheme and Compensator Design
In the previous chapter a set of mathematical models composed of a non-linear largesignal model, a steady-state model and a linear small-signal model, were presented. In this chapter the control strategy and compensators design are presented for the DAB based converter shown in Figure 2.1. Figure 3.1 illustrates the high level control strategy for the converter of Figure 2.1. As the figure shows, there are two feedback loops: a control loop for the task of regulating ig and another one to control vpv . The inner control loop is a fast loop with a small time constant, that has the objective of controlling power flow transfer between the converter and the ac-host grid. To regulate the power flow transfer, the output grid current ig is kept in phase with the grid voltage vg using a similar philosophy as presented in [48] such that power is transferred to the grid at unity power factor. The amount of active power transferred can be controlled by adjusting the amplitude of ig . The slower outer loop controls the voltage across the input capacitor vpv , such that MPPT algorithms can be implemented to maximize the power transfer between the PV and grid. The subsequent sections present the control design method for the dc-link voltage control and the current control strategy.Furthermore, the derivation of the converter transfer function needed to design the current controller, the closed-loop stability requirements for the system and the compensator design methodology to meet such specifications are also presented in this chapter.

43

Chapter 3. Control Scheme and Compensator Design

Figure 3.1: Proposed converter control strategy concept.

44

3.1. dc-link Voltage Control Design

3.1

dc-link Voltage Control Design

This section presents the approximate method for dc-voltage control design based on the energy conservation principle. Applying the energy conservation principle and ignoring converter power loses: 1 dvpv 2 ppv - pg = Cin 2 dt where, vg = v ^ g cos(t) and assuming a fast current control, ig = ig  let k be the voltage compensator output and ig  = kvg to ensure unity power factor. Therefore, ^ ig  = k v g cos(t) and 1 2 pg = k v ^ g 2 Substituting for pg in (3.1), 1 dvpv 2 ^ (3.7) ppv - k v g = Cin vpv 2 dt Therefore, the dc-link voltage control can be shown in the control block diagram shown in Figure 3.2. (3.6) (3.5) (3.4) (3.3) (3.2) (3.1)

45

Chapter 3. Control Scheme and Compensator Design

Figure 3.2: dc-link voltage control design.

where the voltage compensator Kv (s) can be designed using classical methods. Figure 3.3 shows the detailed proposed converter control strategy where both dc-link voltage and output current control loops are included. To implement such control strategy it is required to derive the phase shift angle-to-output current transfer function characteristics of the system. In the next subsections a general method to derive transfer functions given the small-signal model is studied. Such method is applied to derive the phase shift angle-to-output current transfer function given the inputs of the converter. Finally, a proposed current compensator is designed and verified using classical frequency response methods.

46

3.1. dc-link Voltage Control Design

47
Figure 3.3: Detailed proposed converter control strategy.

Chapter 3. Control Scheme and Compensator Design

3.2

Transfer Function Development

The expression of the transfer function of a single-input, single-output system can be obtained from the state-space equations derived in Chapter 2 [49]. G(s) = C (sI - A)-1 B + D (3.8)

where, A is the state matrix, B the input matrix, C the output matrix, D the direct transmission matrix, obtained in the linearized state-space model and I is the identity matrix with dimensions matching the dimensions of the state matrix. For the development of an effective compensator that regulates the converter at any operating condition, a near worst-case circuit analysis can be performed. The transfer function characteristics of the converter can be derived when the converter operates at its more exigent conditions, where the grid voltage vg is at its peak, and the sun irradiance is high. The PV panel chosen to obtain the input parameters is the CS6P-265 from CanadianSolar [13]. Table 3.1 shows the electrical characteristics of the CanadianSolar CS6P-265 PV panel.

Table 3.1: Electrical Characteristics for CanadianSolar CS6P-265 PV Panel [13]

.

Irradiance Nominal Max Power Opt. Operating Voltage Opt. Operating Current Open Circuit Voltage Short Circuit Current

PV Electrical Parameters 1000W/m2 800W/m2 265W 192W 30.6V 27.9V 8.66A 6.88A 37.7V 34.7V 9.23A 7.48A

48

3.2. Transfer Function Development The control-to-output current transfer function Gig (s), can be calculated using a numerical computing environment such as MATLAB. The MATLAB script used to solve the steady-state parameters, the small-signal model and control transfer function, can be found in Appendix C. In the following section, the transfer function have been calculated using the parameters shown in Table 3.2.

Table 3.2: Simulation converter parameters

Converter Parameters Name Symbol Value Transformer Turns Ratio n 7 Resonant Inductor Lr 380µH Resonant Capacitor Cr 15nH Resonant Frequency fr 66.66kHz Switching Frequency fs 78kHz Input Capacitance Cpv 27mF Output Inductor Lout 183µH Output Capacitor Cout 560nF Resistance R 0.567 PV Current ipv 5A PV Voltage vpv 20.1V Grid Current ig 1.25A Grid Voltage vg 80V Phase-Shift  33

49

Chapter 3. Control Scheme and Compensator Design

3.3

Control to Output Current Transfer Function

The control to output current transfer function is calculated using Equation (3.8) and a numerical computing environment.

Gig (s) = -1.6341×105

(s - 1.493 × 105 )(s + 9.045)(s2 - 6.042 × 105 s + 3.254 × 1011 ) (s + 0.2679)(s2 + 1208s + 5.077 × 109 )(s2 + 1208s + 8.262 × 1011 ) (3.9) From the control angle to output current transfer function, the bode plot can be obtained to observe the frequency response.

60 40 20 0 -20 -40 -60 180 90 0 -90 -180 10-2

100

102

104

106

108

Figure 3.4: Bode plot for Gig (s).

50

3.3. Control to Output Current Transfer Function Expanding into the region 104    107 rad/s,

60 40 20 0 -20 -40 180 90 0 -90 -180 104

105

106

107

Figure 3.5: Bode plot for Gig (s).

As it can be observed from the transfer function and the frequency response, the system presents non-minimum phase zeros. Such zeros will impose heavy constrains on the closed-loop bandwidth of the system, increasing the difficulty of the compensator design.

51

Chapter 3. Control Scheme and Compensator Design

3.4

Current Compensator Design

In this section the requirements and design procedure of the current compensator are outlined. For this process, the control strategy shown in Figure 3.3 can be replaced by the simplified control block diagram shown in Figure 3.6.

Figure 3.6: Current control feedback loop block diagram.

As a general rule, the compensation network must exhibit certain characteristics to meet both static and dynamic performance requirements, while maintaining system stability. Such characteristics are: a fast loop response, achieved by a high bandwidth (high cross zero frequency); good noise immunity, achieved with a low gain at high frequencies and good phase margin in order to have a good stability with minimum overshoot. For this system, the current compensator Kig (s) is required to track a sinusoidal reference input with a frequency of 60Hz . Therefore, the compensator must provide a close-loop bandwidth of about 4000 rad/s (i.e., about 10 times the grid frequency) such that the reference appears a constant value during the delay of one loop cycle. In order to track the reference with zero steady-state error, the compensator must also include at least one integrator term. To provide good stability margins, the phase margin must be greater than 30 and the gain margin must be greater than 6dB . In the following subsections, the transfer function characteristics of the candidate current compensator is presented. Furthermore, the effect of the current compensator on the open- and closed-loop characteristics of the system are analyzed.

52

3.4. Current Compensator Design

3.4.1

Transfer Function

In the previous section the general stability requirements have been outlined. In this section, the design procedure and performance of the candidate current compensator is presented. The candidate current compensator is composed by an integrator term to satisfy the zero-steady state error requirement, and a lag compensator to improve the phase margin of the closed-loop system. Therefore, to meet the stability requirements described in the previous section, the current compensator transfer function has the form of: Kig (s) = 6500 (600 × 10-9 s + 1) s(68 × 10-6 s + 1) (3.10)

3.4.2

Frequency Response

From the current compensator transfer function, the bode plot can be obtained to observe the frequency response.

53

Chapter 3. Control Scheme and Compensator Design

0 -20 -40 -60 -80 -100 -90

-135

-180 103

104

105

106

107

Figure 3.7: Bode plot for Ki (s).

54

3.4. Current Compensator Design

3.4.3

Open- and Closed-Loop Analysis

The open-loop transfer function can be obtained as shown in Equation (3.11). Li (s) = Gig (s) × Kig (s) (3.11)

From the open-loop transfer function derived in the previous section, the bode plot can be obtained to observe the frequency response.

30 20 10 0 -10 -20 -30 180 90 0 -90 -180 103

104

105

Figure 3.8: Frequency response for Li (s).

55

Chapter 3. Control Scheme and Compensator Design The closed-loop frequency response of the grid current feedback control loop, can be calculated as Ti (s) = Li (s) 1 + Li (s) (3.12)

From the closed-loop transfer function studied in the previous section, the bode plot and nyquist diagram can be obtained to observe the frequency response, closed-loop bandwidth, gain-margin and phase-margin of the system.

0

-50

-100

-150 180 90 0 -90 -180 103

104

105

106

107

Figure 3.9: Frequency response for Ti (s).

56

3.4. Current Compensator Design

1.5

2 dB

0 dB

-2 dB -4 dB

1

4 dB 6 dB -6 dB -10 dB -20 dB

0.5

10 dB 20 dB

0

-0.5

-1

-1.5 -1

-0.5

0

0.5

1

1.5

Figure 3.10: Nyquist diagram for Ti (s).

57

Chapter 3. Control Scheme and Compensator Design Bandwidth, Gain Margin and Phase Margin From the closed-loop transfer function and the nyquist diagram, it is possible to obtain the stability margins of the system. The closed-loop bandwidth of the system c = 26000 rad/s or fc = 163.36 KHz, therefore it can successfully track a 60 Hz sinusoidal waveform. The gain margin is 7.58dB , and the phase margin is 45.3 . Step Response The step response gives information in time-domain about the dynamic behaviour of the system. The step response of the current control loop is shown is Figure 3.11.

1.4 1.2 1 0.8 0.6 0.4 0.2 0 -0.2 0 0.2 0.4 0.6 0.8 1 1.2 10
Figure 3.11: Step for Ti (s).

1.4
-3

The rise time is defined as the time the response takes to rise from 10 to 90% of the steady-state value. For this feedback loop the rise time is 366ns. The overshoot of the step response is 28%. The settling time is 98ns.

58

3.5. Summary

3.5

Summary

In this chapter the control strategy of the converter was presented. Additionally, the converter transfer functions were derived, and a design methodology for the current regulator was studied. In the next chapter, the proposed mathematical model, control strategy and candidate compensator designs are validated throughout software simulations using the PLECS [50] environment and experimental verification.

59

Chapter 4 Converter Model and Control Strategy Verification
In the following chapter, the validation of the mathematical model presented in Chapter 2 via simulation and experimental verification is presented. Furthermore, the validation of the proposed control strategy and compensator designs is also addressed in this chapter. For such task a switched model has been implemented in PLECS simulation environment and a converter prototype has been built.

60

4.1. Mathematical Model Verification

4.1

Mathematical Model Verification

The verification of the mathematical model has been subdivided into the validation of the three models derived in Chapter 2: steady-state model, small-signal model and largesignal model.

4.1.1

Steady-State Model Verification

The first step of the model validation process is the verification of the steady-state model. For such task the converter circuit shown in Figure 4.1 has been simulated in PLECS software environment and the outputs compared with the results provided by the MATLAB script developed in Chapter 2. The switching PLECS model and the mathematical equations of converter are calculated with the parameters shown in Table 4.1.
Table 4.1: Steady-state Model Verification Test Parameters

Steady-state Model Verification Converter Parameters Name Symbol Value Switching Frequency fs 78kHz PV Current ipv 5A Grid Voltage vg 80V Phase-Shift  33 Figure 4.10 shown the values of vpv , ig , vr and ir obtained as the result of the steady-state model and the switched model simulation.

Figure 4.1: Converter with dc side fed by a current source.

Comparing the steady-state conditions of the PLECS switched model with steady-state 61

Chapter 4. Converter Model and Control Strategy Verification equations, one can conclude that the steady-state model derived in Chapter 2 has been validated.

62

20.0942

20.094

20.0938

20.0936

20.0934 2.12096 2.120965 2.12097 2.120975 2.12098 2.120985 2.12099 2.120995 2.121

20.0932 2.12095

2.120955

1.26

1.25

1.24

1.23 2.12096 2.120965 2.12097 2.120975 2.12098 2.120985 2.12099 2.120995 2.121

2.12095

2.120955

4.1. Mathematical Model Verification

63
2.12096 2.120965 2.12097 2.120975 2.12098 2.120985 2.12096 2.120965 2.12097 2.120975 2.12098 2.120985

400 300 200 100 0 -100 -200 -300 -400 2.12095

2.120955

2.12099

2.120995

2.121

2.8

1.4

0

-1.4

-2.8 2.12095

2.120955

2.12099

2.120995

2.121

Figure 4.2: Steady-state model verification. Waveforms for vpv , ig , vr and rr .

Chapter 4. Converter Model and Control Strategy Verification

4.1.2

Small-Signal and Large-Signal Model Verification

The next step of the model validation process is the verification of the linear small-signal and nonlinear large-signal models. For such task two test scenarios have been studied. Case 1: dc Side Fed by a Current Source The first test consists on the perturbation of the phase-shift angle for the converter shown in Figure 4.1. This test emulates the most general operating conditions of the converter when used in solar PV applications. The phase-shift step change is applied to each of the different converter models while they operate at a steady-state condition. The initial operating conditions and the step change are shown in Table 4.3. Figure 4.3 provides a visual description of the proposed small-signal verification test procedure.
Table 4.2: Case 1 test parameters

Small-signal and large-signal model case 1 verification parameters Name Symbol Value Switching Frequency fs 78kHz PV Current ipv 5A Grid Voltage vg 80V Phase-Shift  33 Phase-Shift Step Change  10% The phase-shift angle  undergoes the step change of 10% at t = 25s. Figure 4.4 and 4.5 shows the response of the switched PLECS, large-signal and small-signal models.

64

4.1. Mathematical Model Verification

Figure 4.3: Small-signal and large-signal model case 1 verification method.

65

Chapter 4. Converter Model and Control Strategy Verification

Figure 4.4: Case 1 Small- and large- signal model verification. Waveforms of vpv , ig , vr and rr for a phase-shift step change of 10%.

66

4.1. Mathematical Model Verification

67

Figure 4.5: Case 1 PLECS switched, small- and large- signal model verification. Waveforms of vpv , ig , vr and rr for a phase-shift step change of 10%.

Chapter 4. Converter Model and Control Strategy Verification Comparing the dynamics of the system and settling conditions after the step change of the PLECS switched, large- and small-signal models, one can conclude that the largeand small-signal models derived in Chapter 2 have been validated. Case 2: dc Side Loaded by a Resistor The second and final step of the model validation process is the verification of the linear small-signal and the nonlinear large-signal model when the converter operates as a rectifier with a resistive load. Once again, a step phase-shift disturbance is applied to the converter shown in Figure 4.6. Figure 4.7 provides a visual description of the proposed verification test procedure.
Table 4.3: Case 2 test parameters

Small-signal and large-signal model case 2 verification parameters Name Symbol Value Switching Frequency fs 78kHz Load R 3.36 Grid Voltage vg 80V Phase-Shift Step Change  5%

Figure 4.6: Large-Signal Model Verification Open Loop Test.

A 250-W prototype of the converter was built to enhance the verification process and obtain experimental results. Table 4.4 outlines the converter parameters and some important components. Figure 4.8 and Figure 4.9 shows the photographs of the designed converter.

68

4.1. Mathematical Model Verification

Figure 4.7: Large-Signal Model Experimental Verification Method.

69

Chapter 4. Converter Model and Control Strategy Verification

Table 4.4: Experimental Converter Parameters

Name Transformer

Resonant Inductor Resonant Capacitor Resonant Frequency Switching Frequency Input Capacitance Output Inductor Output Capacitor Low Side MOSFETs High Side MOSFETs

Converter Parameters Symbol Value Comments N97 PM 50/39 Ungapped Primary: 1 Turn 0.4mm Copper Foil n 7 Secondary: 7 Turns, Litz Wire 5 × 20/38 Leakage Inductance: 20µH N47 PM 50/39 Gapped Lr 360µH 45 Turns, Litz Wire 5 × 20/38 Cr 15nH Poly Film fr 66.66kHz fs 78kHz Cpv 27mF ± 20% 35V Electrolytic N47 RM14 1mm Gap Lout 183µH 15 Turns, Litz Wire 5 × 20/38 Cout 560nF Poly Film Texas Instruments CSD18502KCS 40V - 100A Infineon IPP600N25N3GXKSA1 250V - 25A

70

4.1. Mathematical Model Verification

Figure 4.8: Converter Prototype Disassembled.

Figure 4.9: Converter Prototype Assembled.

71

Chapter 4. Converter Model and Control Strategy Verification

Figure 4.10: Case 2 Small- and large- signal model verification. Waveforms of vpv , ig , vr and rr for a phase-shift step change of 5%.

72

4.1. Mathematical Model Verification

15.2 15.1 15 14.9 14.8 14.7 14.6 14.5 14.4 -1.6

-1.5

-1.4

-1.3

-1.2

-1.1

-1

-0.9

-0.8

-0.7

-0.6

-0.5

-0.4

-0.3

-0.2

-0.1

0

-0.62 -0.63 -0.64 -0.65 -0.66 -0.67 -0.68 -0.69 -0.7 -0.71 -0.72 -1.6 -1.5 -1.4 -1.3 -1.2 -1.1 -1 -0.9 -0.8 -0.7 -0.6 -0.5 -0.4 -0.3 -0.2 -0.1 0

Figure 4.11: Oscilloscope capture of vpv and ig for a phase-shift step change of 5%.

Figure 4.12: Oscilloscope capture of vr and ir for a phase-shift step change of 5%.

73

Chapter 4. Converter Model and Control Strategy Verification Figure 4.10 shows the output of the small-, large-signal and PLECS models when a large step in the control angle is introduced. Figure 4.11 and 4.12 shows the output of the converter prototype under the same step conditions. Comparing the PLECS model and the experimental results with the results obtained with large-signal model, it can be observed that the magnitude of vpv for the experimental and mathematical models are equivalent. It can also be observe that the magnitude of ig is about 11.5% larger in the experimental setup, such additional power is dissipated in the form of heat. Nonetheless, it can be concluded that the derived large- and small-signal models provide an accurate mean to characterize the DAB-based resonant converter. Comparing the dynamics of the system and settling conditions after the step change of the PLECS switched, large- and small-signal models, one can conclude that small-signal model extension for the converter operating as a rectifier derived in Appendix D has been validated.

4.2

Control Strategy Verification

Having verified the validity of the mathematical model derived in Chapter 2, it it required to validate the effectiveness of the proposed control strategy studied in Chapter 3. For such purpose the converter is operated at the conditions shown in Table 4.5 and the voltage and current control loops are introduced as shown in Figure 4.13.

Figure 4.13: Closed loop test.

74

4.2. Control Strategy Verification

Table 4.5: Control strategy test parameters

Steady-state Model Verification Converter Parameters Name Symbol Value Switching Frequency fs 78kHz PV Current ipv 5Adc Grid Voltage vg 120V ac

75

Chapter 4. Converter Model and Control Strategy Verification For this test, the candidate voltage controller proposed in Section 3 has the form of a PI compensator. The proportional gain Kp and the integral gain Ki of such compensator can be tuned to obtain the following transfer function: 0.2s + 2.75 (4.1) s At t = 0 the system is initialized and the reference voltage is set to vpv  = 20V , once the system has reached its settling point, the reference voltage undergoes a step change to vpv  = 30V at t = 0.75s assuming that the sun irradiation has increased. At t = 1.5 is assumed that the sun irradiance decays so that the reference voltage given by the MPPT algorithm is vpv  = 25V . Figure 4.14 shows the response of the PLECS simulation model and large-signal model to such changes. As it can be observed from both figures, the steady-state, settling times and dynamics for vpv of both models present similar responses validating the proposed voltage control strategy. Figure 4.15 shows the responses of both models when t  0.5s. As it can be observed the grid current ig is able to track the 60Hz reference with a small phase delay validating the grid current controller and current control strategy. Furthermore, the waveform for vp v shown oscillations with twice the line frequency. Kv ( s) =

76

4.2. Control Strategy Verification

77
Figure 4.14: Control strategy verification. Closed-loop waveforms for vpv , ig , vr and rr .

Chapter 4. Converter Model and Control Strategy Verification

Figure 4.15: Control strategy verification. Closed-loop waveforms for vpv , ig , vr and rr zoomed at t = 0.5s.

78

4.3. Converter Characterization

4.3

Converter Characterization

To quantize and characterize the performance of the converter, a two voltage sources were connected at each of the converter ports as shown in Figure 4.16.

Figure 4.16: Open loop converter characterization.

The voltage of both sources and the phase-shift angle was varied to drive the converter at different operating conditions. The input and output voltages and currents were measured and recorded using a power analyzer. Figure 4.17 shows a sample power analyzer screenshot. Figures 4.18, 4.19 and 4.20 show the efficiency and output power delivered at different phase-shift angles as a function of vpv .

79

Chapter 4. Converter Model and Control Strategy Verification

Figure 4.17: Power analyzer screenshot for converter characterization at vpv = 20.5V and vg = 150V .

80

0.94 190 180 170 160 150 140 130 120 110 100 90 80 70 60 50 40 30

200

0.93

0.92

0.91

0.9

0.89

0.88

0.87

4.3. Converter Characterization

0.86

81
13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 20 10 11 12 13

0.85

0.84

0.83

0.82

0.81

0.8

0.79 10

11

12

14

15

16

17

18

19

20

21

22

23

24

25

26

27

28

Figure 4.18: Efficiency and output power versus PV voltage when vg = 120V.

Chapter 4. Converter Model and Control Strategy Verification

0.94 220 210 200 0.92 0.91 0.9 0.89 0.88 0.87 0.86 0.85 0.84 0.83 0.82 0.81 0.8 0.79 10 11 12 190 180 170 160 150 140 130 120 110 100 90 80 70 60 50 40 30 0.93

13

14

15

16

17

18

19

20

21

22

23

24

25

26

27

28

20 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30

Figure 4.19: Efficiency and output power versus PV voltage when vg = 135V.

82

0.94 230 220 210 200 190 180 170 160 150 140 130 120 110 100 90 80 70 60 50 40 30 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28

240

0.93

0.92

0.91

0.9

0.89

0.88

0.87

4.3. Converter Characterization

0.86

83

0.85

0.84

0.83

0.82

0.81

0.8

0.79 10

11

12

20 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30

Figure 4.20: Efficiency and output power versus PV voltage when vg = 150V.

Chapter 4. Converter Model and Control Strategy Verification

4.4

Summary

This chapter presented the validation of the mathematical steady-state, small- and largesignal models derived in Chapter 2. For such validation a switched model was developed using PLECS simulation environment and a converter prototype. This chapter also presented the validation the control strategy and current compensator design proposed in Charpter 3. Furthermore, a performance characterization was conducted by testing and documenting the conditions of the converter at various voltage levels and phase-shifts.

84

Chapter 5 Conclusions and Future Work
5.1 Conclusions

The overall aim of this thesis was to study and characterize a converter circuit topology for a 250-W single-phase grid-connected dc-ac converter for photovoltaic (PV) solar applications. The converter is based on the dual active bridge (DAB) kernel employing a series-resonant link and a high-frequency isolation stage. For interfacing with the host ac grid with the high frequency resonant circuit, the converter employs an ac-ac conversion stage utilizing a four-quadrant switch array. In Chapter 2, this thesis also presented a state-space averaged large-signal model of the converter. From the nonlinear model a steady-state and a linear small-signal models have been derived for the task of control design. In Chapter 3 a control strategy was proposed. The control strategy included a fast current-control loop to ensure ensure that the converter injects a sinusoidal current in phase with the grid voltage and a relatively slower feedback loop to regulate the converter dc-side voltage, that is, the PV array voltage, at the desired value. The proposed control strategy can integrate and be integrated with MPPT algorithms. Finally, in Chapter 4, the performance of the converter was assessed through simulation studies conducted using the aforementioned averaged models, a detailed topological model in the PLECS software environment, and a prototype. The general conclusions drawn from the studies reported in this thesis are:
 To simplify the issues related to modelling resonant converters, this thesis developed

an in-depth large-signal state-space model for PV converters based on the resonant dual active bridge converter topology using either SPS or DPS modulations.
 This thesis developed a linear small-signal model around an operating point to aid

85

Chapter 5. Conclusions and Future Work in the process of control design.
 Finally, a control strategy with voltage and current feedback loops was studied.

The current control regulates the power injected into the host ac-grid, while the voltage control loop regulates the voltage across the PV module and makes possible the implementation of MPPT algorithms.

5.2

Future Work

The following list enumerates potential research topics for a future work:
 The derivation of an extended mathematical model for a multi-port dual active

bridge based converter, for example the addition of battery storage port.
 The implementation of a digital control strategy.  The addition of a very fast control loop to regulate the resonant current zero-

crossing angle and extend the soft-switching range.

86

Appendix A Fundamental Frequency Fourier Coefficient of a Three-level Square Waveform
Given the periodic three-level square function f (t),    0       1   f (t) = 0      -1     0 Where, f (t) = a0 + a1 sin(t) + a2 sin(2t) + a3 sin(3t) sin(t) + ... Multiplying both sides by sin(t) and integrating over one period, (A.2) 0  t    < t <  -   -   t   +   +  < t < 2 -  2 -   t  2 (A.1)

2

2

f (t) sin(t)dt =
0 0

a0 sin(t) + a1 sin2 (t) + a2 sin(2t) sin(t) + ... dt (A.3)

 -



f (t) sin(t)dt = a1
 0

sin2 (t)dt

(A.4)

87

Chapter A. Fundamental Frequency Fourier Coefficient of a Three-level Square Wavef

- cos( -  ) + cos( ) = a1

 2

(A.5)

 2 Therefore, the coefficient of the first harmonic component is given by: 2 cos( ) = a1 a1 = 4 cos( ) 

(A.6)

(A.7)

88

Appendix B

Elements of State-Space Matrices

Given the non-linear state-space equations, with inputs , vg and ipv and outputs ig and vpv

dv dt dv dt di dt di dt dvpv dt dvout dt

= = = = = =

i - v  Cr i + v  Cr 1 4 nvpv cos() - vout - v - i R - i  Lr  1 4n - vpv sin() - v - i R + i  Lr  1 2n ipv - i cos() - i sin() Cin  1 2 i - ig Cout 

(B.1) (B.2) (B.3) (B.4) (B.5) (B.6)

The elements of the A and B matrices can be expressed as: 89

Chapter B. Elements of State-Space Matrices

a11 = a12 a13 a14 a15

 v =0 v  v = = - v  v 1 = = i Cr  v =0 = i  v = =0 vpv

(B.7) (B.8) (B.9) (B.10) (B.11)

a21 = a22 a23 a24 a25

v  = v v  = =0 v v  =0 = i v 1  = = i Cr   v = =0 vpv

(B.12) (B.13) (B.14) (B.15) (B.16)

a31 = a32 a33 a34 a35

 i 1 =- v Lr  i = =0 v  i R =- = i Lr  i = = - i 4n  i = = cos() vpv Lr

(B.17) (B.18) (B.19) (B.20) (B.21)

90

a41 = a42 a43 a44 a45

i  =0 v i  1 = =- v Lr   i = = i i  R = =- i Lr i  4n = =- sin() vpv Lr

(B.22) (B.23) (B.24) (B.25) (B.26)

a51 = a52 a53 a54 a55

 vpv  v  vpv  = v  vpv  = i  vpv  = i  vpv  = vpv

=0 =0 =- 2n cos() Lr 2n = sin() Lr =0

(B.27) (B.28) (B.29) (B.30) (B.31)

b 1 = b 2 b 3 b 4 b 5

 v =0  v  =0 =   i 4n = =- Vpv sin()  Lr i  4n = =- Vpv cos()  Lr  vpv  2n = = (Ai sin() + Bi cos())  Cin

(B.32) (B.33) (B.34) (B.35) (B.36)

91

Chapter B. Elements of State-Space Matrices

bv g 1 = bv g 2 bv g 3 bv g 4 bv g 5

 v =0 vg v  = =0 vg  i 4 = =- vg Lr i  =0 = vg  vpv  = =0 vg

(B.37) (B.38) (B.39) (B.40) (B.41)

bipv 1 = bipv 2 bipv 3 bipv 4 bipv 5

 v =0 ipv v  = =0 ipv  i = =0 ipv i  = =0 ipv  vpv  1 = =- ipv Cin

(B.42) (B.43) (B.44) (B.45) (B.46)

92

Appendix C Mathematical Model Extension for DPS Modulation
The dual active bridge (DAB) converter can be operated using the dual phase-shift (DPS) modulation strategy. In the DPS modulation, the inner legs of the input full-bridge is phase-shifted with an angle  producing a three-level square waveform at the terminals of the transformer. Furthermore, the input and output bridges are phase-shifted with an angle of  to control power flow. As analyzed in A, the fundamental frequency fourier coefficient of a three-level square waveform can be expressed as shown in Equation A.7. Therefore, an expression for the the first harmonic component of voltage v1 can be derived. v1  4 vpv cos(t + ) cos( )  (C.1)

Such expression yields for a new state-space large-scale model,

dv dt dv dt di dt di dt dvpv dt

= = = = =

i - v  Cr i + v  Cr 1 4n vpv cos() cos( ) - vout - v - i R - i  Lr  1 4n - vpv sin() sin( ) - v - i R + i  Lr  1 2n ipv - cos( ) i cos() - i sin() Cin  93

(C.2) (C.3) (C.4) (C.5) (C.6)

Chapter C. Mathematical Model Extension for DPS Modulation The steady-state model for the DAB converter under DSP modulation is shown in Equations (C.7)-(C.12).

4 (nVpv cos() cos() - Vout ) - Av - Ai R - Bi   4 - nVpv sin() sin() - Bv - Bi R + Ai   2n cos() [Ai cos() - Bi sin()] 0 = Ipv -  2 0 = Ig - Ai 

Ai Cr Bi 0= Cr 1 0= Lr 1 0= Lr 0=

- Bv  + Av 

(C.7) (C.8) (C.9) (C.10) (C.11) (C.12)

Given the control angles  and  , the inputs vg and ipv and outputs ig and vpv , the small-signal state-space equations of the system can be derived.

dx ~ ~ + Bv g v ~ ~ = Ax ~ + B  ~ g + Bipv ipv + B  dt ~ i ~ g = C ig x v~ ~ pv = Cvpv x

(C.13a) (C.13b) (C.13c)

The elements of the A, B , C and D matrices can be expressed as:

a11 = a12 a13 a14 a15

 v =0 v  v = = - v  v 1 = = i Cr  v = =0 i  v = =0 vpv 94

(C.14) (C.15) (C.16) (C.17) (C.18)

a21 = a22 a23 a24 a25

v  = v v  = =0 v v  =0 = i v  1 = = i Cr v  = =0 vpv

(C.19) (C.20) (C.21) (C.22) (C.23)

a31 = a32 a33 a34 a35

 i 1 =- v Lr  i = =0 v  i R = =- i Lr  i = = - i  i 4n = = cos() cos() vpv Lr

(C.24) (C.25) (C.26) (C.27) (C.28)

a41 = a42 a43 a44 a45

i  =0 v i  1 = =- v Lr   i = = i i  R = =- i Lr i  4n = =- sin() sin() vpv Lr

(C.29) (C.30) (C.31) (C.32) (C.33)

95

Chapter C. Mathematical Model Extension for DPS Modulation a51 = a52 a53 a54 a55  vpv  v  vpv  = v  vpv  = i  vpv  = i  vpv  = vpv =0 =0 2n cos() cos() Lr 2n = sin() cos() Lr =- =0 (C.34) (C.35) (C.36) (C.37) (C.38)

b 1 = b 2 b 3 b 4 b 5

 v =0  v  = =0   i 4n = Vpv sin() =-  Lr i 4n  =- = Vpv cos()  Lr 2n  vpv  = = (Ai sin() + Bi cos())  Cin

(C.39) (C.40) (C.41) (C.42) (C.43)

bv g 1 = bv g 2 bv g 3 bv g 4 bv g 5

 v =0 vg v  = =0 vg  i 4 = =- vg Lr i  = =0 vg  vpv  = =0 vg 96

(C.44) (C.45) (C.46) (C.47) (C.48)

bipv 1 = bipv 2 bipv 3 bipv 4 bipv 5

 v =0 ipv v  = =0 ipv  i = =0 ipv i  =0 = ipv  vpv  1 = =- ipv Cin

(C.49) (C.50) (C.51) (C.52) (C.53)

b 1 = b 2 b 3 b 4 b 5

 v =0  v  = =0   i 4n = =- Vpv cos() sin()  Lr i  4n = =- Vpv sin() cos()  Lr 2n  vpv  = sin() (Ai cos() - Bi sin()) =  Cin

(C.54) (C.55) (C.56) (C.57) (C.58)

CV pv = 0 0 0 0 1 2 0 0 

(C.59)

CIg = 0 0

(C.60)

D= 0

(C.61)

97

Chapter C. Mathematical Model Extension for DPS Modulation To simplify the power flow control of the converter under DSP modulation sing the  control variable, the voltage conversion ratio, d can be regulated closer to unity by controlling the phase-shift,  to provide soft-switching operation. d= Since, d1 then, 4 4 v2  nv1 cos( )   Solving for  ,   arccos v2 nv1 , 0  | |   2 (C.63) Vout nVin (C.62)

98

Appendix D Mathematical Model Extension for Converter Rectifier Operation with Resistive Load under SPS Modulation
Given that

dx ~ ~ + Bv g v ~ = Ax ~ + B  ~ g + Bipv ipv dt v~ ~ pv = Cvpv x where,   ~v ~  v    x ~= ~i    ~  i  v~ pv and 

(D.1a) (D.1b)

(D.2)

CV pv = 0 0 0 0 1 99

(D.3)

Chapter D. Mathematical Model Extension for Converter Rectifier Operation with Re Therefore, v~ ~ pv = Cvpv x = 0 0 0 0 1 x ~ If the converter is loaded with a resistor Rl in its dc port, (D.4) (D.5)

v~ pv i~ pv = - Rl = 0 0 0 0 - Then, 1 dx ~ ~ + Bv g v = Ax ~ + B  ~ x ~ g + Bipv 0 0 0 0 - Rl dt dx ~ = dt A + Bipv 0 0 0 0 -
Anew

(D.6) 1 x ~ Rl (D.7)

(D.8)

1 Rl

~ + Bv g v ~ x ~ + B  g + Bipv

(D.9)

Therefore, the small-signal model for the system with a resistive load in the dc port is dx ~ ~ + Bv g v = Anew x ~ + B  ~ g dt where,  0  0   0 =A+  0   0  0  0    0   0   1  0 0 0 - Rl Cpv 0 0 0 0 0 0 0 0 0 0 0 0 (D.10)

Anew

(D.11)

100

Appendix E MATLAB Scripts for Mathemathical Model

101

Chapter E. MATLAB Scripts for Mathemathical Model

%% Select Phase-Shift %PHI = 0.7854 % PHI = 0.610865; PHI = 0.5759586; % PHI = 0.5585053; %PHI = 0.54105; %PHI = 0.5236 %PHI = 0.43633; %PHI = 0.358098; %PHI = 0.355253; %PHI = 0.349; %PHI = 0.2618; % 45 Deg % 35 Deg % 33 Deg % 32 Deg % 31 Deg % 30 Deg % 25 Deg % 20.5175 Deg % 20.3545 Deg % 20 Deg % 15 Deg

%% Converter Specifications n = 7; F_S = 78000; OMEGA_S = 2*pi*F_S; R = 2.4e-3*(n^2)*2+4*56e-3; Cpv = 27e-3; Lr = 380e-6; Cr = 15e-9; %% Converter Inputs I_PV = 5; V_G = 80; v_g = sqrt(2)* 120;

% Turns ratio % Switching Frequency % Equivalent Resistance % Power Decoupling Capacitor % Resonant Inductor % Resonant Capacitor

% PV Current % Grid Voltage % Grid Peak Voltage

%% Solve State Variables at Steady-State Condition % Call fsolve funtion to solve for Av, Bv, Ai, Bi, Vpv and Ig for the converter % inputs fun = @AltSteadyState; x0 = [350,100,0.2,-2.6,20,1]; options = optimoptions('fsolve','MaxFunEvals', 100000000, 'MaxIter', 100000000); x = fsolve(fun,x0,options); A_V = x(1); B_V = x(2); A_I = x(3); B_I = x(4); V_PV = x(5) I_G = x(6) % Calculate the magnitude and phase of the resonant quantities Vr and Ir I_R = sqrt(A_I^2+B_I^2) PHI_I = atan2d(-B_I,A_I); V_R = sqrt(A_V^2+B_V^2) PHI_V = atan2d(-B_V,A_V);

102

%% Compute Small-Signal Model % A and B matrices entries a11 = 0; a12 = -OMEGA_S; a13 = 1/Cr; a14 = 0; a15 = 0; a21 a22 a23 a24 a25 a31 a32 a33 a34 a35 a41 a42 a43 a44 a45 a51 a52 a53 a54 a55 = = = = = = = = = = = = = = = = = = = = OMEGA_S; 0; 0; 1/Cr; 0; -1/Lr; 0; -R/Lr; -OMEGA_S; 4*n/(pi*Lr) * cos(PHI); 0; -1/Lr; OMEGA_S; -R/Lr; -4*n/(pi*Lr) * sin(PHI); 0; 0; -2*n/(pi*Cpv) * cos(PHI); 2*n/(pi*Cpv) * sin(PHI); 0; a12 a22 a32 a42 a52 a13 a23 a33 a43 a53 a14 a24 a34 a44 a54 a15; a25; a35; a45; a55];

A = [a11 a21 a31 a41 a51

lambda = eig(A); b1 b2 b3 b4 b5 = = = = = 0; 0; -4*n/(pi*Lr) * V_PV * sin(PHI); -4*n/(pi*Lr) * V_PV * cos(PHI); -2*n/(pi*Cpv) * (-A_I*sin(PHI) - B_I*cos(PHI));

B = [b1; b2; b3; b4; b5]; D = 0; Pin = V_PV*I_PV Pout = I_G*V_G

103

Chapter E. MATLAB Scripts for Mathemathical Model

%% Phi to Vpv Transfer Function C_Vpv = [0 0 0 0 1]; g_vp = ss(A,B,C_Vpv,D); [g_vpnum,g_vpden] = ss2tf(A,B,C_Vpv,D); G_VP = tf(g_vpnum,g_vpden); G_VP = zpk(G_VP) %% Generate Graphs % Graph Options opts = bodeoptions; opts.PhaseWrapping = 'on'; opts.PhaseMatching = 'off'; opts.Title.Interpreter = 'latex'; opts.XLabel.Interpreter = 'latex'; opts.YLabel.Interpreter = 'latex'; opts.Title.FontSize = 12; opts.XLabel.FontSize = 10; opts.YLabel.FontSize = 10; opts.XLabel.String = 'Frequency'; opts.Grid = 'on'; opt = nyquistoptions('cstprefs'); opt.Title.Interpreter = 'latex'; opt.XLabel.Interpreter = 'latex'; opt.YLabel.Interpreter = 'latex'; opt.Title.FontSize = 12; opt.XLabel.FontSize = 10; opt.YLabel.FontSize = 10; opt.Grid = 'on'; opt.XLabel.String = 'Real'; opt.YLabel.String = 'Imaginary'; opt.FreqUnits = 'rad/s'; op = timeoptions('cstprefs'); op.Title.Interpreter = 'latex'; op.XLabel.Interpreter = 'latex'; op.YLabel.Interpreter = 'latex'; % % % % figure(1) opt.Title.String = 'Zero-Pole Map for $G_{\phi v_{pv}}$'; pzplot(G_VP,opt) sgrid

figure(2) opts.Title.String = 'Bode Plot for $G_{\phi v_{pv}}(s)$'; bodeplot(G_VP,opts); saveas(gcf,'BodeG_VP1','epsc'); % % % % % figure(3) opts.Title.String = 'Bode Plot for $G_{\phi v_{pv}}(s)$'; bodeplot(G_VP,opts); xlim([1e4 10e6]); saveas(gcf,'BodeG_VP2','epsc');

104

%% Phi to Ig Transfer Function C_Ig = [0 0 2/pi 0 0]; g_ig = ss(A,B,C_Ig,D); [g_ignum,g_igden] = ss2tf(A,B,C_Ig,D); G_IG = tf(g_ignum,g_igden); G_IG = zpk(G_IG) figure(4) opt.Title.String = 'Zero-Pole Map for $G_{\phi i_{g}}$'; pzplot(G_IG,opt) sgrid figure(5) opts.Title.String = 'Bode Plot for $G_{\phi i_{g}}(s)$'; bode(G_IG,opts) saveas(gcf,'BodeG_IG1','epsc') figure(6) opts.Title.String = 'Bode Plot for $G_{\phi i_{g}}(s)$'; bode(G_IG,opts); xlim([1e4 10e6]); saveas(gcf,'BodeG_IG2','epsc') %% Vr magnitude to Phi Transfer Function C_av = [1 0 0 0 0]; C_bv = [0 1 0 0 0]; C_vr = C_av * A_V/sqrt(A_V^2+B_V^2) + C_bv * B_V/sqrt(A_V^2+B_V^2); g_vr = ss(A,B,C_vr,D); [g_vrnum,g_vrden] = ss2tf(A,B,C_vr,D); G_VR = tf(g_vrnum,g_vrden); %% Ir magnitude to Phi Transfer Function C_ai = [0 0 1 0 0]; C_bi = [0 0 0 1 0]; C_ir = C_ai * A_I/sqrt(A_I^2+B_I^2) + C_bi * B_I/sqrt(A_I^2+B_I^2); g_ir = ss(A,B,C_ai,D); [g_irnum,g_irden] = ss2tf(A,B,C_ir,D); G_IR = tf(g_irnum,g_irden);

105

Chapter E. MATLAB Scripts for Mathemathical Model

%% Vpv to Ig Transfer Function G_VI = G_IG/G_VP figure(7); opts.Title.String = 'Bode Plot for $G_{v_{pv} i_{g}}(s)$'; bode(G_VI,opts) saveas(gcf,'BodeG_VI1','epsc'); figure(8); opts.Title.String = 'Bode Plot for $G_{v_{pv} i_{g}}(s)$'; bode(G_VI,opts); xlim([1e4 10e6]); saveas(gcf,'BodeG_VI2','epsc'); %% Current Compensator C_Inum_new = [600e-9 1]; C_Iden_new = [68e-6 1 0]; C_I = tf(6500*C_Inum_new, C_Iden_new) figure(9); opts.Title.String = 'Bode Plot for $K_{i}(s)$'; bode(C_I,opts); xlim([1e3 10e6]); saveas(gcf,'BodeKi','epsc'); %% Open- and Closed-Loop Graphas for Current Loop L_i = C_I * G_IR; figure(10); opts.Title.String = 'Bode Plot for $L_i(s)$'; bode(L_i,opts); xlim([1e3 10e4]); saveas(gcf,'BodeLi','epsc');

T_i = feedback(G_IR*C_I,1) figure(11); opts.Title.String = 'Bode Plot for $T_i(s)$'; bode(T_i,opts); xlim([1e3 10e6]); saveas(gcf,'BodeTi','epsc'); figure(12); op.Title.String = 'Step Response for $T_i(s)$'; stepplot(T_i,op); % xlim([0 2.5e-3]); saveas(gcf,'StepTi','epsc'); figure(13); opt.Title.String = 'Nyquist Plot for $T_i(s)$'; nyquistplot(T_i,opt); saveas(gcf,'NyquistTi','epsc');

106

function F = AltSteadyState(x) n = 7; F_S = 78000; OMEGA_S = 2*pi*F_S;

%PHI = 0.7854 % PHI = 0.610865; PHI = 0.5759586; % PHI = 0.5585053; % PHI = 0.54105; %PHI = 0.5236 %PHI = 0.43633; %PHI = 0.349; %PHI = 0.358098; %PHI = 0.355253; %PHI = 0.2618; I_PV = 5; V_G = 80; Cpv = 27e-3;

% 45 Deg % 35 Deg % 33 Deg % 32 Deg % 31 Deg % 30 Deg % 25 Deg % 20 Deg % 20.5175 Deg % 20.3545 Deg % 15 Deg

R = 2.4e-3*(n^2)*2+4*56e-3; Lr = 380e-6; Cr = 15e-9; %% FOR Lr F(1) = x(3)/Cr - x(2)*OMEGA_S; F(2) = x(4)/Cr + x(1)*OMEGA_S; F(3) = 1/Lr * (4/pi * (x(5)*n*cos(PHI) - V_G) - x(1) - x(3)*R) - x(4)*OMEGA_S; F(4) = 1/Lr * (-4/pi * x(5)*n*sin(PHI) - x(2) - x(4)*R) + x(3)*OMEGA_S; F(5) = I_PV - (2*n)/pi * (x(3)*cos(PHI) - x(4)*sin(PHI)); F(6) = x(6) - 2/pi * x(3); end

107

Bibliography
[1] "Global market outlook for solar power 2017-2021," SolarPower Europe, Tech. Rep., 2017. [2] "Trends 2017 in photovoltaic applications," International Energy Agency (IEA) Photovoltaic Power System Programme (PVPS), Tech. Rep., 2017. [3] "National survey report of pv power applications in canada," International Energy Agency (IEA) Photovoltaic Power System Programme (PVPS), Tech. Rep., 2016. [4] J. Beristain, J. Bordonau, A. Gilabert, and G. Velasco, "Synthesis and modulation of a single phase dc/ac converter with high-frequency isolation in photovoltaic energy applications," in Power Electronics Specialist Conference, 2003. PESC '03. 2003 IEEE 34th Annual, vol. 3, June 2003, pp. 1191­1196 vol.3. [5] J. Beristain, J. Bordonau, G. A, and S. Alepuz, "A new ac/ac multilevel converter for a single-phase inverter with hf isolation," in 2004 IEEE 35th Annual Power Electronics Specialists Conference (IEEE Cat. No.04CH37551), vol. 3, June 2004, pp. 1998­2004 Vol.3. [6] H. Krishnaswami, "Photovoltaic microinverter using single-stage isolated highfrequency link series resonant topology," in 2011 IEEE Energy Conversion Congress and Exposition, Sept 2011, pp. 495­500. [7] D. R. Nayanasiri, D. M. Vilathgamuwa, and D. L. Maskell, "Half-wave cycloconverter-based photovoltaic microinverter topology with phase-shift power modulation," IEEE Transactions on Power Electronics, vol. 28, no. 6, pp. 2700­ 2710, June 2013. [8] A. Trubitsyn, B. J. Pierquet, A. K. Hayman, G. E. Gamache, C. R. Sullivan, and D. J. Perreault, "High-efficiency inverter for photovoltaic applications," in 2010 IEEE Energy Conversion Congress and Exposition, Sept 2010, pp. 2803­2810. 108

BIBLIOGRAPHY [9] A. K. Hayman, "Development of a high-efficiency solar micro-inverter," Master's thesis, Massachusetts Institute of Technology, Cambridge, MA, 2009. [10] A. Trubitsyn, "High efficiency dc/ac power converter for photovoltaic applications," Master's thesis, Massachusetts Institute of Technology, Cambridge, MA, 2010. [11] M. N. Kheraluwala, R. W. Gascoigne, D. M. Divan, and E. D. Baumann, "Performance characterization of a high-power dual active bridge dc-to-dc converter," IEEE Transactions on Industry Applications, vol. 28, no. 6, pp. 1294­1301, Nov 1992. [12] G. Oggier, G. O. Garc´ ia, and A. R. Oliva, "Modulation strategy to operate the dual active bridge dc-dc converter under soft switching in the whole operating range," IEEE Transactions on Power Electronics, vol. 26, no. 4, pp. 1228­1236, April 2011. [13] C. Solar. Canadian solar datasheet cs6p. [Online]. Available: https://www.canadiansolar.com/downloads/datasheets/na/Canadian Solar-Datasheet-CS6PP Quartech-v5.3 na.pdf [14] F. Blaabjerg, Z. Chen, and S. B. Kjaer, "Power electronics as efficient interface in dispersed power generation systems," IEEE Transactions on Power Electronics, vol. 19, no. 5, pp. 1184­1194, Sept 2004. [15] O. M. of Energy. Fit and microfit program. [Online]. Available: //www.energy.gov.on.ca/en/fit-and-microfit-program/ http:

[16] Enphase. Enphase microinverters. [Online]. Available: https://enphase.com/en-us/ products-and-services/microinverters/family [17] Enecsys. Enphase products. [Online]. Available: products/ http://www.enecsys.com/

[18] Y. Tian, Z. Chen, F. Deng, X. Sun, and Y. Hu, "Active power and dc voltage coordinative control for cascaded dc ac converter with bidirectional power application," IEEE Transactions on Power Electronics, vol. 30, no. 10, pp. 5911­5925, Oct 2015. [19] H. J. Chiu, Y. K. Lo, C. Y. Yang, S. J. Cheng, C. M. Huang, C. C. Chuang, M. C. Kuo, Y. M. Huang, Y. B. Jean, and Y. C. Huang, "A module-integrated isolated solar microinverter," IEEE Transactions on Industrial Electronics, vol. 60, no. 2, pp. 781­788, Feb 2013. 109

BIBLIOGRAPHY [20] S. Jiang, D. Cao, Y. Li, and F. Z. Peng, "Grid-connected boost-half-bridge photovoltaic microinverter system using repetitive current control and maximum power point tracking," IEEE Transactions on Power Electronics, vol. 27, no. 11, pp. 4711­ 4722, Nov 2012. [21] H. Hu, S. Harb, N. H. Kutkut, Z. J. Shen, and I. Batarseh, "A single-stage microinverter without using eletrolytic capacitors," IEEE Transactions on Power Electronics, vol. 28, no. 6, pp. 2677­2687, June 2013. ¨ urk and I. C [22] S. Ozt¨ ¸ adirci, "A generalized and flexible control scheme for photovoltaic grid-tie microinverters," IEEE Transactions on Industry Applications, vol. 54, no. 1, pp. 505­516, Jan 2018. [23] K. Vangen, T. Melaa, and A. K. Adnanes, "Soft-switched high-frequency, high power dc/ac converter with igbt," in Power Electronics Specialists Conference, 1992. PESC '92 Record., 23rd Annual IEEE, Jun 1992, pp. 26­33 vol.1. [24] D. R. Nayanasiri, D. M. Vilathgamuwa, and D. L. Maskell, "Current-controlled resonant circuit based photovoltaic micro-inverter with half- wave cycloconverter," in 2013 IEEE Industry Applications Society Annual Meeting, Oct 2013, pp. 1­6. [25] ----, "Photovoltaic micro-inverter with front-end dc-dc converter and half-wave cycloconverter," in 2013 IEEE ECCE Asia Downunder, June 2013, pp. 80­85. [26] ----, "Hfl micro inverter with front-end diode clamped multi-level inverter and halfwave cycloconverter," in 2014 IEEE 23rd International Symposium on Industrial Electronics (ISIE), June 2014, pp. 503­508. [27] A. Aganza-Torres, V. Cardenas, and M. Pacas, "Simple instantaneous power modulation scheme for single-phase high-frequency link microinverter for low-power pv applications," in 2015 IEEE Applied Power Electronics Conference and Exposition (APEC), March 2015, pp. 199­204. [28] B. J. Pierquet and D. J. Perreault, "A single-phase photovoltaic inverter topology with a series-connected energy buffer," IEEE Transactions on Power Electronics, vol. 28, no. 10, pp. 4603­4611, Oct 2013. [29] M. Chen, K. K. Afridi, and D. J. Perreault, "A multilevel energy buffer and voltage modulator for grid-interfaced microinverters," IEEE Transactions on Power Electronics, vol. 30, no. 3, pp. 1203­1219, March 2015. 110

BIBLIOGRAPHY [30] B. J. Pierquet, "Designs for ultra-high efficiency grid-connected power conversion," Ph.D. dissertation, Massachusetts Institute of Technology, Cambridge, MA, 2011. [31] R. W. D. Doncker, D. M. Divan, and M. H. Kheraluwala, "A three-phase softswitched high power density dc/dc converter for high power applications," in Conference Record of the 1988 IEEE Industry Applications Society Annual Meeting, Oct 1988, pp. 796­805 vol.1. [32] H. Bai and C. Mi, "Eliminate reactive power and increase system efficiency of isolated bidirectional dual-active-bridge dc-dc converters using novel dual-phase-shift control," IEEE Transactions on Power Electronics, vol. 23, no. 6, pp. 2905­2914, Nov 2008. [33] ----, "Correction to "eliminate reactive power and increase system efficiency of isolated bidirectional dual-active-bridge dc-dc converters using novel dual-phaseshift control" [nov 08 2905-2914]," IEEE Transactions on Power Electronics, vol. 27, no. 9, pp. 4177­4177, Sept 2012. [34] G. G. Oggier, G. O. Garc´ ia, and A. R. Oliva, "Switching control strategy to minimize dual active bridge converter losses," IEEE Transactions on Power Electronics, vol. 24, no. 7, pp. 1826­1838, July 2009. [35] J. Everts, F. Krismer, J. V. den Keybus, J. Driesen, and J. W. Kolar, "Optimal zvs modulation of single-phase single-stage bidirectional dab ac dc converters," IEEE Transactions on Power Electronics, vol. 29, no. 8, pp. 3954­3970, Aug 2014. [36] G. Ortiz, H. Uemura, D. Bortis, J. W. Kolar, and O. Apeldoorn, "Modeling of soft-switching losses of igbts in high-power high-efficiency dual-active-bridge dc/dc converters," IEEE Transactions on Electron Devices, vol. 60, no. 2, pp. 587­597, Feb 2013. [37] Z. Shen, R. Burgos, D. Boroyevich, and F. Wang, "Soft-switching capability analysis of a dual active bridge dc-dc converter," in 2009 IEEE Electric Ship Technologies Symposium, April 2009, pp. 334­339. [38] J. G Kassakian, M. F Schlecht, and G. Verghese, Principles of Power Electronics. Reading, MA: Pearson Education (US), 1991. [39] R. D. Middlebrook and S. Cuk, "A general unified approach to modelling switchingconverter power stages," in 1976 IEEE Power Electronics Specialists Conference, June 1976, pp. 18­34. 111

BIBLIOGRAPHY [40] S. R. Sanders, J. M. Noworolski, X. Z. Liu, and G. C. Verghese, "Generalized averaging method for power conversion circuits," IEEE Transactions on Power Electronics, vol. 6, no. 2, pp. 251­259, Apr 1991. [41] J. Sun and H. Grotstollen, "Averaged modelling of switching power converters: reformulation and theoretical basis," in Power Electronics Specialists Conference, 1992. PESC '92 Record., 23rd Annual IEEE, Jun 1992, pp. 1165­1172 vol.2. [42] ----, "Averaged modeling and analysis of resonant converters," in Power Electronics Specialists Conference, 1993. PESC '93 Record., 24th Annual IEEE, Jun 1993, pp. 707­713. [43] ----, "Symbolic analysis methods for averaged modeling of switching power converters," IEEE Transactions on Power Electronics, vol. 12, no. 3, pp. 537­546, May 1997. [44] D. Maksimovic, A. M. Stankovic, V. J. Thottuvelil, and G. C. Verghese, "Modeling and simulation of power electronic converters," Proceedings of the IEEE, vol. 89, no. 6, pp. 898­912, Jun 2001. [45] G. C. Verghese, M. E. Elbuluk, and J. G. Kassakian, "A general approach to sampled-data modeling for power electronic circuits," IEEE Transactions on Power Electronics, vol. PE-1, no. 2, pp. 76­89, April 1986. [46] G. W. Wester and R. D. Middlebrook, "Low-frequency characterization of switched dc-dc converters," IEEE Transactions on Aerospace and Electronic Systems, vol. AES-9, no. 3, pp. 376­385, May 1973. [47] B. van der Pol Jun. D.Sc., "Vii. forced oscillations in a circuit with non-linear resistance. (reception with reactive triode)," The London, Edinburgh, and Dublin Philosophical Magazine and Journal of Science, vol. 3, no. 13, pp. 65­80, 1927. [Online]. Available: https://doi.org/10.1080/14786440108564176 [48] A. H. Mitwalli, S. B. Leeb, G. C. Verghese, and V. J. Thottuvelil, "An adaptive digital controller for a unity power factor converter," IEEE Transactions on Power Electronics, vol. 11, no. 2, pp. 374­382, Mar 1996. [49] K. Ogata, Modern Control Engineering, 5th ed. USA: Pearson Education, Inc, 2010. 112 Upper Saddle River, New Jersey,

BIBLIOGRAPHY [50] Plexim. Plecs, simulation software for power electronics. [Online]. Available: https://www.plexim.com/

113

