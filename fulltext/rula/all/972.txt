Ryerson University

Digital Commons @ Ryerson
Theses and dissertations

1-1-2007

A thermal dose controller for laser interstitial thermal therapy
Madhu Jain
Ryerson University, m2jain@ryerson.ca

Follow this and additional works at: http://digitalcommons.ryerson.ca/dissertations Part of the Electrical and Computer Engineering Commons Recommended Citation
Jain, Madhu, "A thermal dose controller for laser interstitial thermal therapy" (2007). Theses and dissertations. Paper 580.

This Thesis is brought to you for free and open access by Digital Commons @ Ryerson. It has been accepted for inclusion in Theses and dissertations by an authorized administrator of Digital Commons @ Ryerson. For more information, please contact bcameron@ryerson.ca.

A THERMAL DOSE CONTROLLER FOR LASER INTERSTITIAL THERMAL THERAPY

by

Madhu Jain B.Tech (Hons.), Punjab Technical University, India, 2003

A thesis presented to Ryerson University in partial fulfillment of the requirements for the degree of Master of Applied Science in the Program of Electrical and Computer Engineering

Toronto, Ontario, Canada, 2007

Copyright © by Madhu Jain 2007

I hereby declare that I am the sole author of this thesis. I authorize Ryerson University to lend this thesis to other institutions or individuals for the purpose of scholarly research.

MADHU JAIN

I further authorize Ryerson University to reproduce this thesis by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

MADHU JAIN

ii

Abstract

A Thermal Dose Controller for Laser Interstitial Thermal Therapy
Madhu Jain, B.Tech (Hons.) MASc., Electrical and Computer Engineering, Ryerson University, 2007

Laser Interstitial Thermal Therapy (LITT) is a minimally invasive technique for destroying localized solid tumors by heating with light. An obstacle to widespread clinical adoption of LITT is the lack of adequate control of heating of surrounding healthy tissue and prevention of tissue and fiber-tip charring. An LITT thermal dose controller was developed to address these issues. The goal of the controller is to deliver prescribed thermal dose at a target location in tissue in a preset treatment times. The developed feedback controller has a cascade structure with primary thermal dose control loop continuously generating the reference temperature for the secondary, constrained, model predictive temperature controller. The performance of controller was evaluated in simulated linear and non-linear tissue models and in albumen phantoms. The control system demonstrated the ability to achieve treatment goals across all evaluation models by delivering 240 eq. min dose at 5 mm in various preset treatment times.

iii

Acknowledgments
I am very grateful for the valuable guidance and support of my mentors, Dr. William M. Whelan and Dr. J. Carl Kumaradas. It was a pleasant learning experience to complete my MASc thesis project under their guidance. Dr. Whelan's passion for physics and exceptional knowledge of the subject coupled with his way of teaching through intellectual discussions deserve a special mention. I cannot thank enough Dr. Kumaradas, who always kept me on track by guiding me to focus on big picture right from the beginning. His constant feedback and suggestions has helped me in polishing my professional, personal and technical skills to a great extent and prepared me for future challenges. I think being mentored by him was the best thing that could happen to my thesis and me. Thanks Bill and Carl for giving me an opportunity to be a part of your lab!

A big note of thanks goes to Dr. Farrokh Sharifi, my supervisory committee member, who kept an eye on the progress on my work and provided me with invaluable ideas and suggestions regarding control aspects of this project during our meetings. This work could not have been possible without his support. I would like to thank Dr. Michael Kolios for being available for discussions and Dr. Pedro Goldman for his words of encouragement. I am grateful to Arthur Worthington for his tremendous help in building my experimental set-up. I would also like to thank Sean Davidson and Lee Chin from PMH/OCI for answering my infinite questions regarding laser-tissue interaction.

I would like to thank all my Ryerson friends and specially "east' side and "west" side lab mates: Omar for his timely advice, Ahmed for being my neighbor and always keeping things sanely philosophical, Ellie for cheering me up during my difficult times, Robin for his quick-witted and humorous conversations and Rachel for being so caring. I also want to thank medical physics lab alumni: Neeta Parmar, Marjan (my squash partner) and Gajani. My special appreciation goes to Sajan Abdul for always being available to discuss the control theory.

I want to thank my family for celebrating my good times and supporting me in my difficult times. Thanks Mom for serving me delicious meals and always giving me a big hug whenever I came home after a long day of work. Thanks Dad for bringing me up with so much dedication and filling my life with sweet surprises. Your encouraging words, enthusiasm and optimistic attitude towards life make me a stronger and a better person everyday. Finally, I want to thank my brother, Gaurav, for keeping my neuro-cells active through intelligent discussions and for pulling off many all-nighters with me during my thesis! Love you all!

iv

TABLE OF CONTENTS
ACKNOWLEDGMENTS....................................................................................................................IV CHAPTER 1- INTRODUCTION .......................................................................................................... 1 1.1 1.1.1 1.1.2 1.2 1.2.1 1.3 1.4 1.5 LASER INTERSTITIAL THERMAL THERAPY .................................................... 1 LITT - A Minimally Invasive Thermal Therapy ................................................. 1 Physics of laser-tissue interaction........................................................................ 1 CLINICAL EXPERIENCE......................................................................................... 3 Clinical goals ....................................................................................................... 5 CURRENT TREATMENT MONITORING TECHNIQUES .................................... 6 CURRENT CONTROL SCHEMES........................................................................... 7 SUMMARY.............................................................................................................. 11

CHAPTER 2 - THEORY ..................................................................................................................... 12 2.1 2.2 2.2.1 2.2.2 2.3 2.3.1 2.3.2 2.3.3 2.4 2.5 2.6 2.7 2.7.1 2.7.2 2.8 CONTROL OF THERMAL DOSE ­ A NON-LINEAR PROBLEM...................... 12 CONTROLLER ARCHITECTURE......................................................................... 12 Primary Thermal Dose control loop operation .................................................. 13 Secondary temperature control loop operation.................................................. 14 MODELING OF LASER-IRRADIATED TISSUE ................................................. 14 Light distribution model .................................................................................... 15 Bio-heat transfer model ..................................................................................... 17 Damage model................................................................................................... 19 UNCERTAINTY ANALYSIS AND SENSITIVITY ANALYSIS.......................... 20 STATE-SPACE FORMULATION OF LITT MODEL ........................................... 22 KALMAN ESTIMATOR ......................................................................................... 27 MODEL PREDICTIVE CONTROL OF LITT......................................................... 31 Formulation of Prediction Model ...................................................................... 33 Formulation of Objective (Cost) Function ........................................................ 33 SUMMARY.............................................................................................................. 34

CHAPTER 3 - MATERIALS AND METHODS................................................................................. 35 3.1 3.2 LITT CONTROLLER OBJECTIVES ...................................................................... 35 SYSTEM PERFORMANCE EVALUATION CRITERIA ...................................... 36

v

3.3 3.3.1 3.3.2 3.3.3 3.3.4 3.4 3.4.1

EXPERIMENTAL EQUIPMENT FOR CONTROLLER EVALUATION ............. 36 LITT Feedback control system.......................................................................... 36 Laser .................................................................................................................. 38 Temperature measurement unit ......................................................................... 38 Selection of temperature and laser power update interval................................. 39 CONTROLLER EVALUATION ............................................................................. 41 Simulated tissue model with constant optical properties and blood

perfusion rate...................................................................................................................... 41 3.4.2 Simulated tissue model with dynamic optical properties and blood......

perfusion rate...................................................................................................................... 44 3.4.3 Tissue equivalent albumen phantom ................................................................. 47

CHAPTER 4 - RESULTS AND DISCUSSION .................................................................................. 51 4.1 4.1.1 4.1.2 4.1.3 4.1.4 4.1.5 4.1.6 4.2 4.2.1 4.2.2 RESULTS ................................................................................................................. 51 Uncertainty Analysis ......................................................................................... 51 Sensitivity Analysis ........................................................................................... 55 Simulation results of Kalman Estimator............................................................ 56 Simulated control of tissue with static properties.............................................. 57 Simulated control of tissue with dynamic tissue properties .............................. 64 Evaluation of controller in albumen phantom ................................................... 70 DISCUSSION ........................................................................................................... 78 Evaluation of the performance of thermal dose LITT controller....................... 78 Evaluation of current set up of LITT controller ................................................ 84

CHAPTER 5 ­ SUMMARY, CONCLUSION AND FUTURE WORK ............................................. 87 5.1 5.2 5.3 SUMMARY.............................................................................................................. 87 CONCLUSION......................................................................................................... 88 FUTURE WORK...................................................................................................... 89

APPENDIX A ...................................................................................................................................... 90 BIBLIOGRAPHY .............................................................................................................................. 100

vi

LIST OF TABLES
Table 1.1 Biological response of tissue to rise in temperature due to laser light interaction with tissue................3 Table 1.2 Comparison of different image monitoring and point monitoring techniques........................................7 Table 2.1 Parameters used to perform UA and SA...............................................................................................21 Table 2.2 Model parameters ................................................................................................................................30 Table 2.3 Kalman Estimator parameters ..............................................................................................................30 Table 3.1Simulated tissue model and treatment parameters for evaluation of LITT controller ...........................43 Table 3.2 Ingredients of albumen phantom used in the study based on the absorption of the dye solution 5.9 cm1

at 810 nm. ..................................................................................................................................................47

Table 3.3 The native and coagulative optical properties of albumen phantom used in the study (Iizuka et al, 1999)............................................................................................................................................................48 Table 3.4 Treatment parameters for the evaluation of controller in albumen experiments. .................................50 Table 4.1 Data on the performance evaluation of the LITT controller for various parametric mismatch cases;

t preset = 3min, tt = 5 min. The radius of coagulation was measured from the edge of the source fiber.......62
Table 4.2 Summary of the performance evaluation of the LITT controller with preset treatment times of 3 min., 5 min., 7 min.;

tcooling = 2 min. for all the cases. .........................................................................................68

Table 4.3 Data and statistics on the performance evaluation of LITT controller in the albumen phantom experiments. The radius of coagulation was measured from the edge of the source fiber and total treatment duration,

tt = 20 min. for all the cases. ........................................................................................................75

vii

LIST OF FIGURES
Figure 1.1 Coagulation lesion of 3.6 cm by 2.6 cm in ex vivo pig liver after 6 min. of treatment using 6W laser power and 2 cm cylindrical diffuser tip (adapted from Heisterkamp et al, 1999) .........................................3 Figure 2.1 Block diagram of feedback thermal dose controller; LITT system consists of a laser, a patient and a thermometry system.....................................................................................................................................13 Figure 2.2 Block diagram describing the non-linear process of LITT. The dynamic properties of tissue are a function of thermal dose. .............................................................................................................................15 Figure 2.3 An illustration of heat generated or absorbed in small volume dV, transported in tissue volume V by conduction and convection, stored in V, and exchanged over A (adapted from Welch & van Gemert, 1995))...........................................................................................................................................................17 Figure 2.4 The above graph shows that the time of exposure required for delivering constant thermal dose of 240 eq. min. increases by 4 folds for each degree drop in temperature below 43o C and decreases by 2 folds for each degree rise above 43o C. ........................................................................................................19 Figure 2.5 a) Diagrammatic representation of 1-D cylindrical geometry for homogenous tissue properties; r = radius of computational domain; ro = radius of light source fiber b) A rectangular domain discretized in space and time using N points. ....................................................................................................................23 Figure 2.6 Feedback operation of Kalman filter for estimating the true temperature by using prediction and correction strategy {adapted from (Welch & Greg, 2004)}.........................................................................29 Figure 2.7 Block diagram describing the implementation of the Kalman estimator. The predicted temperature by the model is corrected and updated by Kalman estimator based on patient's temperature measurements. .31 Figure 2.8 Block diagram of Model Predictive Control process for tracking reference temperature Tref (k ) ; Kalman estimator estimates the true temperature vector and updates the states of prediction model; optimizer computes the future control moves u (k ) ....................................................................................32 Figure 2.9 Detailed diagrammatic representation of feedback thermal dose controller for LITT ........................34 Figure 3.1 Schematic diagram showing the LITT feedback control system for the albumen phantom experiments..................................................................................................................................................37 Figure 3.2 Illustration of the controller timeline. The controller computes control moves every ts =1s but laser power is updated only at a sampling period of tlaserupdate = 2s ; temperature measurements from sensors are also updated every Ttemperatureupdate (case of a hypothetical scenario).....................................................40

viii

Figure 3.3 Illustration of the controller platform for the evaluation in a dynamic simulated patient model using the LITT treatment planning software (LTPS). ...........................................................................................46 Figure 3.4 The experimental setup used to evaluate the LITT controller in albumen phantoms..........................49 Figure 4.1 Temperature distribution at 1 mm, 3 mm and 5 mm from the source .................................................52 Figure 4.2 Thermal dose at 1 mm, 3 mm and 5 mm from the source...................................................................53 Figure 4.3 Spatial and temporal variance in temperature (Temporal points = 0s to 300s and spatial points = 1 mm, 3 mm and 5 mm)..................................................................................................................................54 Figure 4.4 Temperature and thermal dose vs. time at 3 mm from the source.......................................................54 Figure 4.5 Parameters that influence the temperature the most during the treatment time...................................56 Figure 4.6 Estimation and correction of temperature by Kalman estimator in tissue; (...) shows the un-estimated temperature as predicted by linearised LITT model; (---) shows the estimated temperature and (-) shows the measured noisy temperature at 5 mm from the source...........................................................................57 Figure 4.7 Thermal dose control in a linearised tissue model with a parametric mismatch of +10%;

t preset = 3 min (a) delivered thermal dose at r = 5 mm, (b) temperature profiles at r = 0 mm, r = 5 mm and
reference temperature ( Tref ), and (c) control input (applied laser power). .................................................59 Figure 4.8 Thermal dose control in a linearised tissue model with a parametric mismatch of -50%;

t preset = 3min (a) delivered thermal dose at r = 5 mm, (b) temperature profiles at r = 0 mm, r = 5 mm and
reference temperature ( Tref ), and (c) control input (applied laser power). .................................................60 Figure 4.9 Thermal dose control in a linearised tissue model with a parametric mismatch of +50%;

t preset = 3min (a) delivered thermal dose at r = 5 mm, (b) temperature profiles at r = 0 mm, r = 5 mm and
reference temperature ( Tref ), and (c) control input (applied laser power). .................................................61 Figure 4.10 Spatial thermal dose distribution for various cases of parametric mismatch. The dose was computed at the end of treatment after the tissue had cooled down. ............................................................................63 Figure 4.11 Graphical representation of evolution of thermal dose at 5 mm at t preset and tt and boundary of extended coagulation. ..................................................................................................................................64 Figure 4.12 Thermal dose control in nonlinear tissue model with t preset = 3 min., Tmax, source

= 90oC and umax

= 10W. From top to bottom ­ (i) delivered thermal dose, (ii) temperature profiles of Tref , Tsource and

T5 mm , and (iii) control input (applied laser power) .....................................................................................66
Figure 4.13 Thermal dose control in nonlinear tissue model with t preset = 5 min., Tmax, source

= 90oC and umax

= 10W. From top to bottom ­ (i) delivered thermal dose, (ii) temperature profiles of Tref , Tsource and

T5 mm , and (iii) control input (applied laser power) .....................................................................................67

ix

Figure 4.14 Thermal dose control in nonlinear tissue model with t preset = 7 min., Tmax, source

= 90oC and umax

= 10W. From top to bottom ­ (i) delivered thermal dose, (ii) temperature profiles of Tref , Tsource and

T5 mm , and (iii) control input (applied laser power) .....................................................................................68
Figure 4.15 Spatial thermal dose distribution as a function of t preset (3, 5 and 7 min.). The dose was computed at the end of treatment after the tissue had cooled down. ............................................................................69 Figure 4.16 Graphical representation of evolution of thermal dose at 5 mm at t preset and tt and boundary of extended coagulation. ..................................................................................................................................70 Figure 4.17 Results from experiment # 1 of thermal dose control in albumen phantom with t preset = 11 min.,

Tmax, source  90oC and umax = 5W. Tmax, source = 90oC and umax = 10W. From top to bottom ­ (i)
delivered thermal dose, (ii) temperature profiles of Tref , Tsource and T5 mm , and (iii) control input (applied laser power) .................................................................................................................................................72 Figure 4.18 Results from experiment # 1 of thermal dose control in albumen phantom with t preset = 12 min.,

Tmax, source  90oC and umax = 5W. From top to bottom ­ (i) delivered thermal dose, (ii) temperature
profiles of Tref , Tsource and T5 mm , and (iii) control input (applied laser power) .......................................73 Figure 4.19 Results from experiment # 1 of thermal dose control in albumen phantom with t preset = 15 min.,

Tmax, source  90oC and umax = 5W. From top to bottom ­ (i) delivered thermal dose, (ii) temperature
profiles of Tref , Tsource and T5 mm , and (iii) control input (applied laser power) .......................................74 Figure 4.20 Spatial thermal dose at 5 mm, 5.5 mm and 6 mm for various experiments; dose was computed at the end of treatment after the tissue had cooled down for preset treatment times = 11 min., 12 min., and 15 min. ..............................................................................................................................................................76 Figure 4.21 Graphical representation of evolution of thermal dose at 5 mm at tt and boundary of extended coagulation...................................................................................................................................................77 Figure 4.22 Coagulation observed after performing a controlled LITT in an albumen phantom. ........................78 Figure 4.23 Comparison of rise in temperature in a linearised tissue model for different parametric mismatch cases; laser power = 10W ............................................................................................................................80 Figure 4.24 Comparison of temperature measurements at r = 5 mm and r = 6 mm with numerical predictions for albumen phantom.........................................................................................................................................82 Figure 4.25 A digital image of the setup while experiment was in progress. Dimensions: active length of cylindrical fiber = 2 cm, length of fiber inside the phantom = 3 cm, phantom box = 6 cm x 6 cm x 6 cm. 83

x

NOMENCLATURE
A B
C cb ct
state matrix input matrix output matrix specific heat of blood [ J ig -1 iK -1 ] tissue specific heat [ J ig -1 iK -1 ] standard deviation Diffusion coefficient [cm] desired thermal dose [eq. min.] accumulated dose [eq. min] anisotropy factor measurement matrix cost function tissue thermal conductivity [ W im -1 i K -1 ] temperature dependent factors for density temperature dependent factors for specific heat temperature dependent factors for conductivity Kalman gain matrix control horizon light fluence rate [ W icm -2 ] prediction horizon absorbed power density [ W icm -3 ] error covariance matrix process noise covariance matrix measurement noise covariance matrix radius from the source [cm] relative sensitivity


Dc Df D g H J kt kp kc kk K

m


p P Pk

Q R r
Sr

xi

S

source term [ W icm -3 ] tissue density [ kg im -3 ] arterial temperature [oC] equivalent time at 43oC [min] tissue temperature [oC] initial time [s] final time [s] preset treatment time [s] reference temperature [oC] total treatment time [s] tissue cooling time [s] temperature update interval [s] laser power update interval [s] sampling time [s] threshold thermal dose [eq. min] maximum allowable temperature [oC] measured temperatures [oC] laser power [W] maximum allowable laser power [W] absorption coefficient [cm-1] reduced scattering coefficient [cm-1] scattering coefficient [cm-1] dynamic absorption coefficient [cm-1] dynamic reduced scattering coefficient [cm-1] native absorption coefficient [cm-1] native reduced scattering coefficients [cm-1]

t
Tart
t43

T tinitial
t final

t preset Tref tt tcooling ttemperatureupdate tlaserupdate ts t43,critical Tmax, source Tmeas

u
umax

µa
µs' µs µa _ dynamic

µ s' _ dynamic
µa _ native

µ s' _ native

xii

µa _ denatured

denatured absorption coefficient [cm-1] denatured reduced scattering coefficient [cm-1] weight blood perfusion rate [ Kg im -3 is -1 ] Gaussian white noise random variables baseline blood flow rate [ Kg im -3 is -1 ] Measured temperature vector

µ s' _ denatured
wp wb

w, v
winit zk

ABBREVATIONS
CT FDM FLC FUS LQR MPC MRI LITT LTPS PID SISO computed tomography finite difference method fuzzy logic controller focused ultrasound linear quadratic regulator model predictive controller Magnetic Resonance Imaging Laser interstitial thermal therapy LITT Treatment Planning Software proportional integral derivative Single Input Single Output

xiii

CHAPTER 1- INTRODUCTION

1.1
1.1.1

Laser Interstitial Thermal Therapy
LITT - A Minimally Invasive Thermal Therapy
Minimally invasive thermal therapy is being explored as a means of treating small solid tumors

with minimal damage to adjacent soft tissue. Several treatment modalities have been used for delivering thermal therapy. These include interstitial laser photocoagulation, radiofrequency ablation, and high intensity focused ultrasound. Laser interstitial thermal therapy (LITT) is a minimally invasive technique in which laser energy is delivered directly to the tumor through thin flexible optical fibers inserted into the tissue. The main objective in LITT is to achieve coagulative necrosis in a targeted tumor region over a period of a few minutes. Coagulative necrosis is defined as the irreversible thermal damage of tissue due to protein coagulation. Coagulation occurs at temperatures between 55oC and 95oC (Welch et al, 1991). LITT was first introduced by Bown (1983). It has been investigated as an effective treatment modality for tumors in the breast (Bown, 1998, Lai et al, 1999, Hall-Craggs & Vaidya, 2002), head and neck (Paiva et al, 1998), brain (Schwabe et al, 1997), liver (Dick et al, 2003, Izzo, 2003) and prostate (Aho & Gilling, 2003).

1.1.2

Physics of laser-tissue interaction
In LITT, the tissue temperature distribution and resulting thermal lesion depend on irradiation and

biophysical parameters. These include laser wavelength, geometry of optical fiber, delivered power (typically, 3-15W) and exposure duration (typically, 3-20 min.). An example of a typical coagulation lesion (noted as `whitening' of tissue) achieved using LITT is shown in figure 1.1. On absorption of laser light, several thermal effects occur as described in table 1.1. The typical factors that affect the biological response of tissue are described below:

1

Laser wavelength

The selection of optimal wavelength for LITT applications is a trade-off between the depth of penetration of the laser light and sufficient absorption in the tissue. Lasers that emit in the near infra-red (Nd:YAG, 1064 nm or diode lasers, 800-900 nm) are typically used, since light penetrates deeply into tissue at these wavelengths (Rastegar et al, 1992, Bown, 1998, ). Diode lasers (800-900 nm) have the benefits of being portable, operable with standard `mains' electricity supply and having wavelengths that are effectively absorbed by most biological tissues (Hall-Craggs & Vaidya, 2002).

Interstitial laser fiber tip

Optical energy is delivered to the tissue via thin flexible optical fibers. The ends of these fibers can terminate into several configurations including bare-tip, spherical diffusers and cylindrical diffusers. In the conventional bare-tip design, light emission is concentrated at the tip such that carbonization can occur due to higher localized temperatures. The charred tissue is opaque which limits the penetration of light to the surrounding tissue resulting in greater local temperature accumulation (Sturesson, 1998). Therefore, the temperature profile from a carbonized fiber tip is no different than from a hot tip. With cylindrical diffusing fiber tips, homogenous light emission is produced over a finite diffusing length (fig. 1.1). It has been reported that the coagulated volume doubles when using cylindrical diffusers compared to bare-tip fibers for the same treatment parameters (Heisterkamp et al, 1997).

2

Figure 1.1 Coagulation lesion of 3.6 cm by 2.6 cm in ex vivo pig liver after 6 min. of treatment using 6W laser power and 2 cm cylindrical diffuser tip (adapted from Heisterkamp et al, 1999)

Table 1.1 Biological response of tissue to rise in temperature due to laser light interaction with tissue

Temperature (oC) 40-45

Biological effect Enzyme inactivation; can become irreversible for heating period > 25 min. Protein denaturation leading to

60-140 cell shrinkage, hyperchromasia, coagulation Water vaporization and carbonization leading to > 100 extra cellular steam vacuole and cell shrinkage, fiber tip charring

1.2

Clinical experience

The successful clinical application of LITT requires:

3

(i) A patient-specific pre-treatment planning system that can be used to compute and optimize the treatment delivery parameters such as the positioning of source fiber(s), treatment duration and thermal sensors locations based on the geometry of the target region (Lagendijk, 2000).

(ii) A real-time monitoring system that can provide information about the extent of coagulation in relation to the anatomy of the tissue during treatment (Wyman et al, 1992).

(iii) A treatment control system that can adjust the laser power based on the feedback information provided by the monitoring system automatically in the presence of dynamic and non-linear tissue response to produce well controlled thermal damage.

Although, research has proceeded on all the above three fronts to investigate the clinical applicability of LITT over the last two decades, a lack of adequate treatment control remains a major obstacle in its widespread adoption. The challenges during LITT are discussed below.

The treatment outcome during LITT is unpredictable due to the complex and non-linear processes of the LITT system. The mechanics of LITT can be modeled in three parts: 1) light distribution and absorbed power density; 2) temperature rise due to light absorption and 3) thermal damage (Welch, 1984). Temperature-dependent tissue parameters such as the optical properties and blood perfusion rate affect the LITT model output. A priori knowledge of these dynamic tissue properties is limited. Moreover, there is additional uncertainty involved in the tissue parameters due to inter-patient variability. These factors impose a limit on the confidence in predicting the extent laser induced necrosis using an LITT theoretical model.

Another reason for the limited widespread clinical utility of LITT is the potential for the tissue carbonization and charring of the delivery fiber tips. Manual temperature control at the fiber tip is possible based on the temperature feedback during LITT but this could lead to inefficient control, as the rate of increase in temperature at the tip is high. Manual temperature control can also cause an unpredictable treatment time.

To address these clinical issues, the development of an automatic and robust real-time LITT control system that can limit damage to the target region while preventing fiber tip and tissue carbonization is the goal of this thesis.

4

1.2.1

Clinical goals
The clinical goal of LITT is to cause tissue necrosis inside the target region while preventing the

destruction to the surrounding healthy tissue. Thermal damage is quantified by thermal dose. It is defined as the duration tissue should be maintained at 43oC, in order to produce the same therapeutic effect. Thermal dose can be calculated from a time-temperature history using (Sapareto & Dewey, 1984)
t final

t43 =


tinitial

C (43-T ) dt

(1.1)

where, t43 is the equivalent time at 43oC and T is the time-temperature history during the time interval between tinitial and t final , and

0.25 for T  43o C  C= o  0.5 for T > 43 C
For sufficiently small t , the equation can be approximated as
(43-Tavg )

(1.2)

t43 = C

t

(1.3)

where, Tavg is the average temperature during the time-interval t .

The desirable features of a robust LITT control system are defined as the following control objectives.

Treatment objective: Deliver the prescribed thermal dose to achieve coagulation of user-defined radius in a reasonable treatment time without damaging the healthy tissue.

Safety objective and hardware constraints: The designed controller should be able to deliver the specified thermal dose automatically while adhering to any safety requirements and hardware constraints. For example, there is a maximum allowable temperature of 100oC at the tip of the source fiber to avoid fiber charring and smoke production, and a maximum laser power depending on the laser system.

Adaptable to variations: The controller should be able to adjust to treatment disturbances, such as temperature-induced changes in blood flow, and tissue optical and thermal properties. The automatic control system should also be insensitive to inter-patient uncertainties in tissue parameters as well.

5

1.3

Current treatment monitoring techniques
LITT is currently limited by the lack of a reliable real-time monitoring of laser-induced effects.

Real-time monitoring of LITT should ideally provide information about the extent of coagulation during treatment in relation to tissue anatomy. Then treatment can be continued until complete coagulation of the entire tumor, or terminated to prevent damage to vital structures. Several monitoring techniques are discussed below and summarized in table 1.2:

Ultrasonography: Ultrasonography enables accurate placement of catheters into the tumor. Real-time imaging of the treated area has also been investigated but the echogenic area that is observed during coagulation, typically caused by formation of bubbles from evaporated tissue water, does not correlate well with the coagulative damage. Ultrasonography is also not helpful in evaluating lesions after

treatment as the echogenic area becomes heterogeneous within minutes (Heisterkamp et al, 1999).

Computed Tomography (CT): Contrast-enhanced CT after thermal therapy shows the result of laser treatment clearly as a well defined, non-enhanced area, easily distinguishable from the untreated enhanced tumor areas. Radiographic load and insensitivity to soft tissue changes limits its use as a realtime monitoring technique.

Magnetic Resonance Imaging (MRI): MRI provides high-resolution images capable of monitoring the progression of coagulation in LITT. It can also produce high-resolution temperature maps of the lesions that can be used to calculate the extent of coagulation using a damage model. MRI systems are typically expensive and of considerable size, limiting its accessibility for monitoring LITT.

Optical monitoring: In this technique, optical sensors are placed at critical locations in the tissue, which measure temporal changes in light intensity during heating. This method takes advantage of the significant changes in tissue optical scattering that occurs due to thermal coagulation. The coagulated region limits the amount of light that reaches the optical sensor. These trends can be used to evaluate the coagulation front and may have a potential to be used as a real-time LITT monitoring technique (Whelan et al, 2005).

Temperature based point-monitoring: Sensors are placed interstitially into the tissue at critical locations, such as at the boundary of the target volume, or near the source fiber tip. The measurements at

6

different sensor locations can be used to infer the extent of coagulation. Point temperatures only provide information at the location of the sensors. However, with the appropriate estimation algorithm, the temperature at non-sensor locations can be estimated based on temperature feedback from sensor locations.
Table 1.2 Comparison of different image monitoring and point monitoring techniques

Monitoring technique Ultrasonography Computed Tomography Magnetic Resonance Imaging

Type of system Images

Portable Yes

Cost Inexpensive

Remarks Cannot be used for real-time monitoring Cannot be used for real-time monitoring Excellent resolution; can used for real-time monitoring

Images

No

Expensive

Images

No

Expensive

Optical Fluence

Point measure ments Point measure ments

Yes

Inexpensive

Provides information at the location of sensors only

Temperature

Yes

Inexpensive

Provides information at the location of sensors only

In summary, these imaging systems are expensive and of considerable size, while point measurement methods are typically less expensive and portable. They are usually accessible as they are not dedicated systems. Due to these factors, a point-measurement temperature-based control system was investigated in this project for temperature feedback from discrete sensor locations.

1.4

Current control schemes
Several techniques have been investigated to control thermal therapy. The controllers are

categorized by their treatment objective: temperature control or thermal damage (or thermal dose) control. Temperature control was the first approach for automatic control of thermal treatments. It controlled temperatures to fixed target values at different locations in the tissue until pre-defined thermal damage is achieved. In the thermal damage control approach, a controller tries to reach the desired value of thermal

7

dose by controlling temperature to target values, calculated based on the difference between the desired dose and the accumulated dose.

Several control systems for LITT based on ON/OFF regulation have been implemented (Daikuzono et al, 1988, Ivarsson et al, 1998, Moller et al, 1996). These systems try to maintain temperature at a set point and turning the laser power off when the temperature is too high and on when it is too low. These control systems have the ability to prevent tissue carbonization but do not ensure treatment efficacy in terms of achieved coagulation. Another disadvantage of these systems is their inability to be used for a pre-set treatment time.

One of the most wide-spread classical control system is the Proportional-Integral-Derivative (PID) controller, used extensively for linear systems. PID controllers evaluate three characteristics of the controller input (proportional, integral, and derivative), the adjustment of the gains of PID inputs, and the determination of output (laser power). By adjusting the gains of the P-I-D inputs, the system response can be optimized. Once a system model is defined, a PID controller is developed specifically for the system model. Smith et al (2001) introduced a controller for Focused Ultrasound (FUS) thermal therapy based on a P-I controller. The system adjusted the input power based on temperature information provided by MRI thermometry images. The P and I gains determined the power required to adjust the current temperature response to the pre-set values. Although, temperature information was available for multiple locations, the controller used a single temperature measurement location. Lin et al (1990) studied a `PID bang-bang' controller for ultrasound thermal therapy. A bang-bang controller is an on/off controller, where a system makes decisions based on target and threshold values, and decides whether to turn the system on or off. The controller adjusted the laser power based on selected temperature bands, which were fed as inputs. It also turned off power completely whenever the temperature rose above a threshold. In all the above controllers, the system model was not explicitly defined, but was designed considering the system as a black box. Black box is defined as a theoretical construct with known or specified performance characteristics but unknown or unspecified constituents and means of operation.

Mattingly et al (2000) studied a model-based approach for controlling temperatures in FUS thermal therapy. An inversion of the system transfer function or response was used to determine the actuator power to achieve a desired temperature time-trajectory. Their study addressed the issue of minimizing the treatment time by raising the tumor temperatures to their treatment levels as quickly as possible. An estimator was incorporated to estimate full temperature maps thus enabling the controller to

8

predict and control temperature at non-sensor locations. However, their approach used a complicated mathematical model to predict the temperature evolution and was computationally expensive.

Adaptive model-based controllers for focused ultrasound based thermal therapy have been developed (VanBaren & Ebbini, 1995, Salomir et al, 2000, Vanne & Hynynen, 2003). The controller developed by VanBaren & Ebbini (1995) had multiple inputs from temperature probes and controlled power levels for an individual element of an ultrasound phased array using P-I gains. The controllers developed by Salomir et al (2000) and Vanne & Hynynen (2003) use MRI thermometry data to control optical power levels for a single-output using optimal control theory. All of these controllers were based on a system model that was identified before each treatment, and incorporated dynamic changes in tissue properties. The goal, when using these controllers, was to maintain the temperature in the tissue at predefined locations at a set level. Although, these controllers were adaptive, they relied on the accuracy of the system response function to treatment disturbances, which were identified at the beginning of each procedure. This model identification was time-consuming. Secondly, the controller did not consider the progression of thermal damage or a limit on treatment time.

Another multivariable adaptive controller was developed by Wyman et al (1991) for LITT. This controller compensated for the changes in the tissue parameters during LITT by incorporating a temperature response model that was recalculated throughout the treatment to represent the updated tissue conditions. The controller computed the appropriate distinct pulse durations for multiple optical applicators based on the system response to maintain temperatures at desired pre-defined levels. This recalculation of the system response function, like other adaptive model based controllers, was time consuming and the controller design was very sophisticated.

Black box based control schemes such as fuzzy logic is an alternative to address the modeling uncertainty of non-linear systems. For the development of a fuzzy logic based controller, the first step is to characterize the system response. The second step is to design the control algorithm using fuzzy logic rules, which describe the principles of the controller's regulation in terms of the relationship between its inputs and outputs. Finally, the system can be trained or tuned to adapt to treatment disturbances. A closed loop fuzzy logic controller (FLC) for LITT was developed by Choy et al (2002). The FLC had two point temperature inputs and a laser power output. The goal of this controller was to maintain tissue temperatures at target points until a predefined thermal damage was reached. The controller was successfully tested for its robustness to various tissue models and scenarios, including dynamic changes

9

in blood perfusion and optical properties. However, the controller was not designed to control temperatures at non-sensor locations. A comprehensive review of FLC can be found in Choy et al (2003).

All of the controllers described above are categorized as temperature controllers. Controller may be designed to directly control the thermal dose. Arora et al (2005) developed a thermal dose based controller for FUS heating which consisted of a feed forward and feedback control scheme. The goal of the controller was to deliver the prescribed threshold thermal dose in a minimum possible time, while constraining maximum allowable temperatures at selected locations in the tissue. The feedback controller, implemented as a constrained linear model predictive controller (MPC), tracked a reference temperature trajectory ( Tref ) which was generated by the feed forward thermal dose control loop. Tref was computed from the difference between the desired and accumulated thermal dose. The internal plant model in the MPC design structure predicted the future control moves by minimizing a cost function based on Tref and the current temperature. This was an unique feature among controllers for thermal therapy applications. However, the controller needed to be individually tuned for each treatment, which was computationally expensive task. Furthermore, the total treatment time was not predictable which is an undesirable feature for clinical implementation.

The controller designed by Malinen et al (2006) also implemented the feedforward and feedback approach. The laser power was computed in the feedforward loop by optimizing a quadratic cost function consisting of the desired thermal dose and current thermal dose. The feedback loop accounted for any kind of modeling errors. The states (temperature distribution) of a linearised plant model were corrected and updated at each step based on MRI thermometry data using an estimator and linear quadratic regulator (LQR) scheme. In LQR, a quadratic cost function is defined and an optimal control move is computed by minimizing the defined cost function. The main goal was to deliver the prescribed threshold thermal dose in a pre-set treatment time while maintaining the dose lower than a predefined threshold in the non-targeted regions. The controller design was complicated and computationally expensive due to the implementation of multiple objective (cost) functions. In addition, it required an exhaustive tuning process to determine the suitable weights used to optimize a set of cost functions.

10

1.5

Summary
There is a need to develop a control system for LITT, which would allow a physician to

concentrate on clinically relevant treatment objectives of delivering the prescribed thermal dose, while automatically adjusting the laser power based on temperature measurements. The model-based thermal dose control design approach developed by Arora et al (2005) for FUS produced remarkable results in terms of the defined treatment and safety objectives. Therefore, our research has focused on the development of a thermal dose controller for LITT. The primary goal of the controller is to deliver the prescribed thermal dose to a target location in the tumor in a pre-set treatment time while respecting the temperature constraints.

The development and implementation of this control system is novel and unique to the field of laser based thermal treatments. This is the first effort to control the thermal dose directly for laser based thermal treatments while delivering the prescribed thermal dose in a pre-set treatment time. The controller achieves the treatment goals while ensuring that the maximum tissue temperature remains below 100oC (to prevent the tissue carbonization and fiber tip damage). The controller is model-predictive which makes the system pro-active as it has the ability to foresee any violations of constraints unlike other model-based or black box controllers. The model used is linear and is not computationally expensive. The model state is continually updated to minimize the error between the model predicted temperature and the actual measured temperature. This feature makes the controller adaptable to the unpredictable non-linear dynamic tissue properties such as blood perfusion and optical properties. The model-predictive controller is insensitive to inter-patient variations. Lastly, the controller has the ability to control damage at nonsensor locations by incorporating an estimator into the design. The estimator used in this study is a standard Kalman filter, a dynamic computer model that estimates the true temperature at sensor and nonsensor locations based on the error between the model predicted and measured temperatures at the sensor locations.

11

CHAPTER 2 - THEORY

2.1

Control of thermal dose ­ A non-linear problem
It is difficult to control thermal dose directly as compared to controlling temperature because of

the nonlinear, integrating relationship between temperature and thermal dose (see section 1.2.1). The following features characterize the accumulation of thermal dose: 1. The absolute value of dose is a non-decreasing function such that

dose(t1 )  dose(t 2 ) whenever t1  t2 , reflecting the fact that the delivered dose cannot be
reduced. 2. The dose continues to accumulate after the termination of treatment, while tissue temperatures remain above body temperature (37oC).

2.2

Controller Architecture
A controller with a cascaded two-step structure was developed which indirectly controls the

delivery of thermal dose by directly controlling the tissue temperature. The block diagram of the developed feedback based thermal dose controller is shown in figure 2.1. It has a cascade structure with the secondary temperature control loop receiving the input as reference temperature Tref from the primary thermal dose control loop. The temperature controller is implemented as a linear, constrained model predictive controller (MPC). The main objective of the MPC is to control the laser power u , such that the tissue temperature, T , is held at the reference value Tref . This is achieved by minimizing the error


between the estimated T and Tref . The thermal dose controller dynamically updates Tref to be tracked by

12

the temperature controller based on the difference between the desired thermal dose D f and the


accumulated dose D (tk ) in tissue (which is calculated from T ).
D D

Df

Tref



u

Tmeas

T



T

Figure 2.1 Block diagram of feedback thermal dose controller; LITT system consists of a laser, a patient and a thermometry system.

2.2.1

Primary Thermal Dose control loop operation
D f is the desired thermal dose to be delivered in a pre-determined (or preset) treatment time,

t preset . D (t ) is the accumulated dose delivered to a particular tissue location after t seconds of treatment
(it can be computed from the estimated time-temperature profile). The goal of the treatment is to deliver a dose of in a prescribed duration, t preset ,

D (t preset ) = D f

(2.1)

At any time point, t , during the treatment, a reference temperature, Tref , is calculated such that if the temperature of the tissue at this location is held constant for the remaining treatment time, t preset - t , the desired dose will be delivered. That is

D f - D (t ) = C
where C = 
o  0.25 for T  43 C o  0.5 for T > 43 C

43-Tref

(t preset - t )

(2.2)

Since C depends on Tref , the equation 2.2 is non-linear. Tref can be determined by finding the root of the following function:

f (Tref ) = C 43-Tref (t preset - t ) - D f + D

(2.3)

A convergence algorithm (an inbuilt MATLAB routine based on (Forsythe, 1977)) was used to compute

Tref . The thermal dose control loop continuously recalculates Tref , which, if maintained over t preset - t ,
13

leads to the delivery of remaining thermal dose D f - D (t ) . Tref is calculated and updated each time a new thermal dose estimation is available.

2.2.2

Secondary temperature control loop operation
The computed Tref is the reference input for the secondary temperature control loop, which is a

linear model predictive controller (MPC). The MPC automates a target system by combining a prediction and control strategy. An approximate, linear plant model provides prediction of the state. The control strategy compares predicted plant states to a set of control objectives, and then adjusts available actuators to achieve the objectives while respecting the plant's constraints. Such constraints include the actuators' physical limits and limits for the safe operation of the plant. It predicts the laser power, u , by dynamically minimizing the weighted 2-norm of the error between the actual and desired temperature

Tref , while conforming to the maximum allowable temperature and power constraints of the system.

2.3

Modeling of laser-irradiated tissue
A model of how the process behaves is required in order to predict the future behavior of the

process. In particular, this model must show the dependence of the output on the current measured variable and current/future inputs. Most MPC algorithms use linear models since they are easy to implement and facilitate optimization strategies (Rossiter, 2003).

The LITT model consists of three parts: a light distribution model, a bio-heat transfer model and a thermal damage model. The elevation of tissue temperature changes tissue optical properties, thermal properties and the blood perfusion rate. This, in turn, affects the tissue temperature rise, as shown in figure 2.2.

14

Figure 2.2 Block diagram describing the non-linear process of LITT. The dynamic properties of tissue are a function of thermal dose.

2.3.1

Light distribution model
The migration of photons in biological tissues can be described by the radiative transport equation

(RTE) (Duderstadt & Hamilton, 1976). Several practical models exist which approximate the RTE to compute the distribution of light, for example Beer's law of attenuation, Kubelka-Munk theory, the diffusion approximation, and the seven-flux model as discussed by (Welch et al, 1987). The diffusion approximation to the RTE is appropriate when scattering dominates absorption (Hielscher et al, 1998). The diffusion approximation is described by:

- Dc  2 ( r ) + µa ( r ) = S ( r )
where,

(2.4)

Dc = [1/(3µa + 3µ s' )] = diffusion coefficient (cm)

µa = absorption coefficient (cm-1)
g = anisotropy factor

µs = scattering coefficient (cm-1) µs' = µ s (1 - g ) = reduced scattering coefficient (cm-1)  = light fluence rate ( W icm-2 )
r = radius from the source (cm) S = source term ( W icm-3 )

15

The limitations of the diffusion approximation are its inability to accurately predict the fluence rate close to a light source, near tissue boundaries and in highly absorbing regions (Hielscher et al, 1998). Still, the
diffusion approximation has been used extensively to estimate the light fluence in prostate for example, since it is a highly scattering tissue (Anvari et al, 1994). The absorption of light by a target molecule or chromophore, causes the optical energy to be converted into heat (Welch, 1984). The absorbed power density P ( r ) (Wcm-3) is given by:

P(r ) = µa ( r )

(2.5)

Dynamic optical properties

Tissue undergoes an array of morphological changes due to heat which can alter the absorption and scattering coefficients (Nau et al, 1999). Heat denatures proteins and other biomolecules causing cell shrinkage, birefringence changes and membrane rupture (Welch & van Gemert, 1995). The scattering coefficient µs may change as a consequence of a decreased size of scattering particles to sub micron levels. Change in the absorption coefficient µa is due to the modification of blood content in tissue. Coagulation can cause a 2 to 6 fold increase in scattering and a slight increase in absorption (Nau et al, 1999, Whelan & Wyman, 1999). When tissue becomes coagulated, the light penetration diminishes due to increased scattering. This dynamic behavior in tissue optical properties can be modeled as a function of thermal damage using the t43 thermal dose model (Davidson et al, 2005):

µa _ dynamic

 t - t43 = µa _ native  e 43,critical    t - t43  e 43,critical  

- t43   t43,critical  + µ a _ denatured  1 - e    

   

(2.6)

µ

' s _ dynamic

=µ

' s _ native

- t43   t43,critical '  + µ s _ denatured 1 - e    

   

(2.7)

where, µa _ dynamic and µ s' _ dynamic are the dynamic absorption and reduced scattering coefficients respectively. µa _ native and µ s' _ native are the native absorption and reduced scattering coefficients , and

µa _ denatured and µ s' _ denatured are the denatured absorption and reduced scattering coefficients respectively.
t43,critical is the threshold thermal dose.

16

2.3.2

Bio-heat transfer model
The Pennes Bio-heat transfer equation has been used by many to describe thermal propagation

during thermal therapy. It approximates the effect of flow in a large number of small blood vessels by a bulk "heat-sink" term, added to the standard heat transfer equation (Pennes, 1998):

t ct

T ( r , t ) =  ( kt T ( r , t ) ) + P ( r ) - wb cb (T ( r , t ) - Tart ) t

(2.8)

where, t = tissue density ( kg im -3 )

ct = tissue specific heat ( J ig -1 iK -1 )
T = tissue temperature ( C)
o

kt = tissue thermal conductivity ( W im-1 iK -1 ) wb = blood perfusion rate ( Kg im -3 is -1 ) cb = specific heat of blood (Jkg-1K-1) Tart = arterial temperature (oC).
Figure 2.3 illustrates the physical processes in equation 2.8. The first term on the right side of equation (2.8) describes the thermal conduction, which is the diffusion of heat in tissue; the second term describes the total energy absorbed in a volume from the optical source (2.5). The third term describes the convective effects of blood flow as a heat sink, which is proportional to the tissue perfusion rate. This term represents the net thermal energy transported out of the tissue volume by blood in the microvasculature.

Figure 2.3 An illustration of heat generated or absorbed in small volume dV, transported in tissue volume V by conduction and convection, stored in V, and exchanged over A (adapted from Welch & van Gemert, 1995))

17

Dynamic response of thermal properties

Though no complete temperature-dependent and damage-dependent thermal properties have been reported in the scientific literature, the tissue's thermal properties can be approximated according to the temperature dependent change in tissue water content in the range of 20o C -100o C are (Roggan & Muller, 1995):

t ( T ) = 1000 (1.3 - 0.3k  w )
ct (T ) = 4190 ( 0.37 + 0.63kc w ) kt (T ) = 0.419 ( 0.133 + 1.36kk w )

(2.9) (2.10) (2.11)

where, k p , kc and k k are temperature dependent factors for density, specific heat and conductivity, respectively and given by:

k p = 1 - 4.98 × 10 -4 (T - 20o C ) kc = 1 + 1.016 × 10-4 (T - 20o C ) kk = 1 + 1.78 ×10 -3 (T - 20o C )

(2.12) (2.13) (2.14)

The variation in thermal properties over the large temperature range during LITT is considered small. It was determined that there is a 0.56% increase in t , a 0.33% increase in ct and an 8.69% increase in kt over the range of 35oC to 95oC. Therefore, the thermal properties can be assumed constant during LITT procedure.

Dynamic blood perfusion rate

The dynamic response of the vasculature to heat complicates the prediction of LITT outcome. With the increase in temperature, the blood vessels dilate increasing blood flow in an attempt to remove heat as a part of homeostasis (Aggarwal et al, 1990, Lynn & Costell, 1991). However, the blood perfusion rapidly shuts down as the tissue coagulates (Thomsen et al, 1994). Dynamic blood perfusion rate can be modeled based on the accumulation of thermal dose given by (Davidson et al, 2005):

 - t t43 wb = winit  e 43,critical  
where, winit is the baseline blood flow before the treatment begins.

   

(2.15)

18

2.3.3

Damage model
Tissue damage was quantified in terms of equivalent time exposure at 43o C by applying an

exponential relationship between the temperature and exposure time (Sapareto & Dewey, 1984) given by:
t final

t43 =

to



C

(43-Tavg )

dt

(2.16)

where, t43 is the equivalent time at 430 C, Tavg is the time-average temperature and C is 0.25 for T < 43o C and 0.5 for T > 43o C. t43 is the equivalent time that tissue would have to be exposed at 43oC to produce the same biological damage caused by an arbitrary time temperature profile. The time required to reach an isoeffect is decreased two-fold for each degree rise in temperature above 43o C and is increased four-fold for each degree fall below 43o C (fig. 2.4).

Time of exposure vs. temperature for delivering 240 eq. min. of dose 1200

1000

time of exposure (min.)

800 Time of exposure increases by 4 folds below 43 C 600

400

Time of exposure decreases by 2 folds above 43 C

200

0 39

40

41

42

43
o

44

45

46

temperature ( C)

Figure 2.4 The above graph shows that the time of exposure required for delivering constant thermal dose of 240 eq. min. increases by 4 folds for each degree drop in temperature below 43o C and decreases by 2 folds for each degree rise above 43o C.

19

2.4

Uncertainty Analysis and Sensitivity Analysis
Uncertainty and sensitivity analysis is an important element of the reliable model building

process. Uncertainty analysis (UA) is the study of spatial and temporal variability in plant output due to uncertainties in input parameters. Sensitivity analysis (SA) helps in identifying the parameters that affect the plant output the most. A quantitative UA helps in determining the two-sided tolerance limits and variance (noise) of the output parameters. The linearised model in conjunction with the noise input account for perturbations that are caused in the model output due to uncertainties and non-linearities in the LITT process. SA coupled with UA can help one to understand whether the current state of knowledge on input data and related uncertainties is sufficient to predict the reliable output. In this work, a comprehensive non-linear LITT model (described above) was used to complete an uncertainty and sensitivity analysis for the purposes of identifying a reliable, simplified linear LITT model and LITT process noise.

The UA consisted of the following steps: (i) (ii) (iii) (iv) Identification of the relevant input parameters that have uncertainties; Definition of the uncertainty range of input parameters (minimum and maximum values); Specification of subjective probability distributions over these uncertainty ranges; Generation of a random sample size N for input parameters from their probability distributions and performing the corresponding simulation runs to determine the outputs; (v) Calculation of uncertainty in the output parameter.

In LITT, there are a number of parameters that affect the temperature rise and subsequent thermal damage. These are listed in table 2.1. The input parameters were categorized into constant parameters (which do not change from one system to another) and variable parameters (which vary from patient to patient). The uncertainty range of the input parameters was determined based on the published literature values. The parameters were assumed to be normally distributed. The analysis was performed by generating time-history plots for temperature to investigate its variability as a consequence of the statistical variation of the input parameters.

Sensitivity Analysis (SA) of a model aims to quantify how a model output depends on its input parameters. The sensitivity of temperature and thermal dose to various varying input parameters was approximated using relative sensitivity, Sr :

20

 x  y - y  Sr =    2 1   y  x2 - x1 

(2.17)

where, x is the mean input parameter and y is the corresponding output. x1 , x2 correspond to ± 10 percent, ± 30 percent or ± 50 percent of the initial parameter and y1 , y2 are corresponding output values respectively. The greater the Sr, the more sensitive a model output variable is to the corresponding input parameter. The sensitivity analysis was carried out for model predicted tissue temperatures at 1 mm, 3 mm and 5 mm distance from a laser delivery fiber. The results of UA and SA are reported in Chapter 4.

Table 2.1 Parameters used to perform UA and SA Parameter Symbol S.I Units W cm-1 Parameter identification Input Input Constant Variable Values with uncertainty for prostate tissue 3.0 0.6 ± .21 Distribution, mean and variance in input parameters Normal, µ = 0.6 and  = 0.09 Normal, µ = 0.7 and  = 0.09 Normal

Power from the source Absorption coefficient of native tissue Absorption coefficient of denatured tissue Scattering coefficient of native tissue Scattering coefficient of denatured tissue Anisotropy factor Tissue density Tissue specific heat Tissue temperature Thermal conductivity of tissue Blood perfusion rate (initial) Specific heat of blood Arterial temperature Constant in t-43 model Thermal dose Thermal dose

Po

µa _ native
µa _ denatured µ s _ native µ s _ denatured
g native

cm-1 cm-1 cm-1

Input

Variable

.70 ± .201 100 ± 201 230 ± 301 0.941 1.0452 ,1.051 3.63, 3.7401, 3.52 0.005883, 0.005291, 0.006422 0.008633 3.61 310 See equation 1.2 240

Input

Variable

Input

Variable

Normal

gcm-3 Jg-1K-1 K Wcm-1 K-1 kgm3 -1 s Jkg-1K1

Input Input Input Output Input

Constant Variable Variable TBD* Variable

Normal, µ = 1.045 and  = 0.028 Normal, µ = 3.6 and  = 0.121 Normal, µ = 0.00588 and  = 0.0006 -

t
ct T kt winit cb Tart C t43
t43,critical

Input Input Input Input Output Input

Constant Constant Constant Constant TBD* constant

K eq. min. eq.

21

critical min. 1 - (Roggan and Muller, 1995); 2 - (Lang et al, 1999); 3 - (Kim et al, 1995); * - To be determined in real time

2.5

State-space formulation of LITT model
A state space representation is a mathematical model of a physical system as a set of input, output

and state variables related by first-order differential equations. The input, output and state variables are expressed as vectors and the differential equations are written in matrix form. The state space representation (also known as the `time-domain approach') provides a convenient and compact way to model and analyze systems with multiple inputs and outputs. In addition, the effect of initial conditions can be easily incorporated in the solution. The most general state space representation of a continuous time-invariant system is written in the following form (Slotine, 1991):

x(t ) = Ax(t ) + Bu (t ) y (t ) = Cx(t ) + Du (t )

i

(2.18) (2.19)

where, x is the state vector, y is the output vector, u is the input (or control) vector, A is the state matrix, B is the input matrix, C is the output matrix, and D is the feedthrough (or feedforward) matrix. For simplicity, D is often chosen to be the zero matrix, i.e. the system is chosen not to have direct feedthrough.

A state-space LITT model was developed by solving the light diffusion (2.4) and bioheat equations (2.8) using the finite difference method (FDM). The FDM is an efficient and simple method for computing numerical solutions of complicated partial differential equations. FDM approximates differential equations by dividing the spatial and temporal domains into discretized points in space (nodes) and time (time-steps) (Croft, 1977). The second order light and heat transfer models are discretized in one-dimensional cylindrical coordinates for homogenous tissue properties. The source was modeled as an infinitely long line source emitting a homogenous light distribution pattern, placed at the centre of cylindrical tissue geometry (fig. 2.5a). A schematic of the discretized computational domain is shown in figure 2.5b. The value of  and T was computed at each grid point, using a finite spatial ( r ) and time step ( t ).

22

ro

r

10

r

tN

t N -1

t

t (time, sec)

r Tr ,t
i

i i

t2
t1
r0 r1

r (distance, mm)

rN -1 rN

Figure 2.5 a) Diagrammatic representation of 1-D cylindrical geometry for homogenous tissue properties; r = radius of computational domain; ro = radius of light source fiber b) A rectangular domain discretized in space and time using N points.

Light diffusion model

The light diffusion equation in 1-D cylindrical coordinates (no source) is given by:

 2 ( r ) D  ( r ) -D - + µa ( r ) = 0 r 2 r r

(2.20)

The continuous function derivatives in the above equation are substituted with discrete finite differences. The finite differences are derived from the Taylor series expansion about the nodal point, i. The central difference approximation of the first order derivative and second order derivative of fluence rate  ( r ) are given by:

23

 i +1 - i -1 = 2r r

(2.21)

 2 i +1 - 2i + i -1 = r 2 (r )2

(2.22)

where, r is the spatial distance between two adjacent nodes. Substituting the above central difference approximations into (2.20) yields

  - 2i + i -1  D  i +1 - i -1  - D  i +1 -   + µai = 0 (r )2   ri  2r 
Rearranging this produces a set of equations that can be solved with matrix operation such that:

(2.23)

Afluence = B fluence
where, coefficients Afluence and B fluence at central nodes i.e. i  [2, N - 1] are given by:

(2.24)

 1 1  Afluence (i, i - 1) = D  - 2 ;  2ri r r 
Afluence (i, i ) = 2D + µa ; r 2

 1 1  Afluence (i, i + 1) = D  - - 2 ;  2ri r r 
B fluence (i, i ) = 0
Two boundary conditions were imposed to uniquely compute the fluence rate at the source (left boundary) and at the edge of the computation domain (right boundary):

-2 ro D

 ( r ) u = (Left boundary) r r = r L
o N

(2.25)

 ( r ) r r = 0 (Right boundary)

(2.26)

where, ro is radius of cylindrical source fiber, u is power of the source, L is length of the diffuser. The left boundary condition is a Neumann boundary. The second condition assumes that there is no fluence rate at a distance r sufficiently deep into the tissue.

The boundary condition given by (2.25) was implemented using forward difference method:

  - -2 ro D  i +1 i  r

 u =  L

(2.27)

24

Substituting i +1 in equation (2.20) gives left boundary node coefficients ( i = 1 ) of:

Afluence (1,1) =

D + µa r 2

Afluence (1, 2) = 0 Afluence (1, 3) = - D r 2

 D 2D   1   u  B fluence (1,1) =  - +     r1 r  2 ro D   L 
The boundary condition given by (2.26) was implemented using the backward difference method:

i = 0
Substituting i into (2.20) gives the right boundary node coefficients ( i = N ) of:

(2.28)

Afluence ( N , N ) = 0

 D 2D  Afluence ( N , N - 1) =  + 2  rN r r 
Afluence ( N , N - 2) = B fluence ( N , N ) = 0
In summary, the matrices Afluence and B fluence for N discretized points in space are:

-D r 2

D  + µa  r2  1    1  D 2rr - r2     i  0 Afluence =        0  

0 2D + µa r2 0

D r2  1 1  -D + 2  2rir r  -

0 0 0  1 1  D - 2  2rir r  2D + µa r2  D 2D  + 2   rnr r 

0

0

-D r2

    0    0  0   1 1  -D + 2  2rir r     0   0

B

fluence

 D 2 D   1 =  - +   r   2 ro D   r1

 1     L 
25

0

 ... ... ... 0  

'

Bio-heat transfer model

The second-order bioheat transfer equation in 1-D cylindrical coordinates is represented as:

t ct

T ( r , t ) t

  2T ( r , t ) 1 T ( r , t )  =k +  - wb cb  2 T ( r , t ) - Tart   + µa ( r ) r r   r

(2.30)

subject to boundary conditions at the fiber edge (at ro ) and at r = 5cm of:

T r

= 0 and
r = ro

T r

=0
r = rN

This Neumann boundary condition at r = 0 assumes that there is no conduction into the source. The second boundary condition at r = 5cm assumes that there is no temperature rise at a distance

r sufficiently deep into the tissue. This corresponds to zero temperature gradient for large r . The
boundary conditions are implemented numerically using forward difference and backward difference equations for left and right boundary equation respectively, as was done for light diffusion. The central nodes were computed by applying the central difference method. The standard state-space formulation of the thermal response to laser heating is represented as:

T = AtemperatureT + B temperatureu Toutput = CT

i

(2.31) (2.32)

where, T is a vector of deviation temperatures from baseline temperature. B temperature is a fluence matrix given by

(A

fluence -1

)

B fluence i µ a / t ct . The temperatures in the target volume were determined at fixed

locations, described by the output row matrix C of the model. Atemperature is the system matrix, which depends on both conduction and perfusion such that,

26

bcb -k    c r2 -  c t t  tt  k  1 1    2-   t ct  r 2ri r   0 Atemperature =        0  

0 -2k bcb - tct r2 t ct 0

k

t ct r2
1  k  1  2+  t ct  r 2rir 

0 0 0 1  k  1  2-  t ct  r 2ri r  -2k bcb - t ct r2 t ct k  -2 1   2-  t ct  r rnr 

0

0

k t ct r2

    0    0  0     1 1  k +   t ct  r2 2ri r    0   0

The developed state-space formulation of the LITT model is linear, continuous and timeinvariant. In a time-invariant system, the state and input matrices are independent of time, which means the coefficients of the system remain constant over time. In the next step, the developed continuous-time model was discretized using MATLAB's built-in routine (defined as c2d) to convert it into a discrete-time model. The discrete-time linear model is preferred over a continuous-time linear model because it is easier to implement from a control design aspect (Grewal, 1993, Franklin, 1998).

The discrete state space model is represented by:

T (k + 1) = AT (k ) + Bu (k ) Tout (k ) = CT (k )

(2.33) (2.34)

where, T (k + 1) is the vector of predicted output states at time step k + 1 given the temperature at timestep k , T ( k ) is a vector of temperature elevations above the baseline temperature and u (k ) is the controlling input and Tout ( k ) is the output temperature to be controlled.

2.6

Kalman Estimator
The Kalman filter, developed by R.E. Kalman in 1960, is a set of mathematical equations that

provides an efficient computational (recursive) mean to estimate the state of a process, in a way that minimizes the mean of the squared error between the predicted state and true state (Grewal, 1993, Zarchan & Musoff, 2005). In this thesis, a standard Kalman filter was implemented to provide optimal state estimates ( T ) of the linear dynamic system based on noisy system measurements.

27

The Kalman filter estimates the state T of a discrete state space LITT model governed by the following linear stochastic equation and measurement model:

Tk = ATk -1 + Buk -1 + wk -1 zk = HTk + vk

(2.35) (2.36)

H is a measurement matrix that describes the relationship between the LITT process state and the
measurements from the sensors; Tk is state predicted at time step k based on the state at k - 1 . The terms

w and v are Gaussian white noise random variables representing the process and measurement noise,
respectively. They are assumed to be independent (of each other), and with normal probability distributions:

p ( w )  N ( 0, Q ) p ( v )  N ( 0, R )
where, Q is the process noise covariance matrix = var(T ) diag (1, N ) and R is the measurement noise covariance matrix = var( sensor ) diag (1, N ) . In deriving the equations for the Kalman filter, we began


with the goal of finding an equation that computes a posteriori state estimate Tk , as a linear combination of a priori estimate Tk - and a weighted difference between an actual measurement and a measurement prediction as shown below:
     Tk = Tk- + K  zk - H Tk-     

(2.37)

The difference zk - H Tk- is called the residual. It reflects the discrepancy between the predicted measurement H Tk- by the model and the actual sensor measurement zk . A residual of zero means that the two are in complete agreement. The matrix K is chosen to be the gain that minimizes the a posteriori error covariance:
  T    Pk = E  Tk - Tk  Tk - Tk       

(2.38)

There are several ways to compute the gain matrix K that minimizes Pk . The expression for gain is one of the popular forms (Zarchan & Musoff, 2005, Grewal, 1993, Welch & Greg, 2004) as given by:

K k = Pk- H T ( HPk- H T + R )

-1

(2.39)

28

The Kalman estimator estimated the true state of the LITT process by using a feedback approach (fig. 2.6). The Kalman estimator equations were categorized into two groups: time-update equations (predictor) and measurement-update equations (corrector). The time-update equations projected the current state (forward in time) and error covariance estimates to obtain the a priori estimates for the next time step. The measurement update equations incorporated the new measurements into the a priori estimate to obtain an improved a posteriori estimate.

1) Compute the Kalman gain 1) Project the state ahead


K k = Pk- H T ( HPk- H T + R )

-1

Tk- = ATk -1 + Buk
2) Project the error covariance ahead




2) Update and correct estimate with measurement
     Tk = Tk- + K  zk - H Tk-   

Pk = A Pk -1 AT + Q
Predictor

3) Update the error covariance Corrector

Figure 2.6 Feedback operation of Kalman filter for estimating the true temperature by using prediction and correction strategy {adapted from (Welch & Greg, 2004)}

The Kalman Estimator is implemented as shown in figure 2.7. At time instant k , the laser power uk is applied to the patient and the prediction model. The corrector block estimates the true temperature


Tk based on the predicted temperature vector Tk , measured temperature vector zk in the patient, process

 -

noise Q and sensor noise R . The estimated temperature is fed back to the predictor block to update the states for the next time step. The current thermal dose, which is the ultimate variable of interest, is calculated based on the estimated temperature and fed to the controller for further control action.

The patient's model was implemented as a non-linear model as described in section 2.3. The tissue optical properties and blood perfusion rate were modeled as a function of dose assuming 240 eq.

29

min. of dose as critical dose. The LITT plant model (as used in controller) was implemented as a linear model. A parametric model mismatch was introduced to ensure the adaptability of estimator algorithm to the possible scenario of unknown tissue properties. The parameters of patient's model, linearised LITT model and estimator are listed in tables 2.2 and 2.3. The LITT model's parameters were selected based on the mean value of the published literature value (table 2.1).

Table 2.2 Model parameters

Parameter

Patient
0.7 1.4 4.5 9 1.005 3.69 0.06 3.8 0.009 37

LITT model
0.6 6 1.0045 3.6 0.0588 3.84 0.00867 37

µa _ native (cm-1) µa _ denatured (cm-1)

µ s' _ native (cm-1) µ s' _ denatured (cm-1)
t (gcm-3)
ct (Jg-1K-1) kt (Wcm-1K-1) cb (Jg-1K-1) wb (gcm-3s-1) Tart (oC)
Table 2.3 Kalman Estimator parameters

Parameter

Value

Q (process noise) R (sensor noise)* Testimator (sampling time)

(3.9) 2 * diag (1,101) (1) 2 * H101x101
2 sec.

* Elements of matrix H are one at sensor locations else zero The simulation results for validation of Kalman estimator algorithm are presented in Chapter 4.

30

Sensor noise Patient Process noise

Prediction


T = ATk -1 + Buk

 - k



  Tk = T + K  zk - H T   


 - k

 - k

Tk

Thermal dose calculator

Correction To controller Kalman Estimator
Figure 2.7 Block diagram describing the implementation of the Kalman estimator. The predicted temperature by the model is corrected and updated by Kalman estimator based on patient's temperature measurements.

2.7

Model Predictive Control of LITT
The goal of MPC is to compute the laser power u required to hold a single output T , at a

reference value Tref

by minimizing the error between the actual and desired output. The error

minimization process is posed as an optimization problem to dynamically minimize a weighted 2-norm of the error between Tref and T . It is described as a Single Input Single Output (SISO) process in which the output parameter is laser power u and the input parameter is temperature T . The MPC process consists of three blocks: prediction, estimation and control (fig. 2.8) (Rossiter, 2003).

Prediction: A LITT state space based prediction model is used to predict the future temperature
outputs T ( k + p | k ) based on the knowledge of past input moves only up to u ( k - 1) , since the next input move u (k ) has yet to be determined. T ( k + p | k ) are the predictions at time-step k + p made at timestep k , where p is defined as a prediction horizon.
 

31

Estimation: In order to make an intelligent control move, the controller needs to know the
current true state of the LITT model. This step is called the model-update process. The true temperature


T (k | k ) at the k th time-step is estimated based on noisy temperature measurements zk using a Kalman
Estimator, where zk = Tmeas ( k ) .

Optimization: The control move was computed by solving a dynamic optimization problem at
each control execution. An objective function was defined in the form of least squares minimization problem, which was the summation of a set of square values obtained from the deviations of predicted temperature T ( k + p | k ) from the reference temperature Tref (k ) . The predicted temperature vector


T consisted of current and future p predicted states: T (k | k ), T (k + 1| k ) + .....T (k + p | k ) . Laser power
and temperature constraints were included directly into the optimization problem while computing the control vector u so that future constraint violations were anticipated and prevented. The control vector



u consisted of current and future m control moves: u (k | k ), u (k + 1| k ) + ..... + u (k + m - 1| k ) , where m is described as the control horizon. The first input u (k | k ) of the optimal input sequences of laser
power was applied into the LITT plant and the problem was solved again at next time interval using updated process measurements.

Tref (k )

Tref ( k ) - T (k )



u (k )

Tmeas (k )



T (k ) u (k )




T (k )

T (k )

T (k )

Figure 2.8 Block diagram of Model Predictive Control process for tracking reference temperature Tref (k ) ; Kalman estimator estimates the true temperature vector and updates the states of prediction model; optimizer computes the future control moves u (k )

32

2.7.1

Formulation of Prediction Model
In the developed controller, p =1 and m = 1 were used. This section presents the formulation of

the prediction model based on the state-space equation model of LITT (previously described). The LITT process to be controlled is described by a discrete-time, linear state-space model (2.33-2.34):
 

T (k + 1| k ) = AT (k ) + B u (k | k ) Tout (k ) = CT (k )
step k . The above equations can be represented as:

(2.40) (2.41)

In the above equations and following sections, the `hat' sign represents the terms that are unknown at time

T (k + 1| k ) = AT (k ) + B[ u (k | k ) + u (k - 1)]
where,  u ( k | k ) = u ( k | k ) - u ( k - 1)
 





(2.42) (2.43)

2.7.2

Formulation of Objective (Cost) Function
The cost function J penalizes deviations of the predicted controlled output temperatures

T ( k + 1| k ) from a reference temperature trajectory Tref ( k ) .
  J = wp  T ( k + 1| k ) - Tref ( k )   
2



(2.44)

Subject to the following constraints:

Tn ( k + 1)  Tn ,max



0  u ( k )  umax
Tn ,max is the maximum allowable temperature in the tissue at n discretized point and umax is the maximum
allowable laser power. wp is defined as the weight for penalizing the output error vector

T ( k + 1| k ) - Tref ( k ) . In order to ensure that cost function J  0 the weight wp > 0 . wp was set to one
for the work presented in this thesis. The cost function J ( k ) was minimized with respect to the input increments u ( k | k ) for the computation of control input.



33

2.8

Summary
D (k )

Df

Tref (k )

u (k )

Tmeas (k )



T (k )
T (k )

u (k )


T (k )
Figure 2.9 Detailed diagrammatic representation of feedback thermal dose controller for LITT

The developed LITT controller is implemented as a two-step cascaded thermal dose controller (fig. 2.9). The goal was to deliver the prescribed thermal dose at a specific radial location in the tissue in a preset treatment time while meeting safety objectives. At time step k , the internal predictive model of MPC predicted the temperature states, for the next time step. Based on measured temperatures Tmeas at various sensor locations in the tissue, the Kalman estimator estimated the full temperature map for all the discretized spatial points. The thermal dose at the point of interest (desired radial location) is computed and used as a feedback for the main thermal dose control loop. The difference between D ( k ) and the desired dose D f , is used to compute the reference temperature Tref such that, if maintained constant during the treatment time, ensured the delivery of remaining thermal dose in that time. Tref served as the reference for the inner temperature control loop that computed the next control move by solving an online optimization problem in the form of a cost function. The maximum allowable temperature constraint

Tn > Tn,max (to prevent fiber tip charring and tissue carbonization) and maximum allowable power
constraint were incorporated in the cost function.

34

CHAPTER 3 - MATERIALS AND METHODS

3.1

LITT Controller objectives
A LITT controller was designed to deliver a desired thermal dose at a specific radial location in a

tissue in a pre-set treatment time. The controller must be able to meet the treatment objectives without violating the safety and hardware constraints, which are the peak allowable temperature in tissue and the maximum allowable power of the laser, respectively. The treatment objectives and the constraints are as following: 1. A desired thermal dose ( D f ) of 240 eq. min. at 5 mm from the edge of the source fiber in a preset treatment time ( t preset ). 2. The maximum temperature at the source fiber ( Tmax, source )  90oC during the entire treatment. 3. The maximum laser power  umax (user-defined) during the entire treatment. In order to minimize the potential for tissue carbonization and fiber tip charring, the temperature at the source fiber tip should be maintained below 100oC during the treatment. The safety constraint of

Tmax, source is chosen to be 90oC with the maximum allowable overshoot of 10oC.

35

3.2

System performance evaluation criteria
The performance of the controller was evaluated by analyzing the progression of thermal damage

beyond the boundary of tumor tissue into healthy tissue at the end of the total treatment time ( tt )

tt = t preset + tcooling

(3.1)

where, t preset is the preset treatment time and tcooling is the time it takes the tissue to cool down to ambient body temperature after the heating is completed. It is important to define the performance criteria based on post-treatment analysis because the dose continues to accumulate as long as the tissue temperatures remain above ambient (see section 2.1).

From clinical perspective, it is normally assumed safe for the threshold dose to extend 1 mm beyond the targeted boundary. Also, the thermal dose is known to have a sharp gradient around the edge of the thermal damage (Chung et al, 1999). After the cooling period, the thermal dose was calculated 1 mm from the boundary. Since, it may not always be possible to deliver exactly 240 eq. min. due to the hardware constraints (explained later in this chapter), an uncertainty of ± 5% eq. min. was associated with the final dose. Hence, the controlled LITT treatment is evaluated as successful if the dose delivered at 5 mm at the end of t preset = 240 ± 5% eq. min. and < 240 eq. min. at 6 mm at the end of tt .

3.3
3.3.1

Experimental equipment for controller evaluation
LITT Feedback control system
The LITT feedback control system included a source laser unit, Luxtron 3100 and a computer

based LITT controller. The developed LITT controller was implemented using MATLAB 7.2 Model Predictive Control and Control toolboxes (The Mathworks Inc., Natick, MA). The system was designed to automate the real-time monitoring and control of LITT, as illustrated in figure 3.1. The laser energy

36

was delivered through an application fiber into the target region. The resulting temperature increase in the target was measured using the Luxtron system. The LITT controller receives the temperature information from specific spatial locations at each temperature update interval, ttemperatureupdate . The controller computes the suitable laser power based on this temperature feedback, to be applied for the next sampling time. This calculated power is then relayed to the laser, where the new power level is adjusted and maintained until the next laser power update interval, tlaserupdate . The interfacing and automation of all the components of the feedback control system are programmed via a RS-232 serial port using MATLAB 7.2 (The Mathworks Inc., Natick, MA) on a 1.59 GHz Pentium M personal computer (IBM).

Interfaced using RS-232 Interfaced using RS-232

4-channel diode laser

Personal computer LITT controller

Luxtron 3100 Temperature measurement unit

808nm 1 2

940nm 3 4 A B C D

Sensor A Diode laser fiber SMA-SMA mating sleeve Cylinderical diffuser (application fiber) Sensor B

Tissue mimicking phantom material

Sensor C

Figure 3.1 Schematic diagram showing the LITT feedback control system for the albumen phantom experiments.

37

3.3.2

Laser
The energy source was a four-channel fiber coupled laser diode system, designed by Dr. W.

Whelan (Ryerson University) and Dr. K. Zhang (Photonics Research Ontario), and built at the Ontario Cancer Institute/Princess Margaret Hospital. The laser diode system consisted of Fabry Perot based InAsGaP diodes (Apollo Instruments Inc., Irvine, CA). Two of the four channels emit light at 808nm and the other two at 940nm. In each channel, a maximum of 10W of optical energy is allowable via a diode fiber (400 micron, core diameter) coupled to the laser diode by the manufacturer. The diode fiber was coupled to an application fiber using an SMA-SMA mating sleeve. Since the developed controller is a Single Input Single Output (SISO) system, a single channel at 808nm wavelength was used for this project.

The application fiber had a 2 cm long cylindrical diffuser with a diameter of 800 microns (Photoglow, Yarmouth, MA). The diameter of the application fiber was chosen to be larger than the diode fiber to improve the coupling efficiency. The power at the business end of the application fiber and the diode fiber was measured using an integrated sphere (Labsphere, North Sutton, NH) and power meter (Ophir Optronics Inc., Wilmington, MA). The maximum coupling efficiency was approximately 65% at powers  5W.

3.3.3

Temperature measurement unit
A fluoroptic-based temperature measurement system (Model 3100 Luxtron Corporation, Santa

Clara, CA) was used. The Luxtron 3100 collects eight samples per second and outputs an averaged temperature reading every second. A set of clear Tefzel-tipped probes (0.55 mm, outer diameter) were used to measure temperature during the experiments. Luxtron probes are non-metallic and electrically non-conductive. They are less susceptible to "smearing" artifacts than metallic thermocouples, caused by heat conduction. This may be important in high gradient temperature fields, which can be generated

38

during interstitial thermal therapy. These probes are also immune to electromagnetic and radio-frequency interference providing a better choice over thermocouples for measuring temperature. However, the fluoroptic sensors can exhibit measurement artifacts when exposed to the near-infrared (NIR) laser wavelengths, likely due to probe self-heating caused by direct absorption of the laser energy (Davidson et al, 2005). This artifact is less than 1oC for sensors placed at least 5 mm from a source in the tissue and therefore is acceptable for our study.

3.3.4

Selection of temperature and laser power update interval
The controller is based on an MPC scheme. The laser-irradiated tissue (plant) model for the

controller was implemented in a state-space form (2.33 and 2.34) by solving the light diffusion equation (2.4) and the bioheat equation (2.8) using the finite difference method (FDM). FDM approximations of these models are achieved by dividing the spatial and temporal domains into finite spatial ( r ) and time intervals ( t ), respectively. From several trials, r = 0.5 mm was found to be sufficiently small to provide an accurate solution. The corresponding value of t = 1s was maximized based on the limit imposed by the Fourier condition of FDM solution of bioheat equation (Patankar, 1980). The timeline of operation of the controlled LITT treatment is represented in figure 3.2.

39

ts

tlaser update = ttemperature update
Figure 3.2 Illustration of the controller timeline. The controller computes control moves every laser power is updated only at a sampling period of also updated every

ts =1s but

tlaserupdate = 2s ; temperature measurements from sensors are

Ttemperatureupdate (case of a hypothetical scenario)

The MPC was implemented using MATLAB 7.2 Model Predictive Control Toolbox in a statespace form, which implements it as a discrete-time controller. In MALTAB's Model Predictive Control Toolbox, the plant model is sampled at the controller's sampling instant. Due to this limitation of the MPC toolbox, the sampling times of the controller and plant model were set equal such that

ts = t = 1s
Thus, the controller was capable of computing a control move every 1s.

(3.2) The values of

tlaserupdate and ttemperatureupdate depend on the data transmission/receiving speed of the Laser and Luxtron
system to/from the computer. The Luxtron 3100 has the capability to collect 8 samples per second and transmits an averaged temperature reading to the computer every 1.15 s, via RS232. Thus, the minimum value of ttemperatureupdate for the simulations and experiments was selected to be 2sec. For computational simplicity, tlaserupdate was selected equal to ttemperatureupdate . At any time instant, the laser power and temperature measurements were assumed constant until the next update interval.

40

3.4

Controller evaluation
To demonstrate the robustness of the LITT controller, the controller must be able to meet the

defined objective under realistic conditions, such as dynamic tissue optical properties, blood perfusion, and tissue cooling. The simulated tests of the LITT controller used the following simulated tissue models: (i) a one-dimensional simulated tissue model with homogenous tissue properties and constant blood perfusion rate, and (ii) a simulated dynamic LITT model. The dynamic LITT model better represents a real tissue environment since the effects of dynamic optical properties and blood perfusion due to heating were incorporated into the model. The second set of tests involved experimental evaluations, using tissue mimicking dynamic albumen phantoms with known optical and thermal properties.

3.4.1

Simulated tissue model with constant optical properties and blood

perfusion rate
The performance of the controller was tested while varying several system parameters such as the preset treatment time, maximum treatment duration (including the cooling off period), LITT model parameters, maximum allowable temperature at the source fiber, radius of coagulation and a desired threshold thermal dose. The LITT simulator and controller were initialized by setting the laser power to

umax . Temperature measurements at three different spatial locations (0 mm, 5 mm, 6 mm from the edge
of the application fiber) as computed by the simulated model were collected and updated into the controller every ttemperatureupdate . A new power level was then computed and applied to the simulated tissue model every tlaserupdate . The calculated power level by the controller was subject to constraints of umax and

Tmax, source .
A linear tissue model was implemented in a state-space form by using a finite difference formulation for the light diffusion equation and bio-heat transfer equation (see section 2.3.2). This model simulated the rise in tissue temperature due to laser heating in cylindrical coordinates. The computational 41

domain was 5 cm in the radial direction with a grid spacing ( r ) of 0.5 mm. The discretized time step ( t ) was 1 s. In this model, the optical properties of the tissue and blood perfusion rate were assumed to be homogenous and static during the treatment. The tissue model was implemented using the MATLAB 7.2 control toolbox in a state-space form.

Preliminary testing of the controller in a simple 1-D linear model was performed to evaluate its robustness in the case of a parametric mismatch between the patient model and plant model in the controller. A series of simulations with varying the magnitude of the mismatch with respect to tissue optical and thermal parameters, and blood perfusion rate was conducted. The tissue model and treatment parameters for the simulations are listed in table 3.1.

42

Table 3.1Simulated tissue model and treatment parameters for evaluation of LITT controller Values Parameter Symbol S.I Units Controller's model 0.055 1-D Linear tissue model* 3-D Dynamic tissue model** 10 3,5, and 7 2 0.055 0.6

± 10%
10 3 2 0.055 0.66, 0.54 -

± 20%
10 3 2 0.055 0.72, 0.48 -

± 50%
10 3 2 0.055 0.9, 0.3

Maximum power from the source Preset treatment time(s) Cool down time Application fiber radius Absorption coefficient of native tissue Absorption coefficient of denatured tissue Reduced scattering coefficient of native tissue Reduced scattering coefficient of denatured tissue Tissue density Tissue specific heat Thermal conductivity of tissue Blood perfusion rate (initial) Specific heat of blood

umax t preset tcooling ro
µa _ native µa _ denatured
' µs _ native

W min min cm cm-1 cm-1 cm-1 cm-1 gcm-3 Jg-1K-1 Wcm-1 K-1 kgm-3s-1 Jkg-1K-1

0.6

-

-

0.7

6

6.6, 5.4

7.2, 4.8

9, 3

6

' µs _ denatured

1.0045, 3.6 0.00588 0.00867

1.1049, 0.9040 3.96, 3.24 0.0065, 0.0053 0.0095, 0.0078 4.334, 3.456

1.2054, 0.8036 4.32, 2.88 0.0071, 0.0047 0.0104, 0.0069 4.6080, 3.0720 1.5067, 0.5022 5.4, 1.8 0.0088, 0.0029 0.0130, 0.0043
5.7600, 1.9200

13.8 1.05 3.6 0.00529 0.00867

t
ct kt winit cb

3.84

3.74

Arterial Tart K 37 37 37 37 temperature Thermal dose t43,critical eq. min. 240 240 240 240 critical * The values of tissue model parameters were selected within their respective ranges based on published literature values (see Table 2.1). **The 3-D dynamic model that simulated a laser-irradiated prostate tissue; optical and thermal properties were based on published values by Roggan and Muller (1995).

43

3.4.2

Simulated tissue model with dynamic optical properties and blood

perfusion rate
Tissue undergoes an array of changes due to heating, which results in a change in optical properties. It has been reported that coagulation can cause a 2 to 6 fold increase in scattering and a slight increase in absorption (Nau et al, 1999) when heated. This leads to more rapid temperature increase near the heating source due to reduced light penetration. Moreover, when tissue is heated, it reacts by initially dilating blood vessels thereby increasing blood flow. Due to this cooling effect and the dynamic change in optical properties prediction of tissue temperature and hence model based control is a challenge.

The testing of the LITT controller in a dynamic simulated laser-irradiated tissue model was intended to examine the ability of controller to deal with temperature-dependent optical properties and blood perfusion. This dynamic model was modified from the 3-D LITT Treatment Planning Software (LTPS) developed by S H.R. Davidson at the Ontario Cancer Institute (Davidson et al, 2005). The rise in temperature was computed by implementing the finite element solution of the light diffusion equation (2.4) and the bio-heat transfer equation (2.8). Coagulation-induced changes in the tissue optical properties and blood perfusion rate were incorporated by updating the optical properties and blood perfusion of each finite element at the end of each time step, according to the relationship described in equations 2.6, 2.7 and 2.15. The numerical solution for temperature rise was implemented in C++ using the Diffpack FEM class library (Inutech, Nurenberg, Germany). The FEM mesh was generated using Geompack (ZCS Inc., Calgary, Canada). The tissue properties and treatment parameters are listed in table 3.1. The LTPS was integrated with the LITT controller on a 1.59 GHz Pentium M personal computer (IBM). Figure 3.3 illustrates the integration.

At a time step k , LTPS computes the temperature by assuming initial (for the first time step) or previous (for all later time-steps) values of the temperature-dependent tissue properties at various spatial

44

locations, Tmeas ( k ) . The LTPS replaced a real patient in the controlled LITT studies. At the same instant the controller waits for the LTPS to update the temperature measurements for the computation of laser power, u (k ) . The computed

u (k ) is updated in the LTPS for the next time-step. The new tissue

properties are calculated based on the current thermal dose as described in the diagrammatic representation of a non-linear LITT model (figure 2.2). A wait routine is applied while updating the

u (k ) and Tmeas (k ) in both the LTPS and the LITT controller respectively. This is done to match the `real'
operational time of the controller and the LTPS.

45

Figure 3.3 Illustration of the controller platform for the evaluation in a dynamic simulated patient model using the LITT treatment planning software (LTPS).

46

3.4.3

Tissue equivalent albumen phantom
An albumen-based phantom was chosen for the experimental evaluation of the LITT controller

due to its demonstrated utility as a tissue-mimicking material for laser irradiation (Iizuka et al, 1999). The ingredients used in the preparation of the phantom are listed in table 3.2.
Table 3.2 Ingredients of albumen phantom used in the study based on the absorption of the dye solution 5.9 cm-1 at 810 nm.

Ingredients

Napthol Green Dye Stock Chicken Albumen Stock Distilled Water Bacteriological Agar

Composition (%, by weight) 13.3% 53.3% 32.0% 1.4%

Manufacturer

Sigma Crude, Grade II, Sigman, St. Louis, USA Agar #1, Oxoid, Hampshire, England

The phantom was prepared by combining an albumen stock solution and an agar-dye solution. The albumen stock solution was composed of 22.2% (by weight) chicken egg albumen and 77.8% (by weight) distilled water. The albumen was dissolved into the distilled water and stirred with a magnetic stirrer for approximately 30 min. or until the albumen was fully dissolved. A 53.3% (by weight) albumen stock was measured and warmed up in a water bath to 40oC. A dye solution was prepared separately by dissolving 0.387g of Napthol Green dye powder in 1 liter of distilled water which resulted in a 0.0387% (by volume) dye solution. A 13.3% (by weight) dye solution was combined with a 32.0% (by weight) amount of distilled water. First, the dye solution was heated to 70oC using a heating plate with magnetic stirrer. Next, the agar powder composed of 1.4% (by weight), was slowly added and dissolved. The agardye solution then heated to 85oC. Following this, the solution was removed from the heating plate and cooled in a warm water bath to 45oC. Once the solution reached its required temperature, the albumen stock solution was added to the agar-dye solution, thoroughly mixed and cooled to room temperature (in 2 hours).

47

The optical properties of these albumen phantoms are listed in table 3.3, as determined by Iizuka et al (1999).
Table 3.3 The native and coagulative optical properties of albumen phantom used in the study (Iizuka et al, 1999)

Property Native absorption coefficient
Denatured absorption coefficient Native reduced scattering coefficient Denatured reduced scattering coefficient

Symbol

µa _ native µa _ denatured

Value [cm-1] 0.50 ± 0.04
0.7 ± 0.1 2.67 ± 0.07 13.1 ± 0.5

µ s' _ native µ s' _ denatured

The native optical properties of the prepared albumen phantom were measured using diffuse reflectance spectroscopy with the help of staff at the Princess Margaret Hospital (Toronto, Canada) and were qualitatively comparable to the properties as listed in table 3.3. The coagulated properties were taken from Iizuka et. al, 1999.

The setup used for the albumen phantom experiments is shown in figure 3.4. In these experiments, the laser source fiber was placed in the centre of 6 cm x 6 cm x 6 cm plexiglass box. A 12gauge needle (2.77 mm, outer diameter) was used to position the source fiber and the fiber was sufficiently stiff to support its weight vertically in the box as shown in the figure. With the box empty, temperature sensor A was fastened to the source fiber, with the measuring tip placed in the middle of the diffuser length, 1.5 cm from the tip of the source fiber. An 18-gauge needle (1.27 mm, outer diameter) was used to position temperature sensor B at a radial distance of 5 mm from the edge of the source fiber. This distance was equal to the radius of the desired coagulation. Temperature sensor C was placed at a radial distance of 6 mm from the edge of the source fiber. The sensor C was positioned horizontally using clear quartz tubes (600 microns inner diameter, Vitrocom Inc., New Jersey, USA) to keep the fluoroptic probe firm into the phantom. With the devices in place, the box was filled with the heated albumen mixture which molded to the source and fluoroptic probes. The LITT experiment were conducted once 48

the mixture cooled to room temperature (~ 2 hours). These set of experiments in the albumen phantoms evaluated the ability of the developed LITT controller to deliver a prescribed thermal dose at 5 mm from the source in a preset treatment time(s) in the presence of dynamic optical properties.

To laser Sensor A

To luxtron

Cylindrical diffuser (source fiber)

Sensor B

12G needle

18G needle

Plexiglass box

Quartz tube

To luxtron 6 cm 2 cm 0.5cm 0.6cm 3 cm 6 cm 6 cm Sensor C

Figure 3.4 The experimental setup used to evaluate the LITT controller in albumen phantoms.

Before the laser was turned on, the temperature sensors were allowed to stabilize and record the phantom temperatures for 5s. An average of all the readings was taken to select the baseline temperature for the phantom. After 5s, the laser was turned on with umax = 5W. A series of nine experiments was

49

performed to evaluate the LITT controller for three different t preset (s). The treatment parameters used for the experiment are listed in table 3.4.
Table 3.4 Treatment parameters for the evaluation of controller in albumen experiments.

Treatment parameters t preset (min)

Experiment 1-3 11 20 3 0.055

Experiment 4-6 12 20 5 0.055

Experiment 7-9 15 20 5 0.055

tt (min) ttemperatureupdate = tlaserupdate (sec)
Fiber radius, ro (cm)

At the end of the treatment, the phantom was removed from the setup and was sliced open to expose the cross-section of the coagulation at the plane of the laser source fiber. The coagulation was observed and the radius of the coagulation was measured from the edge of the source fiber indentation to the boundary of the `whitened' albumen. A digital image of the exposed coagulated region was collected and analyzed. A new phantom was prepared for each experiment.

50

CHAPTER 4 - RESULTS AND DISCUSSION
4.1
4.1.1

Results
Uncertainty Analysis
Temperature-time plots were generated for three different radial distances, 1 mm, 3 mm and 5

mm, from the source for the spatial uncertainty analyses. The total treatment time tt was selected as 5min. and the temperature rise was recorded every 10 sec ( t ). Refer to the table 2.1 for the model parameters used.

Plot of time-histories of temperature and thermal dose. As shown in figure 4.1, the
uncertainty in temperature at 1 mm from the source (due to the uncertainty in tissue properties), at steady state is higher and decreases with distance from the source (figure 4.1). This is expected as the effect of variations in tissue thermal and optical properties on induced temperatures and thermal damage is diminished in regions far from the heating source, where minimal temperature elevations occur. The characteristic variations in thermal dose (fig. 4.2) agree quite well with those temperature. The thermal dose is more spread at 1 mm as compared to 3 mm and 5 mm.

Variance plots. Figure 4.3 shows that temperature is more sensitive to variability in thermal
properties than optical properties. The variation becomes smaller as we move away from the source. The variation due to thermal conductivity increases substantially after the tissue is coagulated. This is due to the modeled increase in optical scattering that occurs because of tissue coagulation, which causes

51

increased energy deposition around the heating applicator and thereby increased temperature. Same conclusions are drawn for thermal dose as well.

Temperature vs. time T( o C) 100 50 0 0 T( o C) 100 50 0 0 T( o C) 100 50 0 0 50 100 150 200 Time (sec) 250 300 50 @5mm 100 150 200 250 300 50 @3mm 100 150 200 250 300 @1mm

Figure 4.1 Temperature distribution at 1 mm, 3 mm and 5 mm from the source

52

log 10(t43) (min.) log 10(t43) (min.) log 10(t43) (min.)

40 @1mm 20 0 0 40 20 0 0 40 20 0 0

Thermal dose vs. time

50 @3mm

100

150

200

250

300

50 @5mm

100

150

200

250

300

50

100

150 Time (sec)

200

250

300

Figure 4.2 Thermal dose at 1 mm, 3 mm and 5 mm from the source

Two-sided tolerance limits plots. The min/max limits of temperature rise and thermal dose
accumulation at 3 mm are shown in fig. 4.4. The variance computed in temperature is 42.24 oC, 13.74 oC and 3.11 oC at 1 mm, 3 mm and 5 mm respectively. The over-all noise computed in thermal dose is 5.78 x 103 min., 0.02 x 103 min. and 0.002 x 103 min. at 1 mm, 3 mm and 5 mm respectively.

53

variance(T)

150 100 50 0 0 150 100 50 0 0 150 100 50 0 0 50 50 50

Variance of temperature vs. time
µa native µa denatured µs native µs denatured kt t 250 c t

100

150

200

300

variance(T)

100

150

200

250

300

variance(T)

100

150 Time (sec)

200

250

300

Figure 4.3 Spatial and temporal variance in temperature (Temporal points = 0s to 300s and spatial points = 1 mm, 3 mm and 5 mm)

Temperature at 3mm,  = 90%  = 95% 80 60 T(oC) 40 20 0 0 15 log (t43) (min.) 10 5 0 -5 0 50 100 150 Time (sec) 200 250 300 50 100 150 200 250 300

Thermal dose at 3mm,  = 90%  = 95%

Figure 4.4 Temperature and thermal dose vs. time at 3 mm from the source

54

Computation of Process Noise:

The total standard deviation in temperature was computed by taking average:

 temperature =

 
r =1 t =1

n

m

t ,r

mn

(4.1)

where,  t ,r is the standard deviation in the temperature at time point t and distance r from the source.

m is the total number of discretized time points such that t = 0, t , 2t ,...., mt and m =
the total number of spatial points. The computed variance or process noise was

tt where n is t

var(T ) = ( temperature ) = ( 3.90 C )
2

2

(4.2)

4.1.2

Sensitivity Analysis
A sensitivity analysis (SA) for optical parameters showed that the temperature and thermal dose

were more sensitive to tissue optical absorption as compared to tissue optical scattering. The overall relative sensitivity comparison of temperature and thermal dose to uncertainty in tissue properties showed that the plant outputs were more sensitive to thermal parameters than to optical parameters. A SA for thermal properties showed that the output parameters were more sensitive to tissue density and specific heat during the start of the treatment but more sensitive to tissue conductivity after coagulation is occurred. Figure 4.5 shows the treatment time comparison of relative sensitivity Sr of temperature and thermal dose. The horizontal lines on the vertical bars represent the treatment time. The uncertainty in tissue density and specific heat affects the temperature during first 50s, first 110s and first 200s of the treatment time at locations 1 mm, 3 mm and 5 mm from the source, respectively. The final output is most sensitive to tissue thermal conductivity, such that accurate knowledge of the uncertainty in thermal conductivity is critical.

55

'Temperature' 300 250 Tim e (sec) 200 150 100 50 0 10% 20% 30% 10% 20% 30% 10% 20% 30% 'Thermal dose' 300 250 Tim e (sec) 200 150 100 50 0 10% 20% 30% 10% 20% 30% 10% 20% 30% uncertainty in input (%)
1mm 1mm 3mm 1mm 3mm 3mm 5mm 5mm 1mm 1mm 1mm 3mm 3mm 5mm 3mm

pt, ct kt
5mm

pt, ct kt

Figure 4.5 Parameters that influence the temperature the most during the treatment time

4.1.3

Simulation results of Kalman Estimator
The plot (fig. 4.6) shows the rise in temperature at 5 mm from the source. The temperature in

patient was measured at three different locations, 1 mm, 3 mm and 5 mm from the source. The estimator estimated the true temperature and updated the states of the plant model in the presence of noisy measurements every 2 sec. The time-temperature plot shows that the implemented Kalman estimator has the ability to estimate and correct the model predicted temperature in a significant model mismatch scenario and possible treatment disturbances. The treatment disturbances include sudden rise in temperature due to change in optical properties and blood perfusion rate with the on set of coagulation in the tissue.

56

Estimation of true temperature by Kalman Estimator at 5mm from the source 48 T
measured estimated unestimated

T 46 T

Temperature( C)

44

o

42

40

38

36 0

0.5

1 Time (min.)

1.5

2

Figure 4.6 Estimation and correction of temperature by Kalman estimator in tissue; (...) shows the unestimated temperature as predicted by linearised LITT model; (---) shows the estimated temperature and (-) shows the measured noisy temperature at 5 mm from the source.

4.1.4

Simulated control of tissue with static properties
The performance of the controller was evaluated for various simplified laser-heating simulations

with uniform optical properties and blood perfusion rate. The tissue parameters were varied between 50% and +50% of the set of values used in the prediction model (see table 3.2). The treatment objective was to deliver 240 eq. min. dose at 5 mm from the source in a preset treatment time t preset of 3min while maintaining the temperature at the source fiber tip  90oC ( Tmax, source ). The maximum laser power

umax was set to 10W.

57

Parametric mismatch in tissue properties
Figures 4.7(a), 4.8(a) and 4.9(a) show the thermal dose response for the case of a parametric mismatch of +10%, -50% and +50% between the patient model and the controller prediction model respectively. Figures 4.7(b), 4.8(b) and 4.9(b) show the time history of the reference temperature

Tref (generated by the primary thermal dose control loop), estimated temperature response at 5 mm from
the source T5 mm , and estimated temperature response at the source Tsource . The resulting laser power profile as a function of time is shown in figures 4.7(c), 4.8(c) and 4.9(c).

In figure 4.7, the controller operated at the maximum power constraint of 10W at the start of the treatment, to rapidly increase the tissue temperature at 5 mm to Tref . The initial tracking of Tref was achieved in 40 s. At this time, temperature at the source reached 86.37oC, which was below the 90oC constraint. For the rest of the treatment time, the controller operated at a power level below 10W ( umax ) required to maintain T5 mm at Tref in order to continue delivering the remaining dose. During the last 5 s of the treatment, a rapid increase in laser power was predicted. This was in response to a change in the trajectory of Tref , to ensure the delivery of the remaining thermal dose at the end of 3 min. treatment time. The delivered dose at 5 mm at the end of 3min. was 239.7 eq. min. The dose and temperatures were continued to be recorded for another 2 min. while the tissue cooled down. The final thermal dose delivered was 269 eq. min.

58

Df = 240 min.,tpreset = 3.00 min.,constrained, T@source <=90C Dose(eq.min) 300 200 100
(a)
X: 180 Y: 239.7 X: 297 Y: 269

0 0 100

30

60
X: 40 Y: 86.37

90

120

150

180

210

240

270

300

T @source T @5mm Tref
(b)

T(C)

50 0 0 10 5

30

60

90

120

150

180

210

240

270

300

Input, power = 10W, parametric mismatch (+10%),Tart = 37C power(W)

(c)

0 0

30

60

90

120

150 180 time (sec)

210

240

270

300

Figure 4.7 Thermal dose control in a linearised tissue model with a parametric mismatch of +10%; t preset = 3 min (a) delivered thermal dose at r = 5 mm, (b) temperature profiles at r = 0 mm, r = 5 mm and reference temperature ( Tref ), and (c) control input (applied laser power).

For a -50% parametric mismatch, the initial tracking of Tref was achieved in 12 s (figure 4.8). At 12 s, the controller set the laser power to zero and held it constant for the next few seconds. The controller responded in this way to account for the overshoot in T5 mm . For a +50% mismatch (figure 4.9), the source temperature constraint was activated at 86s and 177s as the temperature reached 90oC. The controller demonstrated its ability to handle the constraint by modulating the laser power to a lower level. The delivered thermal dose at the end of the preset treatment time of 3 min. was 203.4 eq. min, which was lower than the desired dose of 240 eq. min. However, the total accumulated dose following cooling was 267.4 eq. min.

59

Df = 240 min.,tpreset = 3.00 min.,constrained, T@source <=90C Dose(eq.min) 300 200 100
(a)
X: 180 Y: 240 X: 298 Y: 243.4

0 0 80

30
X: 12 Y: 72.71

60

90

120

150

180

210

240

270

300

T(C)

60 40 20 0 10 5 30 60 90 120 150 180 210

T @source T @5mm Tref
(b)

240

270

300

Input, power = 10W, parametric mismatch (-50%),Tart = 37C power(W)

(c)

0 0

30

60

90

120

150 180 time (sec)

210

240

270

300

t preset

Figure 4.8 Thermal dose control in a linearised tissue model with a parametric mismatch of -50%; = 3min (a) delivered thermal dose at r = 5 mm, (b) temperature profiles at r = 0 mm, r = 5 mm and reference temperature ( Tref ), and (c) control input (applied laser power).

60

Df = 240 min.,tpreset = 3.00 min.,constrained, T@source <=90C Dose(eq.min) 300
X: 180 Y: 203.4

200 100

X: 299 Y: 267.4

(a)

0 0 100

30

60
X: 86 Y: 90

90

120

150

180
X: 177 Y: 90

210

240

270

300

T(C)

50 0 0 10 5

T @source T @5mm Tref
(b)

30

60

90

120

150

180

210

240

270

300

Input, power = 10W, parametric mismatch (+50%),Tart = 37C power(W)

(c)

0 0

30

60

90

120

150 180 time (sec)

210

240

270

300

t preset

Figure 4.9 Thermal dose control in a linearised tissue model with a parametric mismatch of +50%; = 3min (a) delivered thermal dose at r = 5 mm, (b) temperature profiles at r = 0 mm, r = 5 mm and reference temperature ( Tref ), and (c) control input (applied laser power).

The dose and temperature profiles with a parametric mismatch of -10% and ± 20% were qualitatively similar to the above results and are reported in Appendix A. Table 4.1 summarizes the data from these simulations. In all the cases except for a +50% parametric mismatch case, the delivered dose at 5 mm at t preset = 3 min. was within the range of 240 ± 5% eq. min. However, the accumulated dose at 6mm at the end of tt , following cooling was less than 240 eq. min. for all the cases. The inability of controller to deliver the desired dose in the case of +50% parametric mismatch was due to the under tracking of Tref by the temperature controller. The reduced laser power level to maintain the 90o C

61

temperature at the source, increased the tracking time. Prolonging the duration of t preset would have ensured the tracking of Tref and hence, the delivery of the remaining dose.
Table 4.1 Data on the performance evaluation of the LITT controller for various parametric mismatch cases;

t preset = 3min, tt = 5 min. The radius of coagulation was measured from the edge of the source fiber.
Dose (eq. min) at 5 mm at the end of t preset
203.4 239 239.7 240.1 240 240

Case studied for parametric mismatch +50% +20% +10% -10% -20% -50%

Dose (eq. min) at 5 mm at the end of tt 267.4 281.8 269 251.2 247.9 243.4

Dose (eq. min) at 6 mm at the end of tt 21.29 32.59 35.65 43.49 49.27 73.83

Radius of coagulation (mm)
5.08 5.12 5.08 5.04 5.03 5.02

Maximum temperature at the source (C) 90.00 87.66 86.37 83.31 80.05 72.71

Figure 4.10 illustrates the thermal dose as a function of position from the source (focused at the desired boundary of coagulation) and figure 4.11 illustrates the graphical comparison of evolution of dose at 5 mm at t preset and tt , and boundary of extended coagulation. It shows that damage was extended by at most ~0.12 mm. The coagulation radii for all the cases were well within the defined acceptable margin of +1 mm beyond the desired coagulation radius of 5 mm. The evaluation of the dose at the end of cooling period was critical to ensure that minimal extra dose was delivered after heating (laser off).

62

300 270 240 210 dose (eq.min.) 180 150 120 90 60 30 0 5
Extension of max. thermal damage boundary to ~5.12mm

-10% -20% -50% +10% +20% +50%

5.2 5.4 5.6 5.8 distance from the edge of source (mm)

6

Figure 4.10 Spatial thermal dose distribution for various cases of parametric mismatch. The dose was computed at the end of treatment after the tissue had cooled down.

63

Performance evaluation of LITT controller in 1-D simulated linear tissue model 280 240 200 160 120 80 40 0

Dose (eq.min)

-50%

-20%

-10%

10%

20%

50%
Dose@tpreset Dose@tfinal

Radial distance (mm)

5.15 radius of coagulation 5.1

5.05

5

-50%

-20%

-10%

10%

20%

50%

Figure 4.11 Graphical representation of evolution of thermal dose at 5 mm at extended coagulation.

t preset and tt and boundary of

Overall the studies utilizing a linearised tissue model have shown that: a) the performance of the controller was robust with respect to uncertainties in the values of tissue parameters; b) both temperature and power constraints could be easily incorporated, and c) the dose-temperature nonlinearities could be successfully handled using the developed two-step cascaded model predictive control scheme. Having obtained encouraging results for a linearised tissue model with constant optical properties and blood perfusion rate, the developed controller was tested on more realistic and complex tissue model with dynamic properties.

4.1.5

Simulated control of tissue with dynamic tissue properties
Figures 4.12, 4.13 and 4.14 show results obtained for thermal dose control simulations for a non-

linear tissue model with t preset equal to 3min, 5min, and 7 min. The non-linear model simulated laser64

irradiated tissue in which temperature dependent optical properties and blood perfusion rate were dynamic.

In all cases, during the beginning of the treatment, the controller operated at the maximum laser power until the initial tracking of Tref was achieved. The laser power and temperatures were updated every 5s which introduced jitter in the temperatures at the source and at 5 mm. Whenever, there was an overshoot in T5 mm , the controller responded by reducing laser power. Towards the end of the treatment, as the delivered thermal dose approached the desired thermal dose, Tref gradually dropped to zero and the laser power was set to zero.

It was evident from these results that the time required for the initial tracking of Tref was inversely proportional to t preset (provided the initial temperature in tissue was uniform for all the cases). Hence, the longer the treatment time, the lower Tref required to deliver the same thermal dose. The pulsating behavior in the laser power profile revealed that the developed controller always forced the activation of the maximum allowable laser power constraint. The 90o C temperature constraint at the source did not influence control decisions in any of the tested cases, as Tsource never exceeded 80o C.

65

Dose(eq.min.@430C)

Df = 240 eq. min., tpreset = 3min., constrainted, Tsource <= 90C 300 200 100 0 0 80 1 2 3 4 5
T @source T @5mm Tref
X: 3 Y: 244.2 X: 4.967 Y: 255.4

T(C)

60 40 20 0 0 10 1 2 3 Input, power = 10W, Ts = 5sec 4

5

power(W)

5 0 0

1

2 time (min)

3

4

5

Figure 4.12 Thermal dose control in nonlinear tissue model with

t preset = 3 min., Tmax, source = 90oC and

umax = 10W. From top to bottom ­ (i) delivered thermal dose, (ii) temperature profiles of Tref , Tsource and T5 mm ,
and (iii) control input (applied laser power)

66

Dose(eq.min.@430C)

Df = 240 eq. min., tpreset = 5min., constrained, Tsource <= 90C 300 200 100 0 0 80 1 2 3 4 5 6
T @5mm Tref
X: 5 Y: 241.9 X: 6.95 Y: 247.4

7
T @source

T(C)

60 40 20 0 0 10 1 2 3 4 5 Input, power = 10W, Ts = 5sec 6

7

power(W)

5 0 0

1

2

3 4 time (min)

5

6

7

Figure 4.13 Thermal dose control in nonlinear tissue model with

t preset = 5 min., Tmax, source = 90oC and

umax = 10W. From top to bottom ­ (i) delivered thermal dose, (ii) temperature profiles of Tref , Tsource and T5 mm ,
and (iii) control input (applied laser power)

67

Dose(eq.min.@430C)

Df = 240 eq. min., tpreset = 7min., constrained, Tsource <= 90C 300 200 100 0 0 80 1 2 3 4 5 6 7 8 9
X: 7 Y: 241.9 X: 8.967 Y: 249.4

T(C)

60 40 20 0 0 10 1 2 3 4 5 6 Input, power = 10W, Ts = 5sec 7

T @source T @5mm Tref

8

9

power(W)

5 0 0

1

2

3

4 5 time (min)

6

7

8

9

Figure 4.14 Thermal dose control in nonlinear tissue model with

t preset = 7 min., Tmax, source = 90oC and

umax = 10W. From top to bottom ­ (i) delivered thermal dose, (ii) temperature profiles of Tref , Tsource and T5 mm ,
and (iii) control input (applied laser power)

Table 4.2 Summary of the performance evaluation of the LITT controller with preset treatment times of 3 min., 5 min., 7 min.; tcooling = 2 min. for all the cases.

t preset (min.)
3 5 7

Dose (eq. min) at 5 mm at the end of t preset
244.2 241.9 241.9

Dose (eq. min) at 5 mm at the end of tt
255.4 247.4 249.4

Dose (eq. min) at 6 mm at the end of tt
43.49 35.65 49.27

Radius of coagulation (mm)
5.05 5.02 5.03

Maximum temperature at the source (C)
78.4 75.3 73.1

68

300 270 240 210 dose (eq.min.) 180 150 120 90 60 30 0 5
Extension of max. thermal damage to ~5.05mm

3min 5min 7min

5.1

5.2 5.3 5.4 5.5 5.6 5.7 5.8 distance from the edge of source (mm)

5.9

6

Figure 4.15 Spatial thermal dose distribution as a function of

t preset (3, 5 and 7 min.). The dose was

computed at the end of treatment after the tissue had cooled down.

The performance parameters critical to the evaluation of the LITT controller in a non-linear tissue are summarized in table 4.2. The delivered thermal dose at the end of the different t preset (s) was within the acceptable range of 240 ± 5% eq. min. Figure 4.15 shows the evolution of thermal dose at various radial points at the end of tissue cooling period and figure 4.16 illustrates the graphical comparison of evolution of dose at 5 mm at t preset and tt , and boundary of extended coagulation. A sharp gradient in the delivered thermal dose beyond the desired region of coagulation (5 mm) was observed. The coagulation boundary extended 0.05 mm (maximum) beyond the target point (5 mm from the heating source).

69

Performance evaluation of LITT controller in simulated dynamic tissue model 280 240 200 160 120 80 40 0

Dose (eq.min)

3min

5min

7min
Dose@tpreset Dose@tfinal

Radial distance (mm)

5.1 radius of coagulation 5.08 5.06 5.04 5.02 5 3min 5min 7min

Figure 4.16 Graphical representation of evolution of thermal dose at 5 mm at extended coagulation.

t preset and tt and boundary of

These results confirm that the desired final thermal dose was accurately delivered despite substantial prediction errors introduced by the simple one-dimensional model used in the MPC framework. These prediction errors were due to the modeled dynamic optical properties, dynamic blood perfusion rate in the model and parametric mismatch between the values of tissue parameters. The controller also repeatedly achieved the defined goals in all selected treatment times.

4.1.6

Evaluation of controller in albumen phantom
The control framework was the same as in the simulations testing, except that the maximum

power level was set to 5W. The power saturation limit was set to umax = 5W to demonstrate the controller's ability to achieve treatment goals with constrained laser power.

70

Figures 4.17-4.19 show the results from three experiments of thermal dose control during laser heating in an albumen phantom with t preset = 11 min., 12 min. and 15 min. respectively. In experiment # 1 with t preset = 11 min. (fig. 4.17), at the beginning of the treatment the controller operated at the maximum laser power to rapidly bring T5 mm to Tref . At 8.1 min, the controller reduced the laser power to maintain

T5 mm at Tref . During the entire treatment, the power constraint was active that forced the controller to
operate the laser power at its maximum value. This led to the pulsating laser power profile after 8.1 min observed in figure 4.14. Towards the end of t preset , as the delivered thermal approached the desired value 240 eq. min., the reference temperature trajectory, Tref dropped to zero. The controller responded by switching off the laser power. Additional thermal dose continued to be delivered until the phantom cooled down. During the entire treatment, the 90o C temperature constraint at the source did not influence the control decisions as the Tsource never exceeded 80o C (see table 4.3).

The dose, temperature and power profiles (fig. 4.18 and 4.19) for t preset = 12 min. and 15 min. were qualitatively similar to results from experiments with t preset as 11 min. The controller operated the laser at maximum power throughout the entire treatment and maintained the temperature at 5 mm equal to the reference temperature by automatically adjusting the laser power. The maximum overshoot in temperatures at 5 mm, observed in all the experiments was less than 1oC. Whenever there was an overshoot, the controller compensated by modulating the laser power appropriately to achieve the treatment temperature objectives. The desired thermal dose was delivered in all the experiments. In all of these experiments, the maximum temperature at the source was lower than Tmax, source . Thus, the temperature constraint was inactive throughout the entire treatment for all the experiments.

71

The results for other six other trials were qualitatively similar to above results and are reported in Appendix A.
Dose(eq.min.@430C) Experiment # 1; Df = 240min.,tpreset = 11min.,constrained, Tsource <=90C 300 200 100 0 0 80 60 40 20 0 0 1 2 3 4 5 6 7 8 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 T @source T @5mm Tref
X: 11 Y: 240.1 X: 19.82 Y: 255.9

T(C)

9 10 11 12 13 14 15 16 17 18 19 20
initial

Input, power = 5W, Ts = 3sec, T power(W) 5 2 0 0 1 2 3 4 5 6 7 8

= 22.58C

9 10 11 12 13 14 15 16 17 18 19 20 time (min)

Figure 4.17 Results from experiment # 1 of thermal dose control in albumen phantom with min.,

t preset = 11

Tmax, source  90oC and umax = 5W. Tmax, source = 90oC and umax = 10W. From top to bottom ­ (i) delivered Tref , Tsource and T5 mm , and (iii) control input (applied laser power)

thermal dose, (ii) temperature profiles of

72

Dose(eq.min.@430C)

Experiment # 1, Df = 240min.,tpreset = 12min.,constrained, Tsource <=90C 300 200 100 0 0 80 60 40 20 0 0 3 6 9 12 15 3 6 9 12 15 18
T @source T @5mm Tref
X: 12.03 Y: 239.9 X: 19.67 Y: 268.3

20

T(C)

18

20

Input, power = 5W, Ts = 5sec, Tinitial = 21.98C power(W) 4 2 0 0 3 6 9 12 time (min) 15 18 20

Figure 4.18 Results from experiment # 1 of thermal dose control in albumen phantom with min.,
o

t preset = 12

Tmax, source  90 C and umax = 5W. From top to bottom ­ (i) delivered thermal dose, (ii) temperature profiles
of

Tref , Tsource and T5 mm , and (iii) control input (applied laser power)

73

Dose(eq.min.@430C)

Experiment # 1, Df = 240min.,tpreset = 15min.,constrained, Tsource <=90C 300 200 100 0 0 80 60 40 20 0 0 5 10 15 5 10 15 20 T @source T @5mm Tref
X: 14.97 Y: 238.9 X: 19.62 Y: 254

T(C)

20

Input, power = 5W, Ts = 5sec, Tinitial = 22.27C power(W) 4 2 0 0 5 10 time (min) 15 20

Figure 4.19 Results from experiment # 1 of thermal dose control in albumen phantom with min.,
o

t preset = 15

Tmax, source  90 C and umax = 5W. From top to bottom ­ (i) delivered thermal dose, (ii) temperature profiles
of

Tref , Tsource and T5 mm , and (iii) control input (applied laser power)

Data from all the experiments and their respective statistical averages and standard deviations, critical for the evaluation of the performance of LITT controller in albumen phantom are summarized in table 4.3.

74

Table 4.3 Data and statistics on the performance evaluation of LITT controller in the albumen phantom experiments. The radius of coagulation was measured from the edge of the source fiber and total treatment duration, tt = 20 min. for all the cases.

Preset treatment time, t preset (min)

Dose (eq. min) at 5 mm at the end of t preset
238.08 238.53 239.18 238.59 0.553 236.73 239.8 237.01 237.84 1.69 239.54 239.85 238.5 239.296 0.707

11

12

15

Exp. #1 Exp. #2 Exp. #3 Average StdDev. Exp. #1 Exp. #2 Exp. #3 Average StdDev. Exp. #1 Exp. #2 Exp. #3 Average StdDev.

Dose (eq. min) at 5 mm at the end of tt 255.93 267.99 256.8 260.24 6.73 268.35 251.27 266.7 262.1 9.42 253.95 250.86 257.3 254.04 3.22

Dose (eq. min) at 6 mm at the end of tt 11.108 8.804 12.688 10.867 1.953 25.51 28.063 10.496 21.356 9.49 23.862 33.241 29.388 28.831 4.71

Radius of coagulation at the end of treatment (mm)
5.03 5.06 5.04 5.04 0.01 5.07 5.04 5.06 5.05 0.01 5.04 5.03 5.05 5.04 0.01

Initial temperature Tart (C)
22.58 22.11 23.9 22.86 0.928 21.98 25.21 21.58 22.92 1.998 22.27 25.27 25.44 22.326 1.783

Maximum temperature at the source (C)
73.6 75.1 84.3 77.7 5.8 73.1 72.2 74.8 73.34 1.32 74.0 72.5 72.4 73.0 0.9

75

280

240

200 dose (eq.min.)

160

120

80

40

0

5

5.2 5.4 5.6 5.8 distance from the edge of source (mm)

6

Figure 4.20 Spatial thermal dose at 5 mm, 5.5 mm and 6 mm for various experiments; dose was computed at the end of treatment after the tissue had cooled down for preset treatment times = 11 min., 12 min., and 15 min.

The delivered thermal dose at the end of preset treatment time t preset was within the range of 240

± 5% eq. min. in all the experiments. Figure 4.20 shows the thermal dose at various radial points at the
end of the cooling period and figure 4.21 illustrates the graphical comparison of evolution of dose at 5 mm at tt and boundary of extended coagulation for all the nine experiments. Similar to the simulation results, a sharp delineation of the delivered thermal dose beyond the desired region of coagulation (5 mm from the edge of the source) was observed. As shown in these plots and Table 4.3, the average predicted coagulation radius at the end of treatment, was between 5.04 mm ± 0.1 mm and 5.05 mm ± 0.1 mm in all the experiments. It is evident from this data that the controller was able to limit the damage within the defined critical margin of 1 mm beyond the desired coagulation radius of 5 mm.

76

Performance evaluation of LITT controller in albumen phantom experiments 280 240 200 160 120 80 40 0

Dose (eq.min)

11min

12min

15min

Radial distance (mm)

5.1 5.08 5.06 5.04 5.02 5 11min 12min 15min

Figure 4.21 Graphical representation of evolution of thermal dose at 5 mm at coagulation.

tt and boundary of extended

There were deviations in the delivered dose and radius of coagulation between these nine experiments even though the same phantom material was used. This was likely due to the variations in the initial temperature 21.98-25.44oC (see table 4.3), optical properties of the nine phantoms and selected laser power update time interval ( tlaserupdate = 3s, 5s, 5s for t preset = 11min, 12min, 15min, respectively). The LITT controller was able to compensate for these variations by modulating the laser power appropriately to achieve the treatment objectives.

Figure 4.22 shows a picture of the typical coagulation observed in the albumen phantom studies. The photograph of the thermal damage shows a demarcation between the coagulated and native albumen. The radius of the coagulation was measured orthogonally from the edge of the hollow indentation left by

77

the source fiber. The average coagulation radii were 4.93 mm ± 0.64 mm, 4.39 mm ± 0.48 mm and 4.66 mm ± 0.78 mm for the preset treatment times of 11 min., 12 min., and 15 min. respectively. The measurement uncertainty for each coagulation radius is ± 1 mm. The measured coagulation radii in each case were consistently smaller than the predicted values (see table 4.3).

Figure 4.22 Coagulation observed after performing a controlled LITT in an albumen phantom.

4.2
4.2.1

Discussion
Evaluation of the performance of thermal dose LITT controller

Tissue model with uniform optical properties and blood perfusion rate
Expected dose-temperature nonlinearities that exist during laser tissue heating could be successfully handled using the developed two-step cascaded model predictive control scheme. The

78

controller accurately and repeatedly delivered the prescribed thermal dose in a preset treatment time, which is a unique feature of the developed control strategy.

The evaluation of the performance of the LITT controller using the linearised tissue model with static tissue properties showed that the LITT controller was not sensitive to variations in the tissue parameters. The LITT controller successfully achieved the treatment goals in the presence of a substantial mismatch between the tissue parameters in the MPC and the tissue simulation model. It was also observed that the shortest time taken by the controller for the initial tracking of Tref (12s) occurred with a -50% parametric mismatch (figure 4.8), due to the faster rise in temperature as shown in figure 4.23. This figure shows the comparison of an uncontrolled rise in temperature for various tissue properties. For all the cases, the laser power was set to a constant value of 10W.

The simulation results also demonstrated that both temperature and power constraints could be easily incorporated. The controller applied the maximum allowed laser power ( umax = 10W) at the beginning of the treatment until either the temperature at the source, Tsource was greater than the maximum allowable temperature constraint or temperature at 5 mm was greater than the reference temperature. Whenever the temperature constraint was reached or exceeded, the controller automatically modulated the laser power to maintain the Tsource close to the maximum allowable value of 90oC as shown in figure 4.9. It was observed that the selection of an appropriate preset treatment time was necessary for success. As observed in figure 4.9, the selected preset treatment (3min) was too short to deliver the desired thermal dose. As the temperature constraint became active, the laser power was reduced to a lower level due to which a drop in tissue temperatures occurred. Hence, the controller was unable to track the Tref completely in a remaining t preset , resulting in an inaccurate delivery of thermal dose.

79

Comparison of rise in temperature for various parametric mismatch cases
45 40 35 -10% +10% -20% +20% -50% +50% Prediction model

Rise in temperature (C)

30 25 20 15 10 5 0

0

50

100

150

200

250

300

Time (sec)

Figure 4.23 Comparison of rise in temperature in a linearised tissue model for different parametric mismatch cases; laser power = 10W

The radius of coagulation, measured at the end of treatment (including the cooling off period), was between 5.02 mm to 5.12 mm, close to the desired radius of coagulation of 5 mm. A sharp delineation in thermal dose was observed beyond 5 mm, ensuring the protection of surrounding healthy tissue from thermal damage. Having obtained encouraging results for scenarios representing patient-topatient variability in tissue parameters, tested using a linearised tissue model with constant optical properties and blood perfusion rate, the developed controller was applied to a more realistic and complex 3-D tissue model.

Tissue model with dynamic optical properties and blood perfusion rate
The results obtained demonstrated the ability of the controller to deliver the desired thermal dose despite substantial prediction errors introduced by the simple one-dimensional model used in the MPC

80

framework. The maximum temperature reached at the source in all the testing scenarios was lower than 90o C. The controller updated the applied power to ensure the appropriate tracking of the reference temperature until the end of preset treatment time. The laser power and temperature update intervals were selected to be 5s to reflect the hardware constraints, which created a mismatch with the controller sampling time of 1s. This resulted in overshoots in temperature at 5 mm and a faster accumulation of thermal dose. In this scenario, the controller acted more aggressively as compared to the linearised model results, by rapidly changing the laser power between the maximum power and zero. The primary thermal dose controller updated the reference trajectory accordingly based on the remaining dose to be delivered. The developed controller also achieved the defined treatment goals in various preset treatment times of 3 min., 5 min., and 7 min. Moreover, the average coagulation boundary extended to only 0.033 mm beyond the desired radius of coagulation (5 mm).

These results demonstrated that despite the small overshoots in temperature, the delivered thermal dose at the end of the preset treatment time was within the acceptable range of 240 ± 5% eq. min. In addition, the progression of coagulation boundary beyond 5 mm was less than the critical margin of 1 mm.

The simulated nonlinear tissue model has a limited clinical applicability for planning a controlled LITT treatment for tumor applications given the lack of experimental validation. As discussed above, the controller demonstrated satisfactory results for various treatment parameters such as a preset treatment time, maximum allowable laser power and laser power update interval. However, selecting these parameters as optimal clinical treatment parameters based on these results would require experimental validation of the LITT simulation model (Davidson et al, 2005) used to evaluate the controller. Such validation could be a focus of a Master's thesis. In an attempt to better understand the validity of the LITT simulation model, a comparison with experimental data was conducted.

81

Comparison of rise in temperature 50 45 40 Temperature Rise(C) 35 30 25 20 15 10 5 0 0 2 4 Time (min)
Figure 4.24 Comparison of temperature measurements at r = 5 mm and r = 6 mm with numerical predictions for albumen phantom
Albumen Phantom Laser power = 5W Numerical prediction:5mm Numerical prediction:6mm Experimental:5mm Experimental:6mm

6

8

10

Figure 4.24 shows the comparison between the measured and model-predicted temperatures in an albumen phantom for an uncontrolled laser heating experiment (with laser power = 5W). The Luxtron probes were placed at 5 mm and 6 mm as described in the experimental setup in figure 3.3. The values of the optical and thermal properties in the LITT simulation were assumed to be those of the albumen phantom (see table 3.4) and the blood perfusion rate was set to zero. The temperatures were measured for 10 min. with applied laser power was set to 5W. This comparison showed that the predicted results by the LITT simulation model overestimated the temperature measurements in albumen phantom by approximately 72% at 5 mm and 90.5% at 6 mm. The percent deviations represented an average deviation over the period of 10 min. A number of factors could contribute to this difference. One factor could be the positioning error of sensors as large thermal gradients of 5-10oC per mm are expected. Another factor

82

could be the actual (i.e. experimental) delivery of less optical energy compared to the laser power input in the simulations. Although a power of 5W was measured out the business end of the fiber (see section 3.4(a)), a digital image taken when the experiment was in progress (figure 4.25), revealed that some energy at the business end was reflected back into the fiber contributing to the additional loss. The pink glow in the image showed the diffusion of light beyond the active diffusing region of 2 cm from the fiber tip. This loss could be either due to the nature of design of cylindrical source fiber (proprietary mirror design) or reflection of light due to the highly scattering medium (albumen phantom). Better agreement was observed between the numerical and experimental temperatures for a laser power of 3.5W in the LITT simulation model. Additional studies would be required to confirm the source and magnitude of power loss.

Figure 4.25 A digital image of the setup while experiment was in progress. Dimensions: active length of cylindrical fiber = 2 cm, length of fiber inside the phantom = 3 cm, phantom box = 6 cm x 6 cm x 6 cm.

83

Tissue Model ­ Albumen phantom

The results obtained in the heating experiments in albumen phantom demonstrated the ability of controller to respond to 1) treatment disturbances such as dynamic temperature induced changes in tissue optical properties and 2) experimental variations in the phantom properties such as sample preparation and different initial temperatures. Additionally, the induced coagulation was reproducible with coagulation radii of 4.93 mm ± 0.64 mm, 4.39 mm ± 0.48 mm and 4.66 mm ± 0.78 mm for preset treatment times of 11 min., 12 min., and 15 min. respectively. Despite using a basic LITT model in the MPC framework and having limited knowledge of tissue optical properties, the controller was able to deliver the prescribed thermal dose in a user defined preset treatment, while ensuring that the maximum temperature at the source remained below 90oC.

4.2.2

Evaluation of current set up of LITT controller
Overall, the developed LITT controller was able to repeatedly meet the treatment objectives,

demonstrating its robustness with respect to uncertainties in the tissue parameters and various treatment disturbances such as changes in temperature-dependent tissue properties. Moreover, the controller was able to automatically deliver the specified thermal dose in a user defined preset treatment time and limit the induced coagulation to within 1mm of the target boundary without violating the treatment constraints. However, a number of observations were made regarding the sensitivity of the MPC to various treatment parameters critical for its satisfactory performance. These treatment parameters include the laser power and temperature update time intervals, the preset treatment time, and the number of point temperature measurements.

(a) Sampling time: The selection of a laser power and temperature update time interval greater than the controller sampling time leads to a pulsating laser profile. This is a result of the controller updating the laser power at a lower frequency than the computed control moves, leading to a constant 84

laser power for a longer time than required. This results in an overshoot in temperatures. The controller responds by modulating the laser power accordingly such that the temperature tracking error is minimized (as demonstrated in the results obtained in the nonlinear simulated tissue model and albumen phantom). On the other hand, if the laser power update interval is equal to the controller sampling time, an appropriate laser power was computed and applied to maintain the desired tracking without any overshoots (as shown in Figures 4.7-4.9). However, the minimum sampling time for laser power and temperature measurement update are part of the hardware limitations. Faster temperature update from the temperature monitoring device to the computer would lead to better control, and pulsating power behavior could be obviated.

(b) Preset treatment time: The minimum preset treatment time depends on the available
maximum laser power. The selected preset treatment time should be optimized for the controller to track the reference temperature. With lower t preset , the reference temperature computed by the thermal dose controller would be too high to be tracked by the temperature controller for a given maximum allowed laser power. In addition, if the temperature constraint becomes active, the controller may under-track the reference temperature leading to a lower dose than desired (as demonstrated in figure 4.9). This situation could be prevented by selecting a sufficiently long t preset .

(c) Number of point temperature measurements: As observed in any point temperature
feedback strategy, the temperature outside the sensor locations remains unknown. The current developed control strategy overcomes this limitation by incorporating a Kalman estimator that provided an estimated temperature map of whole target region. The Kalman estimator used temperature measurements obtained from the tissue to correct and update the temperatures predicted by the controller model. However, the temperature measurements at more spatial locations compared to current set-up can provide better estimate of complete temperature map.

85

Overall, these results demonstrated that the developed control approach would allow a physician to specify the sampling time(s), safety constraint, hardware constraints, duration of treatment, and treatment goals such that a desired radius of coagulation could be achieved.

86

CHAPTER 5 ­ SUMMARY, CONCLUSION AND FUTURE WORK

5.1

Summary
The motivation for this thesis work was the need to develop a control system for LITT, which

would allow a physician to concentrate on clinically relevant treatment objectives of delivering the prescribed thermal dose, while automatically adjusting the laser power based on temperature measurements. The primary goal of the controller is to deliver the prescribed thermal dose to a target location in the tumor in a pre-set treatment time while respecting the temperature and laser power constraints. This control system is unique to the field of laser based thermal treatment in several ways:

Feedback control of thermal dose: The direct, automatic control of thermal dose is difficult to
achieve compared to controlling temperature because of the nonlinear, integrating relationship between temperature and thermal dose. The thermal dose is a monotonic function that continues to accumulate after the termination of treatment, while tissue temperatures remain above body temperature (37oC). In our approach, a controller with a cascaded two-step structure was developed which indirectly controlled the delivery of thermal dose by directly controlling the tissue temperature. It consisted of the main, thermal dose control loop, which dynamically updates the reference temperature for the secondary temperature control loop, which was used to manipulate the applied laser power.

Delivery of thermal dose in a preset treatment time: The designed controller automatically
delivered the prescribed thermal dose in a pre-set treatment time, which was the first effort to implement such a feature while controlling the thermal dose directly for laser based thermal treatments.

87

Constrained control of thermal dose:

The controller dynamically solved the constrained

optimization problem, where treatment constraints were imposed on the maximum allowable laser power and tissue temperature. The laser power constraint was imposed to reflect the hardware limitation in clinical settings while maximum temperature constraints prevent the tissue carbonization and fiber tip damage. The controller achieves the treatment goals while ensuring maintaining maximum tissue temperatures remains below 90oC and applied laser power is within its maximum limits.

The developed controller is model-based and model-predictive: The model-predictive control
strategy allows the system to be pro-active as it has the ability to foresee any violations of constraints unlike other model-based or black box controllers. The model used in the controller is linear and computationally inexpensive. The model state is continually updated to minimize the error between the model predicted temperatures and the actual measured temperatures. This feature makes the controller adaptable to the unpredictable non-linear dynamic tissue properties such as blood perfusion and optical properties. In addition, the model-predictive controller is insensitive to inter-patient variations.

Control of thermal dose at non-sensor locations: The controller has the ability to control
damage at non-sensor locations by incorporating an estimator into the design. The estimator used in this study is a standard Kalman filter, a dynamic computer model that estimates the true temperature at sensor and non-sensor locations based on the error between the predicted temperatures by the model and measured temperatures at the sensor locations.

5.2

Conclusion
The demonstrated LITT controller was able to meet the treatment objectives repeatedly by

demonstrating its robustness with respect to uncertainties in the tissue parameters and various treatment disturbances such as changes in temperature-dependent tissue properties. The developed LITT controller was able to achieve the temperature tracking with only 1% overshoot as compared to the temperature controllers developed by other researchers such as Choy et. al (2003), where an overshoot of 5% was observed. Moreover, the controller was able to automatically deliver 240 eq. min of thermal dose in a user defined preset treatment time and limit the coagulation region to within 1 mm of target (beyond 5 mm) without violating the system constraints in experimental evaluations.

88

5.3

Future work
The next step in the development of the controller would be to evaluate the current control

framework in ex-vivo tissues and perfused phantoms to demonstrate its robustness in achieving treatment objectives in dynamic tissue models.

The developed controller is a single input single output system and utilizes a linear, onedimensional model to predict the temperature distributions. Future development of an LITT controller for multiple source applicators would require incorporation of a three-dimensional laser-irradiated tissue model in the control framework to control thermal dose at multiple points in the target.

The current framework uses point-based temperature feedback from limited sensor locations in the tissue and incorporates a Kalman estimator to estimate a true temperature map for the entire region of interest. However, the developed control system can be extended to image-based thermometry such as localized magnetic resonance (MR) temperature measurements. MR thermal images may be viewed as a collection of a large number of point wise temperature measurements, which can be used as a discrete feedback temperature inputs into the controller.

The proposed approach to laser based thermal treatment control can be extended to other heating modality based thermal treatments such as High Intensity Focused Ultrasound. This would require adapting the predictive model to tissue's thermal response to ultrasound heating.

89

APPENDIX A

RESULTS

Df = 240 min.,tpreset = 3.00 min.,constrained, T@source <=90C Dose(eq.min) 300 200 100
(a)
X: 180 Y: 240.1 X: 298 Y: 251.2

0 0 100

30
X: 28 Y: 83.31

60

90

120

150

180

210

240

270

300

T(C)

50 0 0 10 5

T @source T @5mm Tref
(b)

30

60

90

120

150

180

210

240

270

300

Input, power = 10W, parametric mismatch (-10percent),Tart = 37C power(W)

(c)

0 0

30

60

90

120

150 180 time (sec)

210

240

270

300

Figure A.1 Thermal dose control in a linearised tissue model with a parametric mismatch of -10%; t preset = 3 min (a) delivered thermal dose at r = 5 mm, (b) temperature profiles at r = 0 mm ( Tsource ), r = 5 mm ( T5 mm ) and reference temperature ( Tref ), and (c) control input (applied laser power).

90

Df = 240 min.,tpreset = 3.00 min.,constrained, T@source <=90C Dose(eq.min) 300 200 100
(a)
X: 180 Y: 240.1 X: 297 Y: 247.9

0 0 100

30
X: 22 Y: 80.05

60

90

120

150

180

210

240

270

300

T(C)

50 0 0 10 5

T @source T @5mm Tref
(b)

30

60

90

120

150

180

210

240

270

300

Input, power = 10W, parametric mismatch (-20%),Tart = 37C power(W)

(c)

0 0

30

60

90

120

150 180 time (sec)

210

240

270

300

Figure A.2 Thermal dose control in a linearised tissue model with a parametric mismatch of -20%; t preset = 3 min (a) delivered thermal dose at r = 5 mm, (b) temperature profiles at r = 0 mm ( Tsource ), r = 5 mm ( T5 mm ) and reference temperature ( Tref ), and (c) control input (applied laser power).

91

Df = 240 min.,tpreset = 3.00 min.,constrained, T@source <=90C Dose(eq.min) 300 200 100
(a)
X: 180 Y: 238 X: 299 Y: 281.8

0 0 100

30

60
X: 48 Y: 87.66

90

120

150

180

210

240

270

300

T(C)

50 0 0 10 5

T @source T @5mm Tref
(b)

30

60

90

120

150

180

210

240

270

300

Input, power = 10W, parametric mismatch (+20%),Tart = 37C power(W)

(c)

0 0

30

60

90

120

150 180 time (sec)

210

240

270

300

Figure A.3 Thermal dose control in a linearised tissue model with a parametric mismatch of -20%; t preset = 3 min (a) delivered thermal dose at r = 5 mm, (b) temperature profiles at r = 0 mm ( Tsource ), r = 5 mm ( T5 mm ) and reference temperature ( Tref ), and (c) control input (applied laser power).

92

Dose(eq.min.@430C)

Experiment # 2, Df = 240min.,tpreset = 11min.,constrained, Tsource <=90C 300 200 100 0 0 80 60 40 20 0 0 5 2.5 0 0 1 2 3 4 5 6 7 8 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20
T @source T @5mm Tref
X: 11.02 Y: 241.6 X: 19.72 Y: 268

T(C)

9 10 11 12 13 14 15 16 17 18 19 20

Input, power = 5W, Ts = 3sec, Tinitial = 22.11C power(W)

1

2

3

4

5

6

7

8

9 10 11 12 13 14 15 16 17 18 19 20 time (min)

Figure A.4 Results from experiment # 2 of thermal dose control in albumen phantom with t preset = 11 min.,

Tmax, source  90oC and umax = 5W. From top to bottom ­ (i) delivered thermal dose, (ii) temperature profiles of Tref ,

Tsource and T5 mm , and (iii) control input (applied laser power)

93

Dose(eq.min.@430C)

Experiment # 3, Df = 240min.,tpreset = 11min.,constrained, Tsource <=90C 300 200 100 0 0 80 60 40 20 0 0 1 2 3 4 5 6 7 8 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20
T @source T @5mm Tref
X: 11.03 Y: 241.3 X: 19.18 Y: 256.8

T(C)

9 10 11 12 13 14 15 16 17 18 19 20

Input, power = 5W, Ts = 3sec, Tinitial = 23.90C power(W) 4 2 0 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 time (min)

Figure A.5 Results from experiment # 3 of thermal dose control in albumen phantom with t preset = 11 min.,

Tmax, source  90oC and umax = 5W. From top to bottom ­ (i) delivered thermal dose, (ii) temperature profiles of Tref ,

Tsource and T5 mm , and (iii) control input (applied laser power)

94

Dose(eq.min.@430C)

Experiment # 2, Df = 240min.,tpreset = 12min.,constrained, Tsource <=90C 300 200 100 0 0 80 60 40 20 0 0 3 6 9 12 15 3 6 9 12 15 18
T @source T @5mm Tref
X: 12.03 Y: 241.3 X: 19.72 Y: 251.3

20

T(C)

18

20

Input, power = 5W, Ts = 5sec, Tinitial = 25.21C power(W) 4 2 0 0 3 6 9 12 time (min) 15 18 20

Figure A.6 Results from experiment # 2 of thermal dose control in albumen phantom with t preset = 12 min.,

Tmax, source  90oC and umax = 5W. From top to bottom ­ (i) delivered thermal dose, (ii) temperature profiles of Tref ,

Tsource and T5 mm , and (iii) control input (applied laser power)

95

Dose(eq.min.@430C)

Experiment # 3, Df = 240min.,tpreset = 12min.,constrained, Tsource <=90C 300 200 100 0 0 80 60 40 20 0 0 3 6 9 12 15 3 6 9 12 15 18 20
X: 12.05 Y: 241.5 X: 19.53 Y: 266.7

T @source T @5mm Tref

T(C)

18

20

Input, power = 5W, Ts = 5sec, Tinitial = 21.58C power(W) 4 2 0 0 3 6 9 12 time (min) 15 18 20

Figure A.7 Results from experiment # 3 of thermal dose control in albumen phantom with t preset = 12 min.,

Tmax, source  90oC and umax = 5W. From top to bottom ­ (i) delivered thermal dose, (ii) temperature profiles of Tref ,

Tsource and T5 mm , and (iii) control input (applied laser power)

96

Dose(eq.min.@430C)

Experiment # 2, Df = 240min.,tpreset = 15min.,constrained, Tsource <=90C 300 200 100 0 0 80 60 40 20 0 0 5 10 15 5 10 15 20
T @source T @5mm Tref
X: 15.1 Y: 242.6 X: 19.78 Y: 250.9

T(C)

20

Input, power = 5W, Ts = 5sec, Tinitial = 25.27C power(W) 4 2 0 0 5 10 time (min) 15 20

Figure A.8 Results from experiment # 2 of thermal dose control in albumen phantom with t preset = 15 min.,

Tmax, source  90oC and umax = 5W. From top to bottom ­ (i) delivered thermal dose, (ii) temperature profiles of Tref ,

Tsource and T5 mm , and (iii) control input (applied laser power)

97

Dose(eq.min.@430C)

Experiment # 3, Df = 240min.,tpreset = 15min.,constrained, Tsource <=90C 300 200 100 0 0 80 60 40 20 0 0 5 10 15 5 10 15 20 T @source T @5mm Tref
X: 14.9 Y: 235.9 X: 19.73 Y: 257.3

T(C)

20

Input, power = 5W, Ts = 5sec, Tinitial = 25.44C power(W) 4 2 0 0 5 10 time (min) 15 20

Figure A.9 Results from experiment # 3 of thermal dose control in albumen phantom with t preset = 15 min.,

Tmax, source  90oC and umax = 5W. From top to bottom ­ (i) delivered thermal dose, (ii) temperature profiles of Tref ,

Tsource and T5 mm , and (iii) control input (applied laser power)

98

This thesis work has generated the following contributions:
· Madhu Jain, Farrokh J. Sharifi and William M. Whelan, J. Carl Kumaradas, "Model Predictive control of Laser Interstitial Thermal Therapy", CAP Congress Conference, St. Catherines, Canada, 2006 · Madhu Jain, J. Carl Kumaradas, Farrokh J. Sharifi and William M. Whelan, "Uncertainty and Sensitivity Analysis for a Tissue Laser-Irradiated Model", IEEE Canadian Conference on Electrical and Computer Engineering, Ottawa, Canada, 2006

99

Bibliography
Aggarwal, S.J., Dacosta, R., Diller K.R. & Hinich, M.J. (1990). The effects of burn injury on vasoactivity in hamster peripheral microcirculation. Microvascular Research, 40, 73-87. Aho, T.F. & Gilling, P.J. (2003). Laser therapy for benign prostatic hyperplasia: A review of recent developments. Current Opinion in Urology, 13, 39-44. Anvari, B., Rastegar, S. & Motamedi, M. (1994). Modeling of intraluminal heating of biological tissue: Implications for treatment of benign prostatic hyperplasia. Biomedical Engineering, IEEE Transactions on, 41, 854-864. Arora, D., Cooley, D., Perry, T., Skliar, M. & Roemer, R.B. (2005). Direct thermal dose control of constrained focused ultrasound treatments: Phantom and in vivo evaluation. Physics in Medicine and Biology, 50, 1919-1935. Bown, S., G. (1983). Phototherapy of tumors. World Journal of Surgery, 7, 700-709. Bown, S.G. (1998). Science, medicine, and the future - new techniques in laser therapy. British Medical Journal, 316, 754-757. Choy, V., Sadeghian, A., Sherar, M.D. & Whelan, W.M. (2002). Evaluation of a fuzzy logic controller for laser thermal therapy. Laser Tissue Interaction XIII: Photochemical, Photothermal, and Photomechanical, SPIE, San Jose, CA, USA, 4617, 77-86. Choy, V.W.S. (2003). Real-time online fuzzy logic controller for laser interstitial thermal therapy. M.Sc. Thesis, University of Toronto, Toronto, Canada Chung, A.H., Jolesz, F.A. & Hynynen, K. (1999). Thermal dosimetry of a focused ultrasound beam in vivo by magnetic resonance imaging. Medical Physics, 26, 2017-2026. Croft, D.R. (1977). Heat transfer calculations using finite difference equations. Applied Science: London Daikuzono, N., Suzuki, S., Tajiri, H., Tsunekawa, H., Ohyama, M. & Joffe, S.N. (1988). Laserthermia: A new computer-controlled contact nd: YAG system for interstitial local hyperthermia. Lasers in Surgery and Medicine, 8, 254-258. Davidson, S.R.H., Vitkin, I.A., Sherar, M.D. & Whelan, W.M. (2005). Characterization of measurement artefacts in fluoroptic temperature sensors: Implications for laser thermal therapy at 810 nm. Lasers in Surgery and Medicine, 36, 297-306. Dick, E.A., Joarder, R., De Jode, M., Taylor-Robinson, S.D., Thomas, H.C., Foster, G.R. & Gedroyc, W.M.W. (2003). MR-guided laser thermal ablation of primary and secondary liver tumours. Clinical Radiology, 58, 112-120.

100

Duderstadt, J.J. & Hamilton, L.J. (1976). Nuclear reactor analysis. John Wiley & Sons: New York, USA, 650. Forsythe, G.E. (1977). Computer methods for mathematical computations. Prentice-Hall: Englewood Cliffs, N.J. Franklin, G.F. (1998). Digital control of dynamic systems. Addison-Wesley: Menlo Park, Calif.,USA, Grewal, M.S. (1993). Kalman filtering: Theory and practice. Prentice-Hall: Englewood Cliffs, N.J. Hall-Craggs, M.A. & Vaidya, J.S. (2002). Minimally invasive therapy for the treatment of breast tumours. European Journal of Radiology, 42, 52-57. Heisterkamp, J., van Hillegersberg, R. & Ijzermans, J.N. (1999). Interstitial laser coagulation for hepatic tumours. The British Journal of Surgery, 86, 293-304. Heisterkamp, J., van Hillegersberg, R., Sinofsky, E. & IJzermans, J.N. (1997). Heat-resistant cylindrical diffuser for interstitial laser coagulation: Comparison with the bare-tip fiber in a porcine liver model. Lasers in Surgery and Medicine, 20, 304-309. Hielscher, A.H., Alcouffe, R.E. & Barbour, R.L. (1998). Comparison of finite-difference transport and diffusion calculations for photon migration in homogeneous and heterogeneous tissues. Physics in Medicine and Biology, 43, 1285-1302. Iizuka, M.N., Sherar, M.D. & Vitkin, I.A. (1999). Optical phantom materials for near infrared laser photocoagulation studies. Lasers in Surgery and Medicine, 25, 159-169. Ivarsson, K., Olsrud, J., Sturesson, C., Moller, P.H., Persson, B.R. & Tranberg, K.G. (1998). Feedback interstitial diode laser (805 nm) thermotherapy system: Ex vivo evaluation and mathematical modeling with one and four-fibers. Lasers in Surgery and Medicine, 22, 86-96 Izzo, F. (2003). Other thermal ablation techniques: Microwave and interstitial laser ablation of liver tumors. Annals of Surgical Oncology, 10, 491-497. Jacques, S.L. (1993). Role of tissue optics and pulse duration on tissue effects during high-power laser irradiation. Applied Optics, 32, 2447-2454. Kim, B., Jacques, S.L., Rastegar, S., Thomsen, S.L. & Motamedi, M. (1995). Role of dynamic changes in blood perfusion and optical properties in thermal coagulation of the prostate. 2391, 443-450. Kolios, M.C. (1998). Applications and validation of models of heat transfer in perfused tissues. PhD Dissertation, University of Toronto, Toronto, Canada Lagendijk, J.J.W. (2000). Hyperthermia treatment planning. Physics in Medicine and Biology, 45, R61R76. Lai, L.M., Hall-Craggs, M.A., Mumtaz, H., Ripley, P.M., Davidson, T.I., Kissin, M.W., Saunders, C., Taylor, I. & Bown, S.G. (1999). Interstitial laser photocoagulation for fibroadenomas of the breast. Breast, 8, 89-94. Lang, J., Erdmann, B. & Seebass, M. (1999). Impact of nonlinear heat transfer on temperature control in regional hyperthermia. Biomedical Engineering, IEEE Transactions on, 46, 1129-1138. 101

Lin, W.L., Roemer, R.B. & Hynynen, K. (1990). Theoretical and experimental evaluation of a temperature controller for scanned focused ultrasound hyperthermia. Medical Physics, 17, 615625. Lynn, B. & Cotsell, B. (1991). The delay in onset of vasodilator flare in human skin at increasing distances from a localized noxious stimulus. Microvascular Research, 41, 197-202. Malinen, M., Duncan, S.R., Huttunen, T. & Kaipio, J.P. (2006). Feedforward and feedback control of ultrasound surgery. Applied Numerical Mathematics, 56, 55-79. Mattingly, M., Roemer, R.B. & Devasia, S. (2000). Exact temperature tracking for hyperthermia: A model-based approach. IEEE Transactions on Control Systems Technology, 8, 979-992. Maybeck, P.S. (1979). Stochastic models, estimation and control. Academic Press: New York Moller, P.H., Lindberg, L., Henriksson, P.H., Persson, B.R. & Tranberg, K.G. (1996). Temperature control and light penetration in a feedback interstitial laser thermotherapy system. International Journal of Hyperthermia : The Official Journal of European Society for Hyperthermic Oncology, North American Hyperthermia Group, 12, 49-63. Nau, W.H., Roselli, R.J. & Milam, D.F. (1999). Measurement of thermal effects on the optical properties of prostate tissue at wavelengths of 1,064 and 633 nm. Lasers in Surgery and Medicine, 24, 3847. Paiva, M.B., Blackwell, K.E., Saxton, R.E., Calcaterra, T.C., Ward, P.H., Soudant, J. & Castro, D.J. (1998). Palliative laser therapy for recurrent head and neck cancer: A phase II clinical study. Laryngoscope, 108, 1277-1283. Patankar, S.V. (1980). Numerical heat transfer and fluid flow. Hemisphere Pub. Corp., Washington, USA. Pennes, H.H. (1998). Analysis of tissue and arterial blood temperatures in the resting human forearm. 1948. Journal of Applied Physiology: Respiratory, Environmental and Exercise Physiology, 85, 5-34. Rastegar, S., Jacques, S.L., Motamedi, M. & Kim, B. (1992). Theoretical analysis of equivalency of highpower diode laser (810 nm) and nd:YAG laser (1064 nm) for coagulation of tissue: Predictions for prostate coagulation. Laser-Tissue Interaction III, SPIE, Los Angeles, CA, USA, 1646, 150160. Roggan, A. & Müller, G.J. (1995). Dosimtery and computer based irradiation planning for laser-induced interstitial thermotherapy (LITT) In: Laser-induced interstitial thermotherapy (ed. by M. Gerhard & R. André) pp. 114-156. SPIE Optical Engineering Press: Bellingham, Wash. Rossiter, J.A. (2003). Model-based predictive control : A practical approach. CRC Press: Boca Raton Salomir, R., Vimeux, F.C., de Zwart, J.A., Grenier, N. & Moonen, C.T.W. (2000). Hyperthermia by MRguided focused ultrasound: Accurate temperature control based on fast MRI and a physical model of local energy deposition and heat conduction. Magnetic Resonance in Medicine, 43, 342-347. Sapareto, S.A. & Dewey, W.C. (1984). Thermal dose determination in cancer therapy. International Journal of Radiation Oncology, Biology, Physics, 10, 787-800.

102

Schwabe, B., Kahn, T., Harth, T., Ulrich, F. & Schwarzmaier, H.J. (1997). Laser-induced thermal lesions in the human brain: Short-and long-term appearance on MRI. Journal of Computer Assisted Tomography, 21, 818-825. Slotine, J.-.E. (1991). Applied nonlinear control. Prentice Hall: Englewood Cliffs, N.J. Smith, N.B., Merrilees, N.K., Dahleh, M. & Hynynen, K. (2001). Control system for an MRI compatible intracavitary ultrasound array for thermal treatment of prostate disease. International Journal of Hyperthermia, 17, 271-282. Sturesson, C. (1998). Interstitial laser-induced thermotherapy: Influence of carbonization on lesion size. Lasers in Surgery and Medicine, 22, 51-57. Thomsen, S. (1991). Pathologic analysis of photothermal and photomechanical effects of laser-tissue interactions. Photochemistry and Photobiology, 53, 825-835. Thomsen, S.L., Schwartz, J.A., Joseph, R., Pearce, J.A., Rae, B. & McMurray, T.J. (1994). Temperatures associated with thermally induced red blood cell changes in tissues irradiated in vivo. Diagnostic and Therapeutic Cardiovascular Interventions IV, SPIE, Los Angeles, CA, USA, 2130, 156-163. VanBaren, P. & Ebbini, E.S. (1995). Multipoint temperature control during hyperthermia treatments theory and simulation. IEEE Transactions on Biomedical Engineering, 42, 818-827. Vanne, A. & Hynynen, K. (2003). MRI feedback temperature control for focused ultrasound surgery. Physics in Medicine and Biology, 48, 31-43. Welch, G. & Bishop, G. (2004). An Introduction to the Kalman filter. University of North Carolina at Chapel, North Carolina, 1-16. Welch, A. (1984). The thermal response of laser irradiated tissue. Quantum Electronics, IEEE Journal of, 20, 1471-1481. Welch, A.J., Yoon, G. & van Gemert, M.J. (1987). Practical models for light distribution in laserirradiated tissue. Lasers in Surgery and Medicine, 6, 488-493. Welch, A.J., Motamedi, M., Rastegar, S., LeCarpentier, G.L. & Jansen, D. (1991). Laser thermal ablation. Photochemistry and Photobiology, 53, 815-823. Welch, A.J. & van Gemert, M.J.C. (1995). Optical-thermal response of laser-irradiated tissue. Plenum press: New York, 925. Whelan, W.M. & Wyman, D.R. (1999). Dynamic modeling of interstitial laser photocoagulation: Implications for lesion formation in liver in vivo. Lasers in Surgery and Medicine, 24, 202-208. Whelan, W.M., Davidson, S.R.H., Chin, L.C.L. & Vitkin, I.A. (2005). A novel strategy for monitoring laser thermal therapy based on changes in optothermal properties of heated tissues. International Journal of Thermophysics, 26, 233-241. Wyman, D.R., Swift, C.L., Siwek, R.A. & Wilson, B.C. (1991). A control method for a nonlinear multivariable system - application to interstitial laser hyperthermia. IEEE Transactions on Biomedical Engineering, 38, 891-898.

103

Wyman, D.R., Wilson, B.C. & Malone, D.E. (1992). Medical imaging-systems for feedback-control of interstitial laser photocoagulation. Proceedings of the IEEE, 80, 890-902. Zarchan, P. & Musoff, H. (2005). Fundamentals of Kalman filtering : A practical approach. American Institute of Aeronautics and Astronautics: Reston, Va., 764

104


