Ryerson University

Digital Commons @ Ryerson
Theses and dissertations

1-1-2010

Dynamic Modelling And Predictive Control For Insect-Like Flapping Wing Aerial Micro Robots
Alborz Sakhaei
Ryerson University

Follow this and additional works at: http://digitalcommons.ryerson.ca/dissertations Part of the Aerospace Engineering Commons Recommended Citation
Sakhaei, Alborz, "Dynamic Modelling And Predictive Control For Insect-Like Flapping Wing Aerial Micro Robots" (2010). Theses and dissertations. Paper 1624.

This Thesis is brought to you for free and open access by Digital Commons @ Ryerson. It has been accepted for inclusion in Theses and dissertations by an authorized administrator of Digital Commons @ Ryerson. For more information, please contact bcameron@ryerson.ca.

DYNAMIC MODELLING AND PREDICTIVE CONTROL FOR INSECT-LIKE FLAPPING WING AERIAL MICRO ROBOTS

by Alborz Sakhaei

B.A.Sc. (Amirkabir University of Technology, Tehran) 2004 M.A.Sc. (Sharif University of Technology, Tehran) 2006

A thesis presented to the Ryerson University in partial fulfilment of the degree of Master of Applied Science

in the program of Aerospace Engineering

Toronto, Ontario, Canada, 2010

© Alborz Sakhaei 2010

I hereby declare that I am the sole author of this thesis or dissertation. I authorize Ryerson University to lend this thesis or dissertation to other institutions or individuals for the purpose of scholarly research.

-------------------------------------------

I further authorize Ryerson University to reproduce this thesis or dissertation by photocopying or by other means, in total or in part, at the request of other institutions or individuals for the purpose of scholarly research.

--------------------------------------------

ii

Abstract
Dynamic Modeling and Predictive Control for Insect-Like Flapping Wing Aerial Micro Robots

by Alborz Sakhaei

Master of Applied Science in Aerospace Engineering Ryerson University, Spring 2010

The outstanding potential capability of flapping-wing aerial micro robots to perform gamut of applications ranging from indoor and confined space missions to perilous environment explorations elevates them from conventional fixed and rotary wing micro aerial vehicles. Despite the remarkable progress in development of manufacturing paradigms to fabricate an at-scale insect-like aerial micro robot, the existing methods are still incompetent to mimic even the most basic maneuvers of the flying insects. This incompetency comes from technological limitations in terms of size and power density as well as lack of thorough insight into the complex neuromuscular actuation mechanism of the insects wing. These limitations raise the motivation to develop a simulation framework to be used to analyze the stability and flight dynamics of the insect-like aerial micro robots, and provide a means by which the controller design for these systems could be accomplished. This thesis describes the development of such simulation framework in the context of dynamic modelling and controller design. A consistent set of dynamic and kinematic equations of motion are developed, and the application of the model predictive control strategy for insectlike flapping wing aerial micro robots is investigated.

iii

Contents
LIST OF FIGURES ...................................................................................................................................... VII 1. INTRODUCTION ................................................................................................................................ 1 1.1 1.2 2. PREVIOUS WORK .................................................................................................................................3 CONTRIBUTIONS AND OUTLINE .........................................................................................................8

DESIGN AND FABRICATION OF FLAPPING WING AMR ......................................................... 9 2.1 ACTUATORS (FLIGHT MUSCLES) .......................................................................................................10 2.1.1 2.1.2 2.1.3 2.1.4 2.2 Actuation method .............................................................................................................10 Actuators: Materials, Mechanics and Geometry .......................................................12 Actuator fabrication ........................................................................................................13 Power supply and driving methods ..............................................................................13

TRANSMISSION (THORAX) .................................................................................................................14 2.2.1 2.2.2 2.2.3 Transmission methods ....................................................................................................15 Kinematics and Dynamics of transmission ................................................................20 Transmission manufacturing issues ............................................................................22

2.3 3.

WING AND AIRFRAME (EXOSKELETON) ..........................................................................................22

INSECT FLIGHT MECHANISMS ...................................................................................................25 3.1 3.2 3.3 3.4 AERODYNAMICS .................................................................................................................................25 DYNAMIC MODELING ........................................................................................................................29 SENSORY SYSTEM ..............................................................................................................................30 CONTROL SYSTEM .............................................................................................................................31

iv

4.

DYNAMIC MODELLING AND SIMULATION OF FLAPPING WING AMR .............................35 4.1 GENERAL FRAMEWORK ....................................................................................................................36 4.1.1 4.1.2 4.1.3 4.2 Frames and Coordinate Systems ..................................................................................36 Notation .............................................................................................................................37 Mathematical Tools .........................................................................................................38

TRANSFORMATION MATRICES .........................................................................................................38 4.2.1 4.2.2 Wing-Body Transformation Matrix..............................................................................39 Body-Inertial Transformation Matrix .........................................................................43

4.3

KINEMATICS EQUATIONS .................................................................................................................44 4.3.1 4.3.2 Wing Kinematics ..............................................................................................................44 Body Kinematics ..............................................................................................................45

4.4

DYNAMIC EQUATIONS OF MOTION ..................................................................................................46 4.4.1 4.4.2 4.4.3 Translational Dynamics .................................................................................................46 Rotational Dynamics .......................................................................................................48 External Forces and Moments ......................................................................................52

4.5

SIMULATION ANALYSIS.....................................................................................................................54 4.5.1 4.5.2 4.5.3 Control Inputs...................................................................................................................54 Averaging Theory and Trim Conditions .....................................................................56 Effect of the wing mass and moment of inertia .........................................................60

5.

MODEL PREDICTIVE CONTROL FOR FLAPPING WING AMR...............................................65 5.1 GENERALIZED PREDICTIVE CONTROL (GPC) ................................................................................66 5.1.1 5.1.2 5.1.3 5.1.4 5.1.5 5.2 MPC Structure..................................................................................................................66 Prediction Model ..............................................................................................................67 Control Algorithm ............................................................................................................68 Stability and Robustness................................................................................................69 Simulations .......................................................................................................................70

QUASI INFINITE HORIZON NMPC ..................................................................................................72 5.2.1 5.2.2 Mathematical Formulation ............................................................................................73 Application Analysis........................................................................................................74

6.

CONCLUSION ....................................................................................................................................77

v

6.1

FUTURE WORK...................................................................................................................................79

BIBLIOGRAPHY ...........................................................................................................................................81

vi

List of Figures
1.1:  The latest versions of the Micromechanical Flying Insect (MFI) (left)  [11], and the Harvard Microrobotic Fly (HMF) (right)  [18] .....................................................................................2 2.1:  The bending cantilevered piezoelectric actuator (left)  [11] and cymbal actuators (right) [36]  2.2:  11

The dual power source methods: alternating method (left) and simultaneous method (right)  [5] ..................................................................................................................................................14

2.3: 

The schematic model of the actuators, transmission, differential and wing (left and center)  [7],  [12] (note that the centered figure does not show the differential mechanism), and the spherical five bar mechanism (right) ..................................................................................15

2.4:  2.5: 

Cross section of typical flexure joints  [15].........................................................................................16 Top view of the wing flapping motion and the generated aerodynamic forces: symmetric flapping (left), symmetric flapping with offset of the mean stroke angle (pitch moment) (center), asymmetric flapping without offset of mean stroke angle (yaw moment) (right) [17]  17

2.6: 

Models of the last three versions of the Harvard Microrobotic Fly (HMF) and their associated schematic actuator and transmission mechanisms  [15],  [17],  [18] ..........................17

2.7: 

Steltz' first revision of the MFI comprised of flextensional modes and dual slider cranks (left and center), and the modified flextensional cymbal actuator (right)  [11] .........................19

2.8: 

Steltz' second revision of MFI: three stages of amplification comprised of double core flextensional and second amplifying stage (left), and the final mock-up (right)  [11] ..............20

2.9:  2.10: 

The airframe layout of MFI (left) and HMF (right)  [12] ................................................................23 The HMF design wing layout .............................................................................................................23

vii

3.1:  3.2: 

A comparison of (A) 2-D linear translation and (B) 3-D flapping translation  [22]...................28 3-D stabilizing span-wise axial flow pattern (black arrows indicate downwash due to vortex system)  [22] .................................................................................................................................28

4.1: 

The insect-like flapping wing AMR coordinate systems: Inertial (I), Body (B) and Wing (W) 37

4.2: 

The lateral view of the right wing at the downstroke for zero deviation angle, and definition of the corresponding wing kinematics and body attitude angles ..............................40

4.3: 

The orientations of the Wing coordinate system and definition of the wing kinematic parameters for each wing (left and right) at each stroke (downstroke and upstroke) for zero deviation angle ...............................................................................................................................42

4.4: 

The time history of the free flying Drosophila wing kinematics parameters at the upstroke (white background) and downstroke (gray background): stroke angle  (blue), rotation angle  (green) and deviation angle  (red)  [21]...............................................................55

4.5: 

State propagation of the original model (left) and the time-averaged model (right) of flapping wing AMR after trim based on implicit set of equations of motion for 20 wingbeats .................................................................................................................................................58

4.6: 

State propagation of the original model (left) and the time-averaged model (right) of flapping wing AMR after trim based on explicit equations of motion for 20 wingbeats .........61

4.7: 

Longitudinal evolution of the model of the insect-like flapping wing AMR in response to 20% step command in the stroke amplitude  (at  = 0.02 s) for nonzero wing mass (solid) and zero wing mass (dashed) ...................................................................................................62

4.8: 

Longitudinal evolution of the model of the insect-like flapping wing AMR in response to 20% step command in the mean stroke angle m (at  = 0.02 s) for nonzero wing mass (solid) and zero wing mass (dashed) ...................................................................................................62

4.9: 

Longitudinal evolution of the model of the insect-like flapping wing AMR in response to 20% step command in the stroke plane inclination angle  (at  = 0.02 s) for nonzero wing mass (solid) and zero wing mass (dashed) ..............................................................................63

4.10: 

Step response of the insect-like flapping wing AMR to 20% increase in left wing stroke amplitude (at  = 0.02 ) for nonzero wing mass (solid) and zero wing mass (dashed) ...........63

viii

4.11: 

Step response of the insect-like flapping wing AMR to 20% increase in left wing stroke plane inclination angle  (at  = 0.02 ) for nonzero wing mass (solid) and zero wing mass (dashed) ..........................................................................................................................................64

5.1:  5.2: 

Model Predictive Control (MPC) strategy ........................................................................................67 Top: Close-loop response of the insect-like flapping wing AMR to step command in total speed for three scenarios (unconstrained optimization (dashed), constrained GPC (solid) and truncated optimization (star). Bottom: time history of the control inputs for the left wing (left) and right wing (right): stoke angle amplitude , mean stroke angle  and stroke plane inclination angle  ................................................................................................71

ix

1.

Introduction
The dream of flight commenced with the first look of mankind at birds soaring up into blue sky. Although the

primitive manmade flying vehicles were mostly inspired from the birds flapping wing flight mechanism, the main attentions during the last century have been focused on development of flight mechanisms for the fixed wing airplanes. However, recent interests on design and fabrication of miniature-size aerial robots, to be served for wide gamut of civil and military applications, have returned the attentions to the flapping wing flying vehicles, but at this time, inspired from more evolutionary developed creatures in our planet, the flies. Flies have inhibited our planet in a successive evolutionary way for over 300 million years. These tiny and apparently simple creatures have tremendous capabilities in the context of aerodynamics, kinematics, sensory systems, manoeuvrability, power consumption, and communication. "Flies are the most accomplished flying creatures on our planet, so we should think before we swat!" Michael Dickinson said. In fact, being small, simple and efficient, insects are the best pattern to be inspired for the Aerial Micro Robot (AMR) design and fabrication. Specially, flapping wing as the most effective way to generate lift regarding the size and power consumption of an AMR,increasestheinteresttoemploythefliescapabilities. The Micromechanical Flying Insect (MFI) specifications are defined through the MFI project at University of California, at Berkeley (UCB) as: 10 - 30  wing span, 100  weight, 150  wing beat frequency, and 10 - 20  power budget. Figure  1.1 shows the mock-ups of two of the most promising undergoing projects in the context of design and fabrication of miniature-size insect-like flapping wing AMRs: Micromechanical Flying

1

Insect (MFI) at University of California, at Berkeley  [3]- [5],  [41],  [41],  [50]- [52], and Harvard Microrobotic Fly (HMF) at Harvard University  [53]- [56]. The insect-like flapping wing aerial micro robots possess several capabilities which suite them to be served for wide range of applications such as: intelligent reconnaissance, border patrol, air sampling, police surveillance, traffic monitoring, penetrating and manoeuvring in the confined spaces, performing agile flight maneuvers inside the buildings, stairwells, ventilation systems, shafts and tunnels as well as D3 (Dull, Dirty, and Dangerous) environments. However, design and fabrication of these aerial robots possess several challenges in the contexts of aerodynamics, dynamic modeling, controllability and fabrication. In the context of the aerodynamic, the low Reynolds number and the nonlinear nature of the unsteady flow around the flapping wings are addressed as the most challenging issues. The low Reynolds number is related to the small size and low speed regime of AMRs, and results in significant decrease in the Lift-to-Drag ratio and performance efficiency  [48]. Moreover, the nonlinearity and the unsteady nature of the flow around the flapping wing increase the complexity of the CFD analysis to be used to obtain the aerodynamic forces and moments. In terms of dynamic modeling, flapping flight possesses significant challenges in developing the governing equations of motion  [28],  [43]. First, the wing flapping motion results in fluctuation of the center of mass and variation of the moment of inertia. Second, the wing kinematic equations are more challenging to be developed as result of flapping

Figure  1.1: The latest versions of the Micromechanical Flying Insect (MFI) (left)  [41], and the Harvard Microrobotic Fly (HMF) (right)  [26]

2

motion. Finally, the rigid body assumption is not valid for the cases in which the wing deformation should be considered in the development of the dynamic equations of motion. The stability and control analysis of flapping wing AMR is more complicated than classical flight control mechanisms for several reasons. First, unlike the typical airplanes in which the control system utilizes a set of independent control surfaces (ailerons, elevators, rudders and flaps) to provide desire maneuvers, the insect-like flapping wing AMRs could perform the control strategies only by means of modulating the wing kinematic parameters. Therefore, the control inputs for a system of flapping wing AMR are strongly coupled and non-orthogonal to each other. Second, low moment of inertia and small wing span make the aerial micro robots vulnerable to the rapid angular acceleration. Third, the neurobiological mechanism of the insects sensory system is still not completely understood to be used to obtain the body attitude information. Finally, the gust effect is more significant on such a small scale flying vehicles in comparison with airplanes, helicopters or larger AMRs. The inevitable Fabrication constraints such as small dimension, low power consumption, high flapping resonant frequency and limited computational on-board resources, make the fabrication process rather challenging and complicated  [41]. The so-called,,meso-scalemechanisms [51] in which the length of elements ranges from millimetres to microns, demand a state-of-the-art fabrication paradigm regarding the small size and high precision.

1.1 Previous Work
The previous efforts in the context of this research could be classified based on their contribution in fabrication and simulation analysis of insect-like flapping wing AMRs into four categories: design and fabrication, aerodynamics, dynamic modelling and control system design. Design and Fabrication In fact, being noisy and bulky while demanding high speed and wide operational range, the fixed-wing and rotary-wing AMRs are more appropriate for outdoor missions. On the other hand, flapping-wing AMRs perfectly match the indoor mission requirements by utilizing an efficient mechanism of thrust generation in low speed flight regimes while possessing hovering capability. During the last decade there have been several attempts to design and fabricate operational flapping wing AMRs to be served for various civil and military applications. In this regard, 3

some of the most promising projects are: DelFly I, II and micro (Technical University of Delft), Entomopter (Georgia Tech Institute), MicroBat (AeroVironment and Cal Tech University), Micromechanical Flying Insect (MFI) (University of California at Berkeley), and Harvard Microrobotic Fly (HMF) (Harvard University). The DelFly I  [60] possesses two sets of flapping wings, and is capable to perform straight and horizontal flight as well as very slow hovering manoeuvre. This micro aerial robot is equipped with a 1  micro color onboard camera which gives in combination with the very slow flight speed a good overview of surroundings. The DelFly II is a modified version of DelFly I which is lighter, smaller and more robust. This aerial micro robot has 30  wing span and is capable of performing hover and even backward flights with -0.5 / speed. The DelFly micro is the most recent version of the Delft University Ornithopter project, and possesses 3.07  weight, 10  tip-to-tip wing span, 30  flapping frequency, 50  range, and a 1  lithium battery for 3  flight endurance. The Entomopter is a 50  flying-crawling insect-like robot developed by the Georgia Tech Research Institute and University of Cambridge  [35]. This miniature-size robot is propelled by a pair of flapping wings driven by a Reciprocating Chemical Muscle (RCM) which is capable of generating autonomic wing beating from a chemical energy source without any ignition source, combustion, or atmospheric oxygen. Through direct conversion, the RCM also provides small amounts of electricity for onboard systems, and further provides differential lift enhancement on the wings through circulation control to achieve pitch, roll and yaw moments. Moreover, a twin set of wings with 15  span situated at the fore and aft of the RCM provide balanced resonant flapping to create not only lift and thrust, but an entire vehicle control. The Microbat is a 23  span remotely piloted flapping wing ornithopter with 14  weight and capable of flying for over 22 . The structure of the Microbat is comprised of carbon fiber rods, Mylar, balsa wood and plastic foam. The MFI project  [3]- [5],  [41],  [41],  [50]- [52] aims to develop a 120  weight and 25  span insect-like flapping wing AMR based on biomimetic principles and capable of sustained autonomous flight. The piezoelectric actuators, carbon fiber composite materials and flexible thorax structures provide the required power density whereas the wing stroke motion is provided by lithium batteries charged by solar cells. Professor Wood at Harvard Microrobotic Laboratory developed the MFI design, and fabricated an at-scale flapping wing robotic insect called Harvard Microrobotic Fly (HMF)  [53]- [56]. This aerial micro robot is basically made of four primary components: actuators, transmissions, wings, and airframe. All articulated components of the transmission mechanism are based

4

upon locally compliant structures (flexures), and all link are made of light weight but high modulus carbon fiber composites. Inspiring the biological structure of the insects wings, a vein distribution is chosen to maintain maximum rigidity while having minimal inertia in flapping and rotational axes. The manufacturing paradigm and design methodologies used to fabricate the developing versions of the MFI and HMF are explained in chapter  2. Furthermore, similar projects aiming fabrication of an operational flapping wing AMR are under development in other academic research groups such as: University of Tokyo  [46], University of Delaware  [24], Vanderbilt University  [14], and Naval Postgraduate School  [29].

Aerodynamics Although several numerical analyses have been performed through the finite difference solutions of the Navier-Stokes equations using CFD methods  [31],  [36],  [39],  [45],  [58] to understand the unsteady nature of the flapping wing aerodynamics, the computational cost and modelling limitations have degraded the functionality of these methods. On the other hand, experimental investigations of biologists have provided a reliable means to study the flapping wing aerodynamic mechanisms. These investigations started at early 1970s with Bennett work to visualize the flow around a mechanical 3-D wing model  [6], and continued with the Weis-Fogh and Lighthill introduction to the Clap-and-Fling mechanism  [30],  [49]. Thereafter, Ellington captured and digitized the free flight of the hovering insects to analyze the wing kinematics and unsteady aerodynamic mechanisms, and examine the lift and power requirement for the hovering flight  [22]. Afterward, Dickinson and his colleagues  [17],  [18],  [27],  [37], [38] developed these investigations in the context of unsteady aerodynamic mechanisms associated with the free  flight maneuvers. In particular, they replayed the insects wing motion thorough a 3-D dynamically-scaled wing model of the Drosophila melanogaster to measure the aerodynamic forces and moments produced thorough modulation of the wing kinematic parameters at different flight maneuvers. Dynamic Modelling The articulated rigid body equations of motion for flapping flight including the translational and rotational dynamics are developed by Gebert el al.  [28]. However, some errors along with the complexity of equations limit the reliability of their formulation. Sun et al.  [43] re-derived these equations and specified them for hovering flight. 5

They neglected the wing inertial and gravitational forces and moments on the evolution of the body, and developed the time-averaged longitudinal model of the insect using the averaging theory. In a seminal work, Dickson et al.  [19] presented an integrative model of insect-like flapping wing aerial micro robot including the sensory system model, control system and environment model. However, the simulation of the articulated rigid body dynamics is relied on an open source physics engine called Open Dynamics Engine (ODE)  [59]. Despite the advantageous features, the ODE is a general purpose software, and is not specified for simulation of an insect-like flapping wing aerial micro robot. In the context of flight dynamic analysis, Taylor  [43] and Sun et al.  [43],  [44] reported some unstable modes in longitudinal flight of several insects. Furthermore, the body and the wing mass properties (mass, moment of inertia and location of the center of mass) for several insects are empirically calculated by Ellington  [22] and Dickson et al.  [19].

Control System Design An integrative control framework for an insect-like flapping wing AMR was first proposed by Deng et al. for the Micromechanical Flying Insect (MFI) project in the University of California, at Berkeley. The proposed controller possesses a three levels higherarchical architecture inspired from neuromotor control system of real flying insects, and is comprised of: navigation planner (higher level), flight mode stabilizer (middle level), and wing trajectory controllers (lower level). The navigation planner chooses the appropriate flight modes (cruise, descent, hover and climb) necessary to navigate the environment and perform desired tasks. The flight mode stabilizer is comprised of several controllers each providing a specific flight mode available to the MFI such as hovering, fast forward, power efficient forward, take off, landing, steering left and right, and moving up, down and sideway  [16]. Depending on the flight modes dictated by the navigation planner, the flight mode stabilizer calculates the desired forces and torques that must be applied to the body to stabilize the MFI in the presence of environmental disturbances. Thereafter, the desired forces and torques are passed to the lower level controller to be generated through the wing motion and be applied to the MFI body. The wing trajectory controller is the bottom level of the control architecture module. At this level, the controller generates the necessary electrical signals for the actuators to move the wings in a way that they generate the desired forces and moments dictated by the flight mode stabilizer. This controller receives the information from the wing base force sensors, and chooses the appropriate changes in the wing kinematic parameters to generate the forces and torques required to establish the desired flight modes. 6

Considering this higherarchical control structure, Deng et al.  [15],  [16] first developed the LTI model of the insect flight dynamics using averaging theory and model identification. Thereafter, some bio-inspired wing kinematic parameters including mean angle of attack, stroke angle amplitude, timing of rotation at the wing reversal, and upstroke-to-downstroke wing speed ratio were mapped to the wing forces and moments to be used as control inputs. Finally, a linear quadratic regulator (LQR) controller was designed to stabilize the insects flight. In a seminal effort, Dickson et al.  [19] have recently developed a control module to be used in an integrative model of Drosophila flight. They specified a set of PID control laws that activate some predefined deformation modes to modulate the wing baseline kinematics and generate required wing aerodynamic forces and moments to perform desired maneuvers. In this work, the wing mimics the motion of the free flying insects wing by representing the periodic time history of the stroke angle, stroke deviation and rotation angle in a complete stroke. Three control inputs including mean stroke angle, stroke plane inclination angle and stroke amplitude differentiation are chosen to be associated with the pitch, roll and yaw, respectively. Therefore, angular velocities corresponded to each mode are controlled thorough their associated control input. For example, roll rate is controlled by modulating the stroke plane inclination angle through a proportional feedback controller which its actuation error is formed of the differences between the desired roll rate and the roll rate feedback of the sensory system. Moreover, the body attitude angles are suggested to be controlled by wrapping an outer PID control loop around the angular velocity proportional feedback control system. For instance, the difference between the desired pitch attitude and the feedback of the pitch attitude (obtained by the sensory system) is passes through a PID controller to obtain the set point for the pitch rate. Thereafter, the difference between this set-point and the feedback pitch rate (obtained by sensory system) is passed through a proportional controller to modulate the pitch mode through the mean stroke angle. Furthermore, two other wing kinematic parameters including wingbeat frequency and stroke amplitude are suggested to be modulated for the altitude control. The idea is to use a PID controller to control the vertical velocity, and wrap an outer loop PID controller around this system to follow the set-point in altitude. Although this control strategy provides the simulation framework with a consistent controller for several flight maneuvers, it is only valid for a limited range of pitch attitude (-60    60 ) and roll attitude (-20    20 ).

7

1.2 Contributions and Outline
This thesis aims to develop a simulation framework for dynamic modeling and controller design for an insect-like flapping wing aerial micro robot. In this regard, following main contributions are addressed: Dynamic modeling The dynamic equations of motion for an insect-like flapping wing aerial micro robot are developed based on a reliable tensorial formulation. In particular, a consistent definition of frames and their associated coordinate systems provides a means by which the wing kinematic equations could be developed for any arbitrary motion of the wing. Furthermore, some challenging issues in the context of trimming and wing mass effect analysis are investigated quantitatively. Controller design The application of the Model Predictive Control (MPC) strategy for insect-like flapping wing AMRs in accelerated flight maneuvers is investigated. An appropriate set of wing kinematic parameters are chosen as control inputs, and control law provides (occasionally) an optimal solution while the control inputs are explicitly bounded within a set of physiologically-inspired constraints. Considering these contributions, the present thesis is outlined as follows. Chapter  2 addresses the design concepts, fabrication methods and manufacturing paradigms in the context of fabrication of an at-scale insect-like flapping wing AMR. The basic elements and underlying theories of the insects flight mechanism in terms of aerodynamics, dynamic modeling, sensory systems and controller design are addressed in chapter  3. The kinematics and the dynamics equations of motion for an insect-like flapping wing AMR are developed in chapter  4 to be used for simulation analysis and controller design. In chapter  5, the linear and nonlinear model predictive controllers are investigated to be implemented to the proposed model of the flapping wing AMR to perform the accelerated flight maneuvers. The conclusion and suggested future work are outlined in Chapter  6.

8

2.

Design and Fabrication of Flapping Wing AMR
Design and fabrication of an at-scale insect-like flapping wing aerial micro robot possess several challenges

in terms of size and power density. Whereas the components of the flapping wing AMR range from millimetres to microns in dimension, they must be stiff enough to be able to bear the structural loadings that arise at the accelerated flight maneuvers. On the other hand, limited power budget confines the choice of constituent materials in terms of weight and manufacturing paradigm. Moreover, the weight consideration for computational on-board resources such as Central Processing Unit (CPU) is another correlated issue in the context of the power density. Furthermore, the complicated neuromuscular mechanism of the insects thorax structure is hard to be imitated through a meso-scale transmission mechanism. The Micromechanical Flying Insect (MFI)  [3]- [5],  [41],  [41],  [50]- [52] and the Harvard Microrobotic Fly (HMF)  [53]- [56] are the only demonstrated samples of an at-scale insect-like flapping wing AMR. This chapter outlines the design concepts, fabrication methods and manufacturing paradigm proposed through development of these two projects in the context of four basic components of a flapping wing AMR: actuator, transmission, wings and airframe. It should be noted that, as discussed earlier, the main concern of this work is to develop a mathematical framework for dynamic modeling and control design of flapping wing AMRs; however, understanding the

9

fabrication challenges and technological limitations in this context can provide engineers with viable information based on realistic assumptions to be used for development of virtual simulation frameworks.

2.1 Actuators (flight muscles)
Basically, the power plant of an insect-like flapping wing AMR is comprised of three main parts: power source, actuators and power electronics. Indeed, these components are the supplying source of any energy consuming element in the entire AMR mechanical system. In particular, actuators serve the same role as direct and indirect flight muscles of real flying insects by providing wing with the power required for flapping and rotation, respectively  [55]. This section surveys the manufacturing concerns regarding the design and fabrication of actuators of MFI and HMF projects as the most accomplished samples of high performance actuators to be used in a flapping wing micromechanical system.

2.1.1 Actuation method
The most important characteristic parameter to be considered upon the proper choice of the actuator is power density. The rotary DC motors (brushed and brushless) have remarkable power density for large-scale applications; however, considering high friction loss and relatively bulky and heavy gearing equipment, they are not yet technologically efficient to be implemented as an at-scale insect-like flapping wing AMR actuator. The oscillating actuators, on the other hand, have drawn a great deal of interest for miniature-size applications in the context of constituent materials and method of power (energy) supply  [50]. Application of the oscillating actuators for flapping wing AMR could be associated with three groups of materials: the shape memory alloys, the piezoelectric elements and the electroactive polymers. The shape memory alloys are typically made of nickel titanium wire, and exhibit contraction and expansion (back to initial length) once heated and left to cool down, respectively. These actuators are extremely light, and thus possess very large power density; however, there are some other important characteristic parameters which should be considered upon the proper choice of the oscillating actuators such as band width, generated force and displacement of the actuator. In fact, the most important drawback of the shape memory alloys is their small bandwidth which rules out the application of these actuators for high frequency resonant systems such as flapping 10

wing AMRs. Moreover, the process of heating (and cooling) results in a phase transformation in the structure of the nickel titanium and consequentlythevariationofitsYoungsmodulus.Thisunsteadystructuralvariationmakesthe shape memory alloy actuators difficult to control  [41]. The piezoelectric elements (PZT ceramics) and electroactive polymers are both classified as active materials formed of forroelastic crystals which exhibit strain (expansion and contraction) under the applied electrical field. These actuators possess the great advantage of being light as well as having high band width, low loss and simple geometry; however, the piezoelectric elements generate more strain under the same applied field, and has an approximately linear relation with the applied field compared with the almost quadratic relation of the electroactive polymers  [50]. Thus, piezoelectric elements are suggested as the most appropriate actuation method for the insectlike flapping wing AMRs  [51]- [56]. There are several methods to implement PZT actuators into a mechanical system. Wood  [50] suggested a bending mode actuator in form of a clamped-free cantilevered bimorph element. This actuator is comprised of two elector active layers of PZT material sandwiching an elastic passive layer of carbon fiber (Figure  2.1 left). The designisbasedon"laminateplatetheory"suchthattheapplicationoftheelectricfieldwilldistributesomestress within the layers, and since the elastic modulus and geometry of layers are not the same, the developed stress will result in a bending moment and deflection of the actuator tip. Steltz  [41] suggested a modified version of the cymbal

Elastic Layer (Carbon Fiber)

Displacement Output

PZT_5H

Rigid Extension (Carbon Fiber and SGlass)

Brass Endcap PZT Stack

Figure  2.1:

The bending cantilevered piezoelectric actuator (left)  [41] and cymbal actuators (right)  [20] 11

piezoelectric actuators  [20] as a class of flextensional actuators. The cymbal actuators (Figure  2.1 right) are comprised of two conical metal endcaps (side beams) which sandwich a cylindrical piezoelectric stack such that the radial displacement of the PZT stack results in vertical displacement of the endcaps vertices (Figure  2.1 right). Although the cymbal actuators are rather compact and can operate in high frequency, they are too heavy for AMR application. Thus, to reduce the excessive weight of the cymbals, Steltz modified these actuators by replacing the stack actuator and the metal side beams by two thin piezoelectric plates and carbon fiber composites, respectively (Figure  2.7 right).

2.1.2 Actuators: Materials, Mechanics and Geometry
The piezoelectric materials are basically ceramics with single crystal or polycrystalline structure. Polycrystalline ceramics (e.g. PZT-5H1) are cheaper, more available and have higher elastic modulus, and thus, are preferred to single crystal ceramics. However, the brittle nature of the ceramic structures (compared with metals) along with the stress concentrations caused by surface cracks resulted from machining process, lowers the fracture toughness of the chosen PZT materials, and thus, mandate the necessity to improve the fracture toughness of these materials for efficient operation and longer fatigue life. Wood  [50] suggested three steps to improve the fracture toughness of the MFI actuators. First step is to polish the surface to decrease the initial cracks sizes (roughness) and thus reduce the stress concentration. Next step is to coat the actuator surface with a layer in tension which in turn put the edges in compression, and consequently reduces the cracks sizes and stress concentrations on the surface. The coating layer should be a high CTE (Coefficient of Thermal Expansion) polymer such as polymide. The last step is to choose an elastic layer with a CTE larger than the CTE of the PZT layer such that after the curing, while cooling down to the room temperature, the elastic layer applies a compressive stress to the PZT materials and again decreases the cracks sizes and stress concentrations. The geometry (thickness, width and length) of the actuators should be chosen such that it results in uniform stress distribution along the actuator to avoid stress concentration. Moreover, this geometry should result in an optimized energy density based on the desired displacement, blocked force and stiffness of the actuator  [50]. Considering the thickness of the commercially available PZT and carbon fiber laminas (not less than 40), the

1

From: Piezo Systems Inc. (http://www.piezo.com)

12

thickness is not a flexible design parameter. On the other hand, Wood  [50] suggested to add an extension to the distal end of the MFI bending cantilever actuator and chose a trapezoidal planar geometry to obtain a uniform stress distribution along the actuator (Figure  2.1 left)

2.1.3 Actuator fabrication
The fabrication of the insect like flapping wing AMR is based on a novel meso-scale manufacturing method called Smart Composite Microstructures (SCM) paradigm  [51]. This paradigm utilizes the flexures as ideal pin joints with torsional spring and the laser-cut high modulus and light weight composites for the links. The SCM process for the MFI actuator starts by using a 2D CAD package to design the plies (a M60J Ultra High Modulus unidirectional carbon fiber ester resin prepreg2) including two piezoelectric layers (PZT-5H) and one passive layer, and then aligning them visually (under the microscope) to be prepared to cut. Then, a laser micro machining stage (QuickLaze II3) cut the laminates in a single-ply basis while controlling the dimensions and relative ply angles, and then, the cut laminates are stacked and aligned, and the whole package is cured in the vacuum under high pressure and temperature for a specific time period. Finally, the rigid extension made of high modulus unidirectional fibreglass (S2 Glass) is stacked and aligned to the actuator and the curing process repeat for the new package.

2.1.4 Power supply and driving methods
There are three potential choices which could be considered as power source of an insect-like flapping wing AMR  [41]: solar cells, lithium batteries and combustion engines. The solar cells need large solar panels, and thus, exhibit low energy density. The combustion engines, on the other hand, have extremely high energy density; however, for an at-scale insect-like flapping wing AMR application they are not yet technologically available. The lithium batteries are mature in terms of technology, and have relatively high energy density while can be easily integrated, and thus, are the best available choice for the power source of insect-like flapping wing AMRs. A bimorph piezoelectric actuator could be driven either by a single or dual power sources. Although the single source technique has the advantage of being lighter and needing limited wiring, it exhibits very low energy

2

The prepreg (pre-impregnated fiber) is a general term for the thermoset polymers initially in a crystallized uncured state and comprised of epoxy matrix (resin) reinforced by carbon fiber. From: New Wave research (http://www.new-wave.com/)

3

13

1

Alternating 1

Simultaneous

2

2

Figure  2.2:

The dual power source methods: alternating method (left) and simultaneous method (right)  [50]

density  [41]. The dual power source, on the other hand, provides more energy density and could be categorized in two classes: alternating method and simultaneous method (Figure  2.2). The alternating method has greater saturation while the simultaneous method exhibits greater hysteresis limit and results in greater displacement in the PZT actuator  [50]. Considering the crucial effect of the energy density and displacement in the actuator (power plant) design, the simultaneous method has shown a great deal of interest. It should be noted that there are some limitation on the magnitude of the applied field to the PZT actuator [50]. Mechanical failure (fracture), electrical failure, depolarization and saturation of piezoelectric effect are some  inevitable side effects of high applied field which should be considered upon the optimal design of the power plant.

2.2 Transmission (thorax)
The most challenging part to be dealt with in design and fabrication of an insect-like flapping wing AMR is the transmission mechanism. Since piezoelectric actuators generate large force but small displacement, the mechanical transmissions are required to amplify and map the actuator tip displacement to the wing motion (flapping, rotation and deviation). Following section reviews the transmission methods proposed for the MFI project (the early version and the last version) and the HFM project. The kinematic and dynamic analysis of the transmission mechanism is discussed in section  2.2.2 , and the manufacturing issues in terms of design and fabrication of an at-scale insect-like thorax mechanism are addressed in section  2.2.3 .

14

2.2.1 Transmission methods
Micromechanical Flying Insect (MFI) ­ the early version The classical version of the MFI  [3],  [4],  [51],  [52] utilizes four piezoelectric bending actuators (two for each wing) and a transmission set for each actuator comprised of a slider-crank and a fourbar mechanism to provide each wing with two active degrees of freedom (flapping and rotation) (Figure  2.3 left and center). The slider-cranks perform the preliminary stage of amplification and convert the approximately linear motion of the bending actuator tip into the rotary input of the fourbar mechanism. The fourbars perform the main stage of amplification and provide enough angular displacement required to mimic the insects flapping wing motion. Finally, a differential mechanism on each wing is used to couple the rotational outputs of the two fourbars on each side, and generate the desired wing flapping and rotation. The differential mechanism is basically a spherical fivebar with four links and five joints that exhibit two rotations about  axis (1  2 ) and one rotation about each of  ,    axes (Figure  2.3 right). The terminology of spherical fivebar comes from the fact that all axes of the differential mechanism intersect at a single point. Depending whether the fourbars outputs on each side are in phase (1 = 2 ) or out of phase (1  2 ), the differential mechanism generates flapping and rotation, respectively.

Actuators Slider Crank

Wing Fourbars Slider Crank Actuator Wing Fourbar

Differentials

Figure  2.3: The schematic model of the actuators, transmission, differential and wing (left and center)  [52],  [41] (note that the centered figure does not show the differential mechanism), and the spherical five bar mechanism (right)

15

Figure  2.4:

Cross section of typical flexure joints  [55]

All joints in the transmission and differential mechanism are made of flexures which are assumed to model the ideal revolute (pin) joints with torsional stiffness. Flexures are fabricated using the SCM paradigm by sandwiching an elastic polymide layer with carbon fiber composites while leaving a gap on the middle such that the entire structure can be bent about the open segment (Figure  2.4).

Harvard Microrobotic Fly (HMF) Professor Wood from Harvard Microrobotic Laboratory improved the MFI design by replacing the differentials with simple flexure joints that allow the wings to rotate passively about their spanwise leading edge axis. Thus, he could substitute the four actuators and their corresponding slider-cranks and fourbars in the MFI design with a single power actuator, one slider-crank and two fourbars (one for each wing), respectively (Figure  2.6 left). This redesign with only one DoF actuation, provided a symmetric three DoF system comprised of one passive wig rotation, one active wing symmetric flapping and one power degree of freedom  [53]- [55]. To eliminate the wing over rotation the joint stops were implemented to the passive flexures at the connection point of the fourbars and the wings. The Woods design demonstrated the first takeoff of an at-scale insect-like flapping wing AMR  [55]; however, it was still far from the practical and operational applications. In particular, the symmetric flapping only allowed the fly to pitch, hover and vertically takeoff but no asymmetric lateral maneuvers (yaw and roll) were possible. In fact, the possibility of performing these asymmetric maneuvers is positively correlated to the feasibility of modifying the kinematics of each wing independently. In particular, the asymmetric modification of the stroke amplitude of the wings results in a yaw moment (Figure  2.5 right), while the asymmetric modification of the timing of wing rotation (at the stroke reversal) generates a roll moments. Note that since the pitch is a symmetrical 16

manoeuvre, the simultaneous offset of the mean stroke angle of both the left and right wings from the center of gravity (cg) is enough to generate this manoeuvre (Figure  2.5 center). Considering the crucial role of the asymmetric flight maneuvers, theWoodsdesignwasmoreimproved [25] by adding two control actuators to the HMF, such that the power actuator provides the mechanical power for the wing flapping whereas the control actuators provides the asymmetric wing motion by modifying the kinematics of each wing independently (Figure  2.6 center). Specifically, the yaw moments could be generated by changing the

Transmission
Transmission

Control Actuators Power Actuator

Airfoil Airframe Actuator
Airframe





 2 2







1

1

1 2

Figure  2.6: Models of the last three versions of the Harvard Microrobotic Fly (HMF) and their associated schematic actuator and transmission mechanisms  [25],  [26], [56]

Figure  2.5: Top view of the wing flapping motion and the generated aerodynamic forces: symmetric flapping (left), symmetric flapping with offset of the mean stroke angle (pitch moment) (center), asymmetric flapping without offset of mean stroke angle (yaw moment) (right)  [17]

17

amplitude of the driving voltage signal to the control actuators, and the pitch moment could be generated by changing the DC offset of the driving voltage signal to the power actuator. Generation of the roll moment is more complicated and still is not considered in the present HMF design. This three DoF transmission design (one power and two control actuators) results in a five DoF system comprised of two passive rotations, two active flappings and one power degrees of freedom. The control actuators are added into the transmission mechanism at the connection point of thewingsbasepivotandairframe(Figure  2.6 center). Since these actuators only modify thewingsmotion they do not need to provide large displacements, and thus, they possess lower power consumption and mass compared to the power actuator. The latest version of the HMF  [26] is designed based on a hybrid power-control actuator. In this design a single control actuator is connected to the power actuator through a 90o angle bracket such that the central link of the transmission moves orthogonal to the power actuator to generate a couple modification in the stroke amplitude of the left wing and right wing, and consequently, generating yaw moment (Figure  2.6 right). Similar to the previous version, shifting the DC value of the power actuator results in pitch moment, whereas the roll moment is not still considered in this design. Micromechanical Flying Insect (MFI) ­ the last version The early version of MFI  [3]- [4] was suffering from several issues  [41]. First, the bending cantilevered actuators and the transmission mechanisms were both sources of loss in power delivery form actuators to the wings. This loss resulted in lower flapping amplitude, and thus, the lift degradation. Second, the resonant flapping frequencies of two wings were difficult to match whilst it was necessary for optimal flapping  [41]. Finally, the airframe wasnotabletocompletelyisolatetheeffectsoftwowingsfromeachother.Similarly,TheWoodsHMF design was suffering from power loss due to inevitable large grounded airframe vibrations. Moreover, the low stiffness of the large cantilevered actuator of the HMF design resulted in a rather low flapping frequency (110 Hz), and thus, low power generation. Considering all these issues, Steltz  [41] redesigned the MFI by replacing the bending cantilever PZT actuator with an axially displacing non-cantilever PZT actuator (based on flextensional actuators) (Figure  2.7 right), and also by removing the grounded airframe by utilizing an un-grounded actuation scheme.Accordingtothesemodifications,theSteltzfirst revision of the MFI was developed based on two stages of 18

Figure  2.7: Steltz first revision of the MFI comprised of flextensional modes and dual slider cranks (left and center), and the modified flextensional cymbal actuator (right)  [41]

amplification (from actuator output to wing input) comprised of a flextensional mode (first stage) and a dual slidercrank mechanism (second stage) (Figure  2.7 left and center). Although the Steltz first revision solved many issues associated with the MFI early design, it was still suffering from low flapping amplitude due to poor serial stiffness of the transmission links and joints. Generally, the transmission mechanism is desired to exhibit infinite serial stiffness (or zero serial compliance), however the presence of flexures and small and lightweight materials make it impossible. On the other hand, Steltz  [41] addressed that decreasing the transmission ratio (the ratio of the wing angular displacement over the actuator linear displacement) results in a double increase of the transmission serial stiffness. Thus, he suggested to reduce the transmission ratio by increasing the pre-bent distance of the flextensional actuator side beams, and then, to compensate this transmission ratio reduction by adding a second amplifying stage to increase the flapping amplitude. Besides, this second amplifying stage provides a constraint for the unconstraint rotational motion of the side beams. Finally, to efficiently reduce the transmission ratio, two flextensional stages were connected in series while each side beam was pre-bent twice the previous value (Figure  2.8 left). In summary, the second revision of the MFI  [41] is developed based on three stages of amplification comprised of a double core flextensional stage, a second amplifying stage that attaches the two outward facings links of the core, and a slider-crank mechanism similar to previous version (Figure  2.8 right). 19

Figure  2.8: SteltzsecondrevisionofMFI:threestagesofamplificationcomprisedofdoublecoreflextensional and second amplifying stage (left), and the final mock-up (right)  [41]

2.2.2 Kinematics and Dynamics of transmission
The lift force induced through the wing flapping and rotation is the main source of power that flies rely on to perform their desired flight maneuvers such as takeoff, hovering and saccade. The more rapid and tighter these maneuvers are, the more lift will be required, and thus, the high lift generation is of great deal of interest in design and fabrication of flapping wing aerial micro robots. Since the lift is a quadratic function of the flapping velocity (frequency), increasing the flapping frequency and/or stroke amplitude (for a given flapping frequency) results in high lift generation. Moreover, the large stroke amplitude allows the leading edge vortices to be stabilized before the stroke reversal, and thus, provides enough lift according to the delayed stall mechanism  [18],  [21]. Considering these facts, to amplify the wing flapping motion, the set of actuators, transmission and wing are best to form a resonant system. Now, to increase the frequency of such resonant system the effective stiffness should be increase as much as possible whereas the effective mass (or inertia) is kept to be small. Note that the low effective stiffness also results in elastic deformation or buckling of the components (links, joints, actuators), and thus, lowers the power delivery and controllability of the entire system  [50]. The wing passive rotation, on the other hand, is not a resonant but a quasi-static motion. Thus, the resonant frequency of the passive rotation should be greater than the flapping resonant frequency, or otherwise, the delayed rotation will cause the rotational lift drops dramatically  [18]. To increase the rotational resonant frequency of the wing passive rotation (to be greater than the flapping resonant

20

frequency) the rotational inertia of the wing should be as small as possible, and this could be achieved by proper choice of the wing geometry and constituent material  [55]. The kinematic and dynamic analysis of the entire system can provide an appropriate means for efficient design of the geometry and the constituent materials of the actuator, transmission and wing based on the desired performance of the system. Kinematics In kinematic analysis, the geometric relations between the inputs of the actuators, the transmission links length and the output of the wings are developed, and specific geometries (actuator length and width as well as the transmission links lengths) are chosen based on optimization of two design parameters: transmission ratio and control power. The transmission ratio is the ratio of the wing angular displacement over the power actuator linear displacement; and control power is the ratio of the change in the total stroke amplitude over the control actuator displacement. These two design parameters are optimized to provide the most efficient choice of the actuator and transmission geometry. Dynamics The dynamic analysis is based on the development of the equation of motion using Euler-Lagrange equations, and analyzing the effects of the system drive frequency and resonance on the wing motion  [25] However, here, the actuator displacement is not a geometric input (as was the case for kinematic analysis), but a sinusoidal force input. To develop the Euler-Lagrange equations, the kinetic and potential energy of all components (actuators, transmission links, wings and joints) should be provided; however, a common simplifying assumption is to neglect the kinetic energy of the transmissions, joints and actuators as well as the potential energy of the wings, and thus, the wings' inertia and actuators' stiffness will be the dominant terms in the Euler-Lagrange equations. Therefore, again, high desired flapping frequency mandates high actuator stiffness and low wing inertia. Another important consideration in dynamics analysis of the transmission mechanism is that this mechanism should be designed such that it impedance-match the wing loading and the internal loss of the actuator to maximize the power delivered from the actuators to the wings  [41].

21

2.2.3 Transmission manufacturing issues
The transmission components are fabricated under the SCM paradigm. First, the carbon-fiber composites in an uncured state (prepreg) are laser cut into arbitrary 2D patterns, and then the flexures are added to the mechanism by sandwiching an elastic polymide layer with cut laminas. The 2D cut laminates are then aligned and bonded in a controlled curing process. Finally, these 2D patterns are folded and frozen to form the 3D pattern of the transmission mechanism using a micro-origami procedure  [56]. Since bonding between laminates forms during the curing process, there is no need for extra gluing of flexures which results in a remarkable economy in weight. The flexure joints are desired to have very large serial stiffness but nil parallel and rotational stiffness. Equivalently, it is advantageous to orient the flexures such that the force transmitted through them always points along their axial length  [5]. Moreover, there might be some prestress imparted to the flexures during the fabrication which may result in flexure displacement without any driving actuation. To minimize this effect, it is suggested  [5], [52], to cure the entire mechanism one more time after the fabrication is completed.  Another important issue in fabrication of the transmission mechanism is to decide to whether cut the composites prepreg cured or uncured. The SCM paradigm  [51],  [52] suggests to first cut and then cure the prepreg. However there are several difficulties for cutting the uncured prepreg  [41]. First, during the laser cutting, the matrix epoxy might flow around the cutting area. Second, only one layer could be cut at the time. Finally, the viscoelastic state of the uncured matrix epoxy might destroy the smaller features of the prepreg. On the other hand, cutting the uncured laminate and then curing it have the advantage of laying up the carbon fiber composite of the links and polymer layer of flexure joints at one time, and then cure this whole laminate without the need for extra adhesive layer  [41]. This, results in easier fabrication and lower weight of the components.

2.3 Wing and Airframe (exoskeleton)
The wing and the airframe are desired to be as stiff as possible. In particular, the airframe forms a mechanical ground for the actuator(s), transmission(s) and wings. Thus, the stiffness of the airframe relative to the actuators (which are the dominant terms in the context of stiffness in the wing driving system) is of great importance  [41]. The

22

Figure  2.9:

The airframe layout of MFI (left)  [41] and HMF (right)  [55]

airframe of the early MFI  [52] was designed based on the concept of the tensegrity structures. This design utilized the stiff and ultra-lightweight carbon fiber composite beams with tensional integrity and comprised of beams stiff in both tension and compression connected to the reinforcing bars only stiff in tension (Figure  2.9 left). Wood  [55] could simplify and cut the weight of the airframe structure by reducing the number of actuators and transmission mechanism links (Figure  2.9 right). Steltz  [41] argued on inevitable vibrations of still large grounded airframe of the Woods design and suggested an ungrounded actuator scheme (Figure  2.8 right). Inspired from the wing pattern of real flying insects, the stiffness of the wing is chosen anisotropic in the longitudinal and chordwise direction (Figure  2.10). This structure is comprised of veins made of unidirectional M60J carbon fiber and ester composites which are added to the membrane made of thin polyester face sheet in a curing process. The distribution of the veins are chosen such that maintain a highly rigid structure whereas the flapping and

Figure  2.10: The HMF design wing layout  [55]

23

rotation inertia remain small enough  [56]. This design ended up into a component which surpassed its biological analog in terms of stiffness to weight ratio. It worth to note that many biological observations report the presence of compliance in the wing structure, and emphasize the important role of this characteristic in the wing lift augmentation. However, for the sake of design simplicity, this feature is not still considered in the HMF design.

24

3.

Insect Flight Mechanisms
Experimental investigations of neurobiologist and biomechanical engineers tounderstandtheinsectsflight

mechanism have provided a means to be used to develop a reliable simulation framework for dynamic modeling and controller design of insect-like flapping wing AMRs. The simulation analyses performed through this framework can be used to understand the present challenges in the context of design and fabrication of an at-scale insect-like flapping wing AMR with a significant economy in cost and time. In other words, a simulation framework obtained by mathematical formulation and based on physic laws and experimental studies let the research investigations continue until the progress in the manufacturing technology fill the gap between the present fabricated models and a perfectly bio-mimetic operational aerial micro robot. Such simulation framework is basically comprised of four units: aerodynamics, dynamic modeling, control system, and sensory system. This chapter outlines the underlying theories and challenging issues in the context of each of these basic units to provide a means by which the mathematical development of the dynamic modeling and controller design could be accomplished through the following chapters.

3.1 Aerodynamics
Basically, the most challenging issue in modeling of the wing aerodynamic forces and moments in a flapping motion is the unsteady nature of the wing kinematic mechanisms. However, a reliable approach in this regard is to

25

exploit the quasi-steady model for some of these unsteady mechanisms. The idea is to model the aerodynamic forces and moments at each instantaneous velocity and angle of attack based on a simple steady-state model, and then, reconstruct the time history of the forces and moments for the complete stroke. However, since the quasi-steady model does not provide a valid approximation of highly unsteady mechanisms such as wake capture and clap-andfling, the net aerodynamic forces and moments should account for both the quasi-steady and the unsteady mechanisms. Basically, six unsteady mechanisms are suggested to fit the insects flapping flight including  [28]: Wagner effect, clap-and-fling, added mass effect, delayed stall, rotational lift and wake capture. Wagner effect According to the Wagner effect, when an inclined wing is accelerated from rest, the circulation rises slowly to its steady-state value due to viscosity. This sluggish formation of the circulation results in a lift value which is less than what is expected according to the quasi-steady model. However, recent studies  [17] indicate that the Wagner effect is negligible for the typical Reynolds number of the most flying insects. Clap-and-fling The clap-and-fling mechanism,  [49] or the Weis-Fogh mechanism, is comprised of two wingbeat phases called clap and fling. At the end of the upstroke the side wings rotate and their leading edges touch each other (clap). Thereafter, the wings pronate with the trailing edges still in contact, and fling open rather like a book  [22]. At the clap, as the wings press together closely, the opposing circulations of each of the airfoils annul each other. This phenomena eliminates (or at least attenuates) the trailing edge vorticity shed by each wing on the following stroke [37]. Since the shed trailing edge vortices delay the growth of circulation via Wagner effect, this absent allows the wings to build up circulation more rapidly, and thus, extend the benefit of over time in the subsequent stroke. Moreover, a jet of fluid excluded from the clapping wing can provide insect with additional thrust  [7]. Before the downstroke starts, at the end of clap, the wings continue to pronate by leaving the trailing edge stationary as the leading edge fling apart  [37]. This process generates a low pressure region between the wings which sucks the surrounding air into the gap between the wings, and consequently, augments the circulation (lift) before the starting of the downstroke. Although clap-and-fling can be a considerable source of lift enhancement in flying animals, most

26

of insects (in particular large insects) do not perform this mechanism, and thus, it does not seem to be an appropriate means to interpret the high lift mechanism of the flying insects  [18],  [37]. Moreover, in a different perspective, the clap could be assumed only a means to be used to maximize the wing stroke amplitude to enhance the lift and nothing more!  [37]

Added mass effect Added mass effect is addressed to the acceleration of the mass of the fluid (air) attached to the wing  [18]. Once the wing starts moving from rest, a reactive acceleration will be generated in the surrounding fluid in response to the motion. This non-circularity force is function of the wing angle of attack and instantaneous velocity. Although the added mass effect is rather difficult to be measured  [37] and are observed to exhibit small contribution in the insects wing net aerodynamic force  [38], some mathematical models are suggested to take this effect into account in an accelerated flight  [19],  [38].

Delayed stall For a linear translational motion of a 2-D wing (airfoil) at high angle of attack, the flow structure generates leading edge vortices (LEV) which reattach to the wing and result in a circulatory force in excess of those supported under steady state conditions (Figure  3.1 A). This phenomenon of high lift generation at several chord lengths before the stall as a result of LEVs reattachment is called delayed stall. This lift enhancement process continues until the LEVs reattachment is no longer possible and the Kutta condition  [1] breaks down as vorticity forms at the trailing edge, and the leading edge vortices shed into the wake  [18],  [37]. At this point the wing is said to have stalled which is accompanied with generation of Von Karman Streets (Figure  3.1 A), and a tremendous drop in the lift. However, in a 3-D flapping translation, it has been observed  [22] that a steady span-wise flow from the root to approximately three quarter of the wing tip, at which point the LEVs detach from the wing surface, stabilizes these vortices by forcing them to swirl toward the wing tip  [37] (Figure  3.2). This spiral motion retains the LEVs smaller, and thus, lets the fluid to reattach more readily and stay attached for several chord lengths before the next flapping phase starts

27

Figure  3.1:

A comparison of (A) 2-D linear translation and (B) 3-D flapping translation  [37]

to generate new LEVs (Figure  3.1 B). This reciprocating mechanism provides insects with a means to generate a tremendous lift at high angle of attack without being stalled. Rotational lift The wing rotation at the stroke reversals (at the end of either downstroke or upstroke) breaks down the Kutta condition at the trailing edge. This phenomenon enforces the wing to generate a rotational circulation in the fluid to counteract the effects of the rotation, and thus, re-establish the Kutta condition at the trailing edge  [37]. Although the

Figure  3.2: [37] 

3-D stabilizing span-wise axial flow pattern (black arrows indicate downwash due to vortex system)

28

rapid rotation of the wing might never allow the re-establishment of the Kutta condition during the rotation, the fluid keeps dictating to generate circulation until smooth and tangential flow can be established at the trailing edge. It is important to note that the stroke reversal (the switch between downstroke and upstroke) not necessarily coincides with the wing rotation (pronation and supination). Depending on the timing and direction of the rotation (supination or pronation) the resultant force will be either added to or subtracted from the net translational force. In fact, insects utilize this phenomenon to establish their desired maneuvers by adjusting the timing of the rotation. Moreover, it should be noted that the rotational lift (also called Kramer effect) is totally different form the wing rotational inertial forces. Some experiments  [18] have shown that the forces generated at the wing reversal could not be explained by either translational or rotational inertia (mass acceleration, gravity and added mass effect). Wake capture At the beginning of each half stroke, the wing faces the shed vorticity of the previous stroke. This interaction increases the effective fluid velocity, and consequently, results in a significant lift augmentation at the beginning of the new stroke  [18]. In this way, insects can capture the lost energy of the preceding strokes wakes. However, since the wake capture is highly unsteady mechanism, development of a reliable mathematical model for this phenomenon is still an open research area.

3.2 Dynamic Modeling
The insect-like flapping wing AMR simulation frameworks are mostly developed based on the rigid body assumption in which the body and the wings are assumed to be rigid objects without exhibiting any deformation [20],  [28],  [44]. Moreover, due to the lack of thorough insight into the neuromuscular mechanism of the insects wing, each wing is normally assumed to exhibit three rotational degrees of freedom through an actuated spherical joint  [19]. Furthermore, Schenato et al.  [15]- [16] introduced the application of the averaging theory for insect-like flapping wing aerial micro robots. According to this theory, for insects with high flapping wing frequency, only the wingbeat-cycle-averaged aerodynamic forces and moments modulate the body, and thus, a simplified time-averaged model of the insect could be obtained to be used for simulation analysis and controller design.

29

In fact, the most challenging concern in the context of simulation and flight dynamics analysis of insect-like aerial micro robots is to properly develop the wing kinematic equations. In addition to the flapping,theinsectswing exhibits rotations about its longitudinal axis as well as deviation from the stroke plane (the imaginary plane in which the wing flapping motion is confined in) in an oval or figure-of-eight pattern. As mentioned earlier, these wing kinematic parameters (flapping, rotation and deviation angles) can be generated through an actuated spherical joint, and the wing kinematic equations could be obtained by representing the angular velocity of the wing with respect to the body as a function of the rate change of the wing kinematic parameters. This could be accomplished by relying on a consistent definition of the frames and their associated coordinate systems as will be more illustrated in section 4.3.1 .  Finally, the reliability of the articulated rigid-body equations of motion is strongly correlated with the accuracy of the provided mass properties of the comprising objects. These properties for an insect-like flapping wing AMR include the information of the mass, moment of inertia and location of the center of mass for the body and the wings. It should be noted that the wing flapping motion results in fluctuation of the center of mass of the clustered bodies in a flapping wing aerial micro robot.

3.3 Sensory System
Recent interests in design and fabrication of insect-like flapping wing aerial micro robots have demonstrated the importance and capabilities of the biomimetic sensory systems. Inspired from the real flying insects sensory mechanism, Deng et al. proposed four classes of biomimetic sensors to be served in an integrative simulation framework of flapping wing AMRs  [15]: ocelli, magnetic compass, halteres, and optical flow sensors. A collaborative integration of all these sensory mechanisms is necessary to provide the controller with a complete set of required information. The ocelli is a photosensitive sensory system comprised of four photoreceptors which are inspired from three wide-angle photoreceptors on the head of the flying insects. This sensory mechanism could be served to horizontally stabilize the AMR and estimate its roll-pitch attitude. The magnetic compass plays the role of the complementary sensor for the ocelli by estimating the heading angle based on the terrestrial geomagnetic field. Halteres are

30

biomimetic sensory structures inspired from the evolutionary modified hind wings of flies, and serve as a set of biological gyroscopes to measure the angular velocities of the flapping wing AMR. During the flight, two halteres beat up and down in two non-coplanar planes through an angle of nearly 180 anti-phase to the wings at the wingbeat frequency  [15]. The optical flow sensors provide low spatial resolution visual information for navigation, object avoidance and small field object fixation. These sensors are inspired from compound eyes of flying insects, and require more sophisticated signal processing than other types of biomimetic sensory systems [16]. Furthermore, other types of sensors such as temperature sensors, chemical sensors or pressure sensors might be implemented in the simulation framework of insect-like flapping wing AMR depending on the specified operational flight missions.

3.4 Control System
Basically, control system is the central processing unit of an integrative simulation framework. For an insectlike flapping wing AMR, this unit modulates the wing kinematics parameters to produce required forces and moments to be applied to the body and provide desired maneuvers. In this regard, two important questions should be answered in advance. First, how many independent control inputs are needed to be able to perform all desired flight maneuvers? In other words, how many independent degrees of freedom can be controlled by insects? And second, what is the best set of wing kinematic parameters to be exploited as control inputs? Regarding the similarities between the control strategy implemented by insects and helicopters, Taylor  [47] addressed the first question by suggesting that depending whether the direction and the magnitude of the longitudinal force can be varied independent of the pitch angle, either four or five degrees of freedom can be controlled. Consequently, the insects with capability of modulating the wing net aerodynamics force without necessarily changing their attitude, would be able to independently control five out of six degrees of freedom. Moreover, insects are observed to utilize the advantage of modulating same control inputs either symmetrically or asymmetrically to generate longitudinal and lateral flight maneuvers, respectively. This, results in great economy in the number of the control inputs and remarkable redundancy in the control architecture  [43].

31

The second question has been addressed through experimental investigations of biologists to indicate how insects modulate their wing kinematics to perform desired flight maneuvers. Following wing kinematics and postural changes are the most suggested control inputs to be used for an insect-like flapping wing AMR  [15],  [22], [38],   [47]: stroke amplitude, wingbeat frequency, mean stroke angle, stroke plane inclination angle, speed and timing of rotation at the wing reversal (advanced or delayed), wing effective angle of attack, shape of the wingtip trajectory (oval or figure-of-eight), longitudinal position of the stroke plane, and the abdomen and legs posture. The stroke amplitude is the angle of the great arc swept by wing at each stroke (downstroke or upstroke). This kinematic parameter is strongly correlated with the aerodynamic force production, and is considered as the most significant control input in flying insects. Depending on the relative position of the wing aerodynamic center and the body center of mass, symmetric modulation of the stroke amplitude results in a pitch-up or pitch-down, whereas its asymmetric modulation results in coupled roll and/or yaw moments. However, since flying insects usually produce less thrust than lift, the generated roll moment is commonly greater than the yaw moment  [43]. Moreover, Dickinson et al.  [17] commented that the effect of the timing of wing rotation on the roll production might be more significant than the effect of asymmetric stroke angle amplitude modulation. The wingbeat frequency is directly correlated with the lift; however, since the neuromotor mechanism of the insects wings does not allow the wings (left and right) to be rotated at different frequencies [48], this kinematic parameter only affects the longitudinal flight maneuvers through the simultaneous symmetric modulation of the both wings. Moreover, it has been observed [48] that the wingbeat frequency and the stroke amplitude are physiologically correlated and mechanically linked to each other, and thus, it is hard to distinguish their sole effects on the wing aerodynamic force modulation. The mean stroke angle alters the horizontal position of the effective point of the stroke-averaged aerodynamic force on the stroke plane. Therefore, symmetric and asymmetric modulation of this term respectively affects the longitudinal mode through the pitch and the lateral mode through the roll and/or yaw. However, since insects alter the stroke amplitude by adjusting the lower turning point of the wings at the stroke reversal [48], modulation of the mean stroke angle and stroke amplitude exhibit strong coupling. Stroke plane inclination angle can be served to play a role similar to that of ailerons or elevons in conventional and tailless aircrafts, respectively. Since the wing aerodynamic force is approximately perpendicular to

32

the wing surface, and the wing motion is confined in the stroke plane, the stroke-averaged aerodynamic force of the wing can be approximately assumed to act perpendicular to the stroke plane. Therefore, inclination of the stroke plane can be associated with modulation of the direction of the stroke-averaged wing aerodynamic force. In particular, asymmetric variation of the stroke plane inclination angle results in a coupled role-yaw moment. However,accordingtothebiologistsobservations,thistermishighlylinkedwithchangesinthestrokeamplitude, and thus, appears not to serve as an independent control input [48]. Speed and timing of rotation at the end of each stroke have significant contribution to the aerodynamic performance of the wing by altering the effect of the wake capture and rotational lift mechanisms. Specifically, advanced supination (wing rotation between the downstroke and upstroke) before the stroke reversal is observed to dramatically augment the lift by enhancing the unsteady mechanisms of the rotational lift and the wake capture  [18]. In contrary, if supination succeeds the stroke reversal, these unsteady mechanisms contribute a negative correlation with the net aerodynamic force and degrade the aerodynamic performance. Therefore, insects perform this strategy, in particular for lateral maneuvers, by increasing the pronation (wing rotation between the upstroke and downstroke) of the inside wing and decreasing the supination of the outside wing to achieve roll and yaw. Wing effective angle of attack has positive correlation with both the lift and the drag. Excluding the termination stage of the stroke reversal, the mean angle of attack remains almost constant during the stroke course. Thus, it does not seem that insects utilize this kinematic term as a significant control input. Deviation of the wing from the stroke plane is observed to result in an either oval or figure-of-eight trajectory of the wingtip. The main consequence of this off-stoke-plane motion is generation of a radial component (out of the chord-cross-sectional plane of the wing) in the net aerodynamic force. Direction and magnitude of this radial force remain unchanged for the figure-of-eight wingtip trajectory during upstroke and downstroke, whereas for an oval trajectory its direction reverses at the stroke reversal  [38]. Furthermore, at the beginning of the stroke, upward and downward motion of the wing respectively results in decrease and increase in angle of attack. In contrary, at the end of the stroke, wing deviation has opposite effect on the angle of attack  [38]. Moreover, stroke deviation affects the contribution of the wake capture on the wing aerodynamic performance by altering the wing-wake interface position. The experimental investigations of the Sane et al.  [38] indicate that the stroke deviation (either upward or

33

downward) decreases the mean lift and drag coefficients; however, its influence is rather small such that the strokeaveraged net aerodynamic force remains almost constant with changes in the stroke deviation. Longitudinal position of the stroke plane has occasionally observed to vary as an independent control input in some insects (e.g. Drosophila melanogaster) to modulate the pitch [48]. The leg movement and the abdominal deflection can shift the location of the insects center of mass, and consequently, modulate the roll, pitch and yaw by altering the effective arm of the wing aerodynamic forces. Nevertheless, the abdominal deflections are too slow to account for the rapid maneuvers like saccade [48].

34

4.

Dynamic Modelling and Simulation of Flapping Wing AMR

The six degrees of freedom rigid body equations of motion are basically comprised of three translational and three rotational equations. These equations along with the kinematic relations constitute a mathematical framework to be used for simulation analysis and controller design of physical objects. The translational and rotational equations are normally developed based on the Newtons second law and the Eulers law, respectively. These physical laws are both referred to a fixed frame, and are normally presented in a moving coordinate systems for numerical simulation and programming. Therefore, the proper definition of frames and their associated coordinate systems are of great importance in the rigid body dynamical modeling. Basically, the general strategy in development of equations of motion for an insect-like flapping wing AMR is to introduce four frames (Inertial, Body, Left Wing and Right Wing) and their associated coordinate systems, and develop the translational, rotational and kinematic equations for a system of clustered rigid bodies comprised of body and two wings. The key idea here is to develop each term in the equations of motion such that to be correlated with its corresponded frame, and then, exploit transformation matrices to represent all terms of the final set of equations in an appropriate coordinate system which is usually the Body coordinate system. For instance, the angular velocity of the wing with respect to the Inertial frame is comprised of vector sum of two angular velocities including the angular velocity of the wing with respect to the Body frame and the angular velocity of the body with 35

respect to the Inertial frame; and thus, the former should be developed in the Wing frame and the later in the Body frame; however at the end, all terms must be represented in the Body coordinate system using transformation matrices. In this chapter, the general framework used to establish the equations of motion is first represented, and then, the kinematics and the dynamics equations of motion for an insect-like flapping wing aerial micro robot are developed based on the proposed framework. Finally, some simulation analyses are performed to investigate the reliability of implementing two commonly proposed simplifying assumptions in modeling of insect-like flapping wing AMRs: the averaging theory and the negligible wing mass effect.

4.1 General Framework
This section outlines the essential means required to develop the equations of motion for a flapping wing AMR. Specifically, the definition of the frames and their associated coordinate systems, as well as the suggested notations and the mathematical tools are explained.

4.1.1 Frames and Coordinate Systems
In this framework, frames and coordinate systems are defined to represent two different, but associated, mathematical tools. Frames are used to develop the tensorial form of the equations of motion, whereas the coordinate systems are exploited to embed numbers into tensors and perform numerical simulations. Specifically, for an insect-like flapping wing AMR, four frames and their associated coordinate systems are needed to be defined as follows (Figure  4.1). The Inertial frame () is fixed in the space and the  axis of its associated coordinate system istowardtheEarthscenterofgravity.TheassociatedcoordinatesystemoftheBodyframe () is attached to the body center of mass and its  and  axes point toward the head and the right wing, respectively. The Wing frames (left and right) ( ) have their associated coordinate systems located at the each wings center of mass, while their  and  axes are toward the wing leading edge and the wing tip, respectively. All coordinate systems follow the righthand rule; for instance, the  axis of the left wing coordinate system is downward at the upstroke and upward at the downstroke (Figure  4.3).

36

I YI ZI XI YB W B XW J ZW YW

ZB XB

Figure  4.1:

The insect-like flapping wing AMR coordinate systems: Inertial (I), Body (B) and Wing (W)

4.1.2 Notation
 Three vectors  ,  and   are the basic constituents of the equations of motion. These vectors

respectively represent the position of the point  with respect to the point , the linear velocity of the center of mass of the rigid body  relative to the frame , and the angular velocity of the frame  relative to the frame . The skew-symmetric form of these vectors (to be used for tensorial representation of the vectors cross product) is
  denoted by the capital letters  ,  , and  , respectively. Furthermore,   and  represent the mass of rigid

body  and its tensor of moment of inertia about its center of mass and relative to the frame . Moreover, the external forces applied to the rigid body  and the external moments about its center of mass are represented by  and  , respectively. Vectors  and skew-symmetric matrices  in tensorial form are defined to become coordinates (vectors and matrices embedded with numbers) by using square brackets, whereas the corresponded coordinate system () is identified by a raised capital letter as  coordinate system  is denoted by 
 

and   . Finally, transformation matrix from coordinate system  to


, and the bar sign indicates the matrix transpose 

.

37

4.1.3 Mathematical Tools
Basically, this framework is developed based on the seminal tensorial approach of the Zipfel  [57] in which the equations of motion are developed in an invariant tensorial form by using frames while being independent of coordinate systems; and then, these equations are represented in an appropriate coordinate system to generate the numerical simulation. In other words, frames and their associated coordinate systems are used for modeling and numerical simulation, respectively. The most important mathematical tool in this framework is the rotational time derivative operator    which is defined as time derivative of vector  relative to frame . The rotational time derivatives of vector  relative to any two arbitrary frames  and  (with relative angular velocity of   ) could be related to each other using Euler transformation  [57] as    =    +   ( 4.1)

After development of equations of motion, all terms (including vectors and skew-symmetric matrices) must be represented in an appropriate coordinate system using transformation matrices. In this regard, following relation are used for coordinate system transformation of vectors and matrices, respectively  
 

= 









( 4.2)


= 





( 4.3)

Finally, the rotational time derivatives that are expressed in their own associated coordinate system become ordinary time derivatives to be ready for numerical integration:   


=

 

( 4.4)

4.2 Transformation Matrices
As discussed earlier, the invariant equations of motion in tensorial form will finally be represented in the Body coordinate system for numerical simulation. However, some terms are more convenient to be defined in the Wing or Inertial coordinate systems. For example, location of the wing center of mass with respect to the wing hinge  (Figure  4.1) is a constant vector in the Wing coordinate system; or, the gravitational forces are easier to be 38

represented in the Inertial rather than the Body coordinate system. Therefore, an appropriate strategy is to represent each term of the tensorial equations of motion in any arbitrary (but appropriate) coordinate system, whereas at the end, all terms will be unified by being represented in the Body coordinate system using transformation matrices. Therefore, two transformation matrices from the Wing and the Inertial coordinate systems to the Body coordinate system are needed to be developed in advance. Basically, transformation matrix between two arbitrary coordinate systems depends on relative motion of these coordinate systems with respect to each other. The idea is to perform a minimum number of orthogonal sequential rotations starting from one coordinate system and ending up lying on the other one. In this way, depending upon how many rotations should be performed, a set of intermediate coordinate systems are needed to be defined. Therefore, the final transformation matrix could be provided by multiplying a set of transformation matrices corresponded to the intermediate rotations form the starting coordinate systems to the terminal one. Normally, transformation matrices between two arbitrary coordinate systems  and , with rotation angle , about  ,  and  axes of the coordinate systems, could be obtained from relations provided in Table  4.1. Thus, knowing only the rotation angles and the axes of rotation suffice to generate the transformation matrix between any two arbitrary coordinate systems.

4.2.1 Wing-Body Transformation Matrix
The stroke motion of the wing is approximately confined in an imaginary plane called stroke plane. The intermediate coordinate system () corresponded to this plane is obtained by rotating the Body coordinate system

Table  4.1: Rotation Rotation  about  axis Rotation  about  axis Rotation  about  axis

The Standard Transformation Matrices Notation  Transformation Matrix  1 0 0 cos  0 -sin  cos  0 sin  cos  -sin  0 39 0 sin  cos 








0 -sin  1 0 0 cos  sin  cos  0 0 0 1





about its  axis through an angle called stroke plane inclination angle () (Figure  4.2). Furthermore, the wings are assumed to exhibit three rotational degrees of freedom with respect to the body through an actuated spherical joint, namely stroke angle (), deviation angle (), and rotation angle ( ). The stroke angle  is angle between the projection of the wing longitudinal axis on the stroke plane and the  axis of the stroke plane coordinate system. This angle is defined to be negative for positive  and positive for negative  (Figure  4.3). The deviation angle  is angle between the longitudinal axis of the wing and the stroke plane, and is positive above the stroke plane and negative bellow the stroke plane. Finally, the rotation angle  is the amount of wing rotation about its longitudinal axis and is defined to be positive during the downstroke and negative during the upstroke (Figure  4.3). For the cases in which the deviation angle is set to zero ( = 0), the rotation angle  also represent the wing effective angle of attack  (Figure  4.3). Therefore, for each wing, to develop the transformation matrix from Body to Wing coordinate system 


,

four consecutive rotations (, , ,  ) should be performed through three intermediate coordinate systems (, 1 , 2 ). However, because of the periodic motion of the wing coordinate system and the specific definition of the wing kinematic parameters, transformation matrices for each wing (left and right) during each half-stroke (downstroke and upstroke) will have different sing of rotations. Table  4.2 shows the rotation angles and the axes of rotation for

  


 



  =  

( = )

Figure  4.2: The lateral view of the right wing at the downstroke for zero deviation angle, and definition of the corresponding wing kinematics and body attitude angles

40

each transformation sequence from Body to Wing coordinate systems for each wing during downstroke and upstroke. For each rotation angle, the first subscript ( or ) associates the wing side (Right or Left), whereas the second subscript (, ,  , ) indicates the axis of rotation. For example, to build up  downstroke we should perform ­ 
 2 1

for the right wing at the

which indicates ­  degrees of rotation about the  axis. Each transformation

matrix is a 3 by 3 orthogonal matrix as presented in Table  4.1. The orthogonality of these matrices provides them with the advantage of obtaining the inverse of the matrices by simply transposing them. Therefore, transformation matrix from Wing to Body coordinate system 


could readily be obtained by transposing 



. Note that

during the transformation from  to 1 , for three cases, the transformation matrix should be pre-multiplied by the indicated matrices to be consistent with the definition of the stroke plane and the wing coordinate systems. For instance, the transformation matrix from  to 1 for the left wing during the downstroke is obtained by  degrees rotation about the  axis (Table  4.1) and pre-multiplying the resulting matrix with a diagonal matrix whose elements are (1, -1, -1), as bellow cos  1 0 0 = 0 -1 0 -sin  0 0 -1 0 sin  cos  0 0 0 1 ( 4.5)



1  Down Stroke Left Wing

Table  4.2:

The angles and the axes of rotation for transformation from Body to Wing coordinate systems Down Stroke Right Wing Left Wing -
*


Up Stroke Right Wing -
**


Left Wing -
***


    



-  -  




1  2 1 2







-  




-





 - 



- - 
0 -1 0 0 0 1











 DownRight

 DownLeft


0 1 0

 UpRight

 UpLeft

*

1 Pre-multiply by 0 0

0 -1 0

0 -1 ** Pre-multiply by 0 0 , -1 0

0 -1 *** Pre-multiply by 0 0 , -1 0

41

Downstroke
 =  (+) 

Left Wing
  

Right Wing
 

 (-) 

  

 (-)   (+) 

 (+) 

 ( = )

Upstroke
 =  (-)

Left Wing




Right Wing
 

 (-)



 



 (-)   (+)

 (+)   ( = ) 





Figure  4.3: The orientations of the Wing coordinate system and definition of the wing kinematic parameters for each wing (left and right) at each stroke (downstroke and upstroke) for zero deviation angle

42

4.2.2 Body-Inertial Transformation Matrix
Transformation matrix from Inertial to Body coordinate systems is obtained by starting from Inertial coordinate system and performing three consecutive orthogonal rotations known as Euler angles (, , ) through two intermediate coordinate systems respectively about ,  and  axes, and finally, lying on the Body coordinate system. This transformation matrix is frequently presented in the flight dynamics literatures  [57] in following form cos  cos  = cos  sin  sin  - sin  cos  cos  sin  cos  + sin  sin  sin  cos  sin  sin  sin  + cos  cos  sin  sin  cos  - cos  sin  - sin  cos  sin  cos  cos 





( 4.6)

However, the Euler angles become impractical at the vertical posture of the body ( = 90 ) where the kinematic equations exhibit singularities  [57]. This is an important issue, especially for the insect-like AMRs in which the usual hovering posture occurs with the body longitudinal axis close to the inertial vertical line. Considering this limitation, the Quaternions method is suggested as an appropriate alternative to the Euler angles method. In this method, four Quaternion parameters (0 , 1 , 2 , 3 ) are used to develop the transformation matrix from Inertial to Body coordinate systems based on the same concept used in Euler angles method, as bellow  [57]:
2 2 2 2 0 + 1 - 2 - 3 = 2(1 2 + 0 3 ) 2(1 3 - 0 2 )





2(1 2 - 0 3 ) 2 2 2 2 0 - 1 + 2 - 3 2(2 3 + 0 1 )

2(1 3 + 0 2 ) 2(2 3 - 0 1 ) 2 2 2 2 0 - 1 - 2 + 3

( 4.7)

The Euler angles could be readily expressed in terms of the quaternion parameters using following relations [57]:  2 1 2 + 0 3 2 2 2 + 1 - 2 - 3 ( 4.8)

tan  =

2 0

sin  = -2 1 3 - 0 2 tan  = 2 3 2 + 0 1 2 2 2 - 1 - 2 + 3

2 0

43

4.3 Kinematics Equations
Basically, kinematic equations represent the mathematical relations between the rate of change of the kinematic parameters and the angular velocities. However, the wing and the body kinematic equations contribute to the equations of motion in two different ways. The body kinematic equations represent the rate of change of the body kinematic parameters (either Euler angles (, , ) or Quaternion parameters (0 , 1 , 2 , 3 )) as function of the body angular velocity relative to the Inertial frame and represented in the Body coordinate system   . This set of three ordinary differential equations is used to propagate the body kinematics parameters and update the transformation matrix from Body to Inertial coordinate system 


during the simulation. On the other hand, since

the wing motion is generated through an actuated joint, the time histories of the wing kinematic parameters (  ,   ,   and ()) are already available in association with the control module. Therefore, the wing kinematic equations are only required to obtain the angular velocity of the Wing frame with respect to Body frame  as a function of the rate of change of the wing kinematic parameters.

4.3.1 Wing Kinematics
Following the sequence of rotations from the Body to the Wing coordinate systems (Table  4.2), and considering the definition of the intermediate coordinate systems (, 1 , 2 ), the angular velocity of the Wing frame with respect to the Body frame  could be obtained as a vector sum of the wing kinematic parameters (, ,  ,  ) as follows  =  + 1 +  2 +   ( 4.9)

where  , 1 , 2 ,  represent the unit vectors of the three intermediate coordinate systems , 1 , 2 and the Wing coordinate system  , in the , ,  ,  directions, respectively. Normally, it is desirable to express the  in the Wing coordinate system, and consequently, all terms in the right hand side of equation ( 4.9) are needed to be represented in the Wing coordinate system as well. On the other hand, the unit vectors  , 1 , 2 ,  acquire the simplest form when expressed in their own associated coordinate systems. Therefore, equation ( 4.9) can be represented in the Wing coordinate system as follows:

44





=  

2



2 1

 

1 





+  

2

 1

2 1

1

1

+  

2

2

2

+  



( 4.10) 


Therefore, by denoting [0 1 0] , and introducing     =  



= [0 1 0], 

1

= 0 0 1,

2

2

= [1 0 0],

=



= [

 ], the wing kinematic equations could be obtained as 0 0 +  ± ± 0 0 + ± 0 0

2



2 1



1 

0 ± +  0

2



2 1

2

( 4.11)

where the sing of the rotation rates (±) for each wing (right and left) at each stroke (upstroke and downstroke) could be obtained from Table  4.2 with exactly same signs used to perform the rotations to generate the transformation matrices.

4.3.2 Body Kinematics
The Body kinematic equations in terms of the Quaternions parameters (0 , 1 , 2 , 3 ) are commonly presented in the aerospace literatures in following form  [57]: 0 0 1  1 = 2 2   3 - 0 -  -  0 - - -  0 0 1 2 3

( 4.12)

where , ,  are components of the body angular velocity with respect to the Inertial frame represented in the Body coordinate system   . The Quaternions method possesses two advantages of not exhibiting singularities and not containing trigonometric functions. However, since the Quaternion parameters are per se mathematical tools without physical meaning, the differential equations set ( 4.12) should be initialized using information of the initial Euler angles through following relations  [57]:       cos cos + sin sin sin 2 2 2 2 2 2       1 = cos cos sin - sin sin cos 2 2 2 2 2 2       2 = cos sin cos + sin cos sin 2 2 2 2 2 2       3 = sin cos cos - cos sin sin 2 2 2 2 2 2 0 = cos

( 4.13)

45

4.4 Dynamic Equations of Motion
At the heart of the simulation framework are the translational and rotational dynamics equations. These equations are normally developed based on the Newtons second law and the Eulers law, respectively. In this section the rigid-body dynamic equations of motion are developed for an insect-like flapping wing AMR.

4.4.1 Translational Dynamics
The Newtons second law for a system of  clustered rigid bodies is used to develop the translational dynamics equations as follows  [57]:

 


     =




( 4.14)

To specify this formulation for an insect-like flapping wing AMR, three points of , ,  are introduced to represent the locations of the body center of mass, the wings joints and the wings center of mass, respectively (Figure  4.1). Now, separating the body and the wings contributions in equation ( 4.14), with  =  +  +  , results in ( 4.15)

      +


    +


    +


   =




The first and the last terms in the left hand side of equation ( 4.15) can be merged together, and thus, by
 introducing    =  , we get

    + 

     +


     =




( 4.16)

Since the first term in the left hand side of above equation is related to the Body frame, the Euler transformation could be used to develop this term in the Body frame as follows:
       =    +  

( 4.17)

The second term in the left hand side of equation ( 4.16) is related to the Wing frame, and thus, its rotational time derivative should be transformed into the Wing frame as well

46

    =
 

     +  

( 4.18)

Since the  is a fixed (constant) vector in the Wing frame, the first term in the right hand side of above equation vanishes (   = 0). Besides, by rewriting  =  +  , we get      =
 

     +  

( 4.19)

Furthermore, since  and  are respectively related to the Wing frame and the Body frame, their rotational derivatives should be transformed into their associated frames. Thus, equation ( 4.19) becomes      =
 

    +    +     +    


=

    +     +    +    +     +   

( 4.20)

In the right hand side of above equation, first of all, the second term vanishes; moreover, according to the general strategy in development of equations of motion, rewriting  =  +  and using Euler transformation    =    +   leads to      =
 



    +     +   + 2   +   

( 4.21)

Finally, the third term in the left hand side of equation ( 4.16) should be transformed to the Body frame, which with considering    = 0, results in the following relation:       =
 

     +   

( 4.22)

By substituting equations ( 4.17), ( 4.21) and ( 4.22) into ( 4.16), translational dynamics equations for an insectlike flapping wing AMR in an invariant tensorial form will be obtained as follows:     +       +   + 2   +    +    +   =    +    +   







( 4.23)

Now, to embed numbers and perform numerical simulation, each term in the equation ( 4.23) will be represented in its associated coordinate system. This will simplify the equation set by turning the rotational time 47

derivatives into ordinary time derivatives (according to equation ( 4.4)). However, at the end, all terms must be represented in the Body coordinate system by using transformation matrices. Implementing this strategy, with
 introducing  

= [



],  



= [



] and  



= 



 , results in the following set of

translational dynamic equations: 






  ×   



  +  ×  ×    




 +  × 










+ 



  +  ×  ×   + 




+ 



 +2  ×   
 

  ×  



( 4.24)

    +  ×    


=

The position vectors 

and 

are both constant vectors, and depend on the morphology of the target

insect. The right hand side of equation ( 4.24) represents the external forces applied to the Body and the Wings, and will be generated at section  4.4.3 . Note that the vector [   ] should be provided directly by obtaining the time

derivative of the kinematic equations ( 4.11), and thus, does not represent a set of differential terms which should be integrated to propagate the translational dynamic.

4.4.2 Rotational Dynamics
The rotational dynamic equations of a system of  clustered rigid bodies could be developed based on the Eulerslawasfollows  [57]:
       +



  (      ) =
 

 +


  

( 4.25)



Note that the   represents the skew-symmetric matrix of the position vector of the rigid body  relative to the Inertial frame (  ). Separating the contributions of the Body and the Wings in the first term of the left hand side of the equation ( 4.25), and implementing the Euler transformation, and considering that the moment of inertia of each object (body and wings) is constant in its corresponded frame leads to

48

            =    +    +



      +  

    

( 4.26)



By implementing the expansion    =    +    and performing Euler transformation to establish    in the Body frame, and considering  = - , equation ( 4.26) becomes
            =    +   





+


  (  

+  





-



 ) +








+



  (

+  )



( 4.27)

On the other hand, taking the rotational time derivative of the second term in the left hand side of equation ( 4.25) yields         =
 

 (        +        )

( 4.28)

The first term in the right hand side of above equation vanishes regarding the fact that the auto-cross-product of the derivatives of the vectors is zero. Thus, separating the body and wings contribution results in         =       +
 

     

( 4.29)

 By introducing    =  , and performing Euler transformation, the first term in the right hand side of

above equation becomes
       =   (  +   )

( 4.30)

The Euler transformation along with the vector expansion  =  +  +  could be used to develop the second term in the right hand side of equation ( 4.29) as follows:       =
      (   +   +    +   +  )

( 4.31)

In the right hand side of above equation, the first and the third terms are already zero. Moreover, the rotational time derivatives of the last two terms could readily be transformed to the Body frame     =     +    ( 4.32)

49

      =    +  

( 4.33)

Thus, the only remaining term to be calculated is the rotational time derivative of the second term in the right hand side of equation ( 4.31). This term could be developed by expanding the angular velocity tensor  =  +  , and accordingly performing the Euler transformation, as follows:     =     +    +     +    ( 4.34)

Note that the  in the right hand side should be expanded into  =  +  . If we take the rotational time derivative of the third term in the right hand side of above equation, and using Euler transformation    =    +   , and considering that    = 0, this term becomes     =     +    ( 4.35)

Therefore, substituting equation ( 4.35) into ( 4.34), and then, substituting equations ( 4.32)-( 4.34) into ( 4.31), leads to     +    +    + 2   +      +    +    +    +  

     =
 

 

( 4.36)

Finally, if we substitute equations ( 4.30) and ( 4.36) into ( 4.29), and then substitute equations ( 4.27) and ( 4.29) into ( 4.25), we get     +    +2   +    +       +    +    +  +  
   +   ( +  ) 

 


+


  (   +    -   ) +

( 4.37)

       +   +    +   (   +   )= 

 +


  

The second term in the right hand side of above equation can be split into two parts according to the contributions of the Body and the Wings, as follows:

50

   =   +
 

 +    


( 4.38)

= 


 +

Now, if we pre-multiply both sides of translational equation ( 4.23) by  , the corresponded resulting terms in equation ( 4.37) will be cancelled out from both sides, and the general set of rotational dynamics equations for an insect-like flapping wing AMR in an invariant tensorial form will be obtained as follows:     +    +2   +    +       +    +    +  +  
   +    +  

 




+


  (   +    -   ) +

( 4.39)

     +   +    = 

 +


 

Finally, by representing the tensorial terms in appropriate coordinate systems, and unifying the final set of equations to be expressed in the Body coordinate system, the final set of rotational dynamics equation prepared for numerical simulation will be generated as follows: 











+ 



×


+


+
  +  

   +  ×  ×         +  ×    +  +  ×  ×           +2  ×    ×  +  +  ×              +       +  ×                  +    -  ×              =   +   ×    +  ×          ×  
  and  







+ 



( 4.40)

 Note that the matrices of moment of inertia 

are both constant matrices and depend on the

morphology of the inspired insect. The right hand side of equation ( 4.40) represent the external moments applied to the Body center of mass, and will be developed in the next section. 51

4.4.3 External Forces and Moments
The right hand side of the translational and rotational equations of motion indicates the aerodynamics and gravitational forces and moments applied to the system of clustered rigid bodies (including Body and two Wings) represented in the Body coordinate system. However, since the gravitational forces are constantly toward the  axis of the Inertial coordinate system, they are preferred to be expressed in this system of coordinates. Moreover, the aerodynamic forces of the wing are observed  [38] to act perpendicular and tangential to the wing surface, and thus, are more desirable to be expressed in the Wing coordinate system. Therefore, the right hand side of equations ( 4.24) and ( 4.40) could be developed as bellow
  






=  



+






 
0



+ 



 

0 0






+
 

 +




×  




=


( 4.41) +  + 


 



   

×  × 







 
0



+












0 0  

where  is the gravitational acceleration, and   



denotes the location of the wing center of pressure relative to

the wing hinge, expressed in the Wing coordinate system. In this formulation, the aerodynamic force of the body (  ) is assumed to be provided at the body center of mass, whereas the aerodynamic force of the wing


(

   0 

) is obtained at the wing center of pressure. Therefore, the wing does not contribute any moments about

its center of mass (  = 0). Dickinson et al.  [18] have captured and digitized the wing motion of the Drosophila


melanogaster, and replayed this motion in a dynamically scaled environment through an apparatus to measure the aerodynamic forces oftheinsectswingatdifferentmaneuvers.Accordingtotheirinvestigations,theaerodynamic forces of the wing could be empirically approximated based upon the quasi-steady model and comprised of three components associated with the delayed stall, rotational lift and added mass effect mechanisms, as bellow  [18],  [19]:

52

 





1  =   2

 2

 +  2 



 0   0 0  


( 4.42) 0 0  1


+

 2 4

 



 . 

  

sin  +

 



 cos 

 where  is the air density, and  denotes the chord length at spanwise distance  from the wing hinge. 

is the

wing velocity with respect to the Inertial frame expressed in the Wing coordinate system. This velocity is comprised of the wing angular velocity relative to the body, along with the contributions of the linear and angular velocities of the body relative to Inertial frame on the wing velocity:  =  ×  


 



+ 



u v +  w



  × 





+ 



 



( 4.43)

Following empirical relations are suggested for the wing aerodynamic force coefficients  ,  and  Error! Bookmark not defined.,  [15],  [18]: -0.4 cos 2 2 ­      4 4 otherwise

 =

0  = 3.4 sin   = 1.55

( 4.44)

However, to be consistent with the definition of the wing coordinate system (Figure  4.3), the sign of the  and  should be negative for the right wing at downstroke and the left wing at upstroke. The aerodynamic forces and moments of the body are obtained using following classical aerodynamic relations  [19]:  0   2    

 



 

1  =   2

 2

( 4.45)

 



1  =    2



where  and  are the length and the frontal plane area of the body, respectively. The body force and moment coefficients could be obtained using following relations  [19]:

53

 = -0.6 cos   = -1.2 sin   = 0 1 + cos 2 1 + cos  1 - cos    =   +  - 2 2 2 1 - cos 2 1 + cos  1 - cos   =   +  - 2 2 2 where by introducing  = asin
  2 + 2 + 2

( 4.46)

and  = atan , the  and the  ( ) are defined as follows




 = atan tan2  + tan2 


  =
1

 sin  +  cos 

( 4.47)

Dickson et al.  [19] suggested a value of  = 4 for reasonable approximation of the ( ). In particular, for longitudinal flight of Drosophila, the coefficients of  and  are respectively proposed to best fit the approximation 1:4 = [-0.0494 with -0.0136 values -0.0028 of [23]:  1:4 = [0.0167 0.0878 -0.005 -0.0063] and

0.0027].

4.5 Simulation Analysis
In this section some simulation analyses are performed to investigate the behaviour of the developed model of flapping wing aerial micro robot. The choice of the control inputs for trimming and controller design is discussed first. Thereafter, the reliability of implementing two commonly proposed simplifying assumptions in modeling of insect-like flapping wing AMRs (the averaging theory and the negligible wing mass effect) is investigated.

4.5.1 Control Inputs
Basically, the proper choice of the control inputs for a physical system is strongly correlated with the structure of the control law, the computational cost, and the manufacturing limitations. This choice for an insect-like flapping wing AMRs has normally been inspired from observation of the insects wing motion during free flight maneuvers as discussed in section  3.4 . On the other hand, the worthful experiences earned from flight control analyses of fixed and rotary wing aerial micro robots could be exploited to optimize this selection. Considering the

54

structure of the model predictive control law (to be discussed in the next chapter), and inspiring the control mechanisms of the real flying insets as well as conventional airplanes and helicopters, the stroke plane inclination angle, the mean stroke angle, the stroke angle amplitude and the wingbeat frequency are suggested as the most efficient choices of the control inputs for this study. Accordingly, the idea is to obtain a set of baseline wing kinematics for each flight regime, and define the control input parameters as deviation of the proposed kinematic parameters from this reference motion. Fry et al.  [27] have captured and digitized the three baseline wing kinematic parameters (stroke angle , deviation angle  and rotation angle  ) of the free flying Drosophila that provides the time history of these parameter at each stroke (Figure  4.4). These results could be used to obtain the baseline stroke amplitude (0 ) as well as the baseline mean stroke angle ( 0 ) of the wing in a complete stroke. The baseline information of the wingbeat frequency (0 ) and the stroke plane deviation angle (0 ) could be obtained from results of Ellingtons investigation on hovering flight of several insects  [22]. Furthermore, the time history of the wing deviation angle  () and the wing rotation angle  () are provided in Figure  4.4 to be directly used in the simulation. Therefore, by considering the proposed control input parameters ( ,  ,  and  ), the time history of the wing kinematic parameters could be approximately generated through the simulation by using following set of relations:

Figure  4.4: The time history of the free flying Drosophila wing kinematics parameters at the upstroke (white background) and downstroke (gray background): stroke angle  (blue), rotation angle  (green) and deviation angle  (red)  [27]

55

 = 0 +  () = (0 + ) cos[2 0 +  ] +  0 +   () = 0 cos[4 0 +  ] + 0  () = 0 sin[2 0 +  ] where the baseline kinematic parameters are denoted by zero subscript. Therefore, the proposed control inputs parameters ( ,  ,  and  ) appear in the equations of motion through the wing kinematic parameters (, ,  and  ). These kinematic parameters are the basic constituents of the wing-body transformation matrix  as the wing angular velocity 
 

( 4.48)

as well

which appear in the kinematic and dynamic equations of motion. Note that

each wing (left and right) possesses its own control parameters, and thus, there will be eight independent control inputs in the structure of the modeling framework and controller design. However, since the control input  appears inside the trigonometric functions, its influence on the evolution of the body might be negligible in some flight regimes.

4.5.2 Averaging Theory and Trim Conditions
The wing aerodynamic forces and moments are function of the wing kinematic parameters that are evolving with high wingbeat frequency. These forces and moments apply to the insects body whose dynamics is much slower than the wing. Therefore, only the wingbeat-cycle-averaged aerodynamic forces and moments of the wing could be assumed to modulate the body. The general idea of the averaging theory  [16] is to implement one-wingbeat average of the high frequency external forces and moments of the wing to the slow dynamics of the body, and design the closed-loop controller based on this time-averaged model. In this case, if the frequency of the external forces is high enough, the closed-loop control law will guaranty (if being feasible) the exponential stability of the original system with a small amplitude periodic bounded error. Therefore, if we represent the original closed-loop system as  =   , ,   =   ( 4.49)

where  and  are the close-loop control input and the control law, respectively; the time-averaged model can be obtained as

56

 =   ,  1   =   , ,    0  =  

( 4.50)

Since time does not appear explicitly in equation ( 4.50), the time-averaged model could be trimmed and linearized (around the trim point) for any desired flight regime to provide the LTI model to be exploited as the base model of any linear control law. Basically, to trim the dynamic model of the insect-like flapping wing AMR, the set of translational ( 4.24) and rotational ( 4.40) equations of motion along with the kinematic equations ( 4.12) should be solved for an appropriate set of trim parameters while the time derivative terms are all set to zero in the specified flight regime. Note that the differential terms ,  and  are generated thought the actuated spherical joint of the wing, and thus, should not be mistakenly considered as state propagating terms and set to be zero. In fact, these terms along with the wing angular velocity relative to the Body frame  


= 



 and the wing-body transformation matrix 



are

functions of the time varying wing kinematic parameters (, ,  and  ) and their derivatives. Moreover, the wing aerodynamic force coefficients  ,  are functions of the wing effective angle of attack  which could be approximately assumed to be equal to the wing rotation angle (   ). Furthermore, the wing velocity relative to
 the Inertial frame expressed in the wing coordinate system  

is an indirect function of the wing kinematic

parameters. Therefore, to provide a time invariant model to maintain the trim conditions, the averaging theory could be exploited to provide the model with the wingbeat-cycle-averaged equivalents of these time varying terms in the equations of motion. To solve the trim equations, all terms in the equations of motion are to be transferred to one side, and a quadratic cost function of these terms should be minimized for trim parameters subjected to bound constraints. This optimization algorithm could be performed using fmincon command of MATLAB. However, since the solution of the fmincon might get stuck in a local minimum, the initial guess of the fmincon is provided through several implementation of a global optimization technique (Genetic Algorithm) using  command of MATLAB. The state propagation of the developed model of insect-like flapping wing AMR after maintaining trim condition in a symmetrical longitudinal flight with total speed of 0.2 / for the original model and the timeaveraged model are shown in Figure  4.5. The trim conditions and the morphological parameters are summarized in 57

Figure  4.5: State propagation of the original model (left) and the time-averaged model (right) of flapping wing AMR after trim based on implicit set of equations of motion for 20 wingbeats Table  4.3 and Table  4.4, respectively. Note that the trim conditions in the specified flight regime dictates the time derivative terms as well as the states  , , , , , , 1 and 3 set to be zero, whereas  and  are nonzero, and the control inputs of each wing ( ,  ,  and  ) along with the pitch attitude angle  (or equivalently the 0 and 2 ) should be considered as trim parameters. The control inputs ,  and  are bounded to ±50 , and the deviation from the baseline wingbeat frequency  is limited to ±50 . Moreover, the wing and the body products of inertia are assumed to be zero, and the wing planform is approximated with a rectangular plane. The results represented in Figure  4.5 address the challenging nature of the insect-like flapping wing aerial micro robots in terms of simulation analysis. Although the fmincon provides an acceptable set of trim parameters by minimizing the defined quadratic cost function in order of 10-12 , the solution of the implicit ordinary differential equations associated with the set of the translational, rotational and kinematic equations of motion, does not provide Table  4.3:  (/)  =  (deg) 0 2 0.20 2.067 0.322 0.056 58

Trim Conditions  =  (deg)   =   (deg)  =  (deg)  =  (deg) -39.986 47.916 -22.779 0.482

Table  4.4: Baseline kinematics
0 (deg) 0 (deg)  0 (deg)  = 0 (deg) 0 (deg) 50 60 0 0 45  (2 )  ()   (2 )  (2 )  (2 )

Baseline kinematics and morphological parameters Body
 ()  ()   (2 )  (2 )  (2 ) 0.0135 3.34 × 10-5 2.19 × 10-10 10.92 × 10-10 10.92 × 10-10      
     

Wing
3.34 × 10-5 4.70 × 10-7 3.34 × 10-12 1.67 × 10-12 5.00 × 10-12

Geometry
() () () () 0 0.0036 0 0 0.0075 0 0.0012 -0.0009 -0.0010 0.0012 +0.0009 -0.0010 200



0 ()

a reliable propagation of the state of the system at trim conditions. For instance, the longitudinal angular velocity () does not exhibit the expected trim behaviour by starting to monotonically increase once the simulation starts. This mathematical issue is originated from the differential equation solver (ode15i) used to integrate the equations of motion in MATLAB environment. Indeed, the lack of general possibility to provide a consistent initial condition for the states and their derivatives according to the ode15i solver, results in an unexpected propagation of the states of the system. This deficiency could be resolved by rearranging the translational and rotational equations of motion to form an explicit set of ordinary differential equations. To do this, let first introduce following notations: 1 2 =  3 11 21 31 12 22 32 13 23 =  33          =  







+ 



;



  





;



( 4.51)

Keeping the terms related to the time derivative states ,  , , , ,  in the left hand side of equations ( 4.24) and ( 4.40), and transferring the remaining terms to the right hand side, leads to 1      × 2 +   =  3   1 1 1          2 ×  × 2 + 2 ×  3 3 3       11 12 13  21 22 23  +    + 32 33      31




( 4.52)   =  



59

where  and  represent the external forces and moments as well as the remaining terms of the left hand side of the equations of motion transferred to the right hand side. After a few steps of matrix manipulation, equation ( 4.52) could be rewritten in the following linear ( = ) form:  0 0 0   3 - 2 0 0  0 0  - 3  2 0 - 1   1 0   0 0 0  0 0 0  + 0 0 0 0 0 0 0 0 0 0 - 3  2 2 2 11 +  (2 + 3 )  21 -  2 1 31 -  3 1 0 0 0 0 0 0 0 0 0           3 - 2 0  1  - 1 0 12 - 1 2 13 -  1 3 2 2 22 +  (1 + 3 ) 23 -  2 3 2 2  32 - 3 2 33 +  (2 + 1 )     --- = ---    



( 4.53)

Although the analytic inverse of the coefficient matrix () in equation ( 4.53) is very complicated to be used in the formulation set up, the presented linear set of differential equation could be solved using an explicit solver (e.g. ode45) in the expense of obtaining the numeric inverse of the 6 × 6 matrix of  at each iteration. Figure  4.6 shows the time history of the states of the system after maintaining trim condition using new explicit set of equations. As was expected, the original system does not adapt the trim conditions, whereas the time-averaged system represents a well-posed trimmed behaviour. Therefore, by rearranging the equations of motion into an explicit form, a reliable simulation framework, in particular for the time-averaged model, could be obtained. Note that the pitch attitude angle  in Figure  4.6 is obtained from Quaternion parameters (equation ( 4.8)), and thus, its value remains within ±90 . Obviously, this is only a mathematical representation, and the pitch angle, in a physical sense, is decreasing monotonically.

4.5.3 Effect of the wing mass and moment of inertia
Normally, a practical approach in the context of the simulation analysis of an insect-like flapping wing AMR is to neglect the effect of the wing mass and moment of inertia regardingtothefactthattheinsetswingmassis normally two orders of magnitude smaller than the mass of the body  [16],  [22],  [44]. This assumption can simplify the problem set by turning the implicit ordinary differential equations of motion into a very simple explicit form.

60

Figure  4.6: State propagation of the original model (left) and the time-averaged model (right) of flapping wing AMR after trim based on explicit equations of motion for 20 wingbeats

However, this approach should be quantitatively investigated since the terms associated with the contributions of the wing mass and moment of inertia in the equations of motion are complex functions of the states of the system and their derivatives. The first summation terms in the LHS of equations ( 4.24) and ( 4.40) are corresponded to the contributions of the wing mass in the translational and rotational dynamics, respectively. Similarly, the second and the third summation terms in the LHS of equation ( 4.40) are corresponded to the contributions of the wing moment of inertia in the rotational dynamic equations. Obviously, by neglecting the wing mass, the wing moment of inertia will be directly eliminated form equations of motion. To investigate the reliability of negligible wing mass assumption, the response of the system to different symmetrical step commands in control inputs ,  and  for two cases including nonzero wing mass and zero wing mass, are obtained as shown in Figure  4.7 to Figure  4.9. This simple analysis indicates that neglecting the wing mass effect may result in a significant loss in reliability of the modeling framework of an insect-like flapping wing aerial micro robot. In particular, the contribution of the wing mass and moment of inertia in response of the system to input commands in stroke amplitude () is more rigorous than two other control inputs ( and ).

61

Specifically, the pitch rate  and the pith attitude  are very sensitive to variation of the wing mass and moment of inertia.

Figure  4.7: Longitudinal evolution of the model of the insect-like flapping wing AMR in response to 20% step command in the stroke amplitude  (at  = 0.02 s) for nonzero wing mass (solid) and zero wing mass (dashed)

Figure  4.8: Longitudinal evolution of the model of the insect-like flapping wing AMR in response to 20% step command in the mean stroke angle m (at  = 0.02 s) for nonzero wing mass (solid) and zero wing mass (dashed)

62

Figure  4.9: Longitudinal evolution of the model of the insect-like flapping wing AMR in response to 20% step command in the stroke plane inclination angle  (at  = 0.02 s) for nonzero wing mass (solid) and zero wing mass (dashed) Furthermore, same conclusions are achieved after generalizing this analysis by obtaining the step response of the system to asymmetric control inputs in the left wing stroke amplitude  and the left wing stroke deviation angle  as represented in Figure  4.10 and Figure  4.11, respectively.

Figure  4.10: Step response of the insect-like flapping wing AMR to 20% increase in left wing stroke amplitude (at  = 0.02 ) for nonzero wing mass (solid) and zero wing mass (dashed) 63

Figure  4.11: Step response of the insect-like flapping wing AMR to 20% increase in left wing stroke plane inclination angle  (at  = 0.02 ) for nonzero wing mass (solid) and zero wing mass (dashed)

64

5.

Model

Predictive

Control

for

Flapping Wing AMR
Model Predictive Control (MPC) has drawn a great deal of interest in the last few decades in a wide gamut of applications ranging from process industries to servo mechanics and flight controller design. The capability of handling constraints in an explicit fashion while being able to deal with unstable and non-minimum phase systems distinguishes this strategy from other classical control methods  [10]. Furthermore, the MPC structure could be easily extended for MIMO systems without any expense of extra complexity. Finally, the worthful features of MPC in the context of design and development of fault tolerant systems, glorifies the potentiality of this controller  [32]. As will be illustrated in the following section, the prediction model is the heart of the MPC structure. In fact, the closer the prediction model is to the real plant, the more reliable will be the implemented control strategy. Generally, the prediction of the future outputs of the system could be provided through either a linear or a nonlinear model of the plant. The linear prediction models provide a simple and for the cases in which there are no constraints result in closed form solution with the minimum possible computational cost. However, for the time varying systems and high degrees of nonlinearity, the linear models do not provide a reliable prediction of the real plant which may result in instability of the closed loop system. On the other hand, nonlinear models provide a more reliable predictionofthesystemsoutputsintheexpenseofveryhighcomputationalcost.Furthermore,therobustnessand stability analysis for the nonlinear MPC is more tedious than classical linear predictive controllers.

65

This chapter aims to investigate the application of the model predictive control in the simulation framework of an insect-like flapping wing aerial micro robot. In this regard, two MPC strategies including one linear model based approach (Generalizes Predictive Control (GPC)) and one nonlinear model based approaches (Quasi Infinite Horizon Nonlinear Model Predictive Control (QIHNMPC)) are investigated, and the challenging features and computational issues associated with each method is thoroughly discussed.

5.1 Generalized Predictive Control (GPC)
Among the different linear predictive control strategies, the Generalized Predictive Control (GPC) has been more addressed in the academic research environments. This section briefly reviews the general structure of the MPC and specifications of this control method with respect to GPC in particular for insect-like flapping wing AMR application.

5.1.1 MPC Structure
The idea of Model Predictive Control  [10],  [32] is to obtain the optimal solution for the  future control inputs of the system at each sample time , such that the  future outputs to be close enough to the  future desired outputs (Figure  5.1). This strategy could be summarized in three steps: 1. At each time instant , an appropriate model is used to predict the  future outputs of the system   + 1  , ...,   +   . These predicted outputs are function of the previous inputs and previous outputs as well as the  future inputs of the system which will be obtained at next step 2. The optimal solution of the  future control inputs of the system    ,...,   +  - 1  are obtained through an iterative constrained optimization of a cost function formed of differences between the predicted and the desired future outputs of the system in the prediction horizon while penalizing the control efforts. 3. The first calculated control input    is applied to the original system, and the remaining controls are rejected while the control strategy will repeatedly continue at next sampling times in a receding fashion.

66

yd
y

ym

past
u

future
u

M P

time

t

Figure  5.1:

Model Predictive Control (MPC) strategy

5.1.2 Prediction Model
At the heart of the MPC strategy is the prediction model which plays a crucial role in the close-loop performance of the controller. This model should represent a reliable formulation of the system dynamics while being simple and easily implementable. The prediction model according to the Generalized Predictive Control (GPC) strategy has normally been developed based on discrete transfer function of the system in following form
   -  =1      +  =1   -

  =

1

()

( 5.1)

where  -1 is the backward shift operator,  and  are coefficients of denominator and numerator polynomials, and  and  are degrees of these polynomials, respectively. This transfer function could be obtained by linearizing the nonlinear set of equations of motion in a provided trim condition. By applying the shift operator and replacing  with  +  (for the  step ahead prediction), the prediction model at sample time  can be obtained as follows:
     

  +   = -
 =1

   +  -  + 1  +
 =1

   +  -  + 1 

( 5.2)

Therefore, starting from  = 1, equation ( 5.2) generates the prediction of the  future outputs of the system in a recursive fashion. Note that, as mentioned at the first step of the MPC strategy, the output prediction is comprised of two parts. One part is function of the previous outputs (when - + 1 < 0 ) as well as the previous inputs (when  -  + 1 < 0 ) which are both obtained at previous sample times. This part which represents the contribution of 67

the previous events on the future outputs of the system is called free response and can be simply obtained by running the prediction model while its future inputs in the control horizon are set to be all constant and equal to the last calculated control input   - 1  - 1 . The second part of the predictions is function of the future inputs of the system, and could be obtained  [10] using step response coefficients of the linearized model, such that the general prediction model can be finally represented in following form  =  +   where   is the  × 1 vector of the free responses of the system and 1    =    0    ...    0  0 1  - +1
 ×

( 5.3)

 =

  + 1     +  

,
 ×1

 =

      +  - 1 

,
 ×1

( 5.4)

where    =   - ( - 1), and  named Toeplitz matrix is comprised of step response coefficients  of the linear model of the system.

5.1.3 Control Algorithm
The cost function to be minimized is defined as difference between the predicted future outputs and the desired outputs in the prediction horizon while penalizing the control efforts within the acceptable boundaries of the control inputs in following quadratic form
  =  -  -    -  -    +  R . .      

( 5.5)

where  and  are positive definite weighting matrices, and  is the  × 1 vector of the desired future outputs. In fact, the explicit implementation of the bound constraints on the control inputs distinguishes MPC from other types of optimal control strategies. In the cases with no constraints, an optimal closed form solution could be analytically obtained. Contrarily, the presence of constraints dictates the implementation of iterative algorithms to solve the optimization problem. An important issue in this regard is the feasibility of the solutions. In other words, since the constraints reduce the region of stability, there might be some cases in which the optimization problem does not end up with feasible solution.

68

The basic tuning parameters of the controller are weighting matrices ( , ), sampling time ( ), prediction horizon () and control horizon (). The weighting matrix  allocates the relative importance of the controlled outputs, whereas the  penalizes the control effort. However, it should be noted that the choice of the very large  may result in elimination of the system dynamics from control algorithm, and consequently, the instability of the closed loop system. The sampling time  should be small enough to reliably represent the discrete model of the system. A practical approach is to select the sampling time to be one order of magnitude smaller than the period of the largest eigen value of the system. The prediction horizon and the control horizon should be properly chosen to be consistent with the dynamic behaviour of the system. Normally, the control horizon is selected to be smaller than the prediction horizon for the sake of economy in computational cost.

5.1.4 Stability and Robustness
Although GPC does not guarantee the asymptotic stability of the close loop system, some useful theorems could be exploited to achieve stability by adding some further constraints to the cost function. In particular, the Constrained Receding Horizon Predictive Control (CRHPC)  [13] suggests to add an equality constraint to the cost function at the end of the prediction horizon such that the  further future outputs to be exactly equal to the  further desired outputs. Therefore, the cost function of the equation ( 5.5) could be modified as
  =  -  -    -  -    +  R . .   +   =        

( 5.6)

where  and   are Toeplitz matrix and free responses corresponded to the  further outputs, and can be obtained in the same way used to provide  and   . According to this method, for a system of order , following conditions guaranty the asymptotic stability of the close loop system  =    + 2  =  + 1 ( 5.7)

Note that, this method only guarantees the stability of the close loop system, but not the feasibility of the solution. In an extreme case, the added equality constraints may restrict the optimization algorithm such that no feasible solution could be obtained while the stability is already guaranteed.

69

Basically, the linearized model is an approximation of the real plant at an operating point without considering disturbances, noises and model-system mismatch. The noises and disturbances are not considered in this study, whereas the model-system mismatch could dramatically affect the reliability of the proposed controller. In this regard, to improve the robustness of the controller by compensating the model-system mismatch, the difference between the present outputs of the real system   and linearized model  () at each sample time  is feedback to the cost function to be compensated through the control algorithm. However, since the future outputs of the real system are unknown at time , the mismatch at each time is generalized to the entire prediction horizon as bellow 1  1 ( 5.8)
 ×1

 =   -  

Therefore, vector  from above equation should be accommodated inside the cost function ( 5.6) to compensate the model-system mismatch. Moreover, to modify the robustness of the response at the beginning of the simulation, the desired outputs ( ) are passed through a first degree robust filter with pole  as bellow
    +  =   +  - 1 + 1 -    +     =   =  

( 5.9)

 Therefore, the filtered desired outputs  will be implemented to the control algorithm instead of  , and 

which is a constant value between zero and one could be considered as another tuning parameter in the control strategy.

5.1.5 Simulations
The Generalized Predictive Controller is implemented to the six degrees of freedom nonlinear (not the linearized time-averaged) model of the insect-like flapping wing AMR to follow a 0.5 / step command in total speed starting from trim conditions (Table  4.3). The control inputs (,  and ) for each wing (left and right) are bounded to ±40 , and the tuning parameters of the controller are iteratively found to best result in an acceptable performance of the close loop system while  = 30,  = 2,  = 0.001 ,  = 0.1,  = 5, and  = (0.1,0.1,0.1,0.1,0.1,0.1). The morphological parameters are chosen based on those of typical insects and are summarized in Table  4.4. In this case, the  is observed to exhibit negligible contribution in the optimization algorithm, and thus, has been eliminated from the control inputs set.

70

Figure  5.2 shows the simulation results for three different scenarios: constrained GPC (solid), unconstrained optimization (dashed) and truncated optimization (star). Although the unconstrained solution exhibits the fastest response, the extreme violation of the control inputs (particularly in the stoke plane inclination ) rules out the application of this method. Contrarily, by truncating the violated control inputs to respect the boundaries, the solution will be sub-optimal, and consequently, the output reaches the set point slower than two other scenarios. The constrained GPC, on the other hand, exhibits simultaneously the acceptable performance and the constraint satisfaction. In particular, compared with the unconstrained solution (dashed), the GPC (solid) allocates the work load of the bounded control inputs ( and  ) at the beginning of the simulation to other control inputs (  and   ) in a naturally reconfigurable fashion to optimally move on the boundaries of the constraints while exhibiting acceptable response (Figure  5.2). The sampling rate used to discrete the time-averaged linearized model and run the simulation is 0.001 , and the output reaches the desired set point after less than 20 sample times. Although the closed loop system with generalize predictive controller exhibits an acceptable performance in the specified scenario, the results of simulations in this investigation converged to the fact that the GPC could not be accounted as a reliable controller for insect-like flapping wing AMRs. This issue is referred to the highly nonlinear

Figure  5.2: Top: Close-loop response of the insect-like flapping wing AMR to step command in total speed for three scenarios (unconstrained optimization (dashed), constrained GPC (solid) and truncated optimization (star). Bottom: time history of the control inputs for the left wing (left) and right wing (right): stoke angle amplitude , mean stroke angle  and stroke plane inclination angle  71

and time varying nature of this type of system, and motivated us to consider the application of the Nonlinear MPC for insect-like flapping wing AMRs.

5.2 Quasi Infinite Horizon NMPC
The MPC strategy is in fact a variant of open loop optimal control problem in which the infinite prediction and control horizons are replaced by finite receding horizons. Although this modification provides the controller with capability of handling constraints in optimization algorithm, the proof of stability for the new finite horizon optimization problem, in particular for cases including nonlinear system, becomes more challenging. Generally, the classical form of MPC does not guarantee the closed-loop stability  [8], and only by proper tuning of the controller parameters the closed-loop system could be stabilized. On the other hand, the optimal control problem is more mature in terms of stability analysis. Therefore, an idea is to modify the MPC strategy in such a way that it emulates the structure of the optimal control problem, and thus, utilizing the stability properties of the optimal control problem for a close-loop system using MPC. In this regard, several methods using Nonlinear MPC with guaranteed stability have been proposed  [1],  [33]. The Quasi-Infinite Horizon Nonlinear Model Predictive Control (QIHNMPC) proposed by Chen and Allgower  [11] is one of these methods in which the closedloop system using this control scheme exhibits asymptotic stability whith an acceptable computational cost. Basically, the control scheme in QIHNMPC is comprised of two parts: one open-loop optimal control problem with finite horizon cost function which drives the nonlinear system to a terminal region, and one local linear state feedback controller which stirs the states to the equilibrium point. The first step is implemented by defining an open-loop optimal control problem for a set of finite prediction and control horizons with minimizing a quadratic objective cost function including a terminal cost and subject to nonlinear system dynamics, input constraints and an extra terminal region constraint. Regarding the second step, the terminal states within the terminal region should be penalized such that the cost function, ranging from the end of the prediction horizon to infinity, remains bounded, while being controlled with a local linear state feedback controller. The closed-loop control is obtained by repeating the entire open-loop optimal control scheme on-line at each sample time using new information of the system in a receding fashion. In fact, the local linear state feedback will never be directly applied

72

to the closed-loop system, but it is only a means by which the proper choice of terminal region and terminal cost could be achieved to guarantee the asymptotic stability of the closed-loop system. In the following section the mathematical formulation of the QIHNMPC including the problem setup and stability requirements are discussed.

5.2.1 Mathematical Formulation
In the sense of QIHNMPC, the open-loop optimal control problem at time  with initial state () is defined as follows  [11]:
 +

  subject to

 =


  -      -  +      +   +  -      +  - 



( 5.10)

 =   ,        ;

;

0 =     [t , t + P] ( 5.11)

  +  -      +  -    where    and    are the states and control vectors, respectively.  :  ×    represent the nonlinear dynamics of the system, and for the equilibrium (trim) conditions   ,  = 0. :    and :    denote the positive definite, symmetric weighting matrices corresponded to states and controls, respectively.  and  represent the boundaries of control input, and  denotes the prediction (and control) horizon. Note that without loss of generality the prediction and control horizons are assumed to be equal ( = ).The positive definite and symmetric matrix    ×  is the terminal penalty matrix and constant  defines the terminal region. In fact, the proper choice of  and  is essential for closed-loop stability of QIHNMPC to be guaranteed. Chen and Allgower proposed four steps to obtain  and  as follows  [11]: Step 1. Obtain the Jacobian linearization of the nonlinear model around the equilibrium (trim) point  =   -  + ( -  ), and find a locally stabilizing linear state feedback gain  such that closed-loop system  =  ( -  ) with  =  -  is asymptotically stable (assuming that the linearized model is stabilizable).

73

Step 2. Choose a constant   [, ) such that  < - min ( ) , and solve the following Lyapunov equation to obtain the positive definite symmetric terminal penalty matrix  :  +    +   +  = -( +   ) ( 5.12)

Step 3. Find the largest possible 1 such that the linear state feedback control  = -  -  +  respects the boundaries (    ) for all    in the region of     1 Step 4. Find the largest possible   (0, 1 ] such that the solution of the following constrained optimization problem is nonpositive:   {    -   } . .      ( 5.13)

where   =   , -  -  +  -  ( -  ). Note that these calculations should be performed offline and only once before the on-line simulation to provide the finite horizon open loop optimal controller with appropriate set of  and  regarding to the terminal cost and terminal region, respectively. This implies the fact that locally linear state feedback controller is not directly applied to the closed system. Furthermore, the larger the  is, the more relax the terminal region will be, which means wider feasibility region. In contrast, the nonlinearity of the original system has negative correlation with . In other words, the stronger the nonlinear the system is, the more limited will be the feasibility region of the open-loop optimal control problem  [11]. Therefore, according to the theorem proposed by Chen and Allgower  [11], if the Jacobian linearization of the nonlinear system is stabilizable, and the open-loop optimal control problem ( 5.10) subject to equation ( 5.11) is feasible at  = 0, for the cases in which there are no noises or disturbances, the closed-loop system obtained from on-line implementation of the open-loop optimal control problem in a receding fashion, is nominally asymptotically stable. Note that for the open-loop optimal control problem to be feasible at  = 0, the prediction horizon  should be chosen large enough.

5.2.2 Application Analysis
Regarding the high computational cost associated with the QIHNMPC, the following simplified longitudinal model of the insect-like flapping wing AMR is selected for the simulation analysis:

74

1  = - -  sin  +   1  =  +  cos  +   1  =    = 

( 5.14)

where  ,  and  are the elements of the external forces and moments applied to the body in the  ,  and  directions of the Body coordinate system, respectively. Furthermore, the stroke deviation angle  and the rotation angle    are set to be constant and equal to zero and 50 , respectively. Therefore, the closed-loop behaviour of the nonlinear system ( 5.14) in explicit form and comprised of four states (, ,  and ) and three control inputs ( =  ,   =   and  =  ) is investigated. Note that the  is excluded from control input set because of its negligible effect on the modulation of the states of the system. According to the QIHNMPC, the analysis could be divided into two steps: the offline calculations and the online closed-loop implementation of the optimal controller. In the context of offline calculations, the linearized model of the system is provided using MATLAB linmod command, and a stabilizing LQR state feedback gain  is obtained using lqr command. The lyap command is used to provide the symmetric positive definite penalty matrix  . To find the largest possible 1 , following optimization problem is performed:      . .   -  -  +    ( 5.15)

The value of the objective function at the solution point of the optimization problem ( 5.15) would be the largest possible 1 . However, since the problem is not well-posed in terms of control input constraints, the objective function of equation ( 5.15) is unbounded, which means 1 is infinity. Thus, value of  at the next step could be any positive number. On the contrary, the solution of the optimization problem ( 5.13) in step 4 does not give a nonpositive value of the objective function even for very small choices of . This issue restricts the application of the QIHNMPC for the selected longitudinal model of the insect-like flapping wing AMR to the case in which the terminal inequality constraint (terminal region) reduces to a point, or equivalently, a terminal equality constraint. Therefore, the terminal state penalty does not make sense in this case, and the open-loop optimal control problem ( 5.10) and ( 5.11) becomes

75

 +

  subject to

 =


  -      -  +     



( 5.16)

 =   ,        ;

;

0 =     [t , t + P] ( 5.17)

  +  =  Although the new optimal control problem is no longer benefiting from the attractive feature of QIHNMPC in terms of low computational cost, the asymptotic stability of this problem is still guaranteed  [34]. However, the strong terminal equality constraint significantly affects the optimization algorithm by decreasing the feasibility region of the solution which may result in instability of the closed-loop system. The results of several simulation analyses for different combinations of tuning parameters (, ,  ,  and ) and for several initial conditions indicate that the terminal equality constraint is too strong for the highly timevarying nonlinear dynamic model of the insect-like flapping wing aerial micro robots to be controlled through the proposed optimal control problem in a closed-loop receding fashion.

76

6.

Conclusion
This thesis describes the development of the simulation framework for the insect-like flapping wing aerial

micro robots in the context of dynamic modelling and controller design. The six degrees of freedom nonlinear equations of motion including translational and rotational dynamics as well as the kinematic equations are developed in a consistent tensorial formulation. The wing motion is assumed to be generated through an actuated spherical joint with three rotational degrees of freedom, and the wing kinematic equations are developed by means of proper definition of the wing frame and body frame as well as their associated coordinate systems. The reliability of the developed equations of motion is investigated through numerical analyses, and the mathematical issues in the context of trimming and integrating the equations of motion are discussed. To provide a time-invariant model to trim the equations of motion, the wingbeat-cycle-averaged forces and moment of the wing are assumed to modulate the body dynamic, according to the averaging theory. The common assumption of neglecting the effect of the wing mass and moment of inertia on the equations of motion is investigated quantitatively. The simulation results show that this assumption may result in a significant deficiency in representing the characteristic behaviour of the insect-like flapping wing AMR in terms of dynamic modeling and analysis. Specifically, the contribution of the wing mass and moment of inertia in the evolution of the attitude angles (,  and ) and the body angular velocities (,  and ) in response of the system to input commands in stroke amplitude () is considerably significant, and thus, could not be easily eliminated from equations of motion.

77

Furthermore, attractive features of Model Predictive Control (MPC), in particular, the explicit treatment of constraints within the control strategy, motivated us to investigate the application of this controller for the developed model of the insect-like flapping wing AMR. In this regard, two MPC methods including one linear method (GPC) and one nonlinear method (QIHNMPC) were selected to be implemented based on the AMR model. The closed-loop system using GPC exhibits acceptable response for some specified accelerated flight maneuvers, whereas the highly nonlinear and time-varying nature of the insect-like flapping wing AMR dynamics rules out this controller as a suitable control strategy. Indeed, this conclusion was achieved after observation of the closed-loop system behaviour for several simulations performed using different combinations of the controller parameters (weighting matrices  , , prediction horizon , control horizon , sampling time  and the pole of the robust filter ). In fact, the large number of tuning parameters is a significant disadvantage of MPC in terms of computational cost associated to the closed-loop system analysis. On the other hand, the QIHNMPC was expected to result in more consistent closedloop behaviour since the nonlinear model provides a more reliable prediction of the system future outputs to be used within the control algorithm. However, since the proper set of the terminal penalty matrix and the terminal region for some cases in which the problem is not well-posed are impossible to be obtained, the close-loop stability could not be guaranteed. Furthermore, the closed-loop performance of the QIHNMPC is strongly correlated with the feasibility of the open optimal control problem at the beginning of the simulation. The results of simulations in this study for several initial conditions and different combinations of tuning parameters did not end up with a feasible solution of the optimal control problem at the beginning of simulation even for the simplified longitudinal dynamics of the flapping wing AMR. Moreover, the solution time of the open-loop optimal control problem at each time instant, in particular for the cases with long prediction horizons, is beyond the admissible range in the context of real-time application. In conclusion, neither GPC nor QIHNMPC provides the insect-like flapping wing AMR dynamics with a consistent control algorithm with asymptotic stability of the closed-loop system. Nevertheless, these deficiencies cannot completely rule out the MPC, and in particular the Nonlinear MPC, as a viable control strategy to be considered in the simulation framework of the flapping wing AMR systems, and more investigations are needed to be conducted in this field. Finally, the fabrication issues and manufacturing paradigms regarding to design of the insect-like flapping wing aerial micro robots are also investigated in this work. The promising MFI and HFM projects were targeted to be analyzed in the context of the fabrication and manufacturing of four basic components of an insect-like flapping

78

wing aerial micro robot: actuators, transmissions, wing and airframe. This survey provides a thorough insight into the present gap between the fabricated insect-like flapping wing micromechanical devices and the virtually developed aerial micro robots modeled inside the simulation environment. In the context of aerodynamics, the present simulation frameworks of insect-like flapping wing aerial micro robots, including the framework developed in this work, do not provide some unsteady aerodynamic mechanisms such as wake capture  [15],  [19]. The fabricated flapping wing AMRs, on the other hand, naturally utilize these mechanisms through the wing flapping and rotation. On the contrary, the wing motion in the simulation frameworks is normally assumed to be generated through an actuated spherical joint with three rotational degrees of freedom, whereas the wing motion of the most recent version of the fabricated AMRs is provided only with one active and one passive joint with totally two degrees of freedom  [26]. Furthermore, in contrast with virtual simulation frameworks, stability analysis and controller design for fabricated insect-like AMRs is still in an immature stage. This immaturity is related to the technological limitations in terms of fabrication of the operational on-board modules such as sensors and central processing unit considering the limited weight budget of the at-scale insect-like flapping wing aerial micro robots.

6.1 Future Work
Aerodynamics As discussed earlier, the highly unsteady nature of the wake capture mechanism prevents this phenomenon to be reliably modeled and being used in the insect-like flapping wing simulation frameworks. However, considering the significant effect of this mechanism in the wing force generation, in particular at the beginning of each stroke [7],   [18],  [27], the wing force module of the simulation framework should be modified by accounting for an empirical model of the wake capture obtained from experimental investigations. Furthermore, the wing base kinematic parameters (Figure  4.4), which are defined as the reference of the wing motion, should be experimentally obtained for all flight maneuvers. For instance, the reference motion of the wing for the hovering flight and the saccade maneuver are not normally the same.

79

Dynamic Modeling The simulation framework in this study is developed based on the rigid body assumption, whereas the wing structure exhibits deformation in many flying insects. Therefore, the effect of the wing deformation on the generation of the flight forces and moments should be investigated. Furthermore, the developed set of the equations of motion represents a reliable dynamic model of the insectlike flapping wing AMR, and could be exploited to obtain the simplified models of the system to be used for controller design by means of some identification techniques. Controller design Although the result of this investigation on the application of the model predictive control for insect-like flapping wing AMRs rules out the two proposed methods (GPC and QIHNMPC) for such systems, other viable MPC methods should be investigated to generalize the conclusion that whether the MPC is an appropriate control strategy for insect-like flapping wing AMRs or not. It should be noted that the motivating reason behind the selection of the MPC to be implemented to the system of the flapping wing aerial micro robot was the attractive feature of this controller in the context of explicit constraint implementation within the optimization algorithm. Furthermore, the controllers studied in this work were designed for the nominal system of the flapping wing AMR without considering noise and disturbance. However, a consistent simulation framework should take into account the environmental stimulus as well as the sensory system noises. In particular, small size and low speed flight regime of insect-like flapping wing AMRs make them extremely vulnerable to environmental gusts and turbulences, and thus, these effects are to be considered in the simulation framework. In this regard, the robust control techniques should be taken into account which may affect the optimization algorithm. In other words, the optimality of the solution may have to be compromised for the sake of robustness of the closed-loop system. In the context of the real-time application, the computational time could be reduced by using a hardware embedded MPC rather than a PC or a dedicated computer  [9] Finally, the proper models of the sensors and actuators should be added to the closed-loop system to increase the reliability of the proposed simulation framework.

80

Bibliography
[1] F.Allgower, "Nonlinear model predictive control," IEE Proceedings Control Theory and Application, vol. 152, no. 3, May 2005. J. D. Anderson, Fundamentals of Aerodynamics, 4th ed. Boston: McGraw-Hill Higher Education, c2006. S. Avadhanula, R. J. Wood, E. Steltz, J Yan, and R. S. Fearing, "Lift force improvement for the MicromechanicalFlyingInsect,"in IEEE/RSJ IROS 2003, Las Vegas, Nevada, Oct. 2003. S. Avadhanula, R. J. Wood, D. Campolo and R. S. Fearing,"DynamicallytuneddesignoftheMFIthorax," in IEEE International Conference on Robotics and Automation, Washington, DC, May 2002. S.Avadhanula,"Design,FabricationandControloftheMicromechanicalFlyingInsect," Ph. D. dissertation, University of California, at Berkeley, CA, USA, 2006. L. Bennett,"InsectFlight:LiftandRateofChangeofIncidence," Science, vol. 167, no. 3915, pp. 177 ­ 179, Jan 1970. J.M.BirchandM.H.Dickinson,"Theinfluenceofwing-wake interaction on the production of aerodynamic forcesinflappingflight," The Journal of Experimental Biology, vol. 206, pp. 2257 - 2272, 2003. R. R. Bitmead, M. Gevers, and V. Wertz, Adaptive Optimal Control ­ The Thinking Man's GPC. New York: Prentice Hall Professional Technical Reference, 1990. L.G.BlerisandM.V.Kothare,"Real-timeimplementationoftheModelPredictiveControl,"in American Control Conference, Portland, USA, June 2005. E. F. Camacho and C. Bordons, Model Predictive Control, 2nd ed. London: Springer, 2004. H. Chen and F. Allgower, "A Quasi Infinite Horizon Nonlinear Model Predictive Control scheme with guaranteed stability,"Automatica, vol. 34, no. 10, pp. 1205 - 1217, Oct. 1998. D. W. Clarke, C. Mohtadi, and P. S. Tuffs, "Generalized predictive control-part I. the basic algorithm," Automatica, vol. 23, no. 2, pp. 137 - 148, 1987. D.W.ClarkeandR.Scattolini,"Constrainedreceding-horizonpredictivecontrol," IEE Proceedings Control Theory and Application, vol.138, no. 4, pp. 347 ­ 354, Jul. 1991. A Cox, D. Monopoli, D. Cveticanin, M. Goldfarb and E. Garcia, "The development of electrodynamic components for piezoelectrically actuated flapping micro-airvehicle,"Journal of Intelligent Material Systems and Structures, vol. 13, no. 9, pp. 611 ­ 615, Sep. 2002. 81

[2] [3]

[4]

[5]

[6]

[7]

[8]

[9]

[10] [11]

[12]

[13]

[14]

[15]

X. Deng, L. Schenato, W. C. Wu, and S.S.Sastry,"FlappingFlightforBiomimeticRoboticInsects:PartSystemModeling," IEEE Transaction on Robotics, vol. 22, no. 4, Aug. 2006. X.Deng,L.Schenato,S.S.Sastry,"FlappingFlightforBiomimeticRoboticInsects:Part-Flight Control Design",IEEE Transaction on Robotics, vol. 22, no. 4, Aug 2006. M. H. Dickinson and K. G. Gotz, "Unsteady aerodynamic performance of model wigs at low Reynolds numbers",Journal of Experimental Biology, vol. 174, no. 1, pp. 45 - 64, 1993. M. H. Dickinson, F. Lehmann, and S. P. Sane,"Wing rotation and the aerodynamic basis of insect flight", Science, vol. 284, no. 5422, pp. 1954 - 1960, Jun. 1999. W.B.Dickson,A.D.Straw,andM.H.Dickinson,"IntegrativeModelof Drosophila Flight,"AIAA Journal, vol. 46, no. 9, pp. 2150 ­ 2164, Sep. 2008. A. Dogan, J. F. Fernandez, K. Uchino and R. E. Newnham, "The cymbal electromechanical actuator," in Proc. of the 10th IEEE Int. Symposium on Application of Ferroelectrics, Aug. 1996 C.P.EllingtonandA.P.Willmott,"Leading-edgevorticesininsectflight", Nature, vol. 384, pp. 626 - 630, Dec.1996. C.P.Ellington,"Theaerodynamics of hovering insect flight -V," Philos. Trans. Roy. Soc. London B, vol. 305, no. 1122, pp. 1 - 181, Feb. 1984. M. Epstein, S. Waydo, S. B. Fuller, W. Dickson, A. Straw, M. H. Dickinson, and R. M. Murray, "BiologicallyinspiredfeedbackdesignforDrosophilaflight," in Proceeding of the 2007 American Control Conference, New York, USA, 2007. Z.A.KhanandS.K.Agrawal,"Design of flapping mechanism based on transverse bending phenomena in insects,"in Proceedings of the 2006 IEEE International Conference on Robotics and Automation, Orlando, USA, May 2006. B. Finio, J. K. Shang, andR.J.Wood,"Bodytorquemodulationforamicroroboticfly," in IEEE Int. Conf. on Intelligent Robotics and Automation, Kobe, Japan, May 2009. B. M. Finio, B. Eum, andR.J.Wood,"Asymmetricflapping for a robotic fly using a hybrid power-control actuator,"in IEEE/RSJ Int. Conf. on Intelligent Robots and Systems, St Louis, USA, October, 2009. S. Fry, R. Sayaman, and M. H. Dickinson, "The Aerodynamics of Free-Flight Maneuvers in Drosophila," Science, vol. 300, no. 5618, pp. 495 ­ 498, Apr. 2003. G. Gebert, P Gallmeier, and J.Evers,"Equations ofmotionforflappingflight," in AIAA atmospheric flight mechanics conference, Monterey, USA, Aug. 2002. K. D. Jones, C. J. Bradshaw, J. Papadopoulos, and M. F. Platzer, "Improved performance and control of flapping wing propelled micro air vehicles," in proceeding of the 42nd aerospace science meeting and exhibition, Reno, USA, 2004. M.Lighthill,"OntheWeis-Fogh mechanism of lift generation," Journal of fluid mechanics, vol. 60, no. 1, pp. 1 - 17, 1973 H. Liu, C. P. Ellington, K. Kawachi, C. V. D. Berg and A. P. Willmott, "A computational fluid dynamic study of hawk moth hovering,"Journal of Experimental Biology, vol. 201, pp. 416 - 477, 1998 J. M. Maciejowski, Predictive Control with Constraints, Harlow, England: Pearson Education, c2002. 82

[16]

[17]

[18]

[19]

[20]

[21]

[22]

[23]

[24]

[25]

[26]

[27]

[28]

[29]

[30]

[31]

[32]

[33]

D. Q. Mayne, J. B. Rawlings, C. V. Rao, and P.O. M. Scokaert, "Constrained model predictive control: stabilityandoptimality,"Automatica, vol. 36, no. 6, pp. 789 - 814, Jun. 2000. D. Q. Mayne and H. Michalska, "Receding horizon control of nonlinear systems," IEEE Trans. Automat. Control, vol. 35, no. 7, pp. 814-824, 1990. R. C. Michelson, "Planetary Exploration Using Biomimetic - An Entomopter for Flight on Mars," NASA Institute for Advanced Concepts Project NAS5-98051, October 2002. R.Ramamurti,W.C.Sandberg,"Athreedimensionalcomputationalstudyoftheaerodynamicmechanismof insect flight," Journal of Experimental Biology, vol. 205, pp. 1507 - 1518, Mar. 2002. S.P.Sane,"Theaerodynamicsofinsectflight," Journal of Experimental Biology, vol. 206, pp. 4191 - 4208, Oct. 2003. S.P.SaneandM.H.Dickinson,"Thecontroloftheflight force by flapping wing: Lift and Drag production," Journal of Experimental Biology, vol. 204, pp. 2607-2626, 2001 L. Schenato, "Analysis and Control of Flapping Flight: from Biological to Robotic Insects," Ph. D. dissertation, University of California, at Berkeley, CA, USA, 2003. M. J. C. Smith, P. Wilkin, andM.H.Williams,"Theadvantageofanunsteadypanelmethodinmodelling the aerodynamic forces on rigid flapping wings," Journal of Experimental Biology, vol. 199, pp. 1073-1083, 1996. E. E. Steltz,"Redesignofthemicromechanical flying insect in a power density context," Ph. D. dissertation, University of California, at Berkeley, CA, USA, 2008. E. Steltz, S. Avadhanula, and R. S. Fearing, "High lift force with 275Hz wingbeat in MFI," in IEEE/RSJ International Conference on Intelligent Robotics and Systems, San Diego, USA, Oct. 2007. M.Sun,J.K.Wang,andY.Xiong,"Dynamicflightstabilityofhoveringinsect," Acta Mech Sin, vol. 23, no. 3, pp. 231 - 246, Jun. 2007. M.SunandJ.K.Wang,"Flight stabilizationcontrolofahoveringmodelinsect," Journal of Experimental Biology, vol. 210, pp. 2714 - 2722, 2007. M.SunandJ.Tang,"Unsteadyaerodynamicforcegenerationbyamodelfruitflywinginflappingmotion ," Journal of Experimental Biology, vol. 205, pp. 55 - 70, 2002. H. Tanaka, K. Hoshino, K. Matsumoto, and I. Shimoyama,"Flight dynamics of a butterfly-typeornithopter," in IEEE/RSJ Int. Conf. on Intelligent Robots and Systems, Edmonton, Canada, 2005. G. Taylor, "Mechanics andAerodynamics of Insect Flight Control," Biological Review, vol. 76, no. 4, pp. 449 - 471, Nov. 2001. D. Viieru, J. Tang, Y. Lian, H. Liu, and W. Shyy, "Flapping and flexible wing aerodynamics of low Reynolds number flight vehicles," AIAA aerospace science meeting and exhibition, Reno, USA, Jan. 2006. T. Weis-Fogh, "Quick estimates of flight fitness in hovering animals, including novel mechanisms for lift production,"Journal of Experimental Biology, vol. 59, pp. 169 - 230, 1973. R. J. Wood, "Composite Microstructures, Microactuators and Sensors for Biologically Inspired Micro Air Vehicle,"Ph. D. dissertation, University of California, at Berkeley, CA, USA, 2004.

[34]

[35]

[36]

[37]

[38]

[39]

[40]

[41]

[42]

[43]

[44]

[45]

[46]

[47]

[48]

[49]

[50]

83

[51]

R. J. Wood, S. Avadhanula, R. Sahai, E. Steltz and R. S. Fearing, "Microrobot Design Using Fiber ReinforcedComposites,"Journal of Mechanical Design, vol. 130, no. 5, 052304 - 1 - 11, May 2008. R.J.Wood,S.Avadhanula,M.MenonandR.S.Fearing,"Microrobotics Using Composite Materials: The Micromechanical Flying Insect Thorax," in IEEE Int. Conf. on Robotics and Automation, Taipei, Taiwan, May 2003. R.J.Wood,"Design, fabrication, and analysis of a 3DOF, 3cm flapping-wingMAV,"in IEEE/RSJ Int. Conf. on Intelligent Robots and Systems, San Diego, USA, Oct. 2007. R. J. Wood, "Liftoff of a 60mg flapping-wing MAV," in IEEE/RSJ Int. Conf. on Intelligent Robots and Systems, San Diego, USA, Oct. 2007. R. J. Wood, "The first take off of a biologically inspired at-scale robotic insect," IEEE Transaction on Robotics, vol. 24, no. 2, pp. 341 ­ 347, Apr. 2008. R.J.Wood,"Progressindevelopmentofinsect-scaleflyingrobots,"Harvard Microrobotic Lab, 2008. P. H. Zipfel, Modeling and simulation of aerospace vehicle dynamics, 2nd ed., Reston: AIAA Education Series, c2007. D. Zuo, S. Peng, W. Chen, W. Zhang, "Numerical Simulations of flapping-wing insect hovering flight at unsteady flow,"International Journal for numerical methods in fluids, vol. 53, no. 12, pp. 1801 ­ 1817, Oct. 2006. Available: http://www.ode.org [Accessed Apr 20, 2010]. www.delfly.nl [Visited Apr 20, 2010].

[52]

[53]

[54]

[55]

[56] [57]

[58]

[59] [60]

84

